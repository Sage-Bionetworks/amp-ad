webpackJsonp([0],{1226:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_react__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_0_react___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_react__),__WEBPACK_IMPORTED_MODULE_1_react_plotly_js__=__webpack_require__(1227),__WEBPACK_IMPORTED_MODULE_1_react_plotly_js___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_react_plotly_js__),__WEBPACK_IMPORTED_MODULE_2_prop_types__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_2_prop_types___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_prop_types__),__WEBPACK_IMPORTED_MODULE_3__utils_SynapseConstants__=__webpack_require__(659),__WEBPACK_IMPORTED_MODULE_4__utils_SynapseClient__=__webpack_require__(211),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var SynapsePlot=function(_React$Component){function SynapsePlot(props){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SynapsePlot);var _this=function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(SynapsePlot.__proto__||Object.getPrototypeOf(SynapsePlot)).call(this,props));return _this.state={isLoaded:!1},_this.fetchPlotlyData=_this.fetchPlotlyData.bind(_this),_this.showPlot=_this.showPlot.bind(_this),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SynapsePlot,__WEBPACK_IMPORTED_MODULE_0_react___default.a.Component),_createClass(SynapsePlot,[{key:"componentDidMount",value:function componentDidMount(){this.fetchPlotlyData()}},{key:"fetchPlotlyData",value:function fetchPlotlyData(){var _this2=this,token=this.props.token,query=this.props.widgetparamsMapped.query,queryRequest={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:__WEBPACK_IMPORTED_MODULE_3__utils_SynapseConstants__.a,query:{sql:query}};Object(__WEBPACK_IMPORTED_MODULE_4__utils_SynapseClient__.getFullQueryTableResults)(queryRequest,token).then(function(data){_this2.setState({queryData:data,isLoaded:!0})}).catch(function(err){console.log("Error on full table query ",err)})}},{key:"showPlot",value:function showPlot(){if(this.state.isLoaded){var _props$widgetparamsMa=this.props.widgetparamsMapped,title=_props$widgetparamsMa.title,xtitle=_props$widgetparamsMa.xtitle,ytitle=_props$widgetparamsMa.ytitle,type=_props$widgetparamsMa.type,xaxistype=_props$widgetparamsMa.xaxistype,showlegend=_props$widgetparamsMa.showlegend,queryData=this.state,isHorizontal=this.props.widgetparamsMapped.horizontal.toLowerCase(),layout={title:title,showlegend:showlegend};xtitle&&(layout.xaxis={title:xtitle}),xaxistype&&(layout.xaxis=Object.assign({},layout.xaxis,{xaxistype:xaxistype.toLowerCase()})),ytitle&&(layout.yaxis={title:ytitle});for(var plot_data=[],orientation=isHorizontal?"v":"h",headers=queryData.queryData.queryResult.queryResults.headers,i=0;i<headers.length-1;i++)plot_data[i]={x:[],y:[],name:headers[i+1].name,type:type.toLowerCase(),orientation:orientation};for(var _i=0;_i<queryData.queryData.queryResult.queryResults.rows.length;_i++)for(var row=queryData.queryData.queryResult.queryResults.rows[_i],j=1;j<row.values.length;j++){var row_values=row.values;plot_data[j-1].x.push(row_values[0]),plot_data[j-1].y.push(row_values[j])}return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_react_plotly_js___default.a,{data:plot_data,layout:layout})}}},{key:"render",value:function render(){return this.state.isLoaded?__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_0_react___default.a.Fragment,null,this.showPlot()):null}}]),SynapsePlot}();SynapsePlot.propTypes={ownerId:__WEBPACK_IMPORTED_MODULE_2_prop_types___default.a.string,wikiId:__WEBPACK_IMPORTED_MODULE_2_prop_types___default.a.string,widgetparamsMapped:__WEBPACK_IMPORTED_MODULE_2_prop_types___default.a.object},__webpack_exports__.default=SynapsePlot},1227:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _factory2=_interopRequireDefault(__webpack_require__(1228)),_plotly2=_interopRequireDefault(__webpack_require__(1229));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PlotComponent=(0,_factory2.default)(_plotly2.default);exports.default=PlotComponent,module.exports=exports.default},1228:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.default=function plotComponentFactory(Plotly){var PlotlyComponent=function(_Component){function PlotlyComponent(props){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PlotlyComponent);var _this=function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(PlotlyComponent.__proto__||Object.getPrototypeOf(PlotlyComponent)).call(this,props));return _this.p=Promise.resolve(),_this.resizeHandler=null,_this.handlers={},_this.syncWindowResize=_this.syncWindowResize.bind(_this),_this.syncEventHandlers=_this.syncEventHandlers.bind(_this),_this.attachUpdateEvents=_this.attachUpdateEvents.bind(_this),_this.getRef=_this.getRef.bind(_this),_this.handleUpdate=_this.handleUpdate.bind(_this),_this.figureCallback=_this.figureCallback.bind(_this),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(PlotlyComponent,_Component),_createClass(PlotlyComponent,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.p=this.p.then(function(){return Plotly.newPlot(_this2.el,{data:_this2.props.data,layout:_this2.props.layout,config:_this2.props.config,frames:_this2.props.frames})}).then(function(){return _this2.syncWindowResize(null,!0)}).then(this.syncEventHandlers).then(this.attachUpdateEvents).then(function(){return _this2.figureCallback(_this2.props.onInitialized)}).catch(function(err){return console.error("Error while plotting:",err),_this2.props.onError&&_this2.props.onError(err)})}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps){var _this3=this;if(void 0===nextProps.revision||nextProps.revision!==this.props.revision){var numPrevFrames=this.props.frames&&this.props.frames.length?this.props.frames.length:0,numNextFrames=nextProps.frames&&nextProps.frames.length?nextProps.frames.length:0;nextProps.layout===this.props.layout&&nextProps.data===this.props.data&&nextProps.config===this.props.config&&numNextFrames===numPrevFrames||(this.p=this.p.then(function(){return Plotly.react(_this3.el,{data:nextProps.data,layout:nextProps.layout,config:nextProps.config,frames:nextProps.frames})}).then(function(){return _this3.syncEventHandlers(nextProps)}).then(function(){return _this3.syncWindowResize(nextProps)}).then(function(){return _this3.figureCallback(nextProps.onUpdate)}).catch(function(err){console.error("Error while plotting:",err),_this3.props.onError&&_this3.props.onError(err)}))}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.figureCallback(this.props.onPurge),this.resizeHandler&&isBrowser&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.removeUpdateEvents(),Plotly.purge(this.el)}},{key:"attachUpdateEvents",value:function attachUpdateEvents(){if(this.el&&this.el.removeListener)for(var i=0;i<updateEvents.length;i++)this.el.on(updateEvents[i],this.handleUpdate)}},{key:"removeUpdateEvents",value:function removeUpdateEvents(){if(this.el&&this.el.removeListener)for(var i=0;i<updateEvents.length;i++)this.el.removeListener(updateEvents[i],this.handleUpdate)}},{key:"handleUpdate",value:function handleUpdate(){this.figureCallback(this.props.onUpdate)}},{key:"figureCallback",value:function figureCallback(callback){if("function"==typeof callback){var _el=this.el,data=_el.data,layout=_el.layout,frames=this.el._transitionData?this.el._transitionData._frames:null,figure={data:data,layout:layout,frames:frames};callback(figure,this.el)}}},{key:"syncWindowResize",value:function syncWindowResize(propsIn,invoke){var _this4=this,props=propsIn||this.props;isBrowser&&(props.useResizeHandler&&!this.resizeHandler?(this.resizeHandler=function(){return Plotly.Plots.resize(_this4.el)},window.addEventListener("resize",this.resizeHandler),invoke&&this.resizeHandler()):!props.useResizeHandler&&this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null))}},{key:"getRef",value:function getRef(el){this.el=el,this.props.debug&&isBrowser&&(window.gd=this.el)}},{key:"syncEventHandlers",value:function syncEventHandlers(propsIn){for(var props=propsIn||this.props,i=0;i<eventNames.length;i++){var eventName=eventNames[i],prop=props["on"+eventName],hasHandler=!!this.handlers[eventName];prop&&!hasHandler?(this.handlers[eventName]=prop,this.el.on("plotly_"+eventName.toLowerCase(),this.handlers[eventName])):!prop&&hasHandler&&(this.el.removeListener("plotly_"+eventName.toLowerCase(),this.handlers[eventName]),delete this.handlers[eventName])}}},{key:"render",value:function render(){return _react2.default.createElement("div",{id:this.props.divId,style:this.props.style,ref:this.getRef,className:this.props.className})}}]),PlotlyComponent}(_react.Component);PlotlyComponent.propTypes={data:_propTypes2.default.arrayOf(_propTypes2.default.object),config:_propTypes2.default.object,layout:_propTypes2.default.object,frames:_propTypes2.default.arrayOf(_propTypes2.default.object),revision:_propTypes2.default.number,onInitialized:_propTypes2.default.func,onPurge:_propTypes2.default.func,onError:_propTypes2.default.func,onUpdate:_propTypes2.default.func,debug:_propTypes2.default.bool,style:_propTypes2.default.object,className:_propTypes2.default.string,useResizeHandler:_propTypes2.default.bool,divId:_propTypes2.default.string};for(var i=0;i<eventNames.length;i++)PlotlyComponent.propTypes["on"+eventNames[i]]=_propTypes2.default.func;return PlotlyComponent.defaultProps={debug:!1,useResizeHandler:!1,data:[],style:{position:"relative",display:"inline-block"}},PlotlyComponent};var _react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_propTypes2=_interopRequireDefault(__webpack_require__(1));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var eventNames=["AfterExport","AfterPlot","Animated","AnimatingFrame","AnimationInterrupted","AutoSize","BeforeExport","ButtonClicked","Click","ClickAnnotation","Deselect","DoubleClick","Framework","Hover","LegendClick","LegendDoubleClick","Relayout","Restyle","Redraw","Selected","Selecting","SliderChange","SliderEnd","SliderStart","Transitioning","TransitionInterrupted","Unhover"],updateEvents=["plotly_restyle","plotly_redraw","plotly_relayout","plotly_doubleclick","plotly_animated"],isBrowser="undefined"!=typeof window;module.exports=exports.default},1229:function(module,exports,__webpack_require__){(function(global){var require,f;f=function(){return function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){if(!f&&"function"==typeof require&&require)return require(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}}()({1:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../src/lib"),rules={"X,X div":"direction:ltr;font-family:'Open Sans', verdana, arial, sans-serif;margin:0;padding:0;","X input,X button":"font-family:'Open Sans', verdana, arial, sans-serif;","X input:focus,X button:focus":"outline:none;","X a":"text-decoration:none;","X a:hover":"text-decoration:none;","X .crisp":"shape-rendering:crispEdges;","X .user-select-none":"-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;","X svg":"overflow:hidden;","X svg a":"fill:#447adb;","X svg a:hover":"fill:#3c6dc5;","X .main-svg":"position:absolute;top:0;left:0;pointer-events:none;","X .main-svg .draglayer":"pointer-events:all;","X .cursor-default":"cursor:default;","X .cursor-pointer":"cursor:pointer;","X .cursor-crosshair":"cursor:crosshair;","X .cursor-move":"cursor:move;","X .cursor-col-resize":"cursor:col-resize;","X .cursor-row-resize":"cursor:row-resize;","X .cursor-ns-resize":"cursor:ns-resize;","X .cursor-ew-resize":"cursor:ew-resize;","X .cursor-sw-resize":"cursor:sw-resize;","X .cursor-s-resize":"cursor:s-resize;","X .cursor-se-resize":"cursor:se-resize;","X .cursor-w-resize":"cursor:w-resize;","X .cursor-e-resize":"cursor:e-resize;","X .cursor-nw-resize":"cursor:nw-resize;","X .cursor-n-resize":"cursor:n-resize;","X .cursor-ne-resize":"cursor:ne-resize;","X .cursor-grab":"cursor:-webkit-grab;cursor:grab;","X .modebar":"position:absolute;top:2px;right:2px;z-index:1001;background:rgba(255,255,255,0.7);","X .modebar--hover":"opacity:0;-webkit-transition:opacity 0.3s ease 0s;-moz-transition:opacity 0.3s ease 0s;-ms-transition:opacity 0.3s ease 0s;-o-transition:opacity 0.3s ease 0s;transition:opacity 0.3s ease 0s;","X:hover .modebar--hover":"opacity:1;","X .modebar-group":"float:left;display:inline-block;box-sizing:border-box;margin-left:8px;position:relative;vertical-align:middle;white-space:nowrap;","X .modebar-group:first-child":"margin-left:0px;","X .modebar-btn":"position:relative;font-size:16px;padding:3px 4px;cursor:pointer;line-height:normal;box-sizing:border-box;","X .modebar-btn svg":"position:relative;top:2px;","X .modebar-btn path":"fill:rgba(0,31,95,0.3);","X .modebar-btn.active path,X .modebar-btn:hover path":"fill:rgba(0,22,72,0.5);","X .modebar-btn.modebar-btn--logo":"padding:3px 1px;","X .modebar-btn.modebar-btn--logo path":"fill:#447adb !important;","X [data-title]:before,X [data-title]:after":"position:absolute;-webkit-transform:translate3d(0, 0, 0);-moz-transform:translate3d(0, 0, 0);-ms-transform:translate3d(0, 0, 0);-o-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);display:none;opacity:0;z-index:1001;pointer-events:none;top:110%;right:50%;","X [data-title]:hover:before,X [data-title]:hover:after":"display:block;opacity:1;","X [data-title]:before":"content:'';position:absolute;background:transparent;border:6px solid transparent;z-index:1002;margin-top:-12px;border-bottom-color:#69738a;margin-right:-6px;","X [data-title]:after":"content:attr(data-title);background:#69738a;color:white;padding:8px 10px;font-size:12px;line-height:12px;white-space:nowrap;margin-right:-18px;border-radius:2px;","X .select-outline":"fill:none;stroke-width:1;shape-rendering:crispEdges;","X .select-outline-1":"stroke:white;","X .select-outline-2":"stroke:black;stroke-dasharray:2px 2px;",Y:"font-family:'Open Sans';position:fixed;top:50px;right:20px;z-index:10000;font-size:10pt;max-width:180px;","Y p":"margin:0;","Y .notifier-note":"min-width:180px;max-width:250px;border:1px solid #fff;z-index:3000;margin:0;background-color:#8c97af;background-color:rgba(140,151,175,0.9);color:#fff;padding:10px;overflow-wrap:break-word;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto;","Y .notifier-close":"color:#fff;opacity:0.8;float:right;padding:0 5px;background:none;border:none;font-size:20px;font-weight:bold;line-height:20px;","Y .notifier-close:hover":"color:#444;text-decoration:none;cursor:pointer;"};for(var selector in rules){var fullSelector=selector.replace(/^,/," ,").replace(/X/g,".js-plotly-plot .plotly").replace(/Y/g,".plotly-notifier");Lib.addStyleRule(fullSelector,rules[selector])}},{"../src/lib":693}],2:[function(_dereq_,module,exports){"use strict";module.exports={undo:{width:857.1,height:1e3,path:"m857 350q0-87-34-166t-91-137-137-92-166-34q-96 0-183 41t-147 114q-4 6-4 13t5 11l76 77q6 5 14 5 9-1 13-7 41-53 100-82t126-29q58 0 110 23t92 61 61 91 22 111-22 111-61 91-92 61-110 23q-55 0-105-20t-90-57l77-77q17-16 8-38-10-23-33-23h-250q-15 0-25 11t-11 25v250q0 24 22 33 22 10 39-8l72-72q60 57 137 88t159 31q87 0 166-34t137-92 91-137 34-166z",transform:"matrix(1 0 0 -1 0 850)"},home:{width:928.6,height:1e3,path:"m786 296v-267q0-15-11-26t-25-10h-214v214h-143v-214h-214q-15 0-25 10t-11 26v267q0 1 0 2t0 2l321 264 321-264q1-1 1-4z m124 39l-34-41q-5-5-12-6h-2q-7 0-12 3l-386 322-386-322q-7-4-13-4-7 2-12 7l-35 41q-4 5-3 13t6 12l401 334q18 15 42 15t43-15l136-114v109q0 8 5 13t13 5h107q8 0 13-5t5-13v-227l122-102q5-5 6-12t-4-13z",transform:"matrix(1 0 0 -1 0 850)"},"camera-retro":{width:1e3,height:1e3,path:"m518 386q0 8-5 13t-13 5q-37 0-63-27t-26-63q0-8 5-13t13-5 12 5 5 13q0 23 16 38t38 16q8 0 13 5t5 13z m125-73q0-59-42-101t-101-42-101 42-42 101 42 101 101 42 101-42 42-101z m-572-320h858v71h-858v-71z m643 320q0 89-62 152t-152 62-151-62-63-152 63-151 151-63 152 63 62 151z m-571 358h214v72h-214v-72z m-72-107h858v143h-462l-36-71h-360v-72z m929 143v-714q0-30-21-51t-50-21h-858q-29 0-50 21t-21 51v714q0 30 21 51t50 21h858q29 0 50-21t21-51z",transform:"matrix(1 0 0 -1 0 850)"},zoombox:{width:1e3,height:1e3,path:"m1000-25l-250 251c40 63 63 138 63 218 0 224-182 406-407 406-224 0-406-182-406-406s183-406 407-406c80 0 155 22 218 62l250-250 125 125z m-812 250l0 438 437 0 0-438-437 0z m62 375l313 0 0-312-313 0 0 312z",transform:"matrix(1 0 0 -1 0 850)"},pan:{width:1e3,height:1e3,path:"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z",transform:"matrix(1 0 0 -1 0 850)"},zoom_plus:{width:1e3,height:1e3,path:"m1 787l0-875 875 0 0 875-875 0z m687-500l-187 0 0-187-125 0 0 187-188 0 0 125 188 0 0 187 125 0 0-187 187 0 0-125z",transform:"matrix(1 0 0 -1 0 850)"},zoom_minus:{width:1e3,height:1e3,path:"m0 788l0-876 875 0 0 876-875 0z m688-500l-500 0 0 125 500 0 0-125z",transform:"matrix(1 0 0 -1 0 850)"},autoscale:{width:1e3,height:1e3,path:"m250 850l-187 0-63 0 0-62 0-188 63 0 0 188 187 0 0 62z m688 0l-188 0 0-62 188 0 0-188 62 0 0 188 0 62-62 0z m-875-938l0 188-63 0 0-188 0-62 63 0 187 0 0 62-187 0z m875 188l0-188-188 0 0-62 188 0 62 0 0 62 0 188-62 0z m-125 188l-1 0-93-94-156 156 156 156 92-93 2 0 0 250-250 0 0-2 93-92-156-156-156 156 94 92 0 2-250 0 0-250 0 0 93 93 157-156-157-156-93 94 0 0 0-250 250 0 0 0-94 93 156 157 156-157-93-93 0 0 250 0 0 250z",transform:"matrix(1 0 0 -1 0 850)"},tooltip_basic:{width:1500,height:1e3,path:"m375 725l0 0-375-375 375-374 0-1 1125 0 0 750-1125 0z",transform:"matrix(1 0 0 -1 0 850)"},tooltip_compare:{width:1125,height:1e3,path:"m187 786l0 2-187-188 188-187 0 0 937 0 0 373-938 0z m0-499l0 1-187-188 188-188 0 0 937 0 0 376-938-1z",transform:"matrix(1 0 0 -1 0 850)"},plotlylogo:{width:1542,height:1e3,path:"m0-10h182v-140h-182v140z m228 146h183v-286h-183v286z m225 714h182v-1000h-182v1000z m225-285h182v-715h-182v715z m225 142h183v-857h-183v857z m231-428h182v-429h-182v429z m225-291h183v-138h-183v138z",transform:"matrix(1 0 0 -1 0 850)"},"z-axis":{width:1e3,height:1e3,path:"m833 5l-17 108v41l-130-65 130-66c0 0 0 38 0 39 0-1 36-14 39-25 4-15-6-22-16-30-15-12-39-16-56-20-90-22-187-23-279-23-261 0-341 34-353 59 3 60 228 110 228 110-140-8-351-35-351-116 0-120 293-142 474-142 155 0 477 22 477 142 0 50-74 79-163 96z m-374 94c-58-5-99-21-99-40 0-24 65-43 144-43 79 0 143 19 143 43 0 19-42 34-98 40v216h87l-132 135-133-135h88v-216z m167 515h-136v1c16 16 31 34 46 52l84 109v54h-230v-71h124v-1c-16-17-28-32-44-51l-89-114v-51h245v72z",transform:"matrix(1 0 0 -1 0 850)"},"3d_rotate":{width:1e3,height:1e3,path:"m922 660c-5 4-9 7-14 11-359 263-580-31-580-31l-102 28 58-400c0 1 1 1 2 2 118 108 351 249 351 249s-62 27-100 42c88 83 222 183 347 122 16-8 30-17 44-27-2 1-4 2-6 4z m36-329c0 0 64 229-88 296-62 27-124 14-175-11 157-78 225-208 249-266 8-19 11-31 11-31 2 5 6 15 11 32-5-13-8-20-8-20z m-775-239c70-31 117-50 198-32-121 80-199 346-199 346l-96-15-58-12c0 0 55-226 155-287z m603 133l-317-139c0 0 4-4 19-14 7-5 24-15 24-15s-177-147-389 4c235-287 536-112 536-112l31-22 100 299-4-1z m-298-153c6-4 14-9 24-15 0 0-17 10-24 15z",transform:"matrix(1 0 0 -1 0 850)"},camera:{width:1e3,height:1e3,path:"m500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 15-23 28-40 28h-340c-16 0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 0-19-16-35-35-35z",transform:"matrix(1 0 0 -1 0 850)"},movie:{width:1e3,height:1e3,path:"m938 413l-188-125c0 37-17 71-44 94 64 38 107 107 107 187 0 121-98 219-219 219-121 0-219-98-219-219 0-61 25-117 66-156h-115c30 33 49 76 49 125 0 103-84 187-187 187s-188-84-188-187c0-57 26-107 65-141-38-22-65-62-65-109v-250c0-70 56-126 125-126h500c69 0 125 56 125 126l188-126c34 0 62 28 62 63v375c0 35-28 63-62 63z m-750 0c-69 0-125 56-125 125s56 125 125 125 125-56 125-125-56-125-125-125z m406-1c-87 0-157 70-157 157 0 86 70 156 157 156s156-70 156-156-70-157-156-157z",transform:"matrix(1 0 0 -1 0 850)"},question:{width:857.1,height:1e3,path:"m500 82v107q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-107q0-8 5-13t13-5h107q8 0 13 5t5 13z m143 375q0 49-31 91t-77 65-95 23q-136 0-207-119-9-14 4-24l74-55q4-4 10-4 9 0 14 7 30 38 48 51 19 14 48 14 27 0 48-15t21-33q0-21-11-34t-38-25q-35-16-65-48t-29-70v-20q0-8 5-13t13-5h107q8 0 13 5t5 13q0 10 12 27t30 28q18 10 28 16t25 19 25 27 16 34 7 45z m214-107q0-117-57-215t-156-156-215-58-216 58-155 156-58 215 58 215 155 156 216 58 215-58 156-156 57-215z",transform:"matrix(1 0 0 -1 0 850)"},disk:{width:857.1,height:1e3,path:"m214-7h429v214h-429v-214z m500 0h72v500q0 8-6 21t-11 20l-157 156q-5 6-19 12t-22 5v-232q0-22-15-38t-38-16h-322q-22 0-37 16t-16 38v232h-72v-714h72v232q0 22 16 38t37 16h465q22 0 38-16t15-38v-232z m-214 518v178q0 8-5 13t-13 5h-107q-7 0-13-5t-5-13v-178q0-8 5-13t13-5h107q7 0 13 5t5 13z m357-18v-518q0-22-15-38t-38-16h-750q-23 0-38 16t-16 38v750q0 22 16 38t38 16h517q23 0 50-12t42-26l156-157q16-15 27-42t11-49z",transform:"matrix(1 0 0 -1 0 850)"},lasso:{width:1031,height:1e3,path:"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z",transform:"matrix(1 0 0 -1 0 850)"},selectbox:{width:1e3,height:1e3,path:"m0 850l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m285 0l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m-857-286l0-143 143 0 0 143-143 0z m857 0l0-143 143 0 0 143-143 0z m-857-285l0-143 143 0 0 143-143 0z m857 0l0-143 143 0 0 143-143 0z m-857-286l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m285 0l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z",transform:"matrix(1 0 0 -1 0 850)"},spikeline:{width:1e3,height:1e3,path:"M512 409c0-57-46-104-103-104-57 0-104 47-104 104 0 57 47 103 104 103 57 0 103-46 103-103z m-327-39l92 0 0 92-92 0z m-185 0l92 0 0 92-92 0z m370-186l92 0 0 93-92 0z m0-184l92 0 0 92-92 0z",transform:"matrix(1.5 0 0 -1.5 0 850)"}}},{}],3:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/transforms/aggregate")},{"../src/transforms/aggregate":1144}],4:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/bar")},{"../src/traces/bar":840}],5:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/barpolar")},{"../src/traces/barpolar":852}],6:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/box")},{"../src/traces/box":862}],7:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/components/calendars")},{"../src/components/calendars":565}],8:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/candlestick")},{"../src/traces/candlestick":871}],9:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/carpet")},{"../src/traces/carpet":890}],10:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/choropleth")},{"../src/traces/choropleth":904}],11:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/cone")},{"../src/traces/cone":912}],12:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/contour")},{"../src/traces/contour":927}],13:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/contourcarpet")},{"../src/traces/contourcarpet":938}],14:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/core")},{"../src/core":672}],15:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/transforms/filter")},{"../src/transforms/filter":1145}],16:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/transforms/groupby")},{"../src/transforms/groupby":1146}],17:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/heatmap")},{"../src/traces/heatmap":950}],18:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/heatmapgl")},{"../src/traces/heatmapgl":960}],19:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/histogram")},{"../src/traces/histogram":971}],20:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/histogram2d")},{"../src/traces/histogram2d":977}],21:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/histogram2dcontour")},{"../src/traces/histogram2dcontour":981}],22:[function(_dereq_,module,exports){"use strict";var Plotly=_dereq_("./core");Plotly.register([_dereq_("./bar"),_dereq_("./box"),_dereq_("./heatmap"),_dereq_("./histogram"),_dereq_("./histogram2d"),_dereq_("./histogram2dcontour"),_dereq_("./pie"),_dereq_("./contour"),_dereq_("./scatterternary"),_dereq_("./violin"),_dereq_("./scatter3d"),_dereq_("./surface"),_dereq_("./mesh3d"),_dereq_("./cone"),_dereq_("./streamtube"),_dereq_("./scattergeo"),_dereq_("./choropleth"),_dereq_("./scattergl"),_dereq_("./splom"),_dereq_("./pointcloud"),_dereq_("./heatmapgl"),_dereq_("./parcoords"),_dereq_("./scattermapbox"),_dereq_("./sankey"),_dereq_("./table"),_dereq_("./carpet"),_dereq_("./scattercarpet"),_dereq_("./contourcarpet"),_dereq_("./ohlc"),_dereq_("./candlestick"),_dereq_("./scatterpolar"),_dereq_("./scatterpolargl"),_dereq_("./barpolar")]),Plotly.register([_dereq_("./aggregate"),_dereq_("./filter"),_dereq_("./groupby"),_dereq_("./sort")]),Plotly.register([_dereq_("./calendars")]),module.exports=Plotly},{"./aggregate":3,"./bar":4,"./barpolar":5,"./box":6,"./calendars":7,"./candlestick":8,"./carpet":9,"./choropleth":10,"./cone":11,"./contour":12,"./contourcarpet":13,"./core":14,"./filter":15,"./groupby":16,"./heatmap":17,"./heatmapgl":18,"./histogram":19,"./histogram2d":20,"./histogram2dcontour":21,"./mesh3d":23,"./ohlc":24,"./parcoords":25,"./pie":26,"./pointcloud":27,"./sankey":28,"./scatter3d":29,"./scattercarpet":30,"./scattergeo":31,"./scattergl":32,"./scattermapbox":33,"./scatterpolar":34,"./scatterpolargl":35,"./scatterternary":36,"./sort":37,"./splom":38,"./streamtube":39,"./surface":40,"./table":41,"./violin":42}],23:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/mesh3d")},{"../src/traces/mesh3d":986}],24:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/ohlc")},{"../src/traces/ohlc":991}],25:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/parcoords")},{"../src/traces/parcoords":1002}],26:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/pie")},{"../src/traces/pie":1013}],27:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/pointcloud")},{"../src/traces/pointcloud":1022}],28:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/sankey")},{"../src/traces/sankey":1028}],29:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scatter3d")},{"../src/traces/scatter3d":1064}],30:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scattercarpet")},{"../src/traces/scattercarpet":1070}],31:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scattergeo")},{"../src/traces/scattergeo":1077}],32:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scattergl")},{"../src/traces/scattergl":1085}],33:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scattermapbox")},{"../src/traces/scattermapbox":1091}],34:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scatterpolar")},{"../src/traces/scatterpolar":1098}],35:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scatterpolargl")},{"../src/traces/scatterpolargl":1102}],36:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/scatterternary")},{"../src/traces/scatterternary":1108}],37:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/transforms/sort")},{"../src/transforms/sort":1148}],38:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/splom")},{"../src/traces/splom":1113}],39:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/streamtube")},{"../src/traces/streamtube":1118}],40:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/surface")},{"../src/traces/surface":1123}],41:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/table")},{"../src/traces/table":1131}],42:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("../src/traces/violin")},{"../src/traces/violin":1139}],43:[function(_dereq_,module,exports){"use strict";module.exports=function createCamera(element,options){element=element||document.body,options=options||{};var limits=[.01,1/0];"distanceLimits"in options&&(limits[0]=options.distanceLimits[0],limits[1]=options.distanceLimits[1]);"zoomMin"in options&&(limits[0]=options.zoomMin);"zoomMax"in options&&(limits[1]=options.zoomMax);var view=createView({center:options.center||[0,0,0],up:options.up||[0,1,0],eye:options.eye||[0,0,10],mode:options.mode||"orbit",distanceLimits:limits}),pmatrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],distance=0,width=element.clientWidth,height=element.clientHeight,camera={view:view,element:element,delay:options.delay||16,rotateSpeed:options.rotateSpeed||1,zoomSpeed:options.zoomSpeed||1,translateSpeed:options.translateSpeed||1,flipX:!!options.flipX,flipY:!!options.flipY,modes:view.modes,tick:function(){var t=now(),delay=this.delay;view.idle(t-delay),view.flush(t-(100+2*delay));var ctime=t-2*delay;view.recalcMatrix(ctime);for(var allEqual=!0,matrix=view.computedMatrix,i=0;i<16;++i)allEqual=allEqual&&pmatrix[i]===matrix[i],pmatrix[i]=matrix[i];var sizeChanged=element.clientWidth===width&&element.clientHeight===height;return width=element.clientWidth,height=element.clientHeight,allEqual?!sizeChanged:(distance=Math.exp(view.computedRadius[0]),!0)},lookAt:function(center,eye,up){view.lookAt(view.lastT(),center,eye,up)},rotate:function(pitch,yaw,roll){view.rotate(view.lastT(),pitch,yaw,roll)},pan:function(dx,dy,dz){view.pan(view.lastT(),dx,dy,dz)},translate:function(dx,dy,dz){view.translate(view.lastT(),dx,dy,dz)}};Object.defineProperties(camera,{matrix:{get:function(){return view.computedMatrix},set:function(mat){return view.setMatrix(view.lastT(),mat),view.computedMatrix},enumerable:!0},mode:{get:function(){return view.getMode()},set:function(mode){return view.setMode(mode),view.getMode()},enumerable:!0},center:{get:function(){return view.computedCenter},set:function(ncenter){return view.lookAt(view.lastT(),ncenter),view.computedCenter},enumerable:!0},eye:{get:function(){return view.computedEye},set:function(neye){return view.lookAt(view.lastT(),null,neye),view.computedEye},enumerable:!0},up:{get:function(){return view.computedUp},set:function(nup){return view.lookAt(view.lastT(),null,null,nup),view.computedUp},enumerable:!0},distance:{get:function(){return distance},set:function(d){return view.setDistance(view.lastT(),d),d},enumerable:!0},distanceLimits:{get:function(){return view.getDistanceLimits(limits)},set:function(v){return view.setDistanceLimits(v),v},enumerable:!0}}),element.addEventListener("contextmenu",function(ev){return ev.preventDefault(),!1});var lastX=0,lastY=0,lastMods={shift:!1,control:!1,alt:!1,meta:!1};function handleInteraction(buttons,x,y,mods){var scale=1/element.clientHeight,dx=scale*(x-lastX),dy=scale*(y-lastY),flipX=camera.flipX?1:-1,flipY=camera.flipY?1:-1,drot=Math.PI*camera.rotateSpeed,t=now();if(1&buttons)mods.shift?view.rotate(t,0,0,-dx*drot):view.rotate(t,flipX*drot*dx,-flipY*drot*dy,0);else if(2&buttons)view.pan(t,-camera.translateSpeed*dx*distance,camera.translateSpeed*dy*distance,0);else if(4&buttons){var kzoom=camera.zoomSpeed*dy/window.innerHeight*(t-view.lastT())*50;view.pan(t,0,0,distance*(Math.exp(kzoom)-1))}lastX=x,lastY=y,lastMods=mods}return mouseChange(element,handleInteraction),element.addEventListener("touchstart",function(ev){var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(0,xy[0],xy[1],lastMods),handleInteraction(1,xy[0],xy[1],lastMods),ev.preventDefault()},!!hasPassive&&{passive:!1}),element.addEventListener("touchmove",function(ev){var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(1,xy[0],xy[1],lastMods),ev.preventDefault()},!!hasPassive&&{passive:!1}),element.addEventListener("touchend",function(ev){mouseOffset(ev.changedTouches[0],element),handleInteraction(0,lastX,lastY,lastMods),ev.preventDefault()},!!hasPassive&&{passive:!1}),mouseWheel(element,function(dx,dy,dz){var flipX=camera.flipX?1:-1,flipY=camera.flipY?1:-1,t=now();if(Math.abs(dx)>Math.abs(dy))view.rotate(t,0,0,-dx*flipX*Math.PI*camera.rotateSpeed/window.innerWidth);else{var kzoom=camera.zoomSpeed*flipY*dy/window.innerHeight*(t-view.lastT())/100;view.pan(t,0,0,distance*(Math.exp(kzoom)-1))}},!0),camera};var now=_dereq_("right-now"),createView=_dereq_("3d-view"),mouseChange=_dereq_("mouse-change"),mouseWheel=_dereq_("mouse-wheel"),mouseOffset=_dereq_("mouse-event-offset"),hasPassive=_dereq_("has-passive-events")},{"3d-view":44,"has-passive-events":392,"mouse-change":415,"mouse-event-offset":416,"mouse-wheel":418,"right-now":477}],44:[function(_dereq_,module,exports){"use strict";module.exports=function createViewController(options){var eye=(options=options||{}).eye||[0,0,1],center=options.center||[0,0,0],up=options.up||[0,1,0],limits=options.distanceLimits||[0,1/0],mode=options.mode||"turntable",turntable=createTurntable(),orbit=createOrbit(),matrix=createMatrix();return turntable.setDistanceLimits(limits[0],limits[1]),turntable.lookAt(0,eye,center,up),orbit.setDistanceLimits(limits[0],limits[1]),orbit.lookAt(0,eye,center,up),matrix.setDistanceLimits(limits[0],limits[1]),matrix.lookAt(0,eye,center,up),new ViewController({turntable:turntable,orbit:orbit,matrix:matrix},mode)};var createTurntable=_dereq_("turntable-camera-controller"),createOrbit=_dereq_("orbit-camera-controller"),createMatrix=_dereq_("matrix-camera-controller");function ViewController(controllers,mode){this._controllerNames=Object.keys(controllers),this._controllerList=this._controllerNames.map(function(n){return controllers[n]}),this._mode=mode,this._active=controllers[mode],this._active||(this._mode="turntable",this._active=controllers.turntable),this.modes=this._controllerNames,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}var proto=ViewController.prototype;[["flush",1],["idle",1],["lookAt",4],["rotate",4],["pan",4],["translate",4],["setMatrix",2],["setDistanceLimits",2],["setDistance",2]].forEach(function(method){for(var name=method[0],argNames=[],i=0;i<method[1];++i)argNames.push("a"+i);var code="var cc=this._controllerList;for(var i=0;i<cc.length;++i){cc[i]."+method[0]+"("+argNames.join()+")}";proto[name]=Function.apply(null,argNames.concat(code))}),proto.recalcMatrix=function(t){this._active.recalcMatrix(t)},proto.getDistance=function(t){return this._active.getDistance(t)},proto.getDistanceLimits=function(out){return this._active.getDistanceLimits(out)},proto.lastT=function(){return this._active.lastT()},proto.setMode=function(mode){if(mode!==this._mode){var idx=this._controllerNames.indexOf(mode);if(!(idx<0)){var prev=this._active,next=this._controllerList[idx],lastT=Math.max(prev.lastT(),next.lastT());prev.recalcMatrix(lastT),next.setMatrix(lastT,prev.computedMatrix),this._active=next,this._mode=mode,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}}},proto.getMode=function(){return this._mode}},{"matrix-camera-controller":413,"orbit-camera-controller":436,"turntable-camera-controller":516}],45:[function(_dereq_,module,exports){var global,factory;global=this,factory=function(exports,d3Array,d3Collection,d3Interpolate){"use strict";exports.sankey=function(){var sankey={},nodeWidth=24,nodePadding=8,size=[1,1],nodes=[],links=[];function computeLinkDepths(){function ascendingSourceDepth(a,b){return a.source.y-b.source.y||a.originalIndex-b.originalIndex}function ascendingTargetDepth(a,b){return a.target.y-b.target.y||a.originalIndex-b.originalIndex}nodes.forEach(function(node){node.sourceLinks.sort(ascendingTargetDepth),node.targetLinks.sort(ascendingSourceDepth)}),nodes.forEach(function(node){var sy=0,ty=0;node.sourceLinks.forEach(function(link){link.sy=sy,sy+=link.dy}),node.targetLinks.forEach(function(link){link.ty=ty,ty+=link.dy})})}function center(node){return node.y+node.dy/2}function value(link){return link.value}return sankey.nodeWidth=function(_){return arguments.length?(nodeWidth=+_,sankey):nodeWidth},sankey.nodePadding=function(_){return arguments.length?(nodePadding=+_,sankey):nodePadding},sankey.nodes=function(_){return arguments.length?(nodes=_,sankey):nodes},sankey.links=function(_){return arguments.length?(links=_,sankey):links},sankey.size=function(_){return arguments.length?(size=_,sankey):size},sankey.layout=function(iterations){return function computeNodeLinks(){nodes.forEach(function(node){node.sourceLinks=[],node.targetLinks=[]}),links.forEach(function(link,i){var source=link.source,target=link.target;"number"==typeof source&&(source=link.source=nodes[link.source]),"number"==typeof target&&(target=link.target=nodes[link.target]),link.originalIndex=i,source.sourceLinks.push(link),target.targetLinks.push(link)})}(),function computeNodeValues(){nodes.forEach(function(node){node.value=Math.max(d3Array.sum(node.sourceLinks,value),d3Array.sum(node.targetLinks,value))})}(),function computeNodeBreadths(){for(var nextNodes,remainingNodes=nodes,x=0;remainingNodes.length;)nextNodes=[],remainingNodes.forEach(function(node){node.x=x,node.dx=nodeWidth,node.sourceLinks.forEach(function(link){nextNodes.indexOf(link.target)<0&&nextNodes.push(link.target)})}),remainingNodes=nextNodes,++x;(function moveSinksRight(x){nodes.forEach(function(node){node.sourceLinks.length||(node.x=x-1)})})(x),function scaleNodeBreadths(kx){nodes.forEach(function(node){node.x*=kx})}((size[0]-nodeWidth)/(x-1))}(),function computeNodeDepths(iterations){var nodesByBreadth=d3Collection.nest().key(function(d){return d.x}).sortKeys(d3Array.ascending).entries(nodes).map(function(d){return d.values});(function initializeNodeDepth(){var ky=d3Array.min(nodesByBreadth,function(nodes){return(size[1]-(nodes.length-1)*nodePadding)/d3Array.sum(nodes,value)});nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node,i){node.y=i,node.dy=node.value*ky})}),links.forEach(function(link){link.dy=link.value*ky})})(),resolveCollisions();for(var alpha=1;iterations>0;--iterations)relaxRightToLeft(alpha*=.99),resolveCollisions(),relaxLeftToRight(alpha),resolveCollisions();function relaxLeftToRight(alpha){function weightedSource(link){return center(link.source)*link.value}nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node){if(node.targetLinks.length){var y=d3Array.sum(node.targetLinks,weightedSource)/d3Array.sum(node.targetLinks,value);node.y+=(y-center(node))*alpha}})})}function relaxRightToLeft(alpha){function weightedTarget(link){return center(link.target)*link.value}nodesByBreadth.slice().reverse().forEach(function(nodes){nodes.forEach(function(node){if(node.sourceLinks.length){var y=d3Array.sum(node.sourceLinks,weightedTarget)/d3Array.sum(node.sourceLinks,value);node.y+=(y-center(node))*alpha}})})}function resolveCollisions(){nodesByBreadth.forEach(function(nodes){var node,dy,i,y0=0,n=nodes.length;for(nodes.sort(ascendingDepth),i=0;i<n;++i)node=nodes[i],(dy=y0-node.y)>0&&(node.y+=dy),y0=node.y+node.dy+nodePadding;if((dy=y0-nodePadding-size[1])>0)for(y0=node.y-=dy,i=n-2;i>=0;--i)node=nodes[i],(dy=node.y+node.dy+nodePadding-y0)>0&&(node.y-=dy),y0=node.y})}function ascendingDepth(a,b){return a.y-b.y}}(iterations),computeLinkDepths(),sankey},sankey.relayout=function(){return computeLinkDepths(),sankey},sankey.link=function(){var curvature=.5;function link(d){var x0=d.source.x+d.source.dx,x1=d.target.x,xi=d3Interpolate.interpolateNumber(x0,x1),x2=xi(curvature),x3=xi(1-curvature),y0a=d.source.y+d.sy,y0b=y0a+d.dy,y1a=d.target.y+d.ty,y1b=y1a+d.dy;return"M"+x0+","+y0a+"C"+x2+","+y0a+" "+x3+","+y1a+" "+x1+","+y1a+"L"+x1+","+y1b+"C"+x3+","+y1b+" "+x2+","+y0b+" "+x0+","+y0b+"Z"}return link.curvature=function(_){return arguments.length?(curvature=+_,link):curvature},link},sankey},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports,_dereq_("d3-array"),_dereq_("d3-collection"),_dereq_("d3-interpolate")):factory(global.d3=global.d3||{},global.d3,global.d3,global.d3)},{"d3-array":139,"d3-collection":140,"d3-interpolate":144}],46:[function(_dereq_,module,exports){"use strict";var weakMap="undefined"==typeof WeakMap?_dereq_("weak-map"):WeakMap,createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),TriangleCache=new weakMap;module.exports=function createABigTriangle(gl){var triangleVAO=TriangleCache.get(gl),handle=triangleVAO&&(triangleVAO._triangleBuffer.handle||triangleVAO._triangleBuffer.buffer);if(!handle||!gl.isBuffer(handle)){var buf=createBuffer(gl,new Float32Array([-1,-1,-1,4,4,-1]));(triangleVAO=createVAO(gl,[{buffer:buf,type:gl.FLOAT,size:2}]))._triangleBuffer=buf,TriangleCache.set(gl,triangleVAO)}triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3),triangleVAO.unbind()}},{"gl-buffer":229,"gl-vao":308,"weak-map":526}],47:[function(_dereq_,module,exports){module.exports=function absolutize(path){var startX=0,startY=0,x=0,y=0;return path.map(function(seg){var type=(seg=seg.slice())[0],command=type.toUpperCase();if(type!=command)switch(seg[0]=command,type){case"a":seg[6]+=x,seg[7]+=y;break;case"v":seg[1]+=y;break;case"h":seg[1]+=x;break;default:for(var i=1;i<seg.length;)seg[i++]+=x,seg[i++]+=y}switch(command){case"Z":x=startX,y=startY;break;case"H":x=seg[1];break;case"V":y=seg[1];break;case"M":x=startX=seg[1],y=startY=seg[2];break;default:x=seg[seg.length-2],y=seg[seg.length-1]}return seg})}},{}],48:[function(_dereq_,module,exports){var padLeft=_dereq_("pad-left");module.exports=function addLineNumbers(string,start,delim){start="number"==typeof start?start:1,delim=delim||": ";var lines=string.split(/\r?\n/),totalDigits=String(lines.length+start-1).length;return lines.map(function(line,i){var c=i+start,digits=String(c).length,prefix=padLeft(c,totalDigits-digits);return prefix+delim+line}).join("\n")}},{"pad-left":437}],49:[function(_dereq_,module,exports){"use strict";module.exports=function affineHull(points){var n=points.length;if(0===n)return[];if(1===n)return[0];for(var d=points[0].length,frame=[points[0]],index=[0],i=1;i<n;++i)if(frame.push(points[i]),linearlyIndependent(frame,d)){if(index.push(i),index.length===d+1)return index}else frame.pop();return index};var orient=_dereq_("robust-orientation");function linearlyIndependent(points,d){for(var nhull=new Array(d+1),i=0;i<points.length;++i)nhull[i]=points[i];for(i=0;i<=points.length;++i){for(var j=points.length;j<=d;++j){for(var x=new Array(d),k=0;k<d;++k)x[k]=Math.pow(j+1-i,k);nhull[j]=x}if(orient.apply(void 0,nhull))return!0}return!1}},{"robust-orientation":483}],50:[function(_dereq_,module,exports){"use strict";module.exports=function alphaComplex(alpha,points){return delaunay(points).filter(function(cell){for(var simplex=new Array(cell.length),i=0;i<cell.length;++i)simplex[i]=points[cell[i]];return circumradius(simplex)*alpha<1})};var delaunay=_dereq_("delaunay-triangulate"),circumradius=_dereq_("circumradius")},{circumradius:101,"delaunay-triangulate":149}],51:[function(_dereq_,module,exports){module.exports=function alphaShape(alpha,points){return bnd(ac(alpha,points))};var ac=_dereq_("alpha-complex"),bnd=_dereq_("simplicial-complex-boundary")},{"alpha-complex":50,"simplicial-complex-boundary":490}],52:[function(_dereq_,module,exports){"use strict";module.exports=function normalize(arr,dim){if(!arr||null==arr.length)throw Error("Argument should be an array");dim=null==dim?1:Math.floor(dim);for(var bounds=Array(2*dim),offset=0;offset<dim;offset++){for(var max=-1/0,min=1/0,i=offset,l=arr.length;i<l;i+=dim)arr[i]>max&&(max=arr[i]),arr[i]<min&&(min=arr[i]);bounds[offset]=min,bounds[dim+offset]=max}return bounds}},{}],53:[function(_dereq_,module,exports){"use strict";var getBounds=_dereq_("array-bounds");module.exports=function normalize(arr,dim,bounds){if(!arr||null==arr.length)throw Error("Argument should be an array");null==dim&&(dim=1);null==bounds&&(bounds=getBounds(arr,dim));for(var offset=0;offset<dim;offset++){var max=bounds[dim+offset],min=bounds[offset],i=offset,l=arr.length;if(max===1/0&&min===-1/0)for(i=offset;i<l;i+=dim)arr[i]=arr[i]===max?1:arr[i]===min?0:.5;else if(max===1/0)for(i=offset;i<l;i+=dim)arr[i]=arr[i]===max?1:0;else if(min===-1/0)for(i=offset;i<l;i+=dim)arr[i]=arr[i]===min?0:1;else{var range=max-min;for(i=offset;i<l;i+=dim)arr[i]=0===range?.5:(arr[i]-min)/range}}return arr}},{"array-bounds":52}],54:[function(_dereq_,module,exports){module.exports=function newArray(start,end){var n0="number"==typeof start,n1="number"==typeof end;n0&&!n1?(end=start,start=0):n0||n1||(start=0,end=0);var len=(end|=0)-(start|=0);if(len<0)throw new Error("array length must be positive");for(var a=new Array(len),i=0,c=start;i<len;i++,c++)a[i]=c;return a}},{}],55:[function(_dereq_,module,exports){(function(global){"use strict";function compare(a,b){if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0}function isBuffer(b){return global.Buffer&&"function"==typeof global.Buffer.isBuffer?global.Buffer.isBuffer(b):!(null==b||!b._isBuffer)}var util=_dereq_("util/"),hasOwn=Object.prototype.hasOwnProperty,pSlice=Array.prototype.slice,functionsHaveNames="foo"===function foo(){}.name;function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){return!isBuffer(arrbuf)&&("function"==typeof global.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(arrbuf):!!arrbuf&&(arrbuf instanceof DataView||!!(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer))))}var assert=module.exports=ok,regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(util.isFunction(func)){if(functionsHaveNames)return func.name;var match=func.toString().match(regex);return match&&match[1]}}function truncate(s,n){return"string"==typeof s?s.length<n?s:s.slice(0,n):s}function inspect(something){if(functionsHaveNames||!util.isFunction(something))return util.inspect(something);var rawname=getName(something);return"[Function"+(rawname?": "+rawname:"")+"]"}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected,strict,memos){if(actual===expected)return!0;if(isBuffer(actual)&&isBuffer(expected))return 0===compare(actual,expected);if(util.isDate(actual)&&util.isDate(expected))return actual.getTime()===expected.getTime();if(util.isRegExp(actual)&&util.isRegExp(expected))return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase;if(null!==actual&&"object"==typeof actual||null!==expected&&"object"==typeof expected){if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array))return 0===compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer));if(isBuffer(actual)!==isBuffer(expected))return!1;var actualIndex=(memos=memos||{actual:[],expected:[]}).actual.indexOf(actual);return-1!==actualIndex&&actualIndex===memos.expected.indexOf(expected)||(memos.actual.push(actual),memos.expected.push(expected),function objEquiv(a,b,strict,actualVisitedObjects){if(null===a||void 0===a||null===b||void 0===b)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b,strict);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return!1;return!0}(actual,expected,strict,memos))}return strict?actual===expected:actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function expectedException(actual,expected){if(!actual||!expected)return!1;if("[object RegExp]"==Object.prototype.toString.call(expected))return expected.test(actual);try{if(actual instanceof expected)return!0}catch(e){}return!Error.isPrototypeOf(expected)&&!0===expected.call({},actual)}function _throws(shouldThrow,block,expected,message){var actual;if("function"!=typeof block)throw new TypeError('"block" argument must be a function');"string"==typeof expected&&(message=expected,expected=null),actual=function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}(block),message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message);var userProvidedMessage="string"==typeof message,isUnwantedException=!shouldThrow&&util.isError(actual),isUnexpectedException=!shouldThrow&&actual&&!expected;if((isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}assert.AssertionError=function AssertionError(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=getName(stackStartFunction),idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function equal(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function notEqual(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function deepEqual(actual,expected,message){_deepEqual(actual,expected,!1)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){_deepEqual(actual,expected,!0)||fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)},assert.notDeepEqual=function notDeepEqual(actual,expected,message){_deepEqual(actual,expected,!1)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.notDeepStrictEqual=function notDeepStrictEqual(actual,expected,message){_deepEqual(actual,expected,!0)&&fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)},assert.strictEqual=function strictEqual(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function notStrictEqual(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(block,error,message){_throws(!0,block,error,message)},assert.doesNotThrow=function(block,error,message){_throws(!1,block,error,message)},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":58}],56:[function(_dereq_,module,exports){"function"==typeof Object.create?module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],57:[function(_dereq_,module,exports){module.exports=function isBuffer(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],58:[function(_dereq_,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}i=1;for(var args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}};var debugEnviron,debugs={};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var output,base="",array=!1,braces=["{","}"];(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value))&&(base=" [Function"+(value.name?": "+value.name:"")+"]");return isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0!==keys.length||array&&0!=value.length?recurseTimes<0?isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special"):(ctx.seen.push(value),output=array?function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),function reduceToSingleString(output,base,braces){if(output.reduce(function(prev,cur){return 0,cur.indexOf("\n")>=0&&0,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1];return braces[0]+base+" "+output.join(", ")+" "+braces[1]}(output,base,braces)):braces[0]+base+braces[1]}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if((desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]}).get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=function isNullOrUndefined(arg){return null==arg},exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=function isSymbol(arg){return"symbol"==typeof arg},exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=_dereq_("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.log=function(){console.log("%s - %s",function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}(),exports.format.apply(exports,arguments))},exports.inherits=_dereq_("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,_dereq_("_process"),void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":57,_process:462,inherits:56}],59:[function(_dereq_,module,exports){module.exports=function _atob(str){return atob(str)}},{}],60:[function(_dereq_,module,exports){"use strict";module.exports=function barycentric(simplex,point){for(var d=point.length,A=new Array(d+1),i=0;i<d;++i){for(var row=new Array(d+1),j=0;j<=d;++j)row[j]=simplex[j][i];A[i]=row}A[d]=new Array(d+1);for(var i=0;i<=d;++i)A[d][i]=1;for(var b=new Array(d+1),i=0;i<d;++i)b[i]=point[i];b[d]=1;var x=solve(A,b),w=reduce(x[d+1]);0===w&&(w=1);for(var y=new Array(d+1),i=0;i<=d;++i)y[i]=reduce(x[i])/w;return y};var solve=_dereq_("robust-linear-solve");function reduce(x){for(var r=0,i=0;i<x.length;++i)r+=x[i];return r}},{"robust-linear-solve":482}],61:[function(_dereq_,module,exports){"use strict";exports.byteLength=function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function toByteArray(b64){for(var tmp,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen,i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],62:[function(_dereq_,module,exports){"use strict";var rationalize=_dereq_("./lib/rationalize");module.exports=function add(a,b){return rationalize(a[0].mul(b[1]).add(b[0].mul(a[1])),a[1].mul(b[1]))}},{"./lib/rationalize":72}],63:[function(_dereq_,module,exports){"use strict";module.exports=function cmp(a,b){return a[0].mul(b[1]).cmp(b[0].mul(a[1]))}},{}],64:[function(_dereq_,module,exports){"use strict";var rationalize=_dereq_("./lib/rationalize");module.exports=function div(a,b){return rationalize(a[0].mul(b[1]),a[1].mul(b[0]))}},{"./lib/rationalize":72}],65:[function(_dereq_,module,exports){"use strict";var isRat=_dereq_("./is-rat"),isBN=_dereq_("./lib/is-bn"),num2bn=_dereq_("./lib/num-to-bn"),str2bn=_dereq_("./lib/str-to-bn"),rationalize=_dereq_("./lib/rationalize"),div=_dereq_("./div");module.exports=function makeRational(numer,denom){if(isRat(numer))return denom?div(numer,makeRational(denom)):[numer[0].clone(),numer[1].clone()];var shift=0;var a,b;if(isBN(numer))a=numer.clone();else if("string"==typeof numer)a=str2bn(numer);else{if(0===numer)return[num2bn(0),num2bn(1)];if(numer===Math.floor(numer))a=num2bn(numer);else{for(;numer!==Math.floor(numer);)numer*=Math.pow(2,256),shift-=256;a=num2bn(numer)}}if(isRat(denom))a.mul(denom[1]),b=denom[0].clone();else if(isBN(denom))b=denom.clone();else if("string"==typeof denom)b=str2bn(denom);else if(denom)if(denom===Math.floor(denom))b=num2bn(denom);else{for(;denom!==Math.floor(denom);)denom*=Math.pow(2,256),shift+=256;b=num2bn(denom)}else b=num2bn(1);shift>0?a=a.ushln(shift):shift<0&&(b=b.ushln(-shift));return rationalize(a,b)}},{"./div":64,"./is-rat":66,"./lib/is-bn":70,"./lib/num-to-bn":71,"./lib/rationalize":72,"./lib/str-to-bn":73}],66:[function(_dereq_,module,exports){"use strict";var isBN=_dereq_("./lib/is-bn");module.exports=function isRat(x){return Array.isArray(x)&&2===x.length&&isBN(x[0])&&isBN(x[1])}},{"./lib/is-bn":70}],67:[function(_dereq_,module,exports){"use strict";var BN=_dereq_("bn.js");module.exports=function sign(x){return x.cmp(new BN(0))}},{"bn.js":81}],68:[function(_dereq_,module,exports){"use strict";var sign=_dereq_("./bn-sign");module.exports=function bn2num(b){var l=b.length,words=b.words,out=0;if(1===l)out=words[0];else if(2===l)out=words[0]+67108864*words[1];else for(var i=0;i<l;i++){var w=words[i];out+=w*Math.pow(67108864,i)}return sign(b)*out}},{"./bn-sign":67}],69:[function(_dereq_,module,exports){"use strict";var db=_dereq_("double-bits"),ctz=_dereq_("bit-twiddle").countTrailingZeros;module.exports=function ctzNumber(x){var l=ctz(db.lo(x));if(l<32)return l;var h=ctz(db.hi(x));if(h>20)return 52;return h+32}},{"bit-twiddle":79,"double-bits":151}],70:[function(_dereq_,module,exports){"use strict";_dereq_("bn.js");module.exports=function isBN(x){return x&&"object"==typeof x&&Boolean(x.words)}},{"bn.js":81}],71:[function(_dereq_,module,exports){"use strict";var BN=_dereq_("bn.js"),db=_dereq_("double-bits");module.exports=function num2bn(x){var e=db.exponent(x);return e<52?new BN(x):new BN(x*Math.pow(2,52-e)).ushln(e-52)}},{"bn.js":81,"double-bits":151}],72:[function(_dereq_,module,exports){"use strict";var num2bn=_dereq_("./num-to-bn"),sign=_dereq_("./bn-sign");module.exports=function rationalize(numer,denom){var snumer=sign(numer),sdenom=sign(denom);if(0===snumer)return[num2bn(0),num2bn(1)];if(0===sdenom)return[num2bn(0),num2bn(0)];sdenom<0&&(numer=numer.neg(),denom=denom.neg());var d=numer.gcd(denom);if(d.cmpn(1))return[numer.div(d),denom.div(d)];return[numer,denom]}},{"./bn-sign":67,"./num-to-bn":71}],73:[function(_dereq_,module,exports){"use strict";var BN=_dereq_("bn.js");module.exports=function str2BN(x){return new BN(x)}},{"bn.js":81}],74:[function(_dereq_,module,exports){"use strict";var rationalize=_dereq_("./lib/rationalize");module.exports=function mul(a,b){return rationalize(a[0].mul(b[0]),a[1].mul(b[1]))}},{"./lib/rationalize":72}],75:[function(_dereq_,module,exports){"use strict";var bnsign=_dereq_("./lib/bn-sign");module.exports=function sign(x){return bnsign(x[0])*bnsign(x[1])}},{"./lib/bn-sign":67}],76:[function(_dereq_,module,exports){"use strict";var rationalize=_dereq_("./lib/rationalize");module.exports=function sub(a,b){return rationalize(a[0].mul(b[1]).sub(a[1].mul(b[0])),a[1].mul(b[1]))}},{"./lib/rationalize":72}],77:[function(_dereq_,module,exports){"use strict";var bn2num=_dereq_("./lib/bn-to-num"),ctz=_dereq_("./lib/ctz");module.exports=function roundRat(f){var a=f[0],b=f[1];if(0===a.cmpn(0))return 0;var h=a.abs().divmod(b.abs()),iv=h.div,x=bn2num(iv),ir=h.mod,sgn=a.negative!==b.negative?-1:1;if(0===ir.cmpn(0))return sgn*x;if(x){var s=ctz(x)+4,y=bn2num(ir.ushln(s).divRound(b));return sgn*(x+y*Math.pow(2,-s))}var ybits=b.bitLength()-ir.bitLength()+53,y=bn2num(ir.ushln(ybits).divRound(b));return ybits<1023?sgn*y*Math.pow(2,-ybits):(y*=Math.pow(2,-1023),sgn*y*Math.pow(2,1023-ybits))}},{"./lib/bn-to-num":68,"./lib/ctz":69}],78:[function(_dereq_,module,exports){"use strict";function compileSearch(funcName,predicate,reversed,extraArgs,useNdarray,earlyOut){var code=["function ",funcName,"(a,l,h,",extraArgs.join(","),"){",earlyOut?"":"var i=",reversed?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",useNdarray?".get(m)":"[m]"];return earlyOut?predicate.indexOf("c")<0?code.push(";if(x===y){return m}else if(x<=y){"):code.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):code.push(";if(",predicate,"){i=m;"),reversed?code.push("l=m+1}else{h=m-1}"):code.push("h=m-1}else{l=m+1}"),code.push("}"),earlyOut?code.push("return -1};"):code.push("return i};"),code.join("")}function compileBoundsSearch(predicate,reversed,suffix,earlyOut){return new Function([compileSearch("A","x"+predicate+"y",reversed,["y"],!1,earlyOut),compileSearch("B","x"+predicate+"y",reversed,["y"],!0,earlyOut),compileSearch("P","c(x,y)"+predicate+"0",reversed,["y","c"],!1,earlyOut),compileSearch("Q","c(x,y)"+predicate+"0",reversed,["y","c"],!0,earlyOut),"function dispatchBsearch",suffix,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",suffix].join(""))()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)}},{}],79:[function(_dereq_,module,exports){"use strict";"use restrict";function countTrailingZeros(v){var c=32;return(v&=-v)&&c--,65535&v&&(c-=16),16711935&v&&(c-=8),252645135&v&&(c-=4),858993459&v&&(c-=2),1431655765&v&&(c-=1),c}exports.INT_BITS=32,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<31,exports.sign=function(v){return(v>0)-(v<0)},exports.abs=function(v){var mask=v>>31;return(v^mask)-mask},exports.min=function(x,y){return y^(x^y)&-(x<y)},exports.max=function(x,y){return x^(x^y)&-(x<y)},exports.isPow2=function(v){return!(v&v-1||!v)},exports.log2=function(v){var r,shift;return r=(v>65535)<<4,r|=shift=((v>>>=r)>255)<<3,r|=shift=((v>>>=shift)>15)<<2,(r|=shift=((v>>>=shift)>3)<<1)|(v>>>=shift)>>1},exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},exports.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},exports.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},exports.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var REVERSE_TABLE=new Array(256);!function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1)r<<=1,r|=1&v,--s;tab[i]=r<<s&255}}(REVERSE_TABLE),exports.reverse=function(v){return REVERSE_TABLE[255&v]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]},exports.interleave2=function(x,y){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},exports.deinterleave2=function(v,n){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>n&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},exports.interleave3=function(x,y,z){return x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2),(x|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<2},exports.deinterleave3=function(v,n){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>n&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],80:[function(_dereq_,module,exports){"use strict";var clamp=_dereq_("clamp");module.exports=function calcSDF(src,options){options||(options={});var w,h,size,data,intData,stride,ctx,canvas,imgData,i,l,cutoff=null==options.cutoff?.25:options.cutoff,radius=null==options.radius?8:options.radius,channel=options.channel||0;if(ArrayBuffer.isView(src)||Array.isArray(src)){if(!options.width||!options.height)throw Error("For raw data width and height should be provided by options");w=options.width,h=options.height,data=src,stride=options.stride?options.stride:Math.floor(src.length/w/h)}else window.HTMLCanvasElement&&src instanceof window.HTMLCanvasElement?(ctx=(canvas=src).getContext("2d"),w=canvas.width,h=canvas.height,imgData=ctx.getImageData(0,0,w,h),data=imgData.data,stride=4):window.CanvasRenderingContext2D&&src instanceof window.CanvasRenderingContext2D?(canvas=src.canvas,ctx=src,w=canvas.width,h=canvas.height,imgData=ctx.getImageData(0,0,w,h),data=imgData.data,stride=4):window.ImageData&&src instanceof window.ImageData&&(imgData=src,w=src.width,h=src.height,data=imgData.data,stride=4);if(size=Math.max(w,h),window.Uint8ClampedArray&&data instanceof window.Uint8ClampedArray||window.Uint8Array&&data instanceof window.Uint8Array)for(intData=data,data=Array(w*h),i=0,l=intData.length;i<l;i++)data[i]=intData[i*stride+channel]/255;else if(1!==stride)throw Error("Raw data can have only 1 value per pixel");var gridOuter=Array(w*h),gridInner=Array(w*h),f=Array(size),d=Array(size),z=Array(size+1),v=Array(size);for(i=0,l=w*h;i<l;i++){var a=data[i];gridOuter[i]=1===a?0:0===a?INF:Math.pow(Math.max(0,.5-a),2),gridInner[i]=1===a?INF:0===a?0:Math.pow(Math.max(0,a-.5),2)}edt(gridOuter,w,h,f,d,v,z),edt(gridInner,w,h,f,d,v,z);var dist=window.Float32Array?new Float32Array(w*h):new Array(w*h);for(i=0,l=w*h;i<l;i++)dist[i]=clamp(1-((gridOuter[i]-gridInner[i])/radius+cutoff),0,1);return dist};var INF=1e20;function edt(data,width,height,f,d,v,z){for(var x=0;x<width;x++){for(var y=0;y<height;y++)f[y]=data[y*width+x];for(edt1d(f,d,v,z,height),y=0;y<height;y++)data[y*width+x]=d[y]}for(y=0;y<height;y++){for(x=0;x<width;x++)f[x]=data[y*width+x];for(edt1d(f,d,v,z,width),x=0;x<width;x++)data[y*width+x]=Math.sqrt(d[x])}}function edt1d(f,d,v,z,n){v[0]=0,z[0]=-INF,z[1]=+INF;for(var q=1,k=0;q<n;q++){for(var s=(f[q]+q*q-(f[v[k]]+v[k]*v[k]))/(2*q-2*v[k]);s<=z[k];)k--,s=(f[q]+q*q-(f[v[k]]+v[k]*v[k]))/(2*q-2*v[k]);v[++k]=q,z[k]=s,z[k+1]=+INF}for(q=0,k=0;q<n;q++){for(;z[k+1]<q;)k++;d[q]=(q-v[k])*(q-v[k])+f[v[k]]}}},{clamp:102}],81:[function(_dereq_,module,exports){!function(module,exports){"use strict";function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}function BN(number,base,endian){if(BN.isBN(number))return number;this.negative=0,this.words=null,this.length=0,this.red=null,null!==number&&("le"!==base&&"be"!==base||(endian=base,base=10),this._init(number||0,base||10,endian||"be"))}var Buffer;"object"==typeof module?module.exports=BN:exports.BN=BN,BN.BN=BN,BN.wordSize=26;try{Buffer=_dereq_("buffer").Buffer}catch(e){}function parseHex(str,start,end){for(var r=0,len=Math.min(str.length,end),i=start;i<len;i++){var c=str.charCodeAt(i)-48;r<<=4,r|=c>=49&&c<=54?c-49+10:c>=17&&c<=22?c-17+10:15&c}return r}function parseBase(str,start,end,mul){for(var r=0,len=Math.min(str.length,end),i=start;i<len;i++){var c=str.charCodeAt(i)-48;r*=mul,r+=c>=49?c-49+10:c>=17?c-17+10:c}return r}BN.isBN=function isBN(num){return num instanceof BN||null!==num&&"object"==typeof num&&num.constructor.wordSize===BN.wordSize&&Array.isArray(num.words)},BN.max=function max(left,right){return left.cmp(right)>0?left:right},BN.min=function min(left,right){return left.cmp(right)<0?left:right},BN.prototype._init=function init(number,base,endian){if("number"==typeof number)return this._initNumber(number,base,endian);if("object"==typeof number)return this._initArray(number,base,endian);"hex"===base&&(base=16),assert(base===(0|base)&&base>=2&&base<=36);var start=0;"-"===(number=number.toString().replace(/\s+/g,""))[0]&&start++,16===base?this._parseHex(number,start):this._parseBase(number,base,start),"-"===number[0]&&(this.negative=1),this.strip(),"le"===endian&&this._initArray(this.toArray(),base,endian)},BN.prototype._initNumber=function _initNumber(number,base,endian){number<0&&(this.negative=1,number=-number),number<67108864?(this.words=[67108863&number],this.length=1):number<4503599627370496?(this.words=[67108863&number,number/67108864&67108863],this.length=2):(assert(number<9007199254740992),this.words=[67108863&number,number/67108864&67108863,1],this.length=3),"le"===endian&&this._initArray(this.toArray(),base,endian)},BN.prototype._initArray=function _initArray(number,base,endian){if(assert("number"==typeof number.length),number.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(number.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var j,w,off=0;if("be"===endian)for(i=number.length-1,j=0;i>=0;i-=3)w=number[i]|number[i-1]<<8|number[i-2]<<16,this.words[j]|=w<<off&67108863,this.words[j+1]=w>>>26-off&67108863,(off+=24)>=26&&(off-=26,j++);else if("le"===endian)for(i=0,j=0;i<number.length;i+=3)w=number[i]|number[i+1]<<8|number[i+2]<<16,this.words[j]|=w<<off&67108863,this.words[j+1]=w>>>26-off&67108863,(off+=24)>=26&&(off-=26,j++);return this.strip()},BN.prototype._parseHex=function _parseHex(number,start){this.length=Math.ceil((number.length-start)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var j,w,off=0;for(i=number.length-6,j=0;i>=start;i-=6)w=parseHex(number,i,i+6),this.words[j]|=w<<off&67108863,this.words[j+1]|=w>>>26-off&4194303,(off+=24)>=26&&(off-=26,j++);i+6!==start&&(w=parseHex(number,start,i+6),this.words[j]|=w<<off&67108863,this.words[j+1]|=w>>>26-off&4194303),this.strip()},BN.prototype._parseBase=function _parseBase(number,base,start){this.words=[0],this.length=1;for(var limbLen=0,limbPow=1;limbPow<=67108863;limbPow*=base)limbLen++;limbLen--,limbPow=limbPow/base|0;for(var total=number.length-start,mod=total%limbLen,end=Math.min(total,total-mod)+start,word=0,i=start;i<end;i+=limbLen)word=parseBase(number,i,i+limbLen,base),this.imuln(limbPow),this.words[0]+word<67108864?this.words[0]+=word:this._iaddn(word);if(0!==mod){var pow=1;for(word=parseBase(number,i,number.length,base),i=0;i<mod;i++)pow*=base;this.imuln(pow),this.words[0]+word<67108864?this.words[0]+=word:this._iaddn(word)}},BN.prototype.copy=function copy(dest){dest.words=new Array(this.length);for(var i=0;i<this.length;i++)dest.words[i]=this.words[i];dest.length=this.length,dest.negative=this.negative,dest.red=this.red},BN.prototype.clone=function clone(){var r=new BN(null);return this.copy(r),r},BN.prototype._expand=function _expand(size){for(;this.length<size;)this.words[this.length++]=0;return this},BN.prototype.strip=function strip(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},BN.prototype._normSign=function _normSign(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},BN.prototype.inspect=function inspect(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var zeros=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function smallMulTo(self,num,out){out.negative=num.negative^self.negative;var len=self.length+num.length|0;out.length=len,len=len-1|0;var a=0|self.words[0],b=0|num.words[0],r=a*b,lo=67108863&r,carry=r/67108864|0;out.words[0]=lo;for(var k=1;k<len;k++){for(var ncarry=carry>>>26,rword=67108863&carry,maxJ=Math.min(k,num.length-1),j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j|0;ncarry+=(r=(a=0|self.words[i])*(b=0|num.words[j])+rword)/67108864|0,rword=67108863&r}out.words[k]=0|rword,carry=0|ncarry}return 0!==carry?out.words[k]=0|carry:out.length--,out.strip()}BN.prototype.toString=function toString(base,padding){var out;if(base=base||10,padding=0|padding||1,16===base||"hex"===base){out="";for(var off=0,carry=0,i=0;i<this.length;i++){var w=this.words[i],word=(16777215&(w<<off|carry)).toString(16);out=0!==(carry=w>>>24-off&16777215)||i!==this.length-1?zeros[6-word.length]+word+out:word+out,(off+=2)>=26&&(off-=26,i--)}for(0!==carry&&(out=carry.toString(16)+out);out.length%padding!=0;)out="0"+out;return 0!==this.negative&&(out="-"+out),out}if(base===(0|base)&&base>=2&&base<=36){var groupSize=groupSizes[base],groupBase=groupBases[base];out="";var c=this.clone();for(c.negative=0;!c.isZero();){var r=c.modn(groupBase).toString(base);out=(c=c.idivn(groupBase)).isZero()?r+out:zeros[groupSize-r.length]+r+out}for(this.isZero()&&(out="0"+out);out.length%padding!=0;)out="0"+out;return 0!==this.negative&&(out="-"+out),out}assert(!1,"Base should be between 2 and 36")},BN.prototype.toNumber=function toNumber(){var ret=this.words[0];return 2===this.length?ret+=67108864*this.words[1]:3===this.length&&1===this.words[2]?ret+=4503599627370496+67108864*this.words[1]:this.length>2&&assert(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-ret:ret},BN.prototype.toJSON=function toJSON(){return this.toString(16)},BN.prototype.toBuffer=function toBuffer(endian,length){return assert(void 0!==Buffer),this.toArrayLike(Buffer,endian,length)},BN.prototype.toArray=function toArray(endian,length){return this.toArrayLike(Array,endian,length)},BN.prototype.toArrayLike=function toArrayLike(ArrayType,endian,length){var byteLength=this.byteLength(),reqLength=length||Math.max(1,byteLength);assert(byteLength<=reqLength,"byte array longer than desired length"),assert(reqLength>0,"Requested array length <= 0"),this.strip();var b,i,littleEndian="le"===endian,res=new ArrayType(reqLength),q=this.clone();if(littleEndian){for(i=0;!q.isZero();i++)b=q.andln(255),q.iushrn(8),res[i]=b;for(;i<reqLength;i++)res[i]=0}else{for(i=0;i<reqLength-byteLength;i++)res[i]=0;for(i=0;!q.isZero();i++)b=q.andln(255),q.iushrn(8),res[reqLength-i-1]=b}return res},Math.clz32?BN.prototype._countBits=function _countBits(w){return 32-Math.clz32(w)}:BN.prototype._countBits=function _countBits(w){var t=w,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},BN.prototype._zeroBits=function _zeroBits(w){if(0===w)return 26;var t=w,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},BN.prototype.bitLength=function bitLength(){var w=this.words[this.length-1],hi=this._countBits(w);return 26*(this.length-1)+hi},BN.prototype.zeroBits=function zeroBits(){if(this.isZero())return 0;for(var r=0,i=0;i<this.length;i++){var b=this._zeroBits(this.words[i]);if(r+=b,26!==b)break}return r},BN.prototype.byteLength=function byteLength(){return Math.ceil(this.bitLength()/8)},BN.prototype.toTwos=function toTwos(width){return 0!==this.negative?this.abs().inotn(width).iaddn(1):this.clone()},BN.prototype.fromTwos=function fromTwos(width){return this.testn(width-1)?this.notn(width).iaddn(1).ineg():this.clone()},BN.prototype.isNeg=function isNeg(){return 0!==this.negative},BN.prototype.neg=function neg(){return this.clone().ineg()},BN.prototype.ineg=function ineg(){return this.isZero()||(this.negative^=1),this},BN.prototype.iuor=function iuor(num){for(;this.length<num.length;)this.words[this.length++]=0;for(var i=0;i<num.length;i++)this.words[i]=this.words[i]|num.words[i];return this.strip()},BN.prototype.ior=function ior(num){return assert(0==(this.negative|num.negative)),this.iuor(num)},BN.prototype.or=function or(num){return this.length>num.length?this.clone().ior(num):num.clone().ior(this)},BN.prototype.uor=function uor(num){return this.length>num.length?this.clone().iuor(num):num.clone().iuor(this)},BN.prototype.iuand=function iuand(num){var b;b=this.length>num.length?num:this;for(var i=0;i<b.length;i++)this.words[i]=this.words[i]&num.words[i];return this.length=b.length,this.strip()},BN.prototype.iand=function iand(num){return assert(0==(this.negative|num.negative)),this.iuand(num)},BN.prototype.and=function and(num){return this.length>num.length?this.clone().iand(num):num.clone().iand(this)},BN.prototype.uand=function uand(num){return this.length>num.length?this.clone().iuand(num):num.clone().iuand(this)},BN.prototype.iuxor=function iuxor(num){var a,b;this.length>num.length?(a=this,b=num):(a=num,b=this);for(var i=0;i<b.length;i++)this.words[i]=a.words[i]^b.words[i];if(this!==a)for(;i<a.length;i++)this.words[i]=a.words[i];return this.length=a.length,this.strip()},BN.prototype.ixor=function ixor(num){return assert(0==(this.negative|num.negative)),this.iuxor(num)},BN.prototype.xor=function xor(num){return this.length>num.length?this.clone().ixor(num):num.clone().ixor(this)},BN.prototype.uxor=function uxor(num){return this.length>num.length?this.clone().iuxor(num):num.clone().iuxor(this)},BN.prototype.inotn=function inotn(width){assert("number"==typeof width&&width>=0);var bytesNeeded=0|Math.ceil(width/26),bitsLeft=width%26;this._expand(bytesNeeded),bitsLeft>0&&bytesNeeded--;for(var i=0;i<bytesNeeded;i++)this.words[i]=67108863&~this.words[i];return bitsLeft>0&&(this.words[i]=~this.words[i]&67108863>>26-bitsLeft),this.strip()},BN.prototype.notn=function notn(width){return this.clone().inotn(width)},BN.prototype.setn=function setn(bit,val){assert("number"==typeof bit&&bit>=0);var off=bit/26|0,wbit=bit%26;return this._expand(off+1),this.words[off]=val?this.words[off]|1<<wbit:this.words[off]&~(1<<wbit),this.strip()},BN.prototype.iadd=function iadd(num){var r,a,b;if(0!==this.negative&&0===num.negative)return this.negative=0,r=this.isub(num),this.negative^=1,this._normSign();if(0===this.negative&&0!==num.negative)return num.negative=0,r=this.isub(num),num.negative=1,r._normSign();this.length>num.length?(a=this,b=num):(a=num,b=this);for(var carry=0,i=0;i<b.length;i++)r=(0|a.words[i])+(0|b.words[i])+carry,this.words[i]=67108863&r,carry=r>>>26;for(;0!==carry&&i<a.length;i++)r=(0|a.words[i])+carry,this.words[i]=67108863&r,carry=r>>>26;if(this.length=a.length,0!==carry)this.words[this.length]=carry,this.length++;else if(a!==this)for(;i<a.length;i++)this.words[i]=a.words[i];return this},BN.prototype.add=function add(num){var res;return 0!==num.negative&&0===this.negative?(num.negative=0,res=this.sub(num),num.negative^=1,res):0===num.negative&&0!==this.negative?(this.negative=0,res=num.sub(this),this.negative=1,res):this.length>num.length?this.clone().iadd(num):num.clone().iadd(this)},BN.prototype.isub=function isub(num){if(0!==num.negative){num.negative=0;var r=this.iadd(num);return num.negative=1,r._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(num),this.negative=1,this._normSign();var a,b,cmp=this.cmp(num);if(0===cmp)return this.negative=0,this.length=1,this.words[0]=0,this;cmp>0?(a=this,b=num):(a=num,b=this);for(var carry=0,i=0;i<b.length;i++)carry=(r=(0|a.words[i])-(0|b.words[i])+carry)>>26,this.words[i]=67108863&r;for(;0!==carry&&i<a.length;i++)carry=(r=(0|a.words[i])+carry)>>26,this.words[i]=67108863&r;if(0===carry&&i<a.length&&a!==this)for(;i<a.length;i++)this.words[i]=a.words[i];return this.length=Math.max(this.length,i),a!==this&&(this.negative=1),this.strip()},BN.prototype.sub=function sub(num){return this.clone().isub(num)};var comb10MulTo=function comb10MulTo(self,num,out){var lo,mid,hi,a=self.words,b=num.words,o=out.words,c=0,a0=0|a[0],al0=8191&a0,ah0=a0>>>13,a1=0|a[1],al1=8191&a1,ah1=a1>>>13,a2=0|a[2],al2=8191&a2,ah2=a2>>>13,a3=0|a[3],al3=8191&a3,ah3=a3>>>13,a4=0|a[4],al4=8191&a4,ah4=a4>>>13,a5=0|a[5],al5=8191&a5,ah5=a5>>>13,a6=0|a[6],al6=8191&a6,ah6=a6>>>13,a7=0|a[7],al7=8191&a7,ah7=a7>>>13,a8=0|a[8],al8=8191&a8,ah8=a8>>>13,a9=0|a[9],al9=8191&a9,ah9=a9>>>13,b0=0|b[0],bl0=8191&b0,bh0=b0>>>13,b1=0|b[1],bl1=8191&b1,bh1=b1>>>13,b2=0|b[2],bl2=8191&b2,bh2=b2>>>13,b3=0|b[3],bl3=8191&b3,bh3=b3>>>13,b4=0|b[4],bl4=8191&b4,bh4=b4>>>13,b5=0|b[5],bl5=8191&b5,bh5=b5>>>13,b6=0|b[6],bl6=8191&b6,bh6=b6>>>13,b7=0|b[7],bl7=8191&b7,bh7=b7>>>13,b8=0|b[8],bl8=8191&b8,bh8=b8>>>13,b9=0|b[9],bl9=8191&b9,bh9=b9>>>13;out.negative=self.negative^num.negative,out.length=19;var w0=(c+(lo=Math.imul(al0,bl0))|0)+((8191&(mid=(mid=Math.imul(al0,bh0))+Math.imul(ah0,bl0)|0))<<13)|0;c=((hi=Math.imul(ah0,bh0))+(mid>>>13)|0)+(w0>>>26)|0,w0&=67108863,lo=Math.imul(al1,bl0),mid=(mid=Math.imul(al1,bh0))+Math.imul(ah1,bl0)|0,hi=Math.imul(ah1,bh0);var w1=(c+(lo=lo+Math.imul(al0,bl1)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh1)|0)+Math.imul(ah0,bl1)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh1)|0)+(mid>>>13)|0)+(w1>>>26)|0,w1&=67108863,lo=Math.imul(al2,bl0),mid=(mid=Math.imul(al2,bh0))+Math.imul(ah2,bl0)|0,hi=Math.imul(ah2,bh0),lo=lo+Math.imul(al1,bl1)|0,mid=(mid=mid+Math.imul(al1,bh1)|0)+Math.imul(ah1,bl1)|0,hi=hi+Math.imul(ah1,bh1)|0;var w2=(c+(lo=lo+Math.imul(al0,bl2)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh2)|0)+Math.imul(ah0,bl2)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh2)|0)+(mid>>>13)|0)+(w2>>>26)|0,w2&=67108863,lo=Math.imul(al3,bl0),mid=(mid=Math.imul(al3,bh0))+Math.imul(ah3,bl0)|0,hi=Math.imul(ah3,bh0),lo=lo+Math.imul(al2,bl1)|0,mid=(mid=mid+Math.imul(al2,bh1)|0)+Math.imul(ah2,bl1)|0,hi=hi+Math.imul(ah2,bh1)|0,lo=lo+Math.imul(al1,bl2)|0,mid=(mid=mid+Math.imul(al1,bh2)|0)+Math.imul(ah1,bl2)|0,hi=hi+Math.imul(ah1,bh2)|0;var w3=(c+(lo=lo+Math.imul(al0,bl3)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh3)|0)+Math.imul(ah0,bl3)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh3)|0)+(mid>>>13)|0)+(w3>>>26)|0,w3&=67108863,lo=Math.imul(al4,bl0),mid=(mid=Math.imul(al4,bh0))+Math.imul(ah4,bl0)|0,hi=Math.imul(ah4,bh0),lo=lo+Math.imul(al3,bl1)|0,mid=(mid=mid+Math.imul(al3,bh1)|0)+Math.imul(ah3,bl1)|0,hi=hi+Math.imul(ah3,bh1)|0,lo=lo+Math.imul(al2,bl2)|0,mid=(mid=mid+Math.imul(al2,bh2)|0)+Math.imul(ah2,bl2)|0,hi=hi+Math.imul(ah2,bh2)|0,lo=lo+Math.imul(al1,bl3)|0,mid=(mid=mid+Math.imul(al1,bh3)|0)+Math.imul(ah1,bl3)|0,hi=hi+Math.imul(ah1,bh3)|0;var w4=(c+(lo=lo+Math.imul(al0,bl4)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh4)|0)+Math.imul(ah0,bl4)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh4)|0)+(mid>>>13)|0)+(w4>>>26)|0,w4&=67108863,lo=Math.imul(al5,bl0),mid=(mid=Math.imul(al5,bh0))+Math.imul(ah5,bl0)|0,hi=Math.imul(ah5,bh0),lo=lo+Math.imul(al4,bl1)|0,mid=(mid=mid+Math.imul(al4,bh1)|0)+Math.imul(ah4,bl1)|0,hi=hi+Math.imul(ah4,bh1)|0,lo=lo+Math.imul(al3,bl2)|0,mid=(mid=mid+Math.imul(al3,bh2)|0)+Math.imul(ah3,bl2)|0,hi=hi+Math.imul(ah3,bh2)|0,lo=lo+Math.imul(al2,bl3)|0,mid=(mid=mid+Math.imul(al2,bh3)|0)+Math.imul(ah2,bl3)|0,hi=hi+Math.imul(ah2,bh3)|0,lo=lo+Math.imul(al1,bl4)|0,mid=(mid=mid+Math.imul(al1,bh4)|0)+Math.imul(ah1,bl4)|0,hi=hi+Math.imul(ah1,bh4)|0;var w5=(c+(lo=lo+Math.imul(al0,bl5)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh5)|0)+Math.imul(ah0,bl5)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh5)|0)+(mid>>>13)|0)+(w5>>>26)|0,w5&=67108863,lo=Math.imul(al6,bl0),mid=(mid=Math.imul(al6,bh0))+Math.imul(ah6,bl0)|0,hi=Math.imul(ah6,bh0),lo=lo+Math.imul(al5,bl1)|0,mid=(mid=mid+Math.imul(al5,bh1)|0)+Math.imul(ah5,bl1)|0,hi=hi+Math.imul(ah5,bh1)|0,lo=lo+Math.imul(al4,bl2)|0,mid=(mid=mid+Math.imul(al4,bh2)|0)+Math.imul(ah4,bl2)|0,hi=hi+Math.imul(ah4,bh2)|0,lo=lo+Math.imul(al3,bl3)|0,mid=(mid=mid+Math.imul(al3,bh3)|0)+Math.imul(ah3,bl3)|0,hi=hi+Math.imul(ah3,bh3)|0,lo=lo+Math.imul(al2,bl4)|0,mid=(mid=mid+Math.imul(al2,bh4)|0)+Math.imul(ah2,bl4)|0,hi=hi+Math.imul(ah2,bh4)|0,lo=lo+Math.imul(al1,bl5)|0,mid=(mid=mid+Math.imul(al1,bh5)|0)+Math.imul(ah1,bl5)|0,hi=hi+Math.imul(ah1,bh5)|0;var w6=(c+(lo=lo+Math.imul(al0,bl6)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh6)|0)+Math.imul(ah0,bl6)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh6)|0)+(mid>>>13)|0)+(w6>>>26)|0,w6&=67108863,lo=Math.imul(al7,bl0),mid=(mid=Math.imul(al7,bh0))+Math.imul(ah7,bl0)|0,hi=Math.imul(ah7,bh0),lo=lo+Math.imul(al6,bl1)|0,mid=(mid=mid+Math.imul(al6,bh1)|0)+Math.imul(ah6,bl1)|0,hi=hi+Math.imul(ah6,bh1)|0,lo=lo+Math.imul(al5,bl2)|0,mid=(mid=mid+Math.imul(al5,bh2)|0)+Math.imul(ah5,bl2)|0,hi=hi+Math.imul(ah5,bh2)|0,lo=lo+Math.imul(al4,bl3)|0,mid=(mid=mid+Math.imul(al4,bh3)|0)+Math.imul(ah4,bl3)|0,hi=hi+Math.imul(ah4,bh3)|0,lo=lo+Math.imul(al3,bl4)|0,mid=(mid=mid+Math.imul(al3,bh4)|0)+Math.imul(ah3,bl4)|0,hi=hi+Math.imul(ah3,bh4)|0,lo=lo+Math.imul(al2,bl5)|0,mid=(mid=mid+Math.imul(al2,bh5)|0)+Math.imul(ah2,bl5)|0,hi=hi+Math.imul(ah2,bh5)|0,lo=lo+Math.imul(al1,bl6)|0,mid=(mid=mid+Math.imul(al1,bh6)|0)+Math.imul(ah1,bl6)|0,hi=hi+Math.imul(ah1,bh6)|0;var w7=(c+(lo=lo+Math.imul(al0,bl7)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh7)|0)+Math.imul(ah0,bl7)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh7)|0)+(mid>>>13)|0)+(w7>>>26)|0,w7&=67108863,lo=Math.imul(al8,bl0),mid=(mid=Math.imul(al8,bh0))+Math.imul(ah8,bl0)|0,hi=Math.imul(ah8,bh0),lo=lo+Math.imul(al7,bl1)|0,mid=(mid=mid+Math.imul(al7,bh1)|0)+Math.imul(ah7,bl1)|0,hi=hi+Math.imul(ah7,bh1)|0,lo=lo+Math.imul(al6,bl2)|0,mid=(mid=mid+Math.imul(al6,bh2)|0)+Math.imul(ah6,bl2)|0,hi=hi+Math.imul(ah6,bh2)|0,lo=lo+Math.imul(al5,bl3)|0,mid=(mid=mid+Math.imul(al5,bh3)|0)+Math.imul(ah5,bl3)|0,hi=hi+Math.imul(ah5,bh3)|0,lo=lo+Math.imul(al4,bl4)|0,mid=(mid=mid+Math.imul(al4,bh4)|0)+Math.imul(ah4,bl4)|0,hi=hi+Math.imul(ah4,bh4)|0,lo=lo+Math.imul(al3,bl5)|0,mid=(mid=mid+Math.imul(al3,bh5)|0)+Math.imul(ah3,bl5)|0,hi=hi+Math.imul(ah3,bh5)|0,lo=lo+Math.imul(al2,bl6)|0,mid=(mid=mid+Math.imul(al2,bh6)|0)+Math.imul(ah2,bl6)|0,hi=hi+Math.imul(ah2,bh6)|0,lo=lo+Math.imul(al1,bl7)|0,mid=(mid=mid+Math.imul(al1,bh7)|0)+Math.imul(ah1,bl7)|0,hi=hi+Math.imul(ah1,bh7)|0;var w8=(c+(lo=lo+Math.imul(al0,bl8)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh8)|0)+Math.imul(ah0,bl8)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh8)|0)+(mid>>>13)|0)+(w8>>>26)|0,w8&=67108863,lo=Math.imul(al9,bl0),mid=(mid=Math.imul(al9,bh0))+Math.imul(ah9,bl0)|0,hi=Math.imul(ah9,bh0),lo=lo+Math.imul(al8,bl1)|0,mid=(mid=mid+Math.imul(al8,bh1)|0)+Math.imul(ah8,bl1)|0,hi=hi+Math.imul(ah8,bh1)|0,lo=lo+Math.imul(al7,bl2)|0,mid=(mid=mid+Math.imul(al7,bh2)|0)+Math.imul(ah7,bl2)|0,hi=hi+Math.imul(ah7,bh2)|0,lo=lo+Math.imul(al6,bl3)|0,mid=(mid=mid+Math.imul(al6,bh3)|0)+Math.imul(ah6,bl3)|0,hi=hi+Math.imul(ah6,bh3)|0,lo=lo+Math.imul(al5,bl4)|0,mid=(mid=mid+Math.imul(al5,bh4)|0)+Math.imul(ah5,bl4)|0,hi=hi+Math.imul(ah5,bh4)|0,lo=lo+Math.imul(al4,bl5)|0,mid=(mid=mid+Math.imul(al4,bh5)|0)+Math.imul(ah4,bl5)|0,hi=hi+Math.imul(ah4,bh5)|0,lo=lo+Math.imul(al3,bl6)|0,mid=(mid=mid+Math.imul(al3,bh6)|0)+Math.imul(ah3,bl6)|0,hi=hi+Math.imul(ah3,bh6)|0,lo=lo+Math.imul(al2,bl7)|0,mid=(mid=mid+Math.imul(al2,bh7)|0)+Math.imul(ah2,bl7)|0,hi=hi+Math.imul(ah2,bh7)|0,lo=lo+Math.imul(al1,bl8)|0,mid=(mid=mid+Math.imul(al1,bh8)|0)+Math.imul(ah1,bl8)|0,hi=hi+Math.imul(ah1,bh8)|0;var w9=(c+(lo=lo+Math.imul(al0,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh9)|0)+Math.imul(ah0,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh9)|0)+(mid>>>13)|0)+(w9>>>26)|0,w9&=67108863,lo=Math.imul(al9,bl1),mid=(mid=Math.imul(al9,bh1))+Math.imul(ah9,bl1)|0,hi=Math.imul(ah9,bh1),lo=lo+Math.imul(al8,bl2)|0,mid=(mid=mid+Math.imul(al8,bh2)|0)+Math.imul(ah8,bl2)|0,hi=hi+Math.imul(ah8,bh2)|0,lo=lo+Math.imul(al7,bl3)|0,mid=(mid=mid+Math.imul(al7,bh3)|0)+Math.imul(ah7,bl3)|0,hi=hi+Math.imul(ah7,bh3)|0,lo=lo+Math.imul(al6,bl4)|0,mid=(mid=mid+Math.imul(al6,bh4)|0)+Math.imul(ah6,bl4)|0,hi=hi+Math.imul(ah6,bh4)|0,lo=lo+Math.imul(al5,bl5)|0,mid=(mid=mid+Math.imul(al5,bh5)|0)+Math.imul(ah5,bl5)|0,hi=hi+Math.imul(ah5,bh5)|0,lo=lo+Math.imul(al4,bl6)|0,mid=(mid=mid+Math.imul(al4,bh6)|0)+Math.imul(ah4,bl6)|0,hi=hi+Math.imul(ah4,bh6)|0,lo=lo+Math.imul(al3,bl7)|0,mid=(mid=mid+Math.imul(al3,bh7)|0)+Math.imul(ah3,bl7)|0,hi=hi+Math.imul(ah3,bh7)|0,lo=lo+Math.imul(al2,bl8)|0,mid=(mid=mid+Math.imul(al2,bh8)|0)+Math.imul(ah2,bl8)|0,hi=hi+Math.imul(ah2,bh8)|0;var w10=(c+(lo=lo+Math.imul(al1,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al1,bh9)|0)+Math.imul(ah1,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah1,bh9)|0)+(mid>>>13)|0)+(w10>>>26)|0,w10&=67108863,lo=Math.imul(al9,bl2),mid=(mid=Math.imul(al9,bh2))+Math.imul(ah9,bl2)|0,hi=Math.imul(ah9,bh2),lo=lo+Math.imul(al8,bl3)|0,mid=(mid=mid+Math.imul(al8,bh3)|0)+Math.imul(ah8,bl3)|0,hi=hi+Math.imul(ah8,bh3)|0,lo=lo+Math.imul(al7,bl4)|0,mid=(mid=mid+Math.imul(al7,bh4)|0)+Math.imul(ah7,bl4)|0,hi=hi+Math.imul(ah7,bh4)|0,lo=lo+Math.imul(al6,bl5)|0,mid=(mid=mid+Math.imul(al6,bh5)|0)+Math.imul(ah6,bl5)|0,hi=hi+Math.imul(ah6,bh5)|0,lo=lo+Math.imul(al5,bl6)|0,mid=(mid=mid+Math.imul(al5,bh6)|0)+Math.imul(ah5,bl6)|0,hi=hi+Math.imul(ah5,bh6)|0,lo=lo+Math.imul(al4,bl7)|0,mid=(mid=mid+Math.imul(al4,bh7)|0)+Math.imul(ah4,bl7)|0,hi=hi+Math.imul(ah4,bh7)|0,lo=lo+Math.imul(al3,bl8)|0,mid=(mid=mid+Math.imul(al3,bh8)|0)+Math.imul(ah3,bl8)|0,hi=hi+Math.imul(ah3,bh8)|0;var w11=(c+(lo=lo+Math.imul(al2,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al2,bh9)|0)+Math.imul(ah2,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah2,bh9)|0)+(mid>>>13)|0)+(w11>>>26)|0,w11&=67108863,lo=Math.imul(al9,bl3),mid=(mid=Math.imul(al9,bh3))+Math.imul(ah9,bl3)|0,hi=Math.imul(ah9,bh3),lo=lo+Math.imul(al8,bl4)|0,mid=(mid=mid+Math.imul(al8,bh4)|0)+Math.imul(ah8,bl4)|0,hi=hi+Math.imul(ah8,bh4)|0,lo=lo+Math.imul(al7,bl5)|0,mid=(mid=mid+Math.imul(al7,bh5)|0)+Math.imul(ah7,bl5)|0,hi=hi+Math.imul(ah7,bh5)|0,lo=lo+Math.imul(al6,bl6)|0,mid=(mid=mid+Math.imul(al6,bh6)|0)+Math.imul(ah6,bl6)|0,hi=hi+Math.imul(ah6,bh6)|0,lo=lo+Math.imul(al5,bl7)|0,mid=(mid=mid+Math.imul(al5,bh7)|0)+Math.imul(ah5,bl7)|0,hi=hi+Math.imul(ah5,bh7)|0,lo=lo+Math.imul(al4,bl8)|0,mid=(mid=mid+Math.imul(al4,bh8)|0)+Math.imul(ah4,bl8)|0,hi=hi+Math.imul(ah4,bh8)|0;var w12=(c+(lo=lo+Math.imul(al3,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al3,bh9)|0)+Math.imul(ah3,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah3,bh9)|0)+(mid>>>13)|0)+(w12>>>26)|0,w12&=67108863,lo=Math.imul(al9,bl4),mid=(mid=Math.imul(al9,bh4))+Math.imul(ah9,bl4)|0,hi=Math.imul(ah9,bh4),lo=lo+Math.imul(al8,bl5)|0,mid=(mid=mid+Math.imul(al8,bh5)|0)+Math.imul(ah8,bl5)|0,hi=hi+Math.imul(ah8,bh5)|0,lo=lo+Math.imul(al7,bl6)|0,mid=(mid=mid+Math.imul(al7,bh6)|0)+Math.imul(ah7,bl6)|0,hi=hi+Math.imul(ah7,bh6)|0,lo=lo+Math.imul(al6,bl7)|0,mid=(mid=mid+Math.imul(al6,bh7)|0)+Math.imul(ah6,bl7)|0,hi=hi+Math.imul(ah6,bh7)|0,lo=lo+Math.imul(al5,bl8)|0,mid=(mid=mid+Math.imul(al5,bh8)|0)+Math.imul(ah5,bl8)|0,hi=hi+Math.imul(ah5,bh8)|0;var w13=(c+(lo=lo+Math.imul(al4,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al4,bh9)|0)+Math.imul(ah4,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah4,bh9)|0)+(mid>>>13)|0)+(w13>>>26)|0,w13&=67108863,lo=Math.imul(al9,bl5),mid=(mid=Math.imul(al9,bh5))+Math.imul(ah9,bl5)|0,hi=Math.imul(ah9,bh5),lo=lo+Math.imul(al8,bl6)|0,mid=(mid=mid+Math.imul(al8,bh6)|0)+Math.imul(ah8,bl6)|0,hi=hi+Math.imul(ah8,bh6)|0,lo=lo+Math.imul(al7,bl7)|0,mid=(mid=mid+Math.imul(al7,bh7)|0)+Math.imul(ah7,bl7)|0,hi=hi+Math.imul(ah7,bh7)|0,lo=lo+Math.imul(al6,bl8)|0,mid=(mid=mid+Math.imul(al6,bh8)|0)+Math.imul(ah6,bl8)|0,hi=hi+Math.imul(ah6,bh8)|0;var w14=(c+(lo=lo+Math.imul(al5,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al5,bh9)|0)+Math.imul(ah5,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah5,bh9)|0)+(mid>>>13)|0)+(w14>>>26)|0,w14&=67108863,lo=Math.imul(al9,bl6),mid=(mid=Math.imul(al9,bh6))+Math.imul(ah9,bl6)|0,hi=Math.imul(ah9,bh6),lo=lo+Math.imul(al8,bl7)|0,mid=(mid=mid+Math.imul(al8,bh7)|0)+Math.imul(ah8,bl7)|0,hi=hi+Math.imul(ah8,bh7)|0,lo=lo+Math.imul(al7,bl8)|0,mid=(mid=mid+Math.imul(al7,bh8)|0)+Math.imul(ah7,bl8)|0,hi=hi+Math.imul(ah7,bh8)|0;var w15=(c+(lo=lo+Math.imul(al6,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al6,bh9)|0)+Math.imul(ah6,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah6,bh9)|0)+(mid>>>13)|0)+(w15>>>26)|0,w15&=67108863,lo=Math.imul(al9,bl7),mid=(mid=Math.imul(al9,bh7))+Math.imul(ah9,bl7)|0,hi=Math.imul(ah9,bh7),lo=lo+Math.imul(al8,bl8)|0,mid=(mid=mid+Math.imul(al8,bh8)|0)+Math.imul(ah8,bl8)|0,hi=hi+Math.imul(ah8,bh8)|0;var w16=(c+(lo=lo+Math.imul(al7,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al7,bh9)|0)+Math.imul(ah7,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah7,bh9)|0)+(mid>>>13)|0)+(w16>>>26)|0,w16&=67108863,lo=Math.imul(al9,bl8),mid=(mid=Math.imul(al9,bh8))+Math.imul(ah9,bl8)|0,hi=Math.imul(ah9,bh8);var w17=(c+(lo=lo+Math.imul(al8,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al8,bh9)|0)+Math.imul(ah8,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah8,bh9)|0)+(mid>>>13)|0)+(w17>>>26)|0,w17&=67108863;var w18=(c+(lo=Math.imul(al9,bl9))|0)+((8191&(mid=(mid=Math.imul(al9,bh9))+Math.imul(ah9,bl9)|0))<<13)|0;return c=((hi=Math.imul(ah9,bh9))+(mid>>>13)|0)+(w18>>>26)|0,w18&=67108863,o[0]=w0,o[1]=w1,o[2]=w2,o[3]=w3,o[4]=w4,o[5]=w5,o[6]=w6,o[7]=w7,o[8]=w8,o[9]=w9,o[10]=w10,o[11]=w11,o[12]=w12,o[13]=w13,o[14]=w14,o[15]=w15,o[16]=w16,o[17]=w17,o[18]=w18,0!==c&&(o[19]=c,out.length++),out};function jumboMulTo(self,num,out){return(new FFTM).mulp(self,num,out)}function FFTM(x,y){this.x=x,this.y=y}Math.imul||(comb10MulTo=smallMulTo),BN.prototype.mulTo=function mulTo(num,out){var len=this.length+num.length;return 10===this.length&&10===num.length?comb10MulTo(this,num,out):len<63?smallMulTo(this,num,out):len<1024?function bigMulTo(self,num,out){out.negative=num.negative^self.negative,out.length=self.length+num.length;for(var carry=0,hncarry=0,k=0;k<out.length-1;k++){var ncarry=hncarry;hncarry=0;for(var rword=67108863&carry,maxJ=Math.min(k,num.length-1),j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j,r=(0|self.words[i])*(0|num.words[j]),lo=67108863&r;rword=67108863&(lo=lo+rword|0),hncarry+=(ncarry=(ncarry=ncarry+(r/67108864|0)|0)+(lo>>>26)|0)>>>26,ncarry&=67108863}out.words[k]=rword,carry=ncarry,ncarry=hncarry}return 0!==carry?out.words[k]=carry:out.length--,out.strip()}(this,num,out):jumboMulTo(this,num,out)},FFTM.prototype.makeRBT=function makeRBT(N){for(var t=new Array(N),l=BN.prototype._countBits(N)-1,i=0;i<N;i++)t[i]=this.revBin(i,l,N);return t},FFTM.prototype.revBin=function revBin(x,l,N){if(0===x||x===N-1)return x;for(var rb=0,i=0;i<l;i++)rb|=(1&x)<<l-i-1,x>>=1;return rb},FFTM.prototype.permute=function permute(rbt,rws,iws,rtws,itws,N){for(var i=0;i<N;i++)rtws[i]=rws[rbt[i]],itws[i]=iws[rbt[i]]},FFTM.prototype.transform=function transform(rws,iws,rtws,itws,N,rbt){this.permute(rbt,rws,iws,rtws,itws,N);for(var s=1;s<N;s<<=1)for(var l=s<<1,rtwdf=Math.cos(2*Math.PI/l),itwdf=Math.sin(2*Math.PI/l),p=0;p<N;p+=l)for(var rtwdf_=rtwdf,itwdf_=itwdf,j=0;j<s;j++){var re=rtws[p+j],ie=itws[p+j],ro=rtws[p+j+s],io=itws[p+j+s],rx=rtwdf_*ro-itwdf_*io;io=rtwdf_*io+itwdf_*ro,ro=rx,rtws[p+j]=re+ro,itws[p+j]=ie+io,rtws[p+j+s]=re-ro,itws[p+j+s]=ie-io,j!==l&&(rx=rtwdf*rtwdf_-itwdf*itwdf_,itwdf_=rtwdf*itwdf_+itwdf*rtwdf_,rtwdf_=rx)}},FFTM.prototype.guessLen13b=function guessLen13b(n,m){var N=1|Math.max(m,n),odd=1&N,i=0;for(N=N/2|0;N;N>>>=1)i++;return 1<<i+1+odd},FFTM.prototype.conjugate=function conjugate(rws,iws,N){if(!(N<=1))for(var i=0;i<N/2;i++){var t=rws[i];rws[i]=rws[N-i-1],rws[N-i-1]=t,t=iws[i],iws[i]=-iws[N-i-1],iws[N-i-1]=-t}},FFTM.prototype.normalize13b=function normalize13b(ws,N){for(var carry=0,i=0;i<N/2;i++){var w=8192*Math.round(ws[2*i+1]/N)+Math.round(ws[2*i]/N)+carry;ws[i]=67108863&w,carry=w<67108864?0:w/67108864|0}return ws},FFTM.prototype.convert13b=function convert13b(ws,len,rws,N){for(var carry=0,i=0;i<len;i++)carry+=0|ws[i],rws[2*i]=8191&carry,carry>>>=13,rws[2*i+1]=8191&carry,carry>>>=13;for(i=2*len;i<N;++i)rws[i]=0;assert(0===carry),assert(0==(-8192&carry))},FFTM.prototype.stub=function stub(N){for(var ph=new Array(N),i=0;i<N;i++)ph[i]=0;return ph},FFTM.prototype.mulp=function mulp(x,y,out){var N=2*this.guessLen13b(x.length,y.length),rbt=this.makeRBT(N),_=this.stub(N),rws=new Array(N),rwst=new Array(N),iwst=new Array(N),nrws=new Array(N),nrwst=new Array(N),niwst=new Array(N),rmws=out.words;rmws.length=N,this.convert13b(x.words,x.length,rws,N),this.convert13b(y.words,y.length,nrws,N),this.transform(rws,_,rwst,iwst,N,rbt),this.transform(nrws,_,nrwst,niwst,N,rbt);for(var i=0;i<N;i++){var rx=rwst[i]*nrwst[i]-iwst[i]*niwst[i];iwst[i]=rwst[i]*niwst[i]+iwst[i]*nrwst[i],rwst[i]=rx}return this.conjugate(rwst,iwst,N),this.transform(rwst,iwst,rmws,_,N,rbt),this.conjugate(rmws,_,N),this.normalize13b(rmws,N),out.negative=x.negative^y.negative,out.length=x.length+y.length,out.strip()},BN.prototype.mul=function mul(num){var out=new BN(null);return out.words=new Array(this.length+num.length),this.mulTo(num,out)},BN.prototype.mulf=function mulf(num){var out=new BN(null);return out.words=new Array(this.length+num.length),jumboMulTo(this,num,out)},BN.prototype.imul=function imul(num){return this.clone().mulTo(num,this)},BN.prototype.imuln=function imuln(num){assert("number"==typeof num),assert(num<67108864);for(var carry=0,i=0;i<this.length;i++){var w=(0|this.words[i])*num,lo=(67108863&w)+(67108863&carry);carry>>=26,carry+=w/67108864|0,carry+=lo>>>26,this.words[i]=67108863&lo}return 0!==carry&&(this.words[i]=carry,this.length++),this},BN.prototype.muln=function muln(num){return this.clone().imuln(num)},BN.prototype.sqr=function sqr(){return this.mul(this)},BN.prototype.isqr=function isqr(){return this.imul(this.clone())},BN.prototype.pow=function pow(num){var w=function toBitArray(num){for(var w=new Array(num.bitLength()),bit=0;bit<w.length;bit++){var off=bit/26|0,wbit=bit%26;w[bit]=(num.words[off]&1<<wbit)>>>wbit}return w}(num);if(0===w.length)return new BN(1);for(var res=this,i=0;i<w.length&&0===w[i];i++,res=res.sqr());if(++i<w.length)for(var q=res.sqr();i<w.length;i++,q=q.sqr())0!==w[i]&&(res=res.mul(q));return res},BN.prototype.iushln=function iushln(bits){assert("number"==typeof bits&&bits>=0);var i,r=bits%26,s=(bits-r)/26,carryMask=67108863>>>26-r<<26-r;if(0!==r){var carry=0;for(i=0;i<this.length;i++){var newCarry=this.words[i]&carryMask,c=(0|this.words[i])-newCarry<<r;this.words[i]=c|carry,carry=newCarry>>>26-r}carry&&(this.words[i]=carry,this.length++)}if(0!==s){for(i=this.length-1;i>=0;i--)this.words[i+s]=this.words[i];for(i=0;i<s;i++)this.words[i]=0;this.length+=s}return this.strip()},BN.prototype.ishln=function ishln(bits){return assert(0===this.negative),this.iushln(bits)},BN.prototype.iushrn=function iushrn(bits,hint,extended){var h;assert("number"==typeof bits&&bits>=0),h=hint?(hint-hint%26)/26:0;var r=bits%26,s=Math.min((bits-r)/26,this.length),mask=67108863^67108863>>>r<<r,maskedWords=extended;if(h-=s,h=Math.max(0,h),maskedWords){for(var i=0;i<s;i++)maskedWords.words[i]=this.words[i];maskedWords.length=s}if(0===s);else if(this.length>s)for(this.length-=s,i=0;i<this.length;i++)this.words[i]=this.words[i+s];else this.words[0]=0,this.length=1;var carry=0;for(i=this.length-1;i>=0&&(0!==carry||i>=h);i--){var word=0|this.words[i];this.words[i]=carry<<26-r|word>>>r,carry=word&mask}return maskedWords&&0!==carry&&(maskedWords.words[maskedWords.length++]=carry),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},BN.prototype.ishrn=function ishrn(bits,hint,extended){return assert(0===this.negative),this.iushrn(bits,hint,extended)},BN.prototype.shln=function shln(bits){return this.clone().ishln(bits)},BN.prototype.ushln=function ushln(bits){return this.clone().iushln(bits)},BN.prototype.shrn=function shrn(bits){return this.clone().ishrn(bits)},BN.prototype.ushrn=function ushrn(bits){return this.clone().iushrn(bits)},BN.prototype.testn=function testn(bit){assert("number"==typeof bit&&bit>=0);var r=bit%26,s=(bit-r)/26,q=1<<r;return!(this.length<=s)&&!!(this.words[s]&q)},BN.prototype.imaskn=function imaskn(bits){assert("number"==typeof bits&&bits>=0);var r=bits%26,s=(bits-r)/26;if(assert(0===this.negative,"imaskn works only with positive numbers"),this.length<=s)return this;if(0!==r&&s++,this.length=Math.min(s,this.length),0!==r){var mask=67108863^67108863>>>r<<r;this.words[this.length-1]&=mask}return this.strip()},BN.prototype.maskn=function maskn(bits){return this.clone().imaskn(bits)},BN.prototype.iaddn=function iaddn(num){return assert("number"==typeof num),assert(num<67108864),num<0?this.isubn(-num):0!==this.negative?1===this.length&&(0|this.words[0])<num?(this.words[0]=num-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(num),this.negative=1,this):this._iaddn(num)},BN.prototype._iaddn=function _iaddn(num){this.words[0]+=num;for(var i=0;i<this.length&&this.words[i]>=67108864;i++)this.words[i]-=67108864,i===this.length-1?this.words[i+1]=1:this.words[i+1]++;return this.length=Math.max(this.length,i+1),this},BN.prototype.isubn=function isubn(num){if(assert("number"==typeof num),assert(num<67108864),num<0)return this.iaddn(-num);if(0!==this.negative)return this.negative=0,this.iaddn(num),this.negative=1,this;if(this.words[0]-=num,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var i=0;i<this.length&&this.words[i]<0;i++)this.words[i]+=67108864,this.words[i+1]-=1;return this.strip()},BN.prototype.addn=function addn(num){return this.clone().iaddn(num)},BN.prototype.subn=function subn(num){return this.clone().isubn(num)},BN.prototype.iabs=function iabs(){return this.negative=0,this},BN.prototype.abs=function abs(){return this.clone().iabs()},BN.prototype._ishlnsubmul=function _ishlnsubmul(num,mul,shift){var i,w,len=num.length+shift;this._expand(len);var carry=0;for(i=0;i<num.length;i++){w=(0|this.words[i+shift])+carry;var right=(0|num.words[i])*mul;carry=((w-=67108863&right)>>26)-(right/67108864|0),this.words[i+shift]=67108863&w}for(;i<this.length-shift;i++)carry=(w=(0|this.words[i+shift])+carry)>>26,this.words[i+shift]=67108863&w;if(0===carry)return this.strip();for(assert(-1===carry),carry=0,i=0;i<this.length;i++)carry=(w=-(0|this.words[i])+carry)>>26,this.words[i]=67108863&w;return this.negative=1,this.strip()},BN.prototype._wordDiv=function _wordDiv(num,mode){var shift=(this.length,num.length),a=this.clone(),b=num,bhi=0|b.words[b.length-1];0!==(shift=26-this._countBits(bhi))&&(b=b.ushln(shift),a.iushln(shift),bhi=0|b.words[b.length-1]);var q,m=a.length-b.length;if("mod"!==mode){(q=new BN(null)).length=m+1,q.words=new Array(q.length);for(var i=0;i<q.length;i++)q.words[i]=0}var diff=a.clone()._ishlnsubmul(b,1,m);0===diff.negative&&(a=diff,q&&(q.words[m]=1));for(var j=m-1;j>=0;j--){var qj=67108864*(0|a.words[b.length+j])+(0|a.words[b.length+j-1]);for(qj=Math.min(qj/bhi|0,67108863),a._ishlnsubmul(b,qj,j);0!==a.negative;)qj--,a.negative=0,a._ishlnsubmul(b,1,j),a.isZero()||(a.negative^=1);q&&(q.words[j]=qj)}return q&&q.strip(),a.strip(),"div"!==mode&&0!==shift&&a.iushrn(shift),{div:q||null,mod:a}},BN.prototype.divmod=function divmod(num,mode,positive){return assert(!num.isZero()),this.isZero()?{div:new BN(0),mod:new BN(0)}:0!==this.negative&&0===num.negative?(res=this.neg().divmod(num,mode),"mod"!==mode&&(div=res.div.neg()),"div"!==mode&&(mod=res.mod.neg(),positive&&0!==mod.negative&&mod.iadd(num)),{div:div,mod:mod}):0===this.negative&&0!==num.negative?(res=this.divmod(num.neg(),mode),"mod"!==mode&&(div=res.div.neg()),{div:div,mod:res.mod}):0!=(this.negative&num.negative)?(res=this.neg().divmod(num.neg(),mode),"div"!==mode&&(mod=res.mod.neg(),positive&&0!==mod.negative&&mod.isub(num)),{div:res.div,mod:mod}):num.length>this.length||this.cmp(num)<0?{div:new BN(0),mod:this}:1===num.length?"div"===mode?{div:this.divn(num.words[0]),mod:null}:"mod"===mode?{div:null,mod:new BN(this.modn(num.words[0]))}:{div:this.divn(num.words[0]),mod:new BN(this.modn(num.words[0]))}:this._wordDiv(num,mode);var div,mod,res},BN.prototype.div=function div(num){return this.divmod(num,"div",!1).div},BN.prototype.mod=function mod(num){return this.divmod(num,"mod",!1).mod},BN.prototype.umod=function umod(num){return this.divmod(num,"mod",!0).mod},BN.prototype.divRound=function divRound(num){var dm=this.divmod(num);if(dm.mod.isZero())return dm.div;var mod=0!==dm.div.negative?dm.mod.isub(num):dm.mod,half=num.ushrn(1),r2=num.andln(1),cmp=mod.cmp(half);return cmp<0||1===r2&&0===cmp?dm.div:0!==dm.div.negative?dm.div.isubn(1):dm.div.iaddn(1)},BN.prototype.modn=function modn(num){assert(num<=67108863);for(var p=(1<<26)%num,acc=0,i=this.length-1;i>=0;i--)acc=(p*acc+(0|this.words[i]))%num;return acc},BN.prototype.idivn=function idivn(num){assert(num<=67108863);for(var carry=0,i=this.length-1;i>=0;i--){var w=(0|this.words[i])+67108864*carry;this.words[i]=w/num|0,carry=w%num}return this.strip()},BN.prototype.divn=function divn(num){return this.clone().idivn(num)},BN.prototype.egcd=function egcd(p){assert(0===p.negative),assert(!p.isZero());var x=this,y=p.clone();x=0!==x.negative?x.umod(p):x.clone();for(var A=new BN(1),B=new BN(0),C=new BN(0),D=new BN(1),g=0;x.isEven()&&y.isEven();)x.iushrn(1),y.iushrn(1),++g;for(var yp=y.clone(),xp=x.clone();!x.isZero();){for(var i=0,im=1;0==(x.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(x.iushrn(i);i-- >0;)(A.isOdd()||B.isOdd())&&(A.iadd(yp),B.isub(xp)),A.iushrn(1),B.iushrn(1);for(var j=0,jm=1;0==(y.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(y.iushrn(j);j-- >0;)(C.isOdd()||D.isOdd())&&(C.iadd(yp),D.isub(xp)),C.iushrn(1),D.iushrn(1);x.cmp(y)>=0?(x.isub(y),A.isub(C),B.isub(D)):(y.isub(x),C.isub(A),D.isub(B))}return{a:C,b:D,gcd:y.iushln(g)}},BN.prototype._invmp=function _invmp(p){assert(0===p.negative),assert(!p.isZero());var a=this,b=p.clone();a=0!==a.negative?a.umod(p):a.clone();for(var res,x1=new BN(1),x2=new BN(0),delta=b.clone();a.cmpn(1)>0&&b.cmpn(1)>0;){for(var i=0,im=1;0==(a.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(a.iushrn(i);i-- >0;)x1.isOdd()&&x1.iadd(delta),x1.iushrn(1);for(var j=0,jm=1;0==(b.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(b.iushrn(j);j-- >0;)x2.isOdd()&&x2.iadd(delta),x2.iushrn(1);a.cmp(b)>=0?(a.isub(b),x1.isub(x2)):(b.isub(a),x2.isub(x1))}return(res=0===a.cmpn(1)?x1:x2).cmpn(0)<0&&res.iadd(p),res},BN.prototype.gcd=function gcd(num){if(this.isZero())return num.abs();if(num.isZero())return this.abs();var a=this.clone(),b=num.clone();a.negative=0,b.negative=0;for(var shift=0;a.isEven()&&b.isEven();shift++)a.iushrn(1),b.iushrn(1);for(;;){for(;a.isEven();)a.iushrn(1);for(;b.isEven();)b.iushrn(1);var r=a.cmp(b);if(r<0){var t=a;a=b,b=t}else if(0===r||0===b.cmpn(1))break;a.isub(b)}return b.iushln(shift)},BN.prototype.invm=function invm(num){return this.egcd(num).a.umod(num)},BN.prototype.isEven=function isEven(){return 0==(1&this.words[0])},BN.prototype.isOdd=function isOdd(){return 1==(1&this.words[0])},BN.prototype.andln=function andln(num){return this.words[0]&num},BN.prototype.bincn=function bincn(bit){assert("number"==typeof bit);var r=bit%26,s=(bit-r)/26,q=1<<r;if(this.length<=s)return this._expand(s+1),this.words[s]|=q,this;for(var carry=q,i=s;0!==carry&&i<this.length;i++){var w=0|this.words[i];carry=(w+=carry)>>>26,w&=67108863,this.words[i]=w}return 0!==carry&&(this.words[i]=carry,this.length++),this},BN.prototype.isZero=function isZero(){return 1===this.length&&0===this.words[0]},BN.prototype.cmpn=function cmpn(num){var res,negative=num<0;if(0!==this.negative&&!negative)return-1;if(0===this.negative&&negative)return 1;if(this.strip(),this.length>1)res=1;else{negative&&(num=-num),assert(num<=67108863,"Number is too big");var w=0|this.words[0];res=w===num?0:w<num?-1:1}return 0!==this.negative?0|-res:res},BN.prototype.cmp=function cmp(num){if(0!==this.negative&&0===num.negative)return-1;if(0===this.negative&&0!==num.negative)return 1;var res=this.ucmp(num);return 0!==this.negative?0|-res:res},BN.prototype.ucmp=function ucmp(num){if(this.length>num.length)return 1;if(this.length<num.length)return-1;for(var res=0,i=this.length-1;i>=0;i--){var a=0|this.words[i],b=0|num.words[i];if(a!==b){a<b?res=-1:a>b&&(res=1);break}}return res},BN.prototype.gtn=function gtn(num){return 1===this.cmpn(num)},BN.prototype.gt=function gt(num){return 1===this.cmp(num)},BN.prototype.gten=function gten(num){return this.cmpn(num)>=0},BN.prototype.gte=function gte(num){return this.cmp(num)>=0},BN.prototype.ltn=function ltn(num){return-1===this.cmpn(num)},BN.prototype.lt=function lt(num){return-1===this.cmp(num)},BN.prototype.lten=function lten(num){return this.cmpn(num)<=0},BN.prototype.lte=function lte(num){return this.cmp(num)<=0},BN.prototype.eqn=function eqn(num){return 0===this.cmpn(num)},BN.prototype.eq=function eq(num){return 0===this.cmp(num)},BN.red=function red(num){return new Red(num)},BN.prototype.toRed=function toRed(ctx){return assert(!this.red,"Already a number in reduction context"),assert(0===this.negative,"red works only with positives"),ctx.convertTo(this)._forceRed(ctx)},BN.prototype.fromRed=function fromRed(){return assert(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},BN.prototype._forceRed=function _forceRed(ctx){return this.red=ctx,this},BN.prototype.forceRed=function forceRed(ctx){return assert(!this.red,"Already a number in reduction context"),this._forceRed(ctx)},BN.prototype.redAdd=function redAdd(num){return assert(this.red,"redAdd works only with red numbers"),this.red.add(this,num)},BN.prototype.redIAdd=function redIAdd(num){return assert(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,num)},BN.prototype.redSub=function redSub(num){return assert(this.red,"redSub works only with red numbers"),this.red.sub(this,num)},BN.prototype.redISub=function redISub(num){return assert(this.red,"redISub works only with red numbers"),this.red.isub(this,num)},BN.prototype.redShl=function redShl(num){return assert(this.red,"redShl works only with red numbers"),this.red.shl(this,num)},BN.prototype.redMul=function redMul(num){return assert(this.red,"redMul works only with red numbers"),this.red._verify2(this,num),this.red.mul(this,num)},BN.prototype.redIMul=function redIMul(num){return assert(this.red,"redMul works only with red numbers"),this.red._verify2(this,num),this.red.imul(this,num)},BN.prototype.redSqr=function redSqr(){return assert(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},BN.prototype.redISqr=function redISqr(){return assert(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},BN.prototype.redSqrt=function redSqrt(){return assert(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},BN.prototype.redInvm=function redInvm(){return assert(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},BN.prototype.redNeg=function redNeg(){return assert(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},BN.prototype.redPow=function redPow(num){return assert(this.red&&!num.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,num)};var primes={k256:null,p224:null,p192:null,p25519:null};function MPrime(name,p){this.name=name,this.p=new BN(p,16),this.n=this.p.bitLength(),this.k=new BN(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function K256(){MPrime.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function P224(){MPrime.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function P192(){MPrime.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function P25519(){MPrime.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function Red(m){if("string"==typeof m){var prime=BN._prime(m);this.m=prime.p,this.prime=prime}else assert(m.gtn(1),"modulus must be greater than 1"),this.m=m,this.prime=null}function Mont(m){Red.call(this,m),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new BN(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}MPrime.prototype._tmp=function _tmp(){var tmp=new BN(null);return tmp.words=new Array(Math.ceil(this.n/13)),tmp},MPrime.prototype.ireduce=function ireduce(num){var rlen,r=num;do{this.split(r,this.tmp),rlen=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(rlen>this.n);var cmp=rlen<this.n?-1:r.ucmp(this.p);return 0===cmp?(r.words[0]=0,r.length=1):cmp>0?r.isub(this.p):r.strip(),r},MPrime.prototype.split=function split(input,out){input.iushrn(this.n,0,out)},MPrime.prototype.imulK=function imulK(num){return num.imul(this.k)},inherits(K256,MPrime),K256.prototype.split=function split(input,output){for(var outLen=Math.min(input.length,9),i=0;i<outLen;i++)output.words[i]=input.words[i];if(output.length=outLen,input.length<=9)return input.words[0]=0,void(input.length=1);var prev=input.words[9];for(output.words[output.length++]=4194303&prev,i=10;i<input.length;i++){var next=0|input.words[i];input.words[i-10]=(4194303&next)<<4|prev>>>22,prev=next}prev>>>=22,input.words[i-10]=prev,0===prev&&input.length>10?input.length-=10:input.length-=9},K256.prototype.imulK=function imulK(num){num.words[num.length]=0,num.words[num.length+1]=0,num.length+=2;for(var lo=0,i=0;i<num.length;i++){var w=0|num.words[i];lo+=977*w,num.words[i]=67108863&lo,lo=64*w+(lo/67108864|0)}return 0===num.words[num.length-1]&&(num.length--,0===num.words[num.length-1]&&num.length--),num},inherits(P224,MPrime),inherits(P192,MPrime),inherits(P25519,MPrime),P25519.prototype.imulK=function imulK(num){for(var carry=0,i=0;i<num.length;i++){var hi=19*(0|num.words[i])+carry,lo=67108863&hi;hi>>>=26,num.words[i]=lo,carry=hi}return 0!==carry&&(num.words[num.length++]=carry),num},BN._prime=function prime(name){if(primes[name])return primes[name];var prime;if("k256"===name)prime=new K256;else if("p224"===name)prime=new P224;else if("p192"===name)prime=new P192;else{if("p25519"!==name)throw new Error("Unknown prime "+name);prime=new P25519}return primes[name]=prime,prime},Red.prototype._verify1=function _verify1(a){assert(0===a.negative,"red works only with positives"),assert(a.red,"red works only with red numbers")},Red.prototype._verify2=function _verify2(a,b){assert(0==(a.negative|b.negative),"red works only with positives"),assert(a.red&&a.red===b.red,"red works only with red numbers")},Red.prototype.imod=function imod(a){return this.prime?this.prime.ireduce(a)._forceRed(this):a.umod(this.m)._forceRed(this)},Red.prototype.neg=function neg(a){return a.isZero()?a.clone():this.m.sub(a)._forceRed(this)},Red.prototype.add=function add(a,b){this._verify2(a,b);var res=a.add(b);return res.cmp(this.m)>=0&&res.isub(this.m),res._forceRed(this)},Red.prototype.iadd=function iadd(a,b){this._verify2(a,b);var res=a.iadd(b);return res.cmp(this.m)>=0&&res.isub(this.m),res},Red.prototype.sub=function sub(a,b){this._verify2(a,b);var res=a.sub(b);return res.cmpn(0)<0&&res.iadd(this.m),res._forceRed(this)},Red.prototype.isub=function isub(a,b){this._verify2(a,b);var res=a.isub(b);return res.cmpn(0)<0&&res.iadd(this.m),res},Red.prototype.shl=function shl(a,num){return this._verify1(a),this.imod(a.ushln(num))},Red.prototype.imul=function imul(a,b){return this._verify2(a,b),this.imod(a.imul(b))},Red.prototype.mul=function mul(a,b){return this._verify2(a,b),this.imod(a.mul(b))},Red.prototype.isqr=function isqr(a){return this.imul(a,a.clone())},Red.prototype.sqr=function sqr(a){return this.mul(a,a)},Red.prototype.sqrt=function sqrt(a){if(a.isZero())return a.clone();var mod3=this.m.andln(3);if(assert(mod3%2==1),3===mod3){var pow=this.m.add(new BN(1)).iushrn(2);return this.pow(a,pow)}for(var q=this.m.subn(1),s=0;!q.isZero()&&0===q.andln(1);)s++,q.iushrn(1);assert(!q.isZero());var one=new BN(1).toRed(this),nOne=one.redNeg(),lpow=this.m.subn(1).iushrn(1),z=this.m.bitLength();for(z=new BN(2*z*z).toRed(this);0!==this.pow(z,lpow).cmp(nOne);)z.redIAdd(nOne);for(var c=this.pow(z,q),r=this.pow(a,q.addn(1).iushrn(1)),t=this.pow(a,q),m=s;0!==t.cmp(one);){for(var tmp=t,i=0;0!==tmp.cmp(one);i++)tmp=tmp.redSqr();assert(i<m);var b=this.pow(c,new BN(1).iushln(m-i-1));r=r.redMul(b),c=b.redSqr(),t=t.redMul(c),m=i}return r},Red.prototype.invm=function invm(a){var inv=a._invmp(this.m);return 0!==inv.negative?(inv.negative=0,this.imod(inv).redNeg()):this.imod(inv)},Red.prototype.pow=function pow(a,num){if(num.isZero())return new BN(1).toRed(this);if(0===num.cmpn(1))return a.clone();var wnd=new Array(16);wnd[0]=new BN(1).toRed(this),wnd[1]=a;for(var i=2;i<wnd.length;i++)wnd[i]=this.mul(wnd[i-1],a);var res=wnd[0],current=0,currentLen=0,start=num.bitLength()%26;for(0===start&&(start=26),i=num.length-1;i>=0;i--){for(var word=num.words[i],j=start-1;j>=0;j--){var bit=word>>j&1;res!==wnd[0]&&(res=this.sqr(res)),0!==bit||0!==current?(current<<=1,current|=bit,(4===++currentLen||0===i&&0===j)&&(res=this.mul(res,wnd[current]),currentLen=0,current=0)):currentLen=0}start=26}return res},Red.prototype.convertTo=function convertTo(num){var r=num.umod(this.m);return r===num?r.clone():r},Red.prototype.convertFrom=function convertFrom(num){var res=num.clone();return res.red=null,res},BN.mont=function mont(num){return new Mont(num)},inherits(Mont,Red),Mont.prototype.convertTo=function convertTo(num){return this.imod(num.ushln(this.shift))},Mont.prototype.convertFrom=function convertFrom(num){var r=this.imod(num.mul(this.rinv));return r.red=null,r},Mont.prototype.imul=function imul(a,b){if(a.isZero()||b.isZero())return a.words[0]=0,a.length=1,a;var t=a.imul(b),c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=t.isub(c).iushrn(this.shift),res=u;return u.cmp(this.m)>=0?res=u.isub(this.m):u.cmpn(0)<0&&(res=u.iadd(this.m)),res._forceRed(this)},Mont.prototype.mul=function mul(a,b){if(a.isZero()||b.isZero())return new BN(0)._forceRed(this);var t=a.mul(b),c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=t.isub(c).iushrn(this.shift),res=u;return u.cmp(this.m)>=0?res=u.isub(this.m):u.cmpn(0)<0&&(res=u.iadd(this.m)),res._forceRed(this)},Mont.prototype.invm=function invm(a){return this.imod(a._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===module||module,this)},{buffer:90}],82:[function(_dereq_,module,exports){"use strict";module.exports=function boundary(cells){var i,j,k,n=cells.length,sz=0;for(i=0;i<n;++i)sz+=cells[i].length;var result=new Array(sz),ptr=0;for(i=0;i<n;++i){var c=cells[i],d=c.length;for(j=0;j<d;++j){var b=result[ptr++]=new Array(d-1),p=0;for(k=0;k<d;++k)k!==j&&(b[p++]=c[k]);if(1&j){var tmp=b[1];b[1]=b[0],b[0]=tmp}}}return result}},{}],83:[function(_dereq_,module,exports){"use strict";module.exports=function boxIntersectWrapper(arg0,arg1,arg2){switch(arguments.length){case 1:return function intersectFullArray(x){return RESULT=[],boxIntersect(x,x,appendItem,!0),RESULT}(arg0);case 2:return"function"==typeof arg1?boxIntersect(arg0,arg0,arg1,!0):function intersectBipartiteArray(x,y){return RESULT=[],boxIntersect(x,y,appendItem,!1),RESULT}(arg0,arg1);case 3:return boxIntersect(arg0,arg1,arg2,!1);default:throw new Error("box-intersect: Invalid arguments")}};var RESULT,pool=_dereq_("typedarray-pool"),sweep=_dereq_("./lib/sweep"),boxIntersectIter=_dereq_("./lib/intersect");function boxEmpty(d,box){for(var j=0;j<d;++j)if(!(box[j]<=box[j+d]))return!0;return!1}function convertBoxes(boxes,d,data,ids){for(var ptr=0,count=0,i=0,n=boxes.length;i<n;++i){var b=boxes[i];if(!boxEmpty(d,b)){for(var j=0;j<2*d;++j)data[ptr++]=b[j];ids[count++]=i}}return count}function boxIntersect(red,blue,visit,full){var n=red.length,m=blue.length;if(!(n<=0||m<=0)){var d=red[0].length>>>1;if(!(d<=0)){var retval,redList=pool.mallocDouble(2*d*n),redIds=pool.mallocInt32(n);if((n=convertBoxes(red,d,redList,redIds))>0){if(1===d&&full)sweep.init(n),retval=sweep.sweepComplete(d,visit,0,n,redList,redIds,0,n,redList,redIds);else{var blueList=pool.mallocDouble(2*d*m),blueIds=pool.mallocInt32(m);(m=convertBoxes(blue,d,blueList,blueIds))>0&&(sweep.init(n+m),retval=1===d?sweep.sweepBipartite(d,visit,0,n,redList,redIds,0,m,blueList,blueIds):boxIntersectIter(d,visit,full,n,redList,redIds,m,blueList,blueIds),pool.free(blueList),pool.free(blueIds))}pool.free(redList),pool.free(redIds)}return retval}}}function appendItem(i,j){RESULT.push([i,j])}},{"./lib/intersect":85,"./lib/sweep":89,"typedarray-pool":519}],84:[function(_dereq_,module,exports){"use strict";var DIMENSION="d",AXIS="ax",VISIT="vv",FLIP="fp",ELEM_SIZE="es",RED_START="rs",RED_END="re",RED_BOXES="rb",RED_INDEX="ri",RED_PTR="rp",BLUE_START="bs",BLUE_END="be",BLUE_BOXES="bb",BLUE_INDEX="bi",BLUE_PTR="bp",RETVAL="rv",INNER_LABEL="Q",ARGS=[DIMENSION,AXIS,VISIT,RED_START,RED_END,RED_BOXES,RED_INDEX,BLUE_START,BLUE_END,BLUE_BOXES,BLUE_INDEX];function bruteForcePlanner(full){var funcName="bruteForce"+(full?"Full":"Partial"),prefix=[],fargs=ARGS.slice();full||fargs.splice(3,0,FLIP);var code=["function "+funcName+"("+fargs.join()+"){"];function invoke(redMajor,flip){var res=function generateBruteForce(redMajor,flip,full){var funcName="bruteForce"+(redMajor?"Red":"Blue")+(flip?"Flip":"")+(full?"Full":""),code=["function ",funcName,"(",ARGS.join(),"){","var ",ELEM_SIZE,"=2*",DIMENSION,";"],redLoop="for(var i="+RED_START+","+RED_PTR+"="+ELEM_SIZE+"*"+RED_START+";i<"+RED_END+";++i,"+RED_PTR+"+="+ELEM_SIZE+"){var x0="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"],x1="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"+"+DIMENSION+"],xi="+RED_INDEX+"[i];",blueLoop="for(var j="+BLUE_START+","+BLUE_PTR+"="+ELEM_SIZE+"*"+BLUE_START+";j<"+BLUE_END+";++j,"+BLUE_PTR+"+="+ELEM_SIZE+"){var y0="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"],"+(full?"y1="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"+"+DIMENSION+"],":"")+"yi="+BLUE_INDEX+"[j];";return redMajor?code.push(redLoop,INNER_LABEL,":",blueLoop):code.push(blueLoop,INNER_LABEL,":",redLoop),full?code.push("if(y1<x0||x1<y0)continue;"):flip?code.push("if(y0<=x0||x1<y0)continue;"):code.push("if(y0<x0||x1<y0)continue;"),code.push("for(var k="+AXIS+"+1;k<"+DIMENSION+";++k){var r0="+RED_BOXES+"[k+"+RED_PTR+"],r1="+RED_BOXES+"[k+"+DIMENSION+"+"+RED_PTR+"],b0="+BLUE_BOXES+"[k+"+BLUE_PTR+"],b1="+BLUE_BOXES+"[k+"+DIMENSION+"+"+BLUE_PTR+"];if(r1<b0||b1<r0)continue "+INNER_LABEL+";}var "+RETVAL+"="+VISIT+"("),flip?code.push("yi,xi"):code.push("xi,yi"),code.push(");if("+RETVAL+"!==void 0)return "+RETVAL+";}}}"),{name:funcName,code:code.join("")}}(redMajor,flip,full);prefix.push(res.code),code.push("return "+res.name+"("+ARGS.join()+");")}code.push("if("+RED_END+"-"+RED_START+">"+BLUE_END+"-"+BLUE_START+"){"),full?(invoke(!0,!1),code.push("}else{"),invoke(!1,!1)):(code.push("if("+FLIP+"){"),invoke(!0,!0),code.push("}else{"),invoke(!0,!1),code.push("}}else{if("+FLIP+"){"),invoke(!1,!0),code.push("}else{"),invoke(!1,!1),code.push("}")),code.push("}}return "+funcName);var codeStr=prefix.join("")+code.join("");return new Function(codeStr)()}exports.partial=bruteForcePlanner(!1),exports.full=bruteForcePlanner(!0)},{}],85:[function(_dereq_,module,exports){"use strict";module.exports=function boxIntersectIter(d,visit,initFull,xSize,xBoxes,xIndex,ySize,yBoxes,yIndex){!function iterInit(d,count){var levels=8*bits.log2(count+1)*(d+1)|0,maxInts=bits.nextPow2(IFRAME_SIZE*levels);BOX_ISTACK.length<maxInts&&(pool.free(BOX_ISTACK),BOX_ISTACK=pool.mallocInt32(maxInts));var maxDoubles=bits.nextPow2(DFRAME_SIZE*levels);BOX_DSTACK<maxDoubles&&(pool.free(BOX_DSTACK),BOX_DSTACK=pool.mallocDouble(maxDoubles))}(d,xSize+ySize);var retval,top=0,elemSize=2*d;iterPush(top++,0,0,xSize,0,ySize,initFull?16:0,-1/0,1/0),initFull||iterPush(top++,0,0,ySize,0,xSize,1,-1/0,1/0);for(;top>0;){var iptr=(top-=1)*IFRAME_SIZE,axis=BOX_ISTACK[iptr],redStart=BOX_ISTACK[iptr+1],redEnd=BOX_ISTACK[iptr+2],blueStart=BOX_ISTACK[iptr+3],blueEnd=BOX_ISTACK[iptr+4],state=BOX_ISTACK[iptr+5],dptr=top*DFRAME_SIZE,lo=BOX_DSTACK[dptr],hi=BOX_DSTACK[dptr+1],flip=1&state,full=!!(16&state),red=xBoxes,redIndex=xIndex,blue=yBoxes,blueIndex=yIndex;if(flip&&(red=yBoxes,redIndex=yIndex,blue=xBoxes,blueIndex=xIndex),!(2&state&&(redEnd=partitionStartLessThan(d,axis,redStart,redEnd,red,redIndex,hi),redStart>=redEnd)||4&state&&(redStart=partitionEndLessThanEqual(d,axis,redStart,redEnd,red,redIndex,lo))>=redEnd)){var redCount=redEnd-redStart,blueCount=blueEnd-blueStart;if(full){if(d*redCount*(redCount+blueCount)<SCAN_COMPLETE_CUTOFF){if(void 0!==(retval=sweep.scanComplete(d,axis,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex)))return retval;continue}}else{if(d*Math.min(redCount,blueCount)<BRUTE_FORCE_CUTOFF){if(void 0!==(retval=bruteForcePartial(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex)))return retval;continue}if(d*redCount*blueCount<SCAN_CUTOFF){if(void 0!==(retval=sweep.scanBipartite(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex)))return retval;continue}}var red0=partitionInteriorContainsInterval(d,axis,redStart,redEnd,red,redIndex,lo,hi);if(redStart<red0)if(d*(red0-redStart)<BRUTE_FORCE_CUTOFF){if(void 0!==(retval=bruteForceFull(d,axis+1,visit,redStart,red0,red,redIndex,blueStart,blueEnd,blue,blueIndex)))return retval}else if(axis===d-2){if(void 0!==(retval=flip?sweep.sweepBipartite(d,visit,blueStart,blueEnd,blue,blueIndex,redStart,red0,red,redIndex):sweep.sweepBipartite(d,visit,redStart,red0,red,redIndex,blueStart,blueEnd,blue,blueIndex)))return retval}else iterPush(top++,axis+1,redStart,red0,blueStart,blueEnd,flip,-1/0,1/0),iterPush(top++,axis+1,blueStart,blueEnd,redStart,red0,1^flip,-1/0,1/0);if(red0<redEnd){var blue0=findMedian(d,axis,blueStart,blueEnd,blue,blueIndex),mid=blue[elemSize*blue0+axis],blue1=partitionStartEqual(d,axis,blue0,blueEnd,blue,blueIndex,mid);if(blue1<blueEnd&&iterPush(top++,axis,red0,redEnd,blue1,blueEnd,(4|flip)+(full?16:0),mid,hi),blueStart<blue0&&iterPush(top++,axis,red0,redEnd,blueStart,blue0,(2|flip)+(full?16:0),lo,mid),blue0+1===blue1){if(void 0!==(retval=full?onePointFull(d,axis,visit,red0,redEnd,red,redIndex,blue0,blue,blueIndex[blue0]):onePointPartial(d,axis,visit,flip,red0,redEnd,red,redIndex,blue0,blue,blueIndex[blue0])))return retval}else if(blue0<blue1){var red1;if(full){if(red1=partitionContainsPoint(d,axis,red0,redEnd,red,redIndex,mid),red0<red1){var redX=partitionStartEqual(d,axis,red0,red1,red,redIndex,mid);if(axis===d-2){if(red0<redX&&void 0!==(retval=sweep.sweepComplete(d,visit,red0,redX,red,redIndex,blue0,blue1,blue,blueIndex)))return retval;if(redX<red1&&void 0!==(retval=sweep.sweepBipartite(d,visit,redX,red1,red,redIndex,blue0,blue1,blue,blueIndex)))return retval}else red0<redX&&iterPush(top++,axis+1,red0,redX,blue0,blue1,16,-1/0,1/0),redX<red1&&(iterPush(top++,axis+1,redX,red1,blue0,blue1,0,-1/0,1/0),iterPush(top++,axis+1,blue0,blue1,redX,red1,1,-1/0,1/0))}}else red1=flip?partitionContainsPointProper(d,axis,red0,redEnd,red,redIndex,mid):partitionContainsPoint(d,axis,red0,redEnd,red,redIndex,mid),red0<red1&&(axis===d-2?retval=flip?sweep.sweepBipartite(d,visit,blue0,blue1,blue,blueIndex,red0,red1,red,redIndex):sweep.sweepBipartite(d,visit,red0,red1,red,redIndex,blue0,blue1,blue,blueIndex):(iterPush(top++,axis+1,red0,red1,blue0,blue1,flip,-1/0,1/0),iterPush(top++,axis+1,blue0,blue1,red0,red1,1^flip,-1/0,1/0)))}}}}};var pool=_dereq_("typedarray-pool"),bits=_dereq_("bit-twiddle"),bruteForce=_dereq_("./brute"),bruteForcePartial=bruteForce.partial,bruteForceFull=bruteForce.full,sweep=_dereq_("./sweep"),findMedian=_dereq_("./median"),genPartition=_dereq_("./partition"),BRUTE_FORCE_CUTOFF=128,SCAN_CUTOFF=1<<22,SCAN_COMPLETE_CUTOFF=1<<22,partitionInteriorContainsInterval=genPartition("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),partitionStartEqual=genPartition("lo===p0",["p0"]),partitionStartLessThan=genPartition("lo<p0",["p0"]),partitionEndLessThanEqual=genPartition("hi<=p0",["p0"]),partitionContainsPoint=genPartition("lo<=p0&&p0<=hi",["p0"]),partitionContainsPointProper=genPartition("lo<p0&&p0<=hi",["p0"]),IFRAME_SIZE=6,DFRAME_SIZE=2,BOX_ISTACK=pool.mallocInt32(1024),BOX_DSTACK=pool.mallocDouble(1024);function iterPush(ptr,axis,redStart,redEnd,blueStart,blueEnd,state,lo,hi){var iptr=IFRAME_SIZE*ptr;BOX_ISTACK[iptr]=axis,BOX_ISTACK[iptr+1]=redStart,BOX_ISTACK[iptr+2]=redEnd,BOX_ISTACK[iptr+3]=blueStart,BOX_ISTACK[iptr+4]=blueEnd,BOX_ISTACK[iptr+5]=state;var dptr=DFRAME_SIZE*ptr;BOX_DSTACK[dptr]=lo,BOX_DSTACK[dptr+1]=hi}function onePointPartial(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueOffset,blue,blueId){var elemSize=2*d,bluePtr=blueOffset*elemSize,blueX=blue[bluePtr+axis];red_loop:for(var i=redStart,redPtr=redStart*elemSize;i<redEnd;++i,redPtr+=elemSize){var r0=red[redPtr+axis],r1=red[redPtr+axis+d];if(!(blueX<r0||r1<blueX)&&(!flip||blueX!==r0)){for(var retval,redId=redIndex[i],j=axis+1;j<d;++j){r0=red[redPtr+j],r1=red[redPtr+j+d];var b0=blue[bluePtr+j],b1=blue[bluePtr+j+d];if(r1<b0||b1<r0)continue red_loop}if(void 0!==(retval=flip?visit(blueId,redId):visit(redId,blueId)))return retval}}}function onePointFull(d,axis,visit,redStart,redEnd,red,redIndex,blueOffset,blue,blueId){var elemSize=2*d,bluePtr=blueOffset*elemSize,blueX=blue[bluePtr+axis];red_loop:for(var i=redStart,redPtr=redStart*elemSize;i<redEnd;++i,redPtr+=elemSize){var redId=redIndex[i];if(redId!==blueId){var r0=red[redPtr+axis],r1=red[redPtr+axis+d];if(!(blueX<r0||r1<blueX)){for(var j=axis+1;j<d;++j){r0=red[redPtr+j],r1=red[redPtr+j+d];var b0=blue[bluePtr+j],b1=blue[bluePtr+j+d];if(r1<b0||b1<r0)continue red_loop}var retval=visit(redId,blueId);if(void 0!==retval)return retval}}}}},{"./brute":84,"./median":86,"./partition":87,"./sweep":89,"bit-twiddle":79,"typedarray-pool":519}],86:[function(_dereq_,module,exports){"use strict";module.exports=function findMedian(d,axis,start,end,boxes,ids){if(end<=start+1)return start;var lo=start,hi=end,mid=end+start>>>1,elemSize=2*d,pivot=mid,value=boxes[elemSize*mid+axis];for(;lo<hi;){if(hi-lo<PARTITION_THRESHOLD){insertionSort(d,axis,lo,hi,boxes,ids),value=boxes[elemSize*mid+axis];break}var count=hi-lo,pivot0=Math.random()*count+lo|0,value0=boxes[elemSize*pivot0+axis],pivot1=Math.random()*count+lo|0,value1=boxes[elemSize*pivot1+axis],pivot2=Math.random()*count+lo|0,value2=boxes[elemSize*pivot2+axis];value0<=value1?value2>=value1?(pivot=pivot1,value=value1):value0>=value2?(pivot=pivot0,value=value0):(pivot=pivot2,value=value2):value1>=value2?(pivot=pivot1,value=value1):value2>=value0?(pivot=pivot0,value=value0):(pivot=pivot2,value=value2);for(var aPtr=elemSize*(hi-1),bPtr=elemSize*pivot,i=0;i<elemSize;++i,++aPtr,++bPtr){var x=boxes[aPtr];boxes[aPtr]=boxes[bPtr],boxes[bPtr]=x}var y=ids[hi-1];ids[hi-1]=ids[pivot],ids[pivot]=y,pivot=partitionStartLessThan(d,axis,lo,hi-1,boxes,ids,value);for(var aPtr=elemSize*(hi-1),bPtr=elemSize*pivot,i=0;i<elemSize;++i,++aPtr,++bPtr){var x=boxes[aPtr];boxes[aPtr]=boxes[bPtr],boxes[bPtr]=x}var y=ids[hi-1];if(ids[hi-1]=ids[pivot],ids[pivot]=y,mid<pivot){for(hi=pivot-1;lo<hi&&boxes[elemSize*(hi-1)+axis]===value;)hi-=1;hi+=1}else{if(!(pivot<mid))break;for(lo=pivot+1;lo<hi&&boxes[elemSize*lo+axis]===value;)lo+=1}}return partitionStartLessThan(d,axis,start,mid,boxes,ids,boxes[elemSize*mid+axis])};var partitionStartLessThan=_dereq_("./partition")("lo<p0",["p0"]),PARTITION_THRESHOLD=8;function insertionSort(d,axis,start,end,boxes,ids){for(var elemSize=2*d,boxPtr=elemSize*(start+1)+axis,i=start+1;i<end;++i,boxPtr+=elemSize)for(var x=boxes[boxPtr],j=i,ptr=elemSize*(i-1);j>start&&boxes[ptr+axis]>x;--j,ptr-=elemSize){for(var aPtr=ptr,bPtr=ptr+elemSize,k=0;k<elemSize;++k,++aPtr,++bPtr){var y=boxes[aPtr];boxes[aPtr]=boxes[bPtr],boxes[bPtr]=y}var tmp=ids[j];ids[j]=ids[j-1],ids[j-1]=tmp}}},{"./partition":87}],87:[function(_dereq_,module,exports){"use strict";module.exports=function genPartition(predicate,args){var fargs="abcdef".split("").concat(args),reads=[];predicate.indexOf("lo")>=0&&reads.push("lo=e[k+n]");predicate.indexOf("hi")>=0&&reads.push("hi=e[k+o]");return fargs.push(code.replace("_",reads.join()).replace("$",predicate)),Function.apply(void 0,fargs)};var code="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},{}],88:[function(_dereq_,module,exports){"use strict";module.exports=function wrapper(data,n0){n0<=4*INSERT_SORT_CUTOFF?insertionSort(0,n0-1,data):function quickSort(left,right,data){var sixth=(right-left+1)/6|0,index1=left+sixth,index5=right-sixth,index3=left+right>>1,index2=index3-sixth,index4=index3+sixth,el1=index1,el2=index2,el3=index3,el4=index4,el5=index5,less=left+1,great=right-1,tmp=0;compare(el1,el2,data)&&(tmp=el1,el1=el2,el2=tmp);compare(el4,el5,data)&&(tmp=el4,el4=el5,el5=tmp);compare(el1,el3,data)&&(tmp=el1,el1=el3,el3=tmp);compare(el2,el3,data)&&(tmp=el2,el2=el3,el3=tmp);compare(el1,el4,data)&&(tmp=el1,el1=el4,el4=tmp);compare(el3,el4,data)&&(tmp=el3,el3=el4,el4=tmp);compare(el2,el5,data)&&(tmp=el2,el2=el5,el5=tmp);compare(el2,el3,data)&&(tmp=el2,el2=el3,el3=tmp);compare(el4,el5,data)&&(tmp=el4,el4=el5,el5=tmp);var pivot1X=data[2*el2];var pivot1Y=data[2*el2+1];var pivot2X=data[2*el4];var pivot2Y=data[2*el4+1];var ptr0=2*el1;var ptr2=2*el3;var ptr4=2*el5;var ptr5=2*index1;var ptr6=2*index3;var ptr7=2*index5;for(var i1=0;i1<2;++i1){var x=data[ptr0+i1],y=data[ptr2+i1],z=data[ptr4+i1];data[ptr5+i1]=x,data[ptr6+i1]=y,data[ptr7+i1]=z}move(index2,left,data);move(index4,right,data);for(var k=less;k<=great;++k)if(comparePivot(k,pivot1X,pivot1Y,data))k!==less&&swap(k,less,data),++less;else if(!comparePivot(k,pivot2X,pivot2Y,data))for(;;){if(comparePivot(great,pivot2X,pivot2Y,data)){comparePivot(great,pivot1X,pivot1Y,data)?(rotate(k,less,great,data),++less,--great):(swap(k,great,data),--great);break}if(--great<k)break}shufflePivot(left,less-1,pivot1X,pivot1Y,data);shufflePivot(right,great+1,pivot2X,pivot2Y,data);less-2-left<=INSERT_SORT_CUTOFF?insertionSort(left,less-2,data):quickSort(left,less-2,data);right-(great+2)<=INSERT_SORT_CUTOFF?insertionSort(great+2,right,data):quickSort(great+2,right,data);great-less<=INSERT_SORT_CUTOFF?insertionSort(less,great,data):quickSort(less,great,data)}(0,n0-1,data)};var INSERT_SORT_CUTOFF=32;function insertionSort(left,right,data){for(var ptr=2*(left+1),i=left+1;i<=right;++i){for(var a=data[ptr++],b=data[ptr++],j=i,jptr=ptr-2;j-- >left;){var x=data[jptr-2],y=data[jptr-1];if(x<a)break;if(x===a&&y<b)break;data[jptr]=x,data[jptr+1]=y,jptr-=2}data[jptr]=a,data[jptr+1]=b}}function swap(i,j,data){j*=2;var x=data[i*=2],y=data[i+1];data[i]=data[j],data[i+1]=data[j+1],data[j]=x,data[j+1]=y}function move(i,j,data){j*=2,data[i*=2]=data[j],data[i+1]=data[j+1]}function rotate(i,j,k,data){j*=2,k*=2;var x=data[i*=2],y=data[i+1];data[i]=data[j],data[i+1]=data[j+1],data[j]=data[k],data[j+1]=data[k+1],data[k]=x,data[k+1]=y}function shufflePivot(i,j,px,py,data){j*=2,data[i*=2]=data[j],data[j]=px,data[i+1]=data[j+1],data[j+1]=py}function compare(i,j,data){j*=2;var x=data[i*=2],y=data[j];return!(x<y)&&(x!==y||data[i+1]>data[j+1])}function comparePivot(i,y,b,data){var x=data[i*=2];return x<y||x===y&&data[i+1]<b}},{}],89:[function(_dereq_,module,exports){"use strict";module.exports={init:function sqInit(count){var rcount=bits.nextPow2(count);RED_SWEEP_QUEUE.length<rcount&&(pool.free(RED_SWEEP_QUEUE),RED_SWEEP_QUEUE=pool.mallocInt32(rcount));RED_SWEEP_INDEX.length<rcount&&(pool.free(RED_SWEEP_INDEX),RED_SWEEP_INDEX=pool.mallocInt32(rcount));BLUE_SWEEP_QUEUE.length<rcount&&(pool.free(BLUE_SWEEP_QUEUE),BLUE_SWEEP_QUEUE=pool.mallocInt32(rcount));BLUE_SWEEP_INDEX.length<rcount&&(pool.free(BLUE_SWEEP_INDEX),BLUE_SWEEP_INDEX=pool.mallocInt32(rcount));COMMON_SWEEP_QUEUE.length<rcount&&(pool.free(COMMON_SWEEP_QUEUE),COMMON_SWEEP_QUEUE=pool.mallocInt32(rcount));COMMON_SWEEP_INDEX.length<rcount&&(pool.free(COMMON_SWEEP_INDEX),COMMON_SWEEP_INDEX=pool.mallocInt32(rcount));var eventLength=8*rcount;SWEEP_EVENTS.length<eventLength&&(pool.free(SWEEP_EVENTS),SWEEP_EVENTS=pool.mallocDouble(eventLength))},sweepBipartite:function sweepBipartite(d,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){for(var ptr=0,elemSize=2*d,istart=d-1,iend=elemSize-1,i=redStart;i<redEnd;++i){var idx=redIndex[i],redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart],SWEEP_EVENTS[ptr++]=-(idx+1),SWEEP_EVENTS[ptr++]=red[redOffset+iend],SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=blueIndex[i]+BLUE_FLAG,blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart],SWEEP_EVENTS[ptr++]=-idx,SWEEP_EVENTS[ptr++]=blue[blueOffset+iend],SWEEP_EVENTS[ptr++]=idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);for(var redActive=0,blueActive=0,i=0;i<n;++i){var e=0|SWEEP_EVENTS[2*i+1];if(e>=BLUE_FLAG)sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive--,e=e-BLUE_FLAG|0);else if(e>=0)sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,e);else if(e<=-BLUE_FLAG){e=-e-BLUE_FLAG|0;for(var j=0;j<redActive;++j){var retval=visit(RED_SWEEP_QUEUE[j],e);if(void 0!==retval)return retval}sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive++,e)}else{e=-e-1|0;for(var j=0;j<blueActive;++j){var retval=visit(e,BLUE_SWEEP_QUEUE[j]);if(void 0!==retval)return retval}sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,e)}}},sweepComplete:function sweepComplete(d,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){for(var ptr=0,elemSize=2*d,istart=d-1,iend=elemSize-1,i=redStart;i<redEnd;++i){var idx=redIndex[i]+1<<1,redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart],SWEEP_EVENTS[ptr++]=-idx,SWEEP_EVENTS[ptr++]=red[redOffset+iend],SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=blueIndex[i]+1<<1,blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart],SWEEP_EVENTS[ptr++]=1|-idx,SWEEP_EVENTS[ptr++]=blue[blueOffset+iend],SWEEP_EVENTS[ptr++]=1|idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);for(var redActive=0,blueActive=0,commonActive=0,i=0;i<n;++i){var e=0|SWEEP_EVENTS[2*i+1],color=1&e;if(i<n-1&&e>>1==SWEEP_EVENTS[2*i+3]>>1&&(color=2,i+=1),e<0){for(var id=-(e>>1)-1,j=0;j<commonActive;++j){var retval=visit(COMMON_SWEEP_QUEUE[j],id);if(void 0!==retval)return retval}if(0!==color)for(var j=0;j<redActive;++j){var retval=visit(RED_SWEEP_QUEUE[j],id);if(void 0!==retval)return retval}if(1!==color)for(var j=0;j<blueActive;++j){var retval=visit(BLUE_SWEEP_QUEUE[j],id);if(void 0!==retval)return retval}0===color?sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,id):1===color?sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive++,id):2===color&&sqPush(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,commonActive++,id)}else{var id=(e>>1)-1;0===color?sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,id):1===color?sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive--,id):2===color&&sqPop(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,commonActive--,id)}}},scanBipartite:function scanBipartite(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){var ptr=0,elemSize=2*d,istart=axis,iend=axis+d,redShift=1,blueShift=1;flip?blueShift=BLUE_FLAG:redShift=BLUE_FLAG;for(var i=redStart;i<redEnd;++i){var idx=i+redShift,redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart],SWEEP_EVENTS[ptr++]=-idx,SWEEP_EVENTS[ptr++]=red[redOffset+iend],SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=i+blueShift,blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart],SWEEP_EVENTS[ptr++]=-idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);for(var redActive=0,i=0;i<n;++i){var e=0|SWEEP_EVENTS[2*i+1];if(e<0){var idx=-e,isRed=!1;if(idx>=BLUE_FLAG?(isRed=!flip,idx-=BLUE_FLAG):(isRed=!!flip,idx-=1),isRed)sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,idx);else{var blueId=blueIndex[idx],bluePtr=elemSize*idx,b0=blue[bluePtr+axis+1],b1=blue[bluePtr+axis+1+d];red_loop:for(var j=0;j<redActive;++j){var oidx=RED_SWEEP_QUEUE[j],redPtr=elemSize*oidx;if(!(b1<red[redPtr+axis+1]||red[redPtr+axis+1+d]<b0)){for(var k=axis+2;k<d;++k)if(blue[bluePtr+k+d]<red[redPtr+k]||red[redPtr+k+d]<blue[bluePtr+k])continue red_loop;var retval,redId=redIndex[oidx];if(void 0!==(retval=flip?visit(blueId,redId):visit(redId,blueId)))return retval}}}}else sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,e-redShift)}},scanComplete:function scanComplete(d,axis,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){for(var ptr=0,elemSize=2*d,istart=axis,iend=axis+d,i=redStart;i<redEnd;++i){var idx=i+BLUE_FLAG,redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart],SWEEP_EVENTS[ptr++]=-idx,SWEEP_EVENTS[ptr++]=red[redOffset+iend],SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=i+1,blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart],SWEEP_EVENTS[ptr++]=-idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);for(var redActive=0,i=0;i<n;++i){var e=0|SWEEP_EVENTS[2*i+1];if(e<0){var idx=-e;if(idx>=BLUE_FLAG)RED_SWEEP_QUEUE[redActive++]=idx-BLUE_FLAG;else{var blueId=blueIndex[idx-=1],bluePtr=elemSize*idx,b0=blue[bluePtr+axis+1],b1=blue[bluePtr+axis+1+d];red_loop:for(var j=0;j<redActive;++j){var oidx=RED_SWEEP_QUEUE[j],redId=redIndex[oidx];if(redId===blueId)break;var redPtr=elemSize*oidx;if(!(b1<red[redPtr+axis+1]||red[redPtr+axis+1+d]<b0)){for(var k=axis+2;k<d;++k)if(blue[bluePtr+k+d]<red[redPtr+k]||red[redPtr+k+d]<blue[bluePtr+k])continue red_loop;var retval=visit(redId,blueId);if(void 0!==retval)return retval}}}}else{for(var idx=e-BLUE_FLAG,j=redActive-1;j>=0;--j)if(RED_SWEEP_QUEUE[j]===idx){for(var k=j+1;k<redActive;++k)RED_SWEEP_QUEUE[k-1]=RED_SWEEP_QUEUE[k];break}--redActive}}}};var pool=_dereq_("typedarray-pool"),bits=_dereq_("bit-twiddle"),isort=_dereq_("./sort"),BLUE_FLAG=1<<28,RED_SWEEP_QUEUE=pool.mallocInt32(1024),RED_SWEEP_INDEX=pool.mallocInt32(1024),BLUE_SWEEP_QUEUE=pool.mallocInt32(1024),BLUE_SWEEP_INDEX=pool.mallocInt32(1024),COMMON_SWEEP_QUEUE=pool.mallocInt32(1024),COMMON_SWEEP_INDEX=pool.mallocInt32(1024),SWEEP_EVENTS=pool.mallocDouble(8192);function sqPop(queue,index,count,item){var idx=index[item],top=queue[count-1];queue[idx]=top,index[top]=idx}function sqPush(queue,index,count,item){queue[count]=item,index[item]=count}},{"./sort":88,"bit-twiddle":79,"typedarray-pool":519}],90:[function(_dereq_,module,exports){},{}],91:[function(_dereq_,module,exports){var objectCreate=Object.create||function objectCreatePolyfill(proto){var F=function(){};return F.prototype=proto,new F},objectKeys=Object.keys||function objectKeysPolyfill(obj){var keys=[];for(var k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k},bind=Function.prototype.bind||function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}};function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&m>0&&existing.length>m){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",w.name,w.message)}}else existing=events[type]=listener,++target._eventsCount;return target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=bind.call(onceWrapper,state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];return evlistener?"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length):[]}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError){if(arguments.length>1&&(er=arguments[1]),er instanceof Error)throw er;var err=new Error('Unhandled "error" event. ('+er+")");throw err.context=er,err}if(!(handler=events[type]))return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:!function emitNone(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];!function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function once(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]),this;if(0===arguments.length){var key,keys=objectKeys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],92:[function(_dereq_,module,exports){"use strict";var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function SlowBuffer(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function fromString(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return buf.__proto__=Buffer.prototype,buf}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function isBuffer(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function toString(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function inspect(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function includes(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function write(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function readInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function fill(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function base64clean(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}},{"base64-js":61,ieee754:393}],93:[function(_dereq_,module,exports){"use strict";var monotoneTriangulate=_dereq_("./lib/monotone"),makeIndex=_dereq_("./lib/triangulation"),delaunayFlip=_dereq_("./lib/delaunay"),filterTriangulation=_dereq_("./lib/filter");function canonicalizeEdge(e){return[Math.min(e[0],e[1]),Math.max(e[0],e[1])]}function compareEdge(a,b){return a[0]-b[0]||a[1]-b[1]}function getDefault(options,property,dflt){return property in options?options[property]:dflt}module.exports=function cdt2d(points,edges,options){Array.isArray(edges)?(options=options||{},edges=edges||[]):(options=edges||{},edges=[]);var delaunay=!!getDefault(options,"delaunay",!0),interior=!!getDefault(options,"interior",!0),exterior=!!getDefault(options,"exterior",!0),infinity=!!getDefault(options,"infinity",!1);if(!interior&&!exterior||0===points.length)return[];var cells=monotoneTriangulate(points,edges);if(delaunay||interior!==exterior||infinity){for(var triangulation=makeIndex(points.length,function canonicalizeEdges(edges){return edges.map(canonicalizeEdge).sort(compareEdge)}(edges)),i=0;i<cells.length;++i){var f=cells[i];triangulation.addTriangle(f[0],f[1],f[2])}return delaunay&&delaunayFlip(points,triangulation),exterior?interior?infinity?filterTriangulation(triangulation,0,infinity):triangulation.cells():filterTriangulation(triangulation,1,infinity):filterTriangulation(triangulation,-1)}return cells}},{"./lib/delaunay":94,"./lib/filter":95,"./lib/monotone":96,"./lib/triangulation":97}],94:[function(_dereq_,module,exports){"use strict";var inCircle=_dereq_("robust-in-sphere")[4];_dereq_("binary-search-bounds");function testFlip(points,triangulation,stack,a,b,x){var y=triangulation.opposite(a,b);if(!(y<0)){if(b<a){var tmp=a;a=b,b=tmp,tmp=x,x=y,y=tmp}triangulation.isConstraint(a,b)||inCircle(points[a],points[b],points[x],points[y])<0&&stack.push(a,b)}}module.exports=function delaunayRefine(points,triangulation){for(var stack=[],numPoints=points.length,stars=triangulation.stars,a=0;a<numPoints;++a)for(var star=stars[a],j=1;j<star.length;j+=2){var b=star[j];if(!(b<a)&&!triangulation.isConstraint(a,b)){for(var x=star[j-1],y=-1,k=1;k<star.length;k+=2)if(star[k-1]===b){y=star[k];break}y<0||inCircle(points[a],points[b],points[x],points[y])<0&&stack.push(a,b)}}for(;stack.length>0;){for(var b=stack.pop(),a=stack.pop(),x=-1,y=-1,star=stars[a],i=1;i<star.length;i+=2){var s=star[i-1],t=star[i];s===b?y=t:t===b&&(x=s)}x<0||y<0||(inCircle(points[a],points[b],points[x],points[y])>=0||(triangulation.flip(a,b),testFlip(points,triangulation,stack,x,a,y),testFlip(points,triangulation,stack,a,y,x),testFlip(points,triangulation,stack,y,b,x),testFlip(points,triangulation,stack,b,x,y)))}}},{"binary-search-bounds":98,"robust-in-sphere":481}],95:[function(_dereq_,module,exports){"use strict";var key,bsearch=_dereq_("binary-search-bounds");function FaceIndex(cells,neighbor,constraint,flags,active,next,boundary){this.cells=cells,this.neighbor=neighbor,this.flags=flags,this.constraint=constraint,this.active=active,this.next=next,this.boundary=boundary}function compareCell(a,b){return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}module.exports=function classifyFaces(triangulation,target,infinity){var index=function indexCells(triangulation,infinity){for(var cells=triangulation.cells(),nc=cells.length,i=0;i<nc;++i){var c=cells[i],x=c[0],y=c[1],z=c[2];y<z?y<x&&(c[0]=y,c[1]=z,c[2]=x):z<x&&(c[0]=z,c[1]=x,c[2]=y)}cells.sort(compareCell);for(var flags=new Array(nc),i=0;i<flags.length;++i)flags[i]=0;var active=[],next=[],neighbor=new Array(3*nc),constraint=new Array(3*nc),boundary=null;infinity&&(boundary=[]);for(var index=new FaceIndex(cells,neighbor,constraint,flags,active,next,boundary),i=0;i<nc;++i)for(var c=cells[i],j=0;j<3;++j){var x=c[j],y=c[(j+1)%3],a=neighbor[3*i+j]=index.locate(y,x,triangulation.opposite(y,x)),b=constraint[3*i+j]=triangulation.isConstraint(x,y);a<0&&(b?next.push(i):(active.push(i),flags[i]=1),infinity&&boundary.push([y,x,-1]))}return index}(triangulation,infinity);if(0===target)return infinity?index.cells.concat(index.boundary):index.cells;var side=1,active=index.active,next=index.next,flags=index.flags,cells=index.cells,constraint=index.constraint,neighbor=index.neighbor;for(;active.length>0||next.length>0;){for(;active.length>0;){var t=active.pop();if(flags[t]!==-side){flags[t]=side;cells[t];for(var j=0;j<3;++j){var f=neighbor[3*t+j];f>=0&&0===flags[f]&&(constraint[3*t+j]?next.push(f):(active.push(f),flags[f]=side))}}}var tmp=next;next=active,active=tmp,next.length=0,side=-side}var result=function filterCells(cells,flags,target){for(var ptr=0,i=0;i<cells.length;++i)flags[i]===target&&(cells[ptr++]=cells[i]);return cells.length=ptr,cells}(cells,flags,target);if(infinity)return result.concat(index.boundary);return result},FaceIndex.prototype.locate=(key=[0,0,0],function(a,b,c){var x=a,y=b,z=c;return b<c?b<a&&(x=b,y=c,z=a):c<a&&(x=c,y=a,z=b),x<0?-1:(key[0]=x,key[1]=y,key[2]=z,bsearch.eq(this.cells,key,compareCell))})},{"binary-search-bounds":98}],96:[function(_dereq_,module,exports){"use strict";var bsearch=_dereq_("binary-search-bounds"),orient=_dereq_("robust-orientation")[3],EVENT_POINT=0,EVENT_END=1,EVENT_START=2;function PartialHull(a,b,idx,lowerIds,upperIds){this.a=a,this.b=b,this.idx=idx,this.lowerIds=lowerIds,this.upperIds=upperIds}function Event(a,b,type,idx){this.a=a,this.b=b,this.type=type,this.idx=idx}function compareEvent(a,b){var d=a.a[0]-b.a[0]||a.a[1]-b.a[1]||a.type-b.type;return d||(a.type!==EVENT_POINT&&(d=orient(a.a,a.b,b.b))?d:a.idx-b.idx)}function testPoint(hull,p){return orient(hull.a,hull.b,p)}function addPoint(cells,hulls,points,p,idx){for(var lo=bsearch.lt(hulls,p,testPoint),hi=bsearch.gt(hulls,p,testPoint),i=lo;i<hi;++i){for(var hull=hulls[i],lowerIds=hull.lowerIds,m=lowerIds.length;m>1&&orient(points[lowerIds[m-2]],points[lowerIds[m-1]],p)>0;)cells.push([lowerIds[m-1],lowerIds[m-2],idx]),m-=1;lowerIds.length=m,lowerIds.push(idx);var upperIds=hull.upperIds;for(m=upperIds.length;m>1&&orient(points[upperIds[m-2]],points[upperIds[m-1]],p)<0;)cells.push([upperIds[m-2],upperIds[m-1],idx]),m-=1;upperIds.length=m,upperIds.push(idx)}}function findSplit(hull,edge){var d;return(d=hull.a[0]<edge.a[0]?orient(hull.a,hull.b,edge.a):orient(edge.b,edge.a,hull.a))?d:(d=edge.b[0]<hull.b[0]?orient(hull.a,hull.b,edge.b):orient(edge.b,edge.a,hull.b))||hull.idx-edge.idx}function splitHulls(hulls,points,event){var splitIdx=bsearch.le(hulls,event,findSplit),hull=hulls[splitIdx],upperIds=hull.upperIds,x=upperIds[upperIds.length-1];hull.upperIds=[x],hulls.splice(splitIdx+1,0,new PartialHull(event.a,event.b,event.idx,[x],upperIds))}function mergeHulls(hulls,points,event){var tmp=event.a;event.a=event.b,event.b=tmp;var mergeIdx=bsearch.eq(hulls,event,findSplit),upper=hulls[mergeIdx];hulls[mergeIdx-1].upperIds=upper.upperIds,hulls.splice(mergeIdx,1)}module.exports=function monotoneTriangulate(points,edges){for(var numPoints=points.length,numEdges=edges.length,events=[],i=0;i<numPoints;++i)events.push(new Event(points[i],null,EVENT_POINT,i));for(var i=0;i<numEdges;++i){var e=edges[i],a=points[e[0]],b=points[e[1]];a[0]<b[0]?events.push(new Event(a,b,EVENT_START,i),new Event(b,a,EVENT_END,i)):a[0]>b[0]&&events.push(new Event(b,a,EVENT_START,i),new Event(a,b,EVENT_END,i))}events.sort(compareEvent);for(var minX=events[0].a[0]-(1+Math.abs(events[0].a[0]))*Math.pow(2,-52),hull=[new PartialHull([minX,1],[minX,0],-1,[],[],[],[])],cells=[],i=0,numEvents=events.length;i<numEvents;++i){var event=events[i],type=event.type;type===EVENT_POINT?addPoint(cells,hull,points,event.a,event.idx):type===EVENT_START?splitHulls(hull,points,event):mergeHulls(hull,points,event)}return cells}},{"binary-search-bounds":98,"robust-orientation":483}],97:[function(_dereq_,module,exports){"use strict";var bsearch=_dereq_("binary-search-bounds");function Triangulation(stars,edges){this.stars=stars,this.edges=edges}module.exports=function createTriangulation(numVerts,edges){for(var stars=new Array(numVerts),i=0;i<numVerts;++i)stars[i]=[];return new Triangulation(stars,edges)};var proto=Triangulation.prototype;function removePair(list,j,k){for(var i=1,n=list.length;i<n;i+=2)if(list[i-1]===j&&list[i]===k)return list[i-1]=list[n-2],list[i]=list[n-1],void(list.length=n-2)}proto.isConstraint=function(){var e=[0,0];function compareLex(a,b){return a[0]-b[0]||a[1]-b[1]}return function(i,j){return e[0]=Math.min(i,j),e[1]=Math.max(i,j),bsearch.eq(this.edges,e,compareLex)>=0}}(),proto.removeTriangle=function(i,j,k){var stars=this.stars;removePair(stars[i],j,k),removePair(stars[j],k,i),removePair(stars[k],i,j)},proto.addTriangle=function(i,j,k){var stars=this.stars;stars[i].push(j,k),stars[j].push(k,i),stars[k].push(i,j)},proto.opposite=function(j,i){for(var list=this.stars[i],k=1,n=list.length;k<n;k+=2)if(list[k]===j)return list[k-1];return-1},proto.flip=function(i,j){var a=this.opposite(i,j),b=this.opposite(j,i);this.removeTriangle(i,j,a),this.removeTriangle(j,i,b),this.addTriangle(i,b,a),this.addTriangle(j,a,b)},proto.edges=function(){for(var stars=this.stars,result=[],i=0,n=stars.length;i<n;++i)for(var list=stars[i],j=0,m=list.length;j<m;j+=2)result.push([list[j],list[j+1]]);return result},proto.cells=function(){for(var stars=this.stars,result=[],i=0,n=stars.length;i<n;++i)for(var list=stars[i],j=0,m=list.length;j<m;j+=2){var s=list[j],t=list[j+1];i<Math.min(s,t)&&result.push([i,s,t])}return result}},{"binary-search-bounds":98}],98:[function(_dereq_,module,exports){"use strict";function compileSearch(funcName,predicate,reversed,extraArgs,earlyOut){var code=["function ",funcName,"(a,l,h,",extraArgs.join(","),"){",earlyOut?"":"var i=",reversed?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a[m]"];return earlyOut?predicate.indexOf("c")<0?code.push(";if(x===y){return m}else if(x<=y){"):code.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):code.push(";if(",predicate,"){i=m;"),reversed?code.push("l=m+1}else{h=m-1}"):code.push("h=m-1}else{l=m+1}"),code.push("}"),earlyOut?code.push("return -1};"):code.push("return i};"),code.join("")}function compileBoundsSearch(predicate,reversed,suffix,earlyOut){return new Function([compileSearch("A","x"+predicate+"y",reversed,["y"],earlyOut),compileSearch("P","c(x,y)"+predicate+"0",reversed,["y","c"],earlyOut),"function dispatchBsearch",suffix,"(a,y,c,l,h){if(typeof(c)==='function'){return P(a,(l===void 0)?0:l|0,(h===void 0)?a.length-1:h|0,y,c)}else{return A(a,(c===void 0)?0:c|0,(l===void 0)?a.length-1:l|0,y)}}return dispatchBsearch",suffix].join(""))()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)}},{}],99:[function(_dereq_,module,exports){"use strict";module.exports=function orientation(s){for(var p=1,i=1;i<s.length;++i)for(var j=0;j<i;++j)if(s[i]<s[j])p=-p;else if(s[j]===s[i])return 0;return p}},{}],100:[function(_dereq_,module,exports){"use strict";var dup=_dereq_("dup"),solve=_dereq_("robust-linear-solve");function dot(a,b){for(var s=0,d=a.length,i=0;i<d;++i)s+=a[i]*b[i];return s}function barycentricCircumcenter(points){var N=points.length;if(0===N)return[];points[0].length;var A=dup([points.length+1,points.length+1],1),b=dup([points.length+1],1);A[N][N]=0;for(var i=0;i<N;++i){for(var j=0;j<=i;++j)A[j][i]=A[i][j]=2*dot(points[i],points[j]);b[i]=dot(points[i],points[i])}var x=solve(A,b),denom=0,h=x[N+1];for(i=0;i<h.length;++i)denom+=h[i];var y=new Array(N);for(i=0;i<N;++i){h=x[i];var numer=0;for(j=0;j<h.length;++j)numer+=h[j];y[i]=numer/denom}return y}function circumcenter(points){if(0===points.length)return[];for(var D=points[0].length,result=dup([D]),weights=barycentricCircumcenter(points),i=0;i<points.length;++i)for(var j=0;j<D;++j)result[j]+=points[i][j]*weights[i];return result}circumcenter.barycenetric=barycentricCircumcenter,module.exports=circumcenter},{dup:154,"robust-linear-solve":482}],101:[function(_dereq_,module,exports){module.exports=function circumradius(points){for(var center=circumcenter(points),avgDist=0,i=0;i<points.length;++i)for(var p=points[i],j=0;j<center.length;++j)avgDist+=Math.pow(p[j]-center[j],2);return Math.sqrt(avgDist/points.length)};var circumcenter=_dereq_("circumcenter")},{circumcenter:100}],102:[function(_dereq_,module,exports){module.exports=function clamp(value,min,max){return min<max?value<min?min:value>max?max:value:value<max?max:value>min?min:value}},{}],103:[function(_dereq_,module,exports){"use strict";module.exports=function cleanPSLG(points,edges,colors){var prevEdges;if(colors){prevEdges=edges;for(var augEdges=new Array(edges.length),i=0;i<edges.length;++i){var e=edges[i];augEdges[i]=[e[0],e[1],colors[i]]}edges=augEdges}var modified=function preRound(points,edges,useColor){var labels=dedupPoints(points,[],boundPoints(points));return dedupEdges(edges,labels,useColor),!!labels}(points,edges,!!colors);for(;snapRound(points,edges,!!colors);)modified=!0;if(colors&&modified){prevEdges.length=0,colors.length=0;for(var i=0;i<edges.length;++i){var e=edges[i];prevEdges.push([e[0],e[1]]),colors.push(e[2])}}return modified};var UnionFind=_dereq_("union-find"),boxIntersect=_dereq_("box-intersect"),segseg=_dereq_("robust-segment-intersect"),rat=_dereq_("big-rat"),ratCmp=_dereq_("big-rat/cmp"),ratToFloat=_dereq_("big-rat/to-float"),ratVec=_dereq_("rat-vec"),nextafter=_dereq_("nextafter"),solveIntersection=_dereq_("./lib/rat-seg-intersect");function boundRat(r){var f=ratToFloat(r);return[nextafter(f,-1/0),nextafter(f,1/0)]}function boundPoints(points){for(var bounds=new Array(points.length),i=0;i<points.length;++i){var p=points[i];bounds[i]=[nextafter(p[0],-1/0),nextafter(p[1],-1/0),nextafter(p[0],1/0),nextafter(p[1],1/0)]}return bounds}function dedupPoints(floatPoints,ratPoints,floatBounds){for(var numPoints=ratPoints.length,uf=new UnionFind(numPoints),bounds=[],i=0;i<ratPoints.length;++i){var p=ratPoints[i],xb=boundRat(p[0]),yb=boundRat(p[1]);bounds.push([nextafter(xb[0],-1/0),nextafter(yb[0],-1/0),nextafter(xb[1],1/0),nextafter(yb[1],1/0)])}boxIntersect(bounds,function(i,j){uf.link(i,j)});var noDupes=!0,labels=new Array(numPoints);for(i=0;i<numPoints;++i){(j=uf.find(i))!==i&&(noDupes=!1,floatPoints[j]=[Math.min(floatPoints[i][0],floatPoints[j][0]),Math.min(floatPoints[i][1],floatPoints[j][1])])}if(noDupes)return null;var ptr=0;for(i=0;i<numPoints;++i){var j;(j=uf.find(i))===i?(labels[i]=ptr,floatPoints[ptr++]=floatPoints[i]):labels[i]=-1}floatPoints.length=ptr;for(i=0;i<numPoints;++i)labels[i]<0&&(labels[i]=labels[uf.find(i)]);return labels}function compareLex2(a,b){return a[0]-b[0]||a[1]-b[1]}function compareLex3(a,b){var d=a[0]-b[0]||a[1]-b[1];return d||(a[2]<b[2]?-1:a[2]>b[2]?1:0)}function dedupEdges(edges,labels,useColor){if(0!==edges.length){if(labels)for(var i=0;i<edges.length;++i){var a=labels[(e=edges[i])[0]],b=labels[e[1]];e[0]=Math.min(a,b),e[1]=Math.max(a,b)}else for(i=0;i<edges.length;++i){var e;a=(e=edges[i])[0],b=e[1];e[0]=Math.min(a,b),e[1]=Math.max(a,b)}useColor?edges.sort(compareLex3):edges.sort(compareLex2);var ptr=1;for(i=1;i<edges.length;++i){var prev=edges[i-1],next=edges[i];(next[0]!==prev[0]||next[1]!==prev[1]||useColor&&next[2]!==prev[2])&&(edges[ptr++]=next)}edges.length=ptr}}function snapRound(points,edges,useColor){var edgeBounds=function boundEdges(points,edges){for(var bounds=new Array(edges.length),i=0;i<edges.length;++i){var e=edges[i],a=points[e[0]],b=points[e[1]];bounds[i]=[nextafter(Math.min(a[0],b[0]),-1/0),nextafter(Math.min(a[1],b[1]),-1/0),nextafter(Math.max(a[0],b[0]),1/0),nextafter(Math.max(a[1],b[1]),1/0)]}return bounds}(points,edges),crossings=function getCrossings(points,edges,edgeBounds){var result=[];return boxIntersect(edgeBounds,function(i,j){var e=edges[i],f=edges[j];if(e[0]!==f[0]&&e[0]!==f[1]&&e[1]!==f[0]&&e[1]!==f[1]){var a=points[e[0]],b=points[e[1]],c=points[f[0]],d=points[f[1]];segseg(a,b,c,d)&&result.push([i,j])}}),result}(points,edges,edgeBounds),vertBounds=boundPoints(points),tjunctions=function getTJunctions(points,edges,edgeBounds,vertBounds){var result=[];return boxIntersect(edgeBounds,vertBounds,function(i,v){var e=edges[i];if(e[0]!==v&&e[1]!==v){var p=points[v],a=points[e[0]],b=points[e[1]];segseg(a,b,p,p)&&result.push([i,v])}}),result}(points,edges,edgeBounds,vertBounds),labels=dedupPoints(points,function cutEdges(floatPoints,edges,crossings,junctions,useColor){var i,e,ratPoints=floatPoints.map(function(p){return[rat(p[0]),rat(p[1])]});for(i=0;i<crossings.length;++i){var crossing=crossings[i];e=crossing[0];var f=crossing[1],ee=edges[e],ef=edges[f],x=solveIntersection(ratVec(floatPoints[ee[0]]),ratVec(floatPoints[ee[1]]),ratVec(floatPoints[ef[0]]),ratVec(floatPoints[ef[1]]));if(x){var idx=floatPoints.length;floatPoints.push([ratToFloat(x[0]),ratToFloat(x[1])]),ratPoints.push(x),junctions.push([e,idx],[f,idx])}}for(junctions.sort(function(a,b){if(a[0]!==b[0])return a[0]-b[0];var u=ratPoints[a[1]],v=ratPoints[b[1]];return ratCmp(u[0],v[0])||ratCmp(u[1],v[1])}),i=junctions.length-1;i>=0;--i){var edge=edges[e=(junction=junctions[i])[0]],s=edge[0],t=edge[1],a=floatPoints[s],b=floatPoints[t];if((a[0]-b[0]||a[1]-b[1])<0){var tmp=s;s=t,t=tmp}edge[0]=s;var color,last=edge[1]=junction[1];for(useColor&&(color=edge[2]);i>0&&junctions[i-1][0]===e;){var junction,next=(junction=junctions[--i])[1];useColor?edges.push([last,next,color]):edges.push([last,next]),last=next}useColor?edges.push([last,t,color]):edges.push([last,t])}return ratPoints}(points,edges,crossings,tjunctions,useColor));return dedupEdges(edges,labels,useColor),!!labels||(crossings.length>0||tjunctions.length>0)}},{"./lib/rat-seg-intersect":104,"big-rat":65,"big-rat/cmp":63,"big-rat/to-float":77,"box-intersect":83,nextafter:431,"rat-vec":466,"robust-segment-intersect":486,"union-find":520}],104:[function(_dereq_,module,exports){"use strict";module.exports=function solveIntersection(a,b,c,d){var ba=rvSub(b,a),dc=rvSub(d,c),baXdc=ratPerp(ba,dc);if(0===ratSign(baXdc))return null;var ac=rvSub(a,c),dcXac=ratPerp(dc,ac),t=ratDiv(dcXac,baXdc),s=rvMuls(ba,t);return rvAdd(a,s)};var ratMul=_dereq_("big-rat/mul"),ratDiv=_dereq_("big-rat/div"),ratSub=_dereq_("big-rat/sub"),ratSign=_dereq_("big-rat/sign"),rvSub=_dereq_("rat-vec/sub"),rvAdd=_dereq_("rat-vec/add"),rvMuls=_dereq_("rat-vec/muls");function ratPerp(a,b){return ratSub(ratMul(a[0],b[1]),ratMul(a[1],b[0]))}},{"big-rat/div":64,"big-rat/mul":74,"big-rat/sign":75,"big-rat/sub":76,"rat-vec/add":465,"rat-vec/muls":467,"rat-vec/sub":468}],105:[function(_dereq_,module,exports){"use strict";var clamp=_dereq_("clamp");function toNumber(rgba,normalized){null==normalized&&(normalized=!0);var r=rgba[0],g=rgba[1],b=rgba[2],a=rgba[3];return null==a&&(a=normalized?1:255),normalized&&(r*=255,g*=255,b*=255,a*=255),16777216*(r=255&clamp(r,0,255))+((g=255&clamp(g,0,255))<<16)+((b=255&clamp(b,0,255))<<8)+(a=255&clamp(a,0,255))}module.exports=toNumber,module.exports.to=toNumber,module.exports.from=function fromNumber(n,normalized){var r=(n=+n)>>>24,g=(16711680&n)>>>16,b=(65280&n)>>>8,a=255&n;return!1===normalized?[r,g,b,a]:[r/255,g/255,b/255,a/255]}},{clamp:102}],106:[function(_dereq_,module,exports){"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},{}],107:[function(_dereq_,module,exports){"use strict";var rgba=_dereq_("color-rgba"),clamp=_dereq_("clamp"),dtype=_dereq_("dtype");module.exports=function normalize(color,type){"float"!==type&&type||(type="array"),"uint"===type&&(type="uint8"),"uint_clamped"===type&&(type="uint8_clamped");var output=new(dtype(type))(4),normalize="uint8"!==type&&"uint8_clamped"!==type;return color.length&&"string"!=typeof color||((color=rgba(color))[0]/=255,color[1]/=255,color[2]/=255),function isInt(color){return color instanceof Uint8Array||color instanceof Uint8ClampedArray||!!(Array.isArray(color)&&(color[0]>1||0===color[0])&&(color[1]>1||0===color[1])&&(color[2]>1||0===color[2])&&(!color[3]||color[3]>1))}(color)?(output[0]=color[0],output[1]=color[1],output[2]=color[2],output[3]=null!=color[3]?color[3]:255,normalize&&(output[0]/=255,output[1]/=255,output[2]/=255,output[3]/=255),output):(normalize?(output[0]=color[0],output[1]=color[1],output[2]=color[2],output[3]=null!=color[3]?color[3]:1):(output[0]=clamp(Math.floor(255*color[0]),0,255),output[1]=clamp(Math.floor(255*color[1]),0,255),output[2]=clamp(Math.floor(255*color[2]),0,255),output[3]=null==color[3]?255:clamp(Math.floor(255*color[3]),0,255)),output)}},{clamp:102,"color-rgba":109,dtype:153}],108:[function(_dereq_,module,exports){(function(global){"use strict";var names=_dereq_("color-name"),isObject=_dereq_("is-plain-obj"),defined=_dereq_("defined");module.exports=function parse(cstr){var m,space,parts=[],alpha=1;if("string"==typeof cstr)if(names[cstr])parts=names[cstr].slice(),space="rgb";else if("transparent"===cstr)alpha=0,space="rgb",parts=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(cstr)){var base=cstr.slice(1),size=base.length,isShort=size<=4;alpha=1,isShort?(parts=[parseInt(base[0]+base[0],16),parseInt(base[1]+base[1],16),parseInt(base[2]+base[2],16)],4===size&&(alpha=parseInt(base[3]+base[3],16)/255)):(parts=[parseInt(base[0]+base[1],16),parseInt(base[2]+base[3],16),parseInt(base[4]+base[5],16)],8===size&&(alpha=parseInt(base[6]+base[7],16)/255)),parts[0]||(parts[0]=0),parts[1]||(parts[1]=0),parts[2]||(parts[2]=0),space="rgb"}else if(m=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(cstr)){var name=m[1],base=name.replace(/a$/,"");space=base;var size="cmyk"===base?4:"gray"===base?1:3;parts=m[2].trim().split(/\s*,\s*/).map(function(x,i){if(/%$/.test(x))return i===size?parseFloat(x)/100:"rgb"===base?255*parseFloat(x)/100:parseFloat(x);if("h"===base[i]){if(/deg$/.test(x))return parseFloat(x);if(void 0!==baseHues[x])return baseHues[x]}return parseFloat(x)}),name===base&&parts.push(1),alpha=void 0===parts[size]?1:parts[size],parts=parts.slice(0,size)}else cstr.length>10&&/[0-9](?:\s|\/)/.test(cstr)&&(parts=cstr.match(/([0-9]+)/g).map(function(value){return parseFloat(value)}),space=cstr.match(/([a-z])/gi).join("").toLowerCase());else if(isNaN(cstr))if(isObject(cstr)){var r=defined(cstr.r,cstr.red,cstr.R,null);null!==r?(space="rgb",parts=[r,defined(cstr.g,cstr.green,cstr.G),defined(cstr.b,cstr.blue,cstr.B)]):(space="hsl",parts=[defined(cstr.h,cstr.hue,cstr.H),defined(cstr.s,cstr.saturation,cstr.S),defined(cstr.l,cstr.lightness,cstr.L,cstr.b,cstr.brightness)]),alpha=defined(cstr.a,cstr.alpha,cstr.opacity,1),null!=cstr.opacity&&(alpha/=100)}else(Array.isArray(cstr)||global.ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(cstr))&&(parts=[cstr[0],cstr[1],cstr[2]],space="rgb",alpha=4===cstr.length?cstr[3]:1);else space="rgb",parts=[cstr>>>16,(65280&cstr)>>>8,255&cstr];return{space:space,values:parts,alpha:alpha}};var baseHues={red:0,orange:60,yellow:120,green:180,blue:240,purple:300}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"color-name":106,defined:148,"is-plain-obj":403}],109:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("color-parse"),hsl=_dereq_("color-space/hsl"),clamp=_dereq_("clamp");module.exports=function rgba(color){var values,parsed=parse(color);return parsed.space?((values=Array(3))[0]=clamp(parsed.values[0],0,255),values[1]=clamp(parsed.values[1],0,255),values[2]=clamp(parsed.values[2],0,255),"h"===parsed.space[0]&&(values=hsl.rgb(values)),values.push(clamp(parsed.alpha,0,1)),values):[]}},{clamp:102,"color-parse":108,"color-space/hsl":110}],110:[function(_dereq_,module,exports){"use strict";var rgb=_dereq_("./rgb");module.exports={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(hsl){var t1,t2,t3,rgb,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;if(0===s)return[val=255*l,val,val];t1=2*l-(t2=l<.5?l*(1+s):l+s-l*s),rgb=[0,0,0];for(var i=0;i<3;i++)(t3=h+1/3*-(i-1))<0?t3++:t3>1&&t3--,val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1,rgb[i]=255*val;return rgb}},rgb.hsl=function(rgb){var h,l,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;return max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360),l=(min+max)/2,[h,100*(max===min?0:l<=.5?delta/(max+min):delta/(2-max-min)),100*l]}},{"./rgb":111}],111:[function(_dereq_,module,exports){"use strict";module.exports={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]}},{}],112:[function(_dereq_,module,exports){module.exports={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],cool:[{index:0,rgb:[0,255,255]},{index:1,rgb:[255,0,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}},{}],113:[function(_dereq_,module,exports){"use strict";var colorScale=_dereq_("./colorScale"),lerp=_dereq_("lerp");function rgb2float(rgba){return[rgba[0]/255,rgba[1]/255,rgba[2]/255,rgba[3]]}function rgb2hex(rgba){for(var dig,hex="#",i=0;i<3;++i)hex+=("00"+(dig=(dig=rgba[i]).toString(16))).substr(dig.length);return hex}function rgbaStr(rgba){return"rgba("+rgba.join(",")+")"}module.exports=function createColormap(spec){var indicies,fromrgba,torgba,nsteps,cmap,colormap,format,nshades,alpha,i;spec||(spec={});nshades=(spec.nshades||72)-1,format=spec.format||"hex",(colormap=spec.colormap)||(colormap="jet");if("string"==typeof colormap){if(colormap=colormap.toLowerCase(),!colorScale[colormap])throw Error(colormap+" not a supported colorscale");cmap=colorScale[colormap]}else{if(!Array.isArray(colormap))throw Error("unsupported colormap option",colormap);cmap=colormap.slice()}if(cmap.length>nshades)throw new Error(colormap+" map requires nshades to be at least size "+cmap.length);alpha=Array.isArray(spec.alpha)?2!==spec.alpha.length?[1,1]:spec.alpha.slice():"number"==typeof spec.alpha?[spec.alpha,spec.alpha]:[1,1];indicies=cmap.map(function(c){return Math.round(c.index*nshades)}),alpha[0]=Math.min(Math.max(alpha[0],0),1),alpha[1]=Math.min(Math.max(alpha[1],0),1);var steps=cmap.map(function(c,i){var index=cmap[i].index,rgba=cmap[i].rgb.slice();return 4===rgba.length&&rgba[3]>=0&&rgba[3]<=1?rgba:(rgba[3]=alpha[0]+(alpha[1]-alpha[0])*index,rgba)}),colors=[];for(i=0;i<indicies.length-1;++i){nsteps=indicies[i+1]-indicies[i],fromrgba=steps[i],torgba=steps[i+1];for(var j=0;j<nsteps;j++){var amt=j/nsteps;colors.push([Math.round(lerp(fromrgba[0],torgba[0],amt)),Math.round(lerp(fromrgba[1],torgba[1],amt)),Math.round(lerp(fromrgba[2],torgba[2],amt)),lerp(fromrgba[3],torgba[3],amt)])}}colors.push(cmap[cmap.length-1].rgb.concat(alpha[1])),"hex"===format?colors=colors.map(rgb2hex):"rgbaString"===format?colors=colors.map(rgbaStr):"float"===format&&(colors=colors.map(rgb2float));return colors}},{"./colorScale":112,lerp:405}],114:[function(_dereq_,module,exports){"use strict";module.exports=function compareAngle(a,b,c,d){var bcd=orient(b,c,d);if(0===bcd){var sabc=sgn(orient(a,b,c)),sabd=sgn(orient(a,b,d));if(sabc===sabd){if(0===sabc){var ic=testInterior(a,b,c),id=testInterior(a,b,d);return ic===id?0:ic?1:-1}return 0}return 0===sabd?sabc>0?-1:testInterior(a,b,d)?-1:1:0===sabc?sabd>0?1:testInterior(a,b,c)?1:-1:sgn(sabd-sabc)}var abc=orient(a,b,c);if(abc>0)return bcd>0&&orient(a,b,d)>0?1:-1;if(abc<0)return bcd>0||orient(a,b,d)>0?1:-1;var abd=orient(a,b,d);return abd>0?1:testInterior(a,b,c)?1:-1};var orient=_dereq_("robust-orientation"),sgn=_dereq_("signum"),twoSum=_dereq_("two-sum"),robustProduct=_dereq_("robust-product"),robustSum=_dereq_("robust-sum");function testInterior(a,b,c){var x0=twoSum(a[0],-b[0]),y0=twoSum(a[1],-b[1]),x1=twoSum(c[0],-b[0]),y1=twoSum(c[1],-b[1]),d=robustSum(robustProduct(x0,x1),robustProduct(y0,y1));return d[d.length-1]>=0}},{"robust-orientation":483,"robust-product":484,"robust-sum":488,signum:489,"two-sum":518}],115:[function(_dereq_,module,exports){module.exports=function compareCells(a,b){var n=a.length,t=a.length-b.length;if(t)return t;switch(n){case 0:return 0;case 1:return a[0]-b[0];case 2:return a[0]+a[1]-b[0]-b[1]||min(a[0],a[1])-min(b[0],b[1]);case 3:var l1=a[0]+a[1],m1=b[0]+b[1];if(t=l1+a[2]-(m1+b[2]))return t;var l0=min(a[0],a[1]),m0=min(b[0],b[1]);return min(l0,a[2])-min(m0,b[2])||min(l0+a[2],l1)-min(m0+b[2],m1);case 4:var aw=a[0],ax=a[1],ay=a[2],az=a[3],bw=b[0],bx=b[1],by=b[2],bz=b[3];return aw+ax+ay+az-(bw+bx+by+bz)||min(aw,ax,ay,az)-min(bw,bx,by,bz,bw)||min(aw+ax,aw+ay,aw+az,ax+ay,ax+az,ay+az)-min(bw+bx,bw+by,bw+bz,bx+by,bx+bz,by+bz)||min(aw+ax+ay,aw+ax+az,aw+ay+az,ax+ay+az)-min(bw+bx+by,bw+bx+bz,bw+by+bz,bx+by+bz);default:for(var as=a.slice().sort(compareInt),bs=b.slice().sort(compareInt),i=0;i<n;++i)if(t=as[i]-bs[i])return t;return 0}};var min=Math.min;function compareInt(a,b){return a-b}},{}],116:[function(_dereq_,module,exports){"use strict";var compareCells=_dereq_("compare-cell"),parity=_dereq_("cell-orientation");module.exports=function compareOrientedCells(a,b){return compareCells(a,b)||parity(a)-parity(b)}},{"cell-orientation":99,"compare-cell":115}],117:[function(_dereq_,module,exports){"use strict";var convexHull1d=_dereq_("./lib/ch1d"),convexHull2d=_dereq_("./lib/ch2d"),convexHullnd=_dereq_("./lib/chnd");module.exports=function convexHull(points){var n=points.length;if(0===n)return[];if(1===n)return[[0]];var d=points[0].length;if(0===d)return[];if(1===d)return convexHull1d(points);if(2===d)return convexHull2d(points);return convexHullnd(points,d)}},{"./lib/ch1d":118,"./lib/ch2d":119,"./lib/chnd":120}],118:[function(_dereq_,module,exports){"use strict";module.exports=function convexHull1d(points){for(var lo=0,hi=0,i=1;i<points.length;++i)points[i][0]<points[lo][0]&&(lo=i),points[i][0]>points[hi][0]&&(hi=i);return lo<hi?[[lo],[hi]]:lo>hi?[[hi],[lo]]:[[lo]]}},{}],119:[function(_dereq_,module,exports){"use strict";module.exports=function convexHull2D(points){var hull=monotoneHull(points),h=hull.length;if(h<=2)return[];for(var edges=new Array(h),a=hull[h-1],i=0;i<h;++i){var b=hull[i];edges[i]=[a,b],a=b}return edges};var monotoneHull=_dereq_("monotone-convex-hull-2d")},{"monotone-convex-hull-2d":414}],120:[function(_dereq_,module,exports){"use strict";module.exports=function convexHullnD(points,d){try{return ich(points,!0)}catch(e){var ah=aff(points);if(ah.length<=d)return[];var npoints=function permute(points,front){for(var n=points.length,npoints=new Array(n),i=0;i<front.length;++i)npoints[i]=points[front[i]];for(var ptr=front.length,i=0;i<n;++i)front.indexOf(i)<0&&(npoints[ptr++]=points[i]);return npoints}(points,ah),nhull=ich(npoints,!0);return function invPermute(cells,front){for(var nc=cells.length,nf=front.length,i=0;i<nc;++i)for(var c=cells[i],j=0;j<c.length;++j){var x=c[j];if(x<nf)c[j]=front[x];else{x-=nf;for(var k=0;k<nf;++k)x>=front[k]&&(x+=1);c[j]=x}}return cells}(nhull,ah)}};var ich=_dereq_("incremental-convex-hull"),aff=_dereq_("affine-hull")},{"affine-hull":49,"incremental-convex-hull":394}],121:[function(_dereq_,module,exports){module.exports={AFG:"afghan",ALA:"\\b\\wland",ALB:"albania",DZA:"algeria",ASM:"^(?=.*americ).*samoa",AND:"andorra",AGO:"angola",AIA:"anguill?a",ATA:"antarctica",ATG:"antigua",ARG:"argentin",ARM:"armenia",ABW:"^(?!.*bonaire).*\\baruba",AUS:"australia",AUT:"^(?!.*hungary).*austria|\\baustri.*\\bemp",AZE:"azerbaijan",BHS:"bahamas",BHR:"bahrain",BGD:"bangladesh|^(?=.*east).*paki?stan",BRB:"barbados",BLR:"belarus|byelo",BEL:"^(?!.*luxem).*belgium",BLZ:"belize|^(?=.*british).*honduras",BEN:"benin|dahome",BMU:"bermuda",BTN:"bhutan",BOL:"bolivia",BES:"^(?=.*bonaire).*eustatius|^(?=.*carib).*netherlands|\\bbes.?islands",BIH:"herzegovina|bosnia",BWA:"botswana|bechuana",BVT:"bouvet",BRA:"brazil",IOT:"british.?indian.?ocean",BRN:"brunei",BGR:"bulgaria",BFA:"burkina|\\bfaso|upper.?volta",BDI:"burundi",CPV:"verde",KHM:"cambodia|kampuchea|khmer",CMR:"cameroon",CAN:"canada",CYM:"cayman",CAF:"\\bcentral.african.republic",TCD:"\\bchad",CHL:"\\bchile",CHN:"^(?!.*\\bmac)(?!.*\\bhong)(?!.*\\btai)(?!.*\\brep).*china|^(?=.*peo)(?=.*rep).*china",CXR:"christmas",CCK:"\\bcocos|keeling",COL:"colombia",COM:"comoro",COG:"^(?!.*\\bdem)(?!.*\\bd[\\.]?r)(?!.*kinshasa)(?!.*zaire)(?!.*belg)(?!.*l.opoldville)(?!.*free).*\\bcongo",COK:"\\bcook",CRI:"costa.?rica",CIV:"ivoire|ivory",HRV:"croatia",CUB:"\\bcuba",CUW:"^(?!.*bonaire).*\\bcura(c|)ao",CYP:"cyprus",CSK:"czechoslovakia",CZE:"^(?=.*rep).*czech|czechia|bohemia",COD:"\\bdem.*congo|congo.*\\bdem|congo.*\\bd[\\.]?r|\\bd[\\.]?r.*congo|belgian.?congo|congo.?free.?state|kinshasa|zaire|l.opoldville|drc|droc|rdc",DNK:"denmark",DJI:"djibouti",DMA:"dominica(?!n)",DOM:"dominican.rep",ECU:"ecuador",EGY:"egypt",SLV:"el.?salvador",GNQ:"guine.*eq|eq.*guine|^(?=.*span).*guinea",ERI:"eritrea",EST:"estonia",ETH:"ethiopia|abyssinia",FLK:"falkland|malvinas",FRO:"faroe|faeroe",FJI:"fiji",FIN:"finland",FRA:"^(?!.*\\bdep)(?!.*martinique).*france|french.?republic|\\bgaul",GUF:"^(?=.*french).*guiana",PYF:"french.?polynesia|tahiti",ATF:"french.?southern",GAB:"gabon",GMB:"gambia",GEO:"^(?!.*south).*georgia",DDR:"german.?democratic.?republic|democratic.?republic.*germany|east.germany",DEU:"^(?!.*east).*germany|^(?=.*\\bfed.*\\brep).*german",GHA:"ghana|gold.?coast",GIB:"gibraltar",GRC:"greece|hellenic|hellas",GRL:"greenland",GRD:"grenada",GLP:"guadeloupe",GUM:"\\bguam",GTM:"guatemala",GGY:"guernsey",GIN:"^(?!.*eq)(?!.*span)(?!.*bissau)(?!.*portu)(?!.*new).*guinea",GNB:"bissau|^(?=.*portu).*guinea",GUY:"guyana|british.?guiana",HTI:"haiti",HMD:"heard.*mcdonald",VAT:"holy.?see|vatican|papal.?st",HND:"^(?!.*brit).*honduras",HKG:"hong.?kong",HUN:"^(?!.*austr).*hungary",ISL:"iceland",IND:"india(?!.*ocea)",IDN:"indonesia",IRN:"\\biran|persia",IRQ:"\\biraq|mesopotamia",IRL:"(^ireland)|(^republic.*ireland)",IMN:"^(?=.*isle).*\\bman",ISR:"israel",ITA:"italy",JAM:"jamaica",JPN:"japan",JEY:"jersey",JOR:"jordan",KAZ:"kazak",KEN:"kenya|british.?east.?africa|east.?africa.?prot",KIR:"kiribati",PRK:"^(?=.*democrat|people|north|d.*p.*.r).*\\bkorea|dprk|korea.*(d.*p.*r)",KWT:"kuwait",KGZ:"kyrgyz|kirghiz",LAO:"\\blaos?\\b",LVA:"latvia",LBN:"lebanon",LSO:"lesotho|basuto",LBR:"liberia",LBY:"libya",LIE:"liechtenstein",LTU:"lithuania",LUX:"^(?!.*belg).*luxem",MAC:"maca(o|u)",MDG:"madagascar|malagasy",MWI:"malawi|nyasa",MYS:"malaysia",MDV:"maldive",MLI:"\\bmali\\b",MLT:"\\bmalta",MHL:"marshall",MTQ:"martinique",MRT:"mauritania",MUS:"mauritius",MYT:"\\bmayotte",MEX:"\\bmexic",FSM:"fed.*micronesia|micronesia.*fed",MCO:"monaco",MNG:"mongolia",MNE:"^(?!.*serbia).*montenegro",MSR:"montserrat",MAR:"morocco|\\bmaroc",MOZ:"mozambique",MMR:"myanmar|burma",NAM:"namibia",NRU:"nauru",NPL:"nepal",NLD:"^(?!.*\\bant)(?!.*\\bcarib).*netherlands",ANT:"^(?=.*\\bant).*(nether|dutch)",NCL:"new.?caledonia",NZL:"new.?zealand",NIC:"nicaragua",NER:"\\bniger(?!ia)",NGA:"nigeria",NIU:"niue",NFK:"norfolk",MNP:"mariana",NOR:"norway",OMN:"\\boman|trucial",PAK:"^(?!.*east).*paki?stan",PLW:"palau",PSE:"palestin|\\bgaza|west.?bank",PAN:"panama",PNG:"papua|new.?guinea",PRY:"paraguay",PER:"peru",PHL:"philippines",PCN:"pitcairn",POL:"poland",PRT:"portugal",PRI:"puerto.?rico",QAT:"qatar",KOR:"^(?!.*d.*p.*r)(?!.*democrat)(?!.*people)(?!.*north).*\\bkorea(?!.*d.*p.*r)",MDA:"moldov|b(a|e)ssarabia",REU:"r(e|)union",ROU:"r(o|u|ou)mania",RUS:"\\brussia|soviet.?union|u\\.?s\\.?s\\.?r|socialist.?republics",RWA:"rwanda",BLM:"barth(e|)lemy",SHN:"helena",KNA:"kitts|\\bnevis",LCA:"\\blucia",MAF:"^(?=.*collectivity).*martin|^(?=.*france).*martin(?!ique)|^(?=.*french).*martin(?!ique)",SPM:"miquelon",VCT:"vincent",WSM:"^(?!.*amer).*samoa",SMR:"san.?marino",STP:"\\bs(a|)o.?tom(e|)",SAU:"\\bsa\\w*.?arabia",SEN:"senegal",SRB:"^(?!.*monte).*serbia",SYC:"seychell",SLE:"sierra",SGP:"singapore",SXM:"^(?!.*martin)(?!.*saba).*maarten",SVK:"^(?!.*cze).*slovak",SVN:"slovenia",SLB:"solomon",SOM:"somali",ZAF:"south.africa|s\\\\..?africa",SGS:"south.?georgia|sandwich",SSD:"\\bs\\w*.?sudan",ESP:"spain",LKA:"sri.?lanka|ceylon",SDN:"^(?!.*\\bs(?!u)).*sudan",SUR:"surinam|dutch.?guiana",SJM:"svalbard",SWZ:"swaziland",SWE:"sweden",CHE:"switz|swiss",SYR:"syria",TWN:"taiwan|taipei|formosa|^(?!.*peo)(?=.*rep).*china",TJK:"tajik",THA:"thailand|\\bsiam",MKD:"macedonia|fyrom",TLS:"^(?=.*leste).*timor|^(?=.*east).*timor",TGO:"togo",TKL:"tokelau",TON:"tonga",TTO:"trinidad|tobago",TUN:"tunisia",TUR:"turkey",TKM:"turkmen",TCA:"turks",TUV:"tuvalu",UGA:"uganda",UKR:"ukrain",ARE:"emirates|^u\\.?a\\.?e\\.?$|united.?arab.?em",GBR:"united.?kingdom|britain|^u\\.?k\\.?$",TZA:"tanzania",USA:"united.?states\\b(?!.*islands)|\\bu\\.?s\\.?a\\.?\\b|^\\s*u\\.?s\\.?\\b(?!.*islands)",UMI:"minor.?outlying.?is",URY:"uruguay",UZB:"uzbek",VUT:"vanuatu|new.?hebrides",VEN:"venezuela",VNM:"^(?!.*republic).*viet.?nam|^(?=.*socialist).*viet.?nam",VGB:"^(?=.*\\bu\\.?\\s?k).*virgin|^(?=.*brit).*virgin|^(?=.*kingdom).*virgin",VIR:"^(?=.*\\bu\\.?\\s?s).*virgin|^(?=.*states).*virgin",WLF:"futuna|wallis",ESH:"western.sahara",YEM:"^(?!.*arab)(?!.*north)(?!.*sana)(?!.*peo)(?!.*dem)(?!.*south)(?!.*aden)(?!.*\\bp\\.?d\\.?r).*yemen",YMD:"^(?=.*peo).*yemen|^(?!.*rep)(?=.*dem).*yemen|^(?=.*south).*yemen|^(?=.*aden).*yemen|^(?=.*\\bp\\.?d\\.?r).*yemen",YUG:"yugoslavia",ZMB:"zambia|northern.?rhodesia",EAZ:"zanzibar",ZWE:"zimbabwe|^(?!.*northern).*rhodesia"}},{}],122:[function(_dereq_,module,exports){module.exports=["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller"]},{}],123:[function(_dereq_,module,exports){module.exports=["normal","condensed","semi-condensed","extra-condensed","ultra-condensed","expanded","semi-expanded","extra-expanded","ultra-expanded"]},{}],124:[function(_dereq_,module,exports){module.exports=["normal","italic","oblique"]},{}],125:[function(_dereq_,module,exports){module.exports=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"]},{}],126:[function(_dereq_,module,exports){"use strict";module.exports={parse:_dereq_("./parse"),stringify:_dereq_("./stringify")}},{"./parse":128,"./stringify":129}],127:[function(_dereq_,module,exports){"use strict";var sizes=_dereq_("css-font-size-keywords");module.exports={isSize:function isSize(value){return/^[\d\.]/.test(value)||-1!==value.indexOf("/")||-1!==sizes.indexOf(value)}}},{"css-font-size-keywords":122}],128:[function(_dereq_,module,exports){"use strict";var unquote=_dereq_("unquote"),globalKeywords=_dereq_("css-global-keywords"),systemFontKeywords=_dereq_("css-system-font-keywords"),fontWeightKeywords=_dereq_("css-font-weight-keywords"),fontStyleKeywords=_dereq_("css-font-style-keywords"),fontStretchKeywords=_dereq_("css-font-stretch-keywords"),splitBy=_dereq_("string-split-by"),isSize=_dereq_("./lib/util").isSize;module.exports=parseFont;var cache=parseFont.cache={};function parseFont(value){if("string"!=typeof value)throw new Error("Font argument must be a string.");if(cache[value])return cache[value];if(""===value)throw new Error("Cannot parse an empty string.");if(-1!==systemFontKeywords.indexOf(value))return cache[value]={system:value};for(var token,font={style:"normal",variant:"normal",weight:"normal",stretch:"normal",lineHeight:"normal",size:"1rem",family:["serif"]},tokens=splitBy(value,/\s+/);token=tokens.shift();){if(-1!==globalKeywords.indexOf(token))return["style","variant","weight","stretch"].forEach(function(prop){font[prop]=token}),cache[value]=font;if(-1===fontStyleKeywords.indexOf(token))if("normal"!==token&&"small-caps"!==token)if(-1===fontStretchKeywords.indexOf(token)){if(-1===fontWeightKeywords.indexOf(token)){if(isSize(token)){var parts=splitBy(token,"/");if(font.size=parts[0],null!=parts[1]?font.lineHeight=parseLineHeight(parts[1]):"/"===tokens[0]&&(tokens.shift(),font.lineHeight=parseLineHeight(tokens.shift())),!tokens.length)throw new Error("Missing required font-family.");return font.family=splitBy(tokens.join(" "),/\s*,\s*/).map(unquote),cache[value]=font}throw new Error("Unknown or unsupported font token: "+token)}font.weight=token}else font.stretch=token;else font.variant=token;else font.style=token}throw new Error("Missing required font-size.")}function parseLineHeight(value){var parsed=parseFloat(value);return parsed.toString()===value?parsed:value}},{"./lib/util":127,"css-font-stretch-keywords":123,"css-font-style-keywords":124,"css-font-weight-keywords":125,"css-global-keywords":130,"css-system-font-keywords":131,"string-split-by":502,unquote:522}],129:[function(_dereq_,module,exports){"use strict";var pick=_dereq_("pick-by-alias"),isSize=_dereq_("./lib/util").isSize,globals=a2o(_dereq_("css-global-keywords")),systems=a2o(_dereq_("css-system-font-keywords")),weights=a2o(_dereq_("css-font-weight-keywords")),styles=a2o(_dereq_("css-font-style-keywords")),stretches=a2o(_dereq_("css-font-stretch-keywords")),variants={normal:1,"small-caps":1},fams={serif:1,"sans-serif":1,monospace:1,cursive:1,fantasy:1,"system-ui":1},defaults_size="1rem",defaults_family="serif";function verify(value,values){if(value&&!values[value]&&!globals[value])throw Error("Unknown keyword `"+value+"`");return value}function a2o(a){for(var o={},i=0;i<a.length;i++)o[a[i]]=1;return o}module.exports=function stringifyFont(o){if((o=pick(o,{style:"style fontstyle fontStyle font-style slope distinction",variant:"variant font-variant fontVariant fontvariant var capitalization",weight:"weight w font-weight fontWeight fontweight",stretch:"stretch font-stretch fontStretch fontstretch width",size:"size s font-size fontSize fontsize height em emSize",lineHeight:"lh line-height lineHeight lineheight leading",family:"font family fontFamily font-family fontfamily type typeface face",system:"system reserved default global"})).system)return o.system&&verify(o.system,systems),o.system;if(verify(o.style,styles),verify(o.variant,variants),verify(o.weight,weights),verify(o.stretch,stretches),null==o.size&&(o.size=defaults_size),"number"==typeof o.size&&(o.size+="px"),!isSize)throw Error("Bad size value `"+o.size+"`");o.family||(o.family=defaults_family),Array.isArray(o.family)&&(o.family.length||(o.family=[defaults_family]),o.family=o.family.map(function(f){return fams[f]?f:'"'+f+'"'}).join(", "));var result=[];return result.push(o.style),o.variant!==o.style&&result.push(o.variant),o.weight!==o.variant&&o.weight!==o.style&&result.push(o.weight),o.stretch!==o.weight&&o.stretch!==o.variant&&o.stretch!==o.style&&result.push(o.stretch),result.push(o.size+(null==o.lineHeight||"normal"===o.lineHeight||o.lineHeight+""=="1"?"":"/"+o.lineHeight)),result.push(o.family),result.filter(Boolean).join(" ")}},{"./lib/util":127,"css-font-stretch-keywords":123,"css-font-style-keywords":124,"css-font-weight-keywords":125,"css-global-keywords":130,"css-system-font-keywords":131,"pick-by-alias":445}],130:[function(_dereq_,module,exports){module.exports=["inherit","initial","unset"]},{}],131:[function(_dereq_,module,exports){module.exports=["caption","icon","menu","message-box","small-caption","status-bar"]},{}],132:[function(_dereq_,module,exports){"use strict";module.exports=function cubicHermite(p0,v0,p1,v1,t,f){var ti=t-1,t2=t*t,ti2=ti*ti,h00=(1+2*t)*ti2,h10=t*ti2,h01=t2*(3-2*t),h11=t2*ti;if(p0.length){f||(f=new Array(p0.length));for(var i=p0.length-1;i>=0;--i)f[i]=h00*p0[i]+h10*v0[i]+h01*p1[i]+h11*v1[i];return f}return h00*p0+h10*v0+h01*p1+h11*v1},module.exports.derivative=function dcubicHermite(p0,v0,p1,v1,t,f){var dh00=6*t*t-6*t,dh10=3*t*t-4*t+1,dh01=-6*t*t+6*t,dh11=3*t*t-2*t;if(p0.length){f||(f=new Array(p0.length));for(var i=p0.length-1;i>=0;--i)f[i]=dh00*p0[i]+dh10*v0[i]+dh01*p1[i]+dh11*v1[i];return f}return dh00*p0+dh10*v0+dh01*p1[i]+dh11*v1}},{}],133:[function(_dereq_,module,exports){"use strict";var createThunk=_dereq_("./lib/thunk.js");module.exports=function compileCwise(user_args){var proc=new function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1};proc.pre=user_args.pre,proc.body=user_args.body,proc.post=user_args.post;var proc_args=user_args.args.slice(0);proc.argTypes=proc_args;for(var i=0;i<proc_args.length;++i){var arg_type=proc_args[i];if("array"===arg_type||"object"==typeof arg_type&&arg_type.blockIndices){if(proc.argTypes[i]="array",proc.arrayArgs.push(i),proc.arrayBlockIndices.push(arg_type.blockIndices?arg_type.blockIndices:0),proc.shimArgs.push("array"+i),i<proc.pre.args.length&&proc.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<proc.post.args.length&&proc.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===arg_type)proc.scalarArgs.push(i),proc.shimArgs.push("scalar"+i);else if("index"===arg_type){if(proc.indexArgs.push(i),i<proc.pre.args.length&&proc.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<proc.body.args.length&&proc.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<proc.post.args.length&&proc.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===arg_type){if(proc.shapeArgs.push(i),i<proc.pre.args.length&&proc.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<proc.body.args.length&&proc.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<proc.post.args.length&&proc.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof arg_type||!arg_type.offset)throw new Error("cwise: Unknown argument type "+proc_args[i]);proc.argTypes[i]="offset",proc.offsetArgs.push({array:arg_type.array,offset:arg_type.offset}),proc.offsetArgIndex.push(i)}}if(proc.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(proc.pre.args.length>proc_args.length)throw new Error("cwise: Too many arguments in pre() block");if(proc.body.args.length>proc_args.length)throw new Error("cwise: Too many arguments in body() block");if(proc.post.args.length>proc_args.length)throw new Error("cwise: Too many arguments in post() block");return proc.debug=!!user_args.printCode||!!user_args.debug,proc.funcName=user_args.funcName||"cwise",proc.blockSize=user_args.blockSize||64,createThunk(proc)}},{"./lib/thunk.js":135}],134:[function(_dereq_,module,exports){"use strict";var uniq=_dereq_("uniq");function innerFill(order,proc,body){var i,j,dimension=order.length,nargs=proc.arrayArgs.length,has_index=proc.indexArgs.length>0,code=[],vars=[],idx=0,pidx=0;for(i=0;i<dimension;++i)vars.push(["i",i,"=0"].join(""));for(j=0;j<nargs;++j)for(i=0;i<dimension;++i)pidx=idx,idx=order[i],0===i?vars.push(["d",j,"s",i,"=t",j,"p",idx].join("")):vars.push(["d",j,"s",i,"=(t",j,"p",idx,"-s",pidx,"*t",j,"p",pidx,")"].join(""));for(vars.length>0&&code.push("var "+vars.join(",")),i=dimension-1;i>=0;--i)idx=order[i],code.push(["for(i",i,"=0;i",i,"<s",idx,";++i",i,"){"].join(""));for(code.push(body),i=0;i<dimension;++i){for(pidx=idx,idx=order[i],j=0;j<nargs;++j)code.push(["p",j,"+=d",j,"s",i].join(""));has_index&&(i>0&&code.push(["index[",pidx,"]-=s",pidx].join("")),code.push(["++index[",idx,"]"].join(""))),code.push("}")}return code.join("\n")}function processBlock(block,proc,dtypes){for(var code=block.body,pre=[],post=[],i=0;i<block.args.length;++i){var carg=block.args[i];if(!(carg.count<=0)){var re=new RegExp(carg.name,"g"),ptrStr="",arrNum=proc.arrayArgs.indexOf(i);switch(proc.argTypes[i]){case"offset":var offArgIndex=proc.offsetArgIndex.indexOf(i);arrNum=proc.offsetArgs[offArgIndex].array,ptrStr="+q"+offArgIndex;case"array":ptrStr="p"+arrNum+ptrStr;var localStr="l"+i,arrStr="a"+arrNum;if(0===proc.arrayBlockIndices[arrNum])1===carg.count?"generic"===dtypes[arrNum]?carg.lvalue?(pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join("")),code=code.replace(re,localStr),post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))):code=code.replace(re,[arrStr,".get(",ptrStr,")"].join("")):code=code.replace(re,[arrStr,"[",ptrStr,"]"].join("")):"generic"===dtypes[arrNum]?(pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join("")),code=code.replace(re,localStr),carg.lvalue&&post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))):(pre.push(["var ",localStr,"=",arrStr,"[",ptrStr,"]"].join("")),code=code.replace(re,localStr),carg.lvalue&&post.push([arrStr,"[",ptrStr,"]=",localStr].join("")));else{for(var reStrArr=[carg.name],ptrStrArr=[ptrStr],j=0;j<Math.abs(proc.arrayBlockIndices[arrNum]);j++)reStrArr.push("\\s*\\[([^\\]]+)\\]"),ptrStrArr.push("$"+(j+1)+"*t"+arrNum+"b"+j);if(re=new RegExp(reStrArr.join(""),"g"),ptrStr=ptrStrArr.join("+"),"generic"===dtypes[arrNum])throw new Error("cwise: Generic arrays not supported in combination with blocks!");code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}break;case"scalar":code=code.replace(re,"Y"+proc.scalarArgs.indexOf(i));break;case"index":code=code.replace(re,"index");break;case"shape":code=code.replace(re,"shape")}}}return[pre.join("\n"),code,post.join("\n")].join("\n").trim()}module.exports=function generateCWiseOp(proc,typesig){for(var dimension=typesig[1].length-Math.abs(proc.arrayBlockIndices[0])|0,orders=new Array(proc.arrayArgs.length),dtypes=new Array(proc.arrayArgs.length),i=0;i<proc.arrayArgs.length;++i)dtypes[i]=typesig[2*i],orders[i]=typesig[2*i+1];var blockBegin=[],blockEnd=[],loopBegin=[],loopEnd=[],loopOrders=[];for(i=0;i<proc.arrayArgs.length;++i){proc.arrayBlockIndices[i]<0?(loopBegin.push(0),loopEnd.push(dimension),blockBegin.push(dimension),blockEnd.push(dimension+proc.arrayBlockIndices[i])):(loopBegin.push(proc.arrayBlockIndices[i]),loopEnd.push(proc.arrayBlockIndices[i]+dimension),blockBegin.push(0),blockEnd.push(proc.arrayBlockIndices[i]));for(var newOrder=[],j=0;j<orders[i].length;j++)loopBegin[i]<=orders[i][j]&&orders[i][j]<loopEnd[i]&&newOrder.push(orders[i][j]-loopBegin[i]);loopOrders.push(newOrder)}var arglist=["SS"],code=["'use strict'"],vars=[];for(j=0;j<dimension;++j)vars.push(["s",j,"=SS[",j,"]"].join(""));for(i=0;i<proc.arrayArgs.length;++i){for(arglist.push("a"+i),arglist.push("t"+i),arglist.push("p"+i),j=0;j<dimension;++j)vars.push(["t",i,"p",j,"=t",i,"[",loopBegin[i]+j,"]"].join(""));for(j=0;j<Math.abs(proc.arrayBlockIndices[i]);++j)vars.push(["t",i,"b",j,"=t",i,"[",blockBegin[i]+j,"]"].join(""))}for(i=0;i<proc.scalarArgs.length;++i)arglist.push("Y"+i);if(proc.shapeArgs.length>0&&vars.push("shape=SS.slice(0)"),proc.indexArgs.length>0){var zeros=new Array(dimension);for(i=0;i<dimension;++i)zeros[i]="0";vars.push(["index=[",zeros.join(","),"]"].join(""))}for(i=0;i<proc.offsetArgs.length;++i){var off_arg=proc.offsetArgs[i],init_string=[];for(j=0;j<off_arg.offset.length;++j)0!==off_arg.offset[j]&&(1===off_arg.offset[j]?init_string.push(["t",off_arg.array,"p",j].join("")):init_string.push([off_arg.offset[j],"*t",off_arg.array,"p",j].join("")));0===init_string.length?vars.push("q"+i+"=0"):vars.push(["q",i,"=",init_string.join("+")].join(""))}var thisVars=uniq([].concat(proc.pre.thisVars).concat(proc.body.thisVars).concat(proc.post.thisVars));for((vars=vars.concat(thisVars)).length>0&&code.push("var "+vars.join(",")),i=0;i<proc.arrayArgs.length;++i)code.push("p"+i+"|=0");proc.pre.body.length>3&&code.push(processBlock(proc.pre,proc,dtypes));var body=processBlock(proc.body,proc,dtypes),matched=function countMatches(orders){for(var matched=0,dimension=orders[0].length;matched<dimension;){for(var j=1;j<orders.length;++j)if(orders[j][matched]!==orders[0][matched])return matched;++matched}return matched}(loopOrders);matched<dimension?code.push(function outerFill(matched,order,proc,body){for(var dimension=order.length,nargs=proc.arrayArgs.length,blockSize=proc.blockSize,has_index=proc.indexArgs.length>0,code=[],i=0;i<nargs;++i)code.push(["var offset",i,"=p",i].join(""));for(i=matched;i<dimension;++i)code.push(["for(var j"+i+"=SS[",order[i],"]|0;j",i,">0;){"].join("")),code.push(["if(j",i,"<",blockSize,"){"].join("")),code.push(["s",order[i],"=j",i].join("")),code.push(["j",i,"=0"].join("")),code.push(["}else{s",order[i],"=",blockSize].join("")),code.push(["j",i,"-=",blockSize,"}"].join("")),has_index&&code.push(["index[",order[i],"]=j",i].join(""));for(i=0;i<nargs;++i){for(var indexStr=["offset"+i],j=matched;j<dimension;++j)indexStr.push(["j",j,"*t",i,"p",order[j]].join(""));code.push(["p",i,"=(",indexStr.join("+"),")"].join(""))}for(code.push(innerFill(order,proc,body)),i=matched;i<dimension;++i)code.push("}");return code.join("\n")}(matched,loopOrders[0],proc,body)):code.push(innerFill(loopOrders[0],proc,body)),proc.post.body.length>3&&code.push(processBlock(proc.post,proc,dtypes)),proc.debug&&console.log("-----Generated cwise routine for ",typesig,":\n"+code.join("\n")+"\n----------");var loopName=[proc.funcName||"unnamed","_cwise_loop_",orders[0].join("s"),"m",matched,function typeSummary(dtypes){for(var summary=new Array(dtypes.length),allEqual=!0,i=0;i<dtypes.length;++i){var t=dtypes[i],digits=t.match(/\d+/);digits=digits?digits[0]:"",0===t.charAt(0)?summary[i]="u"+t.charAt(1)+digits:summary[i]=t.charAt(0)+digits,i>0&&(allEqual=allEqual&&summary[i]===summary[i-1])}return allEqual?summary[0]:summary.join("")}(dtypes)].join("");return new Function(["function ",loopName,"(",arglist.join(","),"){",code.join("\n"),"} return ",loopName].join(""))()}},{uniq:521}],135:[function(_dereq_,module,exports){"use strict";var compile=_dereq_("./compile.js");module.exports=function createThunk(proc){var code=["'use strict'","var CACHED={}"],vars=[],thunkName=proc.funcName+"_cwise_thunk";code.push(["return function ",thunkName,"(",proc.shimArgs.join(","),"){"].join(""));for(var typesig=[],string_typesig=[],proc_args=[["array",proc.arrayArgs[0],".shape.slice(",Math.max(0,proc.arrayBlockIndices[0]),proc.arrayBlockIndices[0]<0?","+proc.arrayBlockIndices[0]+")":")"].join("")],shapeLengthConditions=[],shapeConditions=[],i=0;i<proc.arrayArgs.length;++i){var j=proc.arrayArgs[i];vars.push(["t",j,"=array",j,".dtype,","r",j,"=array",j,".order"].join("")),typesig.push("t"+j),typesig.push("r"+j),string_typesig.push("t"+j),string_typesig.push("r"+j+".join()"),proc_args.push("array"+j+".data"),proc_args.push("array"+j+".stride"),proc_args.push("array"+j+".offset|0"),i>0&&(shapeLengthConditions.push("array"+proc.arrayArgs[0]+".shape.length===array"+j+".shape.length+"+(Math.abs(proc.arrayBlockIndices[0])-Math.abs(proc.arrayBlockIndices[i]))),shapeConditions.push("array"+proc.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[0])+"]===array"+j+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[i])+"]"))}for(proc.arrayArgs.length>1&&(code.push("if (!("+shapeLengthConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),code.push("for(var shapeIndex=array"+proc.arrayArgs[0]+".shape.length-"+Math.abs(proc.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),code.push("if (!("+shapeConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),code.push("}")),i=0;i<proc.scalarArgs.length;++i)proc_args.push("scalar"+proc.scalarArgs[i]);return vars.push(["type=[",string_typesig.join(","),"].join()"].join("")),vars.push("proc=CACHED[type]"),code.push("var "+vars.join(",")),code.push(["if(!proc){","CACHED[type]=proc=compile([",typesig.join(","),"])}","return proc(",proc_args.join(","),")}"].join("")),proc.debug&&console.log("-----Generated thunk:\n"+code.join("\n")+"\n----------"),new Function("compile",code.join("\n"))(compile.bind(void 0,proc))}},{"./compile.js":134}],136:[function(_dereq_,module,exports){module.exports=_dereq_("cwise-compiler")},{"cwise-compiler":133}],137:[function(_dereq_,module,exports){"use strict";var define,copy=_dereq_("es5-ext/object/copy"),normalizeOptions=_dereq_("es5-ext/object/normalize-options"),ensureCallable=_dereq_("es5-ext/object/valid-callable"),map=_dereq_("es5-ext/object/map"),callable=_dereq_("es5-ext/object/valid-callable"),validValue=_dereq_("es5-ext/object/valid-value"),bind=Function.prototype.bind,defineProperty=Object.defineProperty,hasOwnProperty=Object.prototype.hasOwnProperty;define=function(name,desc,options){var dgs,value=validValue(desc)&&callable(desc.value);return delete(dgs=copy(desc)).writable,delete dgs.value,dgs.get=function(){return!options.overwriteDefinition&&hasOwnProperty.call(this,name)?value:(desc.value=bind.call(value,options.resolveContext?options.resolveContext(this):this),defineProperty(this,name,desc),this[name])},dgs},module.exports=function(props){var options=normalizeOptions(arguments[1]);return null!=options.resolveContext&&ensureCallable(options.resolveContext),map(props,function(desc,name){return define(name,desc,options)})}},{"es5-ext/object/copy":173,"es5-ext/object/map":182,"es5-ext/object/normalize-options":183,"es5-ext/object/valid-callable":187,"es5-ext/object/valid-value":189}],138:[function(_dereq_,module,exports){"use strict";var assign=_dereq_("es5-ext/object/assign"),normalizeOpts=_dereq_("es5-ext/object/normalize-options"),isCallable=_dereq_("es5-ext/object/is-callable"),contains=_dereq_("es5-ext/string/#/contains");(module.exports=function(dscr,value){var c,e,w,options,desc;return arguments.length<2||"string"!=typeof dscr?(options=value,value=dscr,dscr=null):options=arguments[2],null==dscr?(c=w=!0,e=!1):(c=contains.call(dscr,"c"),e=contains.call(dscr,"e"),w=contains.call(dscr,"w")),desc={value:value,configurable:c,enumerable:e,writable:w},options?assign(normalizeOpts(options),desc):desc}).gs=function(dscr,get,set){var c,e,options,desc;return"string"!=typeof dscr?(options=set,set=get,get=dscr,dscr=null):options=arguments[3],null==get?get=void 0:isCallable(get)?null==set?set=void 0:isCallable(set)||(options=set,set=void 0):(options=get,get=set=void 0),null==dscr?(c=!0,e=!1):(c=contains.call(dscr,"c"),e=contains.call(dscr,"e")),desc={get:get,set:set,configurable:c,enumerable:e},options?assign(normalizeOpts(options),desc):desc}},{"es5-ext/object/assign":170,"es5-ext/object/is-callable":176,"es5-ext/object/normalize-options":183,"es5-ext/string/#/contains":190}],139:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN},bisector=function(compare){return 1===compare.length&&(compare=function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}(compare)),{left:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}};var ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left;function pair(a,b){return[a,b]}var number=function(x){return null===x?NaN:+x},variance=function(values,valueof){var value,delta,n=values.length,m=0,i=-1,mean=0,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));if(m>1)return sum/(m-1)},deviation=function(array,f){var v=variance(array,f);return v?Math.sqrt(v):v},extent=function(values,valueof){var value,min,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(min=max=value;++i<n;)null!=(value=values[i])&&(min>value&&(min=value),max<value&&(max=value))}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(min=max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&(min>value&&(min=value),max<value&&(max=value));return[min,max]},array=Array.prototype,slice=array.slice,map=array.map,constant=function(x){return function(){return x}},identity=function(x){return x},range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1}var sturges=function(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1},quantile=function(values,p,valueof){if(null==valueof&&(valueof=number),n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},min=function(values,valueof){var value,min,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(min=value;++i<n;)null!=(value=values[i])&&min>value&&(min=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(min=value;++i<n;)null!=(value=valueof(values[i],i,values))&&min>value&&(min=value);return min},transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose};function length(d){return d.length}exports.bisect=bisectRight,exports.bisectRight=bisectRight,exports.bisectLeft=bisectLeft,exports.ascending=ascending,exports.bisector=bisector,exports.cross=function(values0,values1,reduce){var i0,i1,i,value0,n0=values0.length,n1=values1.length,values=new Array(n0*n1);for(null==reduce&&(reduce=pair),i0=i=0;i0<n0;++i0)for(value0=values0[i0],i1=0;i1<n1;++i1,++i)values[i]=reduce(value0,values1[i1]);return values},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.extent=extent,exports.histogram=function(){var value=identity,domain=extent,threshold=sturges;function histogram(data){var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=tickStep(x0,x1,tz),tz=range(Math.ceil(x0/tz)*tz,Math.floor(x1/tz)*tz,tz));for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram},exports.thresholdFreedmanDiaconis=function(values,min,max){return values=map.call(values,number).sort(ascending),Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))},exports.thresholdSturges=sturges,exports.max=function(values,valueof){var value,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(max=value;++i<n;)null!=(value=values[i])&&value>max&&(max=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&value>max&&(max=value);return max},exports.mean=function(values,valueof){var value,n=values.length,m=n,i=-1,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))?--m:sum+=value;else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))?--m:sum+=value;if(m)return sum/m},exports.median=function(values,valueof){var value,n=values.length,i=-1,numbers=[];if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||numbers.push(value);else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||numbers.push(value);return quantile(numbers.sort(ascending),.5)},exports.merge=function(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);--n>=0;)for(m=(array=arrays[n]).length;--m>=0;)merged[--j]=array[m];return merged},exports.min=min,exports.pairs=function(array,f){null==f&&(f=pair);for(var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=f(p,p=array[++i]);return pairs},exports.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},exports.quantile=quantile,exports.range=range,exports.scan=function(values,compare){if(n=values.length){var n,xi,i=0,j=0,xj=values[j];for(null==compare&&(compare=ascending);++i<n;)(compare(xi=values[i],xj)<0||0!==compare(xj,xj))&&(xj=xi,j=i);return 0===compare(xj,xj)?j:void 0}},exports.shuffle=function(array,i0,i1){for(var t,i,m=(null==i1?array.length:i1)-(i0=null==i0?0:+i0);m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},exports.sum=function(values,valueof){var value,n=values.length,i=-1,sum=0;if(null==valueof)for(;++i<n;)(value=+values[i])&&(sum+=value);else for(;++i<n;)(value=+valueof(values[i],i,values))&&(sum+=value);return sum},exports.ticks=function(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(start=Math.floor(start*step),stop=Math.ceil(stop*step),ticks=new Array(n=Math.ceil(start-stop+1));++i<n;)ticks[i]=(start-i)/step;return reverse&&ticks.reverse(),ticks},exports.tickIncrement=tickIncrement,exports.tickStep=tickStep,exports.transpose=transpose,exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],140:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";function Map(){}function map(object,f){var map=new Map;if(object instanceof Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(null==f)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}Map.prototype=map.prototype={constructor:Map,has:function(key){return"$"+key in this},get:function(key){return this["$"+key]},set:function(key,value){return this["$"+key]=value,this},remove:function(key){var property="$"+key;return property in this&&delete this[property]},clear:function(){for(var property in this)"$"===property[0]&&delete this[property]},keys:function(){var keys=[];for(var property in this)"$"===property[0]&&keys.push(property.slice(1));return keys},values:function(){var values=[];for(var property in this)"$"===property[0]&&values.push(this[property]);return values},entries:function(){var entries=[];for(var property in this)"$"===property[0]&&entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var size=0;for(var property in this)"$"===property[0]&&++size;return size},empty:function(){for(var property in this)if("$"===property[0])return!1;return!0},each:function(f){for(var property in this)"$"===property[0]&&f(this[property],property.slice(1),this)}};function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map()}function setMap(map$$1,key,value){map$$1.set(key,value)}function Set(){}var proto=map.prototype;function set(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(null==f)for(;++i<n;)set.add(object[i]);else for(;++i<n;)set.add(f(object[i],i,object))}return set}Set.prototype=set.prototype={constructor:Set,has:proto.has,add:function(value){return this["$"+(value+="")]=value,this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};exports.nest=function(){var sortValues,rollup,nest,keys=[],sortKeys=[];function apply(array,depth,createResult,setResult){if(depth>=keys.length)return null!=sortValues&&array.sort(sortValues),null!=rollup?rollup(array):array;for(var keyValue,value,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=map(),result=createResult();++i<n;)(values=valuesByKey.get(keyValue=key(value=array[i])+""))?values.push(value):valuesByKey.set(keyValue,[value]);return valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))}),result}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return function entries(map$$1,depth){if(++depth>keys.length)return map$$1;var array,sortKey=sortKeys[depth-1];return null!=rollup&&depth>=keys.length?array=map$$1.entries():(array=[],map$$1.each(function(v,k){array.push({key:k,values:entries(v,depth)})})),null!=sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}(apply(array,0,createMap,setMap),0)},key:function(d){return keys.push(d),nest},sortKeys:function(order){return sortKeys[keys.length-1]=order,nest},sortValues:function(order){return sortValues=order,nest},rollup:function(f){return rollup=f,nest}}},exports.set=set,exports.map=map,exports.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys},exports.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values},exports.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries},Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],141:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";var define=function(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor};function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color(format){var m;return format=(format+"").trim().toLowerCase(),(m=reHex3.exec(format))?new Rgb((m=parseInt(m[1],16))>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hsl(h,s,l,opacity){return 1===arguments.length?function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),define(Rgb,rgb,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)},toString:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}})),define(Hsl,hsl,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}o instanceof Rgb||(o=rgbConvert(o));var x,z,r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(o instanceof Lab||(o=labConvert(o)),0===o.a&&0===o.b)return new Hcl(NaN,0,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=Xn*lab2xyz(x))-1.6168667*(y=Yn*lab2xyz(y))-.4906146*(z=Zn*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelix(h,s,l,opacity){return 1===arguments.length?function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);o instanceof Rgb||(o=rgbConvert(o));var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}})),exports.color=color,exports.rgb=rgb,exports.hsl=hsl,exports.lab=lab,exports.hcl=hcl,exports.lch=function lch(l,c,h,opacity){return 1===arguments.length?hclConvert(l):new Hcl(h,c,l,null==opacity?1:opacity)},exports.gray=function gray(l,opacity){return new Lab(l,0,0,null==opacity?1:opacity)},exports.cubehelix=cubehelix,Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],142:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";var noop={value:function(){}};function dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _)throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function get(type,name){for(var c,i=0,n=type.length;i<n;++i)if((c=type[i]).name===name)return c.value}function set(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=noop,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name:name,value:callback}),type}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var t,_=this._,T=function parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=set(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=set(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=get(_[t],typename.name)))return t},copy:function(){var copy={},_=this._;for(var t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function(type,that){if((n=arguments.length-2)>0)for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}},exports.dispatch=dispatch,Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],143:[function(_dereq_,module,exports){var global,factory;global=this,factory=function(exports,d3Quadtree,d3Collection,d3Dispatch,d3Timer){"use strict";var constant=function(x){return function(){return x}},jiggle=function(){return 1e-6*(Math.random()-.5)};function x(d){return d.x+d.vx}function y(d){return d.y+d.vy}function index(d){return d.index}function find(nodeById,nodeId){var node=nodeById.get(nodeId);if(!node)throw new Error("missing: "+nodeId);return node}function x$1(d){return d.x}function y$1(d){return d.y}var initialRadius=10,initialAngle=Math.PI*(3-Math.sqrt(5));exports.forceCenter=function(x,y){var nodes;function force(){var i,node,n=nodes.length,sx=0,sy=0;for(i=0;i<n;++i)sx+=(node=nodes[i]).x,sy+=node.y;for(sx=sx/n-x,sy=sy/n-y,i=0;i<n;++i)(node=nodes[i]).x-=sx,node.y-=sy}return null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force},exports.forceCollide=function(radius){var nodes,radii,strength=1,iterations=1;function force(){for(var i,tree,node,xi,yi,ri,ri2,n=nodes.length,k=0;k<iterations;++k)for(tree=d3Quadtree.quadtree(nodes,x,y).visitAfter(prepare),i=0;i<n;++i)node=nodes[i],ri=radii[node.index],ri2=ri*ri,xi=node.x+node.vx,yi=node.y+node.vy,tree.visit(apply);function apply(quad,x0,y0,x1,y1){var data=quad.data,rj=quad.r,r=ri+rj;if(!data)return x0>xi+r||x1<xi-r||y0>yi+r||y1<yi-r;if(data.index>node.index){var x=xi-data.x-data.vx,y=yi-data.y-data.vy,l=x*x+y*y;l<r*r&&(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l=(r-(l=Math.sqrt(l)))/l*strength,node.vx+=(x*=l)*(r=(rj*=rj)/(ri2+rj)),node.vy+=(y*=l)*r,data.vx-=x*(r=1-r),data.vy-=y*r)}}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i)quad[i]&&quad[i].r>quad.r&&(quad.r=quad[i].r)}function initialize(){if(nodes){var i,node,n=nodes.length;for(radii=new Array(n),i=0;i<n;++i)node=nodes[i],radii[node.index]=+radius(node,i,nodes)}}return"function"!=typeof radius&&(radius=constant(null==radius?1:+radius)),force.initialize=function(_){nodes=_,initialize()},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant(+_),initialize(),force):radius},force},exports.forceLink=function(links){var strengths,distances,nodes,count,bias,id=index,strength=function defaultStrength(link){return 1/Math.min(count[link.source.index],count[link.target.index])},distance=constant(30),iterations=1;function force(alpha){for(var k=0,n=links.length;k<iterations;++k)for(var link,source,target,x,y,l,b,i=0;i<n;++i)source=(link=links[i]).source,x=(target=link.target).x+target.vx-source.x-source.vx||jiggle(),y=target.y+target.vy-source.y-source.vy||jiggle(),x*=l=((l=Math.sqrt(x*x+y*y))-distances[i])/l*alpha*strengths[i],y*=l,target.vx-=x*(b=bias[i]),target.vy-=y*b,source.vx+=x*(b=1-b),source.vy+=y*b}function initialize(){if(nodes){var i,link,n=nodes.length,m=links.length,nodeById=d3Collection.map(nodes,id);for(i=0,count=new Array(n);i<m;++i)(link=links[i]).index=i,"object"!=typeof link.source&&(link.source=find(nodeById,link.source)),"object"!=typeof link.target&&(link.target=find(nodeById,link.target)),count[link.source.index]=(count[link.source.index]||0)+1,count[link.target.index]=(count[link.target.index]||0)+1;for(i=0,bias=new Array(m);i<m;++i)link=links[i],bias[i]=count[link.source.index]/(count[link.source.index]+count[link.target.index]);strengths=new Array(m),initializeStrength(),distances=new Array(m),initializeDistance()}}function initializeStrength(){if(nodes)for(var i=0,n=links.length;i<n;++i)strengths[i]=+strength(links[i],i,links)}function initializeDistance(){if(nodes)for(var i=0,n=links.length;i<n;++i)distances[i]=+distance(links[i],i,links)}return null==links&&(links=[]),force.initialize=function(_){nodes=_,initialize()},force.links=function(_){return arguments.length?(links=_,initialize(),force):links},force.id=function(_){return arguments.length?(id=_,force):id},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initializeStrength(),force):strength},force.distance=function(_){return arguments.length?(distance="function"==typeof _?_:constant(+_),initializeDistance(),force):distance},force},exports.forceManyBody=function(){var nodes,node,alpha,strengths,strength=constant(-30),distanceMin2=1,distanceMax2=1/0,theta2=.81;function force(_){var i,n=nodes.length,tree=d3Quadtree.quadtree(nodes,x$1,y$1).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i)node=nodes[i],tree.visit(apply)}function initialize(){if(nodes){var i,node,n=nodes.length;for(strengths=new Array(n),i=0;i<n;++i)node=nodes[i],strengths[node.index]=+strength(node,i,nodes)}}function accumulate(quad){var q,c,x,y,i,strength=0,weight=0;if(quad.length){for(x=y=i=0;i<4;++i)(q=quad[i])&&(c=Math.abs(q.value))&&(strength+=q.value,weight+=c,x+=c*q.x,y+=c*q.y);quad.x=x/weight,quad.y=y/weight}else{(q=quad).x=q.data.x,q.y=q.data.y;do{strength+=strengths[q.data.index]}while(q=q.next)}quad.value=strength}function apply(quad,x1,_,x2){if(!quad.value)return!0;var x=quad.x-node.x,y=quad.y-node.y,w=x2-x1,l=x*x+y*y;if(w*w/theta2<l)return l<distanceMax2&&(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)),node.vx+=x*quad.value*alpha/l,node.vy+=y*quad.value*alpha/l),!0;if(!(quad.length||l>=distanceMax2)){(quad.data!==node||quad.next)&&(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)));do{quad.data!==node&&(w=strengths[quad.data.index]*alpha/l,node.vx+=x*w,node.vy+=y*w)}while(quad=quad.next)}}return force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)},force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)},force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)},force},exports.forceRadial=function(radius,x,y){var nodes,strengths,radiuses,strength=constant(.1);function force(alpha){for(var i=0,n=nodes.length;i<n;++i){var node=nodes[i],dx=node.x-x||1e-6,dy=node.y-y||1e-6,r=Math.sqrt(dx*dx+dy*dy),k=(radiuses[i]-r)*strengths[i]*alpha/r;node.vx+=dx*k,node.vy+=dy*k}}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),radiuses=new Array(n),i=0;i<n;++i)radiuses[i]=+radius(nodes[i],i,nodes),strengths[i]=isNaN(radiuses[i])?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof radius&&(radius=constant(+radius)),null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant(+_),initialize(),force):radius},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force},exports.forceSimulation=function(nodes){var simulation,alpha=1,alphaMin=.001,alphaDecay=1-Math.pow(alphaMin,1/300),alphaTarget=0,velocityDecay=.6,forces=d3Collection.map(),stepper=d3Timer.timer(step),event=d3Dispatch.dispatch("tick","end");function step(){tick(),event.call("tick",simulation),alpha<alphaMin&&(stepper.stop(),event.call("end",simulation))}function tick(){var i,node,n=nodes.length;for(alpha+=(alphaTarget-alpha)*alphaDecay,forces.each(function(force){force(alpha)}),i=0;i<n;++i)null==(node=nodes[i]).fx?node.x+=node.vx*=velocityDecay:(node.x=node.fx,node.vx=0),null==node.fy?node.y+=node.vy*=velocityDecay:(node.y=node.fy,node.vy=0)}function initializeNodes(){for(var node,i=0,n=nodes.length;i<n;++i){if((node=nodes[i]).index=i,isNaN(node.x)||isNaN(node.y)){var radius=initialRadius*Math.sqrt(i),angle=i*initialAngle;node.x=radius*Math.cos(angle),node.y=radius*Math.sin(angle)}(isNaN(node.vx)||isNaN(node.vy))&&(node.vx=node.vy=0)}}function initializeForce(force){return force.initialize&&force.initialize(nodes),force}return null==nodes&&(nodes=[]),initializeNodes(),simulation={tick:tick,restart:function(){return stepper.restart(step),simulation},stop:function(){return stepper.stop(),simulation},nodes:function(_){return arguments.length?(nodes=_,initializeNodes(),forces.each(initializeForce),simulation):nodes},alpha:function(_){return arguments.length?(alpha=+_,simulation):alpha},alphaMin:function(_){return arguments.length?(alphaMin=+_,simulation):alphaMin},alphaDecay:function(_){return arguments.length?(alphaDecay=+_,simulation):+alphaDecay},alphaTarget:function(_){return arguments.length?(alphaTarget=+_,simulation):alphaTarget},velocityDecay:function(_){return arguments.length?(velocityDecay=1-_,simulation):1-velocityDecay},force:function(name,_){return arguments.length>1?(null==_?forces.remove(name):forces.set(name,initializeForce(_)),simulation):forces.get(name)},find:function(x,y,radius){var dx,dy,d2,node,closest,i=0,n=nodes.length;for(null==radius?radius=1/0:radius*=radius,i=0;i<n;++i)(d2=(dx=x-(node=nodes[i]).x)*dx+(dy=y-node.y)*dy)<radius&&(closest=node,radius=d2);return closest},on:function(name,_){return arguments.length>1?(event.on(name,_),simulation):event.on(name)}}},exports.forceX=function(x){var nodes,strengths,xz,strength=constant(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vx+=(xz[i]-node.x)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),xz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(xz[i]=+x(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof x&&(x=constant(null==x?0:+x)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.x=function(_){return arguments.length?(x="function"==typeof _?_:constant(+_),initialize(),force):x},force},exports.forceY=function(y){var nodes,strengths,yz,strength=constant(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vy+=(yz[i]-node.y)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),yz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(yz[i]=+y(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof y&&(y=constant(null==y?0:+y)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.y=function(_){return arguments.length?(y="function"==typeof _?_:constant(+_),initialize(),force):y},force},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports,_dereq_("d3-quadtree"),_dereq_("d3-collection"),_dereq_("d3-dispatch"),_dereq_("d3-timer")):factory(global.d3=global.d3||{},global.d3,global.d3,global.d3,global.d3)},{"d3-collection":140,"d3-dispatch":142,"d3-quadtree":145,"d3-timer":146}],144:[function(_dereq_,module,exports){var global,factory;global=this,factory=function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}var basis$1=function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}},basisClosed=function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}},constant=function(x){return function(){return x}};function linear(a,d){return function(t){return a+t*d}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb$1=function rgbGamma(y){var color$$1=gamma(y);function rgb$$1(start,end){var r=color$$1((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color$$1(start.g,end.g),b=color$$1(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb$$1.gamma=rgbGamma,rgb$$1}(1);function rgbSpline(spline){return function(colors){var i,color$$1,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color$$1=d3Color.rgb(colors[i]),r[i]=color$$1.r||0,g[i]=color$$1.g||0,b[i]=color$$1.b||0;return r=spline(r),g=spline(g),b=spline(b),color$$1.opacity=1,function(t){return color$$1.r=r(t),color$$1.g=g(t),color$$1.b=b(t),color$$1+""}}}var rgbBasis=rgbSpline(basis$1),rgbBasisClosed=rgbSpline(basisClosed),array=function(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}},date=function(a,b){var d=new Date;return b-=a=+a,function(t){return d.setTime(a+b*t),d}},number=function(a,b){return b-=a=+a,function(t){return a+b*t}},object=function(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),null!==b&&"object"==typeof b||(b={}),b)k in a?i[k]=value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}},reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");var cssNode,cssRoot,cssView,svgNode,string=function(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function one(b){return function(t){return b(t)+""}}(q[0].x):function zero(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})},value=function(a,b){var c,t=typeof b;return null==b||"boolean"===t?constant(b):("number"===t?number:"string"===t?(c=d3Color.color(b))?(b=c,rgb$1):string:b instanceof d3Color.color?rgb$1:b instanceof Date?date:Array.isArray(b)?array:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:number)(a,b)},degrees=180/Math.PI,identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},decompose=function(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}};function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function rotate(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function skewX(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(function parseCss(value){return"none"===value?identity:(cssNode||(cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView),cssNode.style.transform=value,value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform"),cssRoot.removeChild(cssNode),value=value.slice(7,-1).split(","),decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5]))},"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(function parseSvg(value){return null==value?identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?(value=value.matrix,decompose(value.a,value.b,value.c,value.d,value.e,value.f)):identity)},", ",")",")"),rho=Math.SQRT2;function cosh(x){return((x=Math.exp(x))+1/x)/2}function hsl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hsl$2=hsl$1(hue),hslLong=hsl$1(nogamma);function hcl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hcl$2=hcl$1(hue),hclLong=hcl$1(nogamma);function cubehelix$1(hue$$1){return function cubehelixGamma(y){function cubehelix$$1(start,end){var h=hue$$1((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix$$1.gamma=cubehelixGamma,cubehelix$$1}(1)}var cubehelix$2=cubehelix$1(hue),cubehelixLong=cubehelix$1(nogamma);exports.interpolate=value,exports.interpolateArray=array,exports.interpolateBasis=basis$1,exports.interpolateBasisClosed=basisClosed,exports.interpolateDate=date,exports.interpolateNumber=number,exports.interpolateObject=object,exports.interpolateRound=function(a,b){return b-=a=+a,function(t){return Math.round(a+b*t)}},exports.interpolateString=string,exports.interpolateTransformCss=interpolateTransformCss,exports.interpolateTransformSvg=interpolateTransformSvg,exports.interpolateZoom=function(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<1e-12)S=Math.log(w1/w0)/rho,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho,i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(2*d1)*(coshr0*function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}(rho*s+r0)-function sinh(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}return i.duration=1e3*S,i},exports.interpolateRgb=rgb$1,exports.interpolateRgbBasis=rgbBasis,exports.interpolateRgbBasisClosed=rgbBasisClosed,exports.interpolateHsl=hsl$2,exports.interpolateHslLong=hslLong,exports.interpolateLab=function lab$1(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.l=l(t),start.a=a(t),start.b=b(t),start.opacity=opacity(t),start+""}},exports.interpolateHcl=hcl$2,exports.interpolateHclLong=hclLong,exports.interpolateCubehelix=cubehelix$2,exports.interpolateCubehelixLong=cubehelixLong,exports.piecewise=function piecewise(interpolate,values){for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}},exports.quantize=function(interpolator,n){for(var samples=new Array(n),i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports,_dereq_("d3-color")):factory(global.d3=global.d3||{},global.d3)},{"d3-color":141}],145:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";function add(tree,x,y,d){if(isNaN(x)||isNaN(y))return tree;var parent,xm,ym,xp,yp,right,bottom,i,j,node=tree._root,leaf={data:d},x0=tree._x0,y0=tree._y0,x1=tree._x1,y1=tree._y1;if(!node)return tree._root=leaf,tree;for(;node.length;)if((right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,parent=node,!(node=node[i=bottom<<1|right]))return parent[i]=leaf,tree;if(xp=+tree._x.call(null,node.data),yp=+tree._y.call(null,node.data),x===xp&&y===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;do{parent=parent?parent[i]=new Array(4):tree._root=new Array(4),(right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym}while((i=bottom<<1|right)==(j=(yp>=ym)<<1|xp>=xm));return parent[j]=node,parent[i]=leaf,tree}var Quad=function(node,x0,y0,x1,y1){this.node=node,this.x0=x0,this.y0=y0,this.x1=x1,this.y1=y1};function defaultX(d){return d[0]}function defaultY(d){return d[1]}function quadtree(nodes,x,y){var tree=new Quadtree(null==x?defaultX:x,null==y?defaultY:y,NaN,NaN,NaN,NaN);return null==nodes?tree:tree.addAll(nodes)}function Quadtree(x,y,x0,y0,x1,y1){this._x=x,this._y=y,this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this._root=void 0}function leaf_copy(leaf){for(var copy={data:leaf.data},next=copy;leaf=leaf.next;)next=next.next={data:leaf.data};return copy}var treeProto=quadtree.prototype=Quadtree.prototype;treeProto.copy=function(){var nodes,child,copy=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root;if(!node)return copy;if(!node.length)return copy._root=leaf_copy(node),copy;for(nodes=[{source:node,target:copy._root=new Array(4)}];node=nodes.pop();)for(var i=0;i<4;++i)(child=node.source[i])&&(child.length?nodes.push({source:child,target:node.target[i]=new Array(4)}):node.target[i]=leaf_copy(child));return copy},treeProto.add=function(d){var x=+this._x.call(null,d),y=+this._y.call(null,d);return add(this.cover(x,y),x,y,d)},treeProto.addAll=function addAll(data){var d,i,x,y,n=data.length,xz=new Array(n),yz=new Array(n),x0=1/0,y0=1/0,x1=-1/0,y1=-1/0;for(i=0;i<n;++i)isNaN(x=+this._x.call(null,d=data[i]))||isNaN(y=+this._y.call(null,d))||(xz[i]=x,yz[i]=y,x<x0&&(x0=x),x>x1&&(x1=x),y<y0&&(y0=y),y>y1&&(y1=y));for(x1<x0&&(x0=this._x0,x1=this._x1),y1<y0&&(y0=this._y0,y1=this._y1),this.cover(x0,y0).cover(x1,y1),i=0;i<n;++i)add(this,xz[i],yz[i],data[i]);return this},treeProto.cover=function(x,y){if(isNaN(x=+x)||isNaN(y=+y))return this;var x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(isNaN(x0))x1=(x0=Math.floor(x))+1,y1=(y0=Math.floor(y))+1;else{if(!(x0>x||x>x1||y0>y||y>y1))return this;var parent,i,z=x1-x0,node=this._root;switch(i=(y<(y0+y1)/2)<<1|x<(x0+x1)/2){case 0:do{(parent=new Array(4))[i]=node,node=parent}while(y1=y0+(z*=2),x>(x1=x0+z)||y>y1);break;case 1:do{(parent=new Array(4))[i]=node,node=parent}while(y1=y0+(z*=2),(x0=x1-z)>x||y>y1);break;case 2:do{(parent=new Array(4))[i]=node,node=parent}while(y0=y1-(z*=2),x>(x1=x0+z)||y0>y);break;case 3:do{(parent=new Array(4))[i]=node,node=parent}while(y0=y1-(z*=2),(x0=x1-z)>x||y0>y)}this._root&&this._root.length&&(this._root=node)}return this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this},treeProto.data=function(){var data=[];return this.visit(function(node){if(!node.length)do{data.push(node.data)}while(node=node.next)}),data},treeProto.extent=function(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},treeProto.find=function(x,y,radius){var data,x1,y1,x2,y2,q,i,x0=this._x0,y0=this._y0,x3=this._x1,y3=this._y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,x0,y0,x3,y3)),null==radius?radius=1/0:(x0=x-radius,y0=y-radius,x3=x+radius,y3=y+radius,radius*=radius);q=quads.pop();)if(!(!(node=q.node)||(x1=q.x0)>x3||(y1=q.y0)>y3||(x2=q.x1)<x0||(y2=q.y1)<y0))if(node.length){var xm=(x1+x2)/2,ym=(y1+y2)/2;quads.push(new Quad(node[3],xm,ym,x2,y2),new Quad(node[2],x1,ym,xm,y2),new Quad(node[1],xm,y1,x2,ym),new Quad(node[0],x1,y1,xm,ym)),(i=(y>=ym)<<1|x>=xm)&&(q=quads[quads.length-1],quads[quads.length-1]=quads[quads.length-1-i],quads[quads.length-1-i]=q)}else{var dx=x-+this._x.call(null,node.data),dy=y-+this._y.call(null,node.data),d2=dx*dx+dy*dy;if(d2<radius){var d=Math.sqrt(radius=d2);x0=x-d,y0=y-d,x3=x+d,y3=y+d,data=node.data}}return data},treeProto.remove=function(d){if(isNaN(x=+this._x.call(null,d))||isNaN(y=+this._y.call(null,d)))return this;var parent,retainer,previous,next,x,y,xm,ym,right,bottom,i,j,node=this._root,x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(!node)return this;if(node.length)for(;;){if((right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,parent=node,!(node=node[i=bottom<<1|right]))return this;if(!node.length)break;(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])&&(retainer=parent,j=i)}for(;node.data!==d;)if(previous=node,!(node=node.next))return this;return(next=node.next)&&delete node.next,previous?(next?previous.next=next:delete previous.next,this):parent?(next?parent[i]=next:delete parent[i],(node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length&&(retainer?retainer[j]=node:this._root=node),this):(this._root=next,this)},treeProto.removeAll=function removeAll(data){for(var i=0,n=data.length;i<n;++i)this.remove(data[i]);return this},treeProto.root=function(){return this._root},treeProto.size=function(){var size=0;return this.visit(function(node){if(!node.length)do{++size}while(node=node.next)}),size},treeProto.visit=function(callback){var q,child,x0,y0,x1,y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));q=quads.pop();)if(!callback(node=q.node,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1)&&node.length){var xm=(x0+x1)/2,ym=(y0+y1)/2;(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym))}return this},treeProto.visitAfter=function(callback){var q,quads=[],next=[];for(this._root&&quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));q=quads.pop();){var node=q.node;if(node.length){var child,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1,xm=(x0+x1)/2,ym=(y0+y1)/2;(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1))}next.push(q)}for(;q=next.pop();)callback(q.node,q.x0,q.y0,q.x1,q.y1);return this},treeProto.x=function(_){return arguments.length?(this._x=_,this):this._x},treeProto.y=function(_){return arguments.length?(this._y=_,this):this._y},exports.quadtree=quadtree,Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],146:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";var taskHead,taskTail,frame=0,timeout=0,interval=0,pokeDelay=1e3,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function timerFlush(){now(),++frame;for(var e,t=taskHead;t;)(e=clockNow-t._time)>=0&&t._call.call(null,e),t=t._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,function nap(){var t0,t2,t1=taskHead,time=1/0;for(;t1;)t1._call?(time>t1._time&&(time=t1._time),t0=t1,t1=t1._next):(t2=t1._next,t1._next=null,t1=t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;delay>pokeDelay&&(clockSkew-=delay,clockLast=now)}function sleep(time){frame||(timeout&&(timeout=clearTimeout(timeout)),time-clockNow>24?(time<1/0&&(timeout=setTimeout(wake,time-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake)))}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};exports.now=now,exports.timer=timer,exports.timerFlush=timerFlush,exports.timeout=function(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart(function(elapsed){t.stop(),callback(elapsed+delay)},delay,time),t},exports.interval=function(callback,delay,time){var t=new Timer,total=delay;return null==delay?(t.restart(callback,delay,time),t):(delay=+delay,time=null==time?now():+time,t.restart(function tick(elapsed){elapsed+=total,t.restart(tick,total+=delay,time),callback(elapsed)},delay,time),t)},Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})},{}],147:[function(_dereq_,module,exports){!function(){var d3={version:"3.5.17"},d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)},d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement}function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}if(d3_document)try{d3_array(d3_document.documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){for(var i=list.length,array=new Array(i);i--;)array[i]=list[i];return array}}if(Date.now||(Date.now=function(){return+new Date}),d3_document)try{d3_document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")},d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")},d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function d3_number(x){return null===x?NaN:+x}function d3_numeric(x){return!isNaN(x)}function d3_bisector(compare){return{left:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}d3.ascending=d3_ascending,d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},d3.min=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&a>b&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&a>b&&(a=b)}return a},d3.max=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&b>a&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&b>a&&(a=b)}return a},d3.extent=function(array,f){var a,b,c,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=c=b;break}for(;++i<n;)null!=(b=array[i])&&(a>b&&(a=b),c<b&&(c=b))}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=c=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&(a>b&&(a=b),c<b&&(c=b))}return[a,c]},d3.sum=function(array,f){var a,s=0,n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=+array[i])&&(s+=a);else for(;++i<n;)d3_numeric(a=+f.call(array,array[i],i))&&(s+=a);return s},d3.mean=function(array,f){var a,s=0,n=array.length,i=-1,j=n;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))?s+=a:--j;else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))?s+=a:--j;if(j)return s/j},d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v},d3.median=function(array,f){var a,numbers=[],n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&numbers.push(a);else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&numbers.push(a);if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5)},d3.variance=function(array,f){var a,d,n=array.length,m=0,s=0,i=-1,j=0;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&(s+=(d=a-m)*(a-(m+=d/++j)));else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&(s+=(d=a-m)*(a-(m+=d/++j)));if(j>1)return s/(j-1)},d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v};var d3_bisect=d3_bisector(d3_ascending);function d3_transposeLength(d){return d.length}d3.bisectLeft=d3_bisect.left,d3.bisect=d3.bisectRight=d3_bisect.right,d3.bisector=function(f){return d3_bisector(1===f.length?function(d,x){return d3_ascending(f(d),x)}:f)},d3.shuffle=function(array,i0,i1){(m=arguments.length)<3&&(i1=array.length,m<2&&(i0=0));for(var t,i,m=i1-i0;m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},d3.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},d3.pairs=function(array){for(var i=0,n=array.length-1,p1=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=[p1,p1=array[++i]];return pairs},d3.transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=d3.min(matrix,d3_transposeLength),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose},d3.zip=function(){return d3.transpose(arguments)},d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys},d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values},d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries},d3.merge=function(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);--n>=0;)for(m=(array=arrays[n]).length;--m>=0;)merged[--j]=array[m];return merged};var abs=Math.abs;function d3_class(ctor,properties){for(var key in properties)Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:!1})}function d3_Map(){this._=Object.create(null)}d3.range=function(start,stop,step){if(arguments.length<3&&(step=1,arguments.length<2&&(stop=start,start=0)),(stop-start)/step==1/0)throw new Error("infinite range");var j,range=[],k=function d3_range_integerScale(x){var k=1;for(;x*k%1;)k*=10;return k}(abs(step)),i=-1;if(start*=k,stop*=k,(step*=k)<0)for(;(j=start+step*++i)>stop;)range.push(j/k);else for(;(j=start+step*++i)<stop;)range.push(j/k);return range},d3.map=function(object,f){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(1===arguments.length)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f.call(object,o=object[i],i),o)}else for(var key in object)map.set(key,object[key]);return map};var d3_map_proto="__proto__",d3_map_zero="\0";function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key}function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key}function d3_map_has(key){return d3_map_escape(key)in this._}function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key]}function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys}function d3_map_size(){var size=0;for(var key in this._)++size;return size}function d3_map_empty(){for(var key in this._)return!1;return!0}function d3_Set(){this._=Object.create(null)}function d3_identity(d){return d}function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)]},set:function(key,value){return this._[d3_map_escape(key)]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key])}}),d3.nest=function(){var sortValues,rollup,nest={},keys=[],sortKeys=[];function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;for(var keyValue,object,setter,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=new d3_Map;++i<n;)(values=valuesByKey.get(keyValue=key(object=array[i])))?values.push(object):valuesByKey.set(keyValue,[object]);return mapType?(object=mapType(),setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}):(object={},setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}),valuesByKey.forEach(setter),object}return nest.map=function(array,mapType){return map(mapType,array,0)},nest.entries=function(array){return function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];return map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})}),sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}(map(d3.map,array,0),0)},nest.key=function(d){return keys.push(d),nest},nest.sortKeys=function(order){return sortKeys[keys.length-1]=order,nest},nest.sortValues=function(order){return sortValues=order,nest},nest.rollup=function(f){return rollup=f,nest},nest},d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set},d3_class(d3_Set,{has:d3_map_has,add:function(key){return this._[d3_map_escape(key+="")]=!0,key},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key))}}),d3.behavior={},d3.rebind=function(target,source){for(var method,i=1,n=arguments.length;++i<n;)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}function d3_dispatch(){}function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){for(var l,z=listeners,i=-1,n=z.length;++i<n;)(l=z[i].on)&&l.apply(this,arguments);return dispatch}return event.on=function(name,listener){var i,l=listenerByName.get(name);return arguments.length<2?l&&l.on:(l&&(l.on=null,listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1)),listenerByName.remove(name)),listener&&listeners.push(listenerByName.set(name,{on:listener})),dispatch)},event}function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){for(var s,e=d3.event;s=e.sourceEvent;)e=s;return e}function d3_eventDispatch(target){for(var dispatch=new d3_dispatch,i=0,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target,d3.event=e1,dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}},dispatch}d3.dispatch=function(){for(var dispatch=new d3_dispatch,i=-1,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch},d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0&&(name=type.slice(i+1),type=type.slice(0,i)),type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(2===arguments.length){if(null==listener)for(type in this)this.hasOwnProperty(type)&&this[type].on(name,null);return this}},d3.event=null,d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){return d3_subclass(groups,d3_selectionPrototype),groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];return(d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)})(n,s)};"function"==typeof Sizzle&&(d3_select=function(s,n){return Sizzle(s,n)[0]||null},d3_selectAll=Sizzle,d3_selectMatches=Sizzle.matchesSelector),d3.selection=function(){return d3.select(d3_document.documentElement)};var d3_selectionPrototype=d3.selection.prototype=[];function d3_selection_selector(selector){return"function"==typeof selector?selector:function(){return d3_select(selector,this)}}function d3_selection_selectorAll(selector){return"function"==typeof selector?selector:function(){return d3_selectAll(selector,this)}}d3_selectionPrototype.select=function(selector){var subgroup,subnode,group,node,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(subnode=selector.call(node,node.__data__,i,j)),subnode&&"__data__"in node&&(subnode.__data__=node.__data__)):subgroup.push(null)}return d3_selection(subgroups)},d3_selectionPrototype.selectAll=function(selector){var subgroup,node,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j))),subgroup.parentNode=node);return d3_selection(subgroups)};var d3_nsXhtml="http://www.w3.org/1999/xhtml",d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:d3_nsXhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function d3_selection_attr(name,value){return name=d3.ns.qualify(name),null==value?name.local?function attrNullNS(){this.removeAttributeNS(name.space,name.local)}:function attrNull(){this.removeAttribute(name)}:"function"==typeof value?name.local?function attrFunctionNS(){var x=value.apply(this,arguments);null==x?this.removeAttributeNS(name.space,name.local):this.setAttributeNS(name.space,name.local,x)}:function attrFunction(){var x=value.apply(this,arguments);null==x?this.removeAttribute(name):this.setAttribute(name,x)}:name.local?function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}:function attrConstant(){this.setAttribute(name,value)}}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/)}function d3_selection_classed(name,value){var n=(name=d3_selection_classes(name).map(d3_selection_classedName)).length;return"function"==typeof value?function classedFunction(){for(var i=-1,x=value.apply(this,arguments);++i<n;)name[i](this,x)}:function classedConstant(){for(var i=-1;++i<n;)name[i](this,value)}}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";value?(re.lastIndex=0,re.test(c)||node.setAttribute("class",d3_collapse(c+" "+name))):node.setAttribute("class",d3_collapse(c.replace(re," ")))}}function d3_selection_style(name,value,priority){return null==value?function styleNull(){this.style.removeProperty(name)}:"function"==typeof value?function styleFunction(){var x=value.apply(this,arguments);null==x?this.style.removeProperty(name):this.style.setProperty(name,x,priority)}:function styleConstant(){this.style.setProperty(name,value,priority)}}function d3_selection_property(name,value){return null==value?function propertyNull(){delete this[name]}:"function"==typeof value?function propertyFunction(){var x=value.apply(this,arguments);null==x?delete this[name]:this[name]=x}:function propertyConstant(){this[name]=value}}function d3_selection_creator(name){return"function"==typeof name?name:(name=d3.ns.qualify(name)).local?function createNS(){return this.ownerDocument.createElementNS(name.space,name.local)}:function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace===d3_nsXhtml&&document.documentElement.namespaceURI===d3_nsXhtml?document.createElement(name):document.createElementNS(namespace,name)}}function d3_selectionRemove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function d3_selection_dataNode(data){return{__data__:data}}function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++)for(var node,group=groups[j],i=0,n=group.length;i<n;i++)(node=group[i])&&callback(node,i,j);return groups}function d3_selection_enter(selection){return d3_subclass(selection,d3_selection_enterPrototype),selection}d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;return i>=0&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}},d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node();return(name=d3.ns.qualify(name)).local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))},d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){for(;++i<n;)if(!value.contains(name[i]))return!1}else for(value=node.getAttribute("class");++i<n;)if(!d3_selection_classedRe(name[i]).test(value))return!1;return!0}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))},d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if("string"!=typeof name){for(priority in n<2&&(value=""),name)this.each(d3_selection_style(priority,name[priority],value));return this}if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name)}priority=""}return this.each(d3_selection_style(name,value,priority))},d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if("string"==typeof name)return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))},d3_selectionPrototype.text=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}:null==value?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent},d3_selectionPrototype.html=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}:null==value?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML},d3_selectionPrototype.append=function(name){return name=d3_selection_creator(name),this.select(function(){return this.appendChild(name.apply(this,arguments))})},d3_selectionPrototype.insert=function(name,before){return name=d3_selection_creator(name),before=d3_selection_selector(before),this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})},d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove)},d3_selectionPrototype.data=function(value,key){var group,node,i=-1,n=this.length;if(!arguments.length){for(value=new Array(n=(group=this[0]).length);++i<n;)(node=group[i])&&(value[i]=node.__data__);return value}function bind(group,groupData){var i,node,nodeData,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n);if(key){var keyValue,nodeByKeyValue=new d3_Map,keyValues=new Array(n);for(i=-1;++i<n;)(node=group[i])&&(nodeByKeyValue.has(keyValue=key.call(node,node.__data__,i))?exitNodes[i]=node:nodeByKeyValue.set(keyValue,node),keyValues[i]=keyValue);for(i=-1;++i<m;)(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))?!0!==node&&(updateNodes[i]=node,node.__data__=nodeData):enterNodes[i]=d3_selection_dataNode(nodeData),nodeByKeyValue.set(keyValue,!0);for(i=-1;++i<n;)i in keyValues&&!0!==nodeByKeyValue.get(keyValues[i])&&(exitNodes[i]=group[i])}else{for(i=-1;++i<n0;)node=group[i],nodeData=groupData[i],node?(node.__data__=nodeData,updateNodes[i]=node):enterNodes[i]=d3_selection_dataNode(nodeData);for(;i<m;++i)enterNodes[i]=d3_selection_dataNode(groupData[i]);for(;i<n;++i)exitNodes[i]=group[i]}enterNodes.update=updateNodes,enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode,enter.push(enterNodes),update.push(updateNodes),exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if("function"==typeof value)for(;++i<n;)bind(group=this[i],value.call(group,group.parentNode.__data__,i));else for(;++i<n;)bind(group=this[i],value);return update.enter=function(){return enter},update.exit=function(){return exit},update},d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")},d3_selectionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_selection(subgroups)},d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;)for(var node,group=this[j],i=group.length-1,next=group[i];--i>=0;)(node=group[i])&&(next&&next!==node.nextSibling&&next.parentNode.insertBefore(node,next),next=node);return this},d3_selectionPrototype.sort=function(comparator){comparator=function d3_selection_sortComparator(comparator){arguments.length||(comparator=d3_ascending);return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()},d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})},d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);return callback.apply(args[0]=this,args),this},d3_selectionPrototype.empty=function(){return!this.node()},d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++)for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}return null},d3_selectionPrototype.size=function(){var n=0;return d3_selection_each(this,function(){++n}),n};var d3_selection_enterPrototype=[];function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;i>0&&(type=type.slice(0,i));var filter=d3_selection_onFilters.get(type);function onRemove(){var l=this[name];l&&(this.removeEventListener(type,l,l.$),delete this[name])}return filter&&(type=filter,wrap=d3_selection_onFilter),i?listener?function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this),this.addEventListener(type,this[name]=l,l.$=capture),l._=listener}:onRemove:listener?d3_noop:function removeAll(){var match,re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$");for(var name in this)if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$),delete this[name]}}}d3.selection.enter=d3_selection_enter,d3.selection.enter.prototype=d3_selection_enterPrototype,d3_selection_enterPrototype.append=d3_selectionPrototype.append,d3_selection_enterPrototype.empty=d3_selectionPrototype.empty,d3_selection_enterPrototype.node=d3_selectionPrototype.node,d3_selection_enterPrototype.call=d3_selectionPrototype.call,d3_selection_enterPrototype.size=d3_selectionPrototype.size,d3_selection_enterPrototype.select=function(selector){for(var subgroup,subnode,upgroup,group,node,subgroups=[],j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update,subgroups.push(subgroup=[]),subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j)),subnode.__data__=node.__data__):subgroup.push(null)}return d3_selection(subgroups)},d3_selection_enterPrototype.insert=function(name,before){return arguments.length<2&&(before=function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var node,group=enter[j].update,n=group.length;for(j!=j0&&(j0=j,i0=0),i>=i0&&(i0=i+1);!(node=group[i0])&&++i0<n;);return node}}(this)),d3_selectionPrototype.insert.call(this,name,before)},d3.select=function(node){var group;return"string"==typeof node?(group=[d3_select(node,d3_document)]).parentNode=d3_document.documentElement:(group=[node]).parentNode=d3_documentElement(node),d3_selection([group])},d3.selectAll=function(nodes){var group;return"string"==typeof nodes?(group=d3_array(d3_selectAll(nodes,d3_document))).parentNode=d3_document.documentElement:(group=d3_array(nodes)).parentNode=null,d3_selection([group])},d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if("string"!=typeof type){for(capture in n<2&&(listener=!1),type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=!1}return this.each(d3_selection_on(type,listener,capture))};var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e,argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var related=e.relatedTarget;related&&(related===this||8&related.compareDocumentPosition(this))||l.call(this,e)}}d3_document&&d3_selection_onFilters.forEach(function(k){"on"+k in d3_document&&d3_selection_onFilters.remove(k)});var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(null==d3_event_dragSelect&&(d3_event_dragSelect=!("onselectstart"in node)&&d3_vendorSymbol(node.style,"userSelect")),d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){if(w.on(name,null),d3_event_dragSelect&&(style[d3_event_dragSelect]=select),suppressClick){var off=function(){w.on(click,null)};w.on(click,function(){d3_eventPreventDefault(),off()},!0),setTimeout(off,0)}}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){e.changedTouches&&(e=e.changedTouches[0]);var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){var ctm=(svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e),svg.remove()}}return d3_mouse_bug44083?(point.x=e.pageX,point.y=e.pageY):(point.x=e.clientX,point.y=e.clientY),[(point=point.matrixTransform(container.getScreenCTM().inverse())).x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier}d3.touch=function(container,touches,identifier){if(arguments.length<3&&(identifier=touches,touches=d3_eventSource().changedTouches),touches)for(var touch,i=0,n=touches.length;i<n;++i)if((touch=touches[i]).identifier===identifier)return d3_mousePoint(container,touch)},d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function dragstart(id,position,subject,move,end){return function(){var dragOffset,target=d3.event.target.correspondingElement||d3.event.target,parent=this.parentNode,dispatch=event.of(this,arguments),dragged=0,dragId=id(),dragName=".drag"+(null==dragId?"":"-"+dragId),dragSubject=d3.select(subject(target)).on(move+dragName,function moved(){var dx,dy,position1=position(parent,dragId);if(!position1)return;dx=position1[0]-position0[0],dy=position1[1]-position0[1],dragged|=dx|dy,position0=position1,dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy})}).on(end+dragName,function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null),dragRestore(dragged),dispatch({type:"dragend"})}),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);dragOffset=origin?[(dragOffset=origin.apply(this,arguments)).x-position0[0],dragOffset.y-position0[1]]:[0,0],dispatch({type:"dragstart"})}}return drag.origin=function(x){return arguments.length?(origin=x,drag):origin},d3.rebind(drag,event,"on")},d3.touches=function(container,touches){return arguments.length<2&&(touches=d3_eventSource().touches),touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);return point.identifier=touch.identifier,point}):[]};var =1e-6,2=*,=Math.PI,=2*,=-,half=/2,d3_radians=/180,d3_degrees=180/;function d3_sgn(x){return x>0?1:x<0?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return x>1?0:x<-1?:Math.acos(x)}function d3_asin(x){return x>1?half:x<-1?-half:Math.asin(x)}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_haversin(x){return(x=Math.sin(x/2))*x}var =Math.SQRT2;d3.interpolateZoom=function(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<2)S=Math.log(w1/w0)/,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/,i=function(t){var s=t*S,coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}(*s+r0)-function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(*s+r0)]}}return i.duration=1e3*S,i},d3.behavior.zoom=function(){var translate0,center0,center,mousewheelTimer,touchtime,x0,x1,y0,y1,view={x:0,y:0,k:1},size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",touchstart="touchstart.zoom",event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend");function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}(l),view.x+=p[0]-l[0],view.y+=p[1]-l[1]}function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k},scaleTo(Math.pow(2,k)),translateTo(center0=p,l),that=d3.select(that),duration>0&&(that=that.transition().duration(duration)),that.call(zoom.event)}function rescale(){x1&&x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert)),y1&&y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){zooming++||dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale(),dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){--zooming||(dispatch({type:"zoomend"}),center0=null)}function mousedowned(){var that=this,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,function moved(){dragged=1,translateTo(d3.mouse(that),location0),zoomed(dispatch)}).on(mouseup,function ended(){subject.on(mousemove,null).on(mouseup,null),dragRestore(dragged),zoomended(dispatch)}),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that),zoomstarted(dispatch)}function touchstarted(){var scale0,that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);function relocate(){var touches=d3.touches(that);return scale0=view.k,touches.forEach(function(t){t.identifier in locations0&&(locations0[t.identifier]=location(t))}),touches}function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended),targets.push(target);for(var changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)locations0[changed[i].identifier]=null;var touches=relocate(),now=Date.now();if(1===touches.length){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1),d3_eventPreventDefault()}touchtime=now}else if(touches.length>1){p=touches[0];var q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var p0,l0,p1,l1,touches=d3.touches(that);d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null)if(p1=touches[i],l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2],l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2],scaleTo(scale1*scale0)}touchtime=null,translateTo(p0,l0),zoomed(dispatch)}function ended(){if(d3.event.touches.length){for(var changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)delete locations0[changed[i].identifier];for(var identifier in locations0)return void relocate()}d3.selectAll(targets).on(zoomName,null),subject.on(mousedown,mousedowned).on(touchstart,touchstarted),dragRestore(),zoomended(dispatch)}started(),zoomstarted(dispatch),subject.on(mousedown,null).on(touchstart,started)}function mousewheeled(){var dispatch=event.of(this,arguments);mousewheelTimer?clearTimeout(mousewheelTimer):(d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch)),mousewheelTimer=setTimeout(function(){mousewheelTimer=null,zoomended(dispatch)},50),d3_eventPreventDefault(),scaleTo(Math.pow(2,.002*d3_behavior_zoomDelta())*view.k),translateTo(center0,translate0),zoomed(dispatch)}function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1)}return d3_behavior_zoomWheel||(d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll")),zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;d3_transitionInheritId?d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1},zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k},zoomed(dispatch)}}).each("interrupt.zoom",function(){zoomended(dispatch)}).each("end.zoom",function(){zoomended(dispatch)}):(this.__chart__=view,zoomstarted(dispatch),zoomed(dispatch),zoomended(dispatch))})},zoom.translate=function(_){return arguments.length?(view={x:+_[0],y:+_[1],k:view.k},rescale(),zoom):[view.x,view.y]},zoom.scale=function(_){return arguments.length?(view={x:view.x,y:view.y,k:null},scaleTo(+_),rescale(),zoom):view.k},zoom.scaleExtent=function(_){return arguments.length?(scaleExtent=null==_?d3_behavior_zoomInfinity:[+_[0],+_[1]],zoom):scaleExtent},zoom.center=function(_){return arguments.length?(center=_&&[+_[0],+_[1]],zoom):center},zoom.size=function(_){return arguments.length?(size=_&&[+_[0],+_[1]],zoom):size},zoom.duration=function(_){return arguments.length?(duration=+_,zoom):duration},zoom.x=function(z){return arguments.length?(x1=z,x0=z.copy(),view={x:0,y:0,k:1},zoom):x1},zoom.y=function(z){return arguments.length?(y1=z,y0=z.copy(),view={x:0,y:0,k:1},zoom):y1},d3.rebind(zoom,event,"on")};var d3_behavior_zoomDelta,d3_behavior_zoomWheel,d3_behavior_zoomInfinity=[0,1/0];function d3_color(){}function d3_hsl(h,s,l){return this instanceof d3_hsl?(this.h=+h,this.s=+s,void(this.l=+l)):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l)}d3.color=d3_color,d3_color.prototype.toString=function(){return this.rgb()+""},d3.hsl=d3_hsl;var d3_hslPrototype=d3_hsl.prototype=new d3_color;function d3_hsl_rgb(h,s,l){var m1,m2;function vv(h){return Math.round(255*function v(h){return h>360?h-=360:h<0&&(h+=360),h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1}(h))}return h=isNaN(h)?0:(h%=360)<0?h+360:h,s=isNaN(s)?0:s<0?0:s>1?1:s,m1=2*(l=l<0?0:l>1?1:l)-(m2=l<=.5?l*(1+s):l+s-l*s),new d3_rgb(vv(h+120),vv(h),vv(h-120))}function d3_hcl(h,c,l){return this instanceof d3_hcl?(this.h=+h,this.c=+c,void(this.l=+l)):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):d3_lab_hcl(h instanceof d3_lab?h.l:(h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l)}d3_hslPrototype.brighter=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,this.l/k)},d3_hslPrototype.darker=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,k*this.l)},d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)},d3.hcl=d3_hcl;var d3_hclPrototype=d3_hcl.prototype=new d3_color;function d3_hcl_lab(h,c,l){return isNaN(h)&&(h=0),isNaN(c)&&(c=0),new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}function d3_lab(l,a,b){return this instanceof d3_lab?(this.l=+l,this.a=+a,void(this.b=+b)):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b)}d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))},d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))},d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()},d3.lab=d3_lab;var d3_lab_K=18,d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883,d3_labPrototype=d3_lab.prototype=new d3_color;function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;return new d3_rgb(d3_xyz_rgb(3.2404542*(x=d3_lab_xyz(x)*d3_lab_X)-1.5371385*(y=d3_lab_xyz(y)*d3_lab_Y)-.4985314*(z=d3_lab_xyz(z)*d3_lab_Z)),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}function d3_rgb(r,g,b){return this instanceof d3_rgb?(this.r=~~r,this.g=~~g,void(this.b=~~b)):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b)}function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,255&value)}function d3_rgbString(value){return d3_rgbNumber(value)+""}d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)},d3.rgb=d3_rgb;var d3_rgbPrototype=d3_rgb.prototype=new d3_color;function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var m1,m2,color,r=0,g=0,b=0;if(m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase()))switch(m2=m1[2].split(","),m1[1]){case"hsl":return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);case"rgb":return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}return(color=d3_rgb_names.get(format))?rgb(color.r,color.g,color.b):(null==format||"#"!==format.charAt(0)||isNaN(color=parseInt(format.slice(1),16))||(4===format.length?(r=(3840&color)>>4,r|=r>>4,g=240&color,g|=g>>4,b=15&color,b|=b<<4):7===format.length&&(r=(16711680&color)>>16,g=(65280&color)>>8,b=255&color)),rgb(r,g,b))}function d3_rgb_hsl(r,g,b){var h,s,min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,l=(max+min)/2;return d?(s=l<.5?d/(max+min):d/(2-max-min),h=r==max?(g-b)/d+(g<b?6:0):g==max?(b-r)/d+2:(r-g)/d+4,h*=60):(h=NaN,s=l>0&&l<1?0:h),new d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){var x=d3_xyz_lab((.4124564*(r=d3_rgb_xyz(r))+.3575761*(g=d3_rgb_xyz(g))+.1804375*(b=d3_rgb_xyz(b)))/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y);return d3_lab(116*y-16,500*(x-y),200*(y-d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z)))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return"%"===c.charAt(c.length-1)?Math.round(2.55*f):f}d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;return r||g||b?(r&&r<i&&(r=i),g&&g<i&&(g=i),b&&b<i&&(b=i),new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k))):new d3_rgb(i,i,i)},d3_rgbPrototype.darker=function(k){return new d3_rgb((k=Math.pow(.7,arguments.length?k:1))*this.r,k*this.g,k*this.b)},d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)},d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function d3_functor(v){return"function"==typeof v?v:function(){return v}}function d3_xhrType(response){return function(url,mimeType,callback){return 2===arguments.length&&"function"==typeof mimeType&&(callback=mimeType,mimeType=null),d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;function respond(){var result,status=request.status;if(!status&&function d3_xhrHasResponse(request){var type=request.responseType;return type&&"text"!==type?request.response:request.responseText}(request)||status>=200&&status<300||304===status){try{result=response.call(xhr,request)}catch(e){return void dispatch.error.call(xhr,e)}dispatch.load.call(xhr,result)}else dispatch.error.call(xhr,request)}return!this.XDomainRequest||"withCredentials"in request||!/^(http(s)?:)?\/\//.test(url)||(request=new XDomainRequest),"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()},request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}},xhr.header=function(name,value){return name=(name+"").toLowerCase(),arguments.length<2?headers[name]:(null==value?delete headers[name]:headers[name]=value+"",xhr)},xhr.mimeType=function(value){return arguments.length?(mimeType=null==value?null:value+"",xhr):mimeType},xhr.responseType=function(value){return arguments.length?(responseType=value,xhr):responseType},xhr.response=function(value){return response=value,xhr},["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}}),xhr.send=function(method,data,callback){if(2===arguments.length&&"function"==typeof data&&(callback=data,data=null),request.open(method,url,!0),null==mimeType||"accept"in headers||(headers.accept=mimeType+",*/*"),request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);return null!=mimeType&&request.overrideMimeType&&request.overrideMimeType(mimeType),null!=responseType&&(request.responseType=responseType),null!=callback&&xhr.on("error",callback).on("load",function(request){callback(null,request)}),dispatch.beforesend.call(xhr,request),request.send(null==data?null:data),xhr},xhr.abort=function(){return request.abort(),xhr},d3.rebind(xhr,dispatch,"on"),null==callback?xhr:xhr.get(function d3_xhr_fixCallback(callback){return 1===callback.length?function(error,request){callback(null==error?request:null)}:callback}(callback))}d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))}),d3.functor=d3_functor,d3.xhr=d3_xhrType(d3_identity),d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){arguments.length<3&&(callback=row,row=null);var xhr=d3_xhr(url,mimeType,null==row?response:typedResponse(row),callback);return xhr.row=function(_){return arguments.length?xhr.response(null==(row=_)?response:typedResponse(_)):row},xhr}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}return dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})},dsv.parseRows=function(text,f){var t,eol,EOL={},EOF={},rows=[],N=text.length,I=0,n=0;function token(){if(I>=N)return EOF;if(eol)return eol=!1,EOL;var j=I;if(34===text.charCodeAt(j)){for(var i=j;i++<N;)if(34===text.charCodeAt(i)){if(34!==text.charCodeAt(i+1))break;++i}return I=i+2,13===(c=text.charCodeAt(i+1))?(eol=!0,10===text.charCodeAt(i+2)&&++I):10===c&&(eol=!0),text.slice(j+1,i).replace(/""/g,'"')}for(;I<N;){var c,k=1;if(10===(c=text.charCodeAt(I++)))eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&(++I,++k);else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}for(;(t=token())!==EOF;){for(var a=[];t!==EOL&&t!==EOF;)a.push(t),t=token();f&&null==(a=f(a,n++))||rows.push(a)}return rows},dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];return rows.forEach(function(row){for(var field in row)fieldSet.has(field)||fields.push(fieldSet.add(field))}),[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")},dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")},dsv},d3.csv=d3.dsv(",","text/csv"),d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};function d3_timer(callback,delay,then){var n=arguments.length;n<2&&(delay=0),n<3&&(then=Date.now());var timer={c:callback,t:then+delay,n:null};return d3_timer_queueTail?d3_timer_queueTail.n=timer:d3_timer_queueHead=timer,d3_timer_queueTail=timer,d3_timer_interval||(d3_timer_timeout=clearTimeout(d3_timer_timeout),d3_timer_interval=1,d3_timer_frame(d3_timer_step)),timer}function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;delay>24?(isFinite(delay)&&(clearTimeout(d3_timer_timeout),d3_timer_timeout=setTimeout(d3_timer_step,delay)),d3_timer_interval=0):(d3_timer_interval=1,d3_timer_frame(d3_timer_step))}function d3_timer_mark(){for(var now=Date.now(),timer=d3_timer_queueHead;timer;)now>=timer.t&&timer.c(now-timer.t)&&(timer.c=null),timer=timer.n;return now}function d3_timer_sweep(){for(var t0,t1=d3_timer_queueHead,time=1/0;t1;)t1.c?(t1.t<time&&(time=t1.t),t1=(t0=t1).n):t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;return d3_timer_queueTail=t0,time}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}d3.timer=function(){d3_timer.apply(this,arguments)},d3.timer.flush=function(){d3_timer_mark(),d3_timer_sweep()},d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};var d3_formatPrefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(function d3_formatPrefix(d,i){var k=Math.pow(10,3*abs(8-i));return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}});d3.formatPrefix=function(value,precision){var i=0;return(value=+value)&&(value<0&&(value*=-1),precision&&(value=d3.round(value,d3_format_precision(value,precision))),i=1+Math.floor(1e-12+Math.log(value)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i-1)/3)))),d3_formatPrefixes[8+i/3]};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}});function d3_format_typeDefault(x){return x+""}var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){return step(date=local(new d3_date(date-1)),1),date}function offset(date,k){return step(date=new d3_date(+date),k),date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1)for(;time<t1;)number(time)%dt||times.push(new Date(+time)),step(time,1);else for(;time<t1;)times.push(new Date(+time)),step(time,1);return times}local.floor=local,local.round=round,local.ceil=ceil,local.offset=offset,local.range=range;var utc=local.utc=d3_time_interval_utc(local);return utc.floor=utc,utc.round=d3_time_interval_utc(round),utc.ceil=d3_time_interval_utc(ceil),utc.offset=d3_time_interval_utc(offset),utc.range=function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;return utc._=t0,range(utc,t1,dt)}finally{d3_date=Date}},local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;return utc._=date,method(utc,k)._}finally{d3_date=Date}}}d3_time.year=d3_time_interval(function(date){return(date=d3_time.day(date)).setMonth(0,1),date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()}),d3_time.years=d3_time.year.range,d3_time.years.utc=d3_time.year.utc.range,d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);return day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1}),d3_time.days=d3_time.day.range,d3_time.days.utc=d3_time.day.utc.range,d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-6e4*(date.getTimezoneOffset()-year.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){return(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7),date},function(date,offset){date.setDate(date.getDate()+7*Math.floor(offset))},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range,d3_time[day+"s"].utc=interval.utc.range,d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}}),d3_time.week=d3_time.sunday,d3_time.weeks=d3_time.sunday.range,d3_time.weeks.utc=d3_time.sunday.utc.range,d3_time.weekOfYear=d3_time.sundayOfYear;var d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){for(var map=new d3_Map,i=-1,n=names.length;++i<n;)map.set(names[i].toLowerCase(),i);return map}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=function d3_time_expandYear(d){return d+(d>68?1900:2e3)}(+n[0]),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function d3_time_formatMulti(formats){for(var n=formats.length,i=-1;++i<n;)formats[i][0]=this(formats[i][0]);return function(date){for(var i=0,f=formats[i];!f[1](date);)f=formats[++i];return f[0](date)}}d3.locale=function(locale){return{numberFormat:function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){for(var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=locale_grouping[j=(j+1)%locale_grouping.length];return t.reverse().join(locale_thousands)}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=!1,exponent=!0;switch(precision&&(precision=+precision.substring(1)),(zfill||"0"===fill&&"="===align)&&(zfill=fill="0",align="="),type){case"n":comma=!0,type="g";break;case"%":scale=100,suffix="%",type="f";break;case"p":scale=100,suffix="%",type="r";break;case"b":case"o":case"x":case"X":"#"===symbol&&(prefix="0"+type.toLowerCase());case"c":exponent=!1;case"d":integer=!0,precision=0;break;case"s":scale=-1,type="r"}"$"===symbol&&(prefix=locale_currency[0],suffix=locale_currency[1]),"r"!=type||precision||(type="g"),null!=precision&&("g"==type?precision=Math.max(1,Math.min(21,precision)):"e"!=type&&"f"!=type||(precision=Math.max(0,Math.min(20,precision)))),type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||0===value&&1/value<0?(value=-value,"-"):"-"===sign?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value),fullSuffix=unit.symbol+suffix}else value*=scale;var before,after,i=(value=type(value,precision)).lastIndexOf(".");if(i<0){var j=exponent?value.lastIndexOf("e"):-1;j<0?(before=value,after=""):(before=value.substring(0,j),after=value.substring(j))}else before=value.substring(0,i),after=locale_decimal+value.substring(i+1);!zfill&&comma&&(before=formatGroup(before,1/0));var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";return zcomma&&(before=formatGroup(padding+before,padding.length?width-after.length:1/0)),negative+=prefix,value=before+after,("<"===align?negative+value+padding:">"===align?padding+negative+value:"^"===align?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix}}}(locale),timeFormat:function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){for(var c,p,f,string=[],i=-1,j=0;++i<n;)37===template.charCodeAt(i)&&(string.push(template.slice(j,i)),null!=(p=d3_time_formatPads[c=template.charAt(++i)])&&(c=template.charAt(++i)),(f=d3_time_formats[c])&&(c=f(date,null==p?"e"===c?" ":"0":p)),string.push(c),j=i+1);return string.push(template.slice(j,i)),string.join("")}return format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(d3_time_parse(d,template,string,0)!=string.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var localZ=null!=d.Z&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);return"j"in d?date.setFullYear(d.y,0,d.j):"W"in d||"U"in d?("w"in d||(d.w="W"in d?1:0),date.setFullYear(d.y,0,1),date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(date.getDay()+5)%7:d.w+7*d.U-(date.getDay()+6)%7)):date.setFullYear(d.y,d.m,d.d),date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),localZ?date._:date},format.toString=function(){return template},format}function d3_time_parse(date,template,string,j){for(var c,p,t,i=0,n=template.length,m=string.length;i<n;){if(j>=m)return-1;if(37===(c=template.charCodeAt(i++))){if(t=template.charAt(i++),!(p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t])||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{var utc=new(d3_date=d3_date_utc);return utc._=date,local(utc)}finally{d3_date=Date}}return format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}},format.toString=local.toString,format},d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i)});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()]},A:function(d){return locale_days[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return locale_periods[+(d.getHours()>=12)]},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}},d3_time_parsers={a:function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1},A:function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},b:function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1},B:function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},c:function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)},d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return null==n?-1:(date.p=n,i)},S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)},X:function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)},y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};return d3_time_format}(locale)}};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function d3_adder(){}d3.format=d3_locale_enUS.numberFormat,d3.geo={},d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp),d3_adderSum(d3_adderTemp.s,this.s,this),this.s?this.t+=d3_adderTemp.t:this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}function d3_geo_streamGeometry(geometry,listener){geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)&&d3_geo_streamGeometryType[geometry.type](geometry,listener)}d3.geo.stream=function(object,listener){object&&d3_geo_streamObjectType.hasOwnProperty(object.type)?d3_geo_streamObjectType[object.type](object,listener):d3_geo_streamGeometry(object,listener)};var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){for(var features=object.features,i=-1,n=features.length;++i<n;)d3_geo_streamGeometry(features[i].geometry,listener)}},d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates,listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var coordinate,i=-1,n=coordinates.length-closed;for(listener.lineStart();++i<n;)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;for(listener.polygonStart();++i<n;)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){return d3_geo_areaSum=0,d3.geo.stream(object,d3_geo_area),d3_geo_areaSum};var d3_geo_areaSum,d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2,d3_geo_areaRingSum=new d3_adder,d3_geo_area={sphere:function(){d3_geo_areaSum+=4*},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset(),d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*+area:area,d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var 00,00,0,cos0,sin0;function nextPoint(,){=*d3_radians/2+/4;var d=(*=d3_radians)-0,sd=d>=0?1:-1,ad=sd*d,cos=Math.cos(),sin=Math.sin(),k=sin0*sin,u=cos0*cos+k*Math.cos(ad),v=k*sd*Math.sin(ad);d3_geo_areaRingSum.add(Math.atan2(v,u)),0=,cos0=cos,sin0=sin}d3_geo_area.point=function(,){d3_geo_area.point=nextPoint,0=(00=)*d3_radians,cos0=Math.cos(=(00=)*d3_radians/2+/4),sin0=Math.sin()},d3_geo_area.lineEnd=function(){nextPoint(00,00)}}function d3_geo_cartesian(spherical){var =spherical[0],=spherical[1],cos=Math.cos();return[cos*Math.cos(),cos*Math.sin(),Math.sin()]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<&&abs(a[1]-b[1])<}d3.geo.bounds=function(){var 0,0,1,1,_,__,__,p0,dSum,ranges,range,bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint,bound.lineStart=ringStart,bound.lineEnd=ringEnd,dSum=0,d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd(),bound.point=point,bound.lineStart=lineStart,bound.lineEnd=lineEnd,d3_geo_areaRingSum<0?(0=-(1=180),0=-(1=90)):dSum>?1=90:dSum<-&&(0=-90),range[0]=0,range[1]=1}};function point(,){ranges.push(range=[0=,1=]),<0&&(0=),>1&&(1=)}function linePoint(,){var p=d3_geo_cartesian([*d3_radians,*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),inflection=d3_geo_cartesianCross([normal[1],-normal[0],0],normal);d3_geo_cartesianNormalize(inflection),inflection=d3_geo_spherical(inflection);var d=-_,s=d>0?1:-1,i=inflection[0]*d3_degrees*s,antimeridian=abs(d)>180;if(antimeridian^(s*_<i&&i<s*))(i=inflection[1]*d3_degrees)>1&&(1=i);else if(antimeridian^(s*_<(i=(i+360)%360-180)&&i<s*)){var i;(i=-inflection[1]*d3_degrees)<0&&(0=i)}else <0&&(0=),>1&&(1=);antimeridian?<_?angle(0,)>angle(0,1)&&(1=):angle(,1)>angle(0,1)&&(0=):1>=0?(<0&&(0=),>1&&(1=)):>_?angle(0,)>angle(0,1)&&(1=):angle(,1)>angle(0,1)&&(0=)}else point(,);p0=p,_=}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=0,range[1]=1,bound.point=point,p0=null}function ringPoint(,){if(p0){var d=-_;dSum+=abs(d)>180?d+(d>0?360:-360):d}else __=,__=;d3_geo_area.point(,),linePoint(,)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(__,__),d3_geo_area.lineEnd(),abs(dSum)>&&(0=-(1=180)),range[0]=0,range[1]=1,p0=null}function angle(0,1){return(1-=0)<0?1+360:1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}return function(feature){if(1=1=-(0=0=1/0),ranges=[],d3.geo.stream(feature,bound),n=ranges.length){ranges.sort(compareRanges);for(var i=1,merged=[a=ranges[0]];i<n;++i)withinRange((b=ranges[i])[0],a)||withinRange(b[1],a)?(angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]),angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])):merged.push(a=b);for(var d,n,b,best=-1/0,a=(i=0,merged[n=merged.length-1]);i<=n;a=b,++i)b=merged[i],(d=angle(a[1],b[0]))>best&&(best=d,0=b[0],1=a[1])}return ranges=range=null,0===1/0||0===1/0?[[NaN,NaN],[NaN,NaN]]:[[0,0],[1,1]]}}(),d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;return m<2&&(x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1,d3_geo_centroidW1<&&(x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0),(m=x*x+y*y+z*z)<2)?[NaN,NaN]:[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians);d3_geo_centroidPointXYZ(cos*Math.cos(),cos*Math.sin(),Math.sin())}function d3_geo_centroidPointXYZ(x,y,z){d3_geo_centroidX0+=(x-d3_geo_centroidX0)/++d3_geo_centroidW0,d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0,d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}d3_geo_centroid.point=function(,){*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos(),y0=cos*Math.sin(),z0=Math.sin(),d3_geo_centroid.point=nextPoint,d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var 00,00,x0,y0,z0;function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx,d3_geo_centroidY2+=v*cy,d3_geo_centroidZ2+=v*cz,d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}d3_geo_centroid.point=function(,){00=,00=,d3_geo_centroid.point=nextPoint,*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos(),y0=cos*Math.sin(),z0=Math.sin(),d3_geo_centroidPointXYZ(x0,y0,z0)},d3_geo_centroid.lineEnd=function(){nextPoint(00,00),d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd,d3_geo_centroid.point=d3_geo_centroidPoint}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}return a.invert&&b.invert&&(compose.invert=function(x,y){return(x=b.invert(x,y))&&a.invert(x[0],x[1])}),compose}function d3_true(){return!0}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];if(segments.forEach(function(segment){if(!((n=segment.length-1)<=0)){var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd()}else{var a=new d3_geo_clipPolygonIntersection(p0,segment,null,!0),b=new d3_geo_clipPolygonIntersection(p0,null,a,!1);a.o=b,subject.push(a),clip.push(b),b=new d3_geo_clipPolygonIntersection(p1,null,a=new d3_geo_clipPolygonIntersection(p1,segment,null,!1),!0),a.o=b,subject.push(a),clip.push(b)}}}),clip.sort(compare),d3_geo_clipPolygonLinkCircular(subject),d3_geo_clipPolygonLinkCircular(clip),subject.length){for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i)clip[i].e=entry=!entry;for(var points,point,start=subject[0];;){for(var current=start,isSubject=!0;current.v;)if((current=current.n)===start)return;points=current.z,listener.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);else interpolate(current.x,current.n.x,1,listener);current=current.n}else{if(isSubject)for(i=(points=current.p.z).length-1;i>=0;--i)listener.point((point=points[i])[0],point[1]);else interpolate(current.x,current.p.x,-1,listener);current=current.p}points=(current=current.o).z,isSubject=!isSubject}while(!current.v);listener.lineEnd()}}}function d3_geo_clipPolygonLinkCircular(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var segments,line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing,clip.lineStart=ringStart,clip.lineEnd=ringEnd,segments=[],polygon=[]},polygonEnd:function(){clip.point=point,clip.lineStart=lineStart,clip.lineEnd=lineEnd,segments=d3.merge(segments);var clipStartInside=function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(m)for(var point0=ring[0],0=point0[0],0=point0[1]/2+/4,sin0=Math.sin(0),cos0=Math.cos(0),j=1;;){j===m&&(j=0);var =(point=ring[j])[0],=point[1]/2+/4,sin=Math.sin(),cos=Math.cos(),d=-0,sd=d>=0?1:-1,ad=sd*d,antimeridian=ad>,k=sin0*sin;if(d3_geo_areaRingSum.add(Math.atan2(k*sd*Math.sin(ad),cos0*cos+k*Math.cos(ad))),polarAngle+=antimeridian?d+sd*:d,antimeridian^0>=meridian^>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var arc=(antimeridian^d>=0?-1:1)*d3_asin(intersection[2]);(parallel>arc||parallel===arc&&(arc[0]||arc[1]))&&(winding+=antimeridian^d>=0?1:-1)}if(!j++)break;0=,sin0=sin,cos0=cos,point0=point}}return(polarAngle<-||polarAngle<&&d3_geo_areaRingSum<-)^1&winding}(rotatedClipStart,polygon);segments.length?(polygonStarted||(listener.polygonStart(),polygonStarted=!0),d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)):clipStartInside&&(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),polygonStarted&&(listener.polygonEnd(),polygonStarted=!1),segments=polygon=null},sphere:function(){listener.polygonStart(),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd(),listener.polygonEnd()}};function point(,){var point=rotate(,);pointVisible(=point[0],=point[1])&&listener.point(,)}function pointLine(,){var point=rotate(,);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine,line.lineStart()}function lineEnd(){clip.point=point,line.lineEnd()}var polygon,ring,buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=!1;function pointRing(,){ring.push([,]);var point=rotate(,);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringListener.lineEnd();var segment,clean=ringListener.clean(),ringSegments=buffer.buffer(),n=ringSegments.length;if(ring.pop(),polygon.push(ring),ring=null,n)if(1&clean){var point,i=-1;if((n=(segment=ringSegments[0]).length-1)>0){for(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart();++i<n;)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}}else n>1&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var line,lines=[];return{lineStart:function(){lines.push(line=[])},point:function(,){line.push([,])},lineEnd:d3_noop,buffer:function(){var buffer=lines;return lines=[],line=null,buffer},rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-half-:half-a[1])-((b=b.x)[0]<0?b[1]-half-:half-b[1])}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,function d3_geo_clipAntimeridianLine(listener){var clean,0=NaN,0=NaN,s0=NaN;return{lineStart:function(){listener.lineStart(),clean=1},point:function(1,1){var s1=1>0?:-,d=abs(1-0);abs(d-)<?(listener.point(0,0=(0+1)/2>0?half:-half),listener.point(s0,0),listener.lineEnd(),listener.lineStart(),listener.point(s1,0),listener.point(1,0),clean=0):s0!==s1&&d>=&&(abs(0-s0)<&&(0-=s0*),abs(1-s1)<&&(1-=s1*),0=function d3_geo_clipAntimeridianIntersect(0,0,1,1){var cos0,cos1,sin0_1=Math.sin(0-1);return abs(sin0_1)>?Math.atan((Math.sin(0)*(cos1=Math.cos(1))*Math.sin(1)-Math.sin(1)*(cos0=Math.cos(0))*Math.sin(0))/(cos0*cos1*sin0_1)):(0+1)/2}(0,0,1,1),listener.point(s0,0),listener.lineEnd(),listener.lineStart(),listener.point(s1,0),clean=0),listener.point(0=1,0=1),s0=s1},lineEnd:function(){listener.lineEnd(),0=0=NaN},clean:function(){return 2-clean}}},function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var ;if(null==from)=direction*half,listener.point(-,),listener.point(0,),listener.point(,),listener.point(,0),listener.point(,-),listener.point(0,-),listener.point(-,-),listener.point(-,0),listener.point(-,);else if(abs(from[0]-to[0])>){var s=from[0]<to[0]?:-;=direction*s/2,listener.point(-s,),listener.point(0,),listener.point(s,)}else listener.point(to[0],to[1])},[-,-/2]);function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var r,a=line.a,b=line.b,ax=a.x,ay=a.y,t0=0,t1=1,dx=b.x-ax,dy=b.y-ay;if(r=x0-ax,dx||!(r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return t0>0&&(line.a={x:ax+t0*dx,y:ay+t0*dy}),t1<1&&(line.b={x:ax+t1*dx,y:ay+t1*dy}),line}}}}}}var d3_geo_clipExtentMAX=1e9;function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),clip={point:point,lineStart:function lineStart(){clip.point=linePoint,polygon&&polygon.push(ring=[]);first=!0,v_=!1,x_=y_=NaN},lineEnd:function lineEnd(){segments&&(linePoint(x__,y__),v__&&v_&&bufferListener.rejoin(),segments.push(bufferListener.buffer()));clip.point=point,v_&&listener.lineEnd()},polygonStart:function(){listener=bufferListener,segments=[],polygon=[],clean=!0},polygonEnd:function(){listener=listener_,segments=d3.merge(segments);var clipStartInside=function insidePolygon(p){for(var wn=0,n=polygon.length,y=p[1],i=0;i<n;++i)for(var b,j=1,v=polygon[i],m=v.length,a=v[0];j<m;++j)b=v[j],a[1]<=y?b[1]>y&&d3_cross2d(a,b,p)>0&&++wn:b[1]<=y&&d3_cross2d(a,b,p)<0&&--wn,a=b;return 0!==wn}([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;(inside||visible)&&(listener.polygonStart(),inside&&(listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),visible&&d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener),listener.polygonEnd()),segments=polygon=ring=null}};function interpolate(from,to,direction,listener){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0)do{listener.point(0===a||3===a?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1);else listener.point(to[0],to[1])}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){pointVisible(x,y)&&listener.point(x,y)}function linePoint(x,y){var v=pointVisible(x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x)),y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y)));if(polygon&&ring.push([x,y]),first)x__=x,y__=y,v__=v,first=!1,v&&(listener.lineStart(),listener.point(x,y));else if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};clipLine(l)?(v_||(listener.lineStart(),listener.point(l.a.x,l.a.y)),listener.point(l.b.x,l.b.y),v||listener.lineEnd(),clean=!1):v&&(listener.lineStart(),listener.point(x,y),clean=!1)}x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<?direction>0?0:3:abs(p[0]-x1)<?direction>0?2:1:abs(p[1]-y0)<?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}}function d3_geo_conic(projectAt){var 0=0,1=/3,m=d3_geo_projectionMutator(projectAt),p=m(0,1);return p.parallels=function(_){return arguments.length?m(0=_[0]*/180,1=_[1]*/180):[0/*180,1/*180]},p}function d3_geo_conicEqualArea(0,1){var sin0=Math.sin(0),n=(sin0+Math.sin(1))/2,C=1+sin0*(2*n-sin0),0=Math.sqrt(C)/n;function forward(,){var =Math.sqrt(C-2*n*Math.sin())/n;return[*Math.sin(*=n),0-*Math.cos()]}return forward.invert=function(x,y){var 0_y=0-y;return[Math.atan2(x,0_y)/n,d3_asin((C-(x*x+0_y*0_y)*n*n)/(2*n))]},forward}d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){return stream&&(stream.valid=!1),(stream=clip(output)).valid=!0,stream},extent:function(_){return arguments.length?(clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),stream&&(stream.valid=!1,stream=null),clipExtent):[[x0,y0],[x1,y1]]}};return clipExtent.extent([[0,0],[960,500]])},(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea,d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},d3.geo.albersUsa=function(){var point,lower48Point,alaskaPoint,hawaiiPoint,lower48=d3.geo.albers(),alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];return point=null,lower48Point(x,y),point||(alaskaPoint(x,y),point)||hawaiiPoint(x,y),point}return albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)},albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y),alaskaStream.point(x,y),hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere(),alaskaStream.sphere(),hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart(),alaskaStream.lineStart(),hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd(),alaskaStream.lineEnd(),hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart(),alaskaStream.polygonStart(),hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd(),alaskaStream.polygonEnd(),hawaiiStream.polygonEnd()}}},albersUsa.precision=function(_){return arguments.length?(lower48.precision(_),alaska.precision(_),hawaii.precision(_),albersUsa):lower48.precision()},albersUsa.scale=function(_){return arguments.length?(lower48.scale(_),alaska.scale(.35*_),hawaii.scale(_),albersUsa.translate(lower48.translate())):lower48.scale()},albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];return lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point,alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+,y+.12*k+],[x-.214*k-,y+.234*k-]]).stream(pointStream).point,hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+,y+.166*k+],[x-.115*k-,y+.234*k-]]).stream(pointStream).point,albersUsa},albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0,d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop,d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y,x0=x,y0=y}d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint,x00=x0=x,y00=y0=y},d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBounds={point:function d3_geo_pathBoundsPoint(x,y){x<d3_geo_pathBoundsX0&&(d3_geo_pathBoundsX0=x);x>d3_geo_pathBoundsX1&&(d3_geo_pathBoundsX1=x);y<d3_geo_pathBoundsY0&&(d3_geo_pathBoundsY0=y);y>d3_geo_pathBoundsY1&&(d3_geo_pathBoundsY1=y)},lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_lengthSum,d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint,d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart,d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x,d3_geo_centroidY0+=y,++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,d3_geo_centroidX2+=(z=y0*x-x0*y)*(x0+x),d3_geo_centroidY2+=z*(y0+y),d3_geo_centroidZ2+=3*z,d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)},d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_resample(project){var 2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?function resampleRecursive(stream){var 00,x00,y00,a00,b00,c00,0,x0,y0,a0,b0,c0,resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart(),resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resample.lineStart=lineStart}};function point(x,y){x=project(x,y),stream.point(x[0],x[1])}function lineStart(){x0=NaN,resample.point=linePoint,stream.lineStart()}function linePoint(,){var c=d3_geo_cartesian([,]),p=project(,);resampleLineTo(x0,y0,0,a0,b0,c0,x0=p[0],y0=p[1],0=,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream),stream.point(x0,y0)}function lineEnd(){resample.point=point,stream.lineEnd()}function ringStart(){lineStart(),resample.point=ringPoint,resample.lineEnd=ringEnd}function ringPoint(,){linePoint(00=,),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,0,a0,b0,c0,x00,y00,00,a00,b00,c00,maxDepth,stream),resample.lineEnd=lineEnd,lineEnd()}return resample}:function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y),stream.point(x[0],x[1])})})(stream)}function resampleLineTo(x0,y0,0,a0,b0,c0,x1,y1,1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),2=Math.asin(c/=m),2=abs(abs(c)-1)<||abs(0-1)<?(0+1)/2:Math.atan2(b,a),p=project(2,2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;(dz*dz/d2>2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,0,a0,b0,c0,x2,y2,2,a/=m,b/=m,c,depth,stream),stream.point(x2,y2),resampleLineTo(x2,y2,2,a,b,c,x1,y1,1,a1,b1,c1,depth,stream))}}return resample.precision=function(_){return arguments.length?(maxDepth=(2=_*_)>0&&16,resample):Math.sqrt(2)},resample}function d3_geo_transform(stream){this.stream=stream}function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,x,y,stream,projectResample=d3_geo_resample(function(x,y){return[(x=project(x,y))[0]*k+x,y-x[1]*k]}),k=150,x=480,y=250,=0,=0,=0,=0,=0,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null;function projection(point){return[(point=projectRotate(point[0]*d3_radians,point[1]*d3_radians))[0]*k+x,y-point[1]*k]}function invert(point){return(point=projectRotate.invert((point[0]-x)/k,(y-point[1])/k))&&[point[0]*d3_degrees,point[1]*d3_degrees]}function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(,,),project);var center=project(,);return x=x-center[0]*k,y=y+center[1]*k,invalidate()}function invalidate(){return stream&&(stream.valid=!1,stream=null),projection}return projection.stream=function(output){return stream&&(stream.valid=!1),(stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))))).valid=!0,stream},projection.clipAngle=function(_){return arguments.length?(preclip=null==_?(clipAngle=_,d3_geo_clipAntimeridian):function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>;return d3_geo_clip(visible,function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(,){var point2,point1=[,],v=visible(,),c=smallRadius?v?0:code(,):v?code(+(<0?:-),):0;if(!point0&&(v00=v0=v)&&listener.lineStart(),v!==v0&&(point2=intersect(point0,point1),(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2))&&(point1[0]+=,point1[1]+=,v=visible(point1[0],point1[1]))),v!==v0)clean=0,v?(listener.lineStart(),point2=intersect(point1,point0),listener.point(point2[0],point2[1])):(point2=intersect(point0,point1),listener.point(point2[0],point2[1]),listener.lineEnd()),point0=point2;else if(notHemisphere&&point0&&smallRadius^v){var t;c&c0||!(t=intersect(point1,point0,!0))||(clean=0,smallRadius?(listener.lineStart(),listener.point(t[0][0],t[0][1]),listener.point(t[1][0],t[1][1]),listener.lineEnd()):(listener.point(t[1][0],t[1][1]),listener.lineEnd(),listener.lineStart(),listener.point(t[0][0],t[0][1])))}!v||point0&&d3_geo_sphericalEqual(point0,point1)||listener.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&listener.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}},d3_geo_circleInterpolate(radius,6*d3_radians),smallRadius?[0,-radius]:[-,radius-]);function visible(,){return Math.cos()*Math.cos()>cr}function intersect(a,b,two){var n1=[1,0,0],n2=d3_geo_cartesianCross(d3_geo_cartesian(a),d3_geo_cartesian(b)),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1);d3_geo_cartesianAdd(A,d3_geo_cartesianScale(n2,c2));var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(!(t2<0)){var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);if(d3_geo_cartesianAdd(q,A),q=d3_geo_spherical(q),!two)return q;var z,0=a[0],1=b[0],0=a[1],1=b[1];1<0&&(z=0,0=1,1=z);var =1-0,polar=abs(-)<;if(!polar&&1<0&&(z=0,0=1,1=z),polar||<?polar?0+1>0^q[1]<(abs(q[0]-0)<?0:1):0<=q[1]&&q[1]<=1:>^(0<=q[0]&&q[0]<=1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);return d3_geo_cartesianAdd(q1,A),[q,d3_geo_spherical(q1)]}}}function code(,){var r=smallRadius?radius:-radius,code=0;return <-r?code|=1:>r&&(code|=2),<-r?code|=4:>r&&(code|=8),code}}((clipAngle=+_)*d3_radians),invalidate()):clipAngle},projection.clipExtent=function(_){return arguments.length?(clipExtent=_,postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity,invalidate()):clipExtent},projection.scale=function(_){return arguments.length?(k=+_,reset()):k},projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],reset()):[x,y]},projection.center=function(_){return arguments.length?(=_[0]%360*d3_radians,=_[1]%360*d3_radians,reset()):[*d3_degrees,*d3_degrees]},projection.rotate=function(_){return arguments.length?(=_[0]%360*d3_radians,=_[1]%360*d3_radians,=_.length>2?_[2]%360*d3_radians:0,reset()):[*d3_degrees,*d3_degrees,*d3_degrees]},d3.rebind(projection,projectResample,"precision"),function(){return project=projectAt.apply(this,arguments),projection.invert=project.invert&&invert,reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(,){return[,]}function d3_geo_identityRotation(,){return[>?-:<-?+:,]}function d3_geo_rotation(,,){return ?||?d3_geo_compose(d3_geo_rotation(),d3_geo_rotation(,)):d3_geo_rotation():||?d3_geo_rotation(,):d3_geo_identityRotation}function d3_geo_forwardRotation(){return function(,){return[(+=)>?-:<-?+:,]}}function d3_geo_rotation(){var rotation=d3_geo_forwardRotation();return rotation.invert=d3_geo_forwardRotation(-),rotation}function d3_geo_rotation(,){var cos=Math.cos(),sin=Math.sin(),cos=Math.cos(),sin=Math.sin();function rotation(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos+x*sin;return[Math.atan2(y*cos-k*sin,x*cos-z*sin),d3_asin(k*cos+y*sin)]}return rotation.invert=function(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos-y*sin;return[Math.atan2(y*cos+z*sin,x*cos+k*sin),d3_asin(k*cos-x*sin)]},rotation}function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;null!=from?(from=d3_geo_circleAngle(cr,from),to=d3_geo_circleAngle(cr,to),(direction>0?from<to:from>to)&&(from+=direction*)):(from=radius+direction*,to=radius-.5*step);for(var point,t=from;direction>0?t>to:t<to;t-=step)listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr,d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-)%(2*Math.PI)}function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}d3.geo.path=function(){var projection,context,projectStream,contextStream,cacheStream,pointRadius=4.5;function path(object){return object&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),cacheStream&&cacheStream.valid||(cacheStream=projectStream(contextStream)),d3.geo.stream(object,cacheStream)),contextStream.result()}function reset(){return cacheStream=null,path}return path.area=function(object){return d3_geo_pathAreaSum=0,d3.geo.stream(object,projectStream(d3_geo_pathArea)),d3_geo_pathAreaSum},path.centroid=function(object){return d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(object,projectStream(d3_geo_pathCentroid)),d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]},path.bounds=function(object){return d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=1/0),d3.geo.stream(object,projectStream(d3_geo_pathBounds)),[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]},path.projection=function(_){return arguments.length?(projectStream=(projection=_)?_.stream||function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}(_):d3_identity,reset()):projection},path.context=function(_){return arguments.length?(contextStream=null==(context=_)?new function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[],stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointCircle=d3_geo_pathBufferCircle(_),stream},result:function(){if(buffer.length){var result=buffer.join("");return buffer=[],result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y),stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}:new function d3_geo_pathContext(context){var pointRadius=4.5,stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointRadius=_,stream},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y),context.arc(x,y,pointRadius,0,)}function pointLineStart(x,y){context.moveTo(x,y),stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}(_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),reset()):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.projection(d3.geo.albersUsa()).context(null)},d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}},d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},d3.geo.projection=d3_geo_projection,d3.geo.projectionMutator=d3_geo_projectionMutator,(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular,d3.geo.rotation=function(rotate){function forward(coordinates){return(coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians))[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}return rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0),forward.invert=function(coordinates){return(coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians))[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates},forward},d3_geo_identityRotation.invert=d3_geo_equirectangular,d3.geo.circle=function(){var angle,interpolate,origin=[0,0],precision=6;function circle(){var center="function"==typeof origin?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];return interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y)),x[0]*=d3_degrees,x[1]*=d3_degrees}}),{type:"Polygon",coordinates:[ring]}}return circle.origin=function(x){return arguments.length?(origin=x,circle):origin},circle.angle=function(x){return arguments.length?(interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians),circle):angle},circle.precision=function(_){return arguments.length?(interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians),circle):precision},circle.angle(90)},d3.geo.distance=function(a,b){var t,=(b[0]-a[0])*d3_radians,0=a[1]*d3_radians,1=b[1]*d3_radians,sin=Math.sin(),cos=Math.cos(),sin0=Math.sin(0),cos0=Math.cos(0),sin1=Math.sin(1),cos1=Math.cos(1);return Math.atan2(Math.sqrt((t=cos1*sin)*t+(t=cos0*sin1-sin0*cos1*cos)*t),sin0*sin1+cos0*cos1*cos)},d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>}).map(y))}return graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})},graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}},graticule.extent=function(_){return arguments.length?graticule.majorExtent(_).minorExtent(_):graticule.minorExtent()},graticule.majorExtent=function(_){return arguments.length?(X0=+_[0][0],X1=+_[1][0],Y0=+_[0][1],Y1=+_[1][1],X0>X1&&(_=X0,X0=X1,X1=_),Y0>Y1&&(_=Y0,Y0=Y1,Y1=_),graticule.precision(precision)):[[X0,Y0],[X1,Y1]]},graticule.minorExtent=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],x0>x1&&(_=x0,x0=x1,x1=_),y0>y1&&(_=y0,y0=y1,y1=_),graticule.precision(precision)):[[x0,y0],[x1,y1]]},graticule.step=function(_){return arguments.length?graticule.majorStep(_).minorStep(_):graticule.minorStep()},graticule.majorStep=function(_){return arguments.length?(DX=+_[0],DY=+_[1],graticule):[DX,DY]},graticule.minorStep=function(_){return arguments.length?(dx=+_[0],dy=+_[1],graticule):[dx,dy]},graticule.precision=function(_){return arguments.length?(precision=+_,x=d3_geo_graticuleX(y0,y1,90),y=d3_geo_graticuleY(x0,x1,precision),X=d3_geo_graticuleX(Y0,Y1,90),Y=d3_geo_graticuleY(X0,X1,precision),graticule):precision},graticule.majorExtent([[-180,-90+],[180,90-]]).minorExtent([[-180,-80-],[180,80+]])},d3.geo.greatArc=function(){var source_,target_,source=d3_source,target=d3_target;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}return greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))},greatArc.source=function(_){return arguments.length?(source=_,source_="function"==typeof _?null:_,greatArc):source},greatArc.target=function(_){return arguments.length?(target=_,target_="function"==typeof _?null:_,greatArc):target},greatArc.precision=function(){return arguments.length?greatArc:0},greatArc},d3.geo.interpolate=function(source,target){return function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d),interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};return interpolate.distance=d,interpolate}(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)},d3.geo.length=function(object){return d3_geo_lengthSum=0,d3.geo.stream(object,d3_geo_length),d3_geo_lengthSum};var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:function d3_geo_lengthLineStart(){var 0,sin0,cos0;function nextPoint(,){var sin=Math.sin(*=d3_radians),cos=Math.cos(),t=abs((*=d3_radians)-0),cos=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cos*Math.sin(t))*t+(t=cos0*sin-sin0*cos*cos)*t),sin0*sin+cos0*cos*cos),0=,sin0=sin,cos0=cos}d3_geo_length.point=function(,){0=*d3_radians,sin0=Math.sin(*=d3_radians),cos0=Math.cos(),d3_geo_length.point=nextPoint},d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop}},lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_azimuthal(scale,angle){function azimuthal(,){var cos=Math.cos(),cos=Math.cos(),k=scale(cos*cos);return[k*cos*Math.sin(),k*Math.sin()]}return azimuthal.invert=function(x,y){var =Math.sqrt(x*x+y*y),c=angle(),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,*cosc),Math.asin(&&y*sinc/)]},azimuthal}var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(coscos){return Math.sqrt(2/(1+coscos))},function(){return 2*Math.asin(/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(coscos){var c=Math.acos(coscos);return c&&c/Math.sin(c)},d3_identity);function d3_geo_conicConformal(0,1){var cos0=Math.cos(0),t=function(){return Math.tan(/4+/2)},n=0===1?Math.sin(0):Math.log(cos0/Math.cos(1))/Math.log(t(1)/t(0)),F=cos0*Math.pow(t(0),n)/n;if(!n)return d3_geo_mercator;function forward(,){F>0?<-half+&&(=-half+):>half-&&(=half-);var =F/Math.pow(t(),n);return[*Math.sin(n*),F-*Math.cos(n*)]}return forward.invert=function(x,y){var 0_y=F-y,=d3_sgn(n)*Math.sqrt(x*x+0_y*0_y);return[Math.atan2(x,0_y)/n,2*Math.atan(Math.pow(F/,1/n))-half]},forward}function d3_geo_conicEquidistant(0,1){var cos0=Math.cos(0),n=0===1?Math.sin(0):(cos0-Math.cos(1))/(1-0),G=cos0/n+0;if(abs(n)<)return d3_geo_equirectangular;function forward(,){var =G-;return[*Math.sin(n*),G-*Math.cos(n*)]}return forward.invert=function(x,y){var 0_y=G-y;return[Math.atan2(x,0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+0_y*0_y)]},forward}(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant,(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal,(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(coscos){return 1/coscos},Math.atan);function d3_geo_mercator(,){return[,Math.log(Math.tan(/4+/2))]}function d3_geo_mercatorProjection(project){var clipAuto,m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent;return m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=null==_){var k=*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else clipAuto&&(v=null);return v},m.clipExtent(null)}(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic,d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-half]},(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(coscos){return 1/(1+coscos)},function(){return 2*Math.atan()});function d3_geo_transverseMercator(,){return[Math.log(Math.tan(/4+/2)),-]}function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}function d3_geom_hullUpper(points){for(var n=points.length,hull=[0,1],hs=2,i=2;i<n;i++){for(;hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0;)--hs;hull[hs++]=i}return hull.slice(0,hs)}function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1]}(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic,d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-half]},(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;return projection.center=function(_){return _?center([-_[1],_[0]]):[(_=center())[1],-_[0]]},projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):[(_=rotate())[0],_[1],_[2]-90]},rotate([0,0,90])}).raw=d3_geo_transverseMercator,d3.geom={},d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var i,fx=d3_functor(x),fy=d3_functor(y),n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++)points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);for(points.sort(d3_geom_hullOrder),i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints),skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon}return hull.x=function(_){return arguments.length?(x=_,hull):x},hull.y=function(_){return arguments.length?(y=_,hull):y},hull},d3.geom.polygon=function(coordinates){return d3_subclass(coordinates,d3_geom_polygonPrototype),coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}d3_geom_polygonPrototype.area=function(){for(var a,i=-1,n=this.length,b=this[n-1],area=0;++i<n;)a=b,b=this[i],area+=a[1]*b[0]-a[0]*b[1];return.5*area},d3_geom_polygonPrototype.centroid=function(k){var a,c,i=-1,n=this.length,x=0,y=0,b=this[n-1];for(arguments.length||(k=-1/(6*this.area()));++i<n;)a=b,b=this[i],c=a[0]*b[1]-b[0]*a[1],x+=(a[0]+b[0])*c,y+=(a[1]+b[1])*c;return[x*k,y*k]},d3_geom_polygonPrototype.clip=function(subject){for(var input,j,m,b,c,d,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),a=this[n-1];++i<n;){for(input=subject.slice(),subject.length=0,b=this[i],c=input[(m=input.length-closed)-1],j=-1;++j<m;)d3_geom_polygonInside(d=input[j],a,b)?(d3_geom_polygonInside(c,a,b)||subject.push(d3_geom_polygonIntersect(c,d,a,b)),subject.push(d)):d3_geom_polygonInside(c,a,b)&&subject.push(d3_geom_polygonIntersect(c,d,a,b)),c=d;closed&&subject.push(subject[0]),a=b}return subject};var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiBeachPool=[],d3_geom_voronoiCirclePool=[];function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this),this.edge=this.site=this.circle=null};return beach.site=site,beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach),d3_geom_voronoiBeaches.remove(beach),d3_geom_voronoiBeachPool.push(beach),d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);for(var lArc=previous;lArc.circle&&abs(x-lArc.circle.x)<&&abs(y-lArc.circle.cy)<;)previous=lArc.P,disappearing.unshift(lArc),d3_geom_voronoiDetachBeach(lArc),lArc=previous;disappearing.unshift(lArc),d3_geom_voronoiDetachCircle(lArc);for(var rArc=next;rArc.circle&&abs(x-rArc.circle.x)<&&abs(y-rArc.circle.cy)<;)next=rArc.N,disappearing.push(rArc),d3_geom_voronoiDetachBeach(rArc),rArc=next;disappearing.push(rArc),d3_geom_voronoiDetachCircle(rArc);var iArc,nArcs=disappearing.length;for(iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],(rArc=disappearing[nArcs-1]).edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiAddBeach(site){for(var lArc,rArc,dxl,dxr,x=site.x,directrix=site.y,node=d3_geom_voronoiBeaches._;node;)if((dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x)>)node=node.L;else{if(!((dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix))>)){dxl>-?(lArc=node.P,rArc=node):dxr>-?(lArc=node,rArc=node.N):lArc=rArc=node;break}if(!node.R){lArc=node;break}node=node.R}var newArc=d3_geom_voronoiCreateBeach(site);if(d3_geom_voronoiBeaches.insert(lArc,newArc),lArc||rArc){if(lArc===rArc)return d3_geom_voronoiDetachCircle(lArc),rArc=d3_geom_voronoiCreateBeach(lArc.site),d3_geom_voronoiBeaches.insert(newArc,rArc),newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site),d3_geom_voronoiAttachCircle(lArc),void d3_geom_voronoiAttachCircle(rArc);if(rArc){d3_geom_voronoiDetachCircle(lArc),d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex),newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex),rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)}else newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site)}}function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-1/0;var lfocx=(site=lArc.site).x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:1/0}function d3_geom_voronoiCell(site){this.site=site,this.edges=[]}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(lArc&&rArc){var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite!==rSite){var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,d=2*(ax*(cy=rSite.y-by)-ay*cx);if(!(d>=-2)){var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by,circle=d3_geom_voronoiCirclePool.pop()||new function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null};circle.arc=arc,circle.site=cSite,circle.x=x+bx,circle.y=cy+Math.sqrt(x*x+y*y),circle.cy=cy,arc.circle=circle;for(var before=null,node=d3_geom_voronoiCircles._;node;)if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(!node.L){before=node.P;break}node=node.L}else{if(!node.R){before=node;break}node=node.R}d3_geom_voronoiCircles.insert(before,circle),before||(d3_geom_voronoiFirstCircle=circle)}}}}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;circle&&(circle.P||(d3_geom_voronoiFirstCircle=circle.N),d3_geom_voronoiCircles.remove(circle),d3_geom_voronoiCirclePool.push(circle),d3_geom_voronoiRedBlackNode(circle),arc.circle=null)}function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return!0;var fm,fb,va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(va){if(va.y>=y1)return}else va={x:fx,y:y0};vb={x:fx,y:y1}}else{if(va){if(va.y<y0)return}else va={x:fx,y:y1};vb={x:fx,y:y0}}}else if(fb=fy-(fm=(lx-rx)/(ry-ly))*fx,fm<-1||fm>1)if(lx>rx){if(va){if(va.y>=y1)return}else va={x:(y0-fb)/fm,y:y0};vb={x:(y1-fb)/fm,y:y1}}else{if(va){if(va.y<y0)return}else va={x:(y1-fb)/fm,y:y1};vb={x:(y0-fb)/fm,y:y0}}else if(ly<ry){if(va){if(va.x>=x1)return}else va={x:x0,y:fm*x0+fb};vb={x:x1,y:fm*x1+fb}}else{if(va){if(va.x<x0)return}else va={x:x1,y:fm*x1+fb};vb={x:x0,y:fm*x0+fb}}return edge.a=va,edge.b=vb,!0}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite,this.r=rSite,this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);return d3_geom_voronoiEdges.push(edge),va&&d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va),vb&&d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb),d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite)),d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite)),edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){edge.a||edge.b?edge.l===rSite?edge.b=vertex:edge.a=vertex:(edge.a=vertex,edge.l=lSite,edge.r=rSite)}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge,this.site=lSite,this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function d3_geom_voronoiRedBlackFirst(node){for(;node.L;)node=node.L;return node}function d3_geom_voronoi(sites,bbox){var x0,y0,circle,site=sites.sort(d3_geom_voronoiVertexOrder).pop();for(d3_geom_voronoiEdges=[],d3_geom_voronoiCells=new Array(sites.length),d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree,d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;;)if(circle=d3_geom_voronoiFirstCircle,site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x))site.x===x0&&site.y===y0||(d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site),d3_geom_voronoiAddBeach(site),x0=site.x,y0=site.y),site=sites.pop();else{if(!circle)break;d3_geom_voronoiRemoveBeach(circle.arc)}bbox&&(function d3_geom_voronoiClipEdges(extent){for(var e,edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length;i--;)(!d3_geom_voronoiConnectEdge(e=edges[i],extent)||!clip(e)||abs(e.a.x-e.b.x)<&&abs(e.a.y-e.b.y)<)&&(e.a=e.b=null,edges.splice(i,1))}(bbox),function d3_geom_voronoiCloseCells(extent){for(var x2,y2,x3,y3,cell,iHalfEdge,halfEdges,nHalfEdges,start,end,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],cells=d3_geom_voronoiCells,iCell=cells.length;iCell--;)if((cell=cells[iCell])&&cell.prepare())for(nHalfEdges=(halfEdges=cell.edges).length,iHalfEdge=0;iHalfEdge<nHalfEdges;)x3=(end=halfEdges[iHalfEdge].end()).x,y3=end.y,x2=(start=halfEdges[++iHalfEdge%nHalfEdges].start()).x,y2=start.y,(abs(x3-x2)>||abs(y3-y2)>)&&(halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge((lSite=cell.site,va=end,vb=abs(x3-x0)<&&y1-y3>?{x:x0,y:abs(x2-x0)<?y2:y1}:abs(y3-y1)<&&x1-x3>?{x:abs(y2-y1)<?x2:x1,y:y1}:abs(x3-x1)<&&y3-y0>?{x:x1,y:abs(x2-x1)<?y2:y0}:abs(y3-y0)<&&x3-x0>?{x:abs(y2-y0)<?x2:x0,y:y0}:null,edge=void 0,edge=new d3_geom_voronoiEdge(lSite,null),edge.a=va,edge.b=vb,d3_geom_voronoiEdges.push(edge),edge),cell.site,null)),++nHalfEdges);var lSite,va,vb,edge}(bbox));var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};return d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null,diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}d3_geom_voronoiCell.prototype.prepare=function(){for(var edge,halfEdges=this.edges,iHalfEdge=halfEdges.length;iHalfEdge--;)(edge=halfEdges[iHalfEdge].edge).b&&edge.a||halfEdges.splice(iHalfEdge,1);return halfEdges.sort(d3_geom_voronoiHalfEdgeOrder),halfEdges.length},d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else this._?(after=d3_geom_voronoiRedBlackFirst(this._),node.P=null,node.N=after,after.P=after.L=node,parent=after):(node.P=node.N=null,this._=node,parent=null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)parent===(grandpa=parent.U).L?(uncle=grandpa.R)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(d3_geom_voronoiRedBlackRotateLeft(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateRight(this,grandpa)):(uncle=grandpa.L)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(d3_geom_voronoiRedBlackRotateRight(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,grandpa)),parent=after.U;this._.C=!1},remove:function(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var sibling,next,red,parent=node.U,left=node.L,right=node.R;if(next=left?right?d3_geom_voronoiRedBlackFirst(right):left:right,parent?parent.L===node?parent.L=next:parent.R=next:this._=next,left&&right?(red=next.C,next.C=node.C,next.L=left,left.U=next,next!==right?(parent=next.U,next.U=node.U,node=next.R,parent.L=node,next.R=right,right.U=next):(next.U=parent,parent=next,node=next.R)):(red=node.C,node=next),node&&(node.U=parent),!red)if(node&&node.C)node.C=!1;else{do{if(node===this._)break;if(node===parent.L){if((sibling=parent.R).C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.R&&sibling.R.C||(sibling.L.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,d3_geom_voronoiRedBlackRotateLeft(this,parent),node=this._;break}}else if((sibling=parent.L).C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.L&&sibling.L.C||(sibling.R.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,d3_geom_voronoiRedBlackRotateRight(this,parent),node=this._;break}sibling.C=!0,node=parent,parent=parent.U}while(!node.C);node&&(node.C=!1)}}},d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];return d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site;(polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[]).point=data[i]}),polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/)*,y:Math.round(fy(d,i)/)*,i:i}})}return voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})},voronoi.triangles=function(data){var triangles=[];return d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){for(var s0,a,b,c,site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;++j<m;)e1,s0=s1,s1=(e1=edges[j].edge).l===site?e1.r:e1.l,i<s0.i&&i<s1.i&&(b=s0,c=s1,((a=site).x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)<0)&&triangles.push([data[i],data[s0.i],data[s1.i]])}),triangles},voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x},voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y},voronoi.clipExtent=function(_){return arguments.length?(clipExtent=null==_?d3_geom_voronoiClipExtent:_,voronoi):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent},voronoi.size=function(_){return arguments.length?voronoi.clipExtent(_&&[[0,0],_]):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1]},voronoi};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_interpolateRgb(a,b){a=d3.rgb(a),b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}function d3_interpolateObject(a,b){var k,i={},c={};for(k in a)k in b?i[k]=d3_interpolate(a[k],b[k]):c[k]=a[k];for(k in b)k in a||(c[k]=b[k]);return function(t){for(k in i)c[k]=i[k](t);return c}}function d3_interpolateNumber(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function d3_interpolateString(a,b){var am,bm,bs,bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:d3_interpolateNumber(am,bm)})),bi=d3_interpolate_numberB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)},d3.geom.quadtree=function(points,x1,y1,x2,y2){var compat,x=d3_geom_pointX,y=d3_geom_pointY;if(compat=arguments.length)return x=d3_geom_quadtreeCompatX,y=d3_geom_quadtreeCompatY,3===compat&&(y2=y1,x2=x1,y1=x1=0),quadtree(points);function quadtree(data){var d,xs,ys,i,n,x1_,y1_,x2_,y2_,fx=d3_functor(x),fy=d3_functor(y);if(null!=x1)x1_=x1,y1_=y1,x2_=x2,y2_=y2;else if(x2_=y2_=-(x1_=y1_=1/0),xs=[],ys=[],n=data.length,compat)for(i=0;i<n;++i)(d=data[i]).x<x1_&&(x1_=d.x),d.y<y1_&&(y1_=d.y),d.x>x2_&&(x2_=d.x),d.y>y2_&&(y2_=d.y),xs.push(d.x),ys.push(d.y);else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);x_<x1_&&(x1_=x_),y_<y1_&&(y1_=y_),x_>x2_&&(x2_=x_),y_>y2_&&(y2_=y_),xs.push(x_),ys.push(y_)}var dx=x2_-x1_,dy=y2_-y1_;function insert(n,d,x,y,x1,y1,x2,y2){if(!isNaN(x)&&!isNaN(y))if(n.leaf){var nx=n.x,ny=n.y;if(null!=nx)if(abs(nx-x)+abs(ny-y)<.01)insertChild(n,d,x,y,x1,y1,x2,y2);else{var nPoint=n.point;n.x=n.y=n.point=null,insertChild(n,nPoint,nx,ny,x1,y1,x2,y2),insertChild(n,d,x,y,x1,y1,x2,y2)}else n.x=x,n.y=y,n.point=d}else insertChild(n,d,x,y,x1,y1,x2,y2)}function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=.5*(x1+x2),ym=.5*(y1+y2),right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=!1,n=n.nodes[i]||(n.nodes[i]={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)}}),right?x1=xm:x2=xm,below?y1=ym:y2=ym,insert(n,d,x,y,x1,y1,x2,y2)}dx>dy?y2_=y1_+dx:x2_=x1_+dy;var root={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)}};if(root.visit=function(f){!function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=.5*(x1+x2),sy=.5*(y1+y2),children=node.nodes;children[0]&&d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy),children[1]&&d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy),children[2]&&d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2),children[3]&&d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}(f,root,x1_,y1_,x2_,y2_)},root.find=function(point){return function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var closestPoint,minDistance2=1/0;return function find(node,x1,y1,x2,y2){if(!(x1>x3||y1>y3||x2<x0||y2<y0)){if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance,x3=x+distance,y3=y+distance,closestPoint=point}}for(var children=node.nodes,xm=.5*(x1+x2),ym=.5*(y1+y2),i=(y>=ym)<<1|x>=xm,j=i+4;i<j;++i)if(node=children[3&i])switch(3&i){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2)}}}(root,x0,y0,x3,y3),closestPoint}(root,point[0],point[1],x1_,y1_,x2_,y2_)},i=-1,null==x1){for(;++i<n;)insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);--i}else data.forEach(root.add);return xs=ys=data=d=null,root}return quadtree.x=function(_){return arguments.length?(x=_,quadtree):x},quadtree.y=function(_){return arguments.length?(y=_,quadtree):y},quadtree.extent=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1]),quadtree):null==x1?null:[[x1,y1],[x2,y2]]},quadtree.size=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=y1=0,x2=+_[0],y2=+_[1]),quadtree):null==x1?null:[x2-x1,y2-y1]},quadtree},d3.interpolateRgb=d3_interpolateRgb,d3.interpolateObject=d3_interpolateObject,d3.interpolateNumber=d3_interpolateNumber,d3.interpolateString=d3_interpolateString;var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");function d3_interpolate(a,b){for(var f,i=d3.interpolators.length;--i>=0&&!(f=d3.interpolators[i](a,b)););return f}function d3_interpolateArray(a,b){var i,x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length);for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}d3.interpolate=d3_interpolate,d3.interpolators=[function(a,b){var t=typeof b;return("string"===t?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:"object"===t&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}],d3.interpolateArray=d3_interpolateArray;var d3_ease_default=function(){return d3_identity},d3_ease=d3.map({linear:d3_ease_default,poly:function d3_ease_poly(e){return function(t){return Math.pow(t,e)}},quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:function d3_ease_elastic(a,p){var s;arguments.length<2&&(p=.45);arguments.length?s=p/*Math.asin(1/a):(a=1,s=p/4);return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*/p)}},back:function d3_ease_back(s){s||(s=1.70158);return function(t){return t*t*((s+1)*t-s)}},bounce:function(){return d3_ease_bounce}}),d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_sin(t){return 1-Math.cos(t*half)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function d3_interpolateRound(a,b){return b-=a,function(t){return Math.round(a+b*t)}}function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(function d3_transformCombine(a,b,k){return a[0]+=k*b[0],a[1]+=k*b[1],a}(r1,r0,-kz))||0;r0[0]*r1[1]<r1[0]*r0[1]&&(r0[0]*=-1,r0[1]*=-1,kx*=-1,kz*=-1),this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees,this.translate=[m.e,m.f],this.scale=[kx,ky],this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));return k&&(a[0]/=k,a[1]/=k),k}d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";return t=d3_ease.get(t)||d3_ease_default,function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t)}}((m=d3_ease_mode.get(m)||d3_identity)(t.apply(null,d3_arraySlice.call(arguments,1))))},d3.interpolateHcl=function d3_interpolateHcl(a,b){a=d3.hcl(a),b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;isNaN(bc)&&(bc=0,ac=isNaN(ac)?b.c:ac);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:bh<-180&&(bh+=360);return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}},d3.interpolateHsl=function d3_interpolateHsl(a,b){a=d3.hsl(a),b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;isNaN(bs)&&(bs=0,as=isNaN(as)?b.s:as);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:bh<-180&&(bh+=360);return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}},d3.interpolateLab=function d3_interpolateLab(a,b){a=d3.lab(a),b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}},d3.interpolateRound=d3_interpolateRound,d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(null!=string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)},d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};function d3_interpolateTransformPop(s){return s.length?s.pop()+",":""}function d3_interpolateTransform(a,b){var s=[],q=[];return a=d3.transform(a),b=d3.transform(b),function d3_interpolateTranslate(ta,tb,s,q){if(ta[0]!==tb[0]||ta[1]!==tb[1]){var i=s.push("translate(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ta[0],tb[0])},{i:i-2,x:d3_interpolateNumber(ta[1],tb[1])})}else(tb[0]||tb[1])&&s.push("translate("+tb+")")}(a.translate,b.translate,s,q),function d3_interpolateRotate(ra,rb,s,q){ra!==rb?(ra-rb>180?rb+=360:rb-ra>180&&(ra+=360),q.push({i:s.push(d3_interpolateTransformPop(s)+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})):rb&&s.push(d3_interpolateTransformPop(s)+"rotate("+rb+")")}(a.rotate,b.rotate,s,q),function d3_interpolateSkew(wa,wb,s,q){wa!==wb?q.push({i:s.push(d3_interpolateTransformPop(s)+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)}):wb&&s.push(d3_interpolateTransformPop(s)+"skewX("+wb+")")}(a.skew,b.skew,s,q),function d3_interpolateScale(ka,kb,s,q){if(ka[0]!==kb[0]||ka[1]!==kb[1]){var i=s.push(d3_interpolateTransformPop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:i-2,x:d3_interpolateNumber(ka[1],kb[1])})}else 1===kb[0]&&1===kb[1]||s.push(d3_interpolateTransformPop(s)+"scale("+kb+")")}(a.scale,b.scale,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){return b=(b-=a=+a)||1/b,function(x){return(x-a)/b}}function d3_uninterpolateClamp(a,b){return b=(b-=a=+a)||1/b,function(x){return Math.max(0,Math.min(1,(x-a)/b))}}function d3_layout_bundlePath(link){for(var start=link.source,end=link.target,lca=function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;for(;aNode===bNode;)sharedNode=aNode,aNode=aNodes.pop(),bNode=bNodes.pop();return sharedNode}(start,end),points=[start];start!==lca;)start=start.parent,points.push(start);for(var k=points.length;end!==lca;)points.splice(k,0,end),end=end.parent;return points}function d3_layout_bundleAncestors(node){for(var ancestors=[],parent=node.parent;null!=parent;)ancestors.push(node),node=parent,parent=parent.parent;return ancestors.push(node),ancestors}function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=-7}function d3_layout_forceMouseover(d){d.fixed|=4,d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=-5}d3.interpolateTransform=d3_interpolateTransform,d3.layout={},d3.layout.bundle=function(){return function(links){for(var paths=[],i=-1,n=links.length;++i<n;)paths.push(d3_layout_bundlePath(links[i]));return paths}},d3.layout.chord=function(){var chords,groups,matrix,n,sortGroups,sortSubgroups,sortChords,chord={},padding=0;function relayout(){var k,x,x0,i,j,subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[];for(chords=[],groups=[],k=0,i=-1;++i<n;){for(x=0,j=-1;++j<n;)x+=matrix[i][j];groupSums.push(x),subgroupIndex.push(d3.range(n)),k+=x}for(sortGroups&&groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])}),sortSubgroups&&subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})}),k=(-padding*n)/k,x=0,i=-1;++i<n;){for(x0=x,j=-1;++j<n;){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]},x+=padding}for(i=-1;++i<n;)for(j=i-1;++j<n;){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];(source.value||target.value)&&chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}sortChords&&resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}return chord.matrix=function(x){return arguments.length?(n=(matrix=x)&&matrix.length,chords=groups=null,chord):matrix},chord.padding=function(x){return arguments.length?(padding=x,chords=groups=null,chord):padding},chord.sortGroups=function(x){return arguments.length?(sortGroups=x,chords=groups=null,chord):sortGroups},chord.sortSubgroups=function(x){return arguments.length?(sortSubgroups=x,chords=null,chord):sortSubgroups},chord.sortChords=function(x){return arguments.length?(sortChords=x,chords&&resort(),chord):sortChords},chord.chords=function(){return chords||relayout(),chords},chord.groups=function(){return groups||relayout(),groups},chord},d3.layout.force=function(){var timer,drag,alpha,distances,strengths,charges,force={},event=d3.dispatch("start","tick","end"),size=[1,1],friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[];function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k,node.py-=dy*k}return!0}if(quad.point&&dn&&dn<chargeDistance2){k=quad.pointCharge/dn;node.px-=dx*k,node.py-=dy*k}}return!quad.charge}}function dragmove(d){d.px=d3.event.x,d.py=d3.event.y,force.resume()}return force.tick=function(){if((alpha*=.99)<.005)return timer=null,event.end({type:"end",alpha:alpha=0}),!0;var q,i,o,s,t,l,k,x,y,n=nodes.length,m=links.length;for(i=0;i<m;++i)s=(o=links[i]).source,(l=(x=(t=o.target).x-s.x)*x+(y=t.y-s.y)*y)&&(x*=l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l,y*=l,t.x-=x*(k=s.weight+t.weight?s.weight/(s.weight+t.weight):.5),t.y-=y*k,s.x+=x*(k=1-k),s.y+=y*k);if((k=alpha*gravity)&&(x=size[0]/2,y=size[1]/2,i=-1,k))for(;++i<n;)(o=nodes[i]).x+=(x-o.x)*k,o.y+=(y-o.y)*k;if(charge)for(!function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf)for(var c,nodes=quad.nodes,n=nodes.length,i=-1;++i<n;)null!=(c=nodes[i])&&(d3_layout_forceAccumulate(c,alpha,charges),quad.charge+=c.charge,cx+=c.charge*c.cx,cy+=c.charge*c.cy);if(quad.point){quad.leaf||(quad.point.x+=Math.random()-.5,quad.point.y+=Math.random()-.5);var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k,cx+=k*quad.point.x,cy+=k*quad.point.y}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}(q=d3.geom.quadtree(nodes),alpha,charges),i=-1;++i<n;)(o=nodes[i]).fixed||q.visit(repulse(o));for(i=-1;++i<n;)(o=nodes[i]).fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*friction,o.y-=(o.py-(o.py=o.y))*friction);event.tick({type:"tick",alpha:alpha})},force.nodes=function(x){return arguments.length?(nodes=x,force):nodes},force.links=function(x){return arguments.length?(links=x,force):links},force.size=function(x){return arguments.length?(size=x,force):size},force.linkDistance=function(x){return arguments.length?(linkDistance="function"==typeof x?x:+x,force):linkDistance},force.distance=force.linkDistance,force.linkStrength=function(x){return arguments.length?(linkStrength="function"==typeof x?x:+x,force):linkStrength},force.friction=function(x){return arguments.length?(friction=+x,force):friction},force.charge=function(x){return arguments.length?(charge="function"==typeof x?x:+x,force):charge},force.chargeDistance=function(x){return arguments.length?(chargeDistance2=x*x,force):Math.sqrt(chargeDistance2)},force.gravity=function(x){return arguments.length?(gravity=+x,force):gravity},force.theta=function(x){return arguments.length?(theta2=x*x,force):Math.sqrt(theta2)},force.alpha=function(x){return arguments.length?(x=+x,alpha?x>0?alpha=x:(timer.c=null,timer.t=NaN,timer=null,event.end({type:"end",alpha:alpha=0})):x>0&&(event.start({type:"start",alpha:alpha=x}),timer=d3_timer(force.tick)),force):alpha},force.start=function(){var i,neighbors,o,n=nodes.length,m=links.length,w=size[0],h=size[1];for(i=0;i<n;++i)(o=nodes[i]).index=i,o.weight=0;for(i=0;i<m;++i)"number"==typeof(o=links[i]).source&&(o.source=nodes[o.source]),"number"==typeof o.target&&(o.target=nodes[o.target]),++o.source.weight,++o.target.weight;for(i=0;i<n;++i)o=nodes[i],isNaN(o.x)&&(o.x=position("x",w)),isNaN(o.y)&&(o.y=position("y",h)),isNaN(o.px)&&(o.px=o.x),isNaN(o.py)&&(o.py=o.y);if(distances=[],"function"==typeof linkDistance)for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;if(strengths=[],"function"==typeof linkStrength)for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;if(charges=[],"function"==typeof charge)for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){for(neighbors=new Array(n),j=0;j<n;++j)neighbors[j]=[];for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target),neighbors[o.target.index].push(o.source)}}for(var x,candidates=neighbors[i],j=-1,l=candidates.length;++j<l;)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}return force.resume()},force.resume=function(){return force.alpha(.1)},force.stop=function(){return force.alpha(0)},force.drag=function(){if(drag||(drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend)),!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)},d3.rebind(force,event,"on")};var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=1/0;function d3_layout_hierarchyRebind(object,hierarchy){return d3.rebind(object,hierarchy,"sort","children","value"),object.nodes=object,object.links=d3_layout_hierarchyLinks,object}function d3_layout_hierarchyVisitBefore(node,callback){for(var nodes=[node];null!=(node=nodes.pop());)if(callback(node),(children=node.children)&&(n=children.length))for(var n,children;--n>=0;)nodes.push(children[n])}function d3_layout_hierarchyVisitAfter(node,callback){for(var nodes=[node],nodes2=[];null!=(node=nodes.pop());)if(nodes2.push(node),(children=node.children)&&(n=children.length))for(var n,children,i=-1;++i<n;)nodes.push(children[i]);for(;null!=(node=nodes2.pop());)callback(node)}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var node,stack=[root],nodes=[];for(root.depth=0;null!=(node=stack.pop());)if(nodes.push(node),(childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){for(var n,childs,child;--n>=0;)stack.push(child=childs[n]),child.parent=node,child.depth=node.depth+1;value&&(node.value=0),node.children=childs}else value&&(node.value=+value.call(hierarchy,node,node.depth)||0),delete node.children;return d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;sort&&(childs=node.children)&&childs.sort(sort),value&&(parent=node.parent)&&(parent.value+=node.value)}),nodes}return hierarchy.sort=function(x){return arguments.length?(sort=x,hierarchy):sort},hierarchy.children=function(x){return arguments.length?(children=x,hierarchy):children},hierarchy.value=function(x){return arguments.length?(value=x,hierarchy):value},hierarchy.revalue=function(root){return value&&(d3_layout_hierarchyVisitBefore(root,function(node){node.children&&(node.value=0)}),d3_layout_hierarchyVisitAfter(root,function(node){var parent;node.children||(node.value=+value.call(hierarchy,node,node.depth)||0),(parent=node.parent)&&(parent.value+=node.value)})),root},hierarchy},d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function partition(d,i){var nodes=hierarchy.call(this,d,i);return function position(node,x,dx,dy){var children=node.children;if(node.x=x,node.y=node.depth*dy,node.dx=dx,node.dy=dy,children&&(n=children.length)){var n,c,d,i=-1;for(dx=node.value?dx/node.value:0;++i<n;)position(c=children[i],x,d=c.value*dx,dy),x+=d}}(nodes[0],0,size[0],size[1]/function depth(node){var children=node.children,d=0;if(children&&(n=children.length))for(var n,i=-1;++i<n;)d=Math.max(d,depth(children[i]));return 1+d}(nodes[0])),nodes}return partition.size=function(x){return arguments.length?(size=x,partition):size},d3_layout_hierarchyRebind(partition,hierarchy)},d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=,padAngle=0;function pie(data){var v,n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+("function"==typeof startAngle?startAngle.apply(this,arguments):startAngle),da=("function"==typeof endAngle?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+("function"==typeof padAngle?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),sum=d3.sum(values),k=sum?(da-n*pa)/sum:0,index=d3.range(n),arcs=[];return null!=sort&&index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])}),index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p}}),arcs}return pie.value=function(_){return arguments.length?(value=_,pie):value},pie.sort=function(_){return arguments.length?(sort=_,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle=_,pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle=_,pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle=_,pie):padAngle},pie};var d3_layout_pieSortByValue={};function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0,d.y=y}d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i)}),points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})}),orders=order.call(stack,points,index);series=d3.permute(series,orders),points=d3.permute(points,orders);var n,i,j,o,offsets=offset.call(stack,points,index),m=series[0].length;for(j=0;j<m;++j)for(out.call(stack,series[0][j],o=offsets[j],points[0][j][1]),i=1;i<n;++i)out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);return data}return stack.values=function(x){return arguments.length?(values=x,stack):values},stack.order=function(x){return arguments.length?(order="function"==typeof x?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault,stack):order},stack.offset=function(x){return arguments.length?(offset="function"==typeof x?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero,stack):offset},stack.x=function(z){return arguments.length?(x=z,stack):x},stack.y=function(z){return arguments.length?(y=z,stack):y},stack.out=function(z){return arguments.length?(out=z,stack):out},stack};var d3_layout_stackOrders=d3.map({"inside-out":function(data){var i,j,n=data.length,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i)j=index[i],top<bottom?(top+=sums[j],tops.push(j)):(bottom+=sums[j],bottoms.push(j));return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault}),d3_layout_stackOffsets=d3.map({silhouette:function(data){var i,j,o,n=data.length,m=data[0].length,sums=[],max=0,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];o>max&&(max=o),sums.push(o)}for(j=0;j<m;++j)y0[j]=(max-sums[j])/2;return y0},wiggle:function(data){var i,j,k,s1,s2,s3,dx,o,o0,n=data.length,x=data[0],m=x.length,y0=[];for(y0[0]=o=o0=0,j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k)s3+=(data[k][j][1]-data[k][j-1][1])/dx;s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0,o<o0&&(o0=o)}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){var i,j,o,n=data.length,m=data[0].length,k=1/n,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){for(var j=-1,m=data[0].length,y0=[];++j<m;)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){for(var k,i=1,j=0,v=array[0][1],n=array.length;i<n;++i)(k=array[i][1])>v&&(j=i,v=k);return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){for(var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];++x<=n;)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b,b._pack_prev=a,b._pack_next=c,c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b,b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){if((nodes=node.children)&&(n=nodes.length)){var nodes,a,b,c,i,j,k,n,xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;if(nodes.forEach(d3_layout_packLink),(a=nodes[0]).x=-a.r,a.y=0,bound(a),n>1&&((b=nodes[1]).x=b.r,b.y=0,bound(b),n>2))for(d3_layout_packPlace(a,b,c=nodes[2]),bound(c),d3_layout_packInsert(a,c),a._pack_prev=c,d3_layout_packInsert(c,b),b=a._pack_next,i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++)if(d3_layout_packIntersects(j,c)){isect=1;break}if(1==isect)for(k=a._pack_prev;k!==j._pack_prev&&!d3_layout_packIntersects(k,c);k=k._pack_prev,s2++);isect?(s1<s2||s1==s2&&b.r<a.r?d3_layout_packSplice(a,b=j):d3_layout_packSplice(a=k,b),i--):(d3_layout_packInsert(a,c),b=c,bound(c))}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++)(c=nodes[i]).x-=cx,c.y-=cy,cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));node.r=cr,nodes.forEach(d3_layout_packUnlink)}function bound(node){xMin=Math.min(node.x-node.r,xMin),xMax=Math.max(node.x+node.r,xMax),yMin=Math.min(node.y-node.r,yMin),yMax=Math.max(node.y+node.r,yMax)}}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next,delete node._pack_prev}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy,x=.5+((db*=db)-(da*=da))/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy,c.y=a.y+x*dy-y*dx}else c.x=a.x+db,c.y=a.y}function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t}function d3_layout_treeRight(v){var n,children=v.children;return(n=children.length)?children[n-1]:v.t}function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change,wp.s+=shift,wm.c+=change,wp.z+=shift,wp.m+=shift}function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];return dx<0&&(x+=dx/2,dx=0),dy<0&&(y+=dy/2,dy=0),{x:x,y:y,dx:dx,dy:dy}}function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var dx,i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(dx=i0,i0=i1,i1=dx,dx=x0,x0=x1,x1=dx),domain[i0]=nice.floor(x0),domain[i1]=nice.ceil(x1),domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}d3.layout.histogram=function(){var frequency=!0,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){for(var bin,x,bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),n=(i=-1,values.length),m=thresholds.length-1,k=frequency?1:1/n;++i<m;)(bin=bins[i]=[]).dx=thresholds[i+1]-(bin.x=thresholds[i]),bin.y=0;if(m>0)for(i=-1;++i<n;)(x=values[i])>=range[0]&&x<=range[1]&&((bin=bins[d3.bisect(thresholds,x,1,m)-1]).y+=k,bin.push(data[i]));return bins}return histogram.value=function(x){return arguments.length?(valuer=x,histogram):valuer},histogram.range=function(x){return arguments.length?(ranger=d3_functor(x),histogram):ranger},histogram.bins=function(x){return arguments.length?(binner="number"==typeof x?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x),histogram):binner},histogram.frequency=function(x){return arguments.length?(frequency=!!x,histogram):frequency},histogram},d3.layout.pack=function(){var radius,hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=null==radius?Math.sqrt:"function"==typeof radius?radius:function(){return radius};if(root.x=root.y=0,d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value)}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr})}return function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children)for(var i=-1,n=children.length;++i<n;)d3_layout_packTransform(children[i],x,y,k)}(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h)),nodes}return pack.size=function(_){return arguments.length?(size=_,pack):size},pack.radius=function(_){return arguments.length?(radius=null==_||"function"==typeof _?_:+_,pack):radius},pack.padding=function(_){return arguments.length?(padding=+_,pack):padding},d3_layout_hierarchyRebind(pack,hierarchy)},d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=function wrapTree(root0){var node1,root1={A:null,children:[root0]},queue=[root1];for(;null!=(node1=queue.pop());)for(var child,children=node1.children,i=0,n=children.length;i<n;++i)queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);return root1.children[0]}(root0);if(d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z,d3_layout_hierarchyVisitBefore(root1,secondWalk),nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){node.x<left.x&&(left=node),node.x>right.x&&(right=node),node.depth>bottom.depth&&(bottom=node)});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx,node.y=node.depth*ky})}return nodes}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){!function d3_layout_treeShift(v){var w,shift=0,change=0,children=v.children,i=children.length;for(;--i>=0;)(w=children[i]).z+=shift,w.m+=shift,shift+=w.s+(change+=w.c)}(v);var midpoint=(children[0].z+children[children.length-1].z)/2;w?(v.z=w.z+separation(v._,w._),v.m=v.z-midpoint):v.z=midpoint}else w&&(v.z=w.z+separation(v._,w._));v.parent.A=function apportion(v,w,ancestor){if(w){for(var shift,vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m;vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip;)vom=d3_layout_treeLeft(vom),(vop=d3_layout_treeRight(vop)).a=v,(shift=vim.z+sim-vip.z-sip+separation(vim._,vip._))>0&&(d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift),sip+=shift,sop+=shift),sim+=vim.m,sip+=vip.m,som+=vom.m,sop+=vop.m;vim&&!d3_layout_treeRight(vop)&&(vop.t=vim,vop.m+=sim-sop),vip&&!d3_layout_treeLeft(vom)&&(vom.t=vip,vom.m+=sip-som,ancestor=v)}return ancestor}(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m,v.m+=v.parent.m}function sizeNode(node){node.x*=size[0],node.y=node.depth*size[1]}return tree.separation=function(x){return arguments.length?(separation=x,tree):separation},tree.size=function(x){return arguments.length?(nodeSize=null==(size=x)?sizeNode:null,tree):nodeSize?null:size},tree.nodeSize=function(x){return arguments.length?(nodeSize=null==(size=x)?null:sizeNode,tree):nodeSize?size:null},d3_layout_hierarchyRebind(tree,hierarchy)},d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=!1;function cluster(d,i){var previousNode,nodes=hierarchy.call(this,d,i),root=nodes[0],x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;children&&children.length?(node.x=function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}(children),node.y=function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}(children)):(node.x=previousNode?x+=separation(node,previousNode):0,node.y=0,previousNode=node)});var left=function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}(root),right=function d3_layout_clusterRight(node){var n,children=node.children;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0],node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0],node.y=(1-(root.y?node.y/root.y:1))*size[1]}),nodes}return cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation},cluster.size=function(x){return arguments.length?(nodeSize=null==(size=x),cluster):nodeSize?null:size},cluster.nodeSize=function(x){return arguments.length?(nodeSize=null!=(size=x),cluster):nodeSize?size:null},d3_layout_hierarchyRebind(cluster,hierarchy)},d3.layout.treemap=function(){var stickies,hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=!1,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){for(var child,area,i=-1,n=children.length;++i<n;)area=(child=children[i]).value*(k<0?0:k),child.area=isNaN(area)||area<=0?0:area}function squarify(node){var children=node.children;if(children&&children.length){var child,score,n,rect=pad(node),row=[],remaining=children.slice(),best=1/0,u="slice"===mode?rect.dx:"dice"===mode?rect.dy:"slice-dice"===mode?1&node.depth?rect.dy:rect.dx:Math.min(rect.dx,rect.dy);for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;(n=remaining.length)>0;)row.push(child=remaining[n-1]),row.area+=child.area,"squarify"!==mode||(score=worst(row,u))<=best?(remaining.pop(),best=score):(row.area-=row.pop().area,position(row,u,rect,!1),u=Math.min(rect.dx,rect.dy),row.length=row.area=0,best=1/0);row.length&&(position(row,u,rect,!0),row.length=row.area=0),children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var child,rect=pad(node),remaining=children.slice(),row=[];for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;child=remaining.pop();)row.push(child),row.area+=child.area,null!=child.z&&(position(row,child.z?rect.dx:rect.dy,rect,!remaining.length),row.length=row.area=0);children.forEach(stickify)}}function worst(row,u){for(var r,s=row.area,rmax=0,rmin=1/0,i=-1,n=row.length;++i<n;)(r=row[i].area)&&(r<rmin&&(rmin=r),r>rmax&&(rmax=r));return u*=u,(s*=s)?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):1/0}function position(row,u,rect,flush){var o,i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0;if(u==rect.dx){for((flush||v>rect.dy)&&(v=rect.dy);++i<n;)(o=row[i]).x=x,o.y=y,o.dy=v,x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);o.z=!0,o.dx+=rect.x+rect.dx-x,rect.y+=v,rect.dy-=v}else{for((flush||v>rect.dx)&&(v=rect.dx);++i<n;)(o=row[i]).x=x,o.y=y,o.dx=v,y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);o.z=!1,o.dy+=rect.y+rect.dy-y,rect.x+=v,rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];return root.x=root.y=0,root.value?(root.dx=size[0],root.dy=size[1]):root.dx=root.dy=0,stickies&&hierarchy.revalue(root),scale([root],root.dx*root.dy/root.value),(stickies?stickify:squarify)(root),sticky&&(stickies=nodes),nodes}return treemap.size=function(x){return arguments.length?(size=x,treemap):size},treemap.padding=function(x){if(!arguments.length)return padding;function padConstant(node){return d3_layout_treemapPad(node,x)}var type;return pad=null==(padding=x)?d3_layout_treemapPadNull:"function"==(type=typeof x)?function padFunction(node){var p=x.call(treemap,node,node.depth);return null==p?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,"number"==typeof p?[p,p,p,p]:p)}:"number"===type?(x=[x,x,x,x],padConstant):padConstant,treemap},treemap.round=function(x){return arguments.length?(round=x?Math.round:Number,treemap):round!=Number},treemap.sticky=function(x){return arguments.length?(sticky=x,stickies=null,treemap):sticky},treemap.ratio=function(x){return arguments.length?(ratio=x,treemap):ratio},treemap.mode=function(x){return arguments.length?(mode=x+"",treemap):mode},d3_layout_hierarchyRebind(treemap,hierarchy)},d3.random={normal:function(,){var n=arguments.length;return n<2&&(=1),n<1&&(=0),function(){var x,y,r;do{r=(x=2*Math.random()-1)*x+(y=2*Math.random()-1)*y}while(!r||r>1);return +*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s}}},d3.scale={};var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;for(domain[k]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++j<=k;)u.push(uninterpolate(domain[j-1],domain[j])),i.push(interpolate(range[j-1],range[j]));return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),domain}function d3_scale_linearTickRange(domain,m){null==m&&(m=10);var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;return err<=.15?step*=10:err<=.35?step*=5:err<=.75&&(step*=2),extent[0]=Math.ceil(extent[0]/step)*step,extent[1]=Math.floor(extent[1]/step)*step+.5*step,extent[2]=step,extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);if(match.shift(),"s"===match[8]){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));return match[7]||(match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]))),match[8]="f",format=d3.format(match.join("")),function(d){return format(prefix.scale(d))+prefix.symbol}}match[7]||(match[7]="."+function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +("e"!==type):p-2*("%"===type)}(match[8],range)),format=match.join("")}else format=",."+d3_scale_linearPrecision(range[2])+"f";return d3.format(format)}d3.scale.linear=function(){return function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;return output=linear(domain,range,uninterpolate,interpolate),input=linear(range,domain,uninterpolate,d3_interpolate),scale}function scale(x){return output(x)}scale.invert=function(y){return input(y)};scale.domain=function(x){return arguments.length?(domain=x.map(Number),rescale()):domain};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){return arguments.length?(clamp=x,rescale()):clamp};scale.interpolate=function(x){return arguments.length?(interpolate=x,rescale()):interpolate};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return d3_scale_linearNice(domain,m),rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}([0,1],[0,1],d3_interpolate,!1)};var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}d3.scale.log=function(){return function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){return arguments.length?(positive=x[0]>=0,linear.domain((domain=x.map(Number)).map(log)),scale):domain};scale.base=function(_){return arguments.length?(base=+_,linear.domain(domain.map(log)),scale):base};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);return linear.domain(niced),domain=niced.map(pow),scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else for(ticks.push(pow(i));i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);for(i=0;ticks[i]<u;i++);for(j=ticks.length;ticks[j-1]>v;j--);ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;arguments.length<2?format=d3_scale_logFormat:"function"!=typeof format&&(format=d3.format(format));var k=Math.max(1,base*n/scale.ticks().length);return function(d){var i=d/pow(Math.round(log(d)));return i*base<base-.5&&(i*=base),i<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}(d3.scale.linear().domain([0,1]),10,!0,[1,10])};var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}d3.scale.pow=function(){return function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x))}scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){return arguments.length?(linear.domain((domain=x.map(Number)).map(powp)),scale):domain};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){return arguments.length?(powp=d3_scale_powPow(exponent=x),powb=d3_scale_powPow(1/exponent),linear.domain(domain.map(powp)),scale):exponent};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}(d3.scale.linear(),1,[0,1])},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||("range"===ranger.t?index.set(x,domain.push(x)):NaN))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}scale.domain=function(x){if(!arguments.length)return domain;domain=[],index=new d3_Map;for(var xi,i=-1,n=x.length;++i<n;)index.has(xi=x[i])||index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){return arguments.length?(range=x,rangeBand=0,ranger={t:"range",a:arguments},scale):range};scale.rangePoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);return range=steps(start+step*padding/2,step),rangeBand=0,ranger={t:"rangePoints",a:arguments},scale};scale.rangeRoundPoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;return range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step),rangeBand=0,ranger={t:"rangeRoundPoints",a:arguments},scale};scale.rangeBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);return range=steps(start+step*outerPadding,step),reverse&&range.reverse(),rangeBand=step*(1-padding),ranger={t:"rangeBands",a:arguments},scale};scale.rangeRoundBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));return range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step),reverse&&range.reverse(),rangeBand=Math.round(step*(1-padding)),ranger={t:"rangeRoundBands",a:arguments},scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}([],{t:"range",a:[[]]})},d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)},d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)},d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)},d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString),d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString),d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString),d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);function d3_zero(){return 0}d3.scale.quantile=function(){return function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;for(thresholds=[];++k<q;)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}scale.domain=function(x){return arguments.length?(domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending),rescale()):domain};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){return(y=range.indexOf(y))<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}([],[])},d3.scale.quantize=function(){return function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){return kx=range.length/(x1-x0),i=range.length-1,scale}scale.domain=function(x){return arguments.length?(x0=+x[0],x1=+x[x.length-1],rescale()):[x0,x1]};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.invertExtent=function(y){return[y=(y=range.indexOf(y))<0?NaN:y/kx+x0,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}(0,1,[0,1])},d3.scale.threshold=function(){return function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}scale.domain=function(_){return arguments.length?(domain=_,scale):domain};scale.range=function(_){return arguments.length?(range=_,scale):range};scale.invertExtent=function(y){return y=range.indexOf(y),[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}([.5],[0,1])},d3.scale.identity=function(){return function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){return arguments.length?(domain=x.map(identity),identity):domain};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}([0,1])},d3.svg={},d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-half,a1=endAngle.apply(this,arguments)-half,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0&&(rc=r1,r1=r0,r0=rc),da>=)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,x0,y0,x1,y1,x2,y2,x3,y3,p0=0,p1=0,path=[];if((ap=(+padAngle.apply(this,arguments)||0)/2)&&(rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments),cw||(p1*=-1),r1&&(p1=d3_asin(rp/r1*Math.sin(ap))),r0&&(p0=d3_asin(rp/r0*Math.sin(ap)))),r1){x0=r1*Math.cos(a0+p1),y0=r1*Math.sin(a0+p1),x1=r1*Math.cos(a1-p1),y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1),y0=r1*Math.sin(h1),x1=y1=null}}else x0=y0=0;if(r0){x2=r0*Math.cos(a1-p0),y2=r0*Math.sin(a1-p0),x3=r0*Math.cos(a0+p0),y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0),y2=r0*Math.sin(h0),x3=y3=null}}else x2=y2=0;if(da>&&(rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var rc1=rc,rc0=rc;if(da<){var oc=null==x3?[x2,y2]:null==x1?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=Math.min(rc,(r0-lc)/(kc-1)),rc1=Math.min(rc,(r1-lc)/(kc+1))}if(null!=x1){var t30=d3_svg_arcCornerTangents(null==x3?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);rc===rc1?path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0]):path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0])}else path.push("M",x0,",",y0);if(null!=x3){var t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],null==x1?[x0,y0]:[x1,y1],r0,-rc0,cw);rc===rc0?path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]):path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}else path.push("L",x2,",",y2)}else path.push("M",x0,",",y0),null!=x1&&path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1),path.push("L",x2,",",y2),null!=x3&&path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3);return path.push("Z"),path.join("")}function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1}return arc.innerRadius=function(v){return arguments.length?(innerRadius=d3_functor(v),arc):innerRadius},arc.outerRadius=function(v){return arguments.length?(outerRadius=d3_functor(v),arc):outerRadius},arc.cornerRadius=function(v){return arguments.length?(cornerRadius=d3_functor(v),arc):cornerRadius},arc.padRadius=function(v){return arguments.length?(padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v),arc):padRadius},arc.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),arc):startAngle},arc.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),arc):endAngle},arc.padAngle=function(v){return arguments.length?(padAngle=d3_functor(v),arc):padAngle},arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-half;return[Math.cos(a)*r,Math.sin(a)*r]},arc};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_arcPadAngle(d){return d&&d.padAngle}function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1}function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(Math.max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]]}function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var d,segments=[],points=[],i=-1,n=data.length,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension))}for(;++i<n;)defined.call(this,d=data[i],i)?points.push([+fx.call(this,d,i),+fy.call(this,d,i)]):points.length&&(segment(),points=[]);return points.length&&segment(),segments.length?segments.join(""):null}return line.x=function(_){return arguments.length?(x=_,line):x},line.y=function(_){return arguments.length?(y=_,line):y},line.defined=function(_){return arguments.length?(defined=_,line):defined},line.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,line):interpolateKey},line.tension=function(_){return arguments.length?(tension=_,line):tension},line}d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];for(;++i<n;)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);n>1&&path.push("H",p[0]);return path.join("")},"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var pi,path=[],i=-1,n=points.length,px=[0],py=[0];for(;++i<3;)pi=points[i],px.push(pi[0]),py.push(pi[1]);path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)),--i;for(;++i<n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")},"basis-closed":function d3_svg_lineBasisClosed(points){var path,pi,i=-1,n=points.length,m=n+4,px=[],py=[];for(;++i<4;)pi=points[i%n],px.push(pi[0]),py.push(pi[1]);path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)],--i;for(;++i<m;)pi=points[i%n],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")},bundle:function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n)for(var p,t,x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1;++i<=n;)p=points[i],t=i/n,p[0]=tension*p[0]+(1-tension)*(x0+t*dx),p[1]=tension*p[1]+(1-tension)*(y0+t*dy);return d3_svg_lineBasis(points)},cardinal:function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))},"cardinal-open":function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension))},"cardinal-closed":function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinearClosed(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))},monotone:function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,function d3_svg_lineMonotoneTangents(points){var d,a,b,s,tangents=[],m=function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);for(;++i<j;)m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;return m[i]=d,m}(points),i=-1,j=points.length-1;for(;++i<j;)d=d3_svg_lineSlope(points[i],points[i+1]),abs(d)<?m[i]=m[i+1]=0:(a=m[i]/d,b=m[i+1]/d,(s=a*a+b*b)>9&&(s=3*d/Math.sqrt(s),m[i]=s*a,m[i+1]=s*b));i=-1;for(;++i<=j;)s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i])),tangents.push([s||0,m[i]*s||0]);return tangents}(points))}});function d3_svg_lineLinear(points){return points.length>1?points.join("L"):points+"Z"}function d3_svg_lineLinearClosed(points){return points.join("L")+"Z"}function d3_svg_lineStepBefore(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2)return d3_svg_lineLinear(points);var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad&&(path+="Q"+(p[0]-2*t0[0]/3)+","+(p[1]-2*t0[1]/3)+","+p[0]+","+p[1],p0=points[1],pi=2),tangents.length>1){t=tangents[1],p=points[pi],pi++,path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++)p=points[pi],t=tangents[i],path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}if(quad){var lp=points[pi];path+="Q"+(p[0]+2*t[0]/3)+","+(p[1]+2*t[1]/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){for(var p0,tangents=[],a=(1-tension)/2,p1=points[0],p2=points[1],i=1,n=points.length;++i<n;)p0=p1,p1=p2,p2=points[i],tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];for(points.push(points[n-1]);++i<=n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return points.pop(),path.push("L",pi),path.join("")}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}d3_svg_lineInterpolators.forEach(function(key,value){value.key=key,value.closed=/-closed$/.test(key)});var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineRadial(points){for(var point,r,a,i=-1,n=points.length;++i<n;)r=(point=points[i])[0],a=point[1]-half,point[0]=r*Math.cos(a),point[1]=r*Math.sin(a);return points}function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var d,x,y,segments=[],points0=[],points1=[],i=-1,n=data.length,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1);function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}for(;++i<n;)defined.call(this,d=data[i],i)?(points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]),points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])):points0.length&&(segment(),points0=[],points1=[]);return points0.length&&segment(),segments.length?segments.join(""):null}return area.x=function(_){return arguments.length?(x0=x1=_,area):x1},area.x0=function(_){return arguments.length?(x0=_,area):x0},area.x1=function(_){return arguments.length?(x1=_,area):x1},area.y=function(_){return arguments.length?(y0=y1=_,area):y1},area.y0=function(_){return arguments.length?(y0=_,area):y0},area.y1=function(_){return arguments.length?(y1=_,area):y1},area.defined=function(_){return arguments.length?(defined=_,area):defined},area.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,interpolateReverse=interpolate.reverse||interpolate,L=interpolate.closed?"M":"L",area):interpolateKey},area.tension=function(_){return arguments.length?(tension=_,area):tension},area}function d3_svg_chordRadius(d){return d.radius}function d3_svg_diagonalProjection(d){return[d.x,d.y]}function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);return line.radius=line.x,delete line.x,line.angle=line.y,delete line.y,line},d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter,d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore,d3.svg.area=function(){return d3_svg_area(d3_identity)},d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);return area.radius=area.x,delete area.x,area.innerRadius=area.x0,delete area.x0,area.outerRadius=area.x1,delete area.x1,area.angle=area.y,delete area.y,area.startAngle=area.y0,delete area.y0,area.endAngle=area.y1,delete area.y1,area},d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-half,a1=endAngle.call(self,subgroup,i)-half;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}return chord.radius=function(v){return arguments.length?(radius=d3_functor(v),chord):radius},chord.source=function(v){return arguments.length?(source=d3_functor(v),chord):source},chord.target=function(v){return arguments.length?(target=d3_functor(v),chord):target},chord.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),chord):startAngle},chord.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),chord):endAngle},chord},d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];return"M"+(p=p.map(projection))[0]+"C"+p[1]+" "+p[2]+" "+p[3]}return diagonal.source=function(x){return arguments.length?(source=d3_functor(x),diagonal):source},diagonal.target=function(x){return arguments.length?(target=d3_functor(x),diagonal):target},diagonal.projection=function(x){return arguments.length?(projection=x,diagonal):projection},diagonal},d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;return diagonal.projection=function(x){return arguments.length?projection_(function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-half;return[r*Math.cos(a),r*Math.sin(a)]}}(projection=x)):projection},diagonal},d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}return symbol.type=function(x){return arguments.length?(type=d3_functor(x),symbol):type},symbol.size=function(x){return arguments.length?(size=d3_functor(x),symbol):size},symbol};var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0 0,"+ry+" "+-rx+",0Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){for(var subgroup,node,id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250},j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&d3_transitionNode(node,i,ns,id,transition),subgroup.push(node)}return d3_transition(subgroups,ns,id)},d3_selectionPrototype.interrupt=function(name){return this.each(null==name?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)))};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,activeId,active;(lock=this[ns])&&(active=lock[activeId=lock.active])&&(active.timer.c=null,active.timer.t=NaN,--lock.count?delete lock[activeId]:delete this[ns],lock.active+=.5,active.event&&active.event.interrupt.call(this,this.__data__,active.index))}}function d3_transition(groups,ns,id){return d3_subclass(groups,d3_transitionPrototype),groups.namespace=ns,groups.id=id,groups}var d3_transitionInheritId,d3_transitionInherit,d3_transitionPrototype=[],d3_transitionId=0;function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,"function"==typeof value?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node[ns][id].tween.set(name,value)}))}function d3_transition_text(b){return null==b&&(b=""),function(){this.textContent=b}}function d3_transitionNamespace(name){return null==name?"__transition__":"__transition_"+name+"__"}function d3_transitionNode(node,i,ns,id,inherit){var time,timer,duration,ease,tweens,lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];function start(elapsed){var activeId=lock.active,active=lock[activeId];for(var cancelId in active&&(active.timer.c=null,active.timer.t=NaN,--lock.count,delete lock[activeId],active.event&&active.event.interrupt.call(node,node.__data__,active.index)),lock)if(+cancelId<id){var cancel=lock[cancelId];cancel.timer.c=null,cancel.timer.t=NaN,--lock.count,delete lock[cancelId]}timer.c=tick,d3_timer(function(){return timer.c&&tick(elapsed||1)&&(timer.c=null,timer.t=NaN),1},0,time),lock.active=id,transition.event&&transition.event.start.call(node,node.__data__,i),tweens=[],transition.tween.forEach(function(key,value){(value=value.call(node,node.__data__,i))&&tweens.push(value)}),ease=transition.ease,duration=transition.duration}function tick(elapsed){for(var t=elapsed/duration,e=ease(t),n=tweens.length;n>0;)tweens[--n].call(node,e);if(t>=1)return transition.event&&transition.event.end.call(node,node.__data__,i),--lock.count?delete lock[id]:delete node[ns],1}transition||(time=inherit.time,timer=d3_timer(function schedule(elapsed){var delay=transition.delay;if(timer.t=delay+time,delay<=elapsed)return start(elapsed-delay);timer.c=start},0,time),transition=lock[id]={tween:new d3_Map,time:time,timer:timer,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i},inherit=null,++lock.count)}d3_transitionPrototype.call=d3_selectionPrototype.call,d3_transitionPrototype.empty=d3_selectionPrototype.empty,d3_transitionPrototype.node=d3_selectionPrototype.node,d3_transitionPrototype.size=d3_selectionPrototype.size,d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection)},d3.transition.prototype=d3_transitionPrototype,d3_transitionPrototype.select=function(selector){var subgroup,subnode,node,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))?("__data__"in node&&(subnode.__data__=node.__data__),d3_transitionNode(subnode,i,ns,id,node[ns][id]),subgroup.push(subnode)):subgroup.push(null)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.selectAll=function(selector){var subgroup,subnodes,node,subnode,transition,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)if(node=group[i]){transition=node[ns][id],subnodes=selector.call(node,node.__data__,i,j),subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;)(subnode=subnodes[k])&&d3_transitionNode(subnode,k,ns,id,transition),subgroup.push(subnode)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.filter=function(filter){var subgroup,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group,i=0,n=(group=this[j]).length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_transition(subgroups,this.namespace,this.id)},d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;return arguments.length<2?this.node()[ns][id].tween.get(name):d3_selection_each(this,null==tween?function(node){node[ns][id].tween.remove(name)}:function(node){node[ns][id].tween.set(name,tween)})},d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate="transform"==nameNS?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}return d3_transition_tween(this,"attr."+nameNS,value,name.local?function attrTweenNS(b){return null==b?attrNullNS:(b+="",function(){var i,a=this.getAttributeNS(name.space,name.local);return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}:function attrTween(b){return null==b?attrNull:(b+="",function(){var i,a=this.getAttribute(name);return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})})},d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);return this.tween("attr."+nameNS,name.local?function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}:function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}})},d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if("string"!=typeof name){for(priority in n<2&&(value=""),name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}return d3_transition_tween(this,"style."+name,value,function styleString(b){return null==b?styleNull:(b+="",function(){var i,a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name);return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})})},d3_transitionPrototype.styleTween=function(name,tween,priority){return arguments.length<3&&(priority=""),this.tween("style."+name,function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}})},d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)},d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;this[ns].count<2&&(p=this.parentNode)&&p.removeChild(this)})},d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].ease:("function"!=typeof value&&(value=d3.ease.apply(d3,arguments)),d3_selection_each(this,function(node){node[ns][id].ease=value}))},d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].delay:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node[ns][id].delay=value}))},d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].duration:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node[ns][id].duration=value}))},d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id,d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id],type.call(node,node.__data__,i,j)})}finally{d3_transitionInherit=inherit,d3_transitionInheritId=inheritId}}else d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener)});return this},d3_transitionPrototype.transition=function(){for(var subgroup,node,transition,id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group,i=0,n=(group=this[j]).length;i<n;i++)(node=group[i])&&d3_transitionNode(node,i,ns,id1,{time:(transition=node[ns][id0]).time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration}),subgroup.push(node)}return d3_transition(subgroups,ns,id1)},d3.svg.axis=function(){var tickFormat_,scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null;function axis(g){g.each(function(){var tickTransform,g=d3.select(this),scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy(),ticks=null==tickValues?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=null==tickFormat_?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",),tickExit=d3.transition(tick.exit()).style("opacity",).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line"),tickEnter.append("text");var x1,x2,y1,y2,lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign="top"===orient||"left"===orient?-1:1;if("bottom"===orient||"top"===orient?(tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2",text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle"),pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize)):(tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2",text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start"),pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize)),lineEnter.attr(y2,sign*innerTickSize),textEnter.attr(y1,sign*tickSpacing),lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize),textUpdate.attr(x1,0).attr(y1,sign*tickSpacing),scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else scale0.rangeBand?scale0=scale1:tickExit.call(tickTransform,scale1,scale0);tickEnter.call(tickTransform,scale0,scale1),tickUpdate.call(tickTransform,scale1,scale1)})}return axis.scale=function(x){return arguments.length?(scale=x,axis):scale},axis.orient=function(x){return arguments.length?(orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient,axis):orient},axis.ticks=function(){return arguments.length?(tickArguments_=d3_array(arguments),axis):tickArguments_},axis.tickValues=function(x){return arguments.length?(tickValues=x,axis):tickValues},axis.tickFormat=function(x){return arguments.length?(tickFormat_=x,axis):tickFormat_},axis.tickSize=function(x){var n=arguments.length;return n?(innerTickSize=+x,outerTickSize=+arguments[n-1],axis):innerTickSize},axis.innerTickSize=function(x){return arguments.length?(innerTickSize=+x,axis):innerTickSize},axis.outerTickSize=function(x){return arguments.length?(outerTickSize=+x,axis):outerTickSize},axis.tickPadding=function(x){return arguments.length?(tickPadding=+x,axis):tickPadding},axis.tickSubdivide=function(){return arguments.length&&axis},axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)"})}function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")"})}d3.svg.brush=function(){var xExtentDomain,yExtentDomain,event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xClamp=!0,yClamp=!0,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart),background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove(),resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),resize.style("display",brush.empty()?"none":null);var range,gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background);x&&(range=d3_scaleRange(x),backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]),redrawX(gUpdate)),y&&(range=d3_scaleRange(y),backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]),redrawY(gUpdate)),redraw(gUpdate)})}function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]),g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]),g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){var center,offset,target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),origin=d3.mouse(target),w=d3.select(d3_window(target)).on("keydown.brush",function keydown(){32==d3.event.keyCode&&(dragging||(center=null,origin[0]-=xExtent[1],origin[1]-=yExtent[1],dragging=2),d3_eventPreventDefault())}).on("keyup.brush",function keyup(){32==d3.event.keyCode&&2==dragging&&(origin[0]+=xExtent[1],origin[1]+=yExtent[1],dragging=0,d3_eventPreventDefault())});if(d3.event.changedTouches?w.on("touchmove.brush",brushmove).on("touchend.brush",brushend):w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend),g.interrupt().selectAll("*").interrupt(),dragging)origin[0]=xExtent[0]-origin[0],origin[1]=yExtent[0]-origin[1];else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]],origin[0]=xExtent[ex],origin[1]=yExtent[ey]}else d3.event.altKey&&(center=origin.slice());function brushmove(){var point=d3.mouse(target),moved=!1;offset&&(point[0]+=offset[0],point[1]+=offset[1]),dragging||(d3.event.altKey?(center||(center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2]),origin[0]=xExtent[+(point[0]<center[0])],origin[1]=yExtent[+(point[1]<center[1])]):center=null),resizingX&&move1(point,x,0)&&(redrawX(g),moved=!0),resizingY&&move1(point,y,1)&&(redrawY(g),moved=!0),moved&&(redraw(g),event_({type:"brush",mode:dragging?"move":"resize"}))}function move1(point,scale,i){var min,max,range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0];if(dragging&&(r0-=position,r1-=size+position),min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i],dragging?max=(min+=position)+size:(center&&(position=Math.max(r0,Math.min(r1,2*center[i]-min))),position<min?(max=min,min=position):max=position),extent[0]!=min||extent[1]!=max)return i?yExtentDomain=null:xExtentDomain=null,extent[0]=min,extent[1]=max,!0}function brushend(){brushmove(),g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null),d3.select("body").style("cursor",null),w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),dragRestore(),event_({type:"brushend"})}g.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",eventTarget.style("cursor")),event_({type:"brushstart"}),brushmove()}return brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1,d3_transitionInheritId?d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i,yExtentDomain=extent0.j,xExtent=extent0.x,yExtent=extent0.y,event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);return xExtentDomain=yExtentDomain=null,function(t){xExtent=extent1.x=xi(t),yExtent=extent1.y=yi(t),event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i,yExtentDomain=extent1.j,event_({type:"brush",mode:"resize"}),event_({type:"brushend"})}):(event_({type:"brushstart"}),event_({type:"brush",mode:"resize"}),event_({type:"brushend"}))})},brush.x=function(z){return arguments.length?(resizes=d3_svg_brushResizes[!(x=z)<<1|!y],brush):x},brush.y=function(z){return arguments.length?(resizes=d3_svg_brushResizes[!x<<1|!(y=z)],brush):y},brush.clamp=function(z){return arguments.length?(x&&y?(xClamp=!!z[0],yClamp=!!z[1]):x?xClamp=!!z:y&&(yClamp=!!z),brush):x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null},brush.extent=function(z){var x0,x1,y0,y1,t;return arguments.length?(x&&(x0=z[0],x1=z[1],y&&(x0=x0[0],x1=x1[0]),xExtentDomain=[x0,x1],x.invert&&(x0=x(x0),x1=x(x1)),x1<x0&&(t=x0,x0=x1,x1=t),x0==xExtent[0]&&x1==xExtent[1]||(xExtent=[x0,x1])),y&&(y0=z[0],y1=z[1],x&&(y0=y0[1],y1=y1[1]),yExtentDomain=[y0,y1],y.invert&&(y0=y(y0),y1=y(y1)),y1<y0&&(t=y0,y0=y1,y1=t),y0==yExtent[0]&&y1==yExtent[1]||(yExtent=[y0,y1])),brush):(x&&(xExtentDomain?(x0=xExtentDomain[0],x1=xExtentDomain[1]):(x0=xExtent[0],x1=xExtent[1],x.invert&&(x0=x.invert(x0),x1=x.invert(x1)),x1<x0&&(t=x0,x0=x1,x1=t))),y&&(yExtentDomain?(y0=yExtentDomain[0],y1=yExtentDomain[1]):(y0=yExtent[0],y1=yExtent[1],y.invert&&(y0=y.invert(y0),y1=y.invert(y1)),y1<y0&&(t=y0,y0=y1,y1=t))),x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1])},brush.clear=function(){return brush.empty()||(xExtent=[0,0],yExtent=[0,0],xExtentDomain=yExtentDomain=null),brush},brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]},d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],d3_time_format=d3_time.format=d3_locale_enUS.timeFormat,d3_time_formatUtc=d3_time_format.utc,d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");function d3_time_formatIsoNative(date){return date.toISOString()}function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}function tickMethod(extent,count){var target=(extent[1]-extent[0])/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:i?methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]:[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]}return scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))},scale.domain=function(x){return arguments.length?(linear.domain(x),scale):linear.domain().map(d3_time_scaleDate)},scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=null==interval?tickMethod(extent,10):"number"==typeof interval&&tickMethod(extent,interval);function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}return method&&(interval=method[0],skip=method[1]),scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){for(;skipped(date=interval.floor(date));)date=d3_time_scaleDate(date-1);return date},ceil:function(date){for(;skipped(date=interval.ceil(date));)date=d3_time_scaleDate(+date+1);return date}}:interval))},scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=null==interval?tickMethod(extent,10):"number"==typeof interval?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];return method&&(interval=method[0],skip=method[1]),interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)},scale.tickFormat=function(){return format},scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)},d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso,d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date},d3_time_formatIsoNative.toString=d3_time_formatIso.toString,d3_time.second=d3_time_interval(function(date){return new d3_date(1e3*Math.floor(date/1e3))},function(date,offset){date.setTime(date.getTime()+1e3*Math.floor(offset))},function(date){return date.getSeconds()}),d3_time.seconds=d3_time.second.range,d3_time.seconds.utc=d3_time.second.utc.range,d3_time.minute=d3_time_interval(function(date){return new d3_date(6e4*Math.floor(date/6e4))},function(date,offset){date.setTime(date.getTime()+6e4*Math.floor(offset))},function(date){return date.getMinutes()}),d3_time.minutes=d3_time.minute.range,d3_time.minutes.utc=d3_time.minute.utc.range,d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date(36e5*(Math.floor(date/36e5-timezone)+timezone))},function(date,offset){date.setTime(date.getTime()+36e5*Math.floor(offset))},function(date){return date.getHours()}),d3_time.hours=d3_time.hour.range,d3_time.hours.utc=d3_time.hour.utc.range,d3_time.month=d3_time_interval(function(date){return(date=d3_time.day(date)).setDate(1),date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()}),d3_time.months=d3_time.month.range,d3_time.months.utc=d3_time.month.utc.range;var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]],d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%I:%M",function(d){return d.getMinutes()}],["%I %p",function(d){return d.getHours()}],["%a %d",function(d){return d.getDay()&&1!=d.getDate()}],["%b %d",function(d){return 1!=d.getDate()}],["%B",function(d){return d.getMonth()}],["%Y",d3_true]]),d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate)},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year,d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]}),d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds()}],[":%S",function(d){return d.getUTCSeconds()}],["%I:%M",function(d){return d.getUTCMinutes()}],["%I %p",function(d){return d.getUTCHours()}],["%a %d",function(d){return d.getUTCDay()&&1!=d.getUTCDate()}],["%b %d",function(d){return 1!=d.getUTCDate()}],["%B",function(d){return d.getUTCMonth()}],["%Y",d3_true]]);function d3_json(request){return JSON.parse(request.responseText)}function d3_html(request){var range=d3_document.createRange();return range.selectNode(d3_document.body),range.createContextualFragment(request.responseText)}d3_time_scaleUtcMethods.year=d3_time.year.utc,d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat)},d3.text=d3_xhrType(function(request){return request.responseText}),d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)},d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)},d3.xml=d3_xhrType(function(request){return request.responseXML}),"object"==typeof module&&module.exports?module.exports=d3:this.d3=d3}()},{}],148:[function(_dereq_,module,exports){module.exports=function(){for(var i=0;i<arguments.length;i++)if(void 0!==arguments[i])return arguments[i]}},{}],149:[function(_dereq_,module,exports){"use strict";var ch=_dereq_("incremental-convex-hull"),uniq=_dereq_("uniq");function LiftedPoint(p,i){this.point=p,this.index=i}function compareLifted(a,b){for(var ap=a.point,bp=b.point,d=ap.length,i=0;i<d;++i){var s=bp[i]-ap[i];if(s)return s}return 0}module.exports=function triangulate(points,includePointAtInfinity){var n=points.length;if(0===n)return[];var d=points[0].length;if(d<1)return[];if(1===d)return function triangulate1D(n,points,includePointAtInfinity){if(1===n)return includePointAtInfinity?[[-1,0]]:[];var lifted=points.map(function(p,i){return[p[0],i]});lifted.sort(function(a,b){return a[0]-b[0]});for(var cells=new Array(n-1),i=1;i<n;++i){var a=lifted[i-1],b=lifted[i];cells[i-1]=[a[1],b[1]]}includePointAtInfinity&&cells.push([-1,cells[0][1]],[cells[n-1][1],-1]);return cells}(n,points,includePointAtInfinity);for(var lifted=new Array(n),upper=1,i=0;i<n;++i){for(var p=points[i],x=new Array(d+1),l=0,j=0;j<d;++j){var v=p[j];x[j]=v,l+=v*v}x[d]=l,lifted[i]=new LiftedPoint(x,i),upper=Math.max(l,upper)}uniq(lifted,compareLifted),n=lifted.length;for(var dpoints=new Array(n+d+1),dindex=new Array(n+d+1),u=(d+1)*(d+1)*upper,y=new Array(d+1),i=0;i<=d;++i)y[i]=0;y[d]=u,dpoints[0]=y.slice(),dindex[0]=-1;for(var i=0;i<=d;++i){var x=y.slice();x[i]=1,dpoints[i+1]=x,dindex[i+1]=-1}for(var i=0;i<n;++i){var h=lifted[i];dpoints[i+d+1]=h.point,dindex[i+d+1]=h.index}var hull=ch(dpoints,!1);hull=includePointAtInfinity?hull.filter(function(cell){for(var count=0,j=0;j<=d;++j){var v=dindex[cell[j]];if(v<0&&++count>=2)return!1;cell[j]=v}return!0}):hull.filter(function(cell){for(var i=0;i<=d;++i){var v=dindex[cell[i]];if(v<0)return!1;cell[i]=v}return!0});if(1&d)for(var i=0;i<hull.length;++i){var h=hull[i],x=h[0];h[0]=h[1],h[1]=x}return hull}},{"incremental-convex-hull":394,uniq:521}],150:[function(_dereq_,module,exports){"use strict";module.exports=kerning;var ctx=(kerning.canvas=document.createElement("canvas")).getContext("2d"),asciiPairs=createPairs([32,126]);function kerning(family,o){Array.isArray(family)&&(family=family.join(", "));var pairs,table={},fs=16,threshold=.05;o&&(2===o.length&&"number"==typeof o[0]?pairs=createPairs(o):Array.isArray(o)?pairs=o:(o.o?pairs=createPairs(o.o):o.pairs&&(pairs=o.pairs),o.fontSize&&(fs=o.fontSize),null!=o.threshold&&(threshold=o.threshold))),pairs||(pairs=asciiPairs),ctx.font=fs+"px "+family;for(var i=0;i<pairs.length;i++){var pair=pairs[i],width=ctx.measureText(pair[0]).width+ctx.measureText(pair[1]).width,kerningWidth=ctx.measureText(pair).width;if(Math.abs(width-kerningWidth)>fs*threshold){var emWidth=(kerningWidth-width)/fs;table[pair]=1e3*emWidth}}return table}function createPairs(range){for(var pairs=[],i=range[0];i<=range[1];i++)for(var leftChar=String.fromCharCode(i),j=range[0];j<range[1];j++){var pair=leftChar+String.fromCharCode(j);pairs.push(pair)}return pairs}kerning.createPairs=createPairs,kerning.ascii=asciiPairs},{}],151:[function(_dereq_,module,exports){(function(Buffer){var hasTypedArrays=!1;if("undefined"!=typeof Float64Array){var DOUBLE_VIEW=new Float64Array(1),UINT_VIEW=new Uint32Array(DOUBLE_VIEW.buffer);if(DOUBLE_VIEW[0]=1,hasTypedArrays=!0,1072693248===UINT_VIEW[1]){module.exports=function doubleBitsLE(n){return DOUBLE_VIEW[0]=n,[UINT_VIEW[0],UINT_VIEW[1]]},module.exports.pack=function toDoubleLE(lo,hi){return UINT_VIEW[0]=lo,UINT_VIEW[1]=hi,DOUBLE_VIEW[0]},module.exports.lo=function lowUintLE(n){return DOUBLE_VIEW[0]=n,UINT_VIEW[0]},module.exports.hi=function highUintLE(n){return DOUBLE_VIEW[0]=n,UINT_VIEW[1]}}else if(1072693248===UINT_VIEW[0]){module.exports=function doubleBitsBE(n){return DOUBLE_VIEW[0]=n,[UINT_VIEW[1],UINT_VIEW[0]]},module.exports.pack=function toDoubleBE(lo,hi){return UINT_VIEW[1]=lo,UINT_VIEW[0]=hi,DOUBLE_VIEW[0]},module.exports.lo=function lowUintBE(n){return DOUBLE_VIEW[0]=n,UINT_VIEW[1]},module.exports.hi=function highUintBE(n){return DOUBLE_VIEW[0]=n,UINT_VIEW[0]}}else hasTypedArrays=!1}if(!hasTypedArrays){var buffer=new Buffer(8);module.exports=function doubleBits(n){return buffer.writeDoubleLE(n,0,!0),[buffer.readUInt32LE(0,!0),buffer.readUInt32LE(4,!0)]},module.exports.pack=function toDouble(lo,hi){return buffer.writeUInt32LE(lo,0,!0),buffer.writeUInt32LE(hi,4,!0),buffer.readDoubleLE(0,!0)},module.exports.lo=function lowUint(n){return buffer.writeDoubleLE(n,0,!0),buffer.readUInt32LE(0,!0)},module.exports.hi=function highUint(n){return buffer.writeDoubleLE(n,0,!0),buffer.readUInt32LE(4,!0)}}module.exports.sign=function(n){return module.exports.hi(n)>>>31},module.exports.exponent=function(n){return(module.exports.hi(n)<<1>>>21)-1023},module.exports.fraction=function(n){var lo=module.exports.lo(n),hi=module.exports.hi(n),b=1048575&hi;return 2146435072&hi&&(b+=1<<20),[lo,b]},module.exports.denormalized=function(n){return!(2146435072&module.exports.hi(n))}}).call(this,_dereq_("buffer").Buffer)},{buffer:92}],152:[function(_dereq_,module,exports){var abs=_dereq_("abs-svg-path"),normalize=_dereq_("normalize-svg-path"),methods={M:"moveTo",C:"bezierCurveTo"};module.exports=function(context,segments){context.beginPath(),normalize(abs(segments)).forEach(function(segment){var command=segment[0],args=segment.slice(1);context[methods[command]].apply(context,args)}),context.closePath()}},{"abs-svg-path":47,"normalize-svg-path":432}],153:[function(_dereq_,module,exports){module.exports=function(dtype){switch(dtype){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],154:[function(_dereq_,module,exports){"use strict";module.exports=function dupe(count,value){switch(void 0===value&&(value=0),typeof count){case"number":if(count>0)return function dupe_number(count,value){var result,i;for(result=new Array(count),i=0;i<count;++i)result[i]=value;return result}(0|count,value);break;case"object":if("number"==typeof count.length)return function dupe_array(count,value,i){var c=0|count[i];if(c<=0)return[];var j,result=new Array(c);if(i===count.length-1)for(j=0;j<c;++j)result[j]=value;else for(j=0;j<c;++j)result[j]=dupe_array(count,value,i+1);return result}(count,value,0)}return[]}},{}],155:[function(_dereq_,module,exports){"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;if(hasHoles&&(outerNode=function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,start,end,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,(list=linkedList(data,start,end,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function indexCurve(start,minX,minY,invSize){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize),void earcutLinked(c,triangles,dim,minX,minY,invSize)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m.next;for(;p!==stop;)hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{p.x<leftmost.x&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))||area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}},{}],156:[function(_dereq_,module,exports){"use strict";module.exports=function edgeToAdjacency(edges,numVertices){var numEdges=edges.length;if("number"!=typeof numVertices){numVertices=0;for(var i=0;i<numEdges;++i){var e=edges[i];numVertices=Math.max(numVertices,e[0],e[1])}numVertices=1+(0|numVertices)}numVertices|=0;for(var adj=new Array(numVertices),i=0;i<numVertices;++i)adj[i]=[];for(var i=0;i<numEdges;++i){var e=edges[i];adj[e[0]].push(e[1]),adj[e[1]].push(e[0])}for(var j=0;j<numVertices;++j)uniq(adj[j],function(a,b){return a-b});return adj};var uniq=_dereq_("uniq")},{uniq:521}],157:[function(_dereq_,module,exports){"use strict";var value=_dereq_("../../object/valid-value");module.exports=function(){return value(this).length=0,this}},{"../../object/valid-value":189}],158:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Array.from:_dereq_("./shim")},{"./is-implemented":159,"./shim":160}],159:[function(_dereq_,module,exports){"use strict";module.exports=function(){var arr,result,from=Array.from;return"function"==typeof from&&(result=from(arr=["raz","dwa"]),Boolean(result&&result!==arr&&"dwa"===result[1]))}},{}],160:[function(_dereq_,module,exports){"use strict";var iteratorSymbol=_dereq_("es6-symbol").iterator,isArguments=_dereq_("../../function/is-arguments"),isFunction=_dereq_("../../function/is-function"),toPosInt=_dereq_("../../number/to-pos-integer"),callable=_dereq_("../../object/valid-callable"),validValue=_dereq_("../../object/valid-value"),isValue=_dereq_("../../object/is-value"),isString=_dereq_("../../string/is-string"),isArray=Array.isArray,call=Function.prototype.call,desc={configurable:!0,enumerable:!0,writable:!0,value:null},defineProperty=Object.defineProperty;module.exports=function(arrayLike){var Context,i,j,arr,length,code,iterator,result,getIterator,value,mapFn=arguments[1],thisArg=arguments[2];if(arrayLike=Object(validValue(arrayLike)),isValue(mapFn)&&callable(mapFn),this&&this!==Array&&isFunction(this))Context=this;else{if(!mapFn){if(isArguments(arrayLike))return 1!==(length=arrayLike.length)?Array.apply(null,arrayLike):((arr=new Array(1))[0]=arrayLike[0],arr);if(isArray(arrayLike)){for(arr=new Array(length=arrayLike.length),i=0;i<length;++i)arr[i]=arrayLike[i];return arr}}arr=[]}if(!isArray(arrayLike))if(void 0!==(getIterator=arrayLike[iteratorSymbol])){for(iterator=callable(getIterator).call(arrayLike),Context&&(arr=new Context),result=iterator.next(),i=0;!result.done;)value=mapFn?call.call(mapFn,thisArg,result.value,i):result.value,Context?(desc.value=value,defineProperty(arr,i,desc)):arr[i]=value,result=iterator.next(),++i;length=i}else if(isString(arrayLike)){for(length=arrayLike.length,Context&&(arr=new Context),i=0,j=0;i<length;++i)value=arrayLike[i],i+1<length&&(code=value.charCodeAt(0))>=55296&&code<=56319&&(value+=arrayLike[++i]),value=mapFn?call.call(mapFn,thisArg,value,j):value,Context?(desc.value=value,defineProperty(arr,j,desc)):arr[j]=value,++j;length=j}if(void 0===length)for(length=toPosInt(arrayLike.length),Context&&(arr=new Context(length)),i=0;i<length;++i)value=mapFn?call.call(mapFn,thisArg,arrayLike[i],i):arrayLike[i],Context?(desc.value=value,defineProperty(arr,i,desc)):arr[i]=value;return Context&&(desc.value=null,arr.length=length),arr}},{"../../function/is-arguments":161,"../../function/is-function":162,"../../number/to-pos-integer":168,"../../object/is-value":178,"../../object/valid-callable":187,"../../object/valid-value":189,"../../string/is-string":193,"es6-symbol":203}],161:[function(_dereq_,module,exports){"use strict";var objToString=Object.prototype.toString,id=objToString.call(function(){return arguments}());module.exports=function(value){return objToString.call(value)===id}},{}],162:[function(_dereq_,module,exports){"use strict";var objToString=Object.prototype.toString,id=objToString.call(_dereq_("./noop"));module.exports=function(value){return"function"==typeof value&&objToString.call(value)===id}},{"./noop":163}],163:[function(_dereq_,module,exports){"use strict";module.exports=function(){}},{}],164:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Math.sign:_dereq_("./shim")},{"./is-implemented":165,"./shim":166}],165:[function(_dereq_,module,exports){"use strict";module.exports=function(){var sign=Math.sign;return"function"==typeof sign&&(1===sign(10)&&-1===sign(-20))}},{}],166:[function(_dereq_,module,exports){"use strict";module.exports=function(value){return value=Number(value),isNaN(value)||0===value?value:value>0?1:-1}},{}],167:[function(_dereq_,module,exports){"use strict";var sign=_dereq_("../math/sign"),abs=Math.abs,floor=Math.floor;module.exports=function(value){return isNaN(value)?0:0!==(value=Number(value))&&isFinite(value)?sign(value)*floor(abs(value)):value}},{"../math/sign":164}],168:[function(_dereq_,module,exports){"use strict";var toInteger=_dereq_("./to-integer"),max=Math.max;module.exports=function(value){return max(0,toInteger(value))}},{"./to-integer":167}],169:[function(_dereq_,module,exports){"use strict";var callable=_dereq_("./valid-callable"),value=_dereq_("./valid-value"),bind=Function.prototype.bind,call=Function.prototype.call,keys=Object.keys,objPropertyIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=function(method,defVal){return function(obj,cb){var list,thisArg=arguments[2],compareFn=arguments[3];return obj=Object(value(obj)),callable(cb),list=keys(obj),compareFn&&list.sort("function"==typeof compareFn?bind.call(compareFn,obj):void 0),"function"!=typeof method&&(method=list[method]),call.call(method,list,function(key,index){return objPropertyIsEnumerable.call(obj,key)?call.call(cb,thisArg,obj[key],key,obj,index):defVal})}}},{"./valid-callable":187,"./valid-value":189}],170:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Object.assign:_dereq_("./shim")},{"./is-implemented":171,"./shim":172}],171:[function(_dereq_,module,exports){"use strict";module.exports=function(){var obj,assign=Object.assign;return"function"==typeof assign&&(assign(obj={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),obj.foo+obj.bar+obj.trzy==="razdwatrzy")}},{}],172:[function(_dereq_,module,exports){"use strict";var keys=_dereq_("../keys"),value=_dereq_("../valid-value"),max=Math.max;module.exports=function(dest,src){var error,i,assign,length=max(arguments.length,2);for(dest=Object(value(dest)),assign=function(key){try{dest[key]=src[key]}catch(e){error||(error=e)}},i=1;i<length;++i)src=arguments[i],keys(src).forEach(assign);if(void 0!==error)throw error;return dest}},{"../keys":179,"../valid-value":189}],173:[function(_dereq_,module,exports){"use strict";var aFrom=_dereq_("../array/from"),assign=_dereq_("./assign"),value=_dereq_("./valid-value");module.exports=function(obj){var copy=Object(value(obj)),propertyNames=arguments[1],options=Object(arguments[2]);if(copy!==obj&&!propertyNames)return copy;var result={};return propertyNames?aFrom(propertyNames,function(propertyName){(options.ensure||propertyName in obj)&&(result[propertyName]=obj[propertyName])}):assign(result,obj),result}},{"../array/from":158,"./assign":170,"./valid-value":189}],174:[function(_dereq_,module,exports){"use strict";var shim,nullObject,polyProps,desc,create=Object.create;_dereq_("./set-prototype-of/is-implemented")()||(shim=_dereq_("./set-prototype-of/shim")),module.exports=shim?1!==shim.level?create:(nullObject={},polyProps={},desc={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(name){polyProps[name]="__proto__"!==name?desc:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(nullObject,polyProps),Object.defineProperty(shim,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:nullObject}),function(prototype,props){return create(null===prototype?nullObject:prototype,props)}):create},{"./set-prototype-of/is-implemented":185,"./set-prototype-of/shim":186}],175:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./_iterate")("forEach")},{"./_iterate":169}],176:[function(_dereq_,module,exports){"use strict";module.exports=function(obj){return"function"==typeof obj}},{}],177:[function(_dereq_,module,exports){"use strict";var isValue=_dereq_("./is-value"),map={function:!0,object:!0};module.exports=function(value){return isValue(value)&&map[typeof value]||!1}},{"./is-value":178}],178:[function(_dereq_,module,exports){"use strict";var _undefined=_dereq_("../function/noop")();module.exports=function(val){return val!==_undefined&&null!==val}},{"../function/noop":163}],179:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Object.keys:_dereq_("./shim")},{"./is-implemented":180,"./shim":181}],180:[function(_dereq_,module,exports){"use strict";module.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],181:[function(_dereq_,module,exports){"use strict";var isValue=_dereq_("../is-value"),keys=Object.keys;module.exports=function(object){return keys(isValue(object)?Object(object):object)}},{"../is-value":178}],182:[function(_dereq_,module,exports){"use strict";var callable=_dereq_("./valid-callable"),forEach=_dereq_("./for-each"),call=Function.prototype.call;module.exports=function(obj,cb){var result={},thisArg=arguments[2];return callable(cb),forEach(obj,function(value,key,targetObj,index){result[key]=call.call(cb,thisArg,value,key,targetObj,index)}),result}},{"./for-each":175,"./valid-callable":187}],183:[function(_dereq_,module,exports){"use strict";var isValue=_dereq_("./is-value"),forEach=Array.prototype.forEach,create=Object.create;module.exports=function(opts1){var result=create(null);return forEach.call(arguments,function(options){isValue(options)&&function(src,obj){var key;for(key in src)obj[key]=src[key]}(Object(options),result)}),result}},{"./is-value":178}],184:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Object.setPrototypeOf:_dereq_("./shim")},{"./is-implemented":185,"./shim":186}],185:[function(_dereq_,module,exports){"use strict";var create=Object.create,getPrototypeOf=Object.getPrototypeOf,plainObject={};module.exports=function(){var setPrototypeOf=Object.setPrototypeOf,customCreate=arguments[0]||create;return"function"==typeof setPrototypeOf&&getPrototypeOf(setPrototypeOf(customCreate(null),plainObject))===plainObject}},{}],186:[function(_dereq_,module,exports){"use strict";var validate,status,fn,set,isObject=_dereq_("../is-object"),value=_dereq_("../valid-value"),objIsPrototypeOf=Object.prototype.isPrototypeOf,defineProperty=Object.defineProperty,nullDesc={configurable:!0,enumerable:!1,writable:!0,value:void 0};validate=function(obj,prototype){if(value(obj),null===prototype||isObject(prototype))return obj;throw new TypeError("Prototype must be null or an object")},module.exports=(status=function(){var set,tmpObj1=Object.create(null),tmpObj2={},desc=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(desc){try{(set=desc.set).call(tmpObj1,tmpObj2)}catch(ignore){}if(Object.getPrototypeOf(tmpObj1)===tmpObj2)return{set:set,level:2}}return tmpObj1.__proto__=tmpObj2,Object.getPrototypeOf(tmpObj1)===tmpObj2?{level:2}:((tmpObj1={}).__proto__=tmpObj2,Object.getPrototypeOf(tmpObj1)===tmpObj2&&{level:1})}())?(2===status.level?status.set?(set=status.set,fn=function(obj,prototype){return set.call(validate(obj,prototype),prototype),obj}):fn=function(obj,prototype){return validate(obj,prototype).__proto__=prototype,obj}:fn=function self(obj,prototype){var isNullBase;return validate(obj,prototype),(isNullBase=objIsPrototypeOf.call(self.nullPolyfill,obj))&&delete self.nullPolyfill.__proto__,null===prototype&&(prototype=self.nullPolyfill),obj.__proto__=prototype,isNullBase&&defineProperty(self.nullPolyfill,"__proto__",nullDesc),obj},Object.defineProperty(fn,"level",{configurable:!1,enumerable:!1,writable:!1,value:status.level})):null,_dereq_("../create")},{"../create":174,"../is-object":177,"../valid-value":189}],187:[function(_dereq_,module,exports){"use strict";module.exports=function(fn){if("function"!=typeof fn)throw new TypeError(fn+" is not a function");return fn}},{}],188:[function(_dereq_,module,exports){"use strict";var isObject=_dereq_("./is-object");module.exports=function(value){if(!isObject(value))throw new TypeError(value+" is not an Object");return value}},{"./is-object":177}],189:[function(_dereq_,module,exports){"use strict";var isValue=_dereq_("./is-value");module.exports=function(value){if(!isValue(value))throw new TypeError("Cannot use null or undefined");return value}},{"./is-value":178}],190:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?String.prototype.contains:_dereq_("./shim")},{"./is-implemented":191,"./shim":192}],191:[function(_dereq_,module,exports){"use strict";var str="razdwatrzy";module.exports=function(){return"function"==typeof str.contains&&(!0===str.contains("dwa")&&!1===str.contains("foo"))}},{}],192:[function(_dereq_,module,exports){"use strict";var indexOf=String.prototype.indexOf;module.exports=function(searchString){return indexOf.call(this,searchString,arguments[1])>-1}},{}],193:[function(_dereq_,module,exports){"use strict";var objToString=Object.prototype.toString,id=objToString.call("");module.exports=function(value){return"string"==typeof value||value&&"object"==typeof value&&(value instanceof String||objToString.call(value)===id)||!1}},{}],194:[function(_dereq_,module,exports){"use strict";var generated=Object.create(null),random=Math.random;module.exports=function(){var str;do{str=random().toString(36).slice(2)}while(generated[str]);return str}},{}],195:[function(_dereq_,module,exports){"use strict";var ArrayIterator,setPrototypeOf=_dereq_("es5-ext/object/set-prototype-of"),contains=_dereq_("es5-ext/string/#/contains"),d=_dereq_("d"),Symbol=_dereq_("es6-symbol"),Iterator=_dereq_("./"),defineProperty=Object.defineProperty;ArrayIterator=module.exports=function(arr,kind){if(!(this instanceof ArrayIterator))throw new TypeError("Constructor requires 'new'");Iterator.call(this,arr),kind=kind?contains.call(kind,"key+value")?"key+value":contains.call(kind,"key")?"key":"value":"value",defineProperty(this,"__kind__",d("",kind))},setPrototypeOf&&setPrototypeOf(ArrayIterator,Iterator),delete ArrayIterator.prototype.constructor,ArrayIterator.prototype=Object.create(Iterator.prototype,{_resolve:d(function(i){return"value"===this.__kind__?this.__list__[i]:"key+value"===this.__kind__?[i,this.__list__[i]]:i})}),defineProperty(ArrayIterator.prototype,Symbol.toStringTag,d("c","Array Iterator"))},{"./":198,d:138,"es5-ext/object/set-prototype-of":184,"es5-ext/string/#/contains":190,"es6-symbol":203}],196:[function(_dereq_,module,exports){"use strict";var isArguments=_dereq_("es5-ext/function/is-arguments"),callable=_dereq_("es5-ext/object/valid-callable"),isString=_dereq_("es5-ext/string/is-string"),get=_dereq_("./get"),isArray=Array.isArray,call=Function.prototype.call,some=Array.prototype.some;module.exports=function(iterable,cb){var mode,result,doBreak,broken,i,length,char,code,thisArg=arguments[2];if(isArray(iterable)||isArguments(iterable)?mode="array":isString(iterable)?mode="string":iterable=get(iterable),callable(cb),doBreak=function(){broken=!0},"array"!==mode)if("string"!==mode)for(result=iterable.next();!result.done;){if(call.call(cb,thisArg,result.value,doBreak),broken)return;result=iterable.next()}else for(length=iterable.length,i=0;i<length&&(char=iterable[i],i+1<length&&(code=char.charCodeAt(0))>=55296&&code<=56319&&(char+=iterable[++i]),call.call(cb,thisArg,char,doBreak),!broken);++i);else some.call(iterable,function(value){return call.call(cb,thisArg,value,doBreak),broken})}},{"./get":197,"es5-ext/function/is-arguments":161,"es5-ext/object/valid-callable":187,"es5-ext/string/is-string":193}],197:[function(_dereq_,module,exports){"use strict";var isArguments=_dereq_("es5-ext/function/is-arguments"),isString=_dereq_("es5-ext/string/is-string"),ArrayIterator=_dereq_("./array"),StringIterator=_dereq_("./string"),iterable=_dereq_("./valid-iterable"),iteratorSymbol=_dereq_("es6-symbol").iterator;module.exports=function(obj){return"function"==typeof iterable(obj)[iteratorSymbol]?obj[iteratorSymbol]():isArguments(obj)?new ArrayIterator(obj):isString(obj)?new StringIterator(obj):new ArrayIterator(obj)}},{"./array":195,"./string":200,"./valid-iterable":201,"es5-ext/function/is-arguments":161,"es5-ext/string/is-string":193,"es6-symbol":203}],198:[function(_dereq_,module,exports){"use strict";var Iterator,clear=_dereq_("es5-ext/array/#/clear"),assign=_dereq_("es5-ext/object/assign"),callable=_dereq_("es5-ext/object/valid-callable"),value=_dereq_("es5-ext/object/valid-value"),d=_dereq_("d"),autoBind=_dereq_("d/auto-bind"),Symbol=_dereq_("es6-symbol"),defineProperty=Object.defineProperty,defineProperties=Object.defineProperties;module.exports=Iterator=function(list,context){if(!(this instanceof Iterator))throw new TypeError("Constructor requires 'new'");defineProperties(this,{__list__:d("w",value(list)),__context__:d("w",context),__nextIndex__:d("w",0)}),context&&(callable(context.on),context.on("_add",this._onAdd),context.on("_delete",this._onDelete),context.on("_clear",this._onClear))},delete Iterator.prototype.constructor,defineProperties(Iterator.prototype,assign({_next:d(function(){var i;if(this.__list__)return this.__redo__&&void 0!==(i=this.__redo__.shift())?i:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:d(function(){return this._createResult(this._next())}),_createResult:d(function(i){return void 0===i?{done:!0,value:void 0}:{done:!1,value:this._resolve(i)}}),_resolve:d(function(i){return this.__list__[i]}),_unBind:d(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:d(function(){return"[object "+(this[Symbol.toStringTag]||"Object")+"]"})},autoBind({_onAdd:d(function(index){index>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(redo,i){redo>=index&&(this.__redo__[i]=++redo)},this),this.__redo__.push(index)):defineProperty(this,"__redo__",d("c",[index])))}),_onDelete:d(function(index){var i;index>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(i=this.__redo__.indexOf(index))&&this.__redo__.splice(i,1),this.__redo__.forEach(function(redo,j){redo>index&&(this.__redo__[j]=--redo)},this)))}),_onClear:d(function(){this.__redo__&&clear.call(this.__redo__),this.__nextIndex__=0})}))),defineProperty(Iterator.prototype,Symbol.iterator,d(function(){return this}))},{d:138,"d/auto-bind":137,"es5-ext/array/#/clear":157,"es5-ext/object/assign":170,"es5-ext/object/valid-callable":187,"es5-ext/object/valid-value":189,"es6-symbol":203}],199:[function(_dereq_,module,exports){"use strict";var isArguments=_dereq_("es5-ext/function/is-arguments"),isValue=_dereq_("es5-ext/object/is-value"),isString=_dereq_("es5-ext/string/is-string"),iteratorSymbol=_dereq_("es6-symbol").iterator,isArray=Array.isArray;module.exports=function(value){return!!isValue(value)&&(!!isArray(value)||(!!isString(value)||(!!isArguments(value)||"function"==typeof value[iteratorSymbol])))}},{"es5-ext/function/is-arguments":161,"es5-ext/object/is-value":178,"es5-ext/string/is-string":193,"es6-symbol":203}],200:[function(_dereq_,module,exports){"use strict";var StringIterator,setPrototypeOf=_dereq_("es5-ext/object/set-prototype-of"),d=_dereq_("d"),Symbol=_dereq_("es6-symbol"),Iterator=_dereq_("./"),defineProperty=Object.defineProperty;StringIterator=module.exports=function(str){if(!(this instanceof StringIterator))throw new TypeError("Constructor requires 'new'");str=String(str),Iterator.call(this,str),defineProperty(this,"__length__",d("",str.length))},setPrototypeOf&&setPrototypeOf(StringIterator,Iterator),delete StringIterator.prototype.constructor,StringIterator.prototype=Object.create(Iterator.prototype,{_next:d(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:d(function(i){var code,char=this.__list__[i];return this.__nextIndex__===this.__length__?char:(code=char.charCodeAt(0))>=55296&&code<=56319?char+this.__list__[this.__nextIndex__++]:char})}),defineProperty(StringIterator.prototype,Symbol.toStringTag,d("c","String Iterator"))},{"./":198,d:138,"es5-ext/object/set-prototype-of":184,"es6-symbol":203}],201:[function(_dereq_,module,exports){"use strict";var isIterable=_dereq_("./is-iterable");module.exports=function(value){if(!isIterable(value))throw new TypeError(value+" is not iterable");return value}},{"./is-iterable":199}],202:[function(_dereq_,module,exports){(function(process,global){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():global.ES6Promise=factory()}(this,function(){"use strict";function isFunction(x){return"function"==typeof x}var isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)},len=0,vertxNext=void 0,customSchedulerFn=void 0,asap=function asap(callback,arg){queue[len]=callback,queue[len+1]=arg,2===(len+=2)&&(customSchedulerFn?customSchedulerFn(flush):scheduleFlush())};var browserWindow="undefined"!=typeof window?window:void 0,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode="undefined"==typeof self&&void 0!==process&&"[object process]"==={}.toString.call(process),isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){(0,queue[i])(queue[i+1]),queue[i]=void 0,queue[i+1]=void 0}len=0}var scheduleFlush=void 0;function then(onFulfillment,onRejection){var _arguments=arguments,parent=this,child=new this.constructor(noop);void 0===child[PROMISE_ID]&&makePromise(child);var callback,_state=parent._state;return _state?(callback=_arguments[_state-1],asap(function(){return invokeCallback(_state,child,callback,parent._result)})):subscribe(parent,child,onFulfillment,onRejection),child}function resolve(object){if(object&&"object"==typeof object&&object.constructor===this)return object;var promise=new this(noop);return _resolve(promise,object),promise}scheduleFlush=isNode?function useNextTick(){return function(){return process.nextTick(flush)}}():BrowserMutationObserver?function useMutationObserver(){var iterations=0,observer=new BrowserMutationObserver(flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}():isWorker?function useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=flush,function(){return channel.port2.postMessage(0)}}():void 0===browserWindow&&"function"==typeof _dereq_?function attemptVertx(){try{var vertx=_dereq_("vertx");return vertxNext=vertx.runOnLoop||vertx.runOnContext,function useVertxTimer(){return function(){vertxNext(flush)}}()}catch(e){return useSetTimeout()}}():useSetTimeout();var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0,FULFILLED=1,REJECTED=2,GET_THEN_ERROR=new ErrorObject;function getThen(promise){try{return promise.then}catch(error){return GET_THEN_ERROR.error=error,GET_THEN_ERROR}}function handleMaybeThenable(promise,maybeThenable,then$$){maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve?function handleOwnThenable(promise,thenable){thenable._state===FULFILLED?fulfill(promise,thenable._result):thenable._state===REJECTED?_reject(promise,thenable._result):subscribe(thenable,void 0,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}(promise,maybeThenable):then$$===GET_THEN_ERROR?_reject(promise,GET_THEN_ERROR.error):void 0===then$$?fulfill(promise,maybeThenable):isFunction(then$$)?function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=!1,error=function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?_resolve(promise,value):fulfill(promise,value))},function(reason){sealed||(sealed=!0,_reject(promise,reason))},promise._label);!sealed&&error&&(sealed=!0,_reject(promise,error))},promise)}(promise,maybeThenable,then$$):fulfill(promise,maybeThenable)}function _resolve(promise,value){promise===value?_reject(promise,function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}()):!function objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}(value)?fulfill(promise,value):handleMaybeThenable(promise,value,getThen(value))}function publishRejection(promise){promise._onerror&&promise._onerror(promise._result),publish(promise)}function fulfill(promise,value){promise._state===PENDING&&(promise._result=value,promise._state=FULFILLED,0!==promise._subscribers.length&&asap(publish,promise))}function _reject(promise,reason){promise._state===PENDING&&(promise._state=REJECTED,promise._result=reason,asap(publishRejection,promise))}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers,length=_subscribers.length;parent._onerror=null,_subscribers[length]=child,_subscribers[length+FULFILLED]=onFulfillment,_subscribers[length+REJECTED]=onRejection,0===length&&parent._state&&asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child=void 0,callback=void 0,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){if((value=function tryCatch(callback,detail){try{return callback(detail)}catch(e){return TRY_CATCH_ERROR.error=e,TRY_CATCH_ERROR}}(callback,detail))===TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void _reject(promise,function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}())}else value=detail,succeeded=!0;promise._state!==PENDING||(hasCallback&&succeeded?_resolve(promise,value):failed?_reject(promise,error):settled===FULFILLED?fulfill(promise,value):settled===REJECTED&&_reject(promise,value))}var id=0;function makePromise(promise){promise[PROMISE_ID]=id++,promise._state=void 0,promise._result=void 0,promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor,this.promise=new Constructor(noop),this.promise[PROMISE_ID]||makePromise(this.promise),isArray(input)?(this._input=input,this.length=input.length,this._remaining=input.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&fulfill(this.promise,this._result))):_reject(this.promise,function validationError(){return new Error("Array Methods must be provided an Array")}())}function Promise(resolver){this[PROMISE_ID]=function nextId(){return id++}(),this._result=this._state=void 0,this._subscribers=[],noop!==resolver&&("function"!=typeof resolver&&function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof Promise?function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}(this,resolver):function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}function polyfill(){var local=void 0;if(void 0!==global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if("[object Promise]"===promiseToString&&!P.cast)return}local.Promise=Promise}return Enumerator.prototype._enumerate=function(){for(var length=this.length,_input=this._input,i=0;this._state===PENDING&&i<length;i++)this._eachEntry(_input[i],i)},Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor,resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if("function"!=typeof _then)this._remaining--,this._result[i]=entry;else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then),this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}else this._willSettleAt(resolve$$(entry),i)},Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;promise._state===PENDING&&(this._remaining--,state===REJECTED?_reject(promise,value):this._result[i]=value),0===this._remaining&&fulfill(promise,this._result)},Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,void 0,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})},Promise.all=function all(entries){return new Enumerator(this,entries).promise},Promise.race=function race(entries){var Constructor=this;return isArray(entries)?new Constructor(function(resolve,reject){for(var length=entries.length,i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)}):new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})},Promise.resolve=resolve,Promise.reject=function reject(reason){var promise=new this(noop);return _reject(promise,reason),promise},Promise._setScheduler=function setScheduler(scheduleFn){customSchedulerFn=scheduleFn},Promise._setAsap=function setAsap(asapFn){asap=asapFn},Promise._asap=asap,Promise.prototype={constructor:Promise,then:then,catch:function _catch(onRejection){return this.then(null,onRejection)}},polyfill(),Promise.polyfill=polyfill,Promise.Promise=Promise,Promise})}).call(this,_dereq_("_process"),void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:462}],203:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?Symbol:_dereq_("./polyfill")},{"./is-implemented":204,"./polyfill":206}],204:[function(_dereq_,module,exports){"use strict";var validTypes={object:!0,symbol:!0};module.exports=function(){var symbol;if("function"!=typeof Symbol)return!1;symbol=Symbol("test symbol");try{String(symbol)}catch(e){return!1}return!!validTypes[typeof Symbol.iterator]&&(!!validTypes[typeof Symbol.toPrimitive]&&!!validTypes[typeof Symbol.toStringTag])}},{}],205:[function(_dereq_,module,exports){"use strict";module.exports=function(x){return!!x&&("symbol"==typeof x||!!x.constructor&&("Symbol"===x.constructor.name&&"Symbol"===x[x.constructor.toStringTag]))}},{}],206:[function(_dereq_,module,exports){"use strict";var NativeSymbol,SymbolPolyfill,HiddenSymbol,isNativeSafe,d=_dereq_("d"),validateSymbol=_dereq_("./validate-symbol"),create=Object.create,defineProperties=Object.defineProperties,defineProperty=Object.defineProperty,objPrototype=Object.prototype,globalSymbols=create(null);if("function"==typeof Symbol){NativeSymbol=Symbol;try{String(NativeSymbol()),isNativeSafe=!0}catch(ignore){}}var created,generateName=(created=create(null),function(desc){for(var name,ie11BugWorkaround,postfix=0;created[desc+(postfix||"")];)++postfix;return created[desc+=postfix||""]=!0,defineProperty(objPrototype,name="@@"+desc,d.gs(null,function(value){ie11BugWorkaround||(ie11BugWorkaround=!0,defineProperty(this,name,d(value)),ie11BugWorkaround=!1)})),name});HiddenSymbol=function Symbol(description){if(this instanceof HiddenSymbol)throw new TypeError("Symbol is not a constructor");return SymbolPolyfill(description)},module.exports=SymbolPolyfill=function Symbol(description){var symbol;if(this instanceof Symbol)throw new TypeError("Symbol is not a constructor");return isNativeSafe?NativeSymbol(description):(symbol=create(HiddenSymbol.prototype),description=void 0===description?"":String(description),defineProperties(symbol,{__description__:d("",description),__name__:d("",generateName(description))}))},defineProperties(SymbolPolyfill,{for:d(function(key){return globalSymbols[key]?globalSymbols[key]:globalSymbols[key]=SymbolPolyfill(String(key))}),keyFor:d(function(s){var key;for(key in validateSymbol(s),globalSymbols)if(globalSymbols[key]===s)return key}),hasInstance:d("",NativeSymbol&&NativeSymbol.hasInstance||SymbolPolyfill("hasInstance")),isConcatSpreadable:d("",NativeSymbol&&NativeSymbol.isConcatSpreadable||SymbolPolyfill("isConcatSpreadable")),iterator:d("",NativeSymbol&&NativeSymbol.iterator||SymbolPolyfill("iterator")),match:d("",NativeSymbol&&NativeSymbol.match||SymbolPolyfill("match")),replace:d("",NativeSymbol&&NativeSymbol.replace||SymbolPolyfill("replace")),search:d("",NativeSymbol&&NativeSymbol.search||SymbolPolyfill("search")),species:d("",NativeSymbol&&NativeSymbol.species||SymbolPolyfill("species")),split:d("",NativeSymbol&&NativeSymbol.split||SymbolPolyfill("split")),toPrimitive:d("",NativeSymbol&&NativeSymbol.toPrimitive||SymbolPolyfill("toPrimitive")),toStringTag:d("",NativeSymbol&&NativeSymbol.toStringTag||SymbolPolyfill("toStringTag")),unscopables:d("",NativeSymbol&&NativeSymbol.unscopables||SymbolPolyfill("unscopables"))}),defineProperties(HiddenSymbol.prototype,{constructor:d(SymbolPolyfill),toString:d("",function(){return this.__name__})}),defineProperties(SymbolPolyfill.prototype,{toString:d(function(){return"Symbol ("+validateSymbol(this).__description__+")"}),valueOf:d(function(){return validateSymbol(this)})}),defineProperty(SymbolPolyfill.prototype,SymbolPolyfill.toPrimitive,d("",function(){var symbol=validateSymbol(this);return"symbol"==typeof symbol?symbol:symbol.toString()})),defineProperty(SymbolPolyfill.prototype,SymbolPolyfill.toStringTag,d("c","Symbol")),defineProperty(HiddenSymbol.prototype,SymbolPolyfill.toStringTag,d("c",SymbolPolyfill.prototype[SymbolPolyfill.toStringTag])),defineProperty(HiddenSymbol.prototype,SymbolPolyfill.toPrimitive,d("c",SymbolPolyfill.prototype[SymbolPolyfill.toPrimitive]))},{"./validate-symbol":207,d:138}],207:[function(_dereq_,module,exports){"use strict";var isSymbol=_dereq_("./is-symbol");module.exports=function(value){if(!isSymbol(value))throw new TypeError(value+" is not a symbol");return value}},{"./is-symbol":205}],208:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./is-implemented")()?WeakMap:_dereq_("./polyfill")},{"./is-implemented":209,"./polyfill":211}],209:[function(_dereq_,module,exports){"use strict";module.exports=function(){var weakMap,x;if("function"!=typeof WeakMap)return!1;try{weakMap=new WeakMap([[x={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(weakMap)&&("function"==typeof weakMap.set&&(weakMap.set({},1)===weakMap&&("function"==typeof weakMap.delete&&("function"==typeof weakMap.has&&"one"===weakMap.get(x)))))}},{}],210:[function(_dereq_,module,exports){"use strict";module.exports="function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)},{}],211:[function(_dereq_,module,exports){"use strict";var WeakMapPoly,setPrototypeOf=_dereq_("es5-ext/object/set-prototype-of"),object=_dereq_("es5-ext/object/valid-object"),value=_dereq_("es5-ext/object/valid-value"),randomUniq=_dereq_("es5-ext/string/random-uniq"),d=_dereq_("d"),getIterator=_dereq_("es6-iterator/get"),forOf=_dereq_("es6-iterator/for-of"),toStringTagSymbol=_dereq_("es6-symbol").toStringTag,isNative=_dereq_("./is-native-implemented"),isArray=Array.isArray,defineProperty=Object.defineProperty,hasOwnProperty=Object.prototype.hasOwnProperty,getPrototypeOf=Object.getPrototypeOf;module.exports=WeakMapPoly=function(){var self,iterable=arguments[0];if(!(this instanceof WeakMapPoly))throw new TypeError("Constructor requires 'new'");return self=isNative&&setPrototypeOf&&WeakMap!==WeakMapPoly?setPrototypeOf(new WeakMap,getPrototypeOf(this)):this,null!=iterable&&(isArray(iterable)||(iterable=getIterator(iterable))),defineProperty(self,"__weakMapData__",d("c","$weakMap$"+randomUniq())),iterable?(forOf(iterable,function(val){value(val),self.set(val[0],val[1])}),self):self},isNative&&(setPrototypeOf&&setPrototypeOf(WeakMapPoly,WeakMap),WeakMapPoly.prototype=Object.create(WeakMap.prototype,{constructor:d(WeakMapPoly)})),Object.defineProperties(WeakMapPoly.prototype,{delete:d(function(key){return!!hasOwnProperty.call(object(key),this.__weakMapData__)&&(delete key[this.__weakMapData__],!0)}),get:d(function(key){if(hasOwnProperty.call(object(key),this.__weakMapData__))return key[this.__weakMapData__]}),has:d(function(key){return hasOwnProperty.call(object(key),this.__weakMapData__)}),set:d(function(key,value){return defineProperty(object(key),this.__weakMapData__,d("c",value)),this}),toString:d(function(){return"[object WeakMap]"})}),defineProperty(WeakMapPoly.prototype,toStringTagSymbol,d("c","WeakMap"))},{"./is-native-implemented":210,d:138,"es5-ext/object/set-prototype-of":184,"es5-ext/object/valid-object":188,"es5-ext/object/valid-value":189,"es5-ext/string/random-uniq":194,"es6-iterator/for-of":196,"es6-iterator/get":197,"es6-symbol":203}],212:[function(_dereq_,module,exports){"use strict";module.exports=function extractPlanes(M,zNear,zFar){var z=zNear||0,zf=zFar||1;return[[M[12]+M[0],M[13]+M[1],M[14]+M[2],M[15]+M[3]],[M[12]-M[0],M[13]-M[1],M[14]-M[2],M[15]-M[3]],[M[12]+M[4],M[13]+M[5],M[14]+M[6],M[15]+M[7]],[M[12]-M[4],M[13]-M[5],M[14]-M[6],M[15]-M[7]],[z*M[12]+M[8],z*M[13]+M[9],z*M[14]+M[10],z*M[15]+M[11]],[zf*M[12]-M[8],zf*M[13]-M[9],zf*M[14]-M[10],zf*M[15]-M[11]]]}},{}],213:[function(_dereq_,module,exports){"use strict";module.exports=function(n){var type=typeof n;if("string"===type){var original=n;if(0===(n=+n)&&function allBlankCharCodes(str){for(var a,l=str.length,i=0;i<l;i++)if(((a=str.charCodeAt(i))<9||a>13)&&32!==a&&133!==a&&160!==a&&5760!==a&&6158!==a&&(a<8192||a>8205)&&8232!==a&&8233!==a&&8239!==a&&8287!==a&&8288!==a&&12288!==a&&65279!==a)return!1;return!0}(original))return!1}else if("number"!==type)return!1;return n-n<1}},{}],214:[function(_dereq_,module,exports){"use strict";module.exports=function createFilteredVector(initState,initVelocity,initTime){switch(arguments.length){case 0:return new FilteredVector([0],[0],0);case 1:if("number"==typeof initState){var zero=getZero(initState);return new FilteredVector(zero,zero,0)}return new FilteredVector(initState,getZero(initState.length),0);case 2:if("number"==typeof initVelocity){var zero=getZero(initState.length);return new FilteredVector(initState,zero,+initVelocity)}initTime=0;case 3:if(initState.length!==initVelocity.length)throw new Error("state and velocity lengths must match");return new FilteredVector(initState,initVelocity,initTime)}};var cubicHermite=_dereq_("cubic-hermite"),bsearch=_dereq_("binary-search-bounds");function clamp(lo,hi,x){return Math.min(hi,Math.max(lo,x))}function FilteredVector(state0,velocity0,t0){this.dimension=state0.length,this.bounds=[new Array(this.dimension),new Array(this.dimension)];for(var i=0;i<this.dimension;++i)this.bounds[0][i]=-1/0,this.bounds[1][i]=1/0;this._state=state0.slice().reverse(),this._velocity=velocity0.slice().reverse(),this._time=[t0],this._scratch=[state0.slice(),state0.slice(),state0.slice(),state0.slice(),state0.slice()]}var proto=FilteredVector.prototype;function getZero(d){for(var result=new Array(d),i=0;i<d;++i)result[i]=0;return result}proto.flush=function(t){var idx=bsearch.gt(this._time,t)-1;idx<=0||(this._time.splice(0,idx),this._state.splice(0,idx*this.dimension),this._velocity.splice(0,idx*this.dimension))},proto.curve=function(t){var time=this._time,n=time.length,idx=bsearch.le(time,t),result=this._scratch[0],state=this._state,velocity=this._velocity,d=this.dimension,bounds=this.bounds;if(idx<0)for(var ptr=d-1,i=0;i<d;++i,--ptr)result[i]=state[ptr];else if(idx>=n-1){ptr=state.length-1;var tf=t-time[n-1];for(i=0;i<d;++i,--ptr)result[i]=state[ptr]+tf*velocity[ptr]}else{ptr=d*(idx+1)-1;var t0=time[idx],dt=time[idx+1]-t0||1,x0=this._scratch[1],x1=this._scratch[2],v0=this._scratch[3],v1=this._scratch[4],steady=!0;for(i=0;i<d;++i,--ptr)x0[i]=state[ptr],v0[i]=velocity[ptr]*dt,x1[i]=state[ptr+d],v1[i]=velocity[ptr+d]*dt,steady=steady&&x0[i]===x1[i]&&v0[i]===v1[i]&&0===v0[i];if(steady)for(i=0;i<d;++i)result[i]=x0[i];else cubicHermite(x0,v0,x1,v1,(t-t0)/dt,result)}var lo=bounds[0],hi=bounds[1];for(i=0;i<d;++i)result[i]=clamp(lo[i],hi[i],result[i]);return result},proto.dcurve=function(t){var time=this._time,n=time.length,idx=bsearch.le(time,t),result=this._scratch[0],state=this._state,velocity=this._velocity,d=this.dimension;if(idx>=n-1)for(var ptr=state.length-1,i=(time[n-1],0);i<d;++i,--ptr)result[i]=velocity[ptr];else{ptr=d*(idx+1)-1;var t0=time[idx],dt=time[idx+1]-t0||1,x0=this._scratch[1],x1=this._scratch[2],v0=this._scratch[3],v1=this._scratch[4],steady=!0;for(i=0;i<d;++i,--ptr)x0[i]=state[ptr],v0[i]=velocity[ptr]*dt,x1[i]=state[ptr+d],v1[i]=velocity[ptr+d]*dt,steady=steady&&x0[i]===x1[i]&&v0[i]===v1[i]&&0===v0[i];if(steady)for(i=0;i<d;++i)result[i]=0;else{cubicHermite.derivative(x0,v0,x1,v1,(t-t0)/dt,result);for(i=0;i<d;++i)result[i]/=dt}}return result},proto.lastT=function(){var time=this._time;return time[time.length-1]},proto.stable=function(){for(var velocity=this._velocity,ptr=velocity.length,i=this.dimension-1;i>=0;--i)if(velocity[--ptr])return!1;return!0},proto.jump=function(t){var t0=this.lastT(),d=this.dimension;if(!(t<t0||arguments.length!==d+1)){var state=this._state,velocity=this._velocity,ptr=state.length-this.dimension,bounds=this.bounds,lo=bounds[0],hi=bounds[1];this._time.push(t0,t);for(var j=0;j<2;++j)for(var i=0;i<d;++i)state.push(state[ptr++]),velocity.push(0);this._time.push(t);for(i=d;i>0;--i)state.push(clamp(lo[i-1],hi[i-1],arguments[i])),velocity.push(0)}},proto.push=function(t){var t0=this.lastT(),d=this.dimension;if(!(t<t0||arguments.length!==d+1)){var state=this._state,velocity=this._velocity,ptr=state.length-this.dimension,dt=t-t0,bounds=this.bounds,lo=bounds[0],hi=bounds[1],sf=dt>1e-6?1/dt:0;this._time.push(t);for(var i=d;i>0;--i){var xc=clamp(lo[i-1],hi[i-1],arguments[i]);state.push(xc),velocity.push((xc-state[ptr++])*sf)}}},proto.set=function(t){var d=this.dimension;if(!(t<this.lastT()||arguments.length!==d+1)){var state=this._state,velocity=this._velocity,bounds=this.bounds,lo=bounds[0],hi=bounds[1];this._time.push(t);for(var i=d;i>0;--i)state.push(clamp(lo[i-1],hi[i-1],arguments[i])),velocity.push(0)}},proto.move=function(t){var t0=this.lastT(),d=this.dimension;if(!(t<=t0||arguments.length!==d+1)){var state=this._state,velocity=this._velocity,statePtr=state.length-this.dimension,bounds=this.bounds,lo=bounds[0],hi=bounds[1],dt=t-t0,sf=dt>1e-6?1/dt:0;this._time.push(t);for(var i=d;i>0;--i){var dx=arguments[i];state.push(clamp(lo[i-1],hi[i-1],state[statePtr++]+dx)),velocity.push(dx*sf)}}},proto.idle=function(t){var t0=this.lastT();if(!(t<t0)){var d=this.dimension,state=this._state,velocity=this._velocity,statePtr=state.length-d,bounds=this.bounds,lo=bounds[0],hi=bounds[1],dt=t-t0;this._time.push(t);for(var i=d-1;i>=0;--i)state.push(clamp(lo[i],hi[i],state[statePtr]+dt*velocity[statePtr])),velocity.push(0),statePtr+=1}}},{"binary-search-bounds":78,"cubic-hermite":132}],215:[function(_dereq_,module,exports){var dtype=_dereq_("dtype");module.exports=function flattenVertexData(data,output,offset){if(!data)throw new TypeError("must specify data as first parameter");if(offset=0|+(offset||0),Array.isArray(data)&&data[0]&&"number"==typeof data[0][0]){var i,j,k,l,dim=data[0].length,length=data.length*dim;output&&"string"!=typeof output||(output=new(dtype(output||"float32"))(length+offset));var dstLength=output.length-offset;if(length!==dstLength)throw new Error("source length "+length+" ("+dim+"x"+data.length+") does not match destination length "+dstLength);for(i=0,k=offset;i<data.length;i++)for(j=0;j<dim;j++)output[k++]=null===data[i][j]?NaN:data[i][j]}else if(output&&"string"!=typeof output)output.set(data,offset);else{var Ctor=dtype(output||"float32");if(Array.isArray(data)||"array"===output)for(output=new Ctor(data.length+offset),i=0,k=offset,l=output.length;k<l;k++,i++)output[k]=null===data[i]?NaN:data[i];else 0===offset?output=new Ctor(data):(output=new Ctor(data.length+offset)).set(data,offset)}return output}},{dtype:153}],216:[function(_dereq_,module,exports){"use strict";var stringifyFont=_dereq_("css-font/stringify"),defaultChars=[32,126];module.exports=function atlas(options){var shape=(options=options||{}).shape?options.shape:options.canvas?[options.canvas.width,options.canvas.height]:[512,512],canvas=options.canvas||document.createElement("canvas"),font=options.font,step="number"==typeof options.step?[options.step,options.step]:options.step||[32,32],chars=options.chars||defaultChars;font&&"string"!=typeof font&&(font=stringifyFont(font));if(Array.isArray(chars)){if(2===chars.length&&"number"==typeof chars[0]&&"number"==typeof chars[1]){for(var newchars=[],i=chars[0],j=0;i<=chars[1];i++)newchars[j++]=String.fromCharCode(i);chars=newchars}}else chars=String(chars).split("");shape=shape.slice(),canvas.width=shape[0],canvas.height=shape[1];var ctx=canvas.getContext("2d");ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font=font,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="#fff";for(var x=step[0]/2,y=step[1]/2,i=0;i<chars.length;i++)ctx.fillText(chars[i],x,y),(x+=step[0])>shape[0]-step[0]/2&&(x=step[0]/2,y+=step[1]);return canvas}},{"css-font/stringify":129}],217:[function(_dereq_,module,exports){"use strict";function measure(font,o){o||(o={}),("string"==typeof font||Array.isArray(font))&&(o.family=font);var family=Array.isArray(o.family)?o.family.join(", "):o.family;if(!family)throw Error("`family` must be defined");var fs=o.size||o.fontSize||o.em||48,weight=o.weight||o.fontWeight||"",origin=(font=[o.style||o.fontStyle||"",weight,fs].join(" ")+"px "+family,o.origin||"top");if(measure.cache[family]&&fs<=measure.cache[family].em)return applyOrigin(measure.cache[family],origin);var canvas=o.canvas||measure.canvas,ctx=canvas.getContext("2d"),chars={upper:void 0!==o.upper?o.upper:"H",lower:void 0!==o.lower?o.lower:"x",descent:void 0!==o.descent?o.descent:"p",ascent:void 0!==o.ascent?o.ascent:"h",tittle:void 0!==o.tittle?o.tittle:"i",overshoot:void 0!==o.overshoot?o.overshoot:"O"},l=Math.ceil(1.5*fs);canvas.height=l,canvas.width=.5*l,ctx.font=font;var result={top:0};ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillStyle="black",ctx.fillText("H",0,0);var topPx=firstTop(ctx.getImageData(0,0,l,l));ctx.clearRect(0,0,l,l),ctx.textBaseline="bottom",ctx.fillText("H",0,l);var bottomPx=firstTop(ctx.getImageData(0,0,l,l));result.lineHeight=result.bottom=l-bottomPx+topPx,ctx.clearRect(0,0,l,l),ctx.textBaseline="alphabetic",ctx.fillText("H",0,l);var baseline=l-firstTop(ctx.getImageData(0,0,l,l))-1+topPx;result.baseline=result.alphabetic=baseline,ctx.clearRect(0,0,l,l),ctx.textBaseline="middle",ctx.fillText("H",0,.5*l);var medianPx=firstTop(ctx.getImageData(0,0,l,l));result.median=result.middle=l-medianPx-1+topPx-.5*l,ctx.clearRect(0,0,l,l),ctx.textBaseline="hanging",ctx.fillText("H",0,.5*l);var hangingPx=firstTop(ctx.getImageData(0,0,l,l));result.hanging=l-hangingPx-1+topPx-.5*l,ctx.clearRect(0,0,l,l),ctx.textBaseline="ideographic",ctx.fillText("H",0,l);var ideographicPx=firstTop(ctx.getImageData(0,0,l,l));if(result.ideographic=l-ideographicPx-1+topPx,chars.upper&&(ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.upper,0,0),result.upper=firstTop(ctx.getImageData(0,0,l,l)),result.capHeight=result.baseline-result.upper),chars.lower&&(ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.lower,0,0),result.lower=firstTop(ctx.getImageData(0,0,l,l)),result.xHeight=result.baseline-result.lower),chars.tittle&&(ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.tittle,0,0),result.tittle=firstTop(ctx.getImageData(0,0,l,l))),chars.ascent&&(ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.ascent,0,0),result.ascent=firstTop(ctx.getImageData(0,0,l,l))),chars.descent&&(ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.descent,0,0),result.descent=firstBottom(ctx.getImageData(0,0,l,l))),chars.overshoot){ctx.clearRect(0,0,l,l),ctx.textBaseline="top",ctx.fillText(chars.overshoot,0,0);var overshootPx=firstBottom(ctx.getImageData(0,0,l,l));result.overshoot=overshootPx-baseline}for(var name in result)result[name]/=fs;return result.em=fs,measure.cache[family]=result,applyOrigin(result,origin)}function applyOrigin(obj,origin){var res={};for(var name in"string"==typeof origin&&(origin=obj[origin]),obj)"em"!==name&&(res[name]=obj[name]-origin);return res}function firstTop(iData){for(var l=iData.height,data=iData.data,i=3;i<data.length;i+=4)if(0!==data[i])return Math.floor(.25*(i-3)/l)}function firstBottom(iData){for(var l=iData.height,data=iData.data,i=data.length-1;i>0;i-=4)if(0!==data[i])return Math.floor(.25*(i-3)/l)}module.exports=measure,measure.canvas=document.createElement("canvas"),measure.cache={}},{}],218:[function(_dereq_,module,exports){"use strict";module.exports=function createRBTree(compare){return new RedBlackTree(compare||defaultCompare,null)};var RED=0,BLACK=1;function RBNode(color,key,value,left,right,count){this._color=color,this.key=key,this.value=value,this.left=left,this.right=right,this._count=count}function cloneNode(node){return new RBNode(node._color,node.key,node.value,node.left,node.right,node._count)}function repaint(color,node){return new RBNode(color,node.key,node.value,node.left,node.right,node._count)}function recount(node){node._count=1+(node.left?node.left._count:0)+(node.right?node.right._count:0)}function RedBlackTree(compare,root){this._compare=compare,this.root=root}var proto=RedBlackTree.prototype;function RedBlackTreeIterator(tree,stack){this.tree=tree,this._stack=stack}Object.defineProperty(proto,"keys",{get:function(){var result=[];return this.forEach(function(k,v){result.push(k)}),result}}),Object.defineProperty(proto,"values",{get:function(){var result=[];return this.forEach(function(k,v){result.push(v)}),result}}),Object.defineProperty(proto,"length",{get:function(){return this.root?this.root._count:0}}),proto.insert=function(key,value){for(var cmp=this._compare,n=this.root,n_stack=[],d_stack=[];n;){var d=cmp(key,n.key);n_stack.push(n),d_stack.push(d),n=d<=0?n.left:n.right}n_stack.push(new RBNode(RED,key,value,null,null,1));for(var s=n_stack.length-2;s>=0;--s){n=n_stack[s];d_stack[s]<=0?n_stack[s]=new RBNode(n._color,n.key,n.value,n_stack[s+1],n.right,n._count+1):n_stack[s]=new RBNode(n._color,n.key,n.value,n.left,n_stack[s+1],n._count+1)}for(s=n_stack.length-1;s>1;--s){var p=n_stack[s-1];n=n_stack[s];if(p._color===BLACK||n._color===BLACK)break;var pp=n_stack[s-2];if(pp.left===p)if(p.left===n){if(!(y=pp.right)||y._color!==RED){if(pp._color=RED,pp.left=p.right,p._color=BLACK,p.right=pp,n_stack[s-2]=p,n_stack[s-1]=n,recount(pp),recount(p),s>=3)(ppp=n_stack[s-3]).left===pp?ppp.left=p:ppp.right=p;break}p._color=BLACK,pp.right=repaint(BLACK,y),pp._color=RED,s-=1}else{if(!(y=pp.right)||y._color!==RED){if(p.right=n.left,pp._color=RED,pp.left=n.right,n._color=BLACK,n.left=p,n.right=pp,n_stack[s-2]=n,n_stack[s-1]=p,recount(pp),recount(p),recount(n),s>=3)(ppp=n_stack[s-3]).left===pp?ppp.left=n:ppp.right=n;break}p._color=BLACK,pp.right=repaint(BLACK,y),pp._color=RED,s-=1}else if(p.right===n){if(!(y=pp.left)||y._color!==RED){if(pp._color=RED,pp.right=p.left,p._color=BLACK,p.left=pp,n_stack[s-2]=p,n_stack[s-1]=n,recount(pp),recount(p),s>=3)(ppp=n_stack[s-3]).right===pp?ppp.right=p:ppp.left=p;break}p._color=BLACK,pp.left=repaint(BLACK,y),pp._color=RED,s-=1}else{var y;if(!(y=pp.left)||y._color!==RED){var ppp;if(p.left=n.right,pp._color=RED,pp.right=n.left,n._color=BLACK,n.right=p,n.left=pp,n_stack[s-2]=n,n_stack[s-1]=p,recount(pp),recount(p),recount(n),s>=3)(ppp=n_stack[s-3]).right===pp?ppp.right=n:ppp.left=n;break}p._color=BLACK,pp.left=repaint(BLACK,y),pp._color=RED,s-=1}}return n_stack[0]._color=BLACK,new RedBlackTree(cmp,n_stack[0])},proto.forEach=function rbTreeForEach(visit,lo,hi){if(this.root)switch(arguments.length){case 1:return function doVisitFull(visit,node){var v;if(node.left&&(v=doVisitFull(visit,node.left)))return v;return(v=visit(node.key,node.value))||(node.right?doVisitFull(visit,node.right):void 0)}(visit,this.root);case 2:return function doVisitHalf(lo,compare,visit,node){if(compare(lo,node.key)<=0){var v;if(node.left&&(v=doVisitHalf(lo,compare,visit,node.left)))return v;if(v=visit(node.key,node.value))return v}if(node.right)return doVisitHalf(lo,compare,visit,node.right)}(lo,this._compare,visit,this.root);case 3:if(this._compare(lo,hi)>=0)return;return function doVisit(lo,hi,compare,visit,node){var v,l=compare(lo,node.key),h=compare(hi,node.key);if(l<=0){if(node.left&&(v=doVisit(lo,hi,compare,visit,node.left)))return v;if(h>0&&(v=visit(node.key,node.value)))return v}if(h>0&&node.right)return doVisit(lo,hi,compare,visit,node.right)}(lo,hi,this._compare,visit,this.root)}},Object.defineProperty(proto,"begin",{get:function(){for(var stack=[],n=this.root;n;)stack.push(n),n=n.left;return new RedBlackTreeIterator(this,stack)}}),Object.defineProperty(proto,"end",{get:function(){for(var stack=[],n=this.root;n;)stack.push(n),n=n.right;return new RedBlackTreeIterator(this,stack)}}),proto.at=function(idx){if(idx<0)return new RedBlackTreeIterator(this,[]);for(var n=this.root,stack=[];;){if(stack.push(n),n.left){if(idx<n.left._count){n=n.left;continue}idx-=n.left._count}if(!idx)return new RedBlackTreeIterator(this,stack);if(idx-=1,!n.right)break;if(idx>=n.right._count)break;n=n.right}return new RedBlackTreeIterator(this,[])},proto.ge=function(key){for(var cmp=this._compare,n=this.root,stack=[],last_ptr=0;n;){var d=cmp(key,n.key);stack.push(n),d<=0&&(last_ptr=stack.length),n=d<=0?n.left:n.right}return stack.length=last_ptr,new RedBlackTreeIterator(this,stack)},proto.gt=function(key){for(var cmp=this._compare,n=this.root,stack=[],last_ptr=0;n;){var d=cmp(key,n.key);stack.push(n),d<0&&(last_ptr=stack.length),n=d<0?n.left:n.right}return stack.length=last_ptr,new RedBlackTreeIterator(this,stack)},proto.lt=function(key){for(var cmp=this._compare,n=this.root,stack=[],last_ptr=0;n;){var d=cmp(key,n.key);stack.push(n),d>0&&(last_ptr=stack.length),n=d<=0?n.left:n.right}return stack.length=last_ptr,new RedBlackTreeIterator(this,stack)},proto.le=function(key){for(var cmp=this._compare,n=this.root,stack=[],last_ptr=0;n;){var d=cmp(key,n.key);stack.push(n),d>=0&&(last_ptr=stack.length),n=d<0?n.left:n.right}return stack.length=last_ptr,new RedBlackTreeIterator(this,stack)},proto.find=function(key){for(var cmp=this._compare,n=this.root,stack=[];n;){var d=cmp(key,n.key);if(stack.push(n),0===d)return new RedBlackTreeIterator(this,stack);n=d<=0?n.left:n.right}return new RedBlackTreeIterator(this,[])},proto.remove=function(key){var iter=this.find(key);return iter?iter.remove():this},proto.get=function(key){for(var cmp=this._compare,n=this.root;n;){var d=cmp(key,n.key);if(0===d)return n.value;n=d<=0?n.left:n.right}};var iproto=RedBlackTreeIterator.prototype;function swapNode(n,v){n.key=v.key,n.value=v.value,n.left=v.left,n.right=v.right,n._color=v._color,n._count=v._count}function defaultCompare(a,b){return a<b?-1:a>b?1:0}Object.defineProperty(iproto,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(iproto,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),iproto.clone=function(){return new RedBlackTreeIterator(this.tree,this._stack.slice())},iproto.remove=function(){var stack=this._stack;if(0===stack.length)return this.tree;var cstack=new Array(stack.length),n=stack[stack.length-1];cstack[cstack.length-1]=new RBNode(n._color,n.key,n.value,n.left,n.right,n._count);for(var i=stack.length-2;i>=0;--i){(n=stack[i]).left===stack[i+1]?cstack[i]=new RBNode(n._color,n.key,n.value,cstack[i+1],n.right,n._count):cstack[i]=new RBNode(n._color,n.key,n.value,n.left,cstack[i+1],n._count)}if((n=cstack[cstack.length-1]).left&&n.right){var split=cstack.length;for(n=n.left;n.right;)cstack.push(n),n=n.right;var v=cstack[split-1];cstack.push(new RBNode(n._color,v.key,v.value,n.left,n.right,n._count)),cstack[split-1].key=n.key,cstack[split-1].value=n.value;for(i=cstack.length-2;i>=split;--i)n=cstack[i],cstack[i]=new RBNode(n._color,n.key,n.value,n.left,cstack[i+1],n._count);cstack[split-1].left=cstack[split]}if((n=cstack[cstack.length-1])._color===RED){var p=cstack[cstack.length-2];p.left===n?p.left=null:p.right===n&&(p.right=null),cstack.pop();for(i=0;i<cstack.length;++i)cstack[i]._count--;return new RedBlackTree(this.tree._compare,cstack[0])}if(n.left||n.right){n.left?swapNode(n,n.left):n.right&&swapNode(n,n.right),n._color=BLACK;for(i=0;i<cstack.length-1;++i)cstack[i]._count--;return new RedBlackTree(this.tree._compare,cstack[0])}if(1===cstack.length)return new RedBlackTree(this.tree._compare,null);for(i=0;i<cstack.length;++i)cstack[i]._count--;var parent=cstack[cstack.length-2];return function fixDoubleBlack(stack){for(var n,p,s,z,i=stack.length-1;i>=0;--i){if(n=stack[i],0===i)return void(n._color=BLACK);if((p=stack[i-1]).left===n){if((s=p.right).right&&s.right._color===RED)return z=(s=p.right=cloneNode(s)).right=cloneNode(s.right),p.right=s.left,s.left=p,s.right=z,s._color=p._color,n._color=BLACK,p._color=BLACK,z._color=BLACK,recount(p),recount(s),i>1&&((pp=stack[i-2]).left===p?pp.left=s:pp.right=s),void(stack[i-1]=s);if(s.left&&s.left._color===RED)return z=(s=p.right=cloneNode(s)).left=cloneNode(s.left),p.right=z.left,s.left=z.right,z.left=p,z.right=s,z._color=p._color,p._color=BLACK,s._color=BLACK,n._color=BLACK,recount(p),recount(s),recount(z),i>1&&((pp=stack[i-2]).left===p?pp.left=z:pp.right=z),void(stack[i-1]=z);if(s._color===BLACK){if(p._color===RED)return p._color=BLACK,void(p.right=repaint(RED,s));p.right=repaint(RED,s);continue}s=cloneNode(s),p.right=s.left,s.left=p,s._color=p._color,p._color=RED,recount(p),recount(s),i>1&&((pp=stack[i-2]).left===p?pp.left=s:pp.right=s),stack[i-1]=s,stack[i]=p,i+1<stack.length?stack[i+1]=n:stack.push(n),i+=2}else{if((s=p.left).left&&s.left._color===RED)return z=(s=p.left=cloneNode(s)).left=cloneNode(s.left),p.left=s.right,s.right=p,s.left=z,s._color=p._color,n._color=BLACK,p._color=BLACK,z._color=BLACK,recount(p),recount(s),i>1&&((pp=stack[i-2]).right===p?pp.right=s:pp.left=s),void(stack[i-1]=s);if(s.right&&s.right._color===RED)return z=(s=p.left=cloneNode(s)).right=cloneNode(s.right),p.left=z.right,s.right=z.left,z.right=p,z.left=s,z._color=p._color,p._color=BLACK,s._color=BLACK,n._color=BLACK,recount(p),recount(s),recount(z),i>1&&((pp=stack[i-2]).right===p?pp.right=z:pp.left=z),void(stack[i-1]=z);if(s._color===BLACK){if(p._color===RED)return p._color=BLACK,void(p.left=repaint(RED,s));p.left=repaint(RED,s);continue}var pp;s=cloneNode(s),p.left=s.right,s.right=p,s._color=p._color,p._color=RED,recount(p),recount(s),i>1&&((pp=stack[i-2]).right===p?pp.right=s:pp.left=s),stack[i-1]=s,stack[i]=p,i+1<stack.length?stack[i+1]=n:stack.push(n),i+=2}}}(cstack),parent.left===n?parent.left=null:parent.right=null,new RedBlackTree(this.tree._compare,cstack[0])},Object.defineProperty(iproto,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(iproto,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(iproto,"index",{get:function(){var idx=0,stack=this._stack;if(0===stack.length){var r=this.tree.root;return r?r._count:0}stack[stack.length-1].left&&(idx=stack[stack.length-1].left._count);for(var s=stack.length-2;s>=0;--s)stack[s+1]===stack[s].right&&(++idx,stack[s].left&&(idx+=stack[s].left._count));return idx},enumerable:!0}),iproto.next=function(){var stack=this._stack;if(0!==stack.length){var n=stack[stack.length-1];if(n.right)for(n=n.right;n;)stack.push(n),n=n.left;else for(stack.pop();stack.length>0&&stack[stack.length-1].right===n;)n=stack[stack.length-1],stack.pop()}},Object.defineProperty(iproto,"hasNext",{get:function(){var stack=this._stack;if(0===stack.length)return!1;if(stack[stack.length-1].right)return!0;for(var s=stack.length-1;s>0;--s)if(stack[s-1].left===stack[s])return!0;return!1}}),iproto.update=function(value){var stack=this._stack;if(0===stack.length)throw new Error("Can't update empty node!");var cstack=new Array(stack.length),n=stack[stack.length-1];cstack[cstack.length-1]=new RBNode(n._color,n.key,value,n.left,n.right,n._count);for(var i=stack.length-2;i>=0;--i)(n=stack[i]).left===stack[i+1]?cstack[i]=new RBNode(n._color,n.key,n.value,cstack[i+1],n.right,n._count):cstack[i]=new RBNode(n._color,n.key,n.value,n.left,cstack[i+1],n._count);return new RedBlackTree(this.tree._compare,cstack[0])},iproto.prev=function(){var stack=this._stack;if(0!==stack.length){var n=stack[stack.length-1];if(n.left)for(n=n.left;n;)stack.push(n),n=n.right;else for(stack.pop();stack.length>0&&stack[stack.length-1].left===n;)n=stack[stack.length-1],stack.pop()}},Object.defineProperty(iproto,"hasPrev",{get:function(){var stack=this._stack;if(0===stack.length)return!1;if(stack[stack.length-1].left)return!0;for(var s=stack.length-1;s>0;--s)if(stack[s-1].right===stack[s])return!0;return!1}})},{}],219:[function(_dereq_,module,exports){var p=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],g_ln=607/128,p_ln=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function lngamma(z){if(z<0)return Number("0/0");for(var x=p_ln[0],i=p_ln.length-1;i>0;--i)x+=p_ln[i]/(z+i);var t=z+g_ln+.5;return.5*Math.log(2*Math.PI)+(z+.5)*Math.log(t)-t+Math.log(x)-Math.log(z)}module.exports=function gamma(z){if(z<.5)return Math.PI/(Math.sin(Math.PI*z)*gamma(1-z));if(z>100)return Math.exp(lngamma(z));z-=1;for(var x=p[0],i=1;i<9;i++)x+=p[i]/(z+i);var t=z+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,z+.5)*Math.exp(-t)*x},module.exports.log=lngamma},{}],220:[function(_dereq_,module,exports){module.exports=function getCanvasContext(type,opts){if("string"!=typeof type)throw new TypeError("must specify type string");if(opts=opts||{},"undefined"==typeof document&&!opts.canvas)return null;var canvas=opts.canvas||document.createElement("canvas");"number"==typeof opts.width&&(canvas.width=opts.width);"number"==typeof opts.height&&(canvas.height=opts.height);var gl,attribs=opts;try{var names=[type];0===type.indexOf("webgl")&&names.push("experimental-"+type);for(var i=0;i<names.length;i++)if(gl=canvas.getContext(names[i],attribs))return gl}catch(e){gl=null}return gl||null}},{}],221:[function(_dereq_,module,exports){"use strict";module.exports=function createAxes(gl,options){var axes=new Axes(gl);return axes.update(options),axes};var createText=_dereq_("./lib/text.js"),createLines=_dereq_("./lib/lines.js"),createBackground=_dereq_("./lib/background.js"),getCubeProperties=_dereq_("./lib/cube.js"),Ticks=_dereq_("./lib/ticks.js"),identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function copyVec3(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function Axes(gl){this.gl=gl,this.pixelRatio=1,this.bounds=[[-10,-10,-10],[10,10,10]],this.ticks=[[],[],[]],this.autoTicks=!0,this.tickSpacing=[1,1,1],this.tickEnable=[!0,!0,!0],this.tickFont=["sans-serif","sans-serif","sans-serif"],this.tickSize=[12,12,12],this.tickAngle=[0,0,0],this.tickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.tickPad=[10,10,10],this.lastCubeProps={cubeEdges:[0,0,0],axis:[0,0,0]},this.labels=["x","y","z"],this.labelEnable=[!0,!0,!0],this.labelFont="sans-serif",this.labelSize=[20,20,20],this.labelAngle=[0,0,0],this.labelColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.labelPad=[10,10,10],this.lineEnable=[!0,!0,!0],this.lineMirror=[!1,!1,!1],this.lineWidth=[1,1,1],this.lineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.lineTickEnable=[!0,!0,!0],this.lineTickMirror=[!1,!1,!1],this.lineTickLength=[0,0,0],this.lineTickWidth=[1,1,1],this.lineTickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.gridEnable=[!0,!0,!0],this.gridWidth=[1,1,1],this.gridColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroEnable=[!0,!0,!0],this.zeroLineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroLineWidth=[2,2,2],this.backgroundEnable=[!1,!1,!1],this.backgroundColor=[[.8,.8,.8,.5],[.8,.8,.8,.5],[.8,.8,.8,.5]],this._firstInit=!0,this._text=null,this._lines=null,this._background=createBackground(gl)}var proto=Axes.prototype;function OffsetInfo(){this.primalOffset=[0,0,0],this.primalMinor=[0,0,0],this.mirrorOffset=[0,0,0],this.mirrorMinor=[0,0,0]}proto.update=function(options){function parseOption(nest,cons,name){if(name in options){var next,opt=options[name],prev=this[name];(nest?Array.isArray(opt)&&Array.isArray(opt[0]):Array.isArray(opt))?this[name]=next=[cons(opt[0]),cons(opt[1]),cons(opt[2])]:this[name]=next=[cons(opt),cons(opt),cons(opt)];for(var i=0;i<3;++i)if(next[i]!==prev[i])return!0}return!1}options=options||{};var nextTicks,NUMBER=parseOption.bind(this,!1,Number),BOOLEAN=parseOption.bind(this,!1,Boolean),STRING=parseOption.bind(this,!1,String),COLOR=parseOption.bind(this,!0,function(v){if(Array.isArray(v)){if(3===v.length)return[+v[0],+v[1],+v[2],1];if(4===v.length)return[+v[0],+v[1],+v[2],+v[3]]}return[0,0,0,1]}),ticksUpdate=!1,boundsChanged=!1;if("bounds"in options)for(var bounds=options.bounds,i=0;i<2;++i)for(var j=0;j<3;++j)bounds[i][j]!==this.bounds[i][j]&&(boundsChanged=!0),this.bounds[i][j]=bounds[i][j];if("ticks"in options){nextTicks=options.ticks,ticksUpdate=!0,this.autoTicks=!1;for(i=0;i<3;++i)this.tickSpacing[i]=0}else NUMBER("tickSpacing")&&(this.autoTicks=!0,boundsChanged=!0);if(this._firstInit&&("ticks"in options||"tickSpacing"in options||(this.autoTicks=!0),boundsChanged=!0,ticksUpdate=!0,this._firstInit=!1),boundsChanged&&this.autoTicks&&(nextTicks=Ticks.create(this.bounds,this.tickSpacing),ticksUpdate=!0),ticksUpdate){for(i=0;i<3;++i)nextTicks[i].sort(function(a,b){return a.x-b.x});Ticks.equal(nextTicks,this.ticks)?ticksUpdate=!1:this.ticks=nextTicks}BOOLEAN("tickEnable"),STRING("tickFont")&&(ticksUpdate=!0),NUMBER("tickSize"),NUMBER("tickAngle"),NUMBER("tickPad"),COLOR("tickColor");var labelUpdate=STRING("labels");STRING("labelFont")&&(labelUpdate=!0),BOOLEAN("labelEnable"),NUMBER("labelSize"),NUMBER("labelPad"),COLOR("labelColor"),BOOLEAN("lineEnable"),BOOLEAN("lineMirror"),NUMBER("lineWidth"),COLOR("lineColor"),BOOLEAN("lineTickEnable"),BOOLEAN("lineTickMirror"),NUMBER("lineTickLength"),NUMBER("lineTickWidth"),COLOR("lineTickColor"),BOOLEAN("gridEnable"),NUMBER("gridWidth"),COLOR("gridColor"),BOOLEAN("zeroEnable"),COLOR("zeroLineColor"),NUMBER("zeroLineWidth"),BOOLEAN("backgroundEnable"),COLOR("backgroundColor"),this._text?this._text&&(labelUpdate||ticksUpdate)&&this._text.update(this.bounds,this.labels,this.labelFont,this.ticks,this.tickFont):this._text=createText(this.gl,this.bounds,this.labels,this.labelFont,this.ticks,this.tickFont),this._lines&&ticksUpdate&&(this._lines.dispose(),this._lines=null),this._lines||(this._lines=createLines(this.gl,this.bounds,this.ticks))};var LINE_OFFSET=[new OffsetInfo,new OffsetInfo,new OffsetInfo];function computeLineOffset(result,i,bounds,cubeEdges,cubeAxis){for(var primalOffset=result.primalOffset,primalMinor=result.primalMinor,dualOffset=result.mirrorOffset,dualMinor=result.mirrorMinor,e=cubeEdges[i],j=0;j<3;++j)if(i!==j){var a=primalOffset,b=dualOffset,c=primalMinor,d=dualMinor;e&1<<j&&(a=dualOffset,b=primalOffset,c=dualMinor,d=primalMinor),a[j]=bounds[0][j],b[j]=bounds[1][j],cubeAxis[j]>0?(c[j]=-1,d[j]=0):(c[j]=0,d[j]=1)}}var CUBE_ENABLE=[0,0,0],DEFAULT_PARAMS={model:identity,view:identity,projection:identity};proto.isOpaque=function(){return!0},proto.isTransparent=function(){return!1},proto.drawTransparent=function(params){};var PRIMAL_MINOR=[0,0,0],MIRROR_MINOR=[0,0,0],PRIMAL_OFFSET=[0,0,0];proto.draw=function(params){params=params||DEFAULT_PARAMS;for(var gl=this.gl,model=params.model||identity,view=params.view||identity,projection=params.projection||identity,bounds=this.bounds,cubeParams=getCubeProperties(model,view,projection,bounds),cubeEdges=cubeParams.cubeEdges,cubeAxis=cubeParams.axis,cx=view[12],cy=view[13],cz=view[14],cw=view[15],pixelScaleF=this.pixelRatio*(projection[3]*cx+projection[7]*cy+projection[11]*cz+projection[15]*cw)/gl.drawingBufferHeight,i=0;i<3;++i)this.lastCubeProps.cubeEdges[i]=cubeEdges[i],this.lastCubeProps.axis[i]=cubeAxis[i];var lineOffset=LINE_OFFSET;for(i=0;i<3;++i)computeLineOffset(LINE_OFFSET[i],i,this.bounds,cubeEdges,cubeAxis);gl=this.gl;var cubeEnable=CUBE_ENABLE;for(i=0;i<3;++i)this.backgroundEnable[i]?cubeEnable[i]=cubeAxis[i]:cubeEnable[i]=0;this._background.draw(model,view,projection,bounds,cubeEnable,this.backgroundColor),this._lines.bind(model,view,projection,this);for(i=0;i<3;++i){var x=[0,0,0];cubeAxis[i]>0?x[i]=bounds[1][i]:x[i]=bounds[0][i];for(var j=0;j<2;++j){var u=(i+1+j)%3,v=(i+1+(1^j))%3;this.gridEnable[u]&&this._lines.drawGrid(u,v,this.bounds,x,this.gridColor[u],this.gridWidth[u]*this.pixelRatio)}for(j=0;j<2;++j){u=(i+1+j)%3,v=(i+1+(1^j))%3;this.zeroEnable[v]&&bounds[0][v]<=0&&bounds[1][v]>=0&&this._lines.drawZero(u,v,this.bounds,x,this.zeroLineColor[v],this.zeroLineWidth[v]*this.pixelRatio)}}for(i=0;i<3;++i){this.lineEnable[i]&&this._lines.drawAxisLine(i,this.bounds,lineOffset[i].primalOffset,this.lineColor[i],this.lineWidth[i]*this.pixelRatio),this.lineMirror[i]&&this._lines.drawAxisLine(i,this.bounds,lineOffset[i].mirrorOffset,this.lineColor[i],this.lineWidth[i]*this.pixelRatio);var primalMinor=copyVec3(PRIMAL_MINOR,lineOffset[i].primalMinor),mirrorMinor=copyVec3(MIRROR_MINOR,lineOffset[i].mirrorMinor),tickLength=this.lineTickLength;for(j=0;j<3;++j){var scaleFactor=pixelScaleF/model[5*j];primalMinor[j]*=tickLength[j]*scaleFactor,mirrorMinor[j]*=tickLength[j]*scaleFactor}this.lineTickEnable[i]&&this._lines.drawAxisTicks(i,lineOffset[i].primalOffset,primalMinor,this.lineTickColor[i],this.lineTickWidth[i]*this.pixelRatio),this.lineTickMirror[i]&&this._lines.drawAxisTicks(i,lineOffset[i].mirrorOffset,mirrorMinor,this.lineTickColor[i],this.lineTickWidth[i]*this.pixelRatio)}this._lines.unbind(),this._text.bind(model,view,projection,this.pixelRatio);for(i=0;i<3;++i){var minor=lineOffset[i].primalMinor,offset=copyVec3(PRIMAL_OFFSET,lineOffset[i].primalOffset);for(j=0;j<3;++j)this.lineTickEnable[i]&&(offset[j]+=pixelScaleF*minor[j]*Math.max(this.lineTickLength[j],0)/model[5*j]);if(this.tickEnable[i]){for(j=0;j<3;++j)offset[j]+=pixelScaleF*minor[j]*this.tickPad[j]/model[5*j];this._text.drawTicks(i,this.tickSize[i],this.tickAngle[i],offset,this.tickColor[i])}if(this.labelEnable[i]){for(j=0;j<3;++j)offset[j]+=pixelScaleF*minor[j]*this.labelPad[j]/model[5*j];offset[i]+=.5*(bounds[0][i]+bounds[1][i]),this._text.drawLabel(i,this.labelSize[i],this.labelAngle[i],offset,this.labelColor[i])}}this._text.unbind()},proto.dispose=function(){this._text.dispose(),this._lines.dispose(),this._background.dispose(),this._lines=null,this._text=null,this._background=null,this.gl=null}},{"./lib/background.js":222,"./lib/cube.js":223,"./lib/lines.js":224,"./lib/text.js":226,"./lib/ticks.js":227}],222:[function(_dereq_,module,exports){"use strict";module.exports=function createBackgroundCube(gl){for(var vertices=[],indices=[],ptr=0,d=0;d<3;++d)for(var u=(d+1)%3,v=(d+2)%3,x=[0,0,0],c=[0,0,0],s=-1;s<=1;s+=2){indices.push(ptr,ptr+2,ptr+1,ptr+1,ptr+2,ptr+3),x[d]=s,c[d]=s;for(var i=-1;i<=1;i+=2){x[u]=i;for(var j=-1;j<=1;j+=2)x[v]=j,vertices.push(x[0],x[1],x[2],c[0],c[1],c[2]),ptr+=1}var tt=u;u=v,v=tt}var buffer=createBuffer(gl,new Float32Array(vertices)),elements=createBuffer(gl,new Uint16Array(indices),gl.ELEMENT_ARRAY_BUFFER),vao=createVAO(gl,[{buffer:buffer,type:gl.FLOAT,size:3,offset:0,stride:24},{buffer:buffer,type:gl.FLOAT,size:3,offset:12,stride:24}],elements),shader=createShader(gl);return shader.attributes.position.location=0,shader.attributes.normal.location=1,new BackgroundCube(gl,buffer,vao,shader)};var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createShader=_dereq_("./shaders").bg;function BackgroundCube(gl,buffer,vao,shader){this.gl=gl,this.buffer=buffer,this.vao=vao,this.shader=shader}var proto=BackgroundCube.prototype;proto.draw=function(model,view,projection,bounds,enable,colors){for(var needsBG=!1,i=0;i<3;++i)needsBG=needsBG||enable[i];if(needsBG){var gl=this.gl;gl.enable(gl.POLYGON_OFFSET_FILL),gl.polygonOffset(1,2),this.shader.bind(),this.shader.uniforms={model:model,view:view,projection:projection,bounds:bounds,enable:enable,colors:colors},this.vao.bind(),this.vao.draw(this.gl.TRIANGLES,36),this.vao.unbind(),gl.disable(gl.POLYGON_OFFSET_FILL)}},proto.dispose=function(){this.vao.dispose(),this.buffer.dispose(),this.shader.dispose()}},{"./shaders":225,"gl-buffer":229,"gl-vao":308}],223:[function(_dereq_,module,exports){"use strict";module.exports=function getCubeEdges(model,view,projection,bounds){multiply(mvp,view,model),multiply(mvp,projection,mvp);for(var ptr=0,i=0;i<2;++i){x[2]=bounds[i][2];for(var j=0;j<2;++j){x[1]=bounds[j][1];for(var k=0;k<2;++k)x[0]=bounds[k][0],transformHg(pCubeVerts[ptr],x,mvp),ptr+=1}}for(var closest=-1,i=0;i<8;++i){for(var w=pCubeVerts[i][3],l=0;l<3;++l)cubeVerts[i][l]=pCubeVerts[i][l]/w;w<0&&(closest<0?closest=i:cubeVerts[i][2]<cubeVerts[closest][2]&&(closest=i))}if(closest<0){closest=0;for(var d=0;d<3;++d){for(var u=(d+2)%3,v=(d+1)%3,o0=-1,o1=-1,s=0;s<2;++s){var f0=s<<d,f1=f0+(s<<u)+(1-s<<v),f2=f0+(1-s<<u)+(s<<v);orient(cubeVerts[f0],cubeVerts[f1],cubeVerts[f2],zero3)<0||(s?o0=1:o1=1)}if(o0<0||o1<0)o1>o0&&(closest|=1<<d);else{for(var s=0;s<2;++s){var f0=s<<d,f1=f0+(s<<u)+(1-s<<v),f2=f0+(1-s<<u)+(s<<v),o=polygonArea([pCubeVerts[f0],pCubeVerts[f1],pCubeVerts[f2],pCubeVerts[f0+(1<<u)+(1<<v)]]);s?o0=o:o1=o}o1>o0&&(closest|=1<<d)}}}for(var farthest=7^closest,bottom=-1,i=0;i<8;++i)i!==closest&&i!==farthest&&(bottom<0?bottom=i:cubeVerts[bottom][1]>cubeVerts[i][1]&&(bottom=i));for(var left=-1,i=0;i<3;++i){var idx=bottom^1<<i;if(idx!==closest&&idx!==farthest){left<0&&(left=idx);var v=cubeVerts[idx];v[0]<cubeVerts[left][0]&&(left=idx)}}for(var right=-1,i=0;i<3;++i){var idx=bottom^1<<i;if(idx!==closest&&idx!==farthest&&idx!==left){right<0&&(right=idx);var v=cubeVerts[idx];v[0]>cubeVerts[right][0]&&(right=idx)}}var cubeEdges=CUBE_EDGES;cubeEdges[0]=cubeEdges[1]=cubeEdges[2]=0,cubeEdges[bits.log2(left^bottom)]=bottom&left,cubeEdges[bits.log2(bottom^right)]=bottom&right;var top=7^right;top===closest||top===farthest?(top=7^left,cubeEdges[bits.log2(right^top)]=top&right):cubeEdges[bits.log2(left^top)]=top&left;for(var axis=CUBE_AXIS,cutCorner=closest,d=0;d<3;++d)axis[d]=cutCorner&1<<d?-1:1;return CUBE_RESULT};var bits=_dereq_("bit-twiddle"),multiply=_dereq_("gl-mat4/multiply"),splitPoly=(_dereq_("gl-mat4/invert"),_dereq_("split-polygon")),orient=_dereq_("robust-orientation"),mvp=new Array(16),pCubeVerts=(new Array(16),new Array(8)),cubeVerts=new Array(8),x=new Array(3),zero3=[0,0,0];function transformHg(result,x,mat){for(var i=0;i<4;++i){result[i]=mat[12+i];for(var j=0;j<3;++j)result[i]+=x[j]*mat[4*j+i]}}!function(){for(var i=0;i<8;++i)pCubeVerts[i]=[1,1,1,1],cubeVerts[i]=[1,1,1]}();var FRUSTUM_PLANES=[[0,0,1,0,0],[0,0,-1,1,0],[0,-1,0,1,0],[0,1,0,1,0],[-1,0,0,1,0],[1,0,0,1,0]];function polygonArea(p){for(var i=0;i<FRUSTUM_PLANES.length;++i)if((p=splitPoly.positive(p,FRUSTUM_PLANES[i])).length<3)return 0;var base=p[0],ax=base[0]/base[3],ay=base[1]/base[3],area=0;for(i=1;i+1<p.length;++i){var b=p[i],c=p[i+1],ux=b[0]/b[3]-ax,uy=b[1]/b[3]-ay,vx=c[0]/c[3]-ax,vy=c[1]/c[3]-ay;area+=Math.abs(ux*vy-uy*vx)}return area}var CUBE_EDGES=[1,1,1],CUBE_AXIS=[0,0,0],CUBE_RESULT={cubeEdges:CUBE_EDGES,axis:CUBE_AXIS}},{"bit-twiddle":79,"gl-mat4/invert":253,"gl-mat4/multiply":255,"robust-orientation":483,"split-polygon":500}],224:[function(_dereq_,module,exports){"use strict";module.exports=function createLines(gl,bounds,ticks){var vertices=[],tickOffset=[0,0,0],tickCount=[0,0,0],gridOffset=[0,0,0],gridCount=[0,0,0];vertices.push(0,0,1,0,1,1,0,0,-1,0,0,-1,0,1,1,0,1,-1);for(var i=0;i<3;++i){for(var start=vertices.length/3|0,j=0;j<ticks[i].length;++j){var x=+ticks[i][j].x;vertices.push(x,0,1,x,1,1,x,0,-1,x,0,-1,x,1,1,x,1,-1)}var end=vertices.length/3|0;tickOffset[i]=start,tickCount[i]=end-start;for(var start=vertices.length/3|0,k=0;k<ticks[i].length;++k){var x=+ticks[i][k].x;vertices.push(x,0,1,x,1,1,x,0,-1,x,0,-1,x,1,1,x,1,-1)}var end=vertices.length/3|0;gridOffset[i]=start,gridCount[i]=end-start}var vertBuf=createBuffer(gl,new Float32Array(vertices)),vao=createVAO(gl,[{buffer:vertBuf,type:gl.FLOAT,size:3,stride:0,offset:0}]),shader=createShader(gl);return shader.attributes.position.location=0,new Lines(gl,vertBuf,vao,shader,tickCount,tickOffset,gridCount,gridOffset)};var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createShader=_dereq_("./shaders").line,MAJOR_AXIS=[0,0,0],MINOR_AXIS=[0,0,0],SCREEN_AXIS=[0,0,0],OFFSET_VEC=[0,0,0],SHAPE=[1,1];function zeroVec(a){return a[0]=a[1]=a[2]=0,a}function copyVec(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function Lines(gl,vertBuffer,vao,shader,tickCount,tickOffset,gridCount,gridOffset){this.gl=gl,this.vertBuffer=vertBuffer,this.vao=vao,this.shader=shader,this.tickCount=tickCount,this.tickOffset=tickOffset,this.gridCount=gridCount,this.gridOffset=gridOffset}var proto=Lines.prototype;proto.bind=function(model,view,projection){this.shader.bind(),this.shader.uniforms.model=model,this.shader.uniforms.view=view,this.shader.uniforms.projection=projection,SHAPE[0]=this.gl.drawingBufferWidth,SHAPE[1]=this.gl.drawingBufferHeight,this.shader.uniforms.screenShape=SHAPE,this.vao.bind()},proto.unbind=function(){this.vao.unbind()},proto.drawAxisLine=function(j,bounds,offset,color,lineWidth){var minorAxis=zeroVec(MINOR_AXIS);this.shader.uniforms.majorAxis=MINOR_AXIS,minorAxis[j]=bounds[1][j]-bounds[0][j],this.shader.uniforms.minorAxis=minorAxis;var screenAxis,noffset=copyVec(OFFSET_VEC,offset);noffset[j]+=bounds[0][j],this.shader.uniforms.offset=noffset,this.shader.uniforms.lineWidth=lineWidth,this.shader.uniforms.color=color,(screenAxis=zeroVec(SCREEN_AXIS))[(j+2)%3]=1,this.shader.uniforms.screenAxis=screenAxis,this.vao.draw(this.gl.TRIANGLES,6),(screenAxis=zeroVec(SCREEN_AXIS))[(j+1)%3]=1,this.shader.uniforms.screenAxis=screenAxis,this.vao.draw(this.gl.TRIANGLES,6)},proto.drawAxisTicks=function(j,offset,minorAxis,color,lineWidth){if(this.tickCount[j]){var majorAxis=zeroVec(MAJOR_AXIS);majorAxis[j]=1,this.shader.uniforms.majorAxis=majorAxis,this.shader.uniforms.offset=offset,this.shader.uniforms.minorAxis=minorAxis,this.shader.uniforms.color=color,this.shader.uniforms.lineWidth=lineWidth;var screenAxis=zeroVec(SCREEN_AXIS);screenAxis[j]=1,this.shader.uniforms.screenAxis=screenAxis,this.vao.draw(this.gl.TRIANGLES,this.tickCount[j],this.tickOffset[j])}},proto.drawGrid=function(i,j,bounds,offset,color,lineWidth){if(this.gridCount[i]){var minorAxis=zeroVec(MINOR_AXIS);minorAxis[j]=bounds[1][j]-bounds[0][j],this.shader.uniforms.minorAxis=minorAxis;var noffset=copyVec(OFFSET_VEC,offset);noffset[j]+=bounds[0][j],this.shader.uniforms.offset=noffset;var majorAxis=zeroVec(MAJOR_AXIS);majorAxis[i]=1,this.shader.uniforms.majorAxis=majorAxis;var screenAxis=zeroVec(SCREEN_AXIS);screenAxis[i]=1,this.shader.uniforms.screenAxis=screenAxis,this.shader.uniforms.lineWidth=lineWidth,this.shader.uniforms.color=color,this.vao.draw(this.gl.TRIANGLES,this.gridCount[i],this.gridOffset[i])}},proto.drawZero=function(j,i,bounds,offset,color,lineWidth){var minorAxis=zeroVec(MINOR_AXIS);this.shader.uniforms.majorAxis=minorAxis,minorAxis[j]=bounds[1][j]-bounds[0][j],this.shader.uniforms.minorAxis=minorAxis;var noffset=copyVec(OFFSET_VEC,offset);noffset[j]+=bounds[0][j],this.shader.uniforms.offset=noffset;var screenAxis=zeroVec(SCREEN_AXIS);screenAxis[i]=1,this.shader.uniforms.screenAxis=screenAxis,this.shader.uniforms.lineWidth=lineWidth,this.shader.uniforms.color=color,this.vao.draw(this.gl.TRIANGLES,6)},proto.dispose=function(){this.vao.dispose(),this.vertBuffer.dispose(),this.shader.dispose()}},{"./shaders":225,"gl-buffer":229,"gl-vao":308}],225:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify"),createShader=_dereq_("gl-shader"),lineVert=glslify(["#define GLSLIFY 1\nattribute vec3 position;\n\nuniform mat4 model, view, projection;\nuniform vec3 offset, majorAxis, minorAxis, screenAxis;\nuniform float lineWidth;\nuniform vec2 screenShape;\n\nvec3 project(vec3 p) {\n  vec4 pp = projection * view * model * vec4(p, 1.0);\n  return pp.xyz / max(pp.w, 0.0001);\n}\n\nvoid main() {\n  vec3 major = position.x * majorAxis;\n  vec3 minor = position.y * minorAxis;\n\n  vec3 vPosition = major + minor + offset;\n  vec3 pPosition = project(vPosition);\n  vec3 offset = project(vPosition + screenAxis * position.z);\n\n  vec2 screen = normalize((offset - pPosition).xy * screenShape) / screenShape;\n\n  gl_Position = vec4(pPosition + vec3(0.5 * screen * lineWidth, 0), 1.0);\n}\n"]),lineFrag=glslify(["precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"]);exports.line=function(gl){return createShader(gl,lineVert,lineFrag,null,[{name:"position",type:"vec3"}])};var textVert=glslify(["#define GLSLIFY 1\nattribute vec3 position;\n\nuniform mat4 model, view, projection;\nuniform vec3 offset, axis;\nuniform float scale, angle, pixelScale;\nuniform vec2 resolution;\n\nvoid main() {  \n  //Compute plane offset\n  vec2 planeCoord = position.xy * pixelScale;\n  mat2 planeXform = scale * mat2(cos(angle), sin(angle),\n                                -sin(angle), cos(angle));\n  vec2 viewOffset = 2.0 * planeXform * planeCoord / resolution;\n\n  //Compute world offset\n  float axisDistance = position.z;\n  vec3 dataPosition = axisDistance * axis + offset;\n  vec4 worldPosition = model * vec4(dataPosition, 1);\n  \n  //Compute clip position\n  vec4 viewPosition = view * worldPosition;\n  vec4 clipPosition = projection * viewPosition;\n  clipPosition /= clipPosition.w;\n\n  //Apply text offset in clip coordinates\n  clipPosition += vec4(viewOffset, 0, 0);\n\n  //Done\n  gl_Position = clipPosition;\n}"]),textFrag=glslify(["precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"]);exports.text=function(gl){return createShader(gl,textVert,textFrag,null,[{name:"position",type:"vec3"}])};var bgVert=glslify(["#define GLSLIFY 1\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 model, view, projection;\nuniform vec3 enable;\nuniform vec3 bounds[2];\n\nvarying vec3 colorChannel;\n\nvoid main() {\n  if(dot(normal, enable) > 0.0) {\n    vec3 nPosition = mix(bounds[0], bounds[1], 0.5 * (position + 1.0));\n    gl_Position = projection * view * model * vec4(nPosition, 1.0);\n  } else {\n    gl_Position = vec4(0,0,0,0);\n  }\n  colorChannel = abs(normal);\n}"]),bgFrag=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 colors[3];\n\nvarying vec3 colorChannel;\n\nvoid main() {\n  gl_FragColor = colorChannel.x * colors[0] + \n                 colorChannel.y * colors[1] +\n                 colorChannel.z * colors[2];\n}"]);exports.bg=function(gl){return createShader(gl,bgVert,bgFrag,null,[{name:"position",type:"vec3"},{name:"normal",type:"vec3"}])}},{"gl-shader":286,glslify:390}],226:[function(_dereq_,module,exports){(function(process){"use strict";module.exports=function createTextSprites(gl,bounds,labels,labelFont,ticks,tickFont){var buffer=createBuffer(gl),vao=createVAO(gl,[{buffer:buffer,size:3}]),shader=createShader(gl);shader.attributes.position.location=0;var result=new TextSprites(gl,shader,buffer,vao);return result.update(bounds,labels,labelFont,ticks,tickFont),result};var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),vectorizeText=_dereq_("vectorize-text"),createShader=_dereq_("./shaders").text,globals=window||process.global||{},__TEXT_CACHE=globals.__TEXT_CACHE||{};globals.__TEXT_CACHE={};function TextSprites(gl,shader,buffer,vao){this.gl=gl,this.shader=shader,this.buffer=buffer,this.vao=vao,this.tickOffset=this.tickCount=this.labelOffset=this.labelCount=null}var proto=TextSprites.prototype,SHAPE=[0,0];proto.bind=function(model,view,projection,pixelScale){this.vao.bind(),this.shader.bind();var uniforms=this.shader.uniforms;uniforms.model=model,uniforms.view=view,uniforms.projection=projection,uniforms.pixelScale=pixelScale,SHAPE[0]=this.gl.drawingBufferWidth,SHAPE[1]=this.gl.drawingBufferHeight,this.shader.uniforms.resolution=SHAPE},proto.unbind=function(){this.vao.unbind()},proto.update=function(bounds,labels,labelFont,ticks,tickFont){this.gl;var data=[];function addItem(t,text,font,size){var fontcache=__TEXT_CACHE[font];fontcache||(fontcache=__TEXT_CACHE[font]={});var mesh=fontcache[text];mesh||(mesh=fontcache[text]=function tryVectorizeText(text,options){try{return vectorizeText(text,options)}catch(e){return console.warn("error vectorizing text:",e),{cells:[],positions:[]}}}(text,{triangles:!0,font:font,textAlign:"center",textBaseline:"middle"}));for(var scale=(size||12)/12,positions=mesh.positions,cells=mesh.cells,i=0,nc=cells.length;i<nc;++i)for(var c=cells[i],j=2;j>=0;--j){var p=positions[c[j]];data.push(scale*p[0],-scale*p[1],t)}}for(var tickOffset=[0,0,0],tickCount=[0,0,0],labelOffset=[0,0,0],labelCount=[0,0,0],d=0;d<3;++d){labelOffset[d]=data.length/3|0,addItem(.5*(bounds[0][d]+bounds[1][d]),labels[d],labelFont),labelCount[d]=(data.length/3|0)-labelOffset[d],tickOffset[d]=data.length/3|0;for(var i=0;i<ticks[d].length;++i)ticks[d][i].text&&addItem(ticks[d][i].x,ticks[d][i].text,ticks[d][i].font||tickFont,ticks[d][i].fontSize||12);tickCount[d]=(data.length/3|0)-tickOffset[d]}this.buffer.update(data),this.tickOffset=tickOffset,this.tickCount=tickCount,this.labelOffset=labelOffset,this.labelCount=labelCount};var AXIS=[0,0,0];proto.drawTicks=function(d,scale,angle,offset,color){if(this.tickCount[d]){var v=AXIS;v[0]=v[1]=v[2]=0,v[d]=1,this.shader.uniforms.axis=v,this.shader.uniforms.color=color,this.shader.uniforms.angle=angle,this.shader.uniforms.scale=scale,this.shader.uniforms.offset=offset,this.vao.draw(this.gl.TRIANGLES,this.tickCount[d],this.tickOffset[d])}};var ZERO=[0,0,0];proto.drawLabel=function(d,scale,angle,offset,color){this.labelCount[d]&&(this.shader.uniforms.axis=ZERO,this.shader.uniforms.color=color,this.shader.uniforms.angle=angle,this.shader.uniforms.scale=scale,this.shader.uniforms.offset=offset,this.vao.draw(this.gl.TRIANGLES,this.labelCount[d],this.labelOffset[d]))},proto.dispose=function(){this.shader.dispose(),this.vao.dispose(),this.buffer.dispose()}}).call(this,_dereq_("_process"))},{"./shaders":225,_process:462,"gl-buffer":229,"gl-vao":308,"vectorize-text":524}],227:[function(_dereq_,module,exports){"use strict";function prettyPrint(spacing,i){var stepStr=spacing+"",u=stepStr.indexOf("."),sigFigs=0;u>=0&&(sigFigs=stepStr.length-u-1);var shift=Math.pow(10,sigFigs),x=Math.round(spacing*i*shift),xstr=x+"";if(xstr.indexOf("e")>=0)return xstr;var xi=x/shift,xf=x%shift;x<0?(xi=0|-Math.ceil(xi),xf=0|-xf):(xi=0|Math.floor(xi),xf|=0);var xis=""+xi;if(x<0&&(xis="-"+xis),sigFigs){for(var xs=""+xf;xs.length<sigFigs;)xs="0"+xs;return xis+"."+xs}return xis}exports.create=function defaultTicks(bounds,tickSpacing){for(var array=[],d=0;d<3;++d){for(var ticks=[],t=(bounds[0][d],bounds[1][d],0);t*tickSpacing[d]<=bounds[1][d];++t)ticks.push({x:t*tickSpacing[d],text:prettyPrint(tickSpacing[d],t)});for(var t=-1;t*tickSpacing[d]>=bounds[0][d];--t)ticks.push({x:t*tickSpacing[d],text:prettyPrint(tickSpacing[d],t)});array.push(ticks)}return array},exports.equal=function ticksEqual(ticksA,ticksB){for(var i=0;i<3;++i){if(ticksA[i].length!==ticksB[i].length)return!1;for(var j=0;j<ticksA[i].length;++j){var a=ticksA[i][j],b=ticksB[i][j];if(a.x!==b.x||a.text!==b.text||a.font!==b.font||a.fontColor!==b.fontColor||a.fontSize!==b.fontSize||a.dx!==b.dx||a.dy!==b.dy)return!1}}return!0}},{}],228:[function(_dereq_,module,exports){"use strict";module.exports=function axesProperties(axes,camera,width,height,params){var model=camera.model||identity,view=camera.view||identity,projection=camera.projection||identity,bounds=axes.bounds,axis=(params=params||cubeParams(model,view,projection,bounds)).axis;params.edges;m4mul(mvp,view,model),m4mul(mvp,projection,mvp);for(var ranges=RANGES,i=0;i<3;++i)ranges[i].lo=1/0,ranges[i].hi=-1/0,ranges[i].pixelsPerDataUnit=1/0;var frustum=getPlanes(m4transpose(mvp,mvp));m4transpose(mvp,mvp);for(var d=0;d<3;++d){var u=(d+1)%3,v=(d+2)%3,x=SCRATCH_X;i_loop:for(var i=0;i<2;++i){var poly=[];if(axis[d]<0!=!!i){x[d]=bounds[i][d];for(var j=0;j<2;++j){x[u]=bounds[j^i][u];for(var k=0;k<2;++k)x[v]=bounds[k^j^i][v],poly.push(x.slice())}for(var j=0;j<frustum.length;++j){if(0===poly.length)continue i_loop;poly=splitPoly.positive(poly,frustum[j])}for(var j=0;j<poly.length;++j)for(var v=poly[j],grad=gradient(SCRATCH_X,mvp,v,width,height),k=0;k<3;++k)ranges[k].lo=Math.min(ranges[k].lo,v[k]),ranges[k].hi=Math.max(ranges[k].hi,v[k]),k!==d&&(ranges[k].pixelsPerDataUnit=Math.min(ranges[k].pixelsPerDataUnit,Math.abs(grad[k])))}}}return ranges};var getPlanes=_dereq_("extract-frustum-planes"),splitPoly=_dereq_("split-polygon"),cubeParams=_dereq_("./lib/cube.js"),m4mul=_dereq_("gl-mat4/multiply"),m4transpose=_dereq_("gl-mat4/transpose"),v4transformMat4=_dereq_("gl-vec4/transformMat4"),identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),mvp=new Float32Array(16);function AxesRange3D(lo,hi,pixelsPerDataUnit){this.lo=lo,this.hi=hi,this.pixelsPerDataUnit=pixelsPerDataUnit}var SCRATCH_P=[0,0,0,1],SCRATCH_Q=[0,0,0,1];function gradient(result,M,v,width,height){for(var i=0;i<3;++i){for(var p=SCRATCH_P,q=SCRATCH_Q,j=0;j<3;++j)q[j]=p[j]=v[j];q[3]=p[3]=1,q[i]+=1,v4transformMat4(q,q,M),q[3]<0&&(result[i]=1/0),p[i]-=1,v4transformMat4(p,p,M),p[3]<0&&(result[i]=1/0);var dx=(p[0]/p[3]-q[0]/q[3])*width,dy=(p[1]/p[3]-q[1]/q[3])*height;result[i]=.25*Math.sqrt(dx*dx+dy*dy)}return result}var RANGES=[new AxesRange3D(1/0,-1/0,1/0),new AxesRange3D(1/0,-1/0,1/0),new AxesRange3D(1/0,-1/0,1/0)],SCRATCH_X=[0,0,0]},{"./lib/cube.js":223,"extract-frustum-planes":212,"gl-mat4/multiply":255,"gl-mat4/transpose":263,"gl-vec4/transformMat4":379,"split-polygon":500}],229:[function(_dereq_,module,exports){"use strict";var pool=_dereq_("typedarray-pool"),ops=_dereq_("ndarray-ops"),ndarray=_dereq_("ndarray"),SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"];function GLBuffer(gl,type,handle,length,usage){this.gl=gl,this.type=type,this.handle=handle,this.length=length,this.usage=usage}var proto=GLBuffer.prototype;function updateTypeArray(gl,type,len,usage,data,offset){var dataLen=data.length*data.BYTES_PER_ELEMENT;if(offset<0)return gl.bufferData(type,data,usage),dataLen;if(dataLen+offset>len)throw new Error("gl-buffer: If resizing buffer, must not specify offset");return gl.bufferSubData(type,offset,data),len}function makeScratchTypeArray(array,dtype){for(var res=pool.malloc(array.length,dtype),n=array.length,i=0;i<n;++i)res[i]=array[i];return res}proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)},proto.unbind=function(){this.gl.bindBuffer(this.type,null)},proto.dispose=function(){this.gl.deleteBuffer(this.handle)},proto.update=function(array,offset){if("number"!=typeof offset&&(offset=-1),this.bind(),"object"==typeof array&&void 0!==array.shape){var dtype=array.dtype;if(SUPPORTED_TYPES.indexOf(dtype)<0&&(dtype="float32"),this.type===this.gl.ELEMENT_ARRAY_BUFFER)dtype=gl.getExtension("OES_element_index_uint")&&"uint16"!==dtype?"uint32":"uint16";if(dtype===array.dtype&&function isPacked(shape,stride){for(var n=1,i=stride.length-1;i>=0;--i){if(stride[i]!==n)return!1;n*=shape[i]}return!0}(array.shape,array.stride))0===array.offset&&array.data.length===array.shape[0]?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array.data,offset):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array.data.subarray(array.offset,array.shape[0]),offset);else{var tmp=pool.malloc(array.size,dtype),ndt=ndarray(tmp,array.shape);ops.assign(ndt,array),this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,offset<0?tmp:tmp.subarray(0,array.size),offset),pool.free(tmp)}}else if(Array.isArray(array)){var t;t=this.type===this.gl.ELEMENT_ARRAY_BUFFER?makeScratchTypeArray(array,"uint16"):makeScratchTypeArray(array,"float32"),this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,offset<0?t:t.subarray(0,array.length),offset),pool.free(t)}else if("object"==typeof array&&"number"==typeof array.length)this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array,offset);else{if("number"!=typeof array&&void 0!==array)throw new Error("gl-buffer: Invalid data type");if(offset>=0)throw new Error("gl-buffer: Cannot specify offset when resizing buffer");(array|=0)<=0&&(array=1),this.gl.bufferData(this.type,0|array,this.usage),this.length=array}},module.exports=function createBuffer(gl,data,type,usage){if(type=type||gl.ARRAY_BUFFER,usage=usage||gl.DYNAMIC_DRAW,type!==gl.ARRAY_BUFFER&&type!==gl.ELEMENT_ARRAY_BUFFER)throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER");if(usage!==gl.DYNAMIC_DRAW&&usage!==gl.STATIC_DRAW&&usage!==gl.STREAM_DRAW)throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW");var result=new GLBuffer(gl,type,gl.createBuffer(),0,usage);return result.update(data),result}},{ndarray:430,"ndarray-ops":424,"typedarray-pool":519}],230:[function(_dereq_,module,exports){"use strict";var V=_dereq_("gl-vec3"),findLastSmallerIndex=(_dereq_("gl-vec4"),function(points,v){for(var i=0;i<points.length;i++)if(points[i]>=v)return i-1;return i}),tmp=V.create(),tmp2=V.create(),clamp=function(v,min,max){return v<min?min:v>max?max:v},sampleMeshgrid=function(point,array,meshgrid,clampOverflow){var x=point[0],y=point[1],z=point[2],w=meshgrid[0].length,h=meshgrid[1].length,d=meshgrid[2].length,x0=findLastSmallerIndex(meshgrid[0],x),y0=findLastSmallerIndex(meshgrid[1],y),z0=findLastSmallerIndex(meshgrid[2],z),x1=x0+1,y1=y0+1,z1=z0+1;if(clampOverflow&&(x0=clamp(x0,0,w-1),x1=clamp(x1,0,w-1),y0=clamp(y0,0,h-1),y1=clamp(y1,0,h-1),z0=clamp(z0,0,d-1),z1=clamp(z1,0,d-1)),x0<0||y0<0||z0<0||x1>=w||y1>=h||z1>=d)return V.create();var xf=(x-meshgrid[0][x0])/(meshgrid[0][x1]-meshgrid[0][x0]),yf=(y-meshgrid[1][y0])/(meshgrid[1][y1]-meshgrid[1][y0]),zf=(z-meshgrid[2][z0])/(meshgrid[2][z1]-meshgrid[2][z0]);(xf<0||xf>1||isNaN(xf))&&(xf=0),(yf<0||yf>1||isNaN(yf))&&(yf=0),(zf<0||zf>1||isNaN(zf))&&(zf=0);var z0off=z0*w*h,z1off=z1*w*h,y0off=y0*w,y1off=y1*w,x0off=x0,x1off=x1,v000=array[y0off+z0off+x0off],v001=array[y0off+z0off+x1off],v010=array[y1off+z0off+x0off],v011=array[y1off+z0off+x1off],v100=array[y0off+z1off+x0off],v101=array[y0off+z1off+x1off],v110=array[y1off+z1off+x0off],v111=array[y1off+z1off+x1off],result=V.create();return V.lerp(result,v000,v001,xf),V.lerp(tmp,v010,v011,xf),V.lerp(result,result,tmp,yf),V.lerp(tmp,v100,v101,xf),V.lerp(tmp2,v110,v111,xf),V.lerp(tmp,tmp,tmp2,yf),V.lerp(result,result,tmp,zf),result};module.exports=function(vectorfield,bounds){var positions;positions=vectorfield.positions?vectorfield.positions:function(meshgrid){for(var xs=meshgrid[0],ys=meshgrid[1],zs=meshgrid[2],positions=[],z=0;z<zs.length;z++)for(var y=0;y<ys.length;y++)for(var x=0;x<xs.length;x++)positions.push([zs[z],ys[y],xs[x]]);return positions}(vectorfield.meshgrid);var meshgrid=vectorfield.meshgrid,vectors=vectorfield.vectors,geo={positions:[],vertexIntensity:[],vertexIntensityBounds:vectorfield.vertexIntensityBounds,vertexNormals:[],vectors:[],cells:[],coneOffset:vectorfield.coneOffset,colormap:vectorfield.colormap};if(0===vectorfield.positions.length)return bounds&&(bounds[0]=[0,0,0],bounds[1]=[0,0,0]),geo;for(var maxNorm=0,minX=1/0,maxX=-1/0,minY=1/0,maxY=-1/0,minZ=1/0,maxZ=-1/0,p2=null,u2=null,positionVectors=[],vectorScale=1/0,i=0;i<positions.length;i++){var u,p=positions[i];minX=Math.min(p[0],minX),maxX=Math.max(p[0],maxX),minY=Math.min(p[1],minY),maxY=Math.max(p[1],maxY),minZ=Math.min(p[2],minZ),maxZ=Math.max(p[2],maxZ),u=meshgrid?sampleMeshgrid(p,vectors,meshgrid,!0):vectors[i],V.length(u)>maxNorm&&(maxNorm=V.length(u)),i&&(vectorScale=Math.min(vectorScale,2*V.distance(p2,p)/(V.length(u2)+V.length(u)))),p2=p,u2=u,positionVectors.push(u)}var minV=[minX,minY,minZ],maxV=[maxX,maxY,maxZ];bounds&&(bounds[0]=minV,bounds[1]=maxV),0===maxNorm&&(maxNorm=1);var invertedMaxNorm=1/maxNorm;isFinite(vectorScale)&&!isNaN(vectorScale)||(vectorScale=1),geo.vectorScale=vectorScale;var nml=function(x,y,z){var v=V.create();return void 0!==x&&V.set(v,x,y,z),v}(0,1,0),coneScale=vectorfield.coneSize||.5;vectorfield.absoluteConeSize&&(coneScale=vectorfield.absoluteConeSize*invertedMaxNorm),geo.coneScale=coneScale;i=0;for(var j=0;i<positions.length;i++)for(var x=(p=positions[i])[0],y=p[1],z=p[2],d=positionVectors[i],intensity=V.length(d)*invertedMaxNorm,k=0;k<8;k++){geo.positions.push([x,y,z,j++]),geo.positions.push([x,y,z,j++]),geo.positions.push([x,y,z,j++]),geo.positions.push([x,y,z,j++]),geo.positions.push([x,y,z,j++]),geo.positions.push([x,y,z,j++]),geo.vectors.push(d),geo.vectors.push(d),geo.vectors.push(d),geo.vectors.push(d),geo.vectors.push(d),geo.vectors.push(d),geo.vertexIntensity.push(intensity,intensity,intensity),geo.vertexIntensity.push(intensity,intensity,intensity),geo.vertexNormals.push(nml,nml,nml),geo.vertexNormals.push(nml,nml,nml);var m=geo.positions.length;geo.cells.push([m-6,m-5,m-4],[m-3,m-2,m-1])}return geo},module.exports.createConeMesh=_dereq_("./lib/conemesh")},{"./lib/conemesh":232,"gl-vec3":327,"gl-vec4":363}],231:[function(_dereq_,module,exports){"use strict";var barycentric=_dereq_("barycentric"),closestPointToTriangle=_dereq_("polytope-closest-point/lib/closest_point_2d.js");function xformMatrix(m,v){for(var out=[0,0,0,0],i=0;i<4;++i)for(var j=0;j<4;++j)out[j]+=m[4*i+j]*v[i];return out}function projectVertex(v,model,view,projection,resolution){for(var p=xformMatrix(projection,xformMatrix(view,xformMatrix(model,[v[0],v[1],v[2],1]))),i=0;i<3;++i)p[i]/=p[3];return[.5*resolution[0]*(1+p[0]),.5*resolution[1]*(1-p[1])]}module.exports=function closestPointToPickLocation(simplex,pixelCoord,model,view,projection,resolution){if(1===simplex.length)return[0,simplex[0].slice()];for(var simplex2D=new Array(simplex.length),i=0;i<simplex.length;++i)simplex2D[i]=projectVertex(simplex[i],model,view,projection,resolution);for(var closestIndex=0,closestDist=1/0,i=0;i<simplex2D.length;++i){for(var d2=0,j=0;j<2;++j)d2+=Math.pow(simplex2D[i][j]-pixelCoord[j],2);d2<closestDist&&(closestDist=d2,closestIndex=i)}for(var weights=function barycentricCoord(simplex,point){if(2===simplex.length){for(var d0=0,d1=0,i=0;i<2;++i)d0+=Math.pow(point[i]-simplex[0][i],2),d1+=Math.pow(point[i]-simplex[1][i],2);return d0=Math.sqrt(d0),d1=Math.sqrt(d1),d0+d1<1e-6?[1,0]:[d1/(d0+d1),d0/(d1+d0)]}if(3===simplex.length){var closestPoint=[0,0];return closestPointToTriangle(simplex[0],simplex[1],simplex[2],point,closestPoint),barycentric(simplex,closestPoint)}return[]}(simplex2D,pixelCoord),s=0,i=0;i<3;++i){if(weights[i]<-.001||weights[i]>1.0001)return null;s+=weights[i]}if(Math.abs(s-1)>.001)return null;return[closestIndex,function interpolate(simplex,weights){for(var result=[0,0,0],i=0;i<simplex.length;++i)for(var p=simplex[i],w=weights[i],j=0;j<3;++j)result[j]+=w*p[j];return result}(simplex,weights),weights]}},{barycentric:60,"polytope-closest-point/lib/closest_point_2d.js":461}],232:[function(_dereq_,module,exports){"use strict";var createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createTexture=_dereq_("gl-texture2d"),normals=_dereq_("normals"),multiply=_dereq_("gl-mat4/multiply"),invert=_dereq_("gl-mat4/invert"),ndarray=_dereq_("ndarray"),colormap=_dereq_("colormap"),getContour=_dereq_("simplicial-complex-contour"),pool=_dereq_("typedarray-pool"),shaders=_dereq_("./shaders"),meshShader=(_dereq_("./closest-point"),shaders.meshShader),pickShader=shaders.pickShader,identityMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function SimplicialMesh(gl,texture,triShader,lineShader,pointShader,pickShader,pointPickShader,contourShader,trianglePositions,triangleVectors,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,contourVAO){this.gl=gl,this.cells=[],this.positions=[],this.intensity=[],this.texture=texture,this.dirty=!0,this.triShader=triShader,this.lineShader=lineShader,this.pointShader=pointShader,this.pickShader=pickShader,this.pointPickShader=pointPickShader,this.contourShader=contourShader,this.trianglePositions=trianglePositions,this.triangleVectors=triangleVectors,this.triangleColors=triangleColors,this.triangleNormals=triangleNormals,this.triangleUVs=triangleUVs,this.triangleIds=triangleIds,this.triangleVAO=triangleVAO,this.triangleCount=0,this.lineWidth=1,this.edgePositions=edgePositions,this.edgeColors=edgeColors,this.edgeUVs=edgeUVs,this.edgeIds=edgeIds,this.edgeVAO=edgeVAO,this.edgeCount=0,this.pointPositions=pointPositions,this.pointColors=pointColors,this.pointUVs=pointUVs,this.pointSizes=pointSizes,this.pointIds=pointIds,this.pointVAO=pointVAO,this.pointCount=0,this.contourLineWidth=1,this.contourPositions=contourPositions,this.contourVAO=contourVAO,this.contourCount=0,this.contourColor=[0,0,0],this.contourEnable=!0,this.pickId=1,this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.lightPosition=[1e5,1e5,0],this.ambientLight=.8,this.diffuseLight=.8,this.specularLight=2,this.roughness=.5,this.fresnel=1.5,this.opacity=1,this.coneScale=2,this.vectorScale=1,this.coneOffset=.25,this._model=identityMatrix,this._view=identityMatrix,this._projection=identityMatrix,this._resolution=[1,1]}var proto=SimplicialMesh.prototype;function createPickShader(gl){var shader=createShader(gl,pickShader.vertex,pickShader.fragment,null,pickShader.attributes);return shader.attributes.position.location=0,shader.attributes.id.location=1,shader.attributes.vector.location=5,shader}proto.isOpaque=function(){return this.opacity>=1},proto.isTransparent=function(){return this.opacity<1},proto.pickSlots=1,proto.setPickBase=function(id){this.pickId=id},proto.highlight=function(selection){if(selection&&this.contourEnable){for(var level=getContour(this.cells,this.intensity,selection.intensity),cells=level.cells,vertexIds=level.vertexIds,vertexWeights=level.vertexWeights,numCells=cells.length,result=pool.mallocFloat32(6*numCells),ptr=0,i=0;i<numCells;++i)for(var c=cells[i],j=0;j<2;++j){var v=c[0];2===c.length&&(v=c[j]);for(var a=vertexIds[v][0],b=vertexIds[v][1],w=vertexWeights[v],wi=1-w,pa=this.positions[a],pb=this.positions[b],k=0;k<3;++k)result[ptr++]=w*pa[k]+wi*pb[k]}this.contourCount=ptr/3|0,this.contourPositions.update(result.subarray(0,ptr)),pool.free(result)}else this.contourCount=0},proto.update=function(params){params=params||{};var gl=this.gl;this.dirty=!0,"contourEnable"in params&&(this.contourEnable=params.contourEnable),"contourColor"in params&&(this.contourColor=params.contourColor),"lineWidth"in params&&(this.lineWidth=params.lineWidth),"lightPosition"in params&&(this.lightPosition=params.lightPosition),"opacity"in params&&(this.opacity=params.opacity),"ambient"in params&&(this.ambientLight=params.ambient),"diffuse"in params&&(this.diffuseLight=params.diffuse),"specular"in params&&(this.specularLight=params.specular),"roughness"in params&&(this.roughness=params.roughness),"fresnel"in params&&(this.fresnel=params.fresnel),void 0!==params.vectorScale&&(this.vectorScale=params.vectorScale),void 0!==params.coneScale&&(this.coneScale=params.coneScale),void 0!==params.coneOffset&&(this.coneOffset=params.coneOffset),params.texture?(this.texture.dispose(),this.texture=createTexture(gl,params.texture)):params.colormap&&(this.texture.shape=[256,256],this.texture.minFilter=gl.LINEAR_MIPMAP_LINEAR,this.texture.magFilter=gl.LINEAR,this.texture.setPixels(function genColormap(param){for(var colors=colormap({colormap:param,nshades:256,format:"rgba"}),result=new Uint8Array(1024),i=0;i<256;++i){for(var c=colors[i],j=0;j<3;++j)result[4*i+j]=c[j];result[4*i+3]=255*c[3]}return ndarray(result,[256,256,4],[4,0,1])}(params.colormap)),this.texture.generateMipmap());var cells=params.cells,positions=params.positions,vectors=params.vectors;if(positions&&cells&&vectors){var tPos=[],tVec=[],tCol=[],tNor=[],tUVs=[],tIds=[],ePos=[],eCol=[],eUVs=[],eIds=[],pPos=[],pCol=[],pUVs=[],pSiz=[],pIds=[];this.cells=cells,this.positions=positions;var vertexNormals=params.vertexNormals,cellNormals=params.cellNormals,vertexNormalsEpsilon=void 0===params.vertexNormalsEpsilon?1e-6:params.vertexNormalsEpsilon,faceNormalsEpsilon=void 0===params.faceNormalsEpsilon?1e-6:params.faceNormalsEpsilon;params.useFacetNormals&&!cellNormals&&(cellNormals=normals.faceNormals(cells,positions,faceNormalsEpsilon)),cellNormals||vertexNormals||(vertexNormals=normals.vertexNormals(cells,positions,vertexNormalsEpsilon));var vertexColors=params.vertexColors,cellColors=params.cellColors,meshColor=params.meshColor||[1,1,1,1],vertexUVs=params.vertexUVs,vertexIntensity=params.vertexIntensity,cellUVs=params.cellUVs,cellIntensity=params.cellIntensity,intensityLo=1/0,intensityHi=-1/0;if(!vertexUVs&&!cellUVs)if(vertexIntensity)if(params.vertexIntensityBounds)intensityLo=+params.vertexIntensityBounds[0],intensityHi=+params.vertexIntensityBounds[1];else for(var i=0;i<vertexIntensity.length;++i){var f=vertexIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else if(cellIntensity)for(i=0;i<cellIntensity.length;++i){f=cellIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else for(i=0;i<positions.length;++i){f=positions[i][2];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}this.intensity=vertexIntensity||(cellIntensity?function unpackIntensity(cells,numVerts,cellIntensity){for(var result=new Array(numVerts),i=0;i<numVerts;++i)result[i]=0;var numCells=cells.length;for(i=0;i<numCells;++i)for(var c=cells[i],j=0;j<c.length;++j)result[c[j]]=cellIntensity[i];return result}(cells,positions.length,cellIntensity):function takeZComponent(array){for(var n=array.length,result=new Array(n),i=0;i<n;++i)result[i]=array[i][2];return result}(positions));var pointSizes=params.pointSizes,meshPointSize=params.pointSize||1;this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];for(i=0;i<positions.length;++i)for(var p=positions[i],j=0;j<3;++j)!isNaN(p[j])&&isFinite(p[j])&&(this.bounds[0][j]=Math.min(this.bounds[0][j],p[j]),this.bounds[1][j]=Math.max(this.bounds[1][j],p[j]));var triangleCount=0,edgeCount=0,pointCount=0;fill_loop:for(i=0;i<cells.length;++i){var cell=cells[i];switch(cell.length){case 1:for(p=positions[v=cell[0]],j=0;j<3;++j)if(isNaN(p[j])||!isFinite(p[j]))continue fill_loop;pPos.push(p[0],p[1],p[2],p[3]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?pCol.push(c[0],c[1],c[2],1):pCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],pUVs.push(uv[0],uv[1]),pointSizes?pSiz.push(pointSizes[v]):pSiz.push(meshPointSize),pIds.push(i),pointCount+=1;break;case 2:for(j=0;j<2;++j){p=positions[v=cell[j]];for(var k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop}for(j=0;j<2;++j){p=positions[v=cell[j]];ePos.push(p[0],p[1],p[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?eCol.push(c[0],c[1],c[2],1):eCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],eUVs.push(uv[0],uv[1]),eIds.push(i)}edgeCount+=1;break;case 3:for(j=0;j<3;++j)for(p=positions[v=cell[j]],k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop;for(j=0;j<3;++j){var v;p=positions[v=cell[j]];tPos.push(p[0],p[1],p[2],p[3]);var c,uv,q,w=vectors[v];tVec.push(w[0],w[1],w[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?tCol.push(c[0],c[1],c[2],1):tCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],tUVs.push(uv[0],uv[1]),q=vertexNormals?vertexNormals[v]:cellNormals[i],tNor.push(q[0],q[1],q[2]),tIds.push(i)}triangleCount+=1}}this.pointCount=pointCount,this.edgeCount=edgeCount,this.triangleCount=triangleCount,this.pointPositions.update(pPos),this.pointColors.update(pCol),this.pointUVs.update(pUVs),this.pointSizes.update(pSiz),this.pointIds.update(new Uint32Array(pIds)),this.edgePositions.update(ePos),this.edgeColors.update(eCol),this.edgeUVs.update(eUVs),this.edgeIds.update(new Uint32Array(eIds)),this.trianglePositions.update(tPos),this.triangleVectors.update(tVec),this.triangleColors.update(tCol),this.triangleUVs.update(tUVs),this.triangleNormals.update(tNor),this.triangleIds.update(new Uint32Array(tIds))}},proto.drawTransparent=proto.draw=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);var uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,kambient:this.ambientLight,kdiffuse:this.diffuseLight,kspecular:this.specularLight,roughness:this.roughness,fresnel:this.fresnel,eyePosition:[0,0,0],lightPosition:[0,0,0],opacity:this.opacity,vectorScale:this.vectorScale,coneScale:this.coneScale,coneOffset:this.coneOffset,contourColor:this.contourColor,texture:0};this.texture.bind(0);var invCameraMatrix=new Array(16);multiply(invCameraMatrix,uniforms.view,uniforms.model),multiply(invCameraMatrix,uniforms.projection,invCameraMatrix),invert(invCameraMatrix,invCameraMatrix);for(i=0;i<3;++i)uniforms.eyePosition[i]=invCameraMatrix[12+i]/invCameraMatrix[15];var shader,w=invCameraMatrix[15];for(i=0;i<3;++i)w+=this.lightPosition[i]*invCameraMatrix[4*i+3];for(i=0;i<3;++i){for(var s=invCameraMatrix[12+i],j=0;j<3;++j)s+=invCameraMatrix[4*j+i]*this.lightPosition[j];uniforms.lightPosition[i]=s/w}this.triangleCount>0&&((shader=this.triShader).bind(),shader.uniforms=uniforms,this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind());this.edgeCount>0&&this.lineWidth>0&&((shader=this.lineShader).bind(),shader.uniforms=uniforms,this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind());this.pointCount>0&&((shader=this.pointShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind());this.contourEnable&&this.contourCount>0&&this.contourLineWidth>0&&((shader=this.contourShader).bind(),shader.uniforms=uniforms,this.contourVAO.bind(),gl.drawArrays(gl.LINES,0,this.contourCount),this.contourVAO.unbind())},proto.drawPick=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);this._model=[].slice.call(model),this._view=[].slice.call(view),this._projection=[].slice.call(projection),this._resolution=[gl.drawingBufferWidth,gl.drawingBufferHeight];var shader,uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,vectorScale:this.vectorScale,coneScale:this.coneScale,coneOffset:this.coneOffset,pickId:this.pickId/255};((shader=this.pickShader).bind(),shader.uniforms=uniforms,this.triangleCount>0&&(this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind()),this.edgeCount>0&&(this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind()),this.pointCount>0)&&((shader=this.pointPickShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind())},proto.pick=function(pickData){if(!pickData)return null;if(pickData.id!==this.pickId)return null;var cellId=pickData.value[0]+256*pickData.value[1]+65536*pickData.value[2],cell=this.cells[cellId],pos=this.positions[cell[1]].slice(0,3);return{index:Math.floor(cell[1]/48),position:pos,dataCoordinate:pos}},proto.dispose=function(){this.texture.dispose(),this.triShader.dispose(),this.pickShader.dispose(),this.triangleVAO.dispose(),this.trianglePositions.dispose(),this.triangleVectors.dispose(),this.triangleColors.dispose(),this.triangleUVs.dispose(),this.triangleNormals.dispose(),this.triangleIds.dispose(),this.edgeVAO.dispose(),this.edgePositions.dispose(),this.edgeColors.dispose(),this.edgeUVs.dispose(),this.edgeIds.dispose(),this.pointVAO.dispose(),this.pointPositions.dispose(),this.pointColors.dispose(),this.pointUVs.dispose(),this.pointSizes.dispose(),this.pointIds.dispose(),this.contourVAO.dispose(),this.contourPositions.dispose()},module.exports=function createSimplicialMesh(gl,params){1===arguments.length&&(gl=(params=gl).gl);var triShader=params.triShader||function createMeshShader(gl){var shader=createShader(gl,meshShader.vertex,meshShader.fragment,null,meshShader.attributes);return shader.attributes.position.location=0,shader.attributes.color.location=2,shader.attributes.uv.location=3,shader.attributes.vector.location=5,shader}(gl),pickShader=createPickShader(gl),meshTexture=createTexture(gl,ndarray(new Uint8Array([255,255,255,255]),[1,1,4]));meshTexture.generateMipmap(),meshTexture.minFilter=gl.LINEAR_MIPMAP_LINEAR,meshTexture.magFilter=gl.LINEAR;var trianglePositions=createBuffer(gl),triangleVectors=createBuffer(gl),triangleColors=createBuffer(gl),triangleUVs=createBuffer(gl),triangleNormals=createBuffer(gl),triangleIds=createBuffer(gl),triangleVAO=createVAO(gl,[{buffer:trianglePositions,type:gl.FLOAT,size:4},{buffer:triangleIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:triangleColors,type:gl.FLOAT,size:4},{buffer:triangleUVs,type:gl.FLOAT,size:2},{buffer:triangleNormals,type:gl.FLOAT,size:3},{buffer:triangleVectors,type:gl.FLOAT,size:3}]),edgePositions=createBuffer(gl),edgeColors=createBuffer(gl),edgeUVs=createBuffer(gl),edgeIds=createBuffer(gl),edgeVAO=createVAO(gl,[{buffer:edgePositions,type:gl.FLOAT,size:3},{buffer:edgeIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:edgeColors,type:gl.FLOAT,size:4},{buffer:edgeUVs,type:gl.FLOAT,size:2}]),pointPositions=createBuffer(gl),pointColors=createBuffer(gl),pointUVs=createBuffer(gl),pointSizes=createBuffer(gl),pointIds=createBuffer(gl),pointVAO=createVAO(gl,[{buffer:pointPositions,type:gl.FLOAT,size:3},{buffer:pointIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:pointColors,type:gl.FLOAT,size:4},{buffer:pointUVs,type:gl.FLOAT,size:2},{buffer:pointSizes,type:gl.FLOAT,size:1}]),contourPositions=createBuffer(gl),mesh=new SimplicialMesh(gl,meshTexture,triShader,null,null,pickShader,null,null,trianglePositions,triangleVectors,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,createVAO(gl,[{buffer:contourPositions,type:gl.FLOAT,size:3}]));return mesh.update(params),mesh}},{"./closest-point":231,"./shaders":233,colormap:113,"gl-buffer":229,"gl-mat4/invert":253,"gl-mat4/multiply":255,"gl-shader":286,"gl-texture2d":303,"gl-vao":308,ndarray:430,normals:433,"simplicial-complex-contour":491,"typedarray-pool":519}],233:[function(_dereq_,module,exports){var glslify=_dereq_("glslify"),triVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nvec3 getOrthogonalVector(vec3 v) {\n  // Return up-vector for only-z vector.\n  // Return ax + by + cz = 0, a point that lies on the plane that has v as a normal and that isn't (0,0,0).\n  // From the above if-statement we have ||a|| > 0  U  ||b|| > 0.\n  // Assign z = 0, x = -b, y = a:\n  // a*-b + b*a + c*0 = -ba + ba + 0 = 0\n  if (v.x*v.x > v.z*v.z || v.y*v.y > v.z*v.z) {\n    return normalize(vec3(-v.y, v.x, 0.0));\n  } else {\n    return normalize(vec3(0.0, v.z, -v.y));\n  }\n}\n\n// Calculate the cone vertex and normal at the given index.\n//\n// The returned vertex is for a cone with its top at origin and height of 1.0,\n// pointing in the direction of the vector attribute.\n//\n// Each cone is made up of a top vertex, a center base vertex and base perimeter vertices.\n// These vertices are used to make up the triangles of the cone by the following:\n//   segment + 0 top vertex\n//   segment + 1 perimeter vertex a+1\n//   segment + 2 perimeter vertex a\n//   segment + 3 center base vertex\n//   segment + 4 perimeter vertex a\n//   segment + 5 perimeter vertex a+1\n// Where segment is the number of the radial segment * 6 and a is the angle at that radial segment.\n// To go from index to segment, floor(index / 6)\n// To go from segment to angle, 2*pi * (segment/segmentCount)\n// To go from index to segment index, index - (segment*6)\n//\nvec3 getConePosition(vec3 d, float index, float coneOffset, out vec3 normal) {\n\n  const float segmentCount = 8.0;\n\n  index = mod(index, segmentCount * 6.0);\n\n  float segment = floor(index/6.0);\n  float segmentIndex = index - (segment*6.0);\n\n  normal = -normalize(d);\n\n  if (segmentIndex == 3.0) {\n    return mix(vec3(0.0), -d, coneOffset);\n  }\n\n  // angle = 2pi * ((segment + ((segmentIndex == 1.0 || segmentIndex == 5.0) ? 1.0 : 0.0)) / segmentCount)\n  float nextAngle = float(segmentIndex == 1.0 || segmentIndex == 5.0);\n  float angle = 2.0 * 3.14159 * ((segment + nextAngle) / segmentCount);\n\n  vec3 v1 = mix(d, vec3(0.0), coneOffset);\n  vec3 v2 = v1 - d;\n\n  vec3 u = getOrthogonalVector(d);\n  vec3 v = normalize(cross(u, d));\n\n  vec3 x = u * cos(angle) * length(d)*0.25;\n  vec3 y = v * sin(angle) * length(d)*0.25;\n  vec3 v3 = v2 + x + y;\n  if (segmentIndex <= 2.0) {\n    vec3 tx = u * sin(angle);\n    vec3 ty = v * -cos(angle);\n    vec3 tangent = tx + ty;\n    normal = normalize(cross(v3 - v1, tangent));\n  }\n\n  if (segmentIndex == 0.0) {\n    return mix(d, vec3(0.0), coneOffset);\n  }\n  return v3;\n}\n\nattribute vec3 vector;\nattribute vec4 color, position;\nattribute vec2 uv;\nuniform float vectorScale;\nuniform float coneScale;\n\nuniform float coneOffset;\n\nuniform mat4 model\n           , view\n           , projection;\nuniform vec3 eyePosition\n           , lightPosition;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  // Scale the vector magnitude to stay constant with\n  // model & view changes.\n  vec3 normal;\n  vec4 conePosition = model * vec4(position.xyz, 1.0) + vec4(getConePosition(mat3(model) * ((vectorScale * coneScale) * vector), position.w, coneOffset, normal), 0.0);\n  normal = normalize(normal * inverse(mat3(model)));\n\n  // vec4 m_position  = model * vec4(conePosition, 1.0);\n  vec4 t_position  = view * conePosition;\n  gl_Position      = projection * t_position;\n  f_color          = color; //vec4(position.w, color.r, 0, 0);\n  f_normal         = normal;\n  f_data           = conePosition.xyz;\n  f_eyeDirection   = eyePosition   - conePosition.xyz;\n  f_lightDirection = lightPosition - conePosition.xyz;\n  f_uv             = uv;\n}\n"]),triFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nfloat beckmannDistribution(float x, float roughness) {\n  float NdotH = max(x, 0.0001);\n  float cos2Alpha = NdotH * NdotH;\n  float tan2Alpha = (cos2Alpha - 1.0) / cos2Alpha;\n  float roughness2 = roughness * roughness;\n  float denom = 3.141592653589793 * roughness2 * cos2Alpha * cos2Alpha;\n  return exp(tan2Alpha / roughness2) / denom;\n}\n\nfloat cookTorranceSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float roughness,\n  float fresnel) {\n\n  float VdotN = max(dot(viewDirection, surfaceNormal), 0.0);\n  float LdotN = max(dot(lightDirection, surfaceNormal), 0.0);\n\n  //Half angle vector\n  vec3 H = normalize(lightDirection + viewDirection);\n\n  //Geometric term\n  float NdotH = max(dot(surfaceNormal, H), 0.0);\n  float VdotH = max(dot(viewDirection, H), 0.000001);\n  float LdotH = max(dot(lightDirection, H), 0.000001);\n  float G1 = (2.0 * NdotH * VdotN) / VdotH;\n  float G2 = (2.0 * NdotH * LdotN) / LdotH;\n  float G = min(1.0, min(G1, G2));\n  \n  //Distribution term\n  float D = beckmannDistribution(NdotH, roughness);\n\n  //Fresnel term\n  float F = pow(1.0 - VdotN, fresnel);\n\n  //Multiply terms and done\n  return  G * F * D / max(3.14159265 * VdotN, 0.000001);\n}\n\nuniform vec3 clipBounds[2];\nuniform float roughness\n            , fresnel\n            , kambient\n            , kdiffuse\n            , kspecular\n            , opacity;\nuniform sampler2D texture;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  //if(any(lessThan(f_data, clipBounds[0])) || \n  //   any(greaterThan(f_data, clipBounds[1]))) {\n  //  discard;\n  //}\n\n  vec3 N = normalize(f_normal);\n  vec3 L = normalize(f_lightDirection);\n  vec3 V = normalize(f_eyeDirection);\n  \n  if(!gl_FrontFacing) {\n    N = -N;\n  }\n\n  float specular = cookTorranceSpecular(L, V, N, roughness, fresnel);\n  float diffuse  = min(kambient + kdiffuse * max(dot(N, L), 0.0), 1.0);\n\n  vec4 surfaceColor =  texture2D(texture, f_uv);\n  vec4 litColor = surfaceColor.a * vec4(diffuse * surfaceColor.rgb + kspecular * vec3(1,1,1) * specular,  1.0);\n\n  gl_FragColor = litColor * opacity;\n}"]),pickVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvec3 getOrthogonalVector(vec3 v) {\n  // Return up-vector for only-z vector.\n  // Return ax + by + cz = 0, a point that lies on the plane that has v as a normal and that isn't (0,0,0).\n  // From the above if-statement we have ||a|| > 0  U  ||b|| > 0.\n  // Assign z = 0, x = -b, y = a:\n  // a*-b + b*a + c*0 = -ba + ba + 0 = 0\n  if (v.x*v.x > v.z*v.z || v.y*v.y > v.z*v.z) {\n    return normalize(vec3(-v.y, v.x, 0.0));\n  } else {\n    return normalize(vec3(0.0, v.z, -v.y));\n  }\n}\n\n// Calculate the cone vertex and normal at the given index.\n//\n// The returned vertex is for a cone with its top at origin and height of 1.0,\n// pointing in the direction of the vector attribute.\n//\n// Each cone is made up of a top vertex, a center base vertex and base perimeter vertices.\n// These vertices are used to make up the triangles of the cone by the following:\n//   segment + 0 top vertex\n//   segment + 1 perimeter vertex a+1\n//   segment + 2 perimeter vertex a\n//   segment + 3 center base vertex\n//   segment + 4 perimeter vertex a\n//   segment + 5 perimeter vertex a+1\n// Where segment is the number of the radial segment * 6 and a is the angle at that radial segment.\n// To go from index to segment, floor(index / 6)\n// To go from segment to angle, 2*pi * (segment/segmentCount)\n// To go from index to segment index, index - (segment*6)\n//\nvec3 getConePosition(vec3 d, float index, float coneOffset, out vec3 normal) {\n\n  const float segmentCount = 8.0;\n\n  index = mod(index, segmentCount * 6.0);\n\n  float segment = floor(index/6.0);\n  float segmentIndex = index - (segment*6.0);\n\n  normal = -normalize(d);\n\n  if (segmentIndex == 3.0) {\n    return mix(vec3(0.0), -d, coneOffset);\n  }\n\n  // angle = 2pi * ((segment + ((segmentIndex == 1.0 || segmentIndex == 5.0) ? 1.0 : 0.0)) / segmentCount)\n  float nextAngle = float(segmentIndex == 1.0 || segmentIndex == 5.0);\n  float angle = 2.0 * 3.14159 * ((segment + nextAngle) / segmentCount);\n\n  vec3 v1 = mix(d, vec3(0.0), coneOffset);\n  vec3 v2 = v1 - d;\n\n  vec3 u = getOrthogonalVector(d);\n  vec3 v = normalize(cross(u, d));\n\n  vec3 x = u * cos(angle) * length(d)*0.25;\n  vec3 y = v * sin(angle) * length(d)*0.25;\n  vec3 v3 = v2 + x + y;\n  if (segmentIndex <= 2.0) {\n    vec3 tx = u * sin(angle);\n    vec3 ty = v * -cos(angle);\n    vec3 tangent = tx + ty;\n    normal = normalize(cross(v3 - v1, tangent));\n  }\n\n  if (segmentIndex == 0.0) {\n    return mix(d, vec3(0.0), coneOffset);\n  }\n  return v3;\n}\n\nattribute vec3 vector;\nattribute vec4 position;\nattribute vec4 id;\n\nuniform mat4 model, view, projection;\n\nuniform float vectorScale;\nuniform float coneScale;\nuniform float coneOffset;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  vec3 normal;\n  vec4 conePosition = model * vec4(position.xyz, 1.0) + vec4(getConePosition(mat3(model) * ((vectorScale * coneScale) * vector), position.w, coneOffset, normal), 0.0);\n  gl_Position = projection * view * conePosition;\n  f_id        = id;\n  f_position  = position.xyz;\n}\n"]),pickFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3  clipBounds[2];\nuniform float pickId;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  if(any(lessThan(f_position, clipBounds[0])) || \n     any(greaterThan(f_position, clipBounds[1]))) {\n    discard;\n  }\n  gl_FragColor = vec4(pickId, f_id.xyz);\n}"]);exports.meshShader={vertex:triVertSrc,fragment:triFragSrc,attributes:[{name:"position",type:"vec4"},{name:"normal",type:"vec3"},{name:"color",type:"vec4"},{name:"uv",type:"vec2"},{name:"vector",type:"vec3"}]},exports.pickShader={vertex:pickVertSrc,fragment:pickFragSrc,attributes:[{name:"position",type:"vec4"},{name:"id",type:"vec4"},{name:"vector",type:"vec3"}]}},{glslify:390}],234:[function(_dereq_,module,exports){module.exports={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34000:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"}},{}],235:[function(_dereq_,module,exports){var gl10=_dereq_("./1.0/numbers");module.exports=function lookupConstant(number){return gl10[number]}},{"./1.0/numbers":234}],236:[function(_dereq_,module,exports){"use strict";module.exports=function createErrorBars(options){var gl=options.gl,buffer=createBuffer(gl),vao=createVAO(gl,[{buffer:buffer,type:gl.FLOAT,size:3,offset:0,stride:40},{buffer:buffer,type:gl.FLOAT,size:4,offset:12,stride:40},{buffer:buffer,type:gl.FLOAT,size:3,offset:28,stride:40}]),shader=createShader(gl);shader.attributes.position.location=0,shader.attributes.color.location=1,shader.attributes.offset.location=2;var result=new ErrorBars(gl,buffer,vao,shader);return result.update(options),result};var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createShader=_dereq_("./shaders/index"),IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function ErrorBars(gl,buffer,vao,shader){this.gl=gl,this.shader=shader,this.buffer=buffer,this.vao=vao,this.pixelRatio=1,this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.lineWidth=[1,1,1],this.capSize=[10,10,10],this.lineCount=[0,0,0],this.lineOffset=[0,0,0],this.opacity=1}var proto=ErrorBars.prototype;function updateBounds(bounds,point){for(var i=0;i<3;++i)bounds[0][i]=Math.min(bounds[0][i],point[i]),bounds[1][i]=Math.max(bounds[1][i],point[i])}proto.isOpaque=function(){return this.opacity>=1},proto.isTransparent=function(){return this.opacity<1},proto.drawTransparent=proto.draw=function(cameraParams){var gl=this.gl,uniforms=this.shader.uniforms;this.shader.bind();var view=uniforms.view=cameraParams.view||IDENTITY,projection=uniforms.projection=cameraParams.projection||IDENTITY;uniforms.model=cameraParams.model||IDENTITY,uniforms.clipBounds=this.clipBounds,uniforms.opacity=this.opacity;var cx=view[12],cy=view[13],cz=view[14],cw=view[15],pixelScaleF=this.pixelRatio*(projection[3]*cx+projection[7]*cy+projection[11]*cz+projection[15]*cw)/gl.drawingBufferHeight;this.vao.bind();for(var i=0;i<3;++i)gl.lineWidth(this.lineWidth[i]),uniforms.capSize=this.capSize[i]*pixelScaleF,this.lineCount[i]&&gl.drawArrays(gl.LINES,this.lineOffset[i],this.lineCount[i]);this.vao.unbind()};var FACE_TABLE=function(){for(var table=new Array(3),d=0;d<3;++d){for(var row=[],j=1;j<=2;++j)for(var s=-1;s<=1;s+=2){var y=[0,0,0];y[(j+d)%3]=s,row.push(y)}table[d]=row}return table}();function emitFace(verts,x,c,d){for(var offsets=FACE_TABLE[d],i=0;i<offsets.length;++i){var o=offsets[i];verts.push(x[0],x[1],x[2],c[0],c[1],c[2],c[3],o[0],o[1],o[2])}return offsets.length}proto.update=function(options){"lineWidth"in(options=options||{})&&(this.lineWidth=options.lineWidth,Array.isArray(this.lineWidth)||(this.lineWidth=[this.lineWidth,this.lineWidth,this.lineWidth])),"capSize"in options&&(this.capSize=options.capSize,Array.isArray(this.capSize)||(this.capSize=[this.capSize,this.capSize,this.capSize])),"opacity"in options&&(this.opacity=options.opacity);var color=options.color||[[0,0,0],[0,0,0],[0,0,0]],position=options.position,error=options.error;if(Array.isArray(color[0])||(color=[color,color,color]),position&&error){var verts=[],n=position.length,vertexCount=0;this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.lineCount=[0,0,0];for(var j=0;j<3;++j){this.lineOffset[j]=vertexCount;i_loop:for(var i=0;i<n;++i){for(var p=position[i],k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue i_loop;var e=error[i],c=color[j];if(Array.isArray(c[0])&&(c=color[i]),3===c.length&&(c=[c[0],c[1],c[2],1]),!isNaN(e[0][j])&&!isNaN(e[1][j])){var x;if(e[0][j]<0)(x=p.slice())[j]+=e[0][j],verts.push(p[0],p[1],p[2],c[0],c[1],c[2],c[3],0,0,0,x[0],x[1],x[2],c[0],c[1],c[2],c[3],0,0,0),updateBounds(this.bounds,x),vertexCount+=2+emitFace(verts,x,c,j);if(e[1][j]>0)(x=p.slice())[j]+=e[1][j],verts.push(p[0],p[1],p[2],c[0],c[1],c[2],c[3],0,0,0,x[0],x[1],x[2],c[0],c[1],c[2],c[3],0,0,0),updateBounds(this.bounds,x),vertexCount+=2+emitFace(verts,x,c,j)}}this.lineCount[j]=vertexCount-this.lineOffset[j]}this.buffer.update(verts)}},proto.dispose=function(){this.shader.dispose(),this.buffer.dispose(),this.vao.dispose()}},{"./shaders/index":237,"gl-buffer":229,"gl-vao":308}],237:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify"),createShader=_dereq_("gl-shader"),vertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position, offset;\nattribute vec4 color;\nuniform mat4 model, view, projection;\nuniform float capSize;\nvarying vec4 fragColor;\nvarying vec3 fragPosition;\n\nvoid main() {\n  vec4 worldPosition  = model * vec4(position, 1.0);\n  worldPosition       = (worldPosition / worldPosition.w) + vec4(capSize * offset, 0.0);\n  gl_Position         = projection * view * worldPosition;\n  fragColor           = color;\n  fragPosition        = position;\n}"]),fragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\nuniform vec3 clipBounds[2];\nuniform float opacity;\nvarying vec3 fragPosition;\nvarying vec4 fragColor;\n\nvoid main() {\n  if(any(lessThan(fragPosition, clipBounds[0])) || any(greaterThan(fragPosition, clipBounds[1]))) {\n    discard;\n  }\n  gl_FragColor = opacity * fragColor;\n}"]);module.exports=function(gl){return createShader(gl,vertSrc,fragSrc,null,[{name:"position",type:"vec3"},{name:"color",type:"vec4"},{name:"offset",type:"vec3"}])}},{"gl-shader":286,glslify:390}],238:[function(_dereq_,module,exports){"use strict";var createTexture=_dereq_("gl-texture2d");module.exports=function createFBO(gl,width,height,options){FRAMEBUFFER_UNSUPPORTED||(FRAMEBUFFER_UNSUPPORTED=gl.FRAMEBUFFER_UNSUPPORTED,FRAMEBUFFER_INCOMPLETE_ATTACHMENT=gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT,FRAMEBUFFER_INCOMPLETE_DIMENSIONS=gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT);var WEBGL_draw_buffers=gl.getExtension("WEBGL_draw_buffers");!colorAttachmentArrays&&WEBGL_draw_buffers&&function lazyInitColorAttachments(gl,ext){var maxColorAttachments=gl.getParameter(ext.MAX_COLOR_ATTACHMENTS_WEBGL);colorAttachmentArrays=new Array(maxColorAttachments+1);for(var i=0;i<=maxColorAttachments;++i){for(var x=new Array(maxColorAttachments),j=0;j<i;++j)x[j]=gl.COLOR_ATTACHMENT0+j;for(var j=i;j<maxColorAttachments;++j)x[j]=gl.NONE;colorAttachmentArrays[i]=x}}(gl,WEBGL_draw_buffers);Array.isArray(width)&&(options=height,height=0|width[1],width=0|width[0]);if("number"!=typeof width)throw new Error("gl-fbo: Missing shape parameter");var maxFBOSize=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);if(width<0||width>maxFBOSize||height<0||height>maxFBOSize)throw new Error("gl-fbo: Parameters are too large for FBO");var numColors=1;if("color"in(options=options||{})){if((numColors=Math.max(0|options.color,0))<0)throw new Error("gl-fbo: Must specify a nonnegative number of colors");if(numColors>1){if(!WEBGL_draw_buffers)throw new Error("gl-fbo: Multiple draw buffer extension not supported");if(numColors>gl.getParameter(WEBGL_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL))throw new Error("gl-fbo: Context does not support "+numColors+" draw buffers")}}var colorType=gl.UNSIGNED_BYTE,OES_texture_float=gl.getExtension("OES_texture_float");if(options.float&&numColors>0){if(!OES_texture_float)throw new Error("gl-fbo: Context does not support floating point textures");colorType=gl.FLOAT}else options.preferFloat&&numColors>0&&OES_texture_float&&(colorType=gl.FLOAT);var useDepth=!0;"depth"in options&&(useDepth=!!options.depth);var useStencil=!1;"stencil"in options&&(useStencil=!!options.stencil);return new Framebuffer(gl,width,height,colorType,numColors,useDepth,useStencil,WEBGL_draw_buffers)};var FRAMEBUFFER_UNSUPPORTED,FRAMEBUFFER_INCOMPLETE_ATTACHMENT,FRAMEBUFFER_INCOMPLETE_DIMENSIONS,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT,colorAttachmentArrays=null;function saveFBOState(gl){return[gl.getParameter(gl.FRAMEBUFFER_BINDING),gl.getParameter(gl.RENDERBUFFER_BINDING),gl.getParameter(gl.TEXTURE_BINDING_2D)]}function restoreFBOState(gl,data){gl.bindFramebuffer(gl.FRAMEBUFFER,data[0]),gl.bindRenderbuffer(gl.RENDERBUFFER,data[1]),gl.bindTexture(gl.TEXTURE_2D,data[2])}function throwFBOError(status){switch(status){case FRAMEBUFFER_UNSUPPORTED:throw new Error("gl-fbo: Framebuffer unsupported");case FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("gl-fbo: Framebuffer incomplete attachment");case FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("gl-fbo: Framebuffer incomplete dimensions");case FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("gl-fbo: Framebuffer incomplete missing attachment");default:throw new Error("gl-fbo: Framebuffer failed for unspecified reason")}}function initTexture(gl,width,height,type,format,attachment){if(!type)return null;var result=createTexture(gl,width,height,format,type);return result.magFilter=gl.NEAREST,result.minFilter=gl.NEAREST,result.mipSamples=1,result.bind(),gl.framebufferTexture2D(gl.FRAMEBUFFER,attachment,gl.TEXTURE_2D,result.handle,0),result}function initRenderBuffer(gl,width,height,component,attachment){var result=gl.createRenderbuffer();return gl.bindRenderbuffer(gl.RENDERBUFFER,result),gl.renderbufferStorage(gl.RENDERBUFFER,component,width,height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,attachment,gl.RENDERBUFFER,result),result}function Framebuffer(gl,width,height,colorType,numColors,useDepth,useStencil,ext){this.gl=gl,this._shape=[0|width,0|height],this._destroyed=!1,this._ext=ext,this.color=new Array(numColors);for(var i=0;i<numColors;++i)this.color[i]=null;this._color_rb=null,this.depth=null,this._depth_rb=null,this._colorType=colorType,this._useDepth=useDepth,this._useStencil=useStencil;var parent=this,shapeVector=[0|width,0|height];Object.defineProperties(shapeVector,{0:{get:function(){return parent._shape[0]},set:function(w){return parent.width=w}},1:{get:function(){return parent._shape[1]},set:function(h){return parent.height=h}}}),this._shapeVector=shapeVector,function rebuildFBO(fbo){var state=saveFBOState(fbo.gl),gl=fbo.gl,handle=fbo.handle=gl.createFramebuffer(),width=fbo._shape[0],height=fbo._shape[1],numColors=fbo.color.length,ext=fbo._ext,useStencil=fbo._useStencil,useDepth=fbo._useDepth,colorType=fbo._colorType;gl.bindFramebuffer(gl.FRAMEBUFFER,handle);for(var i=0;i<numColors;++i)fbo.color[i]=initTexture(gl,width,height,colorType,gl.RGBA,gl.COLOR_ATTACHMENT0+i);0===numColors?(fbo._color_rb=initRenderBuffer(gl,width,height,gl.RGBA4,gl.COLOR_ATTACHMENT0),ext&&ext.drawBuffersWEBGL(colorAttachmentArrays[0])):numColors>1&&ext.drawBuffersWEBGL(colorAttachmentArrays[numColors]);var WEBGL_depth_texture=gl.getExtension("WEBGL_depth_texture");WEBGL_depth_texture?useStencil?fbo.depth=initTexture(gl,width,height,WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL,gl.DEPTH_STENCIL,gl.DEPTH_STENCIL_ATTACHMENT):useDepth&&(fbo.depth=initTexture(gl,width,height,gl.UNSIGNED_SHORT,gl.DEPTH_COMPONENT,gl.DEPTH_ATTACHMENT)):useDepth&&useStencil?fbo._depth_rb=initRenderBuffer(gl,width,height,gl.DEPTH_STENCIL,gl.DEPTH_STENCIL_ATTACHMENT):useDepth?fbo._depth_rb=initRenderBuffer(gl,width,height,gl.DEPTH_COMPONENT16,gl.DEPTH_ATTACHMENT):useStencil&&(fbo._depth_rb=initRenderBuffer(gl,width,height,gl.STENCIL_INDEX,gl.STENCIL_ATTACHMENT));var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(status!==gl.FRAMEBUFFER_COMPLETE){for(fbo._destroyed=!0,gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.deleteFramebuffer(fbo.handle),fbo.handle=null,fbo.depth&&(fbo.depth.dispose(),fbo.depth=null),fbo._depth_rb&&(gl.deleteRenderbuffer(fbo._depth_rb),fbo._depth_rb=null),i=0;i<fbo.color.length;++i)fbo.color[i].dispose(),fbo.color[i]=null;fbo._color_rb&&(gl.deleteRenderbuffer(fbo._color_rb),fbo._color_rb=null),restoreFBOState(gl,state),throwFBOError(status)}restoreFBOState(gl,state)}(this)}var proto=Framebuffer.prototype;function reshapeFBO(fbo,w,h){if(fbo._destroyed)throw new Error("gl-fbo: Can't resize destroyed FBO");if(fbo._shape[0]!==w||fbo._shape[1]!==h){var gl=fbo.gl,maxFBOSize=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);if(w<0||w>maxFBOSize||h<0||h>maxFBOSize)throw new Error("gl-fbo: Can't resize FBO, invalid dimensions");fbo._shape[0]=w,fbo._shape[1]=h;for(var state=saveFBOState(gl),i=0;i<fbo.color.length;++i)fbo.color[i].shape=fbo._shape;fbo._color_rb&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo._color_rb),gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGBA4,fbo._shape[0],fbo._shape[1])),fbo.depth&&(fbo.depth.shape=fbo._shape),fbo._depth_rb&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo._depth_rb),fbo._useDepth&&fbo._useStencil?gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,fbo._shape[0],fbo._shape[1]):fbo._useDepth?gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,fbo._shape[0],fbo._shape[1]):fbo._useStencil&&gl.renderbufferStorage(gl.RENDERBUFFER,gl.STENCIL_INDEX,fbo._shape[0],fbo._shape[1])),gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.handle);var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);status!==gl.FRAMEBUFFER_COMPLETE&&(fbo.dispose(),restoreFBOState(gl,state),throwFBOError(status)),restoreFBOState(gl,state)}}Object.defineProperties(proto,{shape:{get:function(){return this._destroyed?[0,0]:this._shapeVector},set:function(x){if(Array.isArray(x)||(x=[0|x,0|x]),2!==x.length)throw new Error("gl-fbo: Shape vector must be length 2");var w=0|x[0],h=0|x[1];return reshapeFBO(this,w,h),[w,h]},enumerable:!1},width:{get:function(){return this._destroyed?0:this._shape[0]},set:function(w){return reshapeFBO(this,w|=0,this._shape[1]),w},enumerable:!1},height:{get:function(){return this._destroyed?0:this._shape[1]},set:function(h){return h|=0,reshapeFBO(this,this._shape[0],h),h},enumerable:!1}}),proto.bind=function(){if(!this._destroyed){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.handle),gl.viewport(0,0,this._shape[0],this._shape[1])}},proto.dispose=function(){if(!this._destroyed){this._destroyed=!0;var gl=this.gl;gl.deleteFramebuffer(this.handle),this.handle=null,this.depth&&(this.depth.dispose(),this.depth=null),this._depth_rb&&(gl.deleteRenderbuffer(this._depth_rb),this._depth_rb=null);for(var i=0;i<this.color.length;++i)this.color[i].dispose(),this.color[i]=null;this._color_rb&&(gl.deleteRenderbuffer(this._color_rb),this._color_rb=null)}}},{"gl-texture2d":303}],239:[function(_dereq_,module,exports){var sprintf=_dereq_("sprintf-js").sprintf,glConstants=_dereq_("gl-constants/lookup"),shaderName=_dereq_("glsl-shader-name"),addLineNumbers=_dereq_("add-line-numbers");module.exports=function formatCompilerError(errLog,src,type){"use strict";var name=shaderName(src)||"of unknown name (see npm glsl-shader-name)",typeName="unknown type";void 0!==type&&(typeName=type===glConstants.FRAGMENT_SHADER?"fragment":"vertex");for(var longForm=sprintf("Error compiling %s shader %s:\n",typeName,name),shortForm=sprintf("%s%s",longForm,errLog),errorStrings=errLog.split("\n"),errors={},i=0;i<errorStrings.length;i++){var errorString=errorStrings[i];if(""!==errorString&&"\0"!==errorString){var lineNo=parseInt(errorString.split(":")[2]);if(isNaN(lineNo))throw new Error(sprintf("Could not parse error: %s",errorString));errors[lineNo]=errorString}}for(var lines=addLineNumbers(src).split("\n"),i=0;i<lines.length;i++)if(errors[i+3]||errors[i+2]||errors[i+1]){var line=lines[i];if(longForm+=line+"\n",errors[i+1]){var e=errors[i+1];e=e.substr(e.split(":",3).join(":").length+1).trim(),longForm+=sprintf("^^^ %s\n\n",e)}}return{long:longForm.trim(),short:shortForm.trim()}}},{"add-line-numbers":48,"gl-constants/lookup":235,"glsl-shader-name":382,"sprintf-js":501}],240:[function(_dereq_,module,exports){"use strict";module.exports=function createHeatmap2D(plot,options){var gl=plot.gl,shader=createShader(gl,shaders.vertex,shaders.fragment),pickShader=createShader(gl,shaders.pickVertex,shaders.pickFragment),positionBuffer=createBuffer(gl),weightBuffer=createBuffer(gl),colorBuffer=createBuffer(gl),idBuffer=createBuffer(gl),heatmap=new GLHeatmap2D(plot,shader,pickShader,positionBuffer,weightBuffer,colorBuffer,idBuffer);return heatmap.update(options),plot.addObject(heatmap),heatmap};var bsearch=_dereq_("binary-search-bounds"),iota=_dereq_("iota-array"),pool=_dereq_("typedarray-pool"),createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),shaders=_dereq_("./lib/shaders");function GLHeatmap2D(plot,shader,pickShader,positionBuffer,weightBuffer,colorBuffer,idBuffer){this.plot=plot,this.shader=shader,this.pickShader=pickShader,this.positionBuffer=positionBuffer,this.weightBuffer=weightBuffer,this.colorBuffer=colorBuffer,this.idBuffer=idBuffer,this.xData=[],this.yData=[],this.shape=[0,0],this.bounds=[1/0,1/0,-1/0,-1/0],this.pickOffset=0}var MATRIX,proto=GLHeatmap2D.prototype,WEIGHTS=[0,0,1,0,0,1,1,0,1,1,0,1];proto.draw=(MATRIX=[1,0,0,0,1,0,0,0,1],function(){var plot=this.plot,shader=this.shader,bounds=this.bounds,numVertices=this.numVertices;if(!(numVertices<=0)){var gl=plot.gl,dataBox=plot.dataBox,boundX=bounds[2]-bounds[0],boundY=bounds[3]-bounds[1],dataX=dataBox[2]-dataBox[0],dataY=dataBox[3]-dataBox[1];MATRIX[0]=2*boundX/dataX,MATRIX[4]=2*boundY/dataY,MATRIX[6]=2*(bounds[0]-dataBox[0])/dataX-1,MATRIX[7]=2*(bounds[1]-dataBox[1])/dataY-1,shader.bind();var uniforms=shader.uniforms;uniforms.viewTransform=MATRIX,uniforms.shape=this.shape;var attributes=shader.attributes;this.positionBuffer.bind(),attributes.position.pointer(),this.weightBuffer.bind(),attributes.weight.pointer(gl.UNSIGNED_BYTE,!1),this.colorBuffer.bind(),attributes.color.pointer(gl.UNSIGNED_BYTE,!0),gl.drawArrays(gl.TRIANGLES,0,numVertices)}}),proto.drawPick=function(){var MATRIX=[1,0,0,0,1,0,0,0,1],PICK_VECTOR=[0,0,0,0];return function(pickOffset){var plot=this.plot,shader=this.pickShader,bounds=this.bounds,numVertices=this.numVertices;if(!(numVertices<=0)){var gl=plot.gl,dataBox=plot.dataBox,boundX=bounds[2]-bounds[0],boundY=bounds[3]-bounds[1],dataX=dataBox[2]-dataBox[0],dataY=dataBox[3]-dataBox[1];MATRIX[0]=2*boundX/dataX,MATRIX[4]=2*boundY/dataY,MATRIX[6]=2*(bounds[0]-dataBox[0])/dataX-1,MATRIX[7]=2*(bounds[1]-dataBox[1])/dataY-1;for(var i=0;i<4;++i)PICK_VECTOR[i]=pickOffset>>8*i&255;this.pickOffset=pickOffset,shader.bind();var uniforms=shader.uniforms;uniforms.viewTransform=MATRIX,uniforms.pickOffset=PICK_VECTOR,uniforms.shape=this.shape;var attributes=shader.attributes;return this.positionBuffer.bind(),attributes.position.pointer(),this.weightBuffer.bind(),attributes.weight.pointer(gl.UNSIGNED_BYTE,!1),this.idBuffer.bind(),attributes.pickId.pointer(gl.UNSIGNED_BYTE,!1),gl.drawArrays(gl.TRIANGLES,0,numVertices),pickOffset+this.shape[0]*this.shape[1]}}}(),proto.pick=function(x,y,value){var pickOffset=this.pickOffset,pointCount=this.shape[0]*this.shape[1];if(value<pickOffset||value>=pickOffset+pointCount)return null;var pointId=value-pickOffset,xData=this.xData,yData=this.yData;return{object:this,pointId:pointId,dataCoord:[xData[pointId%this.shape[0]],yData[pointId/this.shape[0]|0]]}},proto.update=function(options){var shape=(options=options||{}).shape||[0,0],x=options.x||iota(shape[0]),y=options.y||iota(shape[1]),z=options.z||new Float32Array(shape[0]*shape[1]);this.xData=x,this.yData=y;var colorLevels=options.colorLevels||[0],colorValues=options.colorValues||[0,0,0,1],colorCount=colorLevels.length,bounds=this.bounds,lox=bounds[0]=x[0],loy=bounds[1]=y[0],xs=1/((bounds[2]=x[x.length-1])-lox),ys=1/((bounds[3]=y[y.length-1])-loy),numX=shape[0],numY=shape[1];this.shape=[numX,numY];var numVerts=(numX-1)*(numY-1)*(WEIGHTS.length>>>1);this.numVertices=numVerts;for(var colors=pool.mallocUint8(4*numVerts),positions=pool.mallocFloat32(2*numVerts),weights=pool.mallocUint8(2*numVerts),ids=pool.mallocUint32(numVerts),ptr=0,j=0;j<numY-1;++j)for(var yc0=ys*(y[j]-loy),yc1=ys*(y[j+1]-loy),i=0;i<numX-1;++i)for(var xc0=xs*(x[i]-lox),xc1=xs*(x[i+1]-lox),dd=0;dd<WEIGHTS.length;dd+=2){var r,g,b,a,dx=WEIGHTS[dd],dy=WEIGHTS[dd+1],zc=z[(j+dy)*numX+(i+dx)],colorIdx=bsearch.le(colorLevels,zc);if(colorIdx<0)r=colorValues[0],g=colorValues[1],b=colorValues[2],a=colorValues[3];else if(colorIdx===colorCount-1)r=colorValues[4*colorCount-4],g=colorValues[4*colorCount-3],b=colorValues[4*colorCount-2],a=colorValues[4*colorCount-1];else{var t=(zc-colorLevels[colorIdx])/(colorLevels[colorIdx+1]-colorLevels[colorIdx]),ti=1-t,i0=4*colorIdx,i1=4*(colorIdx+1);r=ti*colorValues[i0]+t*colorValues[i1],g=ti*colorValues[i0+1]+t*colorValues[i1+1],b=ti*colorValues[i0+2]+t*colorValues[i1+2],a=ti*colorValues[i0+3]+t*colorValues[i1+3]}colors[4*ptr]=255*r,colors[4*ptr+1]=255*g,colors[4*ptr+2]=255*b,colors[4*ptr+3]=255*a,positions[2*ptr]=.5*xc0+.5*xc1,positions[2*ptr+1]=.5*yc0+.5*yc1,weights[2*ptr]=dx,weights[2*ptr+1]=dy,ids[ptr]=j*numX+i,ptr+=1}this.positionBuffer.update(positions),this.weightBuffer.update(weights),this.colorBuffer.update(colors),this.idBuffer.update(ids),pool.free(positions),pool.free(colors),pool.free(weights),pool.free(ids)},proto.dispose=function(){this.shader.dispose(),this.pickShader.dispose(),this.positionBuffer.dispose(),this.weightBuffer.dispose(),this.colorBuffer.dispose(),this.idBuffer.dispose(),this.plot.removeObject(this)}},{"./lib/shaders":241,"binary-search-bounds":242,"gl-buffer":229,"gl-shader":286,"iota-array":397,"typedarray-pool":519}],241:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify");module.exports={fragment:glslify(["precision lowp float;\n#define GLSLIFY 1\nvarying vec4 fragColor;\nvoid main() {\n  gl_FragColor = vec4(fragColor.rgb * fragColor.a, fragColor.a);\n}\n"]),vertex:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 color;\nattribute vec2 weight;\n\nuniform vec2 shape;\nuniform mat3 viewTransform;\n\nvarying vec4 fragColor;\n\nvoid main() {\n  vec3 vPosition = viewTransform * vec3( position + (weight-.5)/(shape-1.) , 1.0);\n  fragColor = color;\n  gl_Position = vec4(vPosition.xy, 0, vPosition.z);\n}\n"]),pickFragment:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvarying vec4 fragId;\nvarying vec2 vWeight;\n\nuniform vec2 shape;\nuniform vec4 pickOffset;\n\nvoid main() {\n  vec2 d = step(.5, vWeight);\n  vec4 id = fragId + pickOffset;\n  id.x += d.x + d.y*shape.x;\n\n  id.y += floor(id.x / 256.0);\n  id.x -= floor(id.x / 256.0) * 256.0;\n\n  id.z += floor(id.y / 256.0);\n  id.y -= floor(id.y / 256.0) * 256.0;\n\n  id.w += floor(id.z / 256.0);\n  id.z -= floor(id.z / 256.0) * 256.0;\n\n  gl_FragColor = id/255.;\n}\n"]),pickVertex:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 pickId;\nattribute vec2 weight;\n\nuniform vec2 shape;\nuniform mat3 viewTransform;\n\nvarying vec4 fragId;\nvarying vec2 vWeight;\n\nvoid main() {\n  vWeight = weight;\n\n  fragId = pickId;\n\n  vec3 vPosition = viewTransform * vec3( position + (weight-.5)/(shape-1.) , 1.0);\n  gl_Position = vec4(vPosition.xy, 0, vPosition.z);\n}\n"])}},{glslify:390}],242:[function(_dereq_,module,exports){arguments[4][98][0].apply(exports,arguments)},{dup:98}],243:[function(_dereq_,module,exports){var glslify=_dereq_("glslify"),createShader=_dereq_("gl-shader"),vertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position, nextPosition;\nattribute float arcLength, lineWidth;\nattribute vec4 color;\n\nuniform vec2 screenShape;\nuniform float pixelRatio;\nuniform mat4 model, view, projection;\n\nvarying vec4 fragColor;\nvarying vec3 worldPosition;\nvarying float pixelArcLength;\n\nvoid main() {\n  vec4 projected = projection * view * model * vec4(position, 1.0);\n  vec4 tangentClip = projection * view * model * vec4(nextPosition - position, 0.0);\n  vec2 tangent = normalize(screenShape * tangentClip.xy);\n  vec2 offset = 0.5 * pixelRatio * lineWidth * vec2(tangent.y, -tangent.x) / screenShape;\n\n  gl_Position = vec4(projected.xy + projected.w * offset, projected.zw);\n\n  worldPosition = position;\n  pixelArcLength = arcLength;\n  fragColor = color;\n}\n"]),forwardFrag=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3      clipBounds[2];\nuniform sampler2D dashTexture;\nuniform float     dashScale;\nuniform float     opacity;\n\nvarying vec3    worldPosition;\nvarying float   pixelArcLength;\nvarying vec4    fragColor;\n\nvoid main() {\n  if(any(lessThan(worldPosition, clipBounds[0])) || any(greaterThan(worldPosition, clipBounds[1]))) {\n    discard;\n  }\n  float dashWeight = texture2D(dashTexture, vec2(dashScale * pixelArcLength, 0)).r;\n  if(dashWeight < 0.5) {\n    discard;\n  }\n  gl_FragColor = fragColor * opacity;\n}\n"]),pickFrag=glslify(["precision mediump float;\n#define GLSLIFY 1\n\n#define FLOAT_MAX  1.70141184e38\n#define FLOAT_MIN  1.17549435e-38\n\nlowp vec4 encode_float_1540259130(highp float v) {\n  highp float av = abs(v);\n\n  //Handle special cases\n  if(av < FLOAT_MIN) {\n    return vec4(0.0, 0.0, 0.0, 0.0);\n  } else if(v > FLOAT_MAX) {\n    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n  } else if(v < -FLOAT_MAX) {\n    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n  }\n\n  highp vec4 c = vec4(0,0,0,0);\n\n  //Compute exponent and mantissa\n  highp float e = floor(log2(av));\n  highp float m = av * pow(2.0, -e) - 1.0;\n  \n  //Unpack mantissa\n  c[1] = floor(128.0 * m);\n  m -= c[1] / 128.0;\n  c[2] = floor(32768.0 * m);\n  m -= c[2] / 32768.0;\n  c[3] = floor(8388608.0 * m);\n  \n  //Unpack exponent\n  highp float ebias = e + 127.0;\n  c[0] = floor(ebias / 2.0);\n  ebias -= c[0] * 2.0;\n  c[1] += floor(ebias) * 128.0; \n\n  //Unpack sign bit\n  c[0] += 128.0 * step(0.0, -v);\n\n  //Scale back to range\n  return c / 255.0;\n}\n\nuniform float pickId;\nuniform vec3 clipBounds[2];\n\nvarying vec3 worldPosition;\nvarying float pixelArcLength;\nvarying vec4 fragColor;\n\nvoid main() {\n  if(any(lessThan(worldPosition, clipBounds[0])) || any(greaterThan(worldPosition, clipBounds[1]))) {\n    discard;\n  }\n  gl_FragColor = vec4(pickId/255.0, encode_float_1540259130(pixelArcLength).xyz);\n}"]),ATTRIBUTES=[{name:"position",type:"vec3"},{name:"nextPosition",type:"vec3"},{name:"arcLength",type:"float"},{name:"lineWidth",type:"float"},{name:"color",type:"vec4"}];exports.createShader=function(gl){return createShader(gl,vertSrc,forwardFrag,null,ATTRIBUTES)},exports.createPickShader=function(gl){return createShader(gl,vertSrc,pickFrag,null,ATTRIBUTES)}},{"gl-shader":286,glslify:390}],244:[function(_dereq_,module,exports){"use strict";module.exports=function createLinePlot(options){var gl=options.gl||options.scene&&options.scene.gl,shader=createShader(gl);shader.attributes.position.location=0,shader.attributes.nextPosition.location=1,shader.attributes.arcLength.location=2,shader.attributes.lineWidth.location=3,shader.attributes.color.location=4;var pickShader=createPickShader(gl);pickShader.attributes.position.location=0,pickShader.attributes.nextPosition.location=1,pickShader.attributes.arcLength.location=2,pickShader.attributes.lineWidth.location=3,pickShader.attributes.color.location=4;for(var buffer=createBuffer(gl),vao=createVAO(gl,[{buffer:buffer,size:3,offset:0,stride:48},{buffer:buffer,size:3,offset:12,stride:48},{buffer:buffer,size:1,offset:24,stride:48},{buffer:buffer,size:1,offset:28,stride:48},{buffer:buffer,size:4,offset:32,stride:48}]),defaultTexture=ndarray(new Array(1024),[256,1,4]),i=0;i<1024;++i)defaultTexture.data[i]=255;var texture=createTexture(gl,defaultTexture);texture.wrap=gl.REPEAT;var linePlot=new LinePlot(gl,shader,pickShader,buffer,vao,texture);return linePlot.update(options),linePlot};var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createTexture=_dereq_("gl-texture2d"),unpackFloat=_dereq_("glsl-read-float"),bsearch=_dereq_("binary-search-bounds"),ndarray=_dereq_("ndarray"),shaders=_dereq_("./lib/shaders"),createShader=shaders.createShader,createPickShader=shaders.createPickShader,identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function distance(a,b){for(var s=0,i=0;i<3;++i){var d=a[i]-b[i];s+=d*d}return Math.sqrt(s)}function filterClipBounds(bounds){for(var result=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)result[0][i]=Math.max(bounds[0][i],result[0][i]),result[1][i]=Math.min(bounds[1][i],result[1][i]);return result}function PickResult(tau,position,index,dataCoordinate){this.arcLength=tau,this.position=position,this.index=index,this.dataCoordinate=dataCoordinate}function LinePlot(gl,shader,pickShader,buffer,vao,texture){this.gl=gl,this.shader=shader,this.pickShader=pickShader,this.buffer=buffer,this.vao=vao,this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.points=[],this.arcLength=[],this.vertexCount=0,this.bounds=[[0,0,0],[0,0,0]],this.pickId=0,this.lineWidth=1,this.texture=texture,this.dashScale=1,this.opacity=1,this.dirty=!0,this.pixelRatio=1}var proto=LinePlot.prototype;proto.isTransparent=function(){return this.opacity<1},proto.isOpaque=function(){return this.opacity>=1},proto.pickSlots=1,proto.setPickBase=function(id){this.pickId=id},proto.drawTransparent=proto.draw=function(camera){var gl=this.gl,shader=this.shader,vao=this.vao;shader.bind(),shader.uniforms={model:camera.model||identity,view:camera.view||identity,projection:camera.projection||identity,clipBounds:filterClipBounds(this.clipBounds),dashTexture:this.texture.bind(),dashScale:this.dashScale/this.arcLength[this.arcLength.length-1],opacity:this.opacity,screenShape:[gl.drawingBufferWidth,gl.drawingBufferHeight],pixelRatio:this.pixelRatio},vao.bind(),vao.draw(gl.TRIANGLE_STRIP,this.vertexCount),vao.unbind()},proto.drawPick=function(camera){var gl=this.gl,shader=this.pickShader,vao=this.vao;shader.bind(),shader.uniforms={model:camera.model||identity,view:camera.view||identity,projection:camera.projection||identity,pickId:this.pickId,clipBounds:filterClipBounds(this.clipBounds),screenShape:[gl.drawingBufferWidth,gl.drawingBufferHeight],pixelRatio:this.pixelRatio},vao.bind(),vao.draw(gl.TRIANGLE_STRIP,this.vertexCount),vao.unbind()},proto.update=function(options){var i,j;this.dirty=!0;var connectGaps=!!options.connectGaps;"dashScale"in options&&(this.dashScale=options.dashScale),"opacity"in options&&(this.opacity=+options.opacity);var positions=options.position||options.positions;if(positions){var colors=options.color||options.colors||[0,0,0,1],lineWidth=options.lineWidth||1,buffer=[],arcLengthArray=[],pointArray=[],arcLength=0,vertexCount=0,bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],hadGap=!1;fill_loop:for(i=1;i<positions.length;++i){var acolor,bcolor,w0,a=positions[i-1],b=positions[i];for(arcLengthArray.push(arcLength),pointArray.push(a.slice()),j=0;j<3;++j){if(isNaN(a[j])||isNaN(b[j])||!isFinite(a[j])||!isFinite(b[j])){if(!connectGaps&&buffer.length>0){for(var k=0;k<24;++k)buffer.push(buffer[buffer.length-12]);vertexCount+=2,hadGap=!0}continue fill_loop}bounds[0][j]=Math.min(bounds[0][j],a[j],b[j]),bounds[1][j]=Math.max(bounds[1][j],a[j],b[j])}Array.isArray(colors[0])?(acolor=colors[i-1],bcolor=colors[i]):acolor=bcolor=colors,3===acolor.length&&(acolor=[acolor[0],acolor[1],acolor[2],1]),3===bcolor.length&&(bcolor=[bcolor[0],bcolor[1],bcolor[2],1]),w0=Array.isArray(lineWidth)?lineWidth[i-1]:lineWidth;var t0=arcLength;if(arcLength+=distance(a,b),hadGap){for(j=0;j<2;++j)buffer.push(a[0],a[1],a[2],b[0],b[1],b[2],t0,w0,acolor[0],acolor[1],acolor[2],acolor[3]);vertexCount+=2,hadGap=!1}buffer.push(a[0],a[1],a[2],b[0],b[1],b[2],t0,w0,acolor[0],acolor[1],acolor[2],acolor[3],a[0],a[1],a[2],b[0],b[1],b[2],t0,-w0,acolor[0],acolor[1],acolor[2],acolor[3],b[0],b[1],b[2],a[0],a[1],a[2],arcLength,-w0,bcolor[0],bcolor[1],bcolor[2],bcolor[3],b[0],b[1],b[2],a[0],a[1],a[2],arcLength,w0,bcolor[0],bcolor[1],bcolor[2],bcolor[3]),vertexCount+=4}if(this.buffer.update(buffer),arcLengthArray.push(arcLength),pointArray.push(positions[positions.length-1].slice()),this.bounds=bounds,this.vertexCount=vertexCount,this.points=pointArray,this.arcLength=arcLengthArray,"dashes"in options){var prefixSum=options.dashes.slice();for(prefixSum.unshift(0),i=1;i<prefixSum.length;++i)prefixSum[i]=prefixSum[i-1]+prefixSum[i];var dashTexture=ndarray(new Array(1024),[256,1,4]);for(i=0;i<256;++i){for(j=0;j<4;++j)dashTexture.set(i,0,j,0);1&bsearch.le(prefixSum,prefixSum[prefixSum.length-1]*i/255)?dashTexture.set(i,0,0,0):dashTexture.set(i,0,0,255)}this.texture.setPixels(dashTexture)}}},proto.dispose=function(){this.shader.dispose(),this.vao.dispose(),this.buffer.dispose()},proto.pick=function(selection){if(!selection)return null;if(selection.id!==this.pickId)return null;var tau=unpackFloat(selection.value[0],selection.value[1],selection.value[2],0),index=bsearch.le(this.arcLength,tau);if(index<0)return null;if(index===this.arcLength.length-1)return new PickResult(this.arcLength[this.arcLength.length-1],this.points[this.points.length-1].slice(),index);for(var a=this.points[index],b=this.points[Math.min(index+1,this.points.length-1)],t=(tau-this.arcLength[index])/(this.arcLength[index+1]-this.arcLength[index]),ti=1-t,x=[0,0,0],i=0;i<3;++i)x[i]=ti*a[i]+t*b[i];var dataIndex=Math.min(t<.5?index:index+1,this.points.length-1);return new PickResult(tau,x,dataIndex,this.points[dataIndex])}},{"./lib/shaders":243,"binary-search-bounds":78,"gl-buffer":229,"gl-texture2d":303,"gl-vao":308,"glsl-read-float":381,ndarray:430}],245:[function(_dereq_,module,exports){module.exports=function invert(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;return det?(det=1/det,out[0]=a3*det,out[1]=-a1*det,out[2]=-a2*det,out[3]=a0*det,out):null}},{}],246:[function(_dereq_,module,exports){module.exports=function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;return det?(det=1/det,out[0]=b01*det,out[1]=(-a22*a01+a02*a21)*det,out[2]=(a12*a01-a02*a11)*det,out[3]=b11*det,out[4]=(a22*a00-a02*a20)*det,out[5]=(-a12*a00+a02*a10)*det,out[6]=b21*det,out[7]=(-a21*a00+a01*a20)*det,out[8]=(a11*a00-a01*a10)*det,out):null}},{}],247:[function(_dereq_,module,exports){module.exports=function clone(a){var out=new Float32Array(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}},{}],248:[function(_dereq_,module,exports){module.exports=function create(){var out=new Float32Array(16);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}},{}],249:[function(_dereq_,module,exports){module.exports=function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return(a00*a11-a01*a10)*(a22*a33-a23*a32)-(a00*a12-a02*a10)*(a21*a33-a23*a31)+(a00*a13-a03*a10)*(a21*a32-a22*a31)+(a01*a12-a02*a11)*(a20*a33-a23*a30)-(a01*a13-a03*a11)*(a20*a32-a22*a30)+(a02*a13-a03*a12)*(a20*a31-a21*a30)}},{}],250:[function(_dereq_,module,exports){module.exports=function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[1]=yx+wz,out[2]=zx-wy,out[3]=0,out[4]=yx-wz,out[5]=1-xx-zz,out[6]=zy+wx,out[7]=0,out[8]=zx+wy,out[9]=zy-wx,out[10]=1-xx-yy,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}},{}],251:[function(_dereq_,module,exports){module.exports=function fromRotationTranslation(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}},{}],252:[function(_dereq_,module,exports){module.exports=function identity(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}},{}],253:[function(_dereq_,module,exports){module.exports=function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;return det=1/det,out[0]=(a11*b11-a12*b10+a13*b09)*det,out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out}},{}],254:[function(_dereq_,module,exports){var identity=_dereq_("./identity");module.exports=function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<1e-6&&Math.abs(eyey-centery)<1e-6&&Math.abs(eyez-centerz)<1e-6)return identity(out);z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,len=1/Math.sqrt(z0*z0+z1*z1+z2*z2),x0=upy*(z2*=len)-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.sqrt(x0*x0+x1*x1+x2*x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0);y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.sqrt(y0*y0+y1*y1+y2*y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0);return out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out}},{"./identity":252}],255:[function(_dereq_,module,exports){module.exports=function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out}},{}],256:[function(_dereq_,module,exports){module.exports=function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=2*far*near*nf,out[15]=0,out}},{}],257:[function(_dereq_,module,exports){module.exports=function rotate(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);if(Math.abs(len)<1e-6)return null;x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),t=1-c,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],b00=x*x*t+c,b01=y*x*t+z*s,b02=z*x*t-y*s,b10=x*y*t-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=a00*b00+a10*b01+a20*b02,out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]);return out}},{}],258:[function(_dereq_,module,exports){module.exports=function rotateX(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]);return out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out}},{}],259:[function(_dereq_,module,exports){module.exports=function rotateY(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]);return out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out}},{}],260:[function(_dereq_,module,exports){module.exports=function rotateZ(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]);return out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out}},{}],261:[function(_dereq_,module,exports){module.exports=function scale(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}},{}],262:[function(_dereq_,module,exports){module.exports=function translate(out,a,v){var a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,x=v[0],y=v[1],z=v[2];a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]);return out}},{}],263:[function(_dereq_,module,exports){module.exports=function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out}},{}],264:[function(_dereq_,module,exports){"use strict";module.exports=function invert(out,M){switch(M.length){case 0:break;case 1:out[0]=1/M[0];break;case 4:invert2(out,M);break;case 9:invert3(out,M);break;case 16:invert4(out,M);break;default:throw new Error("currently supports matrices up to 4x4")}return out};var invert2=_dereq_("gl-mat2/invert"),invert3=_dereq_("gl-mat3/invert"),invert4=_dereq_("gl-mat4/invert")},{"gl-mat2/invert":245,"gl-mat3/invert":246,"gl-mat4/invert":253}],265:[function(_dereq_,module,exports){"use strict";var barycentric=_dereq_("barycentric"),closestPointToTriangle=_dereq_("polytope-closest-point/lib/closest_point_2d.js");function xformMatrix(m,v){for(var out=[0,0,0,0],i=0;i<4;++i)for(var j=0;j<4;++j)out[j]+=m[4*i+j]*v[i];return out}function projectVertex(v,model,view,projection,resolution){for(var p=xformMatrix(projection,xformMatrix(view,xformMatrix(model,[v[0],v[1],v[2],1]))),i=0;i<3;++i)p[i]/=p[3];return[.5*resolution[0]*(1+p[0]),.5*resolution[1]*(1-p[1])]}module.exports=function closestPointToPickLocation(simplex,pixelCoord,model,view,projection,resolution){if(1===simplex.length)return[0,simplex[0].slice()];for(var simplex2D=new Array(simplex.length),i=0;i<simplex.length;++i)simplex2D[i]=projectVertex(simplex[i],model,view,projection,resolution);for(var closestIndex=0,closestDist=1/0,i=0;i<simplex2D.length;++i){for(var d2=0,j=0;j<2;++j)d2+=Math.pow(simplex2D[i][j]-pixelCoord[j],2);d2<closestDist&&(closestDist=d2,closestIndex=i)}for(var weights=function barycentricCoord(simplex,point){if(2===simplex.length){for(var d0=0,d1=0,i=0;i<2;++i)d0+=Math.pow(point[i]-simplex[0][i],2),d1+=Math.pow(point[i]-simplex[1][i],2);return d0=Math.sqrt(d0),d1=Math.sqrt(d1),d0+d1<1e-6?[1,0]:[d1/(d0+d1),d0/(d1+d0)]}if(3===simplex.length){var closestPoint=[0,0];return closestPointToTriangle(simplex[0],simplex[1],simplex[2],point,closestPoint),barycentric(simplex,closestPoint)}return[]}(simplex2D,pixelCoord),s=0,i=0;i<3;++i){if(weights[i]<-.001||weights[i]>1.0001)return null;s+=weights[i]}if(Math.abs(s-1)>.001)return null;return[closestIndex,function interpolate(simplex,weights){for(var result=[0,0,0],i=0;i<simplex.length;++i)for(var p=simplex[i],w=weights[i],j=0;j<3;++j)result[j]+=w*p[j];return result}(simplex,weights),weights]}},{barycentric:60,"polytope-closest-point/lib/closest_point_2d.js":461}],266:[function(_dereq_,module,exports){var glslify=_dereq_("glslify"),triVertSrc=glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec3 position, normal;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 model\n           , view\n           , projection;\nuniform vec3 eyePosition\n           , lightPosition;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  vec4 m_position  = model * vec4(position, 1.0);\n  vec4 t_position  = view * m_position;\n  gl_Position      = projection * t_position;\n  f_color          = color;\n  f_normal         = normal;\n  f_data           = position;\n  f_eyeDirection   = eyePosition   - position;\n  f_lightDirection = lightPosition - position;\n  f_uv             = uv;\n}\n"]),triFragSrc=glslify(["#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\n#define GLSLIFY 1\n\nfloat beckmannDistribution(float x, float roughness) {\n  float NdotH = max(x, 0.0001);\n  float cos2Alpha = NdotH * NdotH;\n  float tan2Alpha = (cos2Alpha - 1.0) / cos2Alpha;\n  float roughness2 = roughness * roughness;\n  float denom = 3.141592653589793 * roughness2 * cos2Alpha * cos2Alpha;\n  return exp(tan2Alpha / roughness2) / denom;\n}\n\nfloat cookTorranceSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float roughness,\n  float fresnel) {\n\n  float VdotN = max(dot(viewDirection, surfaceNormal), 0.0);\n  float LdotN = max(dot(lightDirection, surfaceNormal), 0.0);\n\n  //Half angle vector\n  vec3 H = normalize(lightDirection + viewDirection);\n\n  //Geometric term\n  float NdotH = max(dot(surfaceNormal, H), 0.0);\n  float VdotH = max(dot(viewDirection, H), 0.000001);\n  float LdotH = max(dot(lightDirection, H), 0.000001);\n  float G1 = (2.0 * NdotH * VdotN) / VdotH;\n  float G2 = (2.0 * NdotH * LdotN) / LdotH;\n  float G = min(1.0, min(G1, G2));\n  \n  //Distribution term\n  float D = beckmannDistribution(NdotH, roughness);\n\n  //Fresnel term\n  float F = pow(1.0 - VdotN, fresnel);\n\n  //Multiply terms and done\n  return  G * F * D / max(3.14159265 * VdotN, 0.000001);\n}\n\nvec3 normals(vec3 pos) {\n  vec3 fdx = dFdx(pos);\n  vec3 fdy = dFdy(pos);\n  return normalize(cross(fdx, fdy));\n}\n\nuniform vec3 clipBounds[2];\nuniform float roughness\n            , fresnel\n            , kambient\n            , kdiffuse\n            , kspecular\n            , opacity;\nuniform sampler2D texture;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  if(any(lessThan(f_data, clipBounds[0])) ||\n     any(greaterThan(f_data, clipBounds[1]))) {\n    discard;\n  }\n\n  vec3 N = normalize(f_normal);\n  vec3 L = normalize(f_lightDirection);\n  vec3 V = normalize(f_eyeDirection);\n\n  vec3 normal = normals(f_data);\n\n  if (\n    dot(N, normal) < 0.0\n    ) {\n      N = -N;\n  }\n\n  float specular = cookTorranceSpecular(L, V, N, roughness, fresnel);\n  float diffuse  = min(kambient + kdiffuse * max(dot(N, L), 0.0), 1.0);\n\n  vec4 surfaceColor = f_color * texture2D(texture, f_uv);\n  vec4 litColor = surfaceColor.a * vec4(diffuse * surfaceColor.rgb + kspecular * vec3(1,1,1) * specular,  1.0);\n\n  gl_FragColor = litColor * opacity;\n}\n"]),edgeVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 model, view, projection;\n\nvarying vec4 f_color;\nvarying vec3 f_data;\nvarying vec2 f_uv;\n\nvoid main() {\n  gl_Position = projection * view * model * vec4(position, 1.0);\n  f_color = color;\n  f_data  = position;\n  f_uv    = uv;\n}"]),edgeFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 clipBounds[2];\nuniform sampler2D texture;\nuniform float opacity;\n\nvarying vec4 f_color;\nvarying vec3 f_data;\nvarying vec2 f_uv;\n\nvoid main() {\n  if(any(lessThan(f_data, clipBounds[0])) || \n     any(greaterThan(f_data, clipBounds[1]))) {\n    discard;\n  }\n\n  gl_FragColor = f_color * texture2D(texture, f_uv) * opacity;\n}"]),pointVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 uv;\nattribute float pointSize;\n\nuniform mat4 model, view, projection;\nuniform vec3 clipBounds[2];\n\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  if(any(lessThan(position, clipBounds[0])) || \n     any(greaterThan(position, clipBounds[1]))) {\n    gl_Position = vec4(0,0,0,0);\n  } else {\n    gl_Position = projection * view * model * vec4(position, 1.0);\n  }\n  gl_PointSize = pointSize;\n  f_color = color;\n  f_uv = uv;\n}"]),pointFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform sampler2D texture;\nuniform float opacity;\n\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  vec2 pointR = gl_PointCoord.xy - vec2(0.5,0.5);\n  if(dot(pointR, pointR) > 0.25) {\n    discard;\n  }\n  gl_FragColor = f_color * texture2D(texture, f_uv) * opacity;\n}"]),pickVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 id;\n\nuniform mat4 model, view, projection;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  gl_Position = projection * view * model * vec4(position, 1.0);\n  f_id        = id;\n  f_position  = position;\n}"]),pickFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3  clipBounds[2];\nuniform float pickId;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  if(any(lessThan(f_position, clipBounds[0])) || \n     any(greaterThan(f_position, clipBounds[1]))) {\n    discard;\n  }\n  gl_FragColor = vec4(pickId, f_id.xyz);\n}"]),pickPointVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3  position;\nattribute float pointSize;\nattribute vec4  id;\n\nuniform mat4 model, view, projection;\nuniform vec3 clipBounds[2];\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  if(any(lessThan(position, clipBounds[0])) || \n     any(greaterThan(position, clipBounds[1]))) {\n    gl_Position = vec4(0,0,0,0);\n  } else {\n    gl_Position  = projection * view * model * vec4(position, 1.0);\n    gl_PointSize = pointSize;\n  }\n  f_id         = id;\n  f_position   = position;\n}"]),contourVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\n\nuniform mat4 model, view, projection;\n\nvoid main() {\n  gl_Position = projection * view * model * vec4(position, 1.0);\n}"]),contourFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 contourColor;\n\nvoid main() {\n  gl_FragColor = vec4(contourColor,1);\n}\n"]);exports.meshShader={vertex:triVertSrc,fragment:triFragSrc,attributes:[{name:"position",type:"vec3"},{name:"normal",type:"vec3"},{name:"color",type:"vec4"},{name:"uv",type:"vec2"}]},exports.wireShader={vertex:edgeVertSrc,fragment:edgeFragSrc,attributes:[{name:"position",type:"vec3"},{name:"color",type:"vec4"},{name:"uv",type:"vec2"}]},exports.pointShader={vertex:pointVertSrc,fragment:pointFragSrc,attributes:[{name:"position",type:"vec3"},{name:"color",type:"vec4"},{name:"uv",type:"vec2"},{name:"pointSize",type:"float"}]},exports.pickShader={vertex:pickVertSrc,fragment:pickFragSrc,attributes:[{name:"position",type:"vec3"},{name:"id",type:"vec4"}]},exports.pointPickShader={vertex:pickPointVertSrc,fragment:pickFragSrc,attributes:[{name:"position",type:"vec3"},{name:"pointSize",type:"float"},{name:"id",type:"vec4"}]},exports.contourShader={vertex:contourVertSrc,fragment:contourFragSrc,attributes:[{name:"position",type:"vec3"}]}},{glslify:390}],267:[function(_dereq_,module,exports){"use strict";var createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createTexture=_dereq_("gl-texture2d"),normals=_dereq_("normals"),multiply=_dereq_("gl-mat4/multiply"),invert=_dereq_("gl-mat4/invert"),ndarray=_dereq_("ndarray"),colormap=_dereq_("colormap"),getContour=_dereq_("simplicial-complex-contour"),pool=_dereq_("typedarray-pool"),shaders=_dereq_("./lib/shaders"),closestPoint=_dereq_("./lib/closest-point"),meshShader=shaders.meshShader,wireShader=shaders.wireShader,pointShader=shaders.pointShader,pickShader=shaders.pickShader,pointPickShader=shaders.pointPickShader,contourShader=shaders.contourShader,identityMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function SimplicialMesh(gl,texture,triShader,lineShader,pointShader,pickShader,pointPickShader,contourShader,trianglePositions,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,contourVAO){this.gl=gl,this.cells=[],this.positions=[],this.intensity=[],this.texture=texture,this.dirty=!0,this.triShader=triShader,this.lineShader=lineShader,this.pointShader=pointShader,this.pickShader=pickShader,this.pointPickShader=pointPickShader,this.contourShader=contourShader,this.trianglePositions=trianglePositions,this.triangleColors=triangleColors,this.triangleNormals=triangleNormals,this.triangleUVs=triangleUVs,this.triangleIds=triangleIds,this.triangleVAO=triangleVAO,this.triangleCount=0,this.lineWidth=1,this.edgePositions=edgePositions,this.edgeColors=edgeColors,this.edgeUVs=edgeUVs,this.edgeIds=edgeIds,this.edgeVAO=edgeVAO,this.edgeCount=0,this.pointPositions=pointPositions,this.pointColors=pointColors,this.pointUVs=pointUVs,this.pointSizes=pointSizes,this.pointIds=pointIds,this.pointVAO=pointVAO,this.pointCount=0,this.contourLineWidth=1,this.contourPositions=contourPositions,this.contourVAO=contourVAO,this.contourCount=0,this.contourColor=[0,0,0],this.contourEnable=!0,this.pickId=1,this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.lightPosition=[1e5,1e5,0],this.ambientLight=.8,this.diffuseLight=.8,this.specularLight=2,this.roughness=.5,this.fresnel=1.5,this.opacity=1,this._model=identityMatrix,this._view=identityMatrix,this._projection=identityMatrix,this._resolution=[1,1]}var proto=SimplicialMesh.prototype;function createPointShader(gl){var shader=createShader(gl,pointShader.vertex,pointShader.fragment);return shader.attributes.position.location=0,shader.attributes.color.location=2,shader.attributes.uv.location=3,shader.attributes.pointSize.location=4,shader}function createPickShader(gl){var shader=createShader(gl,pickShader.vertex,pickShader.fragment);return shader.attributes.position.location=0,shader.attributes.id.location=1,shader}function createPointPickShader(gl){var shader=createShader(gl,pointPickShader.vertex,pointPickShader.fragment);return shader.attributes.position.location=0,shader.attributes.id.location=1,shader.attributes.pointSize.location=4,shader}function createContourShader(gl){var shader=createShader(gl,contourShader.vertex,contourShader.fragment);return shader.attributes.position.location=0,shader}proto.isOpaque=function(){return this.opacity>=1},proto.isTransparent=function(){return this.opacity<1},proto.pickSlots=1,proto.setPickBase=function(id){this.pickId=id},proto.highlight=function(selection){if(selection&&this.contourEnable){for(var level=getContour(this.cells,this.intensity,selection.intensity),cells=level.cells,vertexIds=level.vertexIds,vertexWeights=level.vertexWeights,numCells=cells.length,result=pool.mallocFloat32(6*numCells),ptr=0,i=0;i<numCells;++i)for(var c=cells[i],j=0;j<2;++j){var v=c[0];2===c.length&&(v=c[j]);for(var a=vertexIds[v][0],b=vertexIds[v][1],w=vertexWeights[v],wi=1-w,pa=this.positions[a],pb=this.positions[b],k=0;k<3;++k)result[ptr++]=w*pa[k]+wi*pb[k]}this.contourCount=ptr/3|0,this.contourPositions.update(result.subarray(0,ptr)),pool.free(result)}else this.contourCount=0},proto.update=function(params){params=params||{};var gl=this.gl;this.dirty=!0,"contourEnable"in params&&(this.contourEnable=params.contourEnable),"contourColor"in params&&(this.contourColor=params.contourColor),"lineWidth"in params&&(this.lineWidth=params.lineWidth),"lightPosition"in params&&(this.lightPosition=params.lightPosition),"opacity"in params&&(this.opacity=params.opacity),"ambient"in params&&(this.ambientLight=params.ambient),"diffuse"in params&&(this.diffuseLight=params.diffuse),"specular"in params&&(this.specularLight=params.specular),"roughness"in params&&(this.roughness=params.roughness),"fresnel"in params&&(this.fresnel=params.fresnel),params.texture?(this.texture.dispose(),this.texture=createTexture(gl,params.texture)):params.colormap&&(this.texture.shape=[256,256],this.texture.minFilter=gl.LINEAR_MIPMAP_LINEAR,this.texture.magFilter=gl.LINEAR,this.texture.setPixels(function genColormap(param){for(var colors=colormap({colormap:param,nshades:256,format:"rgba"}),result=new Uint8Array(1024),i=0;i<256;++i){for(var c=colors[i],j=0;j<3;++j)result[4*i+j]=c[j];result[4*i+3]=255*c[3]}return ndarray(result,[256,256,4],[4,0,1])}(params.colormap)),this.texture.generateMipmap());var cells=params.cells,positions=params.positions;if(positions&&cells){var tPos=[],tCol=[],tNor=[],tUVs=[],tIds=[],ePos=[],eCol=[],eUVs=[],eIds=[],pPos=[],pCol=[],pUVs=[],pSiz=[],pIds=[];this.cells=cells,this.positions=positions;var vertexNormals=params.vertexNormals,cellNormals=params.cellNormals,vertexNormalsEpsilon=void 0===params.vertexNormalsEpsilon?1e-6:params.vertexNormalsEpsilon,faceNormalsEpsilon=void 0===params.faceNormalsEpsilon?1e-6:params.faceNormalsEpsilon;params.useFacetNormals&&!cellNormals&&(cellNormals=normals.faceNormals(cells,positions,faceNormalsEpsilon)),cellNormals||vertexNormals||(vertexNormals=normals.vertexNormals(cells,positions,vertexNormalsEpsilon));var vertexColors=params.vertexColors,cellColors=params.cellColors,meshColor=params.meshColor||[1,1,1,1],vertexUVs=params.vertexUVs,vertexIntensity=params.vertexIntensity,cellUVs=params.cellUVs,cellIntensity=params.cellIntensity,intensityLo=1/0,intensityHi=-1/0;if(!vertexUVs&&!cellUVs)if(vertexIntensity)if(params.vertexIntensityBounds)intensityLo=+params.vertexIntensityBounds[0],intensityHi=+params.vertexIntensityBounds[1];else for(var i=0;i<vertexIntensity.length;++i){var f=vertexIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else if(cellIntensity)for(i=0;i<cellIntensity.length;++i){f=cellIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else for(i=0;i<positions.length;++i){f=positions[i][2];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}this.intensity=vertexIntensity||(cellIntensity?function unpackIntensity(cells,numVerts,cellIntensity){for(var result=new Array(numVerts),i=0;i<numVerts;++i)result[i]=0;var numCells=cells.length;for(i=0;i<numCells;++i)for(var c=cells[i],j=0;j<c.length;++j)result[c[j]]=cellIntensity[i];return result}(cells,positions.length,cellIntensity):function takeZComponent(array){for(var n=array.length,result=new Array(n),i=0;i<n;++i)result[i]=array[i][2];return result}(positions));var pointSizes=params.pointSizes,meshPointSize=params.pointSize||1;this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];for(i=0;i<positions.length;++i)for(var p=positions[i],j=0;j<3;++j)!isNaN(p[j])&&isFinite(p[j])&&(this.bounds[0][j]=Math.min(this.bounds[0][j],p[j]),this.bounds[1][j]=Math.max(this.bounds[1][j],p[j]));var triangleCount=0,edgeCount=0,pointCount=0;fill_loop:for(i=0;i<cells.length;++i){var cell=cells[i];switch(cell.length){case 1:for(p=positions[v=cell[0]],j=0;j<3;++j)if(isNaN(p[j])||!isFinite(p[j]))continue fill_loop;pPos.push(p[0],p[1],p[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?pCol.push(c[0],c[1],c[2],1):pCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],pUVs.push(uv[0],uv[1]),pointSizes?pSiz.push(pointSizes[v]):pSiz.push(meshPointSize),pIds.push(i),pointCount+=1;break;case 2:for(j=0;j<2;++j){p=positions[v=cell[j]];for(var k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop}for(j=0;j<2;++j){p=positions[v=cell[j]];ePos.push(p[0],p[1],p[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?eCol.push(c[0],c[1],c[2],1):eCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],eUVs.push(uv[0],uv[1]),eIds.push(i)}edgeCount+=1;break;case 3:for(j=0;j<3;++j)for(p=positions[v=cell[j]],k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop;for(j=0;j<3;++j){var v,c,uv,q;p=positions[v=cell[j]];tPos.push(p[0],p[1],p[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?tCol.push(c[0],c[1],c[2],1):tCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],tUVs.push(uv[0],uv[1]),q=vertexNormals?vertexNormals[v]:cellNormals[i],tNor.push(q[0],q[1],q[2]),tIds.push(i)}triangleCount+=1}}this.pointCount=pointCount,this.edgeCount=edgeCount,this.triangleCount=triangleCount,this.pointPositions.update(pPos),this.pointColors.update(pCol),this.pointUVs.update(pUVs),this.pointSizes.update(pSiz),this.pointIds.update(new Uint32Array(pIds)),this.edgePositions.update(ePos),this.edgeColors.update(eCol),this.edgeUVs.update(eUVs),this.edgeIds.update(new Uint32Array(eIds)),this.trianglePositions.update(tPos),this.triangleColors.update(tCol),this.triangleUVs.update(tUVs),this.triangleNormals.update(tNor),this.triangleIds.update(new Uint32Array(tIds))}},proto.drawTransparent=proto.draw=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);var uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,kambient:this.ambientLight,kdiffuse:this.diffuseLight,kspecular:this.specularLight,roughness:this.roughness,fresnel:this.fresnel,eyePosition:[0,0,0],lightPosition:[0,0,0],opacity:this.opacity,contourColor:this.contourColor,texture:0};this.texture.bind(0);var invCameraMatrix=new Array(16);multiply(invCameraMatrix,uniforms.view,uniforms.model),multiply(invCameraMatrix,uniforms.projection,invCameraMatrix),invert(invCameraMatrix,invCameraMatrix);for(i=0;i<3;++i)uniforms.eyePosition[i]=invCameraMatrix[12+i]/invCameraMatrix[15];var shader,w=invCameraMatrix[15];for(i=0;i<3;++i)w+=this.lightPosition[i]*invCameraMatrix[4*i+3];for(i=0;i<3;++i){for(var s=invCameraMatrix[12+i],j=0;j<3;++j)s+=invCameraMatrix[4*j+i]*this.lightPosition[j];uniforms.lightPosition[i]=s/w}this.triangleCount>0&&((shader=this.triShader).bind(),shader.uniforms=uniforms,this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind());this.edgeCount>0&&this.lineWidth>0&&((shader=this.lineShader).bind(),shader.uniforms=uniforms,this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind());this.pointCount>0&&((shader=this.pointShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind());this.contourEnable&&this.contourCount>0&&this.contourLineWidth>0&&((shader=this.contourShader).bind(),shader.uniforms=uniforms,this.contourVAO.bind(),gl.drawArrays(gl.LINES,0,this.contourCount),this.contourVAO.unbind())},proto.drawPick=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);this._model=[].slice.call(model),this._view=[].slice.call(view),this._projection=[].slice.call(projection),this._resolution=[gl.drawingBufferWidth,gl.drawingBufferHeight];var shader,uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,pickId:this.pickId/255};((shader=this.pickShader).bind(),shader.uniforms=uniforms,this.triangleCount>0&&(this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind()),this.edgeCount>0&&(this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind()),this.pointCount>0)&&((shader=this.pointPickShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind())},proto.pick=function(pickData){if(!pickData)return null;if(pickData.id!==this.pickId)return null;for(var cellId=pickData.value[0]+256*pickData.value[1]+65536*pickData.value[2],cell=this.cells[cellId],positions=this.positions,simplex=new Array(cell.length),i=0;i<cell.length;++i)simplex[i]=positions[cell[i]];var data=closestPoint(simplex,[pickData.coord[0],this._resolution[1]-pickData.coord[1]],this._model,this._view,this._projection,this._resolution);if(!data)return null;var weights=data[2],interpIntensity=0;for(i=0;i<cell.length;++i)interpIntensity+=weights[i]*this.intensity[cell[i]];return{position:data[1],index:cell[data[0]],cell:cell,cellId:cellId,intensity:interpIntensity,dataCoordinate:this.positions[cell[data[0]]]}},proto.dispose=function(){this.texture.dispose(),this.triShader.dispose(),this.lineShader.dispose(),this.pointShader.dispose(),this.pickShader.dispose(),this.pointPickShader.dispose(),this.triangleVAO.dispose(),this.trianglePositions.dispose(),this.triangleColors.dispose(),this.triangleUVs.dispose(),this.triangleNormals.dispose(),this.triangleIds.dispose(),this.edgeVAO.dispose(),this.edgePositions.dispose(),this.edgeColors.dispose(),this.edgeUVs.dispose(),this.edgeIds.dispose(),this.pointVAO.dispose(),this.pointPositions.dispose(),this.pointColors.dispose(),this.pointUVs.dispose(),this.pointSizes.dispose(),this.pointIds.dispose(),this.contourVAO.dispose(),this.contourPositions.dispose(),this.contourShader.dispose()},module.exports=function createSimplicialMesh(gl,params){if(1===arguments.length&&(gl=(params=gl).gl),!(gl.getExtension("OES_standard_derivatives")||gl.getExtension("MOZ_OES_standard_derivatives")||gl.getExtension("WEBKIT_OES_standard_derivatives")))throw new Error("derivatives not supported");var triShader=function createMeshShader(gl){var shader=createShader(gl,meshShader.vertex,meshShader.fragment);return shader.attributes.position.location=0,shader.attributes.color.location=2,shader.attributes.uv.location=3,shader.attributes.normal.location=4,shader}(gl),lineShader=function createWireShader(gl){var shader=createShader(gl,wireShader.vertex,wireShader.fragment);return shader.attributes.position.location=0,shader.attributes.color.location=2,shader.attributes.uv.location=3,shader}(gl),pointShader=createPointShader(gl),pickShader=createPickShader(gl),pointPickShader=createPointPickShader(gl),contourShader=createContourShader(gl),meshTexture=createTexture(gl,ndarray(new Uint8Array([255,255,255,255]),[1,1,4]));meshTexture.generateMipmap(),meshTexture.minFilter=gl.LINEAR_MIPMAP_LINEAR,meshTexture.magFilter=gl.LINEAR;var trianglePositions=createBuffer(gl),triangleColors=createBuffer(gl),triangleUVs=createBuffer(gl),triangleNormals=createBuffer(gl),triangleIds=createBuffer(gl),triangleVAO=createVAO(gl,[{buffer:trianglePositions,type:gl.FLOAT,size:3},{buffer:triangleIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:triangleColors,type:gl.FLOAT,size:4},{buffer:triangleUVs,type:gl.FLOAT,size:2},{buffer:triangleNormals,type:gl.FLOAT,size:3}]),edgePositions=createBuffer(gl),edgeColors=createBuffer(gl),edgeUVs=createBuffer(gl),edgeIds=createBuffer(gl),edgeVAO=createVAO(gl,[{buffer:edgePositions,type:gl.FLOAT,size:3},{buffer:edgeIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:edgeColors,type:gl.FLOAT,size:4},{buffer:edgeUVs,type:gl.FLOAT,size:2}]),pointPositions=createBuffer(gl),pointColors=createBuffer(gl),pointUVs=createBuffer(gl),pointSizes=createBuffer(gl),pointIds=createBuffer(gl),pointVAO=createVAO(gl,[{buffer:pointPositions,type:gl.FLOAT,size:3},{buffer:pointIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:pointColors,type:gl.FLOAT,size:4},{buffer:pointUVs,type:gl.FLOAT,size:2},{buffer:pointSizes,type:gl.FLOAT,size:1}]),contourPositions=createBuffer(gl),mesh=new SimplicialMesh(gl,meshTexture,triShader,lineShader,pointShader,pickShader,pointPickShader,contourShader,trianglePositions,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,createVAO(gl,[{buffer:contourPositions,type:gl.FLOAT,size:3}]));return mesh.update(params),mesh}},{"./lib/closest-point":265,"./lib/shaders":266,colormap:113,"gl-buffer":229,"gl-mat4/invert":253,"gl-mat4/multiply":255,"gl-shader":286,"gl-texture2d":303,"gl-vao":308,ndarray:430,normals:433,"simplicial-complex-contour":491,"typedarray-pool":519}],268:[function(_dereq_,module,exports){"use strict";module.exports=function createBoxes(plot){var gl=plot.gl,vbo=createBuffer(gl,[0,0,0,1,1,0,1,1]),shader=createShader(gl,shaders.boxVert,shaders.lineFrag);return new Boxes(plot,vbo,shader)};var createBuffer=_dereq_("gl-buffer"),createShader=_dereq_("gl-shader"),shaders=_dereq_("./shaders");function Boxes(plot,vbo,shader){this.plot=plot,this.vbo=vbo,this.shader=shader}var lo,hi,proto=Boxes.prototype;proto.bind=function(){var shader=this.shader;this.vbo.bind(),this.shader.bind(),shader.attributes.coord.pointer(),shader.uniforms.screenBox=this.plot.screenBox},proto.drawBox=(lo=[0,0],hi=[0,0],function(loX,loY,hiX,hiY,color){var plot=this.plot,shader=this.shader,gl=plot.gl;lo[0]=loX,lo[1]=loY,hi[0]=hiX,hi[1]=hiY,shader.uniforms.lo=lo,shader.uniforms.hi=hi,shader.uniforms.color=color,gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}),proto.dispose=function(){this.vbo.dispose(),this.shader.dispose()}},{"./shaders":271,"gl-buffer":229,"gl-shader":286}],269:[function(_dereq_,module,exports){"use strict";module.exports=function createGrid(plot){var gl=plot.gl,vbo=createBuffer(gl),shader=createShader(gl,shaders.gridVert,shaders.gridFrag),tickShader=createShader(gl,shaders.tickVert,shaders.gridFrag);return new Grid(plot,vbo,shader,tickShader)};var createBuffer=_dereq_("gl-buffer"),createShader=_dereq_("gl-shader"),bsearch=_dereq_("binary-search-bounds"),shaders=_dereq_("./shaders");function Grid(plot,vbo,shader,tickShader){this.plot=plot,this.vbo=vbo,this.shader=shader,this.tickShader=tickShader,this.ticks=[[],[]]}function compareTickNum(a,b){return a-b}var DATA_SHIFT,DATA_SCALE,DATA_AXIS,OFFSET_X,OFFSET_Y,proto=Grid.prototype;proto.draw=(DATA_SHIFT=[0,0],DATA_SCALE=[0,0],DATA_AXIS=[0,0],function(){for(var plot=this.plot,vbo=this.vbo,shader=this.shader,ticks=this.ticks,gl=plot.gl,bounds=plot._tickBounds,dataBox=plot.dataBox,viewPixels=plot.viewBox,lineWidth=plot.gridLineWidth,gridColor=plot.gridLineColor,gridEnable=plot.gridLineEnable,pixelRatio=plot.pixelRatio,i=0;i<2;++i){var lo=bounds[i],boundScale=bounds[i+2]-lo,dataCenter=.5*(dataBox[i+2]+dataBox[i]),dataWidth=dataBox[i+2]-dataBox[i];DATA_SCALE[i]=2*boundScale/dataWidth,DATA_SHIFT[i]=2*(lo-dataCenter)/dataWidth}shader.bind(),vbo.bind(),shader.attributes.dataCoord.pointer(),shader.uniforms.dataShift=DATA_SHIFT,shader.uniforms.dataScale=DATA_SCALE;var offset=0;for(i=0;i<2;++i){DATA_AXIS[0]=DATA_AXIS[1]=0,DATA_AXIS[i]=1,shader.uniforms.dataAxis=DATA_AXIS,shader.uniforms.lineWidth=lineWidth[i]/(viewPixels[i+2]-viewPixels[i])*pixelRatio,shader.uniforms.color=gridColor[i];var size=6*ticks[i].length;gridEnable[i]&&size&&gl.drawArrays(gl.TRIANGLES,offset,size),offset+=size}}),proto.drawTickMarks=function(){var DATA_SHIFT=[0,0],DATA_SCALE=[0,0],X_AXIS=[1,0],Y_AXIS=[0,1],SCR_OFFSET=[0,0],TICK_SCALE=[0,0];return function(){for(var plot=this.plot,vbo=this.vbo,shader=this.tickShader,ticks=this.ticks,gl=plot.gl,bounds=plot._tickBounds,dataBox=plot.dataBox,viewBox=plot.viewBox,pixelRatio=plot.pixelRatio,screenBox=plot.screenBox,screenWidth=screenBox[2]-screenBox[0],screenHeight=screenBox[3]-screenBox[1],viewWidth=viewBox[2]-viewBox[0],viewHeight=viewBox[3]-viewBox[1],i=0;i<2;++i){var lo=bounds[i],boundScale=bounds[i+2]-lo,dataCenter=.5*(dataBox[i+2]+dataBox[i]),dataWidth=dataBox[i+2]-dataBox[i];DATA_SCALE[i]=2*boundScale/dataWidth,DATA_SHIFT[i]=2*(lo-dataCenter)/dataWidth}DATA_SCALE[0]*=viewWidth/screenWidth,DATA_SHIFT[0]*=viewWidth/screenWidth,DATA_SCALE[1]*=viewHeight/screenHeight,DATA_SHIFT[1]*=viewHeight/screenHeight,shader.bind(),vbo.bind(),shader.attributes.dataCoord.pointer();var uniforms=shader.uniforms;uniforms.dataShift=DATA_SHIFT,uniforms.dataScale=DATA_SCALE;var tickMarkLength=plot.tickMarkLength,tickMarkWidth=plot.tickMarkWidth,tickMarkColor=plot.tickMarkColor,yTicksOffset=6*ticks[0].length,xStart=Math.min(bsearch.ge(ticks[0],(dataBox[0]-bounds[0])/(bounds[2]-bounds[0]),compareTickNum),ticks[0].length),xEnd=Math.min(bsearch.gt(ticks[0],(dataBox[2]-bounds[0])/(bounds[2]-bounds[0]),compareTickNum),ticks[0].length),xOffset=0+6*xStart,xCount=6*Math.max(0,xEnd-xStart),yStart=Math.min(bsearch.ge(ticks[1],(dataBox[1]-bounds[1])/(bounds[3]-bounds[1]),compareTickNum),ticks[1].length),yEnd=Math.min(bsearch.gt(ticks[1],(dataBox[3]-bounds[1])/(bounds[3]-bounds[1]),compareTickNum),ticks[1].length),yOffset=yTicksOffset+6*yStart,yCount=6*Math.max(0,yEnd-yStart);SCR_OFFSET[0]=2*(viewBox[0]-tickMarkLength[1])/screenWidth-1,SCR_OFFSET[1]=(viewBox[3]+viewBox[1])/screenHeight-1,TICK_SCALE[0]=tickMarkLength[1]*pixelRatio/screenWidth,TICK_SCALE[1]=tickMarkWidth[1]*pixelRatio/screenHeight,yCount&&(uniforms.color=tickMarkColor[1],uniforms.tickScale=TICK_SCALE,uniforms.dataAxis=Y_AXIS,uniforms.screenOffset=SCR_OFFSET,gl.drawArrays(gl.TRIANGLES,yOffset,yCount)),SCR_OFFSET[0]=(viewBox[2]+viewBox[0])/screenWidth-1,SCR_OFFSET[1]=2*(viewBox[1]-tickMarkLength[0])/screenHeight-1,TICK_SCALE[0]=tickMarkWidth[0]*pixelRatio/screenWidth,TICK_SCALE[1]=tickMarkLength[0]*pixelRatio/screenHeight,xCount&&(uniforms.color=tickMarkColor[0],uniforms.tickScale=TICK_SCALE,uniforms.dataAxis=X_AXIS,uniforms.screenOffset=SCR_OFFSET,gl.drawArrays(gl.TRIANGLES,xOffset,xCount)),SCR_OFFSET[0]=2*(viewBox[2]+tickMarkLength[3])/screenWidth-1,SCR_OFFSET[1]=(viewBox[3]+viewBox[1])/screenHeight-1,TICK_SCALE[0]=tickMarkLength[3]*pixelRatio/screenWidth,TICK_SCALE[1]=tickMarkWidth[3]*pixelRatio/screenHeight,yCount&&(uniforms.color=tickMarkColor[3],uniforms.tickScale=TICK_SCALE,uniforms.dataAxis=Y_AXIS,uniforms.screenOffset=SCR_OFFSET,gl.drawArrays(gl.TRIANGLES,yOffset,yCount)),SCR_OFFSET[0]=(viewBox[2]+viewBox[0])/screenWidth-1,SCR_OFFSET[1]=2*(viewBox[3]+tickMarkLength[2])/screenHeight-1,TICK_SCALE[0]=tickMarkWidth[2]*pixelRatio/screenWidth,TICK_SCALE[1]=tickMarkLength[2]*pixelRatio/screenHeight,xCount&&(uniforms.color=tickMarkColor[2],uniforms.tickScale=TICK_SCALE,uniforms.dataAxis=X_AXIS,uniforms.screenOffset=SCR_OFFSET,gl.drawArrays(gl.TRIANGLES,xOffset,xCount))}}(),proto.update=(OFFSET_X=[1,1,-1,-1,1,-1],OFFSET_Y=[1,-1,1,1,-1,-1],function(options){for(var ticks=options.ticks,bounds=options.bounds,data=new Float32Array(18*(ticks[0].length+ticks[1].length)),ptr=(this.plot.zeroLineEnable,0),gridTicks=[[],[]],dim=0;dim<2;++dim)for(var localTicks=gridTicks[dim],axisTicks=ticks[dim],lo=bounds[dim],hi=bounds[dim+2],i=0;i<axisTicks.length;++i){var x=(axisTicks[i].x-lo)/(hi-lo);localTicks.push(x);for(var j=0;j<6;++j)data[ptr++]=x,data[ptr++]=OFFSET_X[j],data[ptr++]=OFFSET_Y[j]}this.ticks=gridTicks,this.vbo.update(data)}),proto.dispose=function(){this.vbo.dispose(),this.shader.dispose(),this.tickShader.dispose()}},{"./shaders":271,"binary-search-bounds":273,"gl-buffer":229,"gl-shader":286}],270:[function(_dereq_,module,exports){"use strict";module.exports=function createLines(plot){var gl=plot.gl,vbo=createBuffer(gl,[-1,-1,-1,1,1,-1,1,1]),shader=createShader(gl,shaders.lineVert,shaders.lineFrag);return new Lines(plot,vbo,shader)};var createBuffer=_dereq_("gl-buffer"),createShader=_dereq_("gl-shader"),shaders=_dereq_("./shaders");function Lines(plot,vbo,shader){this.plot=plot,this.vbo=vbo,this.shader=shader}var start,end,proto=Lines.prototype;proto.bind=function(){var shader=this.shader;this.vbo.bind(),this.shader.bind(),shader.attributes.coord.pointer(),shader.uniforms.screenBox=this.plot.screenBox},proto.drawLine=(start=[0,0],end=[0,0],function(startX,startY,endX,endY,width,color){var plot=this.plot,shader=this.shader,gl=plot.gl;start[0]=startX,start[1]=startY,end[0]=endX,end[1]=endY,shader.uniforms.start=start,shader.uniforms.end=end,shader.uniforms.width=width*plot.pixelRatio,shader.uniforms.color=color,gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}),proto.dispose=function(){this.vbo.dispose(),this.shader.dispose()}},{"./shaders":271,"gl-buffer":229,"gl-shader":286}],271:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify"),FRAGMENT=glslify(["precision lowp float;\n#define GLSLIFY 1\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = vec4(color.xyz * color.w, color.w);\n}\n"]);module.exports={lineVert:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 coord;\n\nuniform vec4 screenBox;\nuniform vec2 start, end;\nuniform float width;\n\nvec2 perp(vec2 v) {\n  return vec2(v.y, -v.x);\n}\n\nvec2 screen(vec2 v) {\n  return 2.0 * (v - screenBox.xy) / (screenBox.zw - screenBox.xy) - 1.0;\n}\n\nvoid main() {\n  vec2 delta = normalize(perp(start - end));\n  vec2 offset = mix(start, end, 0.5 * (coord.y+1.0));\n  gl_Position = vec4(screen(offset + 0.5 * width * delta * coord.x), 0, 1);\n}\n"]),lineFrag:FRAGMENT,textVert:glslify(["#define GLSLIFY 1\nattribute vec3 textCoordinate;\n\nuniform vec2 dataScale, dataShift, dataAxis, screenOffset, textScale;\nuniform float angle;\n\nvoid main() {\n  float dataOffset  = textCoordinate.z;\n  vec2 glyphOffset  = textCoordinate.xy;\n  mat2 glyphMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  vec2 screenCoordinate = dataAxis * (dataScale * dataOffset + dataShift) +\n    glyphMatrix * glyphOffset * textScale + screenOffset;\n  gl_Position = vec4(screenCoordinate, 0, 1);\n}\n"]),textFrag:FRAGMENT,gridVert:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 dataCoord;\n\nuniform vec2 dataAxis, dataShift, dataScale;\nuniform float lineWidth;\n\nvoid main() {\n  vec2 pos = dataAxis * (dataScale * dataCoord.x + dataShift);\n  pos += 10.0 * dataCoord.y * vec2(dataAxis.y, -dataAxis.x) + dataCoord.z * lineWidth;\n  gl_Position = vec4(pos, 0, 1);\n}\n"]),gridFrag:FRAGMENT,boxVert:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 coord;\n\nuniform vec4 screenBox;\nuniform vec2 lo, hi;\n\nvec2 screen(vec2 v) {\n  return 2.0 * (v - screenBox.xy) / (screenBox.zw - screenBox.xy) - 1.0;\n}\n\nvoid main() {\n  gl_Position = vec4(screen(mix(lo, hi, coord)), 0, 1);\n}\n"]),tickVert:glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 dataCoord;\n\nuniform vec2 dataAxis, dataShift, dataScale, screenOffset, tickScale;\n\nvoid main() {\n  vec2 pos = dataAxis * (dataScale * dataCoord.x + dataShift);\n  gl_Position = vec4(pos + tickScale*dataCoord.yz + screenOffset, 0, 1);\n}\n"])}},{glslify:390}],272:[function(_dereq_,module,exports){"use strict";module.exports=function createTextElements(plot){var gl=plot.gl,vbo=createBuffer(gl),shader=createShader(gl,shaders.textVert,shaders.textFrag);return new TextElements(plot,vbo,shader)};var createBuffer=_dereq_("gl-buffer"),createShader=_dereq_("gl-shader"),getText=_dereq_("text-cache"),bsearch=_dereq_("binary-search-bounds"),shaders=_dereq_("./shaders");function TextElements(plot,vbo,shader){this.plot=plot,this.vbo=vbo,this.shader=shader,this.tickOffset=[[],[]],this.tickX=[[],[]],this.labelOffset=[0,0],this.labelCount=[0,0]}var DATA_AXIS,SCREEN_OFFSET,ZERO_2,DATA_SHIFT,DATA_SCALE,TEXT_SCALE,proto=TextElements.prototype;proto.drawTicks=(DATA_AXIS=[0,0],SCREEN_OFFSET=[0,0],ZERO_2=[0,0],function(axis){var plot=this.plot,shader=this.shader,tickX=this.tickX[axis],tickOffset=this.tickOffset[axis],gl=plot.gl,viewBox=plot.viewBox,dataBox=plot.dataBox,screenBox=plot.screenBox,pixelRatio=plot.pixelRatio,tickEnable=plot.tickEnable,tickPad=plot.tickPad,textColor=plot.tickColor,textAngle=plot.tickAngle,labelEnable=plot.labelEnable,labelPad=plot.labelPad,labelColor=plot.labelColor,labelAngle=plot.labelAngle,labelOffset=this.labelOffset[axis],labelCount=this.labelCount[axis],start=bsearch.lt(tickX,dataBox[axis]),end=bsearch.le(tickX,dataBox[axis+2]);DATA_AXIS[0]=DATA_AXIS[1]=0,DATA_AXIS[axis]=1,SCREEN_OFFSET[axis]=(viewBox[2+axis]+viewBox[axis])/(screenBox[2+axis]-screenBox[axis])-1;var screenScale=2/screenBox[2+(1^axis)]-screenBox[1^axis];SCREEN_OFFSET[1^axis]=screenScale*viewBox[1^axis]-1,tickEnable[axis]&&(SCREEN_OFFSET[1^axis]-=screenScale*pixelRatio*tickPad[axis],start<end&&tickOffset[end]>tickOffset[start]&&(shader.uniforms.dataAxis=DATA_AXIS,shader.uniforms.screenOffset=SCREEN_OFFSET,shader.uniforms.color=textColor[axis],shader.uniforms.angle=textAngle[axis],gl.drawArrays(gl.TRIANGLES,tickOffset[start],tickOffset[end]-tickOffset[start]))),labelEnable[axis]&&labelCount&&(SCREEN_OFFSET[1^axis]-=screenScale*pixelRatio*labelPad[axis],shader.uniforms.dataAxis=ZERO_2,shader.uniforms.screenOffset=SCREEN_OFFSET,shader.uniforms.color=labelColor[axis],shader.uniforms.angle=labelAngle[axis],gl.drawArrays(gl.TRIANGLES,labelOffset,labelCount)),SCREEN_OFFSET[1^axis]=screenScale*viewBox[2+(1^axis)]-1,tickEnable[axis+2]&&(SCREEN_OFFSET[1^axis]+=screenScale*pixelRatio*tickPad[axis+2],start<end&&tickOffset[end]>tickOffset[start]&&(shader.uniforms.dataAxis=DATA_AXIS,shader.uniforms.screenOffset=SCREEN_OFFSET,shader.uniforms.color=textColor[axis+2],shader.uniforms.angle=textAngle[axis+2],gl.drawArrays(gl.TRIANGLES,tickOffset[start],tickOffset[end]-tickOffset[start]))),labelEnable[axis+2]&&labelCount&&(SCREEN_OFFSET[1^axis]+=screenScale*pixelRatio*labelPad[axis+2],shader.uniforms.dataAxis=ZERO_2,shader.uniforms.screenOffset=SCREEN_OFFSET,shader.uniforms.color=labelColor[axis+2],shader.uniforms.angle=labelAngle[axis+2],gl.drawArrays(gl.TRIANGLES,labelOffset,labelCount))}),proto.drawTitle=function(){var DATA_AXIS=[0,0],SCREEN_OFFSET=[0,0];return function(){var plot=this.plot,shader=this.shader,gl=plot.gl,screenBox=plot.screenBox,titleCenter=plot.titleCenter,titleAngle=plot.titleAngle,titleColor=plot.titleColor,pixelRatio=plot.pixelRatio;if(this.titleCount){for(var i=0;i<2;++i)SCREEN_OFFSET[i]=2*(titleCenter[i]*pixelRatio-screenBox[i])/(screenBox[2+i]-screenBox[i])-1;shader.bind(),shader.uniforms.dataAxis=DATA_AXIS,shader.uniforms.screenOffset=SCREEN_OFFSET,shader.uniforms.angle=titleAngle,shader.uniforms.color=titleColor,gl.drawArrays(gl.TRIANGLES,this.titleOffset,this.titleCount)}}}(),proto.bind=(DATA_SHIFT=[0,0],DATA_SCALE=[0,0],TEXT_SCALE=[0,0],function(){var plot=this.plot,shader=this.shader,bounds=plot._tickBounds,dataBox=plot.dataBox,screenBox=plot.screenBox,viewBox=plot.viewBox;shader.bind();for(var i=0;i<2;++i){var lo=bounds[i],boundScale=bounds[i+2]-lo,dataCenter=.5*(dataBox[i+2]+dataBox[i]),dataWidth=dataBox[i+2]-dataBox[i],viewLo=viewBox[i],viewScale=viewBox[i+2]-viewLo,screenLo=screenBox[i],screenScale=screenBox[i+2]-screenLo;DATA_SCALE[i]=2*boundScale/dataWidth*viewScale/screenScale,DATA_SHIFT[i]=2*(lo-dataCenter)/dataWidth*viewScale/screenScale}TEXT_SCALE[1]=2*plot.pixelRatio/(screenBox[3]-screenBox[1]),TEXT_SCALE[0]=TEXT_SCALE[1]*(screenBox[3]-screenBox[1])/(screenBox[2]-screenBox[0]),shader.uniforms.dataScale=DATA_SCALE,shader.uniforms.dataShift=DATA_SHIFT,shader.uniforms.textScale=TEXT_SCALE,this.vbo.bind(),shader.attributes.textCoordinate.pointer()}),proto.update=function(options){var i,j,data,scale,dimension,vertices=[],axesTicks=options.ticks,bounds=options.bounds;for(dimension=0;dimension<2;++dimension){var offsets=[Math.floor(vertices.length/3)],tickX=[-1/0],ticks=axesTicks[dimension];for(i=0;i<ticks.length;++i){var tick=ticks[i],x=tick.x,text=tick.text,font=tick.font||"sans-serif";scale=tick.fontSize||12;for(var coordScale=1/(bounds[dimension+2]-bounds[dimension]),coordShift=bounds[dimension],rows=text.split("\n"),r=0;r<rows.length;r++)for(data=getText(font,rows[r]).data,j=0;j<data.length;j+=2)vertices.push(data[j]*scale,-data[j+1]*scale-r*scale*1.2,(x-coordShift)*coordScale);offsets.push(Math.floor(vertices.length/3)),tickX.push(x)}this.tickOffset[dimension]=offsets,this.tickX[dimension]=tickX}for(dimension=0;dimension<2;++dimension){for(this.labelOffset[dimension]=Math.floor(vertices.length/3),data=getText(options.labelFont[dimension],options.labels[dimension],{textAlign:"center"}).data,scale=options.labelSize[dimension],i=0;i<data.length;i+=2)vertices.push(data[i]*scale,-data[i+1]*scale,0);this.labelCount[dimension]=Math.floor(vertices.length/3)-this.labelOffset[dimension]}for(this.titleOffset=Math.floor(vertices.length/3),data=getText(options.titleFont,options.title).data,scale=options.titleSize,i=0;i<data.length;i+=2)vertices.push(data[i]*scale,-data[i+1]*scale,0);this.titleCount=Math.floor(vertices.length/3)-this.titleOffset,this.vbo.update(vertices)},proto.dispose=function(){this.vbo.dispose(),this.shader.dispose()}},{"./shaders":271,"binary-search-bounds":273,"gl-buffer":229,"gl-shader":286,"text-cache":510}],273:[function(_dereq_,module,exports){arguments[4][98][0].apply(exports,arguments)},{dup:98}],274:[function(_dereq_,module,exports){"use strict";module.exports=function createGLPlot2D(options){var gl=options.gl,pickBuffer=createPick(gl,[gl.drawingBufferWidth,gl.drawingBufferHeight]),plot=new GLPlot2D(gl,pickBuffer);return plot.grid=createGrid(plot),plot.text=createText(plot),plot.line=createLine(plot),plot.box=createBox(plot),plot.update(options),plot};var createPick=_dereq_("gl-select-static"),createGrid=_dereq_("./lib/grid"),createText=_dereq_("./lib/text"),createLine=_dereq_("./lib/line"),createBox=_dereq_("./lib/box");function GLPlot2D(gl,pickBuffer){this.gl=gl,this.pickBuffer=pickBuffer,this.screenBox=[0,0,gl.drawingBufferWidth,gl.drawingBufferHeight],this.viewBox=[0,0,0,0],this.dataBox=[-10,-10,10,10],this.gridLineEnable=[!0,!0],this.gridLineWidth=[1,1],this.gridLineColor=[[0,0,0,1],[0,0,0,1]],this.pixelRatio=1,this.tickMarkLength=[0,0,0,0],this.tickMarkWidth=[0,0,0,0],this.tickMarkColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.tickPad=[15,15,15,15],this.tickAngle=[0,0,0,0],this.tickEnable=[!0,!0,!0,!0],this.tickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.labelPad=[15,15,15,15],this.labelAngle=[0,Math.PI/2,0,3*Math.PI/2],this.labelEnable=[!0,!0,!0,!0],this.labelColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.titleCenter=[0,0],this.titleEnable=!0,this.titleAngle=0,this.titleColor=[0,0,0,1],this.borderColor=[0,0,0,0],this.backgroundColor=[0,0,0,0],this.zeroLineEnable=[!0,!0],this.zeroLineWidth=[4,4],this.zeroLineColor=[[0,0,0,1],[0,0,0,1]],this.borderLineEnable=[!0,!0,!0,!0],this.borderLineWidth=[2,2,2,2],this.borderLineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.grid=null,this.text=null,this.line=null,this.box=null,this.objects=[],this.overlays=[],this._tickBounds=[1/0,1/0,-1/0,-1/0],this.static=!1,this.dirty=!1,this.pickDirty=!1,this.pickDelay=120,this.pickRadius=10,this._pickTimeout=null,this._drawPick=this.drawPick.bind(this),this._depthCounter=0}var proto=GLPlot2D.prototype;function deepClone(array){for(var result=array.slice(),i=0;i<result.length;++i)result[i]=result[i].slice();return result}function compareTicks(a,b){return a.x-b.x}proto.setDirty=function(){this.dirty=this.pickDirty=!0},proto.setOverlayDirty=function(){this.dirty=!0},proto.nextDepthValue=function(){return this._depthCounter++/65536},proto.draw=function(){var gl=this.gl,screenBox=this.screenBox,viewPixels=this.viewBox,dataBox=this.dataBox,pixelRatio=this.pixelRatio,grid=this.grid,line=this.line,text=this.text,objects=this.objects;if(this._depthCounter=0,this.pickDirty&&(this._pickTimeout&&clearTimeout(this._pickTimeout),this.pickDirty=!1,this._pickTimeout=setTimeout(this._drawPick,this.pickDelay)),this.dirty){if(this.dirty=!1,gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.enable(gl.SCISSOR_TEST),gl.disable(gl.DEPTH_TEST),gl.depthFunc(gl.LESS),gl.depthMask(!1),gl.enable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),this.borderColor){gl.scissor(screenBox[0],screenBox[1],screenBox[2]-screenBox[0],screenBox[3]-screenBox[1]);var borderColor=this.borderColor;gl.clearColor(borderColor[0]*borderColor[3],borderColor[1]*borderColor[3],borderColor[2]*borderColor[3],borderColor[3]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}gl.scissor(viewPixels[0],viewPixels[1],viewPixels[2]-viewPixels[0],viewPixels[3]-viewPixels[1]),gl.viewport(viewPixels[0],viewPixels[1],viewPixels[2]-viewPixels[0],viewPixels[3]-viewPixels[1]);var backgroundColor=this.backgroundColor;gl.clearColor(backgroundColor[0]*backgroundColor[3],backgroundColor[1]*backgroundColor[3],backgroundColor[2]*backgroundColor[3],backgroundColor[3]),gl.clear(gl.COLOR_BUFFER_BIT),grid.draw();var zeroLineEnable=this.zeroLineEnable,zeroLineColor=this.zeroLineColor,zeroLineWidth=this.zeroLineWidth;if(zeroLineEnable[0]||zeroLineEnable[1]){line.bind();for(var i=0;i<2;++i)if(zeroLineEnable[i]&&dataBox[i]<=0&&dataBox[i+2]>=0){var zeroIntercept=screenBox[i]-dataBox[i]*(screenBox[i+2]-screenBox[i])/(dataBox[i+2]-dataBox[i]);0===i?line.drawLine(zeroIntercept,screenBox[1],zeroIntercept,screenBox[3],zeroLineWidth[i],zeroLineColor[i]):line.drawLine(screenBox[0],zeroIntercept,screenBox[2],zeroIntercept,zeroLineWidth[i],zeroLineColor[i])}}for(i=0;i<objects.length;++i)objects[i].draw();gl.viewport(screenBox[0],screenBox[1],screenBox[2]-screenBox[0],screenBox[3]-screenBox[1]),gl.scissor(screenBox[0],screenBox[1],screenBox[2]-screenBox[0],screenBox[3]-screenBox[1]),this.grid.drawTickMarks(),line.bind();var borderLineEnable=this.borderLineEnable,borderLineWidth=this.borderLineWidth,borderLineColor=this.borderLineColor;for(borderLineEnable[1]&&line.drawLine(viewPixels[0],viewPixels[1]-.5*borderLineWidth[1]*pixelRatio,viewPixels[0],viewPixels[3]+.5*borderLineWidth[3]*pixelRatio,borderLineWidth[1],borderLineColor[1]),borderLineEnable[0]&&line.drawLine(viewPixels[0]-.5*borderLineWidth[0]*pixelRatio,viewPixels[1],viewPixels[2]+.5*borderLineWidth[2]*pixelRatio,viewPixels[1],borderLineWidth[0],borderLineColor[0]),borderLineEnable[3]&&line.drawLine(viewPixels[2],viewPixels[1]-.5*borderLineWidth[1]*pixelRatio,viewPixels[2],viewPixels[3]+.5*borderLineWidth[3]*pixelRatio,borderLineWidth[3],borderLineColor[3]),borderLineEnable[2]&&line.drawLine(viewPixels[0]-.5*borderLineWidth[0]*pixelRatio,viewPixels[3],viewPixels[2]+.5*borderLineWidth[2]*pixelRatio,viewPixels[3],borderLineWidth[2],borderLineColor[2]),text.bind(),i=0;i<2;++i)text.drawTicks(i);this.titleEnable&&text.drawTitle();var overlays=this.overlays;for(i=0;i<overlays.length;++i)overlays[i].draw();gl.disable(gl.SCISSOR_TEST),gl.disable(gl.BLEND),gl.depthMask(!0)}},proto.drawPick=function(){if(!this.static){var pickBuffer=this.pickBuffer;this.gl;this._pickTimeout=null,pickBuffer.begin();for(var pickOffset=1,objects=this.objects,i=0;i<objects.length;++i)pickOffset=objects[i].drawPick(pickOffset);pickBuffer.end()}},proto.pick=function(x,y){if(!this.static){var pixelRatio=this.pixelRatio,pickPixelRatio=this.pickPixelRatio,viewBox=this.viewBox,scrX=0|Math.round((x-viewBox[0]/pixelRatio)*pickPixelRatio),scrY=0|Math.round((y-viewBox[1]/pixelRatio)*pickPixelRatio),pickResult=this.pickBuffer.query(scrX,scrY,this.pickRadius);if(!pickResult)return null;for(var pickValue=pickResult.id+(pickResult.value[0]<<8)+(pickResult.value[1]<<16)+(pickResult.value[2]<<24),objects=this.objects,i=0;i<objects.length;++i){var result=objects[i].pick(scrX,scrY,pickValue);if(result)return result}return null}},proto.setScreenBox=function(nbox){var screenBox=this.screenBox,pixelRatio=this.pixelRatio;screenBox[0]=0|Math.round(nbox[0]*pixelRatio),screenBox[1]=0|Math.round(nbox[1]*pixelRatio),screenBox[2]=0|Math.round(nbox[2]*pixelRatio),screenBox[3]=0|Math.round(nbox[3]*pixelRatio),this.setDirty()},proto.setDataBox=function(nbox){var dataBox=this.dataBox;(dataBox[0]!==nbox[0]||dataBox[1]!==nbox[1]||dataBox[2]!==nbox[2]||dataBox[3]!==nbox[3])&&(dataBox[0]=nbox[0],dataBox[1]=nbox[1],dataBox[2]=nbox[2],dataBox[3]=nbox[3],this.setDirty())},proto.setViewBox=function(nbox){var pixelRatio=this.pixelRatio,viewBox=this.viewBox;viewBox[0]=0|Math.round(nbox[0]*pixelRatio),viewBox[1]=0|Math.round(nbox[1]*pixelRatio),viewBox[2]=0|Math.round(nbox[2]*pixelRatio),viewBox[3]=0|Math.round(nbox[3]*pixelRatio);var pickPixelRatio=this.pickPixelRatio;this.pickBuffer.shape=[0|Math.round((nbox[2]-nbox[0])*pickPixelRatio),0|Math.round((nbox[3]-nbox[1])*pickPixelRatio)],this.setDirty()},proto.update=function(options){options=options||{};var gl=this.gl;this.pixelRatio=options.pixelRatio||1;var pixelRatio=this.pixelRatio;this.pickPixelRatio=Math.max(pixelRatio,1),this.setScreenBox(options.screenBox||[0,0,gl.drawingBufferWidth/pixelRatio,gl.drawingBufferHeight/pixelRatio]);this.screenBox;this.setViewBox(options.viewBox||[.125*(this.screenBox[2]-this.screenBox[0])/pixelRatio,.125*(this.screenBox[3]-this.screenBox[1])/pixelRatio,.875*(this.screenBox[2]-this.screenBox[0])/pixelRatio,.875*(this.screenBox[3]-this.screenBox[1])/pixelRatio]);var viewBox=this.viewBox,aspectRatio=(viewBox[2]-viewBox[0])/(viewBox[3]-viewBox[1]);this.setDataBox(options.dataBox||[-10,-10/aspectRatio,10,10/aspectRatio]),this.borderColor=!1!==options.borderColor&&(options.borderColor||[0,0,0,0]).slice(),this.backgroundColor=(options.backgroundColor||[0,0,0,0]).slice(),this.gridLineEnable=(options.gridLineEnable||[!0,!0]).slice(),this.gridLineWidth=(options.gridLineWidth||[1,1]).slice(),this.gridLineColor=deepClone(options.gridLineColor||[[.5,.5,.5,1],[.5,.5,.5,1]]),this.zeroLineEnable=(options.zeroLineEnable||[!0,!0]).slice(),this.zeroLineWidth=(options.zeroLineWidth||[4,4]).slice(),this.zeroLineColor=deepClone(options.zeroLineColor||[[0,0,0,1],[0,0,0,1]]),this.tickMarkLength=(options.tickMarkLength||[0,0,0,0]).slice(),this.tickMarkWidth=(options.tickMarkWidth||[0,0,0,0]).slice(),this.tickMarkColor=deepClone(options.tickMarkColor||[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]]),this.titleCenter=(options.titleCenter||[.5*(viewBox[0]+viewBox[2])/pixelRatio,(viewBox[3]+120)/pixelRatio]).slice(),this.titleEnable=!("titleEnable"in options&&!options.titleEnable),this.titleAngle=options.titleAngle||0,this.titleColor=(options.titleColor||[0,0,0,1]).slice(),this.labelPad=(options.labelPad||[15,15,15,15]).slice(),this.labelAngle=(options.labelAngle||[0,Math.PI/2,0,3*Math.PI/2]).slice(),this.labelEnable=(options.labelEnable||[!0,!0,!0,!0]).slice(),this.labelColor=deepClone(options.labelColor||[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]]),this.tickPad=(options.tickPad||[15,15,15,15]).slice(),this.tickAngle=(options.tickAngle||[0,0,0,0]).slice(),this.tickEnable=(options.tickEnable||[!0,!0,!0,!0]).slice(),this.tickColor=deepClone(options.tickColor||[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]]),this.borderLineEnable=(options.borderLineEnable||[!0,!0,!0,!0]).slice(),this.borderLineWidth=(options.borderLineWidth||[2,2,2,2]).slice(),this.borderLineColor=deepClone(options.borderLineColor||[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]]);var ticks=options.ticks||[[],[]],bounds=this._tickBounds;bounds[0]=bounds[1]=1/0,bounds[2]=bounds[3]=-1/0;for(var i=0;i<2;++i){var axisTicks=ticks[i].slice(0);0!==axisTicks.length&&(axisTicks.sort(compareTicks),bounds[i]=Math.min(bounds[i],axisTicks[0].x),bounds[i+2]=Math.max(bounds[i+2],axisTicks[axisTicks.length-1].x))}this.grid.update({bounds:bounds,ticks:ticks}),this.text.update({bounds:bounds,ticks:ticks,labels:options.labels||["x","y"],labelSize:options.labelSize||[12,12],labelFont:options.labelFont||["sans-serif","sans-serif"],title:options.title||"",titleSize:options.titleSize||18,titleFont:options.titleFont||"sans-serif"}),this.static=!!options.static,this.setDirty()},proto.dispose=function(){this.box.dispose(),this.grid.dispose(),this.text.dispose(),this.line.dispose();for(var i=this.objects.length-1;i>=0;--i)this.objects[i].dispose();this.objects.length=0;for(i=this.overlays.length-1;i>=0;--i)this.overlays[i].dispose();this.overlays.length=0,this.gl=null},proto.addObject=function(object){this.objects.indexOf(object)<0&&(this.objects.push(object),this.setDirty())},proto.removeObject=function(object){for(var objects=this.objects,i=0;i<objects.length;++i)if(objects[i]===object){objects.splice(i,1),this.setDirty();break}},proto.addOverlay=function(object){this.overlays.indexOf(object)<0&&(this.overlays.push(object),this.setOverlayDirty())},proto.removeOverlay=function(object){for(var objects=this.overlays,i=0;i<objects.length;++i)if(objects[i]===object){objects.splice(i,1),this.setOverlayDirty();break}}},{"./lib/box":268,"./lib/grid":269,"./lib/line":270,"./lib/text":272,"gl-select-static":285}],275:[function(_dereq_,module,exports){var glslify=_dereq_("glslify"),createShader=_dereq_("gl-shader"),vertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 uv;\nvoid main() {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}"]),fragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform sampler2D accumBuffer;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 accum = texture2D(accumBuffer, 0.5 * (uv + 1.0));\n  gl_FragColor = min(vec4(1,1,1,1), accum);\n}"]);module.exports=function(gl){return createShader(gl,vertSrc,fragSrc,null,[{name:"position",type:"vec2"}])}},{"gl-shader":286,glslify:390}],276:[function(_dereq_,module,exports){"use strict";module.exports=function createScene(options){var stopped=!1,canvas=((options=options||{}).pixelRatio||parseFloat(window.devicePixelRatio),options.canvas);if(!canvas)if(canvas=document.createElement("canvas"),options.container){var container=options.container;container.appendChild(canvas)}else document.body.appendChild(canvas);var gl=options.gl;gl||(gl=function getContext(canvas,options){var gl=null;try{(gl=canvas.getContext("webgl",options))||(gl=canvas.getContext("experimental-webgl",options))}catch(e){return null}return gl}(canvas,options.glOptions||{premultipliedAlpha:!0,antialias:!0}));if(!gl)throw new Error("webgl not supported");var bounds=options.bounds||[[-10,-10,-10],[10,10,10]],selection=new function MouseSelect(){this.mouse=[-1,-1],this.screen=null,this.distance=1/0,this.index=null,this.dataCoordinate=null,this.dataPosition=null,this.object=null,this.data=null},accumBuffer=createFBO(gl,[gl.drawingBufferWidth,gl.drawingBufferHeight],{preferFloat:!isMobile}),accumShader=createShader(gl),cameraOptions=options.camera||{eye:[2,0,0],center:[0,0,0],up:[0,1,0],zoomMin:.1,zoomMax:100,mode:"turntable"},axesOptions=options.axes||{},axes=createAxes(gl,axesOptions);axes.enable=!axesOptions.disable;var spikeOptions=options.spikes||{},spikes=createSpikes(gl,spikeOptions),objects=[],pickBufferIds=[],pickBufferCount=[],pickBuffers=[],dirty=!0,pickDirty=!0,projection=new Array(16),model=new Array(16),cameraParams={view:null,projection:projection,model:model},pickDirty=!0,viewShape=[gl.drawingBufferWidth,gl.drawingBufferHeight],scene={gl:gl,contextLost:!1,pixelRatio:options.pixelRatio||parseFloat(window.devicePixelRatio),canvas:canvas,selection:selection,camera:createCamera(canvas,cameraOptions),axes:axes,axesPixels:null,spikes:spikes,bounds:bounds,objects:objects,shape:viewShape,aspect:options.aspectRatio||[1,1,1],pickRadius:options.pickRadius||10,zNear:options.zNear||.01,zFar:options.zFar||1e3,fovy:options.fovy||Math.PI/4,clearColor:options.clearColor||[0,0,0,0],autoResize:defaultBool(options.autoResize),autoBounds:defaultBool(options.autoBounds),autoScale:!!options.autoScale,autoCenter:defaultBool(options.autoCenter),clipToBounds:defaultBool(options.clipToBounds),snapToData:!!options.snapToData,onselect:options.onselect||null,onrender:options.onrender||null,onclick:options.onclick||null,cameraParams:cameraParams,oncontextloss:null,mouseListener:null},pickShape=[gl.drawingBufferWidth/scene.pixelRatio|0,gl.drawingBufferHeight/scene.pixelRatio|0];function resizeListener(){if(!stopped&&scene.autoResize){var parent=canvas.parentNode,width=1,height=1;parent&&parent!==document.body?(width=parent.clientWidth,height=parent.clientHeight):(width=window.innerWidth,height=window.innerHeight);var nextWidth=0|Math.ceil(width*scene.pixelRatio),nextHeight=0|Math.ceil(height*scene.pixelRatio);if(nextWidth!==canvas.width||nextHeight!==canvas.height){canvas.width=nextWidth,canvas.height=nextHeight;var style=canvas.style;style.position=style.position||"absolute",style.left="0px",style.top="0px",style.width=width+"px",style.height=height+"px",dirty=!0}}}scene.autoResize&&resizeListener();function reallocPickIds(){for(var numObjs=objects.length,numPick=pickBuffers.length,i=0;i<numPick;++i)pickBufferCount[i]=0;obj_loop:for(var i=0;i<numObjs;++i){var obj=objects[i],pickCount=obj.pickSlots;if(pickCount){for(var j=0;j<numPick;++j)if(pickBufferCount[j]+pickCount<255){pickBufferIds[i]=j,obj.setPickBase(pickBufferCount[j]+1),pickBufferCount[j]+=pickCount;continue obj_loop}var nbuffer=createSelect(gl,viewShape);pickBufferIds[i]=numPick,pickBuffers.push(nbuffer),pickBufferCount.push(pickCount),obj.setPickBase(1),numPick+=1}else pickBufferIds[i]=-1}for(;numPick>0&&0===pickBufferCount[numPick-1];)pickBufferCount.pop(),pickBuffers.pop().dispose()}window.addEventListener("resize",resizeListener),scene.update=function(options){stopped||(options=options||{},dirty=!0,pickDirty=!0)},scene.add=function(obj){stopped||(obj.axes=axes,objects.push(obj),pickBufferIds.push(-1),dirty=!0,pickDirty=!0,reallocPickIds())},scene.remove=function(obj){if(!stopped){var idx=objects.indexOf(obj);idx<0||(objects.splice(idx,1),pickBufferIds.pop(),dirty=!0,pickDirty=!0,reallocPickIds())}},scene.dispose=function(){if(!stopped&&(stopped=!0,window.removeEventListener("resize",resizeListener),canvas.removeEventListener("webglcontextlost",checkContextLoss),scene.mouseListener.enabled=!1,!scene.contextLost)){axes.dispose(),spikes.dispose();for(var i=0;i<objects.length;++i)objects[i].dispose();accumBuffer.dispose();for(var i=0;i<pickBuffers.length;++i)pickBuffers[i].dispose();accumShader.dispose(),gl=null,axes=null,spikes=null,objects=[]}};var mouseRotating=!1,prevButtons=0;function checkContextLoss(){if(scene.contextLost)return!0;gl.isContextLost()&&(scene.contextLost=!0,scene.mouseListener.enabled=!1,scene.selection.object=null,scene.oncontextloss&&scene.oncontextloss())}scene.mouseListener=mouseChange(canvas,function(buttons,x,y){if(!stopped){var numPick=pickBuffers.length,numObjs=objects.length,prevObj=selection.object;selection.distance=1/0,selection.mouse[0]=x,selection.mouse[1]=y,selection.object=null,selection.screen=null,selection.dataCoordinate=selection.dataPosition=null;var change=!1;if(buttons&&prevButtons)mouseRotating=!0;else{mouseRotating&&(pickDirty=!0),mouseRotating=!1;for(var i=0;i<numPick;++i){var result=pickBuffers[i].query(x,pickShape[1]-y-1,scene.pickRadius);if(result){if(result.distance>selection.distance)continue;for(var j=0;j<numObjs;++j){var obj=objects[j];if(pickBufferIds[j]===i){var objPick=obj.pick(result);objPick&&(selection.buttons=buttons,selection.screen=result.coord,selection.distance=result.distance,selection.object=obj,selection.index=objPick.distance,selection.dataPosition=objPick.position,selection.dataCoordinate=objPick.dataCoordinate,selection.data=objPick,change=!0)}}}}}prevObj&&prevObj!==selection.object&&(prevObj.highlight&&prevObj.highlight(null),dirty=!0),selection.object&&(selection.object.highlight&&selection.object.highlight(selection.data),dirty=!0),(change=change||selection.object!==prevObj)&&scene.onselect&&scene.onselect(selection),1&buttons&&!(1&prevButtons)&&scene.onclick&&scene.onclick(selection),prevButtons=buttons}}),canvas.addEventListener("webglcontextlost",checkContextLoss);var nBounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],prevBounds=[nBounds[0].slice(),nBounds[1].slice()];function redraw(){if(!checkContextLoss()){resizeListener();var cameraMoved=scene.camera.tick();cameraParams.view=scene.camera.matrix,dirty=dirty||cameraMoved,pickDirty=pickDirty||cameraMoved,axes.pixelRatio=scene.pixelRatio,spikes.pixelRatio=scene.pixelRatio;var numObjs=objects.length,lo=nBounds[0],hi=nBounds[1];lo[0]=lo[1]=lo[2]=1/0,hi[0]=hi[1]=hi[2]=-1/0;for(var i=0;i<numObjs;++i){var obj=objects[i];obj.pixelRatio=scene.pixelRatio,obj.axes=scene.axes,dirty=dirty||!!obj.dirty,pickDirty=pickDirty||!!obj.dirty;var obb=obj.bounds;if(obb)for(var olo=obb[0],ohi=obb[1],j=0;j<3;++j)lo[j]=Math.min(lo[j],olo[j]),hi[j]=Math.max(hi[j],ohi[j])}var bounds=scene.bounds;if(scene.autoBounds)for(var j=0;j<3;++j){if(hi[j]<lo[j])lo[j]=-1,hi[j]=1;else{lo[j]===hi[j]&&(lo[j]-=1,hi[j]+=1);var padding=.05*(hi[j]-lo[j]);lo[j]=lo[j]-padding,hi[j]=hi[j]+padding}bounds[0][j]=lo[j],bounds[1][j]=hi[j]}for(var boundsChanged=!1,j=0;j<3;++j)boundsChanged=boundsChanged||prevBounds[0][j]!==bounds[0][j]||prevBounds[1][j]!==bounds[1][j],prevBounds[0][j]=bounds[0][j],prevBounds[1][j]=bounds[1][j];if(pickDirty=pickDirty||boundsChanged,dirty=dirty||boundsChanged){if(boundsChanged){for(var tickSpacing=[0,0,0],i=0;i<3;++i)tickSpacing[i]=roundUpPow10((bounds[1][i]-bounds[0][i])/10);axes.autoTicks?axes.update({bounds:bounds,tickSpacing:tickSpacing}):axes.update({bounds:bounds})}var width=gl.drawingBufferWidth,height=gl.drawingBufferHeight;viewShape[0]=width,viewShape[1]=height,pickShape[0]=0|Math.max(width/scene.pixelRatio,1),pickShape[1]=0|Math.max(height/scene.pixelRatio,1),perspective(projection,scene.fovy,width/height,scene.zNear,scene.zFar);for(var i=0;i<16;++i)model[i]=0;model[15]=1;for(var maxS=0,i=0;i<3;++i)maxS=Math.max(maxS,bounds[1][i]-bounds[0][i]);for(var i=0;i<3;++i)scene.autoScale?model[5*i]=scene.aspect[i]/(bounds[1][i]-bounds[0][i]):model[5*i]=1/maxS,scene.autoCenter&&(model[12+i]=.5*-model[5*i]*(bounds[0][i]+bounds[1][i]));for(var i=0;i<numObjs;++i){var obj=objects[i];obj.axesBounds=bounds,scene.clipToBounds&&(obj.clipBounds=bounds)}selection.object&&(scene.snapToData?spikes.position=selection.dataCoordinate:spikes.position=selection.dataPosition,spikes.bounds=bounds),pickDirty&&(pickDirty=!1,function renderPick(){if(checkContextLoss())return;gl.colorMask(!0,!0,!0,!0),gl.depthMask(!0),gl.disable(gl.BLEND),gl.enable(gl.DEPTH_TEST);for(var numObjs=objects.length,numPick=pickBuffers.length,j=0;j<numPick;++j){var buf=pickBuffers[j];buf.shape=pickShape,buf.begin();for(var i=0;i<numObjs;++i)if(pickBufferIds[i]===j){var obj=objects[i];obj.drawPick&&(obj.pixelRatio=1,obj.drawPick(cameraParams))}buf.end()}}()),scene.axesPixels=axesRanges(scene.axes,cameraParams,width,height),scene.onrender&&scene.onrender(),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,width,height);var clearColor=scene.clearColor;gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.depthMask(!0),gl.colorMask(!0,!0,!0,!0),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.disable(gl.BLEND),gl.disable(gl.CULL_FACE);var hasTransparent=!1;axes.enable&&(hasTransparent=hasTransparent||axes.isTransparent(),axes.draw(cameraParams)),spikes.axes=axes,selection.object&&spikes.draw(cameraParams),gl.disable(gl.CULL_FACE);for(var i=0;i<numObjs;++i){var obj=objects[i];obj.axes=axes,obj.pixelRatio=scene.pixelRatio,obj.isOpaque&&obj.isOpaque()&&obj.draw(cameraParams),obj.isTransparent&&obj.isTransparent()&&(hasTransparent=!0)}if(hasTransparent){accumBuffer.shape=viewShape,accumBuffer.bind(),gl.clear(gl.DEPTH_BUFFER_BIT),gl.colorMask(!1,!1,!1,!1),gl.depthMask(!0),gl.depthFunc(gl.LESS),axes.enable&&axes.isTransparent()&&axes.drawTransparent(cameraParams);for(var i=0;i<numObjs;++i){var obj=objects[i];obj.isOpaque&&obj.isOpaque()&&obj.draw(cameraParams)}gl.enable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.colorMask(!0,!0,!0,!0),gl.depthMask(!1),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT),axes.isTransparent()&&axes.drawTransparent(cameraParams);for(var i=0;i<numObjs;++i){var obj=objects[i];obj.isTransparent&&obj.isTransparent()&&obj.drawTransparent(cameraParams)}gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.disable(gl.DEPTH_TEST),accumShader.bind(),accumBuffer.color[0].bind(0),accumShader.uniforms.accumBuffer=0,drawTriangle(gl),gl.disable(gl.BLEND)}dirty=!1;for(var i=0;i<numObjs;++i)objects[i].dirty=!1}}}return function render(){stopped||scene.contextLost||(requestAnimationFrame(render),redraw())}(),scene.redraw=function(){stopped||(dirty=!0,redraw())},scene};var createCamera=_dereq_("3d-view-controls"),createAxes=_dereq_("gl-axes3d"),axesRanges=_dereq_("gl-axes3d/properties"),createSpikes=_dereq_("gl-spikes3d"),createSelect=_dereq_("gl-select-static"),createFBO=_dereq_("gl-fbo"),drawTriangle=_dereq_("a-big-triangle"),mouseChange=_dereq_("mouse-change"),perspective=_dereq_("gl-mat4/perspective"),createShader=_dereq_("./lib/shader"),isMobile=_dereq_("is-mobile")();function roundUpPow10(x){var y=Math.round(Math.log(Math.abs(x))/Math.log(10));if(y<0){var base=Math.round(Math.pow(10,-y));return Math.ceil(x*base)/base}if(y>0){base=Math.round(Math.pow(10,y));return Math.ceil(x/base)*base}return Math.ceil(x)}function defaultBool(x){return"boolean"!=typeof x||x}},{"./lib/shader":275,"3d-view-controls":43,"a-big-triangle":46,"gl-axes3d":221,"gl-axes3d/properties":228,"gl-fbo":238,"gl-mat4/perspective":256,"gl-select-static":285,"gl-spikes3d":295,"is-mobile":401,"mouse-change":415}],277:[function(_dereq_,module,exports){var glslify=_dereq_("glslify");exports.pointVertex=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\n\nuniform mat3 matrix;\nuniform float pointSize;\nuniform float pointCloud;\n\nhighp float rand(vec2 co) {\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float d = dot(co.xy, vec2(a, b));\n  highp float e = mod(d, 3.14);\n  return fract(sin(e) * c);\n}\n\nvoid main() {\n  vec3 hgPosition = matrix * vec3(position, 1);\n  gl_Position  = vec4(hgPosition.xy, 0, hgPosition.z);\n    // if we don't jitter the point size a bit, overall point cloud\n    // saturation 'jumps' on zooming, which is disturbing and confusing\n  gl_PointSize = pointSize * ((19.5 + rand(position)) / 20.0);\n  if(pointCloud != 0.0) { // pointCloud is truthy\n    // get the same square surface as circle would be\n    gl_PointSize *= 0.886;\n  }\n}"]),exports.pointFragment=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 color, borderColor;\nuniform float centerFraction;\nuniform float pointCloud;\n\nvoid main() {\n  float radius;\n  vec4 baseColor;\n  if(pointCloud != 0.0) { // pointCloud is truthy\n    if(centerFraction == 1.0) {\n      gl_FragColor = color;\n    } else {\n      gl_FragColor = mix(borderColor, color, centerFraction);\n    }\n  } else {\n    radius = length(2.0 * gl_PointCoord.xy - 1.0);\n    if(radius > 1.0) {\n      discard;\n    }\n    baseColor = mix(borderColor, color, step(radius, centerFraction));\n    gl_FragColor = vec4(baseColor.rgb * baseColor.a, baseColor.a);\n  }\n}\n"]),exports.pickVertex=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 pickId;\n\nuniform mat3 matrix;\nuniform float pointSize;\nuniform vec4 pickOffset;\n\nvarying vec4 fragId;\n\nvoid main() {\n  vec3 hgPosition = matrix * vec3(position, 1);\n  gl_Position  = vec4(hgPosition.xy, 0, hgPosition.z);\n  gl_PointSize = pointSize;\n\n  vec4 id = pickId + pickOffset;\n  id.y += floor(id.x / 256.0);\n  id.x -= floor(id.x / 256.0) * 256.0;\n\n  id.z += floor(id.y / 256.0);\n  id.y -= floor(id.y / 256.0) * 256.0;\n\n  id.w += floor(id.z / 256.0);\n  id.z -= floor(id.z / 256.0) * 256.0;\n\n  fragId = id;\n}\n"]),exports.pickFragment=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvarying vec4 fragId;\n\nvoid main() {\n  float radius = length(2.0 * gl_PointCoord.xy - 1.0);\n  if(radius > 1.0) {\n    discard;\n  }\n  gl_FragColor = fragId / 255.0;\n}\n"])},{glslify:390}],278:[function(_dereq_,module,exports){"use strict";var createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),pool=_dereq_("typedarray-pool"),SHADERS=_dereq_("./lib/shader");function Pointcloud2D(plot,offsetBuffer,pickBuffer,shader,pickShader){this.plot=plot,this.offsetBuffer=offsetBuffer,this.pickBuffer=pickBuffer,this.shader=shader,this.pickShader=pickShader,this.sizeMin=.5,this.sizeMinCap=2,this.sizeMax=20,this.areaRatio=1,this.pointCount=0,this.color=[1,0,0,1],this.borderColor=[0,0,0,1],this.blend=!1,this.pickOffset=0,this.points=null}module.exports=function createPointcloud2D(plot,options){var gl=plot.gl,buffer=createBuffer(gl),pickBuffer=createBuffer(gl),shader=createShader(gl,SHADERS.pointVertex,SHADERS.pointFragment),pickShader=createShader(gl,SHADERS.pickVertex,SHADERS.pickFragment),result=new Pointcloud2D(plot,buffer,pickBuffer,shader,pickShader);return result.update(options),plot.addObject(result),result};var MATRIX,PICK_VEC4,proto=Pointcloud2D.prototype;proto.dispose=function(){this.shader.dispose(),this.pickShader.dispose(),this.offsetBuffer.dispose(),this.pickBuffer.dispose(),this.plot.removeObject(this)},proto.update=function(options){var i;function dflt(opt,value){return opt in options?options[opt]:value}options=options||{},this.sizeMin=dflt("sizeMin",.5),this.sizeMax=dflt("sizeMax",20),this.color=dflt("color",[1,0,0,1]).slice(),this.areaRatio=dflt("areaRatio",1),this.borderColor=dflt("borderColor",[0,0,0,1]).slice(),this.blend=dflt("blend",!1);var pointCount=options.positions.length>>>1,dataStraightThrough=options.positions instanceof Float32Array,idStraightThrough=options.idToIndex instanceof Int32Array&&options.idToIndex.length>=pointCount,data=options.positions,packed=dataStraightThrough?data:pool.mallocFloat32(data.length),packedId=idStraightThrough?options.idToIndex:pool.mallocInt32(pointCount);if(dataStraightThrough||packed.set(data),!idStraightThrough)for(packed.set(data),i=0;i<pointCount;i++)packedId[i]=i;this.points=data,this.offsetBuffer.update(packed),this.pickBuffer.update(packedId),dataStraightThrough||pool.free(packed),idStraightThrough||pool.free(packedId),this.pointCount=pointCount,this.pickOffset=0},proto.unifiedDraw=(MATRIX=[1,0,0,0,1,0,0,0,1],PICK_VEC4=[0,0,0,0],function(pickOffset){var pick=void 0!==pickOffset,shader=pick?this.pickShader:this.shader,gl=this.plot.gl,dataBox=this.plot.dataBox;if(0===this.pointCount)return pickOffset;var dataX=dataBox[2]-dataBox[0],dataY=dataBox[3]-dataBox[1],visiblePointCountEstimate=function count(points,dataBox){var i,visiblePointCountEstimate=0,length=points.length>>>1;for(i=0;i<length;i++){var x=points[2*i],y=points[2*i+1];x>=dataBox[0]&&x<=dataBox[2]&&y>=dataBox[1]&&y<=dataBox[3]&&visiblePointCountEstimate++}return visiblePointCountEstimate}(this.points,dataBox),basicPointSize=this.plot.pickPixelRatio*Math.max(Math.min(this.sizeMinCap,this.sizeMin),Math.min(this.sizeMax,this.sizeMax/Math.pow(visiblePointCountEstimate,.33333)));MATRIX[0]=2/dataX,MATRIX[4]=2/dataY,MATRIX[6]=-2*dataBox[0]/dataX-1,MATRIX[7]=-2*dataBox[1]/dataY-1,this.offsetBuffer.bind(),shader.bind(),shader.attributes.position.pointer(),shader.uniforms.matrix=MATRIX,shader.uniforms.color=this.color,shader.uniforms.borderColor=this.borderColor,shader.uniforms.pointCloud=basicPointSize<5,shader.uniforms.pointSize=basicPointSize,shader.uniforms.centerFraction=Math.min(1,Math.max(0,Math.sqrt(1-this.areaRatio))),pick&&(PICK_VEC4[0]=255&pickOffset,PICK_VEC4[1]=pickOffset>>8&255,PICK_VEC4[2]=pickOffset>>16&255,PICK_VEC4[3]=pickOffset>>24&255,this.pickBuffer.bind(),shader.attributes.pickId.pointer(gl.UNSIGNED_BYTE),shader.uniforms.pickOffset=PICK_VEC4,this.pickOffset=pickOffset);var blend=gl.getParameter(gl.BLEND),dither=gl.getParameter(gl.DITHER);return blend&&!this.blend&&gl.disable(gl.BLEND),dither&&gl.disable(gl.DITHER),gl.drawArrays(gl.POINTS,0,this.pointCount),blend&&!this.blend&&gl.enable(gl.BLEND),dither&&gl.enable(gl.DITHER),pickOffset+this.pointCount}),proto.draw=proto.unifiedDraw,proto.drawPick=proto.unifiedDraw,proto.pick=function(x,y,value){var pickOffset=this.pickOffset,pointCount=this.pointCount;if(value<pickOffset||value>=pickOffset+pointCount)return null;var pointId=value-pickOffset,points=this.points;return{object:this,pointId:pointId,dataCoord:[points[2*pointId],points[2*pointId+1]]}}},{"./lib/shader":277,"gl-buffer":229,"gl-shader":286,"typedarray-pool":519}],279:[function(_dereq_,module,exports){module.exports=function slerp(out,a,b,t){var omega,cosom,sinom,scale0,scale1,ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw);1-cosom>1e-6?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t);return out[0]=scale0*ax+scale1*bx,out[1]=scale0*ay+scale1*by,out[2]=scale0*az+scale1*bz,out[3]=scale0*aw+scale1*bw,out}},{}],280:[function(_dereq_,module,exports){"use strict";var vectorizeText=_dereq_("vectorize-text");module.exports=function getGlyph(symbol,font){var fontCache=GLYPH_CACHE[font];fontCache||(fontCache=GLYPH_CACHE[font]={});if(symbol in fontCache)return fontCache[symbol];for(var lineSymbol=vectorizeText(symbol,{textAlign:"center",textBaseline:"middle",lineHeight:1,font:font}),triSymbol=vectorizeText(symbol,{triangles:!0,textAlign:"center",textBaseline:"middle",lineHeight:1,font:font}),bounds=[[1/0,1/0],[-1/0,-1/0]],i=0;i<lineSymbol.positions.length;++i)for(var p=lineSymbol.positions[i],j=0;j<2;++j)bounds[0][j]=Math.min(bounds[0][j],p[j]),bounds[1][j]=Math.max(bounds[1][j],p[j]);return fontCache[symbol]=[triSymbol,lineSymbol,bounds]};var GLYPH_CACHE={}},{"vectorize-text":524}],281:[function(_dereq_,module,exports){var createShaderWrapper=_dereq_("gl-shader"),glslify=_dereq_("glslify"),perspectiveVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 glyph;\nattribute vec4 id;\n\nuniform vec4 highlightId;\nuniform float highlightScale;\nuniform mat4 model, view, projection;\nuniform vec3 clipBounds[2];\n\nvarying vec4 interpColor;\nvarying vec4 pickId;\nvarying vec3 dataCoordinate;\n\nvoid main() {\n  if(any(lessThan(position, clipBounds[0]))   || \n     any(greaterThan(position, clipBounds[1])) ) {\n    gl_Position = vec4(0,0,0,0);\n  } else {\n    float scale = 1.0;\n    if(distance(highlightId, id) < 0.0001) {\n      scale = highlightScale;\n    }\n\n    vec4 worldPosition = model * vec4(position, 1);\n    vec4 viewPosition = view * worldPosition;\n    viewPosition = viewPosition / viewPosition.w;\n    vec4 clipPosition = projection * (viewPosition + scale * vec4(glyph.x, -glyph.y, 0, 0));\n    \n    gl_Position = clipPosition;\n    interpColor = color;\n    pickId = id;\n    dataCoordinate = position;\n  }\n}"]),orthographicVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 glyph;\nattribute vec4 id;\n\nuniform mat4 model, view, projection;\nuniform vec2 screenSize;\nuniform vec3 clipBounds[2];\nuniform float highlightScale, pixelRatio;\nuniform vec4 highlightId;\n\nvarying vec4 interpColor;\nvarying vec4 pickId;\nvarying vec3 dataCoordinate;\n\nvoid main() {\n  if(any(lessThan(position, clipBounds[0])) || any(greaterThan(position, clipBounds[1]))) {\n    gl_Position = vec4(0,0,0,0);\n  } else {\n    float scale = pixelRatio;\n    if(distance(highlightId.bgr, id.bgr) < 0.001) {\n      scale *= highlightScale;\n    }\n\n    vec4 worldPosition = model * vec4(position, 1.0);\n    vec4 viewPosition = view * worldPosition;\n    vec4 clipPosition = projection * viewPosition;\n    clipPosition /= clipPosition.w;\n    \n    gl_Position = clipPosition + vec4(screenSize * scale * vec2(glyph.x, -glyph.y), 0.0, 0.0);\n    interpColor = color;\n    pickId = id;\n    dataCoordinate = position;\n  }\n}"]),projectionVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec2 glyph;\nattribute vec4 id;\n\nuniform float highlightScale;\nuniform vec4 highlightId;\nuniform vec3 axes[2];\nuniform mat4 model, view, projection;\nuniform vec2 screenSize;\nuniform vec3 clipBounds[2];\nuniform float scale, pixelRatio;\n\nvarying vec4 interpColor;\nvarying vec4 pickId;\nvarying vec3 dataCoordinate;\n\nvoid main() {\n  if(any(lessThan(position, clipBounds[0]))   ||\n     any(greaterThan(position, clipBounds[1])) ) {\n    gl_Position = vec4(0,0,0,0);\n  } else {\n    float lscale = pixelRatio * scale;\n    if(distance(highlightId, id) < 0.0001) {\n      lscale *= highlightScale;\n    }\n\n    vec4 clipCenter   = projection * view * model * vec4(position, 1);\n    vec3 dataPosition = position + 0.5*lscale*(axes[0] * glyph.x + axes[1] * glyph.y) * clipCenter.w * screenSize.y;\n    vec4 clipPosition = projection * view * model * vec4(dataPosition, 1);\n\n    gl_Position = clipPosition;\n    interpColor = color;\n    pickId = id;\n    dataCoordinate = dataPosition;\n  }\n}\n"]),drawFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 fragClipBounds[2];\nuniform float opacity;\n\nvarying vec4 interpColor;\nvarying vec4 pickId;\nvarying vec3 dataCoordinate;\n\nvoid main() {\n  if(any(lessThan(dataCoordinate, fragClipBounds[0]))   ||\n     any(greaterThan(dataCoordinate, fragClipBounds[1])) ) {\n    discard;\n  } else {\n    gl_FragColor = interpColor * opacity;\n  }\n}\n"]),pickFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 fragClipBounds[2];\nuniform float pickGroup;\n\nvarying vec4 pickId;\nvarying vec3 dataCoordinate;\n\nvoid main() {\n  if(any(lessThan(dataCoordinate, fragClipBounds[0]))   || \n     any(greaterThan(dataCoordinate, fragClipBounds[1])) ) {\n    discard;\n  } else {\n    gl_FragColor = vec4(pickGroup, pickId.bgr);\n  }\n}"]),ATTRIBUTES=[{name:"position",type:"vec3"},{name:"color",type:"vec4"},{name:"glyph",type:"vec2"},{name:"id",type:"vec4"}],perspective={vertex:perspectiveVertSrc,fragment:drawFragSrc,attributes:ATTRIBUTES},ortho={vertex:orthographicVertSrc,fragment:drawFragSrc,attributes:ATTRIBUTES},project={vertex:projectionVertSrc,fragment:drawFragSrc,attributes:ATTRIBUTES},pickPerspective={vertex:perspectiveVertSrc,fragment:pickFragSrc,attributes:ATTRIBUTES},pickOrtho={vertex:orthographicVertSrc,fragment:pickFragSrc,attributes:ATTRIBUTES},pickProject={vertex:projectionVertSrc,fragment:pickFragSrc,attributes:ATTRIBUTES};function createShader(gl,src){var shader=createShaderWrapper(gl,src),attr=shader.attributes;return attr.position.location=0,attr.color.location=1,attr.glyph.location=2,attr.id.location=3,shader}exports.createPerspective=function(gl){return createShader(gl,perspective)},exports.createOrtho=function(gl){return createShader(gl,ortho)},exports.createProject=function(gl){return createShader(gl,project)},exports.createPickPerspective=function(gl){return createShader(gl,pickPerspective)},exports.createPickOrtho=function(gl){return createShader(gl,pickOrtho)},exports.createPickProject=function(gl){return createShader(gl,pickProject)}},{"gl-shader":286,glslify:390}],282:[function(_dereq_,module,exports){"use strict";var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),pool=_dereq_("typedarray-pool"),mat4mult=_dereq_("gl-mat4/multiply"),shaders=_dereq_("./lib/shaders"),getGlyph=_dereq_("./lib/glyphs"),IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function transformMat4(x,m){var x0=x[0],x1=x[1],x2=x[2],x3=x[3];return x[0]=m[0]*x0+m[4]*x1+m[8]*x2+m[12]*x3,x[1]=m[1]*x0+m[5]*x1+m[9]*x2+m[13]*x3,x[2]=m[2]*x0+m[6]*x1+m[10]*x2+m[14]*x3,x[3]=m[3]*x0+m[7]*x1+m[11]*x2+m[15]*x3,x}function project(p,v,m,x){return transformMat4(x,x),transformMat4(x,x),transformMat4(x,x)}function PointCloud(gl,shader,orthoShader,projectShader,pointBuffer,colorBuffer,glyphBuffer,idBuffer,vao,pickPerspectiveShader,pickOrthoShader,pickProjectShader){this.gl=gl,this.pixelRatio=1,this.shader=shader,this.orthoShader=orthoShader,this.projectShader=projectShader,this.pointBuffer=pointBuffer,this.colorBuffer=colorBuffer,this.glyphBuffer=glyphBuffer,this.idBuffer=idBuffer,this.vao=vao,this.vertexCount=0,this.lineVertexCount=0,this.opacity=1,this.lineWidth=0,this.projectScale=[2/3,2/3,2/3],this.projectOpacity=[1,1,1],this.pickId=0,this.pickPerspectiveShader=pickPerspectiveShader,this.pickOrthoShader=pickOrthoShader,this.pickProjectShader=pickProjectShader,this.points=[],this._selectResult=new function ScatterPlotPickResult(index,position){this.index=index,this.dataCoordinate=this.position=position}(0,[0,0,0]),this.useOrtho=!0,this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.axesProject=[!0,!0,!0],this.axesBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.highlightId=[1,1,1,1],this.highlightScale=2,this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.dirty=!0}module.exports=function createPointCloud(options){var gl=options.gl,shader=shaders.createPerspective(gl),orthoShader=shaders.createOrtho(gl),projectShader=shaders.createProject(gl),pickPerspectiveShader=shaders.createPickPerspective(gl),pickOrthoShader=shaders.createPickOrtho(gl),pickProjectShader=shaders.createPickProject(gl),pointBuffer=createBuffer(gl),colorBuffer=createBuffer(gl),glyphBuffer=createBuffer(gl),idBuffer=createBuffer(gl),vao=createVAO(gl,[{buffer:pointBuffer,size:3,type:gl.FLOAT},{buffer:colorBuffer,size:4,type:gl.FLOAT},{buffer:glyphBuffer,size:2,type:gl.FLOAT},{buffer:idBuffer,size:4,type:gl.UNSIGNED_BYTE,normalized:!0}]),pointCloud=new PointCloud(gl,shader,orthoShader,projectShader,pointBuffer,colorBuffer,glyphBuffer,idBuffer,vao,pickPerspectiveShader,pickOrthoShader,pickProjectShader);return pointCloud.update(options),pointCloud};var proto=PointCloud.prototype;proto.pickSlots=1,proto.setPickBase=function(pickBase){this.pickId=pickBase},proto.isTransparent=function(){if(this.opacity<1)return!0;for(var i=0;i<3;++i)if(this.axesProject[i]&&this.projectOpacity[i]<1)return!0;return!1},proto.isOpaque=function(){if(this.opacity>=1)return!0;for(var i=0;i<3;++i)if(this.axesProject[i]&&this.projectOpacity[i]>=1)return!0;return!1};var VIEW_SHAPE=[0,0],U_VEC=[0,0,0],V_VEC=[0,0,0],MU_VEC=[0,0,0,1],MV_VEC=[0,0,0,1],SCRATCH_MATRIX=IDENTITY.slice(),SCRATCH_VEC=[0,0,0],CLIP_BOUNDS=[[0,0,0],[0,0,0]];function zeroVec(a){return a[0]=a[1]=a[2]=0,a}function augment(hg,af){return hg[0]=af[0],hg[1]=af[1],hg[2]=af[2],hg[3]=1,hg}function setComponent(out,v,i,x){return out[0]=v[0],out[1]=v[1],out[2]=v[2],out[i]=x,out}function drawProject(shader,points,camera,transparent,forceDraw){var cubeAxis,axesProject=points.axesProject,gl=points.gl,uniforms=shader.uniforms,model=camera.model||IDENTITY,view=camera.view||IDENTITY,projection=camera.projection||IDENTITY,bounds=points.axesBounds,clipBounds=function getClipBounds(bounds){for(var result=CLIP_BOUNDS,i=0;i<2;++i)for(var j=0;j<3;++j)result[i][j]=Math.max(Math.min(bounds[i][j],1e8),-1e8);return result}(points.clipBounds);cubeAxis=points.axes&&points.axes.lastCubeProps?points.axes.lastCubeProps.axis:[1,1,1],VIEW_SHAPE[0]=2/gl.drawingBufferWidth,VIEW_SHAPE[1]=2/gl.drawingBufferHeight,shader.bind(),uniforms.view=view,uniforms.projection=projection,uniforms.screenSize=VIEW_SHAPE,uniforms.highlightId=points.highlightId,uniforms.highlightScale=points.highlightScale,uniforms.clipBounds=clipBounds,uniforms.pickGroup=points.pickId/255,uniforms.pixelRatio=points.pixelRatio;for(var i=0;i<3;++i)if(axesProject[i]&&points.projectOpacity[i]<1===transparent){uniforms.scale=points.projectScale[i],uniforms.opacity=points.projectOpacity[i];for(var pmodel=SCRATCH_MATRIX,j=0;j<16;++j)pmodel[j]=0;for(j=0;j<4;++j)pmodel[5*j]=1;pmodel[5*i]=0,cubeAxis[i]<0?pmodel[12+i]=bounds[0][i]:pmodel[12+i]=bounds[1][i],mat4mult(pmodel,model,pmodel),uniforms.model=pmodel;var u=(i+1)%3,v=(i+2)%3,du=zeroVec(U_VEC),dv=zeroVec(V_VEC);du[u]=1,dv[v]=1;var mdu=project(0,0,0,augment(MU_VEC,du)),mdv=project(0,0,0,augment(MV_VEC,dv));if(Math.abs(mdu[1])>Math.abs(mdv[1])){var tmp=mdu;mdu=mdv,mdv=tmp,tmp=du,du=dv,dv=tmp;var t=u;u=v,v=t}mdu[0]<0&&(du[u]=-1),mdv[1]>0&&(dv[v]=-1);var su=0,sv=0;for(j=0;j<4;++j)su+=Math.pow(model[4*u+j],2),sv+=Math.pow(model[4*v+j],2);du[u]/=Math.sqrt(su),dv[v]/=Math.sqrt(sv),uniforms.axes[0]=du,uniforms.axes[1]=dv,uniforms.fragClipBounds[0]=setComponent(SCRATCH_VEC,clipBounds[0],i,-1e8),uniforms.fragClipBounds[1]=setComponent(SCRATCH_VEC,clipBounds[1],i,1e8),points.vao.draw(gl.TRIANGLES,points.vertexCount),points.lineWidth>0&&(gl.lineWidth(points.lineWidth),points.vao.draw(gl.LINES,points.lineVertexCount,points.vertexCount))}}var CLIP_GROUP=[[-1e8,-1e8,-1e8],[1e8,1e8,1e8]];function drawFull(shader,pshader,points,camera,transparent,forceDraw){var gl=points.gl;if(points.vao.bind(),transparent===points.opacity<1||forceDraw){shader.bind();var uniforms=shader.uniforms;uniforms.model=camera.model||IDENTITY,uniforms.view=camera.view||IDENTITY,uniforms.projection=camera.projection||IDENTITY,VIEW_SHAPE[0]=2/gl.drawingBufferWidth,VIEW_SHAPE[1]=2/gl.drawingBufferHeight,uniforms.screenSize=VIEW_SHAPE,uniforms.highlightId=points.highlightId,uniforms.highlightScale=points.highlightScale,uniforms.fragClipBounds=CLIP_GROUP,uniforms.clipBounds=points.axes.bounds,uniforms.opacity=points.opacity,uniforms.pickGroup=points.pickId/255,uniforms.pixelRatio=points.pixelRatio,points.vao.draw(gl.TRIANGLES,points.vertexCount),points.lineWidth>0&&(gl.lineWidth(points.lineWidth),points.vao.draw(gl.LINES,points.lineVertexCount,points.vertexCount))}drawProject(pshader,points,camera,transparent),points.vao.unbind()}proto.draw=function(camera){drawFull(this.useOrtho?this.orthoShader:this.shader,this.projectShader,this,camera,!1,!1)},proto.drawTransparent=function(camera){drawFull(this.useOrtho?this.orthoShader:this.shader,this.projectShader,this,camera,!0,!1)},proto.drawPick=function(camera){drawFull(this.useOrtho?this.pickOrthoShader:this.pickPerspectiveShader,this.pickProjectShader,this,camera,!1,!0)},proto.pick=function(selected){if(!selected)return null;if(selected.id!==this.pickId)return null;var x=selected.value[2]+(selected.value[1]<<8)+(selected.value[0]<<16);if(x>=this.pointCount||x<0)return null;var coord=this.points[x],result=this._selectResult;result.index=x;for(var i=0;i<3;++i)result.position[i]=result.dataCoordinate[i]=coord[i];return result},proto.highlight=function(selection){if(selection){var pointId=selection.index,a0=255&pointId,a1=pointId>>8&255,a2=pointId>>16&255;this.highlightId=[a0/255,a1/255,a2/255,0]}else this.highlightId=[1,1,1,1]},proto.update=function(options){if("perspective"in(options=options||{})&&(this.useOrtho=!options.perspective),"orthographic"in options&&(this.useOrtho=!!options.orthographic),"lineWidth"in options&&(this.lineWidth=options.lineWidth),"project"in options)if(Array.isArray(options.project))this.axesProject=options.project;else{var v=!!options.project;this.axesProject=[v,v,v]}if("projectScale"in options)if(Array.isArray(options.projectScale))this.projectScale=options.projectScale.slice();else{var s=+options.projectScale;this.projectScale=[s,s,s]}if("projectOpacity"in options)if(Array.isArray(options.projectOpacity))this.projectOpacity=options.projectOpacity.slice();else{s=+options.projectOpacity;this.projectOpacity=[s,s,s]}"opacity"in options&&(this.opacity=options.opacity),this.dirty=!0;var points=options.position;if(points){var font=options.font||"normal",alignment=options.alignment||[0,0],lowerBound=[1/0,1/0,1/0],upperBound=[-1/0,-1/0,-1/0],glyphs=options.glyph,colors=options.color,sizes=options.size,angles=options.angle,lineColors=options.lineColor,pickCounter=0,triVertexCount=0,lineVertexCount=0,numPoints=points.length;count_loop:for(var i=0;i<numPoints;++i){for(var x=points[i],j=0;j<3;++j)if(isNaN(x[j])||!isFinite(x[j]))continue count_loop;var glyphMesh=(glyphData=Array.isArray(glyphs)?getGlyph(glyphs[i],font):getGlyph(glyphs||"",font))[0],glyphLines=glyphData[1],glyphBounds=glyphData[2];triVertexCount+=3*glyphMesh.cells.length,lineVertexCount+=2*glyphLines.edges.length}var vertexCount=triVertexCount+lineVertexCount,positionArray=pool.mallocFloat(3*vertexCount),colorArray=pool.mallocFloat(4*vertexCount),glyphArray=pool.mallocFloat(2*vertexCount),idArray=pool.mallocUint32(vertexCount),textOffset=[0,alignment[1]],triOffset=0,lineOffset=triVertexCount,color=[0,0,0,1],lineColor=[0,0,0,1],isColorArray=Array.isArray(colors)&&Array.isArray(colors[0]),isLineColorArray=Array.isArray(lineColors)&&Array.isArray(lineColors[0]);fill_loop:for(i=0;i<numPoints;++i){var glyphData;for(x=points[i],j=0;j<3;++j){if(isNaN(x[j])||!isFinite(x[j])){pickCounter+=1;continue fill_loop}upperBound[j]=Math.max(upperBound[j],x[j]),lowerBound[j]=Math.min(lowerBound[j],x[j])}var c;glyphMesh=(glyphData=Array.isArray(glyphs)?getGlyph(glyphs[i],font):getGlyph(glyphs||"",font))[0],glyphLines=glyphData[1],glyphBounds=glyphData[2];if(Array.isArray(colors)){if(3===(c=isColorArray?colors[i]:colors).length){for(j=0;j<3;++j)color[j]=c[j];color[3]=1}else if(4===c.length)for(j=0;j<4;++j)color[j]=c[j]}else color[0]=color[1]=color[2]=0,color[3]=1;if(Array.isArray(lineColors)){if(3===(c=isLineColorArray?lineColors[i]:lineColors).length){for(j=0;j<3;++j)lineColor[j]=c[j];lineColor[j]=1}else if(4===c.length)for(j=0;j<4;++j)lineColor[j]=c[j]}else lineColor[0]=lineColor[1]=lineColor[2]=0,lineColor[3]=1;var size=.5;Array.isArray(sizes)?size=+sizes[i]:sizes?size=+sizes:this.useOrtho&&(size=12);var angle=0;Array.isArray(angles)?angle=+angles[i]:angles&&(angle=+angles);var cos=Math.cos(angle),sin=Math.sin(angle);for(x=points[i],j=0;j<3;++j)upperBound[j]=Math.max(upperBound[j],x[j]),lowerBound[j]=Math.min(lowerBound[j],x[j]);alignment[0]<0?textOffset[0]=alignment[0]*(1+glyphBounds[1][0]):alignment[0]>0&&(textOffset[0]=-alignment[0]*(1+glyphBounds[0][0]));var cells=glyphMesh.cells,verts=glyphMesh.positions;for(j=0;j<cells.length;++j)for(var cell=cells[j],k=0;k<3;++k){for(var l=0;l<3;++l)positionArray[3*triOffset+l]=x[l];for(l=0;l<4;++l)colorArray[4*triOffset+l]=color[l];idArray[triOffset]=pickCounter;var p=verts[cell[k]];glyphArray[2*triOffset]=size*(cos*p[0]-sin*p[1]+textOffset[0]),glyphArray[2*triOffset+1]=size*(sin*p[0]+cos*p[1]+textOffset[1]),triOffset+=1}for(cells=glyphLines.edges,verts=glyphLines.positions,j=0;j<cells.length;++j)for(cell=cells[j],k=0;k<2;++k){for(l=0;l<3;++l)positionArray[3*lineOffset+l]=x[l];for(l=0;l<4;++l)colorArray[4*lineOffset+l]=lineColor[l];idArray[lineOffset]=pickCounter;p=verts[cell[k]];glyphArray[2*lineOffset]=size*(cos*p[0]-sin*p[1]+textOffset[0]),glyphArray[2*lineOffset+1]=size*(sin*p[0]+cos*p[1]+textOffset[1]),lineOffset+=1}pickCounter+=1}this.vertexCount=triVertexCount,this.lineVertexCount=lineVertexCount,this.pointBuffer.update(positionArray),this.colorBuffer.update(colorArray),this.glyphBuffer.update(glyphArray),this.idBuffer.update(new Uint32Array(idArray)),pool.free(positionArray),pool.free(colorArray),pool.free(glyphArray),pool.free(idArray),this.bounds=[lowerBound,upperBound],this.points=points,this.pointCount=points.length}},proto.dispose=function(){this.shader.dispose(),this.orthoShader.dispose(),this.pickPerspectiveShader.dispose(),this.pickOrthoShader.dispose(),this.vao.dispose(),this.pointBuffer.dispose(),this.colorBuffer.dispose(),this.glyphBuffer.dispose(),this.idBuffer.dispose()}},{"./lib/glyphs":280,"./lib/shaders":281,"gl-buffer":229,"gl-mat4/multiply":255,"gl-vao":308,"typedarray-pool":519}],283:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify");exports.boxVertex=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 vertex;\n\nuniform vec2 cornerA, cornerB;\n\nvoid main() {\n  gl_Position = vec4(mix(cornerA, cornerB, vertex), 0, 1);\n}\n"]),exports.boxFragment=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n"])},{glslify:390}],284:[function(_dereq_,module,exports){"use strict";var createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),SHADERS=_dereq_("./lib/shaders");function SelectBox(plot,boxBuffer,boxShader){this.plot=plot,this.boxBuffer=boxBuffer,this.boxShader=boxShader,this.enabled=!0,this.selectBox=[1/0,1/0,-1/0,-1/0],this.borderColor=[0,0,0,1],this.innerFill=!1,this.innerColor=[0,0,0,.25],this.outerFill=!0,this.outerColor=[0,0,0,.5],this.borderWidth=10}module.exports=function createSelectBox(plot,options){var gl=plot.gl,buffer=createBuffer(gl,[0,0,0,1,1,0,1,1]),shader=createShader(gl,SHADERS.boxVertex,SHADERS.boxFragment),selectBox=new SelectBox(plot,buffer,shader);return selectBox.update(options),plot.addOverlay(selectBox),selectBox};var proto=SelectBox.prototype;proto.draw=function(){if(this.enabled){var plot=this.plot,selectBox=this.selectBox,lineWidth=this.borderWidth,innerColor=(this.innerFill,this.innerColor),outerColor=(this.outerFill,this.outerColor),borderColor=this.borderColor,boxes=plot.box,screenBox=plot.screenBox,dataBox=plot.dataBox,viewBox=plot.viewBox,pixelRatio=plot.pixelRatio,loX=(selectBox[0]-dataBox[0])*(viewBox[2]-viewBox[0])/(dataBox[2]-dataBox[0])+viewBox[0],loY=(selectBox[1]-dataBox[1])*(viewBox[3]-viewBox[1])/(dataBox[3]-dataBox[1])+viewBox[1],hiX=(selectBox[2]-dataBox[0])*(viewBox[2]-viewBox[0])/(dataBox[2]-dataBox[0])+viewBox[0],hiY=(selectBox[3]-dataBox[1])*(viewBox[3]-viewBox[1])/(dataBox[3]-dataBox[1])+viewBox[1];if(loX=Math.max(loX,viewBox[0]),loY=Math.max(loY,viewBox[1]),hiX=Math.min(hiX,viewBox[2]),hiY=Math.min(hiY,viewBox[3]),!(hiX<loX||hiY<loY)){boxes.bind();var screenWidth=screenBox[2]-screenBox[0],screenHeight=screenBox[3]-screenBox[1];if(this.outerFill&&(boxes.drawBox(0,0,screenWidth,loY,outerColor),boxes.drawBox(0,loY,loX,hiY,outerColor),boxes.drawBox(0,hiY,screenWidth,screenHeight,outerColor),boxes.drawBox(hiX,loY,screenWidth,hiY,outerColor)),this.innerFill&&boxes.drawBox(loX,loY,hiX,hiY,innerColor),lineWidth>0){var w=lineWidth*pixelRatio;boxes.drawBox(loX-w,loY-w,hiX+w,loY+w,borderColor),boxes.drawBox(loX-w,hiY-w,hiX+w,hiY+w,borderColor),boxes.drawBox(loX-w,loY-w,loX+w,hiY+w,borderColor),boxes.drawBox(hiX-w,loY-w,hiX+w,hiY+w,borderColor)}}}},proto.update=function(options){options=options||{},this.innerFill=!!options.innerFill,this.outerFill=!!options.outerFill,this.innerColor=(options.innerColor||[0,0,0,.5]).slice(),this.outerColor=(options.outerColor||[0,0,0,.5]).slice(),this.borderColor=(options.borderColor||[0,0,0,1]).slice(),this.borderWidth=options.borderWidth||0,this.selectBox=(options.selectBox||this.selectBox).slice()},proto.dispose=function(){this.boxBuffer.dispose(),this.boxShader.dispose(),this.plot.removeOverlay(this)}},{"./lib/shaders":283,"gl-buffer":229,"gl-shader":286}],285:[function(_dereq_,module,exports){"use strict";module.exports=function createSelectBuffer(gl,shape){var fbo=createFBO(gl,shape),buffer=pool.mallocUint8(shape[0]*shape[1]*4);return new SelectBuffer(gl,fbo,buffer)};var createFBO=_dereq_("gl-fbo"),pool=_dereq_("typedarray-pool"),ndarray=_dereq_("ndarray"),nextPow2=_dereq_("bit-twiddle").nextPow2,selectRange=_dereq_("cwise/lib/wrapper")({args:["array",{offset:[0,0,1],array:0},{offset:[0,0,2],array:0},{offset:[0,0,3],array:0},"scalar","scalar","index"],pre:{body:"{this_closestD2=1e8,this_closestX=-1,this_closestY=-1}",args:[],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:[]},body:{body:"{if(_inline_16_arg0_<255||_inline_16_arg1_<255||_inline_16_arg2_<255||_inline_16_arg3_<255){var _inline_16_l=_inline_16_arg4_-_inline_16_arg6_[0],_inline_16_a=_inline_16_arg5_-_inline_16_arg6_[1],_inline_16_f=_inline_16_l*_inline_16_l+_inline_16_a*_inline_16_a;_inline_16_f<this_closestD2&&(this_closestD2=_inline_16_f,this_closestX=_inline_16_arg6_[0],this_closestY=_inline_16_arg6_[1])}}",args:[{name:"_inline_16_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg4_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg5_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_16_arg6_",lvalue:!1,rvalue:!0,count:4}],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:["_inline_16_a","_inline_16_f","_inline_16_l"]},post:{body:"{return[this_closestX,this_closestY,this_closestD2]}",args:[],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:[]},debug:!1,funcName:"cwise",blockSize:64});function SelectBuffer(gl,fbo,buffer){this.gl=gl,this.fbo=fbo,this.buffer=buffer,this._readTimeout=null;var self=this;this._readCallback=function(){self.gl&&(fbo.bind(),gl.readPixels(0,0,fbo.shape[0],fbo.shape[1],gl.RGBA,gl.UNSIGNED_BYTE,self.buffer),self._readTimeout=null)}}var proto=SelectBuffer.prototype;Object.defineProperty(proto,"shape",{get:function(){return this.gl?this.fbo.shape.slice():[0,0]},set:function(v){if(this.gl){this.fbo.shape=v;var c=this.fbo.shape[0],r=this.fbo.shape[1];if(r*c*4>this.buffer.length){pool.free(this.buffer);for(var buffer=this.buffer=pool.mallocUint8(nextPow2(r*c*4)),i=0;i<r*c*4;++i)buffer[i]=255}return v}}}),proto.begin=function(){var gl=this.gl;this.shape;gl&&(this.fbo.bind(),gl.clearColor(1,1,1,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT))},proto.end=function(){var gl=this.gl;gl&&(gl.bindFramebuffer(gl.FRAMEBUFFER,null),this._readTimeout||clearTimeout(this._readTimeout),this._readTimeout=setTimeout(this._readCallback,1))},proto.query=function(x,y,radius){if(!this.gl)return null;var shape=this.fbo.shape.slice();x|=0,y|=0,"number"!=typeof radius&&(radius=1);var x0=0|Math.min(Math.max(x-radius,0),shape[0]),x1=0|Math.min(Math.max(x+radius,0),shape[0]),y0=0|Math.min(Math.max(y-radius,0),shape[1]),y1=0|Math.min(Math.max(y+radius,0),shape[1]);if(x1<=x0||y1<=y0)return null;var dims=[x1-x0,y1-y0],region=ndarray(this.buffer,[dims[0],dims[1],4],[4,4*shape[0],1],4*(x0+shape[0]*y0)),closest=selectRange(region.hi(dims[0],dims[1],1),radius,radius),dx=closest[0],dy=closest[1];return dx<0||Math.pow(this.radius,2)<closest[2]?null:new function SelectResult(x,y,id,value,distance){this.coord=[x,y],this.id=id,this.value=value,this.distance=distance}(dx+x0|0,dy+y0|0,region.get(dx,dy,0),[region.get(dx,dy,1),region.get(dx,dy,2),region.get(dx,dy,3)],Math.sqrt(closest[2]))},proto.dispose=function(){this.gl&&(this.fbo.dispose(),pool.free(this.buffer),this.gl=null,this._readTimeout&&clearTimeout(this._readTimeout))}},{"bit-twiddle":79,"cwise/lib/wrapper":136,"gl-fbo":238,ndarray:430,"typedarray-pool":519}],286:[function(_dereq_,module,exports){"use strict";var createUniformWrapper=_dereq_("./lib/create-uniforms"),createAttributeWrapper=_dereq_("./lib/create-attributes"),makeReflect=_dereq_("./lib/reflect"),shaderCache=_dereq_("./lib/shader-cache"),runtime=_dereq_("./lib/runtime-reflect"),GLError=_dereq_("./lib/GLError");function Shader(gl){this.gl=gl,this.gl.lastAttribCount=0,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}var proto=Shader.prototype;function compareAttributes(a,b){return a.name<b.name?-1:1}proto.bind=function(){var i;this.program||this._relink();var newAttribCount=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),oldAttribCount=this.gl.lastAttribCount;if(newAttribCount>oldAttribCount)for(i=oldAttribCount;i<newAttribCount;i++)this.gl.enableVertexAttribArray(i);else if(oldAttribCount>newAttribCount)for(i=newAttribCount;i<oldAttribCount;i++)this.gl.disableVertexAttribArray(i);this.gl.lastAttribCount=newAttribCount,this.gl.useProgram(this.program)},proto.dispose=function(){for(var oldAttribCount=this.gl.lastAttribCount,i=0;i<oldAttribCount;i++)this.gl.disableVertexAttribArray(i);this.gl.lastAttribCount=0,this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},proto.update=function(vertSource,fragSource,uniforms,attributes){if(!fragSource||1===arguments.length){var obj=vertSource;vertSource=obj.vertex,fragSource=obj.fragment,uniforms=obj.uniforms,attributes=obj.attributes}var wrapper=this,gl=wrapper.gl,pvref=wrapper._vref;wrapper._vref=shaderCache.shader(gl,gl.VERTEX_SHADER,vertSource),pvref&&pvref.dispose(),wrapper.vertShader=wrapper._vref.shader;var pfref=this._fref;if(wrapper._fref=shaderCache.shader(gl,gl.FRAGMENT_SHADER,fragSource),pfref&&pfref.dispose(),wrapper.fragShader=wrapper._fref.shader,!uniforms||!attributes){var testProgram=gl.createProgram();if(gl.attachShader(testProgram,wrapper.fragShader),gl.attachShader(testProgram,wrapper.vertShader),gl.linkProgram(testProgram),!gl.getProgramParameter(testProgram,gl.LINK_STATUS)){var errLog=gl.getProgramInfoLog(testProgram);throw new GLError(errLog,"Error linking program:"+errLog)}uniforms=uniforms||runtime.uniforms(gl,testProgram),attributes=attributes||runtime.attributes(gl,testProgram),gl.deleteProgram(testProgram)}(attributes=attributes.slice()).sort(compareAttributes);var i,attributeUnpacked=[],attributeNames=[],attributeLocations=[];for(i=0;i<attributes.length;++i){var attr=attributes[i];if(attr.type.indexOf("mat")>=0){for(var size=0|attr.type.charAt(attr.type.length-1),locVector=new Array(size),j=0;j<size;++j)locVector[j]=attributeLocations.length,attributeNames.push(attr.name+"["+j+"]"),"number"==typeof attr.location?attributeLocations.push(attr.location+j):Array.isArray(attr.location)&&attr.location.length===size&&"number"==typeof attr.location[j]?attributeLocations.push(0|attr.location[j]):attributeLocations.push(-1);attributeUnpacked.push({name:attr.name,type:attr.type,locations:locVector})}else attributeUnpacked.push({name:attr.name,type:attr.type,locations:[attributeLocations.length]}),attributeNames.push(attr.name),"number"==typeof attr.location?attributeLocations.push(0|attr.location):attributeLocations.push(-1)}var curLocation=0;for(i=0;i<attributeLocations.length;++i)if(attributeLocations[i]<0){for(;attributeLocations.indexOf(curLocation)>=0;)curLocation+=1;attributeLocations[i]=curLocation}var uniformLocations=new Array(uniforms.length);function relink(){wrapper.program=shaderCache.program(gl,wrapper._vref,wrapper._fref,attributeNames,attributeLocations);for(var i=0;i<uniforms.length;++i)uniformLocations[i]=gl.getUniformLocation(wrapper.program,uniforms[i].name)}relink(),wrapper._relink=relink,wrapper.types={uniforms:makeReflect(uniforms),attributes:makeReflect(attributes)},wrapper.attributes=createAttributeWrapper(gl,wrapper,attributeUnpacked,attributeLocations),Object.defineProperty(wrapper,"uniforms",createUniformWrapper(gl,wrapper,uniforms,uniformLocations))},module.exports=function createShader(gl,vertSource,fragSource,uniforms,attributes){var shader=new Shader(gl);return shader.update(vertSource,fragSource,uniforms,attributes),shader}},{"./lib/GLError":287,"./lib/create-attributes":288,"./lib/create-uniforms":289,"./lib/reflect":290,"./lib/runtime-reflect":291,"./lib/shader-cache":292}],287:[function(_dereq_,module,exports){function GLError(rawError,shortMessage,longMessage){this.shortMessage=shortMessage||"",this.longMessage=longMessage||"",this.rawError=rawError||"",this.message="gl-shader: "+(shortMessage||rawError||"")+(longMessage?"\n"+longMessage:""),this.stack=(new Error).stack}GLError.prototype=new Error,GLError.prototype.name="GLError",GLError.prototype.constructor=GLError,module.exports=GLError},{}],288:[function(_dereq_,module,exports){"use strict";module.exports=function createAttributeWrapper(gl,wrapper,attributes,locations){for(var obj={},i=0,n=attributes.length;i<n;++i){var a=attributes[i],name=a.name,type=a.type,locs=a.locations;switch(type){case"bool":case"int":case"float":addVectorAttribute(gl,wrapper,locs[0],locations,1,obj,name);break;default:if(type.indexOf("vec")>=0){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid data type for attribute "+name+": "+type);addVectorAttribute(gl,wrapper,locs[0],locations,d,obj,name)}else{if(!(type.indexOf("mat")>=0))throw new GLError("","Unknown data type for attribute "+name+": "+type);var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid data type for attribute "+name+": "+type);addMatrixAttribute(gl,wrapper,locs,locations,d,obj,name)}}}return obj};var GLError=_dereq_("./GLError");function ShaderAttribute(gl,wrapper,index,locations,dimension,constFunc){this._gl=gl,this._wrapper=wrapper,this._index=index,this._locations=locations,this._dimension=dimension,this._constFunc=constFunc}var proto=ShaderAttribute.prototype;function addVectorAttribute(gl,wrapper,index,locations,dimension,obj,name){for(var constFuncArgs=["gl","v"],varNames=[],i=0;i<dimension;++i)constFuncArgs.push("x"+i),varNames.push("x"+i);constFuncArgs.push("if(x0.length===void 0){return gl.vertexAttrib"+dimension+"f(v,"+varNames.join()+")}else{return gl.vertexAttrib"+dimension+"fv(v,x0)}");var constFunc=Function.apply(null,constFuncArgs),attr=new ShaderAttribute(gl,wrapper,index,locations,dimension,constFunc);Object.defineProperty(obj,name,{set:function(x){return gl.disableVertexAttribArray(locations[index]),constFunc(gl,locations[index],x),x},get:function(){return attr},enumerable:!0})}function addMatrixAttribute(gl,wrapper,index,locations,dimension,obj,name){for(var parts=new Array(dimension),attrs=new Array(dimension),i=0;i<dimension;++i)addVectorAttribute(gl,wrapper,index[i],locations,dimension,parts,i),attrs[i]=parts[i];Object.defineProperty(parts,"location",{set:function(v){if(Array.isArray(v))for(var i=0;i<dimension;++i)attrs[i].location=v[i];else for(i=0;i<dimension;++i)attrs[i].location=v+i;return v},get:function(){for(var result=new Array(dimension),i=0;i<dimension;++i)result[i]=locations[index[i]];return result},enumerable:!0}),parts.pointer=function(type,normalized,stride,offset){type=type||gl.FLOAT,normalized=!!normalized,stride=stride||dimension*dimension,offset=offset||0;for(var i=0;i<dimension;++i){var location=locations[index[i]];gl.vertexAttribPointer(location,dimension,type,normalized,stride,offset+i*dimension),gl.enableVertexAttribArray(location)}};var scratch=new Array(dimension),vertexAttrib=gl["vertexAttrib"+dimension+"fv"];Object.defineProperty(obj,name,{set:function(x){for(var i=0;i<dimension;++i){var loc=locations[index[i]];if(gl.disableVertexAttribArray(loc),Array.isArray(x[0]))vertexAttrib.call(gl,loc,x[i]);else{for(var j=0;j<dimension;++j)scratch[j]=x[dimension*i+j];vertexAttrib.call(gl,loc,scratch)}}return x},get:function(){return parts},enumerable:!0})}proto.pointer=function setAttribPointer(type,normalized,stride,offset){var gl=this._gl,location=this._locations[this._index];gl.vertexAttribPointer(location,this._dimension,type||gl.FLOAT,!!normalized,stride||0,offset||0),gl.enableVertexAttribArray(location)},proto.set=function(x0,x1,x2,x3){return this._constFunc(this._locations[this._index],x0,x1,x2,x3)},Object.defineProperty(proto,"location",{get:function(){return this._locations[this._index]},set:function(v){return v!==this._locations[this._index]&&(this._locations[this._index]=0|v,this._wrapper.program=null),0|v}})},{"./GLError":287}],289:[function(_dereq_,module,exports){"use strict";var coallesceUniforms=_dereq_("./reflect"),GLError=_dereq_("./GLError");function identity(x){return new Function("y","return function(){return y}")(x)}function makeVector(length,fill){for(var result=new Array(length),i=0;i<length;++i)result[i]=fill;return result}module.exports=function createUniformWrapper(gl,wrapper,uniforms,locations){function makePropSetter(path,index,type){switch(type){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+index+"],obj"+path+")";case"float":return"gl.uniform1f(locations["+index+"],obj"+path+")";default:var vidx=type.indexOf("vec");if(!(0<=vidx&&vidx<=1&&type.length===4+vidx)){if(0===type.indexOf("mat")&&4===type.length){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid uniform dimension type for matrix "+name+": "+type);return"gl.uniformMatrix"+d+"fv(locations["+index+"],false,obj"+path+")"}throw new GLError("","Unknown uniform data type for "+name+": "+type)}var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid data type");switch(type.charAt(0)){case"b":case"i":return"gl.uniform"+d+"iv(locations["+index+"],obj"+path+")";case"v":return"gl.uniform"+d+"fv(locations["+index+"],obj"+path+")";default:throw new GLError("","Unrecognized data type for vector "+name+": "+type)}}}function makeSetter(type){for(var code=["return function updateProperty(obj){"],indices=function enumerateIndices(prefix,type){if("object"!=typeof type)return[[prefix,type]];var indices=[];for(var id in type){var prop=type[id],tprefix=prefix;parseInt(id)+""===id?tprefix+="["+id+"]":tprefix+="."+id,"object"==typeof prop?indices.push.apply(indices,enumerateIndices(tprefix,prop)):indices.push([tprefix,prop])}return indices}("",type),i=0;i<indices.length;++i){var item=indices[i],path=item[0],idx=item[1];locations[idx]&&code.push(makePropSetter(path,idx,uniforms[idx].type))}code.push("return obj}");var proc=new Function("gl","locations",code.join("\n"));return proc(gl,locations)}function storeProperty(obj,prop,type){if("object"==typeof type){var child=processObject(type);Object.defineProperty(obj,prop,{get:identity(child),set:makeSetter(type),enumerable:!0,configurable:!1})}else locations[type]?Object.defineProperty(obj,prop,{get:function makeGetter(index){return new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+index+"])}")(gl,wrapper,locations)}(type),set:makeSetter(type),enumerable:!0,configurable:!1}):obj[prop]=function defaultValue(type){switch(type){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var vidx=type.indexOf("vec");if(0<=vidx&&vidx<=1&&type.length===4+vidx){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid data type");return"b"===type.charAt(0)?makeVector(d,!1):makeVector(d,0)}if(0===type.indexOf("mat")&&4===type.length){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4)throw new GLError("","Invalid uniform dimension type for matrix "+name+": "+type);return makeVector(d*d,0)}throw new GLError("","Unknown uniform data type for "+name+": "+type)}}(uniforms[type].type)}function processObject(obj){var result;if(Array.isArray(obj)){result=new Array(obj.length);for(var i=0;i<obj.length;++i)storeProperty(result,i,obj[i])}else for(var id in result={},obj)storeProperty(result,id,obj[id]);return result}var coallesced=coallesceUniforms(uniforms,!0);return{get:identity(processObject(coallesced)),set:makeSetter(coallesced),enumerable:!0,configurable:!0}}},{"./GLError":287,"./reflect":290}],290:[function(_dereq_,module,exports){"use strict";module.exports=function makeReflectTypes(uniforms,useIndex){for(var obj={},i=0;i<uniforms.length;++i)for(var n=uniforms[i].name,parts=n.split("."),o=obj,j=0;j<parts.length;++j){var x=parts[j].split("[");if(x.length>1){x[0]in o||(o[x[0]]=[]),o=o[x[0]];for(var k=1;k<x.length;++k){var y=parseInt(x[k]);k<x.length-1||j<parts.length-1?(y in o||(k<x.length-1?o[y]=[]:o[y]={}),o=o[y]):o[y]=useIndex?i:uniforms[i].type}}else j<parts.length-1?(x[0]in o||(o[x[0]]={}),o=o[x[0]]):o[x[0]]=useIndex?i:uniforms[i].type}return obj}},{}],291:[function(_dereq_,module,exports){"use strict";exports.uniforms=function runtimeUniforms(gl,program){for(var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),result=[],i=0;i<numUniforms;++i){var info=gl.getActiveUniform(program,i);if(info){var type=getType(gl,info.type);if(info.size>1)for(var j=0;j<info.size;++j)result.push({name:info.name.replace("[0]","["+j+"]"),type:type});else result.push({name:info.name,type:type})}}return result},exports.attributes=function runtimeAttributes(gl,program){for(var numAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),result=[],i=0;i<numAttributes;++i){var info=gl.getActiveAttrib(program,i);info&&result.push({name:info.name,type:getType(gl,info.type)})}return result};var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},GL_TABLE=null;function getType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}},{}],292:[function(_dereq_,module,exports){"use strict";exports.shader=function getShaderReference(gl,type,src){return getCache(gl).getShaderReference(type,src)},exports.program=function createProgram(gl,vref,fref,attribs,locations){return getCache(gl).getProgram(vref,fref,attribs,locations)};var GLError=_dereq_("./GLError"),formatCompilerError=_dereq_("gl-format-compiler-error"),CACHE=new("undefined"==typeof WeakMap?_dereq_("weakmap-shim"):WeakMap),SHADER_COUNTER=0;function ShaderReference(id,src,type,shader,programs,count,cache){this.id=id,this.src=src,this.type=type,this.shader=shader,this.count=count,this.programs=[],this.cache=cache}function ContextCache(gl){this.gl=gl,this.shaders=[{},{}],this.programs={}}ShaderReference.prototype.dispose=function(){if(0==--this.count){for(var cache=this.cache,gl=cache.gl,programs=this.programs,i=0,n=programs.length;i<n;++i){var p=cache.programs[programs[i]];p&&(delete cache.programs[i],gl.deleteProgram(p))}gl.deleteShader(this.shader),delete cache.shaders[this.type===gl.FRAGMENT_SHADER|0][this.src]}};var proto=ContextCache.prototype;function getCache(gl){var ctxCache=CACHE.get(gl);return ctxCache||(ctxCache=new ContextCache(gl),CACHE.set(gl,ctxCache)),ctxCache}proto.getShaderReference=function(type,src){var gl=this.gl,shaders=this.shaders[type===gl.FRAGMENT_SHADER|0],shader=shaders[src];if(shader&&gl.isShader(shader.shader))shader.count+=1;else{var shaderObj=function compileShader(gl,type,src){var shader=gl.createShader(type);if(gl.shaderSource(shader,src),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var errLog=gl.getShaderInfoLog(shader);try{var fmt=formatCompilerError(errLog,src,type)}catch(e){throw console.warn("Failed to format compiler error: "+e),new GLError(errLog,"Error compiling shader:\n"+errLog)}throw new GLError(errLog,fmt.short,fmt.long)}return shader}(gl,type,src);shader=shaders[src]=new ShaderReference(SHADER_COUNTER++,src,type,shaderObj,[],1,this)}return shader},proto.getProgram=function(vref,fref,attribs,locations){var token=[vref.id,fref.id,attribs.join(":"),locations.join(":")].join("@"),prog=this.programs[token];return prog&&this.gl.isProgram(prog)||(this.programs[token]=prog=function linkProgram(gl,vshader,fshader,attribs,locations){var program=gl.createProgram();gl.attachShader(program,vshader),gl.attachShader(program,fshader);for(var i=0;i<attribs.length;++i)gl.bindAttribLocation(program,locations[i],attribs[i]);if(gl.linkProgram(program),!gl.getProgramParameter(program,gl.LINK_STATUS)){var errLog=gl.getProgramInfoLog(program);throw new GLError(errLog,"Error linking program: "+errLog)}return program}(this.gl,vref.shader,fref.shader,attribs,locations),vref.programs.push(token),fref.programs.push(token)),prog}},{"./GLError":287,"gl-format-compiler-error":239,"weakmap-shim":529}],293:[function(_dereq_,module,exports){"use strict";function GLSpikes2D(plot){this.plot=plot,this.enable=[!0,!0,!1,!1],this.width=[1,1,1,1],this.color=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.center=[1/0,1/0]}module.exports=function createSpikes2D(plot,options){var spikes=new GLSpikes2D(plot);return spikes.update(options),plot.addOverlay(spikes),spikes};var proto=GLSpikes2D.prototype;proto.update=function(options){options=options||{},this.enable=(options.enable||[!0,!0,!1,!1]).slice(),this.width=(options.width||[1,1,1,1]).slice(),this.color=(options.color||[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]]).map(function(x){return x.slice()}),this.center=(options.center||[1/0,1/0]).slice(),this.plot.setOverlayDirty()},proto.draw=function(){var spikeEnable=this.enable,spikeWidth=this.width,spikeColor=this.color,spikeCenter=this.center,plot=this.plot,line=plot.line,dataBox=plot.dataBox,viewPixels=plot.viewBox;if(line.bind(),dataBox[0]<=spikeCenter[0]&&spikeCenter[0]<=dataBox[2]&&dataBox[1]<=spikeCenter[1]&&spikeCenter[1]<=dataBox[3]){var centerX=viewPixels[0]+(spikeCenter[0]-dataBox[0])/(dataBox[2]-dataBox[0])*(viewPixels[2]-viewPixels[0]),centerY=viewPixels[1]+(spikeCenter[1]-dataBox[1])/(dataBox[3]-dataBox[1])*(viewPixels[3]-viewPixels[1]);spikeEnable[0]&&line.drawLine(centerX,centerY,viewPixels[0],centerY,spikeWidth[0],spikeColor[0]),spikeEnable[1]&&line.drawLine(centerX,centerY,centerX,viewPixels[1],spikeWidth[1],spikeColor[1]),spikeEnable[2]&&line.drawLine(centerX,centerY,viewPixels[2],centerY,spikeWidth[2],spikeColor[2]),spikeEnable[3]&&line.drawLine(centerX,centerY,centerX,viewPixels[3],spikeWidth[3],spikeColor[3])}},proto.dispose=function(){this.plot.removeOverlay(this)}},{}],294:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify"),createShader=_dereq_("gl-shader"),vertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec3 position, color;\nattribute float weight;\n\nuniform mat4 model, view, projection;\nuniform vec3 coordinates[3];\nuniform vec4 colors[3];\nuniform vec2 screenShape;\nuniform float lineWidth;\n\nvarying vec4 fragColor;\n\nvoid main() {\n  vec3 vertexPosition = mix(coordinates[0],\n    mix(coordinates[2], coordinates[1], 0.5 * (position + 1.0)), abs(position));\n\n  vec4 clipPos = projection * view * model * vec4(vertexPosition, 1.0);\n  vec2 clipOffset = (projection * view * model * vec4(color, 0.0)).xy;\n  vec2 delta = weight * clipOffset * screenShape;\n  vec2 lineOffset = normalize(vec2(delta.y, -delta.x)) / screenShape;\n\n  gl_Position   = vec4(clipPos.xy + clipPos.w * 0.5 * lineWidth * lineOffset, clipPos.z, clipPos.w);\n  fragColor     = color.x * colors[0] + color.y * colors[1] + color.z * colors[2];\n}\n"]),fragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvarying vec4 fragColor;\n\nvoid main() {\n  gl_FragColor = fragColor;\n}"]);module.exports=function(gl){return createShader(gl,vertSrc,fragSrc,null,[{name:"position",type:"vec3"},{name:"color",type:"vec3"},{name:"weight",type:"float"}])}},{"gl-shader":286,glslify:390}],295:[function(_dereq_,module,exports){"use strict";var createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createShader=_dereq_("./shaders/index");module.exports=function createSpikes(gl,options){var data=[];function line(x,y,z,i,l,h){var row=[x,y,z,0,0,0,1];row[i+3]=1,row[i]=l,data.push.apply(data,row),row[6]=-1,data.push.apply(data,row),row[i]=h,data.push.apply(data,row),data.push.apply(data,row),row[6]=1,data.push.apply(data,row),row[i]=l,data.push.apply(data,row)}line(0,0,0,0,0,1),line(0,0,0,1,0,1),line(0,0,0,2,0,1),line(1,0,0,1,-1,1),line(1,0,0,2,-1,1),line(0,1,0,0,-1,1),line(0,1,0,2,-1,1),line(0,0,1,0,-1,1),line(0,0,1,1,-1,1);var buffer=createBuffer(gl,data),vao=createVAO(gl,[{type:gl.FLOAT,buffer:buffer,size:3,offset:0,stride:28},{type:gl.FLOAT,buffer:buffer,size:3,offset:12,stride:28},{type:gl.FLOAT,buffer:buffer,size:1,offset:24,stride:28}]),shader=createShader(gl);shader.attributes.position.location=0,shader.attributes.color.location=1,shader.attributes.weight.location=2;var spikes=new AxisSpikes(gl,buffer,vao,shader);return spikes.update(options),spikes};var identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function AxisSpikes(gl,buffer,vao,shader){this.gl=gl,this.buffer=buffer,this.vao=vao,this.shader=shader,this.pixelRatio=1,this.bounds=[[-1e3,-1e3,-1e3],[1e3,1e3,1e3]],this.position=[0,0,0],this.lineWidth=[2,2,2],this.colors=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.enabled=[!0,!0,!0],this.drawSides=[!0,!0,!0],this.axes=null}var proto=AxisSpikes.prototype,OUTER_FACE=[0,0,0],INNER_FACE=[0,0,0],SHAPE=[0,0];proto.isTransparent=function(){return!1},proto.drawTransparent=function(camera){},proto.draw=function(camera){var gl=this.gl,vao=this.vao,shader=this.shader;vao.bind(),shader.bind();var axis,model=camera.model||identity,view=camera.view||identity,projection=camera.projection||identity;this.axes&&(axis=this.axes.lastCubeProps.axis);for(var outerFace=OUTER_FACE,innerFace=INNER_FACE,i=0;i<3;++i)axis&&axis[i]<0?(outerFace[i]=this.bounds[0][i],innerFace[i]=this.bounds[1][i]):(outerFace[i]=this.bounds[1][i],innerFace[i]=this.bounds[0][i]);SHAPE[0]=gl.drawingBufferWidth,SHAPE[1]=gl.drawingBufferHeight,shader.uniforms.model=model,shader.uniforms.view=view,shader.uniforms.projection=projection,shader.uniforms.coordinates=[this.position,outerFace,innerFace],shader.uniforms.colors=this.colors,shader.uniforms.screenShape=SHAPE;for(i=0;i<3;++i)shader.uniforms.lineWidth=this.lineWidth[i]*this.pixelRatio,this.enabled[i]&&(vao.draw(gl.TRIANGLES,6,6*i),this.drawSides[i]&&vao.draw(gl.TRIANGLES,12,18+12*i));vao.unbind()},proto.update=function(options){options&&("bounds"in options&&(this.bounds=options.bounds),"position"in options&&(this.position=options.position),"lineWidth"in options&&(this.lineWidth=options.lineWidth),"colors"in options&&(this.colors=options.colors),"enabled"in options&&(this.enabled=options.enabled),"drawSides"in options&&(this.drawSides=options.drawSides))},proto.dispose=function(){this.vao.dispose(),this.buffer.dispose(),this.shader.dispose()}},{"./shaders/index":294,"gl-buffer":229,"gl-vao":308}],296:[function(_dereq_,module,exports){arguments[4][231][0].apply(exports,arguments)},{barycentric:60,dup:231,"polytope-closest-point/lib/closest_point_2d.js":461}],297:[function(_dereq_,module,exports){var glslify=_dereq_("glslify"),triVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nvec3 getOrthogonalVector(vec3 v) {\n  // Return up-vector for only-z vector.\n  // Return ax + by + cz = 0, a point that lies on the plane that has v as a normal and that isn't (0,0,0).\n  // From the above if-statement we have ||a|| > 0  U  ||b|| > 0.\n  // Assign z = 0, x = -b, y = a:\n  // a*-b + b*a + c*0 = -ba + ba + 0 = 0\n  if (v.x*v.x > v.z*v.z || v.y*v.y > v.z*v.z) {\n    return normalize(vec3(-v.y, v.x, 0.0));\n  } else {\n    return normalize(vec3(0.0, v.z, -v.y));\n  }\n}\n\n// Calculate the tube vertex and normal at the given index.\n//\n// The returned vertex is for a tube ring with its center at origin, radius of length(d), pointing in the direction of d.\n//\n// Each tube segment is made up of a ring of vertices.\n// These vertices are used to make up the triangles of the tube by connecting them together in the vertex array.\n// The indexes of tube segments run from 0 to 8.\n//\nvec3 getTubePosition(vec3 d, float index, out vec3 normal) {\n  float segmentCount = 8.0;\n\n  float angle = 2.0 * 3.14159 * (index / segmentCount);\n\n  vec3 u = getOrthogonalVector(d);\n  vec3 v = normalize(cross(u, d));\n\n  vec3 x = u * cos(angle) * length(d);\n  vec3 y = v * sin(angle) * length(d);\n  vec3 v3 = x + y;\n\n  normal = normalize(v3);\n\n  return v3;\n}\n\nattribute vec4 vector;\nattribute vec4 color, position;\nattribute vec2 uv;\nuniform float tubeScale;\n\nuniform mat4 model\n           , view\n           , projection;\nuniform vec3 eyePosition\n           , lightPosition;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  // Scale the vector magnitude to stay constant with\n  // model & view changes.\n  vec3 normal;\n  vec4 tubePosition = model * vec4(position.xyz, 1.0) + vec4(getTubePosition(mat3(model) * (tubeScale * vector.w * normalize(vector.xyz)), position.w, normal), 0.0);\n  normal = normalize(normal * inverse(mat3(model)));\n\n  vec4 t_position  = view * tubePosition;\n  gl_Position      = projection * t_position;\n  f_color          = color;\n  f_normal         = normal;\n  f_data           = tubePosition.xyz;\n  f_eyeDirection   = eyePosition   - tubePosition.xyz;\n  f_lightDirection = lightPosition - tubePosition.xyz;\n  f_uv             = uv;\n}\n"]),triFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nfloat beckmannDistribution(float x, float roughness) {\n  float NdotH = max(x, 0.0001);\n  float cos2Alpha = NdotH * NdotH;\n  float tan2Alpha = (cos2Alpha - 1.0) / cos2Alpha;\n  float roughness2 = roughness * roughness;\n  float denom = 3.141592653589793 * roughness2 * cos2Alpha * cos2Alpha;\n  return exp(tan2Alpha / roughness2) / denom;\n}\n\nfloat cookTorranceSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float roughness,\n  float fresnel) {\n\n  float VdotN = max(dot(viewDirection, surfaceNormal), 0.0);\n  float LdotN = max(dot(lightDirection, surfaceNormal), 0.0);\n\n  //Half angle vector\n  vec3 H = normalize(lightDirection + viewDirection);\n\n  //Geometric term\n  float NdotH = max(dot(surfaceNormal, H), 0.0);\n  float VdotH = max(dot(viewDirection, H), 0.000001);\n  float LdotH = max(dot(lightDirection, H), 0.000001);\n  float G1 = (2.0 * NdotH * VdotN) / VdotH;\n  float G2 = (2.0 * NdotH * LdotN) / LdotH;\n  float G = min(1.0, min(G1, G2));\n  \n  //Distribution term\n  float D = beckmannDistribution(NdotH, roughness);\n\n  //Fresnel term\n  float F = pow(1.0 - VdotN, fresnel);\n\n  //Multiply terms and done\n  return  G * F * D / max(3.14159265 * VdotN, 0.000001);\n}\n\nuniform vec3 clipBounds[2];\nuniform float roughness\n            , fresnel\n            , kambient\n            , kdiffuse\n            , kspecular\n            , opacity;\nuniform sampler2D texture;\n\nvarying vec3 f_normal\n           , f_lightDirection\n           , f_eyeDirection\n           , f_data;\nvarying vec4 f_color;\nvarying vec2 f_uv;\n\nvoid main() {\n  vec3 N = normalize(f_normal);\n  vec3 L = normalize(f_lightDirection);\n  vec3 V = normalize(f_eyeDirection);\n  \n  if(!gl_FrontFacing) {\n    N = -N;\n  }\n\n  float specular = cookTorranceSpecular(L, V, N, roughness, fresnel);\n  float diffuse  = min(kambient + kdiffuse * max(dot(N, L), 0.0), 1.0);\n\n  vec4 surfaceColor =  texture2D(texture, f_uv);\n  vec4 litColor = surfaceColor.a * vec4(diffuse * surfaceColor.rgb + kspecular * vec3(1,1,1) * specular,  1.0);\n\n  gl_FragColor = litColor * opacity;\n}"]),pickVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvec3 getOrthogonalVector(vec3 v) {\n  // Return up-vector for only-z vector.\n  // Return ax + by + cz = 0, a point that lies on the plane that has v as a normal and that isn't (0,0,0).\n  // From the above if-statement we have ||a|| > 0  U  ||b|| > 0.\n  // Assign z = 0, x = -b, y = a:\n  // a*-b + b*a + c*0 = -ba + ba + 0 = 0\n  if (v.x*v.x > v.z*v.z || v.y*v.y > v.z*v.z) {\n    return normalize(vec3(-v.y, v.x, 0.0));\n  } else {\n    return normalize(vec3(0.0, v.z, -v.y));\n  }\n}\n\n// Calculate the tube vertex and normal at the given index.\n//\n// The returned vertex is for a tube ring with its center at origin, radius of length(d), pointing in the direction of d.\n//\n// Each tube segment is made up of a ring of vertices.\n// These vertices are used to make up the triangles of the tube by connecting them together in the vertex array.\n// The indexes of tube segments run from 0 to 8.\n//\nvec3 getTubePosition(vec3 d, float index, out vec3 normal) {\n  float segmentCount = 8.0;\n\n  float angle = 2.0 * 3.14159 * (index / segmentCount);\n\n  vec3 u = getOrthogonalVector(d);\n  vec3 v = normalize(cross(u, d));\n\n  vec3 x = u * cos(angle) * length(d);\n  vec3 y = v * sin(angle) * length(d);\n  vec3 v3 = x + y;\n\n  normal = normalize(v3);\n\n  return v3;\n}\n\nattribute vec4 vector;\nattribute vec4 position;\nattribute vec4 id;\n\nuniform mat4 model, view, projection;\nuniform float tubeScale;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  vec3 normal;\n  vec4 tubePosition = model * vec4(position.xyz, 1.0) + vec4(getTubePosition(mat3(model) * (tubeScale * vector.w * normalize(vector.xyz)), position.w, normal), 0.0);\n  gl_Position = projection * view * tubePosition;\n  f_id        = id;\n  f_position  = position.xyz;\n}\n"]),pickFragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3  clipBounds[2];\nuniform float pickId;\n\nvarying vec3 f_position;\nvarying vec4 f_id;\n\nvoid main() {\n  gl_FragColor = vec4(pickId, f_id.xyz);\n}"]);exports.meshShader={vertex:triVertSrc,fragment:triFragSrc,attributes:[{name:"position",type:"vec4"},{name:"normal",type:"vec3"},{name:"color",type:"vec4"},{name:"uv",type:"vec2"},{name:"vector",type:"vec4"}]},exports.pickShader={vertex:pickVertSrc,fragment:pickFragSrc,attributes:[{name:"position",type:"vec4"},{name:"id",type:"vec4"},{name:"vector",type:"vec4"}]}},{glslify:390}],298:[function(_dereq_,module,exports){"use strict";var createShader=_dereq_("gl-shader"),createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createTexture=_dereq_("gl-texture2d"),normals=_dereq_("normals"),multiply=_dereq_("gl-mat4/multiply"),invert=_dereq_("gl-mat4/invert"),ndarray=_dereq_("ndarray"),colormap=_dereq_("colormap"),getContour=_dereq_("simplicial-complex-contour"),pool=_dereq_("typedarray-pool"),shaders=_dereq_("./shaders"),meshShader=(_dereq_("./closest-point"),shaders.meshShader),pickShader=shaders.pickShader,identityMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function SimplicialMesh(gl,texture,triShader,lineShader,pointShader,pickShader,pointPickShader,contourShader,trianglePositions,triangleVectors,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,contourVAO){this.gl=gl,this.cells=[],this.positions=[],this.intensity=[],this.texture=texture,this.dirty=!0,this.triShader=triShader,this.lineShader=lineShader,this.pointShader=pointShader,this.pickShader=pickShader,this.pointPickShader=pointPickShader,this.contourShader=contourShader,this.trianglePositions=trianglePositions,this.triangleVectors=triangleVectors,this.triangleColors=triangleColors,this.triangleNormals=triangleNormals,this.triangleUVs=triangleUVs,this.triangleIds=triangleIds,this.triangleVAO=triangleVAO,this.triangleCount=0,this.lineWidth=1,this.edgePositions=edgePositions,this.edgeColors=edgeColors,this.edgeUVs=edgeUVs,this.edgeIds=edgeIds,this.edgeVAO=edgeVAO,this.edgeCount=0,this.pointPositions=pointPositions,this.pointColors=pointColors,this.pointUVs=pointUVs,this.pointSizes=pointSizes,this.pointIds=pointIds,this.pointVAO=pointVAO,this.pointCount=0,this.contourLineWidth=1,this.contourPositions=contourPositions,this.contourVAO=contourVAO,this.contourCount=0,this.contourColor=[0,0,0],this.contourEnable=!1,this.pickId=1,this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.lightPosition=[1e5,1e5,0],this.ambientLight=.8,this.diffuseLight=.8,this.specularLight=2,this.roughness=.5,this.fresnel=1.5,this.opacity=1,this.tubeScale=1,this._model=identityMatrix,this._view=identityMatrix,this._projection=identityMatrix,this._resolution=[1,1]}var proto=SimplicialMesh.prototype;function createPickShader(gl){var shader=createShader(gl,pickShader.vertex,pickShader.fragment,null,pickShader.attributes);return shader.attributes.position.location=0,shader.attributes.id.location=1,shader.attributes.vector.location=5,shader}proto.isOpaque=function(){return this.opacity>=1},proto.isTransparent=function(){return this.opacity<1},proto.pickSlots=1,proto.setPickBase=function(id){this.pickId=id},proto.highlight=function(selection){if(selection&&this.contourEnable){for(var level=getContour(this.cells,this.intensity,selection.intensity),cells=level.cells,vertexIds=level.vertexIds,vertexWeights=level.vertexWeights,numCells=cells.length,result=pool.mallocFloat32(6*numCells),ptr=0,i=0;i<numCells;++i)for(var c=cells[i],j=0;j<2;++j){var v=c[0];2===c.length&&(v=c[j]);for(var a=vertexIds[v][0],b=vertexIds[v][1],w=vertexWeights[v],wi=1-w,pa=this.positions[a],pb=this.positions[b],k=0;k<3;++k)result[ptr++]=w*pa[k]+wi*pb[k]}this.contourCount=ptr/3|0,this.contourPositions.update(result.subarray(0,ptr)),pool.free(result)}else this.contourCount=0},proto.update=function(params){params=params||{};var gl=this.gl;this.dirty=!0,"contourEnable"in params&&(this.contourEnable=params.contourEnable),"contourColor"in params&&(this.contourColor=params.contourColor),"lineWidth"in params&&(this.lineWidth=params.lineWidth),"lightPosition"in params&&(this.lightPosition=params.lightPosition),"opacity"in params&&(this.opacity=params.opacity),"ambient"in params&&(this.ambientLight=params.ambient),"diffuse"in params&&(this.diffuseLight=params.diffuse),"specular"in params&&(this.specularLight=params.specular),"roughness"in params&&(this.roughness=params.roughness),"fresnel"in params&&(this.fresnel=params.fresnel),params.texture?(this.texture.dispose(),this.texture=createTexture(gl,params.texture)):params.colormap&&(this.texture.shape=[256,256],this.texture.minFilter=gl.LINEAR_MIPMAP_LINEAR,this.texture.magFilter=gl.LINEAR,this.texture.setPixels(function genColormap(param){for(var colors=colormap({colormap:param,nshades:256,format:"rgba"}),result=new Uint8Array(1024),i=0;i<256;++i){for(var c=colors[i],j=0;j<3;++j)result[4*i+j]=c[j];result[4*i+3]=255*c[3]}return ndarray(result,[256,256,4],[4,0,1])}(params.colormap)),this.texture.generateMipmap());var cells=params.cells,positions=params.positions,vectors=params.vectors;if(positions&&cells&&vectors){void 0!==params.tubeScale&&(this.tubeScale=params.tubeScale);var tPos=[],tVec=[],tCol=[],tNor=[],tUVs=[],tIds=[],ePos=[],eCol=[],eUVs=[],eIds=[],pPos=[],pCol=[],pUVs=[],pSiz=[],pIds=[];this.cells=cells,this.positions=positions,this.vectors=vectors;var vertexNormals=params.vertexNormals,cellNormals=params.cellNormals,vertexNormalsEpsilon=void 0===params.vertexNormalsEpsilon?1e-6:params.vertexNormalsEpsilon,faceNormalsEpsilon=void 0===params.faceNormalsEpsilon?1e-6:params.faceNormalsEpsilon;params.useFacetNormals&&!cellNormals&&(cellNormals=normals.faceNormals(cells,positions,faceNormalsEpsilon)),cellNormals||vertexNormals||(vertexNormals=normals.vertexNormals(cells,positions,vertexNormalsEpsilon));var vertexColors=params.vertexColors,cellColors=params.cellColors,meshColor=params.meshColor||[1,1,1,1],vertexUVs=params.vertexUVs,vertexIntensity=params.vertexIntensity,cellUVs=params.cellUVs,cellIntensity=params.cellIntensity,intensityLo=1/0,intensityHi=-1/0;if(!vertexUVs&&!cellUVs)if(vertexIntensity)if(params.vertexIntensityBounds)intensityLo=+params.vertexIntensityBounds[0],intensityHi=+params.vertexIntensityBounds[1];else for(var i=0;i<vertexIntensity.length;++i){var f=vertexIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else if(cellIntensity)for(i=0;i<cellIntensity.length;++i){f=cellIntensity[i];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}else for(i=0;i<positions.length;++i){f=positions[i][2];intensityLo=Math.min(intensityLo,f),intensityHi=Math.max(intensityHi,f)}this.intensity=vertexIntensity||(cellIntensity?function unpackIntensity(cells,numVerts,cellIntensity){for(var result=new Array(numVerts),i=0;i<numVerts;++i)result[i]=0;var numCells=cells.length;for(i=0;i<numCells;++i)for(var c=cells[i],j=0;j<c.length;++j)result[c[j]]=cellIntensity[i];return result}(cells,positions.length,cellIntensity):function takeZComponent(array){for(var n=array.length,result=new Array(n),i=0;i<n;++i)result[i]=array[i][2];return result}(positions));var pointSizes=params.pointSizes,meshPointSize=params.pointSize||1;this.bounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];for(i=0;i<positions.length;++i)for(var p=positions[i],j=0;j<3;++j)!isNaN(p[j])&&isFinite(p[j])&&(this.bounds[0][j]=Math.min(this.bounds[0][j],p[j]),this.bounds[1][j]=Math.max(this.bounds[1][j],p[j]));var triangleCount=0,edgeCount=0,pointCount=0;fill_loop:for(i=0;i<cells.length;++i){var cell=cells[i];switch(cell.length){case 1:for(p=positions[v=cell[0]],j=0;j<3;++j)if(isNaN(p[j])||!isFinite(p[j]))continue fill_loop;pPos.push(p[0],p[1],p[2],p[3]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?pCol.push(c[0],c[1],c[2],1):pCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],pUVs.push(uv[0],uv[1]),pointSizes?pSiz.push(pointSizes[v]):pSiz.push(meshPointSize),pIds.push(i),pointCount+=1;break;case 2:for(j=0;j<2;++j){p=positions[v=cell[j]];for(var k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop}for(j=0;j<2;++j){p=positions[v=cell[j]];ePos.push(p[0],p[1],p[2]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?eCol.push(c[0],c[1],c[2],1):eCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],eUVs.push(uv[0],uv[1]),eIds.push(i)}edgeCount+=1;break;case 3:for(j=0;j<3;++j)for(p=positions[v=cell[j]],k=0;k<3;++k)if(isNaN(p[k])||!isFinite(p[k]))continue fill_loop;for(j=0;j<3;++j){var v;p=positions[v=cell[j]];tPos.push(p[0],p[1],p[2],p[3]);var c,uv,q,w=vectors[v];tVec.push(w[0],w[1],w[2],w[3]),3===(c=vertexColors?vertexColors[v]:cellColors?cellColors[i]:meshColor).length?tCol.push(c[0],c[1],c[2],1):tCol.push(c[0],c[1],c[2],c[3]),uv=vertexUVs?vertexUVs[v]:vertexIntensity?[(vertexIntensity[v]-intensityLo)/(intensityHi-intensityLo),0]:cellUVs?cellUVs[i]:cellIntensity?[(cellIntensity[i]-intensityLo)/(intensityHi-intensityLo),0]:[(p[2]-intensityLo)/(intensityHi-intensityLo),0],tUVs.push(uv[0],uv[1]),q=vertexNormals?vertexNormals[v]:cellNormals[i],tNor.push(q[0],q[1],q[2]),tIds.push(i)}triangleCount+=1}}this.pointCount=pointCount,this.edgeCount=edgeCount,this.triangleCount=triangleCount,this.pointPositions.update(pPos),this.pointColors.update(pCol),this.pointUVs.update(pUVs),this.pointSizes.update(pSiz),this.pointIds.update(new Uint32Array(pIds)),this.edgePositions.update(ePos),this.edgeColors.update(eCol),this.edgeUVs.update(eUVs),this.edgeIds.update(new Uint32Array(eIds)),this.trianglePositions.update(tPos),this.triangleVectors.update(tVec),this.triangleColors.update(tCol),this.triangleUVs.update(tUVs),this.triangleNormals.update(tNor),this.triangleIds.update(new Uint32Array(tIds))}},proto.drawTransparent=proto.draw=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);var uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,kambient:this.ambientLight,kdiffuse:this.diffuseLight,kspecular:this.specularLight,roughness:this.roughness,fresnel:this.fresnel,eyePosition:[0,0,0],lightPosition:[0,0,0],opacity:this.opacity,tubeScale:this.tubeScale,contourColor:this.contourColor,texture:0};this.texture.bind(0);var invCameraMatrix=new Array(16);multiply(invCameraMatrix,uniforms.view,uniforms.model),multiply(invCameraMatrix,uniforms.projection,invCameraMatrix),invert(invCameraMatrix,invCameraMatrix);for(i=0;i<3;++i)uniforms.eyePosition[i]=invCameraMatrix[12+i]/invCameraMatrix[15];var shader,w=invCameraMatrix[15];for(i=0;i<3;++i)w+=this.lightPosition[i]*invCameraMatrix[4*i+3];for(i=0;i<3;++i){for(var s=invCameraMatrix[12+i],j=0;j<3;++j)s+=invCameraMatrix[4*j+i]*this.lightPosition[j];uniforms.lightPosition[i]=s/w}this.triangleCount>0&&((shader=this.triShader).bind(),shader.uniforms=uniforms,this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind());this.edgeCount>0&&this.lineWidth>0&&((shader=this.lineShader).bind(),shader.uniforms=uniforms,this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind());this.pointCount>0&&((shader=this.pointShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind());this.contourEnable&&this.contourCount>0&&this.contourLineWidth>0&&((shader=this.contourShader).bind(),shader.uniforms=uniforms,this.contourVAO.bind(),gl.drawArrays(gl.LINES,0,this.contourCount),this.contourVAO.unbind())},proto.drawPick=function(params){params=params||{};for(var gl=this.gl,model=params.model||identityMatrix,view=params.view||identityMatrix,projection=params.projection||identityMatrix,clipBounds=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],i=0;i<3;++i)clipBounds[0][i]=Math.max(clipBounds[0][i],this.clipBounds[0][i]),clipBounds[1][i]=Math.min(clipBounds[1][i],this.clipBounds[1][i]);this._model=[].slice.call(model),this._view=[].slice.call(view),this._projection=[].slice.call(projection),this._resolution=[gl.drawingBufferWidth,gl.drawingBufferHeight];var shader,uniforms={model:model,view:view,projection:projection,clipBounds:clipBounds,tubeScale:this.tubeScale,pickId:this.pickId/255};((shader=this.pickShader).bind(),shader.uniforms=uniforms,this.triangleCount>0&&(this.triangleVAO.bind(),gl.drawArrays(gl.TRIANGLES,0,3*this.triangleCount),this.triangleVAO.unbind()),this.edgeCount>0&&(this.edgeVAO.bind(),gl.lineWidth(this.lineWidth),gl.drawArrays(gl.LINES,0,2*this.edgeCount),this.edgeVAO.unbind()),this.pointCount>0)&&((shader=this.pointPickShader).bind(),shader.uniforms=uniforms,this.pointVAO.bind(),gl.drawArrays(gl.POINTS,0,this.pointCount),this.pointVAO.unbind())},proto.pick=function(pickData){if(!pickData)return null;if(pickData.id!==this.pickId)return null;var cellId=pickData.value[0]+256*pickData.value[1]+65536*pickData.value[2],cell=this.cells[cellId],pos=this.positions[cell[1]].slice(0,3);return{index:cellId,position:pos,intensity:this.intensity[cell[1]],velocity:this.vectors[cell[1]].slice(0,3),divergence:this.vectors[cell[1]][3],dataCoordinate:pos}},proto.dispose=function(){this.texture.dispose(),this.triShader.dispose(),this.pickShader.dispose(),this.triangleVAO.dispose(),this.trianglePositions.dispose(),this.triangleVectors.dispose(),this.triangleColors.dispose(),this.triangleUVs.dispose(),this.triangleNormals.dispose(),this.triangleIds.dispose(),this.edgeVAO.dispose(),this.edgePositions.dispose(),this.edgeColors.dispose(),this.edgeUVs.dispose(),this.edgeIds.dispose(),this.pointVAO.dispose(),this.pointPositions.dispose(),this.pointColors.dispose(),this.pointUVs.dispose(),this.pointSizes.dispose(),this.pointIds.dispose(),this.contourVAO.dispose(),this.contourPositions.dispose()},module.exports=function createSimplicialMesh(gl,params){1===arguments.length&&(gl=(params=gl).gl);var triShader=params.triShader||function createMeshShader(gl){var shader=createShader(gl,meshShader.vertex,meshShader.fragment,null,meshShader.attributes);return shader.attributes.position.location=0,shader.attributes.color.location=2,shader.attributes.uv.location=3,shader.attributes.vector.location=5,shader}(gl),pickShader=createPickShader(gl),meshTexture=createTexture(gl,ndarray(new Uint8Array([255,255,255,255]),[1,1,4]));meshTexture.generateMipmap(),meshTexture.minFilter=gl.LINEAR_MIPMAP_LINEAR,meshTexture.magFilter=gl.LINEAR;var trianglePositions=createBuffer(gl),triangleVectors=createBuffer(gl),triangleColors=createBuffer(gl),triangleUVs=createBuffer(gl),triangleNormals=createBuffer(gl),triangleIds=createBuffer(gl),triangleVAO=createVAO(gl,[{buffer:trianglePositions,type:gl.FLOAT,size:4},{buffer:triangleIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:triangleColors,type:gl.FLOAT,size:4},{buffer:triangleUVs,type:gl.FLOAT,size:2},{buffer:triangleNormals,type:gl.FLOAT,size:3},{buffer:triangleVectors,type:gl.FLOAT,size:4}]),edgePositions=createBuffer(gl),edgeColors=createBuffer(gl),edgeUVs=createBuffer(gl),edgeIds=createBuffer(gl),edgeVAO=createVAO(gl,[{buffer:edgePositions,type:gl.FLOAT,size:3},{buffer:edgeIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:edgeColors,type:gl.FLOAT,size:4},{buffer:edgeUVs,type:gl.FLOAT,size:2}]),pointPositions=createBuffer(gl),pointColors=createBuffer(gl),pointUVs=createBuffer(gl),pointSizes=createBuffer(gl),pointIds=createBuffer(gl),pointVAO=createVAO(gl,[{buffer:pointPositions,type:gl.FLOAT,size:3},{buffer:pointIds,type:gl.UNSIGNED_BYTE,size:4,normalized:!0},{buffer:pointColors,type:gl.FLOAT,size:4},{buffer:pointUVs,type:gl.FLOAT,size:2},{buffer:pointSizes,type:gl.FLOAT,size:1}]),contourPositions=createBuffer(gl),mesh=new SimplicialMesh(gl,meshTexture,triShader,null,null,pickShader,null,null,trianglePositions,triangleVectors,triangleIds,triangleColors,triangleUVs,triangleNormals,triangleVAO,edgePositions,edgeIds,edgeColors,edgeUVs,edgeVAO,pointPositions,pointIds,pointColors,pointUVs,pointSizes,pointVAO,contourPositions,createVAO(gl,[{buffer:contourPositions,type:gl.FLOAT,size:3}]));return mesh.update(params),mesh}},{"./closest-point":296,"./shaders":297,colormap:113,"gl-buffer":229,"gl-mat4/invert":253,"gl-mat4/multiply":255,"gl-shader":286,"gl-texture2d":303,"gl-vao":308,ndarray:430,normals:433,"simplicial-complex-contour":491,"typedarray-pool":519}],299:[function(_dereq_,module,exports){"use strict";var vec3=_dereq_("gl-vec3"),vec4=_dereq_("gl-vec4"),createTubes=function(streams,colormap,maxDivergence,minDistance){for(var maxNorm=0,i=0;i<streams.length;i++)for(var velocities=streams[i].velocities,j=0;j<velocities.length;j++){var norm=vec3.length(velocities[j]);norm>maxNorm&&(maxNorm=norm)}var tubes=streams.map(function(s){return function(stream,maxDivergence,minDistance,maxNorm){var p,fwd,r,points=stream.points,velocities=stream.velocities,divergences=stream.divergences;vec3.set(vec3.create(),0,1,0),vec3.create(),vec3.create();vec3.create();for(var verts=[],faces=[],vectors=[],previousVerts=[],currentVerts=[],intensities=[],previousIntensity=0,currentIntensity=0,currentVector=vec4.create(),previousVector=vec4.create(),i=0;i<points.length;i++){p=points[i],fwd=velocities[i],r=divergences[i],0===maxDivergence&&(r=.05*minDistance),currentIntensity=vec3.length(fwd)/maxNorm,currentVector=vec4.create(),vec3.copy(currentVector,fwd),currentVector[3]=r;for(var a=0;a<8;a++)currentVerts[a]=[p[0],p[1],p[2],a];if(previousVerts.length>0)for(a=0;a<8;a++){var a1=(a+1)%8;verts.push(previousVerts[a],currentVerts[a],currentVerts[a1],currentVerts[a1],previousVerts[a1],previousVerts[a]),vectors.push(previousVector,currentVector,currentVector,currentVector,previousVector,previousVector),intensities.push(previousIntensity,currentIntensity,currentIntensity,currentIntensity,previousIntensity,previousIntensity),faces.push([verts.length-6,verts.length-5,verts.length-4],[verts.length-3,verts.length-2,verts.length-1])}var tmp=previousVerts;previousVerts=currentVerts,currentVerts=tmp,tmp=previousVector,previousVector=currentVector,currentVector=tmp,tmp=previousIntensity,previousIntensity=currentIntensity,currentIntensity=tmp}return{positions:verts,cells:faces,vectors:vectors,vertexIntensity:intensities}}(s,maxDivergence,minDistance,maxNorm)}),positions=[],cells=[],vectors=[],vertexIntensity=[];for(i=0;i<tubes.length;i++){var tube=tubes[i],offset=positions.length;positions=positions.concat(tube.positions),vectors=vectors.concat(tube.vectors),vertexIntensity=vertexIntensity.concat(tube.vertexIntensity);for(j=0;j<tube.cells.length;j++){var cell=tube.cells[j],newCell=[];cells.push(newCell);for(var k=0;k<cell.length;k++)newCell.push(cell[k]+offset)}}return{positions:positions,cells:cells,vectors:vectors,vertexIntensity:vertexIntensity,colormap:colormap}},defaultGetDivergence=function(p,v0){var dp=vec3.create(),e=1e-4;vec3.add(dp,p,[e,0,0]);var vx=this.getVelocity(dp);vec3.subtract(vx,vx,v0),vec3.scale(vx,vx,1e4),vec3.add(dp,p,[0,e,0]);var vy=this.getVelocity(dp);vec3.subtract(vy,vy,v0),vec3.scale(vy,vy,1e4),vec3.add(dp,p,[0,0,e]);var vz=this.getVelocity(dp);return vec3.subtract(vz,vz,v0),vec3.scale(vz,vz,1e4),vec3.add(dp,vx,vy),vec3.add(dp,dp,vz),dp},defaultGetVelocity=function(p){return sampleMeshgrid(p,this.vectors,this.meshgrid,this.clampBorders)},findLastSmallerIndex=function(points,v){for(var i=0;i<points.length;i++){var p=points[i];if(p===v)return i;if(p>v)return i-1}return i},tmp=vec3.create(),tmp2=vec3.create(),clamp=function(v,min,max){return v<min?min:v>max?max:v},sampleMeshgrid=function(point,array,meshgrid,clampOverflow){var x=point[0],y=point[1],z=point[2],w=meshgrid[0].length,h=meshgrid[1].length,d=meshgrid[2].length,x0=findLastSmallerIndex(meshgrid[0],x),y0=findLastSmallerIndex(meshgrid[1],y),z0=findLastSmallerIndex(meshgrid[2],z),x1=x0+1,y1=y0+1,z1=z0+1;if(meshgrid[0][x0]===x&&(x1=x0),meshgrid[1][y0]===y&&(y1=y0),meshgrid[2][z0]===z&&(z1=z0),clampOverflow&&(x0=clamp(x0,0,w-1),x1=clamp(x1,0,w-1),y0=clamp(y0,0,h-1),y1=clamp(y1,0,h-1),z0=clamp(z0,0,d-1),z1=clamp(z1,0,d-1)),x0<0||y0<0||z0<0||x1>=w||y1>=h||z1>=d)return vec3.create();var xf=(x-meshgrid[0][x0])/(meshgrid[0][x1]-meshgrid[0][x0]),yf=(y-meshgrid[1][y0])/(meshgrid[1][y1]-meshgrid[1][y0]),zf=(z-meshgrid[2][z0])/(meshgrid[2][z1]-meshgrid[2][z0]);(xf<0||xf>1||isNaN(xf))&&(xf=0),(yf<0||yf>1||isNaN(yf))&&(yf=0),(zf<0||zf>1||isNaN(zf))&&(zf=0);var z0off=z0*w*h,z1off=z1*w*h,y0off=y0*w,y1off=y1*w,x0off=x0,x1off=x1,v000=array[y0off+z0off+x0off],v001=array[y0off+z0off+x1off],v010=array[y1off+z0off+x0off],v011=array[y1off+z0off+x1off],v100=array[y0off+z1off+x0off],v101=array[y0off+z1off+x1off],v110=array[y1off+z1off+x0off],v111=array[y1off+z1off+x1off],result=vec3.create();return vec3.lerp(result,v000,v001,xf),vec3.lerp(tmp,v010,v011,xf),vec3.lerp(result,result,tmp,yf),vec3.lerp(tmp,v100,v101,xf),vec3.lerp(tmp2,v110,v111,xf),vec3.lerp(tmp,tmp,tmp2,yf),vec3.lerp(result,result,tmp,zf),result},findMinSeparation=function(xs){var minSeparation=1/0;xs.sort(function(a,b){return a-b});for(var i=1;i<xs.length;i++){var d=Math.abs(xs[i]-xs[i-1]);d<minSeparation&&(minSeparation=d)}return minSeparation};module.exports=function(vectorField,bounds){var positions=vectorField.startingPositions,maxLength=vectorField.maxLength||1e3,tubeSize=vectorField.tubeSize||1,absoluteTubeSize=vectorField.absoluteTubeSize;vectorField.getDivergence||(vectorField.getDivergence=defaultGetDivergence),vectorField.getVelocity||(vectorField.getVelocity=defaultGetVelocity),void 0===vectorField.clampBorders&&(vectorField.clampBorders=!0);var streams=[],minX=bounds[0][0],minY=bounds[0][1],minZ=bounds[0][2],maxX=bounds[1][0],maxY=bounds[1][1],maxZ=bounds[1][2],inBounds=function(bounds,p){var x=p[0],y=p[1],z=p[2];return x>=minX&&x<=maxX&&y>=minY&&y<=maxY&&z>=minZ&&z<=maxZ},maxStepSize=10*vec3.distance(bounds[0],bounds[1])/maxLength,maxStepSizeSq=maxStepSize*maxStepSize,minDistance=1,maxDivergence=0;vec3.create();positions.length>=2&&(minDistance=function(positions){for(var xs=[],ys=[],zs=[],xi={},yi={},zi={},i=0;i<positions.length;i++){var p=positions[i],x=p[0],y=p[1],z=p[2];xi[x]||(xs.push(x),xi[x]=!0),yi[y]||(ys.push(y),yi[y]=!0),zi[z]||(zs.push(z),zi[z]=!0)}var xSep=findMinSeparation(xs),ySep=findMinSeparation(ys),zSep=findMinSeparation(zs),minSeparation=Math.min(xSep,ySep,zSep);return isFinite(minSeparation)?minSeparation:1}(positions));for(var i=0;i<positions.length;i++){var p=vec3.create();vec3.copy(p,positions[i]);var stream=[p],velocities=[],v=vectorField.getVelocity(p),op=p;velocities.push(v);var divergences=[],dv=vectorField.getDivergence(p,v);(dvLength=vec3.length(dv))>maxDivergence&&!isNaN(dvLength)&&isFinite(dvLength)&&(maxDivergence=dvLength),divergences.push(dvLength),streams.push({points:stream,velocities:velocities,divergences:divergences});for(var j=0;j<100*maxLength&&stream.length<maxLength&&inBounds(0,p);){j++;var np=vec3.clone(v),sqLen=vec3.squaredLength(np);if(0===sqLen)break;if(sqLen>maxStepSizeSq&&vec3.scale(np,np,maxStepSize/Math.sqrt(sqLen)),vec3.add(np,np,p),v=vectorField.getVelocity(np),vec3.squaredDistance(op,np)-maxStepSizeSq>-1e-4*maxStepSizeSq){stream.push(np),op=np,velocities.push(v);dv=vectorField.getDivergence(np,v);(dvLength=vec3.length(dv))>maxDivergence&&!isNaN(dvLength)&&isFinite(dvLength)&&(maxDivergence=dvLength),divergences.push(dvLength)}p=np}}for(i=0;i<divergences.length;i++){var dvLength=divergences[i];!isNaN(dvLength)&&isFinite(dvLength)||(divergences[i]=maxDivergence)}var tubes=createTubes(streams,vectorField.colormap,maxDivergence,minDistance);return absoluteTubeSize?tubes.tubeScale=absoluteTubeSize:(0===maxDivergence&&(maxDivergence=1),tubes.tubeScale=.5*tubeSize*minDistance/maxDivergence),tubes},module.exports.createTubeMesh=_dereq_("./lib/tubemesh")},{"./lib/tubemesh":298,"gl-vec3":327,"gl-vec4":363}],300:[function(_dereq_,module,exports){var createShader=_dereq_("gl-shader"),glslify=_dereq_("glslify"),vertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec4 uv;\nattribute vec3 f;\nattribute vec3 normal;\n\nuniform mat4 model, view, projection, inverseModel;\nuniform vec3 lightPosition, eyePosition;\nuniform sampler2D colormap;\n\nvarying float value, kill;\nvarying vec3 worldCoordinate;\nvarying vec2 planeCoordinate;\nvarying vec3 lightDirection, eyeDirection, surfaceNormal;\nvarying vec4 vColor;\n\nvoid main() {\n  worldCoordinate = vec3(uv.zw, f.x);\n  vec4 worldPosition = model * vec4(worldCoordinate, 1.0);\n  vec4 clipPosition = projection * view * worldPosition;\n  gl_Position = clipPosition;\n  kill = f.y;\n  value = f.z;\n  planeCoordinate = uv.xy;\n\n  vColor = texture2D(colormap, vec2(value, value));\n\n  //Lighting geometry parameters\n  vec4 cameraCoordinate = view * worldPosition;\n  cameraCoordinate.xyz /= cameraCoordinate.w;\n  lightDirection = lightPosition - cameraCoordinate.xyz;\n  eyeDirection   = eyePosition - cameraCoordinate.xyz;\n  surfaceNormal  = normalize((vec4(normal,0) * inverseModel).xyz);\n}\n"]),fragSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nfloat beckmannDistribution(float x, float roughness) {\n  float NdotH = max(x, 0.0001);\n  float cos2Alpha = NdotH * NdotH;\n  float tan2Alpha = (cos2Alpha - 1.0) / cos2Alpha;\n  float roughness2 = roughness * roughness;\n  float denom = 3.141592653589793 * roughness2 * cos2Alpha * cos2Alpha;\n  return exp(tan2Alpha / roughness2) / denom;\n}\n\nfloat beckmannSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float roughness) {\n  return beckmannDistribution(dot(surfaceNormal, normalize(lightDirection + viewDirection)), roughness);\n}\n\nuniform vec3 lowerBound, upperBound;\nuniform float contourTint;\nuniform vec4 contourColor;\nuniform sampler2D colormap;\nuniform vec3 clipBounds[2];\nuniform float roughness, fresnel, kambient, kdiffuse, kspecular, opacity;\nuniform float vertexColor;\n\nvarying float value, kill;\nvarying vec3 worldCoordinate;\nvarying vec3 lightDirection, eyeDirection, surfaceNormal;\nvarying vec4 vColor;\n\nvoid main() {\n  if (kill > 0.0 ||\n    any(lessThan(worldCoordinate, clipBounds[0])) || any(greaterThan(worldCoordinate, clipBounds[1]))) {\n    discard;\n  }\n\n  vec3 N = normalize(surfaceNormal);\n  vec3 V = normalize(eyeDirection);\n  vec3 L = normalize(lightDirection);\n\n  if(gl_FrontFacing) {\n    N = -N;\n  }\n\n  float specular = max(beckmannSpecular(L, V, N, roughness), 0.);\n  float diffuse  = min(kambient + kdiffuse * max(dot(N, L), 0.0), 1.0);\n\n  //decide how to interpolate color  in vertex or in fragment\n  vec4 surfaceColor = step(vertexColor, .5) * texture2D(colormap, vec2(value, value)) + step(.5, vertexColor) * vColor;\n\n  vec4 litColor = surfaceColor.a * vec4(diffuse * surfaceColor.rgb + kspecular * vec3(1,1,1) * specular,  1.0);\n\n  gl_FragColor = mix(litColor, contourColor, contourTint) * opacity;\n}\n"]),contourVertSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec4 uv;\nattribute float f;\n\nuniform mat3 permutation;\nuniform mat4 model, view, projection;\nuniform float height, zOffset;\nuniform sampler2D colormap;\n\nvarying float value, kill;\nvarying vec3 worldCoordinate;\nvarying vec2 planeCoordinate;\nvarying vec3 lightDirection, eyeDirection, surfaceNormal;\nvarying vec4 vColor;\n\nvoid main() {\n  vec3 dataCoordinate = permutation * vec3(uv.xy, height);\n  vec4 worldPosition = model * vec4(dataCoordinate, 1.0);\n\n  vec4 clipPosition = projection * view * worldPosition;\n  clipPosition.z = clipPosition.z + zOffset;\n\n  gl_Position = clipPosition;\n  value = f;\n  kill = -1.0;\n  worldCoordinate = dataCoordinate;\n  planeCoordinate = uv.zw;\n\n  vColor = texture2D(colormap, vec2(value, value));\n\n  //Don't do lighting for contours\n  surfaceNormal   = vec3(1,0,0);\n  eyeDirection    = vec3(0,1,0);\n  lightDirection  = vec3(0,0,1);\n}\n"]),pickSrc=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 shape;\nuniform vec3 clipBounds[2];\nuniform float pickId;\n\nvarying float value, kill;\nvarying vec3 worldCoordinate;\nvarying vec2 planeCoordinate;\nvarying vec3 surfaceNormal;\n\nvec2 splitFloat(float v) {\n  float vh = 255.0 * v;\n  float upper = floor(vh);\n  float lower = fract(vh);\n  return vec2(upper / 255.0, floor(lower * 16.0) / 16.0);\n}\n\nvoid main() {\n  if(kill > 0.0 ||\n    any(lessThan(worldCoordinate, clipBounds[0])) || any(greaterThan(worldCoordinate, clipBounds[1]))) {\n    discard;\n  }\n  vec2 ux = splitFloat(planeCoordinate.x / shape.x);\n  vec2 uy = splitFloat(planeCoordinate.y / shape.y);\n  gl_FragColor = vec4(pickId, ux.x, uy.x, ux.y + (uy.y/16.0));\n}\n"]);exports.createShader=function(gl){var shader=createShader(gl,vertSrc,fragSrc,null,[{name:"uv",type:"vec4"},{name:"f",type:"vec3"},{name:"normal",type:"vec3"}]);return shader.attributes.uv.location=0,shader.attributes.f.location=1,shader.attributes.normal.location=2,shader},exports.createPickShader=function(gl){var shader=createShader(gl,vertSrc,pickSrc,null,[{name:"uv",type:"vec4"},{name:"f",type:"vec3"},{name:"normal",type:"vec3"}]);return shader.attributes.uv.location=0,shader.attributes.f.location=1,shader.attributes.normal.location=2,shader},exports.createContourShader=function(gl){var shader=createShader(gl,contourVertSrc,fragSrc,null,[{name:"uv",type:"vec4"},{name:"f",type:"float"}]);return shader.attributes.uv.location=0,shader.attributes.f.location=1,shader},exports.createPickContourShader=function(gl){var shader=createShader(gl,contourVertSrc,pickSrc,null,[{name:"uv",type:"vec4"},{name:"f",type:"float"}]);return shader.attributes.uv.location=0,shader.attributes.f.location=1,shader}},{"gl-shader":286,glslify:390}],301:[function(_dereq_,module,exports){"use strict";module.exports=function createSurfacePlot(params){var gl=params.gl,shader=createShader(gl),pickShader=createPickShader(gl),contourShader=createContourShader(gl),contourPickShader=createPickContourShader(gl),coordinateBuffer=createBuffer(gl),vao=createVAO(gl,[{buffer:coordinateBuffer,size:4,stride:SURFACE_VERTEX_SIZE,offset:0},{buffer:coordinateBuffer,size:3,stride:SURFACE_VERTEX_SIZE,offset:16},{buffer:coordinateBuffer,size:3,stride:SURFACE_VERTEX_SIZE,offset:28}]),contourBuffer=createBuffer(gl),contourVAO=createVAO(gl,[{buffer:contourBuffer,size:4,stride:20,offset:0},{buffer:contourBuffer,size:1,stride:20,offset:16}]),dynamicBuffer=createBuffer(gl),dynamicVAO=createVAO(gl,[{buffer:dynamicBuffer,size:2,type:gl.FLOAT}]),cmap=createTexture(gl,1,N_COLORS,gl.RGBA,gl.UNSIGNED_BYTE);cmap.minFilter=gl.LINEAR,cmap.magFilter=gl.LINEAR;var surface=new SurfacePlot(gl,[0,0],[[0,0,0],[0,0,0]],shader,pickShader,coordinateBuffer,vao,cmap,contourShader,contourPickShader,contourBuffer,contourVAO,dynamicBuffer,dynamicVAO),nparams={levels:[[],[],[]]};for(var id in params)nparams[id]=params[id];return nparams.colormap=nparams.colormap||"jet",surface.update(nparams),surface};var bits=_dereq_("bit-twiddle"),createBuffer=_dereq_("gl-buffer"),createVAO=_dereq_("gl-vao"),createTexture=_dereq_("gl-texture2d"),pool=_dereq_("typedarray-pool"),colormap=_dereq_("colormap"),ops=_dereq_("ndarray-ops"),pack=_dereq_("ndarray-pack"),ndarray=_dereq_("ndarray"),surfaceNets=_dereq_("surface-nets"),multiply=_dereq_("gl-mat4/multiply"),invert=_dereq_("gl-mat4/invert"),bsearch=_dereq_("binary-search-bounds"),gradient=_dereq_("ndarray-gradient"),shaders=_dereq_("./lib/shaders"),createShader=shaders.createShader,createContourShader=shaders.createContourShader,createPickShader=shaders.createPickShader,createPickContourShader=shaders.createPickContourShader,SURFACE_VERTEX_SIZE=40,IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],QUAD=[[0,0],[0,1],[1,0],[1,1],[1,0],[0,1]],PERMUTATIONS=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]];!function(){for(var i=0;i<3;++i){var p=PERMUTATIONS[i],v=(i+2)%3;p[(i+1)%3+0]=1,p[v+3]=1,p[i+6]=1}}();var N_COLORS=256;function SurfacePlot(gl,shape,bounds,shader,pickShader,coordinates,vao,colorMap,contourShader,contourPickShader,contourBuffer,contourVAO,dynamicBuffer,dynamicVAO){this.gl=gl,this.shape=shape,this.bounds=bounds,this.intensityBounds=[],this._shader=shader,this._pickShader=pickShader,this._coordinateBuffer=coordinates,this._vao=vao,this._colorMap=colorMap,this._contourShader=contourShader,this._contourPickShader=contourPickShader,this._contourBuffer=contourBuffer,this._contourVAO=contourVAO,this._contourOffsets=[[],[],[]],this._contourCounts=[[],[],[]],this._vertexCount=0,this._pickResult=new function SurfacePickResult(position,index,uv,level,dataCoordinate){this.position=position,this.index=index,this.uv=uv,this.level=level,this.dataCoordinate=dataCoordinate}([0,0,0],[0,0],[0,0],[0,0,0],[0,0,0]),this._dynamicBuffer=dynamicBuffer,this._dynamicVAO=dynamicVAO,this._dynamicOffsets=[0,0,0],this._dynamicCounts=[0,0,0],this.contourWidth=[1,1,1],this.contourLevels=[[1],[1],[1]],this.contourTint=[0,0,0],this.contourColor=[[.5,.5,.5,1],[.5,.5,.5,1],[.5,.5,.5,1]],this.showContour=!0,this.showSurface=!0,this.enableHighlight=[!0,!0,!0],this.highlightColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.highlightTint=[1,1,1],this.highlightLevel=[-1,-1,-1],this.enableDynamic=[!0,!0,!0],this.dynamicLevel=[NaN,NaN,NaN],this.dynamicColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.dynamicTint=[1,1,1],this.dynamicWidth=[1,1,1],this.axesBounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],this.surfaceProject=[!1,!1,!1],this.contourProject=[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1]],this.colorBounds=[!1,!1],this._field=[ndarray(pool.mallocFloat(1024),[0,0]),ndarray(pool.mallocFloat(1024),[0,0]),ndarray(pool.mallocFloat(1024),[0,0])],this.pickId=1,this.clipBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.snapToData=!1,this.opacity=1,this.lightPosition=[10,1e4,0],this.ambientLight=.8,this.diffuseLight=.8,this.specularLight=2,this.roughness=.5,this.fresnel=1.5,this.vertexColor=0,this.dirty=!0}var proto=SurfacePlot.prototype;proto.isTransparent=function(){return this.opacity<1},proto.isOpaque=function(){if(this.opacity>=1)return!0;for(var i=0;i<3;++i)if(this._contourCounts[i].length>0||this._dynamicCounts[i]>0)return!0;return!1},proto.pickSlots=1,proto.setPickBase=function(id){this.pickId=id};var ZERO_VEC=[0,0,0],PROJECT_DATA={showSurface:!1,showContour:!1,projections:[IDENTITY.slice(),IDENTITY.slice(),IDENTITY.slice()],clipBounds:[[[0,0,0],[0,0,0]],[[0,0,0],[0,0,0]],[[0,0,0],[0,0,0]]]};function computeProjectionData(camera,obj){var i,j,k,cubeAxis=obj.axes&&obj.axes.lastCubeProps.axis||ZERO_VEC,showSurface=obj.showSurface,showContour=obj.showContour;for(i=0;i<3;++i)for(showSurface=showSurface||obj.surfaceProject[i],j=0;j<3;++j)showContour=showContour||obj.contourProject[i][j];for(i=0;i<3;++i){var axisSquish=PROJECT_DATA.projections[i];for(j=0;j<16;++j)axisSquish[j]=0;for(j=0;j<4;++j)axisSquish[5*j]=1;axisSquish[5*i]=0,axisSquish[12+i]=obj.axesBounds[+(cubeAxis[i]>0)][i],multiply(axisSquish,camera.model,axisSquish);var nclipBounds=PROJECT_DATA.clipBounds[i];for(k=0;k<2;++k)for(j=0;j<3;++j)nclipBounds[k][j]=camera.clipBounds[k][j];nclipBounds[0][i]=-1e8,nclipBounds[1][i]=1e8}return PROJECT_DATA.showSurface=showSurface,PROJECT_DATA.showContour=showContour,PROJECT_DATA}var UNIFORMS={model:IDENTITY,view:IDENTITY,projection:IDENTITY,inverseModel:IDENTITY.slice(),lowerBound:[0,0,0],upperBound:[0,0,0],colorMap:0,clipBounds:[[0,0,0],[0,0,0]],height:0,contourTint:0,contourColor:[0,0,0,1],permutation:[1,0,0,0,1,0,0,0,1],zOffset:-1e-4,kambient:1,kdiffuse:1,kspecular:1,lightPosition:[1e3,1e3,1e3],eyePosition:[0,0,0],roughness:1,fresnel:1,opacity:1,vertexColor:0},MATRIX_INVERSE=IDENTITY.slice(),DEFAULT_PERM=[1,0,0,0,1,0,0,0,1];function drawCore(params,transparent){params=params||{};var gl=this.gl;gl.disable(gl.CULL_FACE),this._colorMap.bind(0);var uniforms=UNIFORMS;uniforms.model=params.model||IDENTITY,uniforms.view=params.view||IDENTITY,uniforms.projection=params.projection||IDENTITY,uniforms.lowerBound=[this.bounds[0][0],this.bounds[0][1],this.colorBounds[0]||this.bounds[0][2]],uniforms.upperBound=[this.bounds[1][0],this.bounds[1][1],this.colorBounds[1]||this.bounds[1][2]],uniforms.contourColor=this.contourColor[0],uniforms.inverseModel=invert(uniforms.inverseModel,uniforms.model);for(var i=0;i<2;++i)for(var clipClamped=uniforms.clipBounds[i],j=0;j<3;++j)clipClamped[j]=Math.min(Math.max(this.clipBounds[i][j],-1e8),1e8);uniforms.kambient=this.ambientLight,uniforms.kdiffuse=this.diffuseLight,uniforms.kspecular=this.specularLight,uniforms.roughness=this.roughness,uniforms.fresnel=this.fresnel,uniforms.opacity=this.opacity,uniforms.height=0,uniforms.permutation=DEFAULT_PERM,uniforms.vertexColor=this.vertexColor;var invCameraMatrix=MATRIX_INVERSE;for(multiply(invCameraMatrix,uniforms.view,uniforms.model),multiply(invCameraMatrix,uniforms.projection,invCameraMatrix),invert(invCameraMatrix,invCameraMatrix),i=0;i<3;++i)uniforms.eyePosition[i]=invCameraMatrix[12+i]/invCameraMatrix[15];var w=invCameraMatrix[15];for(i=0;i<3;++i)w+=this.lightPosition[i]*invCameraMatrix[4*i+3];for(i=0;i<3;++i){var s=invCameraMatrix[12+i];for(j=0;j<3;++j)s+=invCameraMatrix[4*j+i]*this.lightPosition[j];uniforms.lightPosition[i]=s/w}var projectData=computeProjectionData(uniforms,this);if(projectData.showSurface&&transparent===this.opacity<1){for(this._shader.bind(),this._shader.uniforms=uniforms,this._vao.bind(),this.showSurface&&this._vertexCount&&this._vao.draw(gl.TRIANGLES,this._vertexCount),i=0;i<3;++i)this.surfaceProject[i]&&this.vertexCount&&(this._shader.uniforms.model=projectData.projections[i],this._shader.uniforms.clipBounds=projectData.clipBounds[i],this._vao.draw(gl.TRIANGLES,this._vertexCount));this._vao.unbind()}if(projectData.showContour&&!transparent){var shader=this._contourShader;uniforms.kambient=1,uniforms.kdiffuse=0,uniforms.kspecular=0,uniforms.opacity=1,shader.bind(),shader.uniforms=uniforms;var vao=this._contourVAO;for(vao.bind(),i=0;i<3;++i)for(shader.uniforms.permutation=PERMUTATIONS[i],gl.lineWidth(this.contourWidth[i]),j=0;j<this.contourLevels[i].length;++j)j===this.highlightLevel[i]?(shader.uniforms.contourColor=this.highlightColor[i],shader.uniforms.contourTint=this.highlightTint[i]):0!==j&&j-1!==this.highlightLevel[i]||(shader.uniforms.contourColor=this.contourColor[i],shader.uniforms.contourTint=this.contourTint[i]),this._contourCounts[i][j]&&(shader.uniforms.height=this.contourLevels[i][j],vao.draw(gl.LINES,this._contourCounts[i][j],this._contourOffsets[i][j]));for(i=0;i<3;++i)for(shader.uniforms.model=projectData.projections[i],shader.uniforms.clipBounds=projectData.clipBounds[i],j=0;j<3;++j)if(this.contourProject[i][j]){shader.uniforms.permutation=PERMUTATIONS[j],gl.lineWidth(this.contourWidth[j]);for(var k=0;k<this.contourLevels[j].length;++k)k===this.highlightLevel[j]?(shader.uniforms.contourColor=this.highlightColor[j],shader.uniforms.contourTint=this.highlightTint[j]):0!==k&&k-1!==this.highlightLevel[j]||(shader.uniforms.contourColor=this.contourColor[j],shader.uniforms.contourTint=this.contourTint[j]),shader.uniforms.height=this.contourLevels[j][k],vao.draw(gl.LINES,this._contourCounts[j][k],this._contourOffsets[j][k])}for(vao.unbind(),(vao=this._dynamicVAO).bind(),i=0;i<3;++i)if(0!==this._dynamicCounts[i])for(shader.uniforms.model=uniforms.model,shader.uniforms.clipBounds=uniforms.clipBounds,shader.uniforms.permutation=PERMUTATIONS[i],gl.lineWidth(this.dynamicWidth[i]),shader.uniforms.contourColor=this.dynamicColor[i],shader.uniforms.contourTint=this.dynamicTint[i],shader.uniforms.height=this.dynamicLevel[i],vao.draw(gl.LINES,this._dynamicCounts[i],this._dynamicOffsets[i]),j=0;j<3;++j)this.contourProject[j][i]&&(shader.uniforms.model=projectData.projections[j],shader.uniforms.clipBounds=projectData.clipBounds[j],vao.draw(gl.LINES,this._dynamicCounts[i],this._dynamicOffsets[i]));vao.unbind()}}proto.draw=function(params){return drawCore.call(this,params,!1)},proto.drawTransparent=function(params){return drawCore.call(this,params,!0)};var PICK_UNIFORMS={model:IDENTITY,view:IDENTITY,projection:IDENTITY,inverseModel:IDENTITY,clipBounds:[[0,0,0],[0,0,0]],height:0,shape:[0,0],pickId:0,lowerBound:[0,0,0],upperBound:[0,0,0],zOffset:0,permutation:[1,0,0,0,1,0,0,0,1],lightPosition:[0,0,0],eyePosition:[0,0,0]};function padField(nfield,field){var shape=field.shape.slice(),nshape=nfield.shape.slice();ops.assign(nfield.lo(1,1).hi(shape[0],shape[1]),field),ops.assign(nfield.lo(1).hi(shape[0],1),field.hi(shape[0],1)),ops.assign(nfield.lo(1,nshape[1]-1).hi(shape[0],1),field.lo(0,shape[1]-1).hi(shape[0],1)),ops.assign(nfield.lo(0,1).hi(1,shape[1]),field.hi(1)),ops.assign(nfield.lo(nshape[0]-1,1).hi(1,shape[1]),field.lo(shape[0]-1)),nfield.set(0,0,field.get(0,0)),nfield.set(0,nshape[1]-1,field.get(0,shape[1]-1)),nfield.set(nshape[0]-1,0,field.get(shape[0]-1,0)),nfield.set(nshape[0]-1,nshape[1]-1,field.get(shape[0]-1,shape[1]-1))}function handleArray(param,ctor){return Array.isArray(param)?[ctor(param[0]),ctor(param[1]),ctor(param[2])]:[ctor(param),ctor(param),ctor(param)]}function toColor(x){return Array.isArray(x)?3===x.length?[x[0],x[1],x[2],1]:[x[0],x[1],x[2],x[3]]:[0,0,0,1]}function handleColor(param){if(Array.isArray(param)){if(Array.isArray(param))return[toColor(param[0]),toColor(param[1]),toColor(param[2])];var c=toColor(param);return[c.slice(),c.slice(),c.slice()]}}proto.drawPick=function(params){params=params||{};var gl=this.gl;gl.disable(gl.CULL_FACE);var uniforms=PICK_UNIFORMS;uniforms.model=params.model||IDENTITY,uniforms.view=params.view||IDENTITY,uniforms.projection=params.projection||IDENTITY,uniforms.shape=this._field[2].shape,uniforms.pickId=this.pickId/255,uniforms.lowerBound=this.bounds[0],uniforms.upperBound=this.bounds[1],uniforms.permutation=DEFAULT_PERM;for(var i=0;i<2;++i)for(var clipClamped=uniforms.clipBounds[i],j=0;j<3;++j)clipClamped[j]=Math.min(Math.max(this.clipBounds[i][j],-1e8),1e8);var projectData=computeProjectionData(uniforms,this);if(projectData.showSurface){for(this._pickShader.bind(),this._pickShader.uniforms=uniforms,this._vao.bind(),this._vao.draw(gl.TRIANGLES,this._vertexCount),i=0;i<3;++i)this.surfaceProject[i]&&(this._pickShader.uniforms.model=projectData.projections[i],this._pickShader.uniforms.clipBounds=projectData.clipBounds[i],this._vao.draw(gl.TRIANGLES,this._vertexCount));this._vao.unbind()}if(projectData.showContour){var shader=this._contourPickShader;shader.bind(),shader.uniforms=uniforms;var vao=this._contourVAO;for(vao.bind(),j=0;j<3;++j)for(gl.lineWidth(this.contourWidth[j]),shader.uniforms.permutation=PERMUTATIONS[j],i=0;i<this.contourLevels[j].length;++i)this._contourCounts[j][i]&&(shader.uniforms.height=this.contourLevels[j][i],vao.draw(gl.LINES,this._contourCounts[j][i],this._contourOffsets[j][i]));for(i=0;i<3;++i)for(shader.uniforms.model=projectData.projections[i],shader.uniforms.clipBounds=projectData.clipBounds[i],j=0;j<3;++j)if(this.contourProject[i][j]){shader.uniforms.permutation=PERMUTATIONS[j],gl.lineWidth(this.contourWidth[j]);for(var k=0;k<this.contourLevels[j].length;++k)this._contourCounts[j][k]&&(shader.uniforms.height=this.contourLevels[j][k],vao.draw(gl.LINES,this._contourCounts[j][k],this._contourOffsets[j][k]))}vao.unbind()}},proto.pick=function(selection){if(!selection)return null;if(selection.id!==this.pickId)return null;var shape=this._field[2].shape,result=this._pickResult,x=shape[0]*(selection.value[0]+(selection.value[2]>>4)/16)/255,ix=Math.floor(x),fx=x-ix,y=shape[1]*(selection.value[1]+(15&selection.value[2])/16)/255,iy=Math.floor(y),fy=y-iy;ix+=1,iy+=1;var pos=result.position;pos[0]=pos[1]=pos[2]=0;for(var dx=0;dx<2;++dx)for(var s=dx?fx:1-fx,dy=0;dy<2;++dy)for(var r=ix+dx,c=iy+dy,w=s*(dy?fy:1-fy),i=0;i<3;++i)pos[i]+=this._field[i].get(r,c)*w;for(var levelIndex=this._pickResult.level,j=0;j<3;++j)if(levelIndex[j]=bsearch.le(this.contourLevels[j],pos[j]),levelIndex[j]<0)this.contourLevels[j].length>0&&(levelIndex[j]=0);else if(levelIndex[j]<this.contourLevels[j].length-1){var a=this.contourLevels[j][levelIndex[j]],b=this.contourLevels[j][levelIndex[j]+1];Math.abs(a-pos[j])>Math.abs(b-pos[j])&&(levelIndex[j]+=1)}for(result.index[0]=fx<.5?ix:ix+1,result.index[1]=fy<.5?iy:iy+1,result.uv[0]=x/shape[0],result.uv[1]=y/shape[1],i=0;i<3;++i)result.dataCoordinate[i]=this._field[i].get(result.index[0],result.index[1]);return result},proto.update=function(params){params=params||{},this.dirty=!0,"contourWidth"in params&&(this.contourWidth=handleArray(params.contourWidth,Number)),"showContour"in params&&(this.showContour=handleArray(params.showContour,Boolean)),"showSurface"in params&&(this.showSurface=!!params.showSurface),"contourTint"in params&&(this.contourTint=handleArray(params.contourTint,Boolean)),"contourColor"in params&&(this.contourColor=handleColor(params.contourColor)),"contourProject"in params&&(this.contourProject=handleArray(params.contourProject,function(x){return handleArray(x,Boolean)})),"surfaceProject"in params&&(this.surfaceProject=params.surfaceProject),"dynamicColor"in params&&(this.dynamicColor=handleColor(params.dynamicColor)),"dynamicTint"in params&&(this.dynamicTint=handleArray(params.dynamicTint,Number)),"dynamicWidth"in params&&(this.dynamicWidth=handleArray(params.dynamicWidth,Number)),"opacity"in params&&(this.opacity=params.opacity),"colorBounds"in params&&(this.colorBounds=params.colorBounds),"vertexColor"in params&&(this.vertexColor=params.vertexColor?1:0);var field=params.field||params.coords&&params.coords[2]||null,levelsChanged=!1;if(field||(field=this._field[2].shape[0]||this._field[2].shape[2]?this._field[2].lo(1,1).hi(this._field[2].shape[0]-2,this._field[2].shape[1]-2):this._field[2].hi(0,0)),"field"in params||"coords"in params){var fsize=(field.shape[0]+2)*(field.shape[1]+2);fsize>this._field[2].data.length&&(pool.freeFloat(this._field[2].data),this._field[2].data=pool.mallocFloat(bits.nextPow2(fsize))),this._field[2]=ndarray(this._field[2].data,[field.shape[0]+2,field.shape[1]+2]),padField(this._field[2],field),this.shape=field.shape.slice();for(var shape=this.shape,i=0;i<2;++i)this._field[2].size>this._field[i].data.length&&(pool.freeFloat(this._field[i].data),this._field[i].data=pool.mallocFloat(this._field[2].size)),this._field[i]=ndarray(this._field[i].data,[shape[0]+2,shape[1]+2]);if(params.coords){var coords=params.coords;if(!Array.isArray(coords)||3!==coords.length)throw new Error("gl-surface: invalid coordinates for x/y");for(i=0;i<2;++i){var coord=coords[i];for(j=0;j<2;++j)if(coord.shape[j]!==shape[j])throw new Error("gl-surface: coords have incorrect shape");padField(this._field[i],coord)}}else if(params.ticks){var ticks=params.ticks;if(!Array.isArray(ticks)||2!==ticks.length)throw new Error("gl-surface: invalid ticks");for(i=0;i<2;++i){var tick=ticks[i];if((Array.isArray(tick)||tick.length)&&(tick=ndarray(tick)),tick.shape[0]!==shape[i])throw new Error("gl-surface: invalid tick length");var tick2=ndarray(tick.data,shape);tick2.stride[i]=tick.stride[0],tick2.stride[1^i]=0,padField(this._field[i],tick2)}}else{for(i=0;i<2;++i){var offset=[0,0];offset[i]=1,this._field[i]=ndarray(this._field[i].data,[shape[0]+2,shape[1]+2],offset,0)}this._field[0].set(0,0,0);for(var j=0;j<shape[0];++j)this._field[0].set(j+1,0,j);for(this._field[0].set(shape[0]+1,0,shape[0]-1),this._field[1].set(0,0,0),j=0;j<shape[1];++j)this._field[1].set(0,j+1,j);this._field[1].set(0,shape[1]+1,shape[1]-1)}var fields=this._field,dfields=ndarray(pool.mallocFloat(3*fields[2].size*2),[3,shape[0]+2,shape[1]+2,2]);for(i=0;i<3;++i)gradient(dfields.pick(i),fields[i],"mirror");var normals=ndarray(pool.mallocFloat(3*fields[2].size),[shape[0]+2,shape[1]+2,3]);for(i=0;i<shape[0]+2;++i)for(j=0;j<shape[1]+2;++j){var dxdu=dfields.get(0,i,j,0),dxdv=dfields.get(0,i,j,1),dydu=dfields.get(1,i,j,0),dydv=dfields.get(1,i,j,1),dzdu=dfields.get(2,i,j,0),dzdv=dfields.get(2,i,j,1),nx=dydu*dzdv-dydv*dzdu,ny=dzdu*dxdv-dzdv*dxdu,nz=dxdu*dydv-dxdv*dydu,nl=Math.sqrt(nx*nx+ny*ny+nz*nz);nl<1e-8?(nl=Math.max(Math.abs(nx),Math.abs(ny),Math.abs(nz)))<1e-8?(nz=1,ny=nx=0,nl=1):nl=1/nl:nl=1/Math.sqrt(nl),normals.set(i,j,0,nx*nl),normals.set(i,j,1,ny*nl),normals.set(i,j,2,nz*nl)}pool.free(dfields.data);var lo=[1/0,1/0,1/0],hi=[-1/0,-1/0,-1/0],lo_intensity=1/0,hi_intensity=-1/0,count=(shape[0]-1)*(shape[1]-1)*6,tverts=pool.mallocFloat(bits.nextPow2(10*count)),tptr=0,vertexCount=0;for(i=0;i<shape[0]-1;++i)j_loop:for(j=0;j<shape[1]-1;++j){for(var dx=0;dx<2;++dx)for(var dy=0;dy<2;++dy)for(var k=0;k<3;++k){var f=this._field[k].get(1+i+dx,1+j+dy);if(isNaN(f)||!isFinite(f))continue j_loop}for(k=0;k<6;++k){var r=i+QUAD[k][0],c=j+QUAD[k][1],tx=this._field[0].get(r+1,c+1),ty=this._field[1].get(r+1,c+1),vf=f=this._field[2].get(r+1,c+1);nx=normals.get(r+1,c+1,0),ny=normals.get(r+1,c+1,1),nz=normals.get(r+1,c+1,2),params.intensity&&(vf=params.intensity.get(r,c)),tverts[tptr++]=r,tverts[tptr++]=c,tverts[tptr++]=tx,tverts[tptr++]=ty,tverts[tptr++]=f,tverts[tptr++]=0,tverts[tptr++]=vf,tverts[tptr++]=nx,tverts[tptr++]=ny,tverts[tptr++]=nz,lo[0]=Math.min(lo[0],tx),lo[1]=Math.min(lo[1],ty),lo[2]=Math.min(lo[2],f),lo_intensity=Math.min(lo_intensity,vf),hi[0]=Math.max(hi[0],tx),hi[1]=Math.max(hi[1],ty),hi[2]=Math.max(hi[2],f),hi_intensity=Math.max(hi_intensity,vf),vertexCount+=1}}for(params.intensityBounds&&(lo_intensity=+params.intensityBounds[0],hi_intensity=+params.intensityBounds[1]),i=6;i<tptr;i+=10)tverts[i]=(tverts[i]-lo_intensity)/(hi_intensity-lo_intensity);this._vertexCount=vertexCount,this._coordinateBuffer.update(tverts.subarray(0,tptr)),pool.freeFloat(tverts),pool.free(normals.data),this.bounds=[lo,hi],this.intensity=params.intensity||this._field[2],this.intensityBounds[0]===lo_intensity&&this.intensityBounds[1]===hi_intensity||(levelsChanged=!0),this.intensityBounds=[lo_intensity,hi_intensity]}if("levels"in params){var levels=params.levels;for(levels=Array.isArray(levels[0])?levels.slice():[[],[],levels],i=0;i<3;++i)levels[i]=levels[i].slice(),levels.sort(function(a,b){return a-b});change_test:for(i=0;i<3;++i){if(levels[i].length!==this.contourLevels[i].length){levelsChanged=!0;break}for(j=0;j<levels[i].length;++j)if(levels[i][j]!==this.contourLevels[i][j]){levelsChanged=!0;break change_test}}this.contourLevels=levels}if(levelsChanged){fields=this._field,shape=this.shape;for(var contourVerts=[],dim=0;dim<3;++dim){levels=this.contourLevels[dim];var levelOffsets=[],levelCounts=[],parts=[0,0,0];for(i=0;i<levels.length;++i){var graph=surfaceNets(this._field[dim],levels[i]);levelOffsets.push(contourVerts.length/5|0),vertexCount=0;edge_loop:for(j=0;j<graph.cells.length;++j){var e=graph.cells[j];for(k=0;k<2;++k){var p=graph.positions[e[k]],x=p[0],ix=0|Math.floor(x),fx=x-ix,y=p[1],iy=0|Math.floor(y),fy=y-iy,hole=!1;dd_loop:for(var dd=0;dd<3;++dd){parts[dd]=0;var iu=(dim+dd+1)%3;for(dx=0;dx<2;++dx){var s=dx?fx:1-fx;for(r=0|Math.min(Math.max(ix+dx,0),shape[0]),dy=0;dy<2;++dy){var t=dy?fy:1-fy;if(c=0|Math.min(Math.max(iy+dy,0),shape[1]),f=dd<2?this._field[iu].get(r,c):(this.intensity.get(r,c)-this.intensityBounds[0])/(this.intensityBounds[1]-this.intensityBounds[0]),!isFinite(f)||isNaN(f)){hole=!0;break dd_loop}var w=s*t;parts[dd]+=w*f}}}if(hole){if(k>0){for(var l=0;l<5;++l)contourVerts.pop();vertexCount-=1}continue edge_loop}contourVerts.push(parts[0],parts[1],p[0],p[1],parts[2]),vertexCount+=1}}levelCounts.push(vertexCount)}this._contourOffsets[dim]=levelOffsets,this._contourCounts[dim]=levelCounts}var floatBuffer=pool.mallocFloat(contourVerts.length);for(i=0;i<contourVerts.length;++i)floatBuffer[i]=contourVerts[i];this._contourBuffer.update(floatBuffer),pool.freeFloat(floatBuffer)}params.colormap&&this._colorMap.setPixels(function genColormap(name){var x=pack([colormap({colormap:name,nshades:N_COLORS,format:"rgba"}).map(function(c){return[c[0],c[1],c[2],255*c[3]]})]);return ops.divseq(x,255),x}(params.colormap))},proto.dispose=function(){this._shader.dispose(),this._vao.dispose(),this._coordinateBuffer.dispose(),this._colorMap.dispose(),this._contourBuffer.dispose(),this._contourVAO.dispose(),this._contourShader.dispose(),this._contourPickShader.dispose(),this._dynamicBuffer.dispose(),this._dynamicVAO.dispose();for(var i=0;i<3;++i)pool.freeFloat(this._field[i].data)},proto.highlight=function(selection){if(!selection)return this._dynamicCounts=[0,0,0],this.dyanamicLevel=[NaN,NaN,NaN],void(this.highlightLevel=[-1,-1,-1]);for(var i=0;i<3;++i)this.enableHighlight[i]?this.highlightLevel[i]=selection.level[i]:this.highlightLevel[i]=-1;var levels;if(levels=this.snapToData?selection.dataCoordinate:selection.position,this.enableDynamic[0]&&levels[0]!==this.dynamicLevel[0]||this.enableDynamic[1]&&levels[1]!==this.dynamicLevel[1]||this.enableDynamic[2]&&levels[2]!==this.dynamicLevel[2]){for(var vertexCount=0,shape=this.shape,scratchBuffer=pool.mallocFloat(12*shape[0]*shape[1]),d=0;d<3;++d)if(this.enableDynamic[d]){this.dynamicLevel[d]=levels[d];var u=(d+1)%3,v=(d+2)%3,f=this._field[d],g=this._field[u],h=this._field[v],graph=(this.intensity,surfaceNets(f,levels[d])),edges=graph.cells,positions=graph.positions;for(this._dynamicOffsets[d]=vertexCount,i=0;i<edges.length;++i)for(var e=edges[i],j=0;j<2;++j){var p=positions[e[j]],x=+p[0],ix=0|x,jx=0|Math.min(ix+1,shape[0]),fx=x-ix,hx=1-fx,y=+p[1],iy=0|y,jy=0|Math.min(iy+1,shape[1]),fy=y-iy,hy=1-fy,w00=hx*hy,w01=hx*fy,w10=fx*hy,w11=fx*fy,cu=w00*g.get(ix,iy)+w01*g.get(ix,jy)+w10*g.get(jx,iy)+w11*g.get(jx,jy),cv=w00*h.get(ix,iy)+w01*h.get(ix,jy)+w10*h.get(jx,iy)+w11*h.get(jx,jy);if(isNaN(cu)||isNaN(cv)){j&&(vertexCount-=1);break}scratchBuffer[2*vertexCount+0]=cu,scratchBuffer[2*vertexCount+1]=cv,vertexCount+=1}this._dynamicCounts[d]=vertexCount-this._dynamicOffsets[d]}else this.dynamicLevel[d]=NaN,this._dynamicCounts[d]=0;this._dynamicBuffer.update(scratchBuffer.subarray(0,2*vertexCount)),pool.freeFloat(scratchBuffer)}}},{"./lib/shaders":300,"binary-search-bounds":78,"bit-twiddle":79,colormap:113,"gl-buffer":229,"gl-mat4/invert":253,"gl-mat4/multiply":255,"gl-texture2d":303,"gl-vao":308,ndarray:430,"ndarray-gradient":421,"ndarray-ops":424,"ndarray-pack":425,"surface-nets":505,"typedarray-pool":519}],302:[function(_dereq_,module,exports){"use strict";var Font=_dereq_("css-font"),pick=_dereq_("pick-by-alias"),createRegl=_dereq_("regl"),createGl=_dereq_("gl-util/context"),WeakMap=_dereq_("es6-weak-map"),rgba=_dereq_("color-normalize"),fontAtlas=_dereq_("font-atlas"),pool=_dereq_("typedarray-pool"),parseRect=_dereq_("parse-rect"),isObj=_dereq_("is-plain-obj"),parseUnit=_dereq_("parse-unit"),px=_dereq_("to-px"),kerning=_dereq_("detect-kerning"),extend=_dereq_("object-assign"),metrics=_dereq_("font-measure"),flatten=_dereq_("flatten-vertex-data"),nextPow2=_dereq_("bit-twiddle").nextPow2,shaderCache=new WeakMap,isStretchSupported=!1;if(document.body){var el=document.body.appendChild(document.createElement("div"));el.style.font="italic small-caps bold condensed 16px/2 cursive",getComputedStyle(el).fontStretch&&(isStretchSupported=!0),document.body.removeChild(el)}var GlText=function GlText(o){!function isRegl(o){return"function"==typeof o&&o._gl&&o.prop&&o.texture&&o.buffer}(o)?this.gl=createGl(o):(o={regl:o},this.gl=o.regl._gl),this.shader=shaderCache.get(this.gl),this.shader?this.regl=this.shader.regl:this.regl=o.regl||createRegl({gl:this.gl}),this.charBuffer=this.regl.buffer({type:"uint8",usage:"stream"}),this.sizeBuffer=this.regl.buffer({type:"float",usage:"stream"}),this.shader||(this.shader=this.createShader(),shaderCache.set(this.gl,this.shader)),this.batch=[],this.fontSize=[],this.font=[],this.fontAtlas=[],this.draw=this.shader.draw.bind(this),this.render=function(){this.regl._refresh(),this.draw(this.batch)},this.canvas=this.gl.canvas,this.update(isObj(o)?o:{})};GlText.prototype.createShader=function createShader(){var regl=this.regl;return{regl:regl,draw:regl({blend:{enable:!0,color:[0,0,0,1],func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},stencil:{enable:!1},depth:{enable:!1},count:regl.prop("count"),offset:regl.prop("offset"),attributes:{charOffset:{offset:4,stride:8,buffer:regl.this("sizeBuffer")},width:{offset:0,stride:8,buffer:regl.this("sizeBuffer")},char:regl.this("charBuffer"),position:regl.this("position")},uniforms:{atlasSize:function(c,p){return[p.atlas.width,p.atlas.height]},atlasDim:function(c,p){return[p.atlas.cols,p.atlas.rows]},atlas:function(c,p){return p.atlas.texture},charStep:function(c,p){return p.atlas.step},em:function(c,p){return p.atlas.em},color:regl.prop("color"),opacity:regl.prop("opacity"),viewport:regl.this("viewportArray"),scale:regl.this("scale"),align:regl.prop("align"),baseline:regl.prop("baseline"),translate:regl.this("translate"),positionOffset:regl.prop("positionOffset")},primitive:"points",viewport:regl.this("viewport"),vert:"\n\t\t\tprecision highp float;\n\t\t\tattribute float width, charOffset, char;\n\t\t\tattribute vec2 position;\n\t\t\tuniform float fontSize, charStep, em, align, baseline;\n\t\t\tuniform vec4 viewport;\n\t\t\tuniform vec4 color;\n\t\t\tuniform vec2 atlasSize, atlasDim, scale, translate, positionOffset;\n\t\t\tvarying vec2 charCoord, charId;\n\t\t\tvarying float charWidth;\n\t\t\tvarying vec4 fontColor;\n\t\t\tvoid main () {\n\t\t\t\t"+(GlText.normalViewport?"":"vec2 positionOffset = vec2(positionOffset.x,- positionOffset.y);")+"\n\n\t\t\t\tvec2 offset = floor(em * (vec2(align + charOffset, baseline)\n\t\t\t\t\t+ positionOffset))\n\t\t\t\t\t/ (viewport.zw * scale.xy);\n\n\t\t\t\tvec2 position = (position + translate) * scale;\n\t\t\t\tposition += offset * scale;\n\n\t\t\t\t"+(GlText.normalViewport?"position.y = 1. - position.y;":"")+"\n\n\t\t\t\tcharCoord = position * viewport.zw + viewport.xy;\n\n\t\t\t\tgl_Position = vec4(position * 2. - 1., 0, 1);\n\n\t\t\t\tgl_PointSize = charStep;\n\n\t\t\t\tcharId.x = mod(char, atlasDim.x);\n\t\t\t\tcharId.y = floor(char / atlasDim.x);\n\n\t\t\t\tcharWidth = width * em;\n\n\t\t\t\tfontColor = color / 255.;\n\t\t\t}",frag:"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D atlas;\n\t\t\tuniform float fontSize, charStep, opacity;\n\t\t\tuniform vec2 atlasSize;\n\t\t\tuniform vec4 viewport;\n\t\t\tvarying vec4 fontColor;\n\t\t\tvarying vec2 charCoord, charId;\n\t\t\tvarying float charWidth;\n\n\t\t\tfloat lightness(vec4 color) {\n\t\t\t\treturn color.r * 0.299 + color.g * 0.587 + color.b * 0.114;\n\t\t\t}\n\n\t\t\tvoid main () {\n\t\t\t\tvec2 uv = gl_FragCoord.xy - charCoord + charStep * .5;\n\t\t\t\tfloat halfCharStep = floor(charStep * .5 + .5);\n\n\t\t\t\t// invert y and shift by 1px (FF expecially needs that)\n\t\t\t\tuv.y = charStep - uv.y;\n\n\t\t\t\t// ignore points outside of character bounding box\n\t\t\t\tfloat halfCharWidth = ceil(charWidth * .5);\n\t\t\t\tif (floor(uv.x) > halfCharStep + halfCharWidth ||\n\t\t\t\t\tfloor(uv.x) < halfCharStep - halfCharWidth) return;\n\n\t\t\t\tuv += charId * charStep;\n\t\t\t\tuv = uv / atlasSize;\n\n\t\t\t\tvec4 color = fontColor;\n\t\t\t\tvec4 mask = texture2D(atlas, uv);\n\n\t\t\t\tfloat maskY = lightness(mask);\n\t\t\t\t// float colorY = lightness(color);\n\t\t\t\tcolor.a *= maskY;\n\t\t\t\tcolor.a *= opacity;\n\n\t\t\t\t// color.a += .1;\n\n\t\t\t\t// antialiasing, see yiq color space y-channel formula\n\t\t\t\t// color.rgb += (1. - color.rgb) * (1. - mask.rgb);\n\n\t\t\t\tgl_FragColor = color;\n\t\t\t}"}),atlas:{}}},GlText.prototype.update=function update(o){var this$1=this;if("string"==typeof o)o={text:o};else if(!o)return;null!=(o=pick(o,{position:"position positions coord coords coordinates",font:"font fontFace fontface typeface cssFont css-font family fontFamily",fontSize:"fontSize fontsize size font-size",text:"text texts chars characters value values symbols",align:"align alignment textAlign textbaseline",baseline:"baseline textBaseline textbaseline",direction:"dir direction textDirection",color:"color colour fill fill-color fillColor textColor textcolor",kerning:"kerning kern",range:"range dataBox",viewport:"vp viewport viewBox viewbox viewPort",opacity:"opacity alpha transparency visible visibility opaque",offset:"offset positionOffset padding shift indent indentation"},!0)).opacity&&(Array.isArray(o.opacity)?this.opacity=o.opacity.map(function(o){return parseFloat(o)}):this.opacity=parseFloat(o.opacity)),null!=o.viewport&&(this.viewport=parseRect(o.viewport),GlText.normalViewport&&(this.viewport.y=this.canvas.height-this.viewport.y-this.viewport.height),this.viewportArray=[this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height]),null==this.viewport&&(this.viewport={x:0,y:0,width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight},this.viewportArray=[this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height]),null!=o.kerning&&(this.kerning=o.kerning),null!=o.offset&&("number"==typeof o.offset&&(o.offset=[o.offset,0]),this.positionOffset=flatten(o.offset)),o.direction&&(this.direction=o.direction),o.range&&(this.range=o.range,this.scale=[1/(o.range[2]-o.range[0]),1/(o.range[3]-o.range[1])],this.translate=[-o.range[0],-o.range[1]]),o.scale&&(this.scale=o.scale),o.translate&&(this.translate=o.translate),this.scale||(this.scale=[1/this.viewport.width,1/this.viewport.height]),this.translate||(this.translate=[0,0]),this.font.length||o.font||(o.font=GlText.baseFontSize+"px sans-serif");var newAtlasChars,newFont=!1,newFontSize=!1;if(o.font&&(Array.isArray(o.font)?o.font:[o.font]).forEach(function(font,i){if("string"==typeof font)try{font=Font.parse(font)}catch(e){font=Font.parse(GlText.baseFontSize+"px "+font)}else font=Font.parse(Font.stringify(font));var baseString=Font.stringify({size:GlText.baseFontSize,family:font.family,stretch:isStretchSupported?font.stretch:void 0,variant:font.variant,weight:font.weight,style:font.style}),unit=parseUnit(font.size),fs=Math.round(unit[0]*px(unit[1]));if(fs!==this$1.fontSize[i]&&(newFontSize=!0,this$1.fontSize[i]=fs),!(this$1.font[i]&&baseString==this$1.font[i].baseString||(newFont=!0,this$1.font[i]=GlText.fonts[baseString],this$1.font[i]))){var family=font.family.join(", "),style=[font.style];font.style!=font.variant&&style.push(font.variant),font.variant!=font.weight&&style.push(font.weight),isStretchSupported&&font.weight!=font.stretch&&style.push(font.stretch),this$1.font[i]={baseString:baseString,family:family,weight:font.weight,stretch:font.stretch,style:font.style,variant:font.variant,width:{},kerning:{},metrics:metrics(family,{origin:"top",fontSize:GlText.baseFontSize,fontStyle:style.join(" ")})},GlText.fonts[baseString]=this$1.font[i]}}),(newFont||newFontSize)&&this.font.forEach(function(font,i){var fontString=Font.stringify({size:this$1.fontSize[i],family:font.family,stretch:isStretchSupported?font.stretch:void 0,variant:font.variant,weight:font.weight,style:font.style});if(this$1.fontAtlas[i]=this$1.shader.atlas[fontString],!this$1.fontAtlas[i]){var metrics=font.metrics;this$1.shader.atlas[fontString]=this$1.fontAtlas[i]={fontString:fontString,step:2*Math.ceil(this$1.fontSize[i]*metrics.bottom*.5),em:this$1.fontSize[i],cols:0,rows:0,height:0,width:0,chars:[],ids:{},texture:this$1.regl.texture()}}null==o.text&&(o.text=this$1.text)}),"string"==typeof o.text&&o.position&&o.position.length>2){for(var textArray=Array(.5*o.position.length),i=0;i<textArray.length;i++)textArray[i]=o.text;o.text=textArray}if(null!=o.text||newFont){if(this.textOffsets=[0],Array.isArray(o.text)){this.count=o.text[0].length,this.counts=[this.count];for(var i$1=1;i$1<o.text.length;i$1++)this$1.textOffsets[i$1]=this$1.textOffsets[i$1-1]+o.text[i$1-1].length,this$1.count+=o.text[i$1].length,this$1.counts.push(o.text[i$1].length);this.text=o.text.join("")}else this.text=o.text,this.count=this.text.length,this.counts=[this.count];newAtlasChars=[],this.font.forEach(function(font,idx){GlText.atlasContext.font=font.baseString;for(var atlas=this$1.fontAtlas[idx],i=0;i<this$1.text.length;i++){var char=this$1.text.charAt(i);if(null==atlas.ids[char]&&(atlas.ids[char]=atlas.chars.length,atlas.chars.push(char),newAtlasChars.push(char)),null==font.width[char]&&(font.width[char]=GlText.atlasContext.measureText(char).width/GlText.baseFontSize,this$1.kerning)){var pairs=[];for(var baseChar in font.width)pairs.push(baseChar+char,char+baseChar);extend(font.kerning,kerning(font.family,{pairs:pairs}))}}})}if(o.position)if(o.position.length>2){for(var flat=!o.position[0].length,positionData=pool.mallocFloat(2*this.count),i$2=0,ptr=0;i$2<this.counts.length;i$2++){var count=this$1.counts[i$2];if(flat)for(var j=0;j<count;j++)positionData[ptr++]=o.position[2*i$2],positionData[ptr++]=o.position[2*i$2+1];else for(var j$1=0;j$1<count;j$1++)positionData[ptr++]=o.position[i$2][0],positionData[ptr++]=o.position[i$2][1]}this.position.call?this.position({type:"float",data:positionData}):this.position=this.regl.buffer({type:"float",data:positionData}),pool.freeFloat(positionData)}else this.position.destroy&&this.position.destroy(),this.position={constant:o.position};if(o.text||newFont){var charIds=pool.mallocUint8(this.count),sizeData=pool.mallocFloat(2*this.count);this.textWidth=[];for(var i$3=0,ptr$1=0;i$3<this.counts.length;i$3++){for(var count$1=this$1.counts[i$3],font=this$1.font[i$3]||this$1.font[0],atlas=this$1.fontAtlas[i$3]||this$1.fontAtlas[0],j$2=0;j$2<count$1;j$2++){var char=this$1.text.charAt(ptr$1),prevChar=this$1.text.charAt(ptr$1-1);if(charIds[ptr$1]=atlas.ids[char],sizeData[2*ptr$1]=font.width[char],j$2){var prevWidth=sizeData[2*ptr$1-2],currWidth=sizeData[2*ptr$1],offset=sizeData[2*ptr$1-1]+.5*prevWidth+.5*currWidth;if(this$1.kerning){var kerning$1=font.kerning[prevChar+char];kerning$1&&(offset+=.001*kerning$1)}sizeData[2*ptr$1+1]=offset}else sizeData[2*ptr$1+1]=.5*sizeData[2*ptr$1];ptr$1++}this$1.textWidth.push(sizeData.length?.5*sizeData[2*ptr$1-2]+sizeData[2*ptr$1-1]:0)}o.align||(o.align=this.align),this.charBuffer({data:charIds,type:"uint8",usage:"stream"}),this.sizeBuffer({data:sizeData,type:"float",usage:"stream"}),pool.freeUint8(charIds),pool.freeFloat(sizeData),newAtlasChars.length&&this.font.forEach(function(font,i){var atlas=this$1.fontAtlas[i],step=atlas.step,maxCols=Math.floor(GlText.maxAtlasSize/step),cols=Math.min(maxCols,atlas.chars.length),rows=Math.ceil(atlas.chars.length/cols),atlasWidth=nextPow2(cols*step),atlasHeight=nextPow2(rows*step);atlas.width=atlasWidth,atlas.height=atlasHeight,atlas.rows=rows,atlas.cols=cols,atlas.em&&atlas.texture({data:fontAtlas({canvas:GlText.atlasCanvas,font:atlas.fontString,chars:atlas.chars,shape:[atlasWidth,atlasHeight],step:[step,step]})})})}if(o.align&&(this.align=o.align,this.alignOffset=this.textWidth.map(function(textWidth,i){var align=Array.isArray(this$1.align)?this$1.align.length>1?this$1.align[i]:this$1.align[0]:this$1.align;if("number"==typeof align)return align;switch(align){case"right":case"end":return-textWidth;case"center":case"centre":case"middle":return.5*-textWidth}return 0})),null==this.baseline&&null==o.baseline&&(o.baseline=0),null!=o.baseline&&(this.baseline=o.baseline,Array.isArray(this.baseline)||(this.baseline=[this.baseline]),this.baselineOffset=this.baseline.map(function(baseline,i){var m=(this$1.font[i]||this$1.font[0]).metrics,base=0;return base+=.5*m.bottom,base+="number"==typeof baseline?baseline-m.baseline:-m[baseline],GlText.normalViewport||(base*=-1),base})),null!=o.color)if(o.color||(o.color="transparent"),"string"!=typeof o.color&&isNaN(o.color)){var colorData;if("number"==typeof o.color[0]&&o.color.length>this.counts.length){var l=o.color.length;colorData=pool.mallocUint8(l);for(var sub=(o.color.subarray||o.color.slice).bind(o.color),i$4=0;i$4<l;i$4+=4)colorData.set(rgba(sub(i$4,i$4+4),"uint8"),i$4)}else{var l$1=o.color.length;colorData=pool.mallocUint8(4*l$1);for(var i$5=0;i$5<l$1;i$5++)colorData.set(rgba(o.color[i$5]||0,"uint8"),4*i$5)}this.color=colorData}else this.color=rgba(o.color,"uint8");if(o.position||o.text||o.color||o.baseline||o.align||o.font||o.offset||o.opacity)if(this.color.length>4||this.baselineOffset.length>1||this.align&&this.align.length>1||this.fontAtlas.length>1||this.positionOffset.length>2){var length=Math.max(.5*this.position.length||0,.25*this.color.length||0,this.baselineOffset.length||0,this.alignOffset.length||0,this.font.length||0,this.opacity.length||0,.5*this.positionOffset.length||0);this.batch=Array(length);for(var i$6=0;i$6<this.batch.length;i$6++)this$1.batch[i$6]={count:this$1.counts.length>1?this$1.counts[i$6]:this$1.counts[0],offset:this$1.textOffsets.length>1?this$1.textOffsets[i$6]:this$1.textOffsets[0],color:this$1.color?this$1.color.length<=4?this$1.color:this$1.color.subarray(4*i$6,4*i$6+4):[0,0,0,255],opacity:Array.isArray(this$1.opacity)?this$1.opacity[i$6]:this$1.opacity,baseline:null!=this$1.baselineOffset[i$6]?this$1.baselineOffset[i$6]:this$1.baselineOffset[0],align:this$1.align?null!=this$1.alignOffset[i$6]?this$1.alignOffset[i$6]:this$1.alignOffset[0]:0,atlas:this$1.fontAtlas[i$6]||this$1.fontAtlas[0],positionOffset:this$1.positionOffset.length>2?this$1.positionOffset.subarray(2*i$6,2*i$6+2):this$1.positionOffset}}else this.count?this.batch=[{count:this.count,offset:0,color:this.color||[0,0,0,255],opacity:Array.isArray(this.opacity)?this.opacity[0]:this.opacity,baseline:this.baselineOffset[0],align:this.alignOffset?this.alignOffset[0]:0,atlas:this.fontAtlas[0],positionOffset:this.positionOffset}]:this.batch=[]},GlText.prototype.destroy=function destroy(){},GlText.prototype.kerning=!0,GlText.prototype.position={constant:new Float32Array(2)},GlText.prototype.translate=null,GlText.prototype.scale=null,GlText.prototype.font=null,GlText.prototype.text="",GlText.prototype.positionOffset=[0,0],GlText.prototype.opacity=1,GlText.prototype.color=new Uint8Array([0,0,0,255]),GlText.prototype.alignOffset=[0,0],GlText.normalViewport=!1,GlText.maxAtlasSize=1024,GlText.atlasCanvas=document.createElement("canvas"),GlText.atlasContext=GlText.atlasCanvas.getContext("2d",{alpha:!1}),GlText.baseFontSize=64,GlText.fonts={},module.exports=GlText},{"bit-twiddle":79,"color-normalize":107,"css-font":126,"detect-kerning":150,"es6-weak-map":208,"flatten-vertex-data":215,"font-atlas":216,"font-measure":217,"gl-util/context":304,"is-plain-obj":403,"object-assign":434,"parse-rect":439,"parse-unit":441,"pick-by-alias":445,regl:475,"to-px":513,"typedarray-pool":519}],303:[function(_dereq_,module,exports){"use strict";var ndarray=_dereq_("ndarray"),ops=_dereq_("ndarray-ops"),pool=_dereq_("typedarray-pool");module.exports=function createTexture2D(gl){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");linearTypes||function lazyInitLinearTypes(gl){linearTypes=[gl.LINEAR,gl.NEAREST_MIPMAP_LINEAR,gl.LINEAR_MIPMAP_NEAREST,gl.LINEAR_MIPMAP_NEAREST],filterTypes=[gl.NEAREST,gl.LINEAR,gl.NEAREST_MIPMAP_NEAREST,gl.NEAREST_MIPMAP_LINEAR,gl.LINEAR_MIPMAP_NEAREST,gl.LINEAR_MIPMAP_LINEAR],wrapTypes=[gl.REPEAT,gl.CLAMP_TO_EDGE,gl.MIRRORED_REPEAT]}(gl);if("number"==typeof arguments[1])return createTextureShape(gl,arguments[1],arguments[2],arguments[3]||gl.RGBA,arguments[4]||gl.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return createTextureShape(gl,0|arguments[1][0],0|arguments[1][1],arguments[2]||gl.RGBA,arguments[3]||gl.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var obj=arguments[1],directData=acceptTextureDOM(obj)?obj:obj.raw;if(directData)return function createTextureDOM(gl,directData,width,height,format,type){var tex=initTexture(gl);return gl.texImage2D(gl.TEXTURE_2D,0,format,format,type,directData),new Texture2D(gl,tex,width,height,format,type)}(gl,directData,0|obj.width,0|obj.height,arguments[2]||gl.RGBA,arguments[3]||gl.UNSIGNED_BYTE);if(obj.shape&&obj.data&&obj.stride)return function createTextureArray(gl,array){var dtype=array.dtype,shape=array.shape.slice(),maxSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(shape[0]<0||shape[0]>maxSize||shape[1]<0||shape[1]>maxSize)throw new Error("gl-texture2d: Invalid texture size");var packed=isPacked(shape,array.stride.slice()),type=0;"float32"===dtype?type=gl.FLOAT:"float64"===dtype?(type=gl.FLOAT,packed=!1,dtype="float32"):"uint8"===dtype?type=gl.UNSIGNED_BYTE:(type=gl.UNSIGNED_BYTE,packed=!1,dtype="uint8");var buffer,buf_store,format=0;if(2===shape.length)format=gl.LUMINANCE,shape=[shape[0],shape[1],1],array=ndarray(array.data,shape,[array.stride[0],array.stride[1],1],array.offset);else{if(3!==shape.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===shape[2])format=gl.ALPHA;else if(2===shape[2])format=gl.LUMINANCE_ALPHA;else if(3===shape[2])format=gl.RGB;else{if(4!==shape[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");format=gl.RGBA}}type!==gl.FLOAT||gl.getExtension("OES_texture_float")||(type=gl.UNSIGNED_BYTE,packed=!1);var size=array.size;if(packed)buffer=0===array.offset&&array.data.length===size?array.data:array.data.subarray(array.offset,array.offset+size);else{var stride=[shape[2],shape[2]*shape[0],1];buf_store=pool.malloc(size,dtype);var buf_array=ndarray(buf_store,shape,stride,0);"float32"!==dtype&&"float64"!==dtype||type!==gl.UNSIGNED_BYTE?ops.assign(buf_array,array):convertFloatToUint8(buf_array,array),buffer=buf_store.subarray(0,size)}var tex=initTexture(gl);gl.texImage2D(gl.TEXTURE_2D,0,format,shape[0],shape[1],0,format,type,buffer),packed||pool.free(buf_store);return new Texture2D(gl,tex,shape[0],shape[1],format,type)}(gl,obj)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")};var linearTypes=null,filterTypes=null,wrapTypes=null;function acceptTextureDOM(obj){return"undefined"!=typeof HTMLCanvasElement&&obj instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&obj instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&obj instanceof HTMLVideoElement||"undefined"!=typeof ImageData&&obj instanceof ImageData}var convertFloatToUint8=function(out,inp){ops.muls(out,inp,255)};function reshapeTexture(tex,w,h){var gl=tex.gl,maxSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(w<0||w>maxSize||h<0||h>maxSize)throw new Error("gl-texture2d: Invalid texture size");return tex._shape=[w,h],tex.bind(),gl.texImage2D(gl.TEXTURE_2D,0,tex.format,w,h,0,tex.format,tex.type,null),tex._mipLevels=[0],tex}function Texture2D(gl,handle,width,height,format,type){this.gl=gl,this.handle=handle,this.format=format,this.type=type,this._shape=[width,height],this._mipLevels=[0],this._magFilter=gl.NEAREST,this._minFilter=gl.NEAREST,this._wrapS=gl.CLAMP_TO_EDGE,this._wrapT=gl.CLAMP_TO_EDGE,this._anisoSamples=1;var parent=this,wrapVector=[this._wrapS,this._wrapT];Object.defineProperties(wrapVector,[{get:function(){return parent._wrapS},set:function(v){return parent.wrapS=v}},{get:function(){return parent._wrapT},set:function(v){return parent.wrapT=v}}]),this._wrapVector=wrapVector;var shapeVector=[this._shape[0],this._shape[1]];Object.defineProperties(shapeVector,[{get:function(){return parent._shape[0]},set:function(v){return parent.width=v}},{get:function(){return parent._shape[1]},set:function(v){return parent.height=v}}]),this._shapeVector=shapeVector}var proto=Texture2D.prototype;function isPacked(shape,stride){return 3===shape.length?1===stride[2]&&stride[1]===shape[0]*shape[2]&&stride[0]===shape[2]:1===stride[0]&&stride[1]===shape[0]}function initTexture(gl){var tex=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,tex),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),tex}function createTextureShape(gl,width,height,format,type){var maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(width<0||width>maxTextureSize||height<0||height>maxTextureSize)throw new Error("gl-texture2d: Invalid texture shape");if(type===gl.FLOAT&&!gl.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var tex=initTexture(gl);return gl.texImage2D(gl.TEXTURE_2D,0,format,width,height,0,format,type,null),new Texture2D(gl,tex,width,height,format,type)}Object.defineProperties(proto,{minFilter:{get:function(){return this._minFilter},set:function(v){this.bind();var gl=this.gl;if(this.type===gl.FLOAT&&linearTypes.indexOf(v)>=0&&(gl.getExtension("OES_texture_float_linear")||(v=gl.NEAREST)),filterTypes.indexOf(v)<0)throw new Error("gl-texture2d: Unknown filter mode "+v);return gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,v),this._minFilter=v}},magFilter:{get:function(){return this._magFilter},set:function(v){this.bind();var gl=this.gl;if(this.type===gl.FLOAT&&linearTypes.indexOf(v)>=0&&(gl.getExtension("OES_texture_float_linear")||(v=gl.NEAREST)),filterTypes.indexOf(v)<0)throw new Error("gl-texture2d: Unknown filter mode "+v);return gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,v),this._magFilter=v}},mipSamples:{get:function(){return this._anisoSamples},set:function(i){var psamples=this._anisoSamples;if(this._anisoSamples=0|Math.max(i,1),psamples!==this._anisoSamples){var ext=this.gl.getExtension("EXT_texture_filter_anisotropic");ext&&this.gl.texParameterf(this.gl.TEXTURE_2D,ext.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(v){if(this.bind(),wrapTypes.indexOf(v)<0)throw new Error("gl-texture2d: Unknown wrap mode "+v);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,v),this._wrapS=v}},wrapT:{get:function(){return this._wrapT},set:function(v){if(this.bind(),wrapTypes.indexOf(v)<0)throw new Error("gl-texture2d: Unknown wrap mode "+v);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,v),this._wrapT=v}},wrap:{get:function(){return this._wrapVector},set:function(v){if(Array.isArray(v)||(v=[v,v]),2!==v.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var i=0;i<2;++i)if(wrapTypes.indexOf(v[i])<0)throw new Error("gl-texture2d: Unknown wrap mode "+v);this._wrapS=v[0],this._wrapT=v[1];var gl=this.gl;return this.bind(),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this._wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this._wrapT),v}},shape:{get:function(){return this._shapeVector},set:function(x){if(Array.isArray(x)){if(2!==x.length)throw new Error("gl-texture2d: Invalid texture shape")}else x=[0|x,0|x];return reshapeTexture(this,0|x[0],0|x[1]),[0|x[0],0|x[1]]}},width:{get:function(){return this._shape[0]},set:function(w){return reshapeTexture(this,w|=0,this._shape[1]),w}},height:{get:function(){return this._shape[1]},set:function(h){return h|=0,reshapeTexture(this,this._shape[0],h),h}}}),proto.bind=function(unit){var gl=this.gl;return void 0!==unit&&gl.activeTexture(gl.TEXTURE0+(0|unit)),gl.bindTexture(gl.TEXTURE_2D,this.handle),void 0!==unit?0|unit:gl.getParameter(gl.ACTIVE_TEXTURE)-gl.TEXTURE0},proto.dispose=function(){this.gl.deleteTexture(this.handle)},proto.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var l=Math.min(this._shape[0],this._shape[1]),i=0;l>0;++i,l>>>=1)this._mipLevels.indexOf(i)<0&&this._mipLevels.push(i)},proto.setPixels=function(data,x_off,y_off,mip_level){var gl=this.gl;this.bind(),Array.isArray(x_off)?(mip_level=y_off,y_off=0|x_off[1],x_off=0|x_off[0]):(x_off=x_off||0,y_off=y_off||0),mip_level=mip_level||0;var directData=acceptTextureDOM(data)?data:data.raw;if(directData){this._mipLevels.indexOf(mip_level)<0?(gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,this.type,directData),this._mipLevels.push(mip_level)):gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,this.format,this.type,directData)}else{if(!(data.shape&&data.stride&&data.data))throw new Error("gl-texture2d: Unsupported data type");if(data.shape.length<2||x_off+data.shape[1]>this._shape[1]>>>mip_level||y_off+data.shape[0]>this._shape[0]>>>mip_level||x_off<0||y_off<0)throw new Error("gl-texture2d: Texture dimensions are out of bounds");!function texSubImageArray(gl,x_off,y_off,mip_level,cformat,ctype,mipLevels,array){var dtype=array.dtype,shape=array.shape.slice();if(shape.length<2||shape.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var type=0,format=0,packed=isPacked(shape,array.stride.slice());"float32"===dtype?type=gl.FLOAT:"float64"===dtype?(type=gl.FLOAT,packed=!1,dtype="float32"):"uint8"===dtype?type=gl.UNSIGNED_BYTE:(type=gl.UNSIGNED_BYTE,packed=!1,dtype="uint8");if(2===shape.length)format=gl.LUMINANCE,shape=[shape[0],shape[1],1],array=ndarray(array.data,shape,[array.stride[0],array.stride[1],1],array.offset);else{if(3!==shape.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===shape[2])format=gl.ALPHA;else if(2===shape[2])format=gl.LUMINANCE_ALPHA;else if(3===shape[2])format=gl.RGB;else{if(4!==shape[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");format=gl.RGBA}shape[2]}format!==gl.LUMINANCE&&format!==gl.ALPHA||cformat!==gl.LUMINANCE&&cformat!==gl.ALPHA||(format=cformat);if(format!==cformat)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var size=array.size,needsMip=mipLevels.indexOf(mip_level)<0;needsMip&&mipLevels.push(mip_level);if(type===ctype&&packed)0===array.offset&&array.data.length===size?needsMip?gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,array.data):gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,array.data):needsMip?gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,array.data.subarray(array.offset,array.offset+size)):gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,array.data.subarray(array.offset,array.offset+size));else{var pack_buffer;pack_buffer=ctype===gl.FLOAT?pool.mallocFloat32(size):pool.mallocUint8(size);var pack_view=ndarray(pack_buffer,shape,[shape[2],shape[2]*shape[0],1]);type===gl.FLOAT&&ctype===gl.UNSIGNED_BYTE?convertFloatToUint8(pack_view,array):ops.assign(pack_view,array),needsMip?gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,pack_buffer.subarray(0,size)):gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,pack_buffer.subarray(0,size)),ctype===gl.FLOAT?pool.freeFloat32(pack_buffer):pool.freeUint8(pack_buffer)}}(gl,x_off,y_off,mip_level,this.format,this.type,this._mipLevels,data)}}},{ndarray:430,"ndarray-ops":424,"typedarray-pool":519}],304:[function(_dereq_,module,exports){"use strict";var pick=_dereq_("pick-by-alias");function resize(o){if(o.container)if(o.container==document.body)document.body.style.width||(o.canvas.width=o.width||o.pixelRatio*window.innerWidth),document.body.style.height||(o.canvas.height=o.height||o.pixelRatio*window.innerHeight);else{var bounds=o.container.getBoundingClientRect();o.canvas.width=o.width||bounds.right-bounds.left,o.canvas.height=o.height||bounds.bottom-bounds.top}}function isCanvas(e){return"function"==typeof e.getContext&&"width"in e&&"height"in e}module.exports=function setContext(o){if(o?"string"==typeof o&&(o={container:o}):o={},(o=isCanvas(o)?{container:o}:function isElement(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}(o)?{container:o}:function isContext(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(o)?{gl:o}:pick(o,{container:"container target element el canvas holder parent parentNode wrapper use ref root node",gl:"gl context webgl glContext",attrs:"attributes attrs contextAttributes",pixelRatio:"pixelRatio pxRatio px ratio pxratio pixelratio"},!0)).pixelRatio||(o.pixelRatio=window.pixelRatio||1),o.gl)return o.gl;if(o.canvas&&(o.container=o.canvas.parentNode),o.container){if("string"==typeof o.container){var c=document.querySelector(o.container);if(!c)throw Error("Element "+o.container+" is not found");o.container=c}isCanvas(o.container)?(o.canvas=o.container,o.container=o.canvas.parentNode):o.canvas||(o.canvas=document.createElement("canvas"),o.container.appendChild(o.canvas),resize(o))}else o.canvas||(o.container=document.body||document.documentElement,o.canvas=document.createElement("canvas"),o.canvas.style.position="absolute",o.canvas.style.top=0,o.canvas.style.left=0,o.container.appendChild(o.canvas),resize(o));if(!o.gl)try{o.gl=o.canvas.getContext("webgl",o.attrs)}catch(e){try{o.gl=o.canvas.getContext("experimental-webgl",o.attrs)}catch(e){o.gl=o.canvas.getContext("webgl-experimental",o.attrs)}}return o.gl}},{"pick-by-alias":445}],305:[function(_dereq_,module,exports){"use strict";module.exports=function doBind(gl,elements,attributes){elements?elements.bind():gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);var nattribs=0|gl.getParameter(gl.MAX_VERTEX_ATTRIBS);if(attributes){if(attributes.length>nattribs)throw new Error("gl-vao: Too many vertex attributes");for(var i=0;i<attributes.length;++i){var attrib=attributes[i];if(attrib.buffer){var buffer=attrib.buffer,size=attrib.size||4,type=attrib.type||gl.FLOAT,normalized=!!attrib.normalized,stride=attrib.stride||0,offset=attrib.offset||0;buffer.bind(),gl.enableVertexAttribArray(i),gl.vertexAttribPointer(i,size,type,normalized,stride,offset)}else{if("number"==typeof attrib)gl.vertexAttrib1f(i,attrib);else if(1===attrib.length)gl.vertexAttrib1f(i,attrib[0]);else if(2===attrib.length)gl.vertexAttrib2f(i,attrib[0],attrib[1]);else if(3===attrib.length)gl.vertexAttrib3f(i,attrib[0],attrib[1],attrib[2]);else{if(4!==attrib.length)throw new Error("gl-vao: Invalid vertex attribute");gl.vertexAttrib4f(i,attrib[0],attrib[1],attrib[2],attrib[3])}gl.disableVertexAttribArray(i)}}for(;i<nattribs;++i)gl.disableVertexAttribArray(i)}else for(gl.bindBuffer(gl.ARRAY_BUFFER,null),i=0;i<nattribs;++i)gl.disableVertexAttribArray(i)}},{}],306:[function(_dereq_,module,exports){"use strict";var bindAttribs=_dereq_("./do-bind.js");function VAOEmulated(gl){this.gl=gl,this._elements=null,this._attributes=null,this._elementsType=gl.UNSIGNED_SHORT}VAOEmulated.prototype.bind=function(){bindAttribs(this.gl,this._elements,this._attributes)},VAOEmulated.prototype.update=function(attributes,elements,elementsType){this._elements=elements,this._attributes=attributes,this._elementsType=elementsType||this.gl.UNSIGNED_SHORT},VAOEmulated.prototype.dispose=function(){},VAOEmulated.prototype.unbind=function(){},VAOEmulated.prototype.draw=function(mode,count,offset){offset=offset||0;var gl=this.gl;this._elements?gl.drawElements(mode,count,this._elementsType,offset):gl.drawArrays(mode,offset,count)},module.exports=function createVAOEmulated(gl){return new VAOEmulated(gl)}},{"./do-bind.js":305}],307:[function(_dereq_,module,exports){"use strict";var bindAttribs=_dereq_("./do-bind.js");function VertexAttribute(location,dimension,a,b,c,d){this.location=location,this.dimension=dimension,this.a=a,this.b=b,this.c=c,this.d=d}function VAONative(gl,ext,handle){this.gl=gl,this._ext=ext,this.handle=handle,this._attribs=[],this._useElements=!1,this._elementsType=gl.UNSIGNED_SHORT}VertexAttribute.prototype.bind=function(gl){switch(this.dimension){case 1:gl.vertexAttrib1f(this.location,this.a);break;case 2:gl.vertexAttrib2f(this.location,this.a,this.b);break;case 3:gl.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:gl.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d)}},VAONative.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var i=0;i<this._attribs.length;++i)this._attribs[i].bind(this.gl)},VAONative.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)},VAONative.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)},VAONative.prototype.update=function(attributes,elements,elementsType){if(this.bind(),bindAttribs(this.gl,elements,attributes),this.unbind(),this._attribs.length=0,attributes)for(var i=0;i<attributes.length;++i){var a=attributes[i];"number"==typeof a?this._attribs.push(new VertexAttribute(i,1,a)):Array.isArray(a)&&this._attribs.push(new VertexAttribute(i,a.length,a[0],a[1],a[2],a[3]))}this._useElements=!!elements,this._elementsType=elementsType||this.gl.UNSIGNED_SHORT},VAONative.prototype.draw=function(mode,count,offset){offset=offset||0;var gl=this.gl;this._useElements?gl.drawElements(mode,count,this._elementsType,offset):gl.drawArrays(mode,offset,count)},module.exports=function createVAONative(gl,ext){return new VAONative(gl,ext,ext.createVertexArrayOES())}},{"./do-bind.js":305}],308:[function(_dereq_,module,exports){"use strict";var createVAONative=_dereq_("./lib/vao-native.js"),createVAOEmulated=_dereq_("./lib/vao-emulated.js");module.exports=function createVAO(gl,attributes,elements,elementsType){var vao,ext=gl.createVertexArray?new function ExtensionShim(gl){this.bindVertexArrayOES=gl.bindVertexArray.bind(gl),this.createVertexArrayOES=gl.createVertexArray.bind(gl),this.deleteVertexArrayOES=gl.deleteVertexArray.bind(gl)}(gl):gl.getExtension("OES_vertex_array_object");return(vao=ext?createVAONative(gl,ext):createVAOEmulated(gl)).update(attributes,elements,elementsType),vao}},{"./lib/vao-emulated.js":306,"./lib/vao-native.js":307}],309:[function(_dereq_,module,exports){module.exports=function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out}},{}],310:[function(_dereq_,module,exports){module.exports=function angle(a,b){var tempA=fromValues(a[0],a[1],a[2]),tempB=fromValues(b[0],b[1],b[2]);normalize(tempA,tempA),normalize(tempB,tempB);var cosine=dot(tempA,tempB);return cosine>1?0:Math.acos(cosine)};var fromValues=_dereq_("./fromValues"),normalize=_dereq_("./normalize"),dot=_dereq_("./dot")},{"./dot":320,"./fromValues":326,"./normalize":337}],311:[function(_dereq_,module,exports){module.exports=function ceil(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out}},{}],312:[function(_dereq_,module,exports){module.exports=function clone(a){var out=new Float32Array(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}},{}],313:[function(_dereq_,module,exports){module.exports=function copy(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}},{}],314:[function(_dereq_,module,exports){module.exports=function create(){var out=new Float32Array(3);return out[0]=0,out[1]=0,out[2]=0,out}},{}],315:[function(_dereq_,module,exports){module.exports=function cross(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out}},{}],316:[function(_dereq_,module,exports){module.exports=_dereq_("./distance")},{"./distance":317}],317:[function(_dereq_,module,exports){module.exports=function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)}},{}],318:[function(_dereq_,module,exports){module.exports=_dereq_("./divide")},{"./divide":319}],319:[function(_dereq_,module,exports){module.exports=function divide(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out}},{}],320:[function(_dereq_,module,exports){module.exports=function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}},{}],321:[function(_dereq_,module,exports){module.exports=1e-6},{}],322:[function(_dereq_,module,exports){module.exports=function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))};var EPSILON=_dereq_("./epsilon")},{"./epsilon":321}],323:[function(_dereq_,module,exports){module.exports=function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}},{}],324:[function(_dereq_,module,exports){module.exports=function floor(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out}},{}],325:[function(_dereq_,module,exports){module.exports=function forEach(a,stride,offset,count,fn,arg){var i,l;stride||(stride=3);offset||(offset=0);l=count?Math.min(count*stride+offset,a.length):a.length;for(i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2];return a};var vec=_dereq_("./create")()},{"./create":314}],326:[function(_dereq_,module,exports){module.exports=function fromValues(x,y,z){var out=new Float32Array(3);return out[0]=x,out[1]=y,out[2]=z,out}},{}],327:[function(_dereq_,module,exports){module.exports={EPSILON:_dereq_("./epsilon"),create:_dereq_("./create"),clone:_dereq_("./clone"),angle:_dereq_("./angle"),fromValues:_dereq_("./fromValues"),copy:_dereq_("./copy"),set:_dereq_("./set"),equals:_dereq_("./equals"),exactEquals:_dereq_("./exactEquals"),add:_dereq_("./add"),subtract:_dereq_("./subtract"),sub:_dereq_("./sub"),multiply:_dereq_("./multiply"),mul:_dereq_("./mul"),divide:_dereq_("./divide"),div:_dereq_("./div"),min:_dereq_("./min"),max:_dereq_("./max"),floor:_dereq_("./floor"),ceil:_dereq_("./ceil"),round:_dereq_("./round"),scale:_dereq_("./scale"),scaleAndAdd:_dereq_("./scaleAndAdd"),distance:_dereq_("./distance"),dist:_dereq_("./dist"),squaredDistance:_dereq_("./squaredDistance"),sqrDist:_dereq_("./sqrDist"),length:_dereq_("./length"),len:_dereq_("./len"),squaredLength:_dereq_("./squaredLength"),sqrLen:_dereq_("./sqrLen"),negate:_dereq_("./negate"),inverse:_dereq_("./inverse"),normalize:_dereq_("./normalize"),dot:_dereq_("./dot"),cross:_dereq_("./cross"),lerp:_dereq_("./lerp"),random:_dereq_("./random"),transformMat4:_dereq_("./transformMat4"),transformMat3:_dereq_("./transformMat3"),transformQuat:_dereq_("./transformQuat"),rotateX:_dereq_("./rotateX"),rotateY:_dereq_("./rotateY"),rotateZ:_dereq_("./rotateZ"),forEach:_dereq_("./forEach")}},{"./add":309,"./angle":310,"./ceil":311,"./clone":312,"./copy":313,"./create":314,"./cross":315,"./dist":316,"./distance":317,"./div":318,"./divide":319,"./dot":320,"./epsilon":321,"./equals":322,"./exactEquals":323,"./floor":324,"./forEach":325,"./fromValues":326,"./inverse":328,"./len":329,"./length":330,"./lerp":331,"./max":332,"./min":333,"./mul":334,"./multiply":335,"./negate":336,"./normalize":337,"./random":338,"./rotateX":339,"./rotateY":340,"./rotateZ":341,"./round":342,"./scale":343,"./scaleAndAdd":344,"./set":345,"./sqrDist":346,"./sqrLen":347,"./squaredDistance":348,"./squaredLength":349,"./sub":350,"./subtract":351,"./transformMat3":352,"./transformMat4":353,"./transformQuat":354}],328:[function(_dereq_,module,exports){module.exports=function inverse(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out}},{}],329:[function(_dereq_,module,exports){module.exports=_dereq_("./length")},{"./length":330}],330:[function(_dereq_,module,exports){module.exports=function length(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)}},{}],331:[function(_dereq_,module,exports){module.exports=function lerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out}},{}],332:[function(_dereq_,module,exports){module.exports=function max(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out}},{}],333:[function(_dereq_,module,exports){module.exports=function min(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out}},{}],334:[function(_dereq_,module,exports){module.exports=_dereq_("./multiply")},{"./multiply":335}],335:[function(_dereq_,module,exports){module.exports=function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out}},{}],336:[function(_dereq_,module,exports){module.exports=function negate(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out}},{}],337:[function(_dereq_,module,exports){module.exports=function normalize(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len);return out}},{}],338:[function(_dereq_,module,exports){module.exports=function random(out,scale){scale=scale||1;var r=2*Math.random()*Math.PI,z=2*Math.random()-1,zScale=Math.sqrt(1-z*z)*scale;return out[0]=Math.cos(r)*zScale,out[1]=Math.sin(r)*zScale,out[2]=z*scale,out}},{}],339:[function(_dereq_,module,exports){module.exports=function rotateX(out,a,b,c){var by=b[1],bz=b[2],py=a[1]-by,pz=a[2]-bz,sc=Math.sin(c),cc=Math.cos(c);return out[0]=a[0],out[1]=by+py*cc-pz*sc,out[2]=bz+py*sc+pz*cc,out}},{}],340:[function(_dereq_,module,exports){module.exports=function rotateY(out,a,b,c){var bx=b[0],bz=b[2],px=a[0]-bx,pz=a[2]-bz,sc=Math.sin(c),cc=Math.cos(c);return out[0]=bx+pz*sc+px*cc,out[1]=a[1],out[2]=bz+pz*cc-px*sc,out}},{}],341:[function(_dereq_,module,exports){module.exports=function rotateZ(out,a,b,c){var bx=b[0],by=b[1],px=a[0]-bx,py=a[1]-by,sc=Math.sin(c),cc=Math.cos(c);return out[0]=bx+px*cc-py*sc,out[1]=by+px*sc+py*cc,out[2]=a[2],out}},{}],342:[function(_dereq_,module,exports){module.exports=function round(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out}},{}],343:[function(_dereq_,module,exports){module.exports=function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out}},{}],344:[function(_dereq_,module,exports){module.exports=function scaleAndAdd(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out}},{}],345:[function(_dereq_,module,exports){module.exports=function set(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out}},{}],346:[function(_dereq_,module,exports){module.exports=_dereq_("./squaredDistance")},{"./squaredDistance":348}],347:[function(_dereq_,module,exports){module.exports=_dereq_("./squaredLength")},{"./squaredLength":349}],348:[function(_dereq_,module,exports){module.exports=function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z}},{}],349:[function(_dereq_,module,exports){module.exports=function squaredLength(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z}},{}],350:[function(_dereq_,module,exports){module.exports=_dereq_("./subtract")},{"./subtract":351}],351:[function(_dereq_,module,exports){module.exports=function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out}},{}],352:[function(_dereq_,module,exports){module.exports=function transformMat3(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=x*m[0]+y*m[3]+z*m[6],out[1]=x*m[1]+y*m[4]+z*m[7],out[2]=x*m[2]+y*m[5]+z*m[8],out}},{}],353:[function(_dereq_,module,exports){module.exports=function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];return w=w||1,out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w,out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w,out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w,out}},{}],354:[function(_dereq_,module,exports){module.exports=function transformQuat(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out}},{}],355:[function(_dereq_,module,exports){module.exports=function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out}},{}],356:[function(_dereq_,module,exports){module.exports=function clone(a){var out=new Float32Array(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}},{}],357:[function(_dereq_,module,exports){module.exports=function copy(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}},{}],358:[function(_dereq_,module,exports){module.exports=function create(){var out=new Float32Array(4);return out[0]=0,out[1]=0,out[2]=0,out[3]=0,out}},{}],359:[function(_dereq_,module,exports){module.exports=function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}},{}],360:[function(_dereq_,module,exports){module.exports=function divide(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out[3]=a[3]/b[3],out}},{}],361:[function(_dereq_,module,exports){module.exports=function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}},{}],362:[function(_dereq_,module,exports){module.exports=function fromValues(x,y,z,w){var out=new Float32Array(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}},{}],363:[function(_dereq_,module,exports){module.exports={create:_dereq_("./create"),clone:_dereq_("./clone"),fromValues:_dereq_("./fromValues"),copy:_dereq_("./copy"),set:_dereq_("./set"),add:_dereq_("./add"),subtract:_dereq_("./subtract"),multiply:_dereq_("./multiply"),divide:_dereq_("./divide"),min:_dereq_("./min"),max:_dereq_("./max"),scale:_dereq_("./scale"),scaleAndAdd:_dereq_("./scaleAndAdd"),distance:_dereq_("./distance"),squaredDistance:_dereq_("./squaredDistance"),length:_dereq_("./length"),squaredLength:_dereq_("./squaredLength"),negate:_dereq_("./negate"),inverse:_dereq_("./inverse"),normalize:_dereq_("./normalize"),dot:_dereq_("./dot"),lerp:_dereq_("./lerp"),random:_dereq_("./random"),transformMat4:_dereq_("./transformMat4"),transformQuat:_dereq_("./transformQuat")}},{"./add":355,"./clone":356,"./copy":357,"./create":358,"./distance":359,"./divide":360,"./dot":361,"./fromValues":362,"./inverse":364,"./length":365,"./lerp":366,"./max":367,"./min":368,"./multiply":369,"./negate":370,"./normalize":371,"./random":372,"./scale":373,"./scaleAndAdd":374,"./set":375,"./squaredDistance":376,"./squaredLength":377,"./subtract":378,"./transformMat4":379,"./transformQuat":380}],364:[function(_dereq_,module,exports){module.exports=function inverse(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out[3]=1/a[3],out}},{}],365:[function(_dereq_,module,exports){module.exports=function length(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}},{}],366:[function(_dereq_,module,exports){module.exports=function lerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=aw+t*(b[3]-aw),out}},{}],367:[function(_dereq_,module,exports){module.exports=function max(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3]),out}},{}],368:[function(_dereq_,module,exports){module.exports=function min(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3]),out}},{}],369:[function(_dereq_,module,exports){module.exports=function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3],out}},{}],370:[function(_dereq_,module,exports){module.exports=function negate(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=-a[3],out}},{}],371:[function(_dereq_,module,exports){module.exports=function normalize(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;len>0&&(len=1/Math.sqrt(len),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=w*len);return out}},{}],372:[function(_dereq_,module,exports){var vecNormalize=_dereq_("./normalize"),vecScale=_dereq_("./scale");module.exports=function random(out,scale){return scale=scale||1,out[0]=Math.random(),out[1]=Math.random(),out[2]=Math.random(),out[3]=Math.random(),vecNormalize(out,out),vecScale(out,out,scale),out}},{"./normalize":371,"./scale":373}],373:[function(_dereq_,module,exports){module.exports=function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out}},{}],374:[function(_dereq_,module,exports){module.exports=function scaleAndAdd(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out}},{}],375:[function(_dereq_,module,exports){module.exports=function set(out,x,y,z,w){return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}},{}],376:[function(_dereq_,module,exports){module.exports=function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w}},{}],377:[function(_dereq_,module,exports){module.exports=function squaredLength(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w}},{}],378:[function(_dereq_,module,exports){module.exports=function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}},{}],379:[function(_dereq_,module,exports){module.exports=function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}},{}],380:[function(_dereq_,module,exports){module.exports=function transformQuat(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out[3]=a[3],out}},{}],381:[function(_dereq_,module,exports){module.exports=function decodeFloat(x,y,z,w){return UINT8_VIEW[0]=w,UINT8_VIEW[1]=z,UINT8_VIEW[2]=y,UINT8_VIEW[3]=x,FLOAT_VIEW[0]};var UINT8_VIEW=new Uint8Array(4),FLOAT_VIEW=new Float32Array(UINT8_VIEW.buffer)},{}],382:[function(_dereq_,module,exports){var tokenize=_dereq_("glsl-tokenizer"),atob=_dereq_("atob-lite");module.exports=function getName(src){for(var tokens=Array.isArray(src)?src:tokenize(src),i=0;i<tokens.length;i++){var token=tokens[i];if("preprocessor"===token.type){var match=token.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(match&&match[2]){var b64=match[1],name=match[2];return(b64?atob(name):name).trim()}}}}},{"atob-lite":59,"glsl-tokenizer":389}],383:[function(_dereq_,module,exports){module.exports=function tokenize(opt){var c,last,len,i=0,total=0,mode=NORMAL,content=[],tokens=[],line=1,col=0,start=0,isnum=!1,isoperator=!1,input="",allBuiltins=builtins100,allLiterals=literals100;"300 es"===(opt=opt||{}).version&&(allBuiltins=builtins300es,allLiterals=literals300es);return function(data){return tokens=[],null!==data?function write(chunk){var last;i=0,len=(input+=chunk).length;for(;c=input[i],i<len;){switch(last=i,mode){case BLOCK_COMMENT:i=block_comment();break;case LINE_COMMENT:case PREPROCESSOR:i=preprocessor();break;case OPERATOR:i=operator();break;case INTEGER:i=integer();break;case HEX:i=hex();break;case FLOAT:i=decimal();break;case TOKEN:i=readtoken();break;case WHITESPACE:i=whitespace();break;case NORMAL:i=normal()}if(last!==i)switch(input[last]){case"\n":col=0,++line;break;default:++col}}return total+=i,input=input.slice(i),tokens}(data.replace?data.replace(/\r\n/g,"\n"):data):function end(chunk){content.length&&token(content.join(""));return mode=EOF,token("(eof)"),tokens}()};function token(data){data.length&&tokens.push({type:map[mode],data:data,position:start,line:line,column:col})}function normal(){return content=content.length?[]:content,"/"===last&&"*"===c?(start=total+i-1,mode=BLOCK_COMMENT,last=c,i+1):"/"===last&&"/"===c?(start=total+i-1,mode=LINE_COMMENT,last=c,i+1):"#"===c?(mode=PREPROCESSOR,start=total+i,i):/\s/.test(c)?(mode=WHITESPACE,start=total+i,i):(isnum=/\d/.test(c),isoperator=/[^\w_]/.test(c),start=total+i,mode=isnum?INTEGER:isoperator?OPERATOR:TOKEN,i)}function whitespace(){return/[^\s]/g.test(c)?(token(content.join("")),mode=NORMAL,i):(content.push(c),last=c,i+1)}function preprocessor(){return"\r"!==c&&"\n"!==c||"\\"===last?(content.push(c),last=c,i+1):(token(content.join("")),mode=NORMAL,i)}function block_comment(){return"/"===c&&"*"===last?(content.push(c),token(content.join("")),mode=NORMAL,i+1):(content.push(c),last=c,i+1)}function operator(){if("."===last&&/\d/.test(c))return mode=FLOAT,i;if("/"===last&&"*"===c)return mode=BLOCK_COMMENT,i;if("/"===last&&"/"===c)return mode=LINE_COMMENT,i;if("."===c&&content.length){for(;determine_operator(content););return mode=FLOAT,i}if(";"===c||")"===c||"("===c){if(content.length)for(;determine_operator(content););return token(c),mode=NORMAL,i+1}var is_composite_operator=2===content.length&&"="!==c;if(/[\w_\d\s]/.test(c)||is_composite_operator){for(;determine_operator(content););return mode=NORMAL,i}return content.push(c),last=c,i+1}function determine_operator(buf){for(var idx,res,j=0;;){if(idx=operators.indexOf(buf.slice(0,buf.length+j).join("")),res=operators[idx],-1===idx){if(j--+buf.length>0)continue;res=buf.slice(0,1).join("")}return token(res),start+=res.length,(content=content.slice(res.length)).length}}function hex(){return/[^a-fA-F0-9]/.test(c)?(token(content.join("")),mode=NORMAL,i):(content.push(c),last=c,i+1)}function integer(){return"."===c?(content.push(c),mode=FLOAT,last=c,i+1):/[eE]/.test(c)?(content.push(c),mode=FLOAT,last=c,i+1):"x"===c&&1===content.length&&"0"===content[0]?(mode=HEX,content.push(c),last=c,i+1):/[^\d]/.test(c)?(token(content.join("")),mode=NORMAL,i):(content.push(c),last=c,i+1)}function decimal(){return"f"===c&&(content.push(c),last=c,i+=1),/[eE]/.test(c)?(content.push(c),last=c,i+1):"-"===c&&/[eE]/.test(last)?(content.push(c),last=c,i+1):/[^\d]/.test(c)?(token(content.join("")),mode=NORMAL,i):(content.push(c),last=c,i+1)}function readtoken(){if(/[^\d\w_]/.test(c)){var contentstr=content.join("");return mode=allLiterals.indexOf(contentstr)>-1?KEYWORD:allBuiltins.indexOf(contentstr)>-1?BUILTIN:IDENT,token(content.join("")),mode=NORMAL,i}return content.push(c),last=c,i+1}};var literals100=_dereq_("./lib/literals"),operators=_dereq_("./lib/operators"),builtins100=_dereq_("./lib/builtins"),literals300es=_dereq_("./lib/literals-300es"),builtins300es=_dereq_("./lib/builtins-300es"),NORMAL=999,TOKEN=9999,BLOCK_COMMENT=0,LINE_COMMENT=1,PREPROCESSOR=2,OPERATOR=3,INTEGER=4,FLOAT=5,IDENT=6,BUILTIN=7,KEYWORD=8,WHITESPACE=9,EOF=10,HEX=11,map=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},{"./lib/builtins":385,"./lib/builtins-300es":384,"./lib/literals":387,"./lib/literals-300es":386,"./lib/operators":388}],384:[function(_dereq_,module,exports){var v100=_dereq_("./builtins");v100=v100.slice().filter(function(b){return!/^(gl\_|texture)/.test(b)}),module.exports=v100.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},{"./builtins":385}],385:[function(_dereq_,module,exports){module.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},{}],386:[function(_dereq_,module,exports){var v100=_dereq_("./literals");module.exports=v100.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},{"./literals":387}],387:[function(_dereq_,module,exports){module.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],388:[function(_dereq_,module,exports){module.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],389:[function(_dereq_,module,exports){var tokenize=_dereq_("./index");module.exports=function tokenizeString(str,opt){var generator=tokenize(opt),tokens=[];return tokens=(tokens=tokens.concat(generator(str))).concat(generator(null))}},{"./index":383}],390:[function(_dereq_,module,exports){module.exports=function(strings){"string"==typeof strings&&(strings=[strings]);for(var exprs=[].slice.call(arguments,1),parts=[],i=0;i<strings.length-1;i++)parts.push(strings[i],exprs[i]||"");return parts.push(strings[i]),parts.join("")}},{}],391:[function(_dereq_,module,exports){(function(global){"use strict";var hasHover,isBrowser=_dereq_("is-browser");hasHover="function"==typeof global.matchMedia?!global.matchMedia("(hover: none)").matches:isBrowser,module.exports=hasHover}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"is-browser":398}],392:[function(_dereq_,module,exports){"use strict";var isBrowser=_dereq_("is-browser");module.exports=isBrowser&&function detect(){var supported=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supported=!0}});window.addEventListener("test",null,opts),window.removeEventListener("test",null,opts)}catch(e){supported=!1}return supported}()},{"is-browser":398}],393:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],394:[function(_dereq_,module,exports){"use strict";module.exports=function incrementalConvexHull(points,randomSearch){var n=points.length;if(0===n)throw new Error("Must have at least d+1 points");var d=points[0].length;if(n<=d)throw new Error("Must input at least d+1 points");var initialSimplex=points.slice(0,d+1),o=orient.apply(void 0,initialSimplex);if(0===o)throw new Error("Input not in general position");for(var initialCoords=new Array(d+1),i=0;i<=d;++i)initialCoords[i]=i;o<0&&(initialCoords[0]=1,initialCoords[1]=0);for(var initialCell=new Simplex(initialCoords,new Array(d+1),!1),boundary=initialCell.adjacent,list=new Array(d+2),i=0;i<=d;++i){for(var verts=initialCoords.slice(),j=0;j<=d;++j)j===i&&(verts[j]=-1);var t=verts[0];verts[0]=verts[1],verts[1]=t;var cell=new Simplex(verts,new Array(d+1),!0);boundary[i]=cell,list[i]=cell}list[d+1]=initialCell;for(var i=0;i<=d;++i)for(var verts=boundary[i].vertices,adj=boundary[i].adjacent,j=0;j<=d;++j){var v=verts[j];if(v<0)adj[j]=initialCell;else for(var k=0;k<=d;++k)boundary[k].vertices.indexOf(v)<0&&(adj[j]=boundary[k])}for(var triangles=new Triangulation(d,initialSimplex,list),useRandom=!!randomSearch,i=d+1;i<n;++i)triangles.insert(points[i],useRandom);return triangles.boundary()};var orient=_dereq_("robust-orientation"),compareCell=_dereq_("simplicial-complex").compareCells;function Simplex(vertices,adjacent,boundary){this.vertices=vertices,this.adjacent=adjacent,this.boundary=boundary,this.lastVisited=-1}function GlueFacet(vertices,cell,index){this.vertices=vertices,this.cell=cell,this.index=index}function compareGlue(a,b){return compareCell(a.vertices,b.vertices)}Simplex.prototype.flip=function(){var t=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=t;var u=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=u};var BAKED=[];function Triangulation(dimension,vertices,simplices){this.dimension=dimension,this.vertices=vertices,this.simplices=simplices,this.interior=simplices.filter(function(c){return!c.boundary}),this.tuple=new Array(dimension+1);for(var i=0;i<=dimension;++i)this.tuple[i]=this.vertices[i];var o=BAKED[dimension];o||(o=BAKED[dimension]=function bakeOrient(d){for(var code=["function orient(){var tuple=this.tuple;return test("],i=0;i<=d;++i)i>0&&code.push(","),code.push("tuple[",i,"]");code.push(")}return orient");var proc=new Function("test",code.join("")),test=orient[d+1];return test||(test=orient),proc(test)}(dimension)),this.orient=o}var proto=Triangulation.prototype;proto.handleBoundaryDegeneracy=function(cell,point){var d=this.dimension,n=this.vertices.length-1,tuple=this.tuple,verts=this.vertices,toVisit=[cell];for(cell.lastVisited=-n;toVisit.length>0;){(cell=toVisit.pop()).vertices;for(var cellAdj=cell.adjacent,i=0;i<=d;++i){var neighbor=cellAdj[i];if(neighbor.boundary&&!(neighbor.lastVisited<=-n)){for(var nv=neighbor.vertices,j=0;j<=d;++j){var vv=nv[j];tuple[j]=vv<0?point:verts[vv]}var o=this.orient();if(o>0)return neighbor;neighbor.lastVisited=-n,0===o&&toVisit.push(neighbor)}}}return null},proto.walk=function(point,random){var n=this.vertices.length-1,d=this.dimension,verts=this.vertices,tuple=this.tuple,initIndex=random?this.interior.length*Math.random()|0:this.interior.length-1,cell=this.interior[initIndex];outerLoop:for(;!cell.boundary;){for(var cellVerts=cell.vertices,cellAdj=cell.adjacent,i=0;i<=d;++i)tuple[i]=verts[cellVerts[i]];cell.lastVisited=n;for(i=0;i<=d;++i){var neighbor=cellAdj[i];if(!(neighbor.lastVisited>=n)){var prev=tuple[i];tuple[i]=point;var o=this.orient();if(tuple[i]=prev,o<0){cell=neighbor;continue outerLoop}neighbor.boundary?neighbor.lastVisited=-n:neighbor.lastVisited=n}}return}return cell},proto.addPeaks=function(point,cell){var n=this.vertices.length-1,d=this.dimension,verts=this.vertices,tuple=this.tuple,interior=this.interior,simplices=this.simplices,tovisit=[cell];cell.lastVisited=n,cell.vertices[cell.vertices.indexOf(-1)]=n,cell.boundary=!1,interior.push(cell);for(var glueFacets=[];tovisit.length>0;){var cellVerts=(cell=tovisit.pop()).vertices,cellAdj=cell.adjacent,indexOfN=cellVerts.indexOf(n);if(!(indexOfN<0))for(var i=0;i<=d;++i)if(i!==indexOfN){var neighbor=cellAdj[i];if(neighbor.boundary&&!(neighbor.lastVisited>=n)){var nv=neighbor.vertices;if(neighbor.lastVisited!==-n){for(var indexOfNeg1=0,j=0;j<=d;++j)nv[j]<0?(indexOfNeg1=j,tuple[j]=point):tuple[j]=verts[nv[j]];if(this.orient()>0){nv[indexOfNeg1]=n,neighbor.boundary=!1,interior.push(neighbor),tovisit.push(neighbor),neighbor.lastVisited=n;continue}neighbor.lastVisited=-n}var na=neighbor.adjacent,vverts=cellVerts.slice(),vadj=cellAdj.slice(),ncell=new Simplex(vverts,vadj,!0);simplices.push(ncell);var opposite=na.indexOf(cell);if(!(opposite<0)){na[opposite]=ncell,vadj[indexOfN]=neighbor,vverts[i]=-1,vadj[i]=cell,cellAdj[i]=ncell,ncell.flip();for(j=0;j<=d;++j){var uu=vverts[j];if(!(uu<0||uu===n)){for(var nface=new Array(d-1),nptr=0,k=0;k<=d;++k){var vv=vverts[k];vv<0||k===j||(nface[nptr++]=vv)}glueFacets.push(new GlueFacet(nface,ncell,j))}}}}}}glueFacets.sort(compareGlue);for(i=0;i+1<glueFacets.length;i+=2){var a=glueFacets[i],b=glueFacets[i+1],ai=a.index,bi=b.index;ai<0||bi<0||(a.cell.adjacent[a.index]=b.cell,b.cell.adjacent[b.index]=a.cell)}},proto.insert=function(point,random){var verts=this.vertices;verts.push(point);var cell=this.walk(point,random);if(cell){for(var d=this.dimension,tuple=this.tuple,i=0;i<=d;++i){var vv=cell.vertices[i];tuple[i]=vv<0?point:verts[vv]}var o=this.orient(tuple);o<0||(0!==o||(cell=this.handleBoundaryDegeneracy(cell,point)))&&this.addPeaks(point,cell)}},proto.boundary=function(){for(var d=this.dimension,boundary=[],cells=this.simplices,nc=cells.length,i=0;i<nc;++i){var c=cells[i];if(c.boundary){for(var bcell=new Array(d),cv=c.vertices,ptr=0,parity=0,j=0;j<=d;++j)cv[j]>=0?bcell[ptr++]=cv[j]:parity=1&j;if(parity===(1&d)){var t=bcell[0];bcell[0]=bcell[1],bcell[1]=t}boundary.push(bcell)}}return boundary}},{"robust-orientation":483,"simplicial-complex":493}],395:[function(_dereq_,module,exports){"use strict";var bounds=_dereq_("binary-search-bounds"),NOT_FOUND=0,SUCCESS=1;function IntervalTreeNode(mid,left,right,leftPoints,rightPoints){this.mid=mid,this.left=left,this.right=right,this.leftPoints=leftPoints,this.rightPoints=rightPoints,this.count=(left?left.count:0)+(right?right.count:0)+leftPoints.length}module.exports=function createWrapper(intervals){if(!intervals||0===intervals.length)return new IntervalTree(null);return new IntervalTree(createIntervalTree(intervals))};var proto=IntervalTreeNode.prototype;function copy(a,b){a.mid=b.mid,a.left=b.left,a.right=b.right,a.leftPoints=b.leftPoints,a.rightPoints=b.rightPoints,a.count=b.count}function rebuild(node,intervals){var ntree=createIntervalTree(intervals);node.mid=ntree.mid,node.left=ntree.left,node.right=ntree.right,node.leftPoints=ntree.leftPoints,node.rightPoints=ntree.rightPoints,node.count=ntree.count}function rebuildWithInterval(node,interval){var intervals=node.intervals([]);intervals.push(interval),rebuild(node,intervals)}function rebuildWithoutInterval(node,interval){var intervals=node.intervals([]),idx=intervals.indexOf(interval);return idx<0?NOT_FOUND:(intervals.splice(idx,1),rebuild(node,intervals),SUCCESS)}function reportLeftRange(arr,hi,cb){for(var i=0;i<arr.length&&arr[i][0]<=hi;++i){var r=cb(arr[i]);if(r)return r}}function reportRightRange(arr,lo,cb){for(var i=arr.length-1;i>=0&&arr[i][1]>=lo;--i){var r=cb(arr[i]);if(r)return r}}function reportRange(arr,cb){for(var i=0;i<arr.length;++i){var r=cb(arr[i]);if(r)return r}}function compareNumbers(a,b){return a-b}function compareBegin(a,b){var d=a[0]-b[0];return d||a[1]-b[1]}function compareEnd(a,b){var d=a[1]-b[1];return d||a[0]-b[0]}function createIntervalTree(intervals){if(0===intervals.length)return null;for(var pts=[],i=0;i<intervals.length;++i)pts.push(intervals[i][0],intervals[i][1]);pts.sort(compareNumbers);var mid=pts[pts.length>>1],leftIntervals=[],rightIntervals=[],centerIntervals=[];for(i=0;i<intervals.length;++i){var s=intervals[i];s[1]<mid?leftIntervals.push(s):mid<s[0]?rightIntervals.push(s):centerIntervals.push(s)}var leftPoints=centerIntervals,rightPoints=centerIntervals.slice();return leftPoints.sort(compareBegin),rightPoints.sort(compareEnd),new IntervalTreeNode(mid,createIntervalTree(leftIntervals),createIntervalTree(rightIntervals),leftPoints,rightPoints)}function IntervalTree(root){this.root=root}proto.intervals=function(result){return result.push.apply(result,this.leftPoints),this.left&&this.left.intervals(result),this.right&&this.right.intervals(result),result},proto.insert=function(interval){var weight=this.count-this.leftPoints.length;if(this.count+=1,interval[1]<this.mid)this.left?4*(this.left.count+1)>3*(weight+1)?rebuildWithInterval(this,interval):this.left.insert(interval):this.left=createIntervalTree([interval]);else if(interval[0]>this.mid)this.right?4*(this.right.count+1)>3*(weight+1)?rebuildWithInterval(this,interval):this.right.insert(interval):this.right=createIntervalTree([interval]);else{var l=bounds.ge(this.leftPoints,interval,compareBegin),r=bounds.ge(this.rightPoints,interval,compareEnd);this.leftPoints.splice(l,0,interval),this.rightPoints.splice(r,0,interval)}},proto.remove=function(interval){var weight=this.count-this.leftPoints;if(interval[1]<this.mid){return this.left?4*(this.right?this.right.count:0)>3*(weight-1)?rebuildWithoutInterval(this,interval):2===(r=this.left.remove(interval))?(this.left=null,this.count-=1,SUCCESS):(r===SUCCESS&&(this.count-=1),r):NOT_FOUND}else{if(!(interval[0]>this.mid)){if(1===this.count)return this.leftPoints[0]===interval?2:NOT_FOUND;if(1===this.leftPoints.length&&this.leftPoints[0]===interval){if(this.left&&this.right){for(var p=this,n=this.left;n.right;)p=n,n=n.right;if(p===this)n.right=this.right;else{var l=this.left;r=this.right;p.count-=n.count,p.right=n.left,n.left=l,n.right=r}copy(this,n),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?copy(this,this.left):copy(this,this.right);return SUCCESS}for(l=bounds.ge(this.leftPoints,interval,compareBegin);l<this.leftPoints.length&&this.leftPoints[l][0]===interval[0];++l)if(this.leftPoints[l]===interval){this.count-=1,this.leftPoints.splice(l,1);for(r=bounds.ge(this.rightPoints,interval,compareEnd);r<this.rightPoints.length&&this.rightPoints[r][1]===interval[1];++r)if(this.rightPoints[r]===interval)return this.rightPoints.splice(r,1),SUCCESS}return NOT_FOUND}return this.right?4*(this.left?this.left.count:0)>3*(weight-1)?rebuildWithoutInterval(this,interval):2===(r=this.right.remove(interval))?(this.right=null,this.count-=1,SUCCESS):(r===SUCCESS&&(this.count-=1),r):NOT_FOUND;var r}},proto.queryPoint=function(x,cb){if(x<this.mid){if(this.left)if(r=this.left.queryPoint(x,cb))return r;return reportLeftRange(this.leftPoints,x,cb)}if(x>this.mid){var r;if(this.right)if(r=this.right.queryPoint(x,cb))return r;return reportRightRange(this.rightPoints,x,cb)}return reportRange(this.leftPoints,cb)},proto.queryInterval=function(lo,hi,cb){var r;if(lo<this.mid&&this.left&&(r=this.left.queryInterval(lo,hi,cb)))return r;if(hi>this.mid&&this.right&&(r=this.right.queryInterval(lo,hi,cb)))return r;return hi<this.mid?reportLeftRange(this.leftPoints,hi,cb):lo>this.mid?reportRightRange(this.rightPoints,lo,cb):reportRange(this.leftPoints,cb)};var tproto=IntervalTree.prototype;tproto.insert=function(interval){this.root?this.root.insert(interval):this.root=new IntervalTreeNode(interval[0],null,null,[interval],[interval])},tproto.remove=function(interval){if(this.root){var r=this.root.remove(interval);return 2===r&&(this.root=null),r!==NOT_FOUND}return!1},tproto.queryPoint=function(p,cb){if(this.root)return this.root.queryPoint(p,cb)},tproto.queryInterval=function(lo,hi,cb){if(lo<=hi&&this.root)return this.root.queryInterval(lo,hi,cb)},Object.defineProperty(tproto,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(tproto,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}})},{"binary-search-bounds":78}],396:[function(_dereq_,module,exports){"use strict";module.exports=function invertPermutation(pi,result){result=result||new Array(pi.length);for(var i=0;i<pi.length;++i)result[pi[i]]=i;return result}},{}],397:[function(_dereq_,module,exports){"use strict";module.exports=function iota(n){for(var result=new Array(n),i=0;i<n;++i)result[i]=i;return result}},{}],398:[function(_dereq_,module,exports){module.exports=!0},{}],399:[function(_dereq_,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)}},{}],400:[function(_dereq_,module,exports){"use strict";module.exports="undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion))},{}],401:[function(_dereq_,module,exports){module.exports=function isMobile(ua){ua||"undefined"==typeof navigator||(ua=navigator.userAgent);ua&&ua.headers&&"string"==typeof ua.headers["user-agent"]&&(ua=ua.headers["user-agent"]);return"string"==typeof ua&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ua.substr(0,4)))}},{}],402:[function(_dereq_,module,exports){"use strict";module.exports=function(x){var type=typeof x;return null!==x&&("object"===type||"function"===type)}},{}],403:[function(_dereq_,module,exports){"use strict";var toString=Object.prototype.toString;module.exports=function(x){var prototype;return"[object Object]"===toString.call(x)&&(null===(prototype=Object.getPrototypeOf(x))||prototype===Object.getPrototypeOf({}))}},{}],404:[function(_dereq_,module,exports){"use strict";module.exports=function isPath(str){return"string"==typeof str&&(str=str.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(str)&&/[\dz]$/i.test(str)&&str.length>4))}},{}],405:[function(_dereq_,module,exports){module.exports=function lerp(v0,v1,t){return v0*(1-t)+v1*t}},{}],406:[function(_dereq_,module,exports){(function(global){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():global.mapboxgl=factory()}(this,function(){"use strict";var shared,worker,mapboxgl;function define(_,chunk){if(shared)if(worker){var workerBundleString="var sharedChunk = {}; ("+shared+")(sharedChunk); ("+worker+")(sharedChunk);",sharedChunk={};shared(sharedChunk),(mapboxgl=chunk(sharedChunk)).workerUrl=window.URL.createObjectURL(new Blob([workerBundleString],{type:"text/javascript"}))}else worker=chunk;else shared=chunk}return define(0,function(t){var e="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var i=o;function o(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}o.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},o.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},o.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},o.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},o.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var a=function(t,e,r){this.column=t,this.row=e,this.zoom=r};a.prototype.clone=function(){return new a(this.column,this.row,this.zoom)},a.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},a.prototype.sub=function(t){return this.clone()._sub(t)},a.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},a.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this};var s=u;function u(t,e){this.x=t,this.y=e}function l(t,e,r,n){var o=new i(t,e,r,n);return function(t){return o.solve(t)}}u.prototype={clone:function(){return new u(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(t){return t instanceof u?t:Array.isArray(t)?new u(t[0],t[1]):t};var p=l(.25,.1,.25,1);function c(t,e,r){return Math.min(r,Math.max(e,t))}function h(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}var f=1;function y(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function d(t,e){return-1!==t.indexOf(e,t.length-e.length)}function v(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function m(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function g(t){return Array.isArray(t)?t.map(g):"object"==typeof t&&t?v(t,g):t}var x={};function b(t){x[t]||("undefined"!=typeof console&&console.warn(t),x[t]=!0)}function w(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function _(t){for(var e=0,r=0,n=t.length,i=n-1,o=void 0,a=void 0;r<n;i=r++)o=t[r],e+=((a=t[i]).x-o.x)*(o.y+a.y);return e}var A={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(A);var k=function(t){function e(e,r,n){t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function z(t){var e=new self.XMLHttpRequest;for(var r in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(r,t.headers[r]);return e.withCredentials="include"===t.credentials,e}var S=function(t,e){var r=z(t);return r.responseType="arraybuffer",r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){var n=r.response;if(0===n.byteLength&&200===r.status)return e(new Error("http status 200 returned without content."));r.status>=200&&r.status<300&&r.response?e(null,{data:n,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")}):e(new k(r.statusText,r.status,t.url))},r.send(),r};function M(t,e,r){r[t]=r[t]||[],r[t].push(e)}function V(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}var B=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},C=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",h({error:e},r))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(B),I=function(){};I.prototype.on=function(t,e){return this._listeners=this._listeners||{},M(t,e,this._listeners),this},I.prototype.off=function(t,e){return V(t,e,this._listeners),V(t,e,this._oneTimeListeners),this},I.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},M(t,e,this._oneTimeListeners),this},I.prototype.fire=function(t){"string"==typeof t&&(t=new B(t,arguments[1]||{}));var e=t.type;if(this.listens(e)){t.target=this;for(var r=0,n=this._listeners&&this._listeners[e]?this._listeners[e].slice():[];r<n.length;r+=1)n[r].call(this,t);for(var i=0,o=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[];i<o.length;i+=1){var a=o[i];V(e,a,this._oneTimeListeners),a.call(this,t)}var s=this._eventedParent;s&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(t))}else d(e,"error")?console.error(t&&t.error||t||"Empty error event"):d(e,"warning")&&console.warn(t&&t.warning||t||"Empty warning event");return this},I.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},I.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var E={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},lineMetrics:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,units:"factor of the original icon size",requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"icon-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"]},"icon-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Heatmap"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1,"zoom-function":!0,"property-function":!1,function:"piecewise-constant"},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"line-gradient":{type:"color",function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}]}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"heatmap-weight":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!1},"heatmap-intensity":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!1,units:"milliseconds"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,function:"interpolated","zoom-function":!0,transition:!1},"hillshade-illumination-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"hillshade-shadow-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-accent-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}}},F=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function P(t){var e=t.key,r=t.value;return r?[new F(e,r,"constants have been deprecated as of v8")]:[]}function T(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}function O(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function L(t){return Array.isArray(t)?t.map(L):O(t)}var j=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),q=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r],o=i[0],a=i[1];this.bindings[o]=a}};q.prototype.concat=function(t){return new q(this,t)},q.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},q.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var R={kind:"null"},U={kind:"number"},D={kind:"string"},N={kind:"boolean"},Z={kind:"color"},K={kind:"object"},J={kind:"value"},$={kind:"collator"};function H(t,e){return{kind:"array",itemType:t,N:e}}function X(t){if("array"===t.kind){var e=X(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var G=[R,U,D,N,Z,K,H(J)];function Y(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&!Y(t.itemType,e.itemType)&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=G;r<n.length;r+=1)if(!Y(n[r],e))return null}return"Expected "+X(t)+" but found "+X(e)+" instead."}var W=n(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100*255):n(parseInt(t))}function a(t){return"%"===t[t.length-1]?i(parseFloat(t)/100):i(parseFloat(t))}function s(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in r)return r[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=i.indexOf("("),l=i.indexOf(")");if(-1!==u&&l+1===i.length){var p=i.substr(0,u),c=i.substr(u+1,l-(u+1)).split(","),h=1;switch(p){case"rgba":if(4!==c.length)return null;h=a(c.pop());case"rgb":return 3!==c.length?null:[o(c[0]),o(c[1]),o(c[2]),h];case"hsla":if(4!==c.length)return null;h=a(c.pop());case"hsl":if(3!==c.length)return null;var f=(parseFloat(c[0])%360+360)%360/360,y=a(c[1]),d=a(c[2]),v=d<=.5?d*(y+1):d+y-d*y,m=2*d-v;return[n(255*s(m,v,f+1/3)),n(255*s(m,v,f)),n(255*s(m,v,f-1/3)),h];default:return null}}return null}}catch(t){}}).parseCSSColor,Q=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};Q.parse=function(t){if(t){if(t instanceof Q)return t;if("string"==typeof t){var e=W(t);if(e)return new Q(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Q.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],n=t[2],i=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(n)+","+i+")"},Q.prototype.toArray=function(){var t=this.r,e=this.g,r=this.b,n=this.a;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*r/n,n]},Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0);var tt=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};tt.prototype.compare=function(t,e){return this.collator.compare(t,e)},tt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var et=function(t,e,r){this.type=$,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function rt(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function nt(t){if(null===t)return R;if("string"==typeof t)return D;if("boolean"==typeof t)return N;if("number"==typeof t)return U;if(t instanceof Q)return Z;if(t instanceof tt)return $;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=nt(i[n]);if(e){if(e===o)continue;e=J;break}e=o}return H(e||J,r)}return K}et.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,N);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,N);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,D))?null:new et(n,i,o)},et.prototype.evaluate=function(t){return new tt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},et.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},et.prototype.possibleOutputs=function(){return[void 0]},et.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var it=function(t,e){this.type=t,this.value=e};it.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Q)return!0;if(e instanceof tt)return!0;if(Array.isArray(e)){for(var r=0,n=e;r<n.length;r+=1)if(!t(n[r]))return!1;return!0}if("object"==typeof e){for(var i in e)if(!t(e[i]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var r=t[1],n=nt(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new it(n,r)},it.prototype.evaluate=function(){return this.value},it.prototype.eachChild=function(){},it.prototype.possibleOutputs=function(){return[this.value]},it.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Q?["rgba"].concat(this.value.toArray()):this.value};var ot=function(t){this.name="ExpressionEvaluationError",this.message=t};ot.prototype.toJSON=function(){return this.message};var at={string:D,number:U,boolean:N,object:K},st=function(t,e){this.type=t,this.args=e};st.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var r=t[0],n=at[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,J);if(!a)return null;i.push(a)}return new st(n,i)},st.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Y(this.type,nt(r)))return r;if(e===this.args.length-1)throw new ot("Expected value to be of type "+X(this.type)+", but found "+X(nt(r))+" instead.")}return null},st.prototype.eachChild=function(t){this.args.forEach(t)},st.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},st.prototype.serialize=function(){return[this.type.kind].concat(this.args.map(function(t){return t.serialize()}))};var ut={string:D,number:U,boolean:N},lt=function(t,e){this.type=t,this.input=e};lt.parse=function(t,e){if(t.length<2||t.length>4)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var r,n;if(t.length>2){var i=t[1];if("string"!=typeof i||!(i in ut))return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=ut[i]}else r=J;if(t.length>3){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);n=t[2]}var o=H(r,n),a=e.parse(t[t.length-1],t.length-1,J);return a?new lt(o,a):null},lt.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(Y(this.type,nt(e)))throw new ot("Expected value to be of type "+X(this.type)+", but found "+X(nt(e))+" instead.");return e},lt.prototype.eachChild=function(t){t(this.input)},lt.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},lt.prototype.serialize=function(){var t=["array"],e=this.type.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){t.push(e.kind);var r=this.type.N;"number"==typeof r&&t.push(r)}return t.push(this.input.serialize()),t};var pt={"to-number":U,"to-color":Z},ct=function(t,e){this.type=t,this.args=e};ct.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var r=t[0],n=pt[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,J);if(!a)return null;i.push(a)}return new ct(n,i)},ct.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1)if(r=null,"string"==typeof(e=i[n].evaluate(t))){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":rt(e[0],e[1],e[2],e[3])))return new Q(e[0]/255,e[1]/255,e[2]/255,e[3]);throw new ot(r||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var a=null,s=0,u=this.args;s<u.length;s+=1)if(null!==(a=u[s].evaluate(t))){var l=Number(a);if(!isNaN(l))return l}throw new ot("Could not convert "+JSON.stringify(a)+" to number.")},ct.prototype.eachChild=function(t){this.args.forEach(t)},ct.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},ct.prototype.serialize=function(){var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var ht=["Unknown","Point","LineString","Polygon"],ft=function(){this._parseColorCache={}};ft.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ft.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ht[this.feature.type]:this.feature.type:null},ft.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ft.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Q.parse(t)),e};var yt=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};function dt(t){if(t instanceof yt){if("get"===t.name&&1===t.args.length)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!dt(t)&&(e=!1)}),e}function vt(t,e){if(t instanceof yt&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!vt(t,e)&&(r=!1)}),r}yt.prototype.evaluate=function(t){return this._evaluate(t,this.args)},yt.prototype.eachChild=function(t){this.args.forEach(t)},yt.prototype.possibleOutputs=function(){return[void 0]},yt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},yt.parse=function(t,e){var r=t[0],n=yt.definitions[r];if(!n)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var i=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),s=[],u=1;u<t.length;u++){var l=t[u],p=void 0;if(1===a.length){var c=a[0][0];p=Array.isArray(c)?c[u-1]:c.type}var h=e.parse(l,1+s.length,p);if(!h)return null;s.push(h)}for(var f=null,y=0,d=a;y<d.length;y+=1){var v=d[y],m=v[0],g=v[1];if(f=new gt(e.registry,e.path,null,e.scope),Array.isArray(m)&&m.length!==s.length)f.error("Expected "+m.length+" arguments, but found "+s.length+" instead.");else{for(var x=0;x<s.length;x++){var b=Array.isArray(m)?m[x]:m.type,w=s[x];f.concat(x+1).checkSubtype(b,w.type)}if(0===f.errors.length)return new yt(r,i,g,s)}}if(1===a.length)e.errors.push.apply(e.errors,f.errors);else{var _=(a.length?a:o).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(X).join(", ")+")":"("+X(e.type)+"...)"}).join(" | "),A=s.map(function(t){return X(t.type)}).join(", ");e.error("Expected arguments of type "+_+", but found ("+A+") instead.")}return null},yt.register=function(t,e){for(var r in yt.definitions=e,e)t[r]=yt};var mt=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};mt.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new mt(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},mt.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},mt.prototype.eachChild=function(){},mt.prototype.possibleOutputs=function(){return[void 0]},mt.prototype.serialize=function(){return["var",this.name]};var gt=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new q),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=r};function xt(t,e){for(var r,n,i=0,o=t.length-1,a=0;i<=o;){if(r=t[a=Math.floor((i+o)/2)],n=t[a+1],e===r||e>r&&e<n)return a;if(r<e)i=a+1;else{if(!(r>e))throw new ot("Input is not a number.");o=a-1}}return Math.max(a-1,0)}gt.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},gt.prototype._parse=function(t,e){if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var n=this.registry[r];if(n){var i=n.parse(t,this);if(!i)return null;if(this.expectedType){var o=this.expectedType,a=i.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind||"value"!==a.kind)if("array"===o.kind&&"value"===a.kind)e.omitTypeAnnotations||(i=new lt(o,i));else if("color"!==o.kind||"value"!==a.kind&&"string"!==a.kind){if(this.checkSubtype(this.expectedType,i.type))return null}else e.omitTypeAnnotations||(i=new ct(o,[i]));else e.omitTypeAnnotations||(i=new st(o,[i]))}if(!(i instanceof it)&&function t(e){if(e instanceof mt)return t(e.boundExpression);if(e instanceof yt&&"error"===e.name)return!1;if(e instanceof et)return!1;var r=e instanceof ct||e instanceof st||e instanceof lt,n=!0;return e.eachChild(function(e){n=r?n&&t(e):n&&e instanceof it}),!!n&&(dt(e)&&vt(e,["zoom","heatmap-density","line-progress","is-supported-script"]))}(i)){var s=new ft;try{i=new it(i.type,i.evaluate(s))}catch(t){return this.error(t.message),null}}return i}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},gt.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new gt(this.registry,n,e||null,i,this.errors)},gt.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new j(n,t))},gt.prototype.checkSubtype=function(t,e){var r=Y(t,e);return r&&this.error(r),r};var bt=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};function wt(t,e,r){return t*(1-r)+e*r}bt.parse=function(t,e){var r=t[1],n=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,1,U)))return null;var i=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),n.unshift(-1/0);for(var a=0;a<n.length;a+=2){var s=n[a],u=n[a+1],l=a+1,p=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(i.length&&i[i.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var c=e.parse(u,p,o);if(!c)return null;o=o||c.type,i.push([s,c])}return new bt(o,r,i)},bt.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[xt(e,n)].evaluate(t)},bt.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},bt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},bt.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var _t=Object.freeze({number:wt,color:function(t,e,r){return new Q(wt(t.r,e.r,r),wt(t.g,e.g,r),wt(t.b,e.b,r),wt(t.a,e.a,r))},array:function(t,e,r){return t.map(function(t,n){return wt(t,e[n],r)})}}),At=function(t,e,r,n){this.type=t,this.interpolation=e,this.input=r,this.labels=[],this.outputs=[];for(var i=0,o=n;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1];this.labels.push(s),this.outputs.push(u)}};function kt(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}At.interpolationFactor=function(t,e,r,n){var o=0;if("exponential"===t.name)o=kt(e,t.base,r,n);else if("linear"===t.name)o=kt(e,1,r,n);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new i(a[0],a[1],a[2],a[3]).solve(kt(e,1,r,n))}return o},At.parse=function(t,e){var r=t[1],n=t[2],i=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var o=r[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:o}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var a=r.slice(1);if(4!==a.length||a.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:a}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,U)))return null;var s=[],u=null;e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var l=0;l<i.length;l+=2){var p=i[l],c=i[l+1],h=l+3,f=l+4;if("number"!=typeof p)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(s.length&&s[s.length-1][0]>=p)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);var y=e.parse(c,f,u);if(!y)return null;u=u||y.type,s.push([p,y])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new At(u,r,n,s):e.error("Type "+X(u)+" is not interpolatable.")},At.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=xt(e,n),a=e[o],s=e[o+1],u=At.interpolationFactor(this.interpolation,n,a,s),l=r[o].evaluate(t),p=r[o+1].evaluate(t);return _t[this.type.kind.toLowerCase()](l,p,u)},At.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},At.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},At.prototype.serialize=function(){for(var t=["interpolate","linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints),this.input.serialize()],e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t};var zt=function(t,e){this.type=t,this.args=e};zt.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],u=e.parse(s,1+i.length,r,void 0,{omitTypeAnnotations:!0});if(!u)return null;r=r||u.type,i.push(u)}var l=n&&i.some(function(t){return Y(n,t.type)});return new zt(l?J:r,i)},zt.prototype.evaluate=function(t){for(var e=null,r=0,n=this.args;r<n.length&&null===(e=n[r].evaluate(t));r+=1);return e},zt.prototype.eachChild=function(t){this.args.forEach(t)},zt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},zt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var St=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};St.prototype.evaluate=function(t){return this.result.evaluate(t)},St.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},St.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,void 0,r);return a?new St(r,a):null},St.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},St.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t.push(i,o.serialize())}return t.push(this.result.serialize()),t};var Mt=function(t,e,r){this.type=t,this.index=e,this.input=r};Mt.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,U),n=e.parse(t[2],2,H(e.expectedType||J));if(!r||!n)return null;var i=n.type;return new Mt(i.itemType,r,n)},Mt.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ot("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ot("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ot("Array index must be an integer, but found "+e+" instead.");return r[e]},Mt.prototype.eachChild=function(t){t(this.index),t(this.input)},Mt.prototype.possibleOutputs=function(){return[void 0]},Mt.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Vt=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};Vt.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var p=0,c=s;p<c.length;p+=1){var h=c[p];if("number"!=typeof h&&"string"!=typeof h)return l.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof h&&Math.floor(h)!==h)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,nt(h)))return null}else r=nt(h);if(void 0!==i[String(h)])return l.error("Branch labels must be unique.");i[String(h)]=o.length}var f=e.parse(u,a,n);if(!f)return null;n=n||f.type,o.push(f)}var y=e.parse(t[1],1,r);if(!y)return null;var d=e.parse(t[t.length-1],t.length-1,n);return d?new Vt(r,n,y,i,o,d):null},Vt.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Vt.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Vt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t},Vt.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i],s=n[t.cases[a]];void 0===s?(n[t.cases[a]]=r.length,r.push([t.cases[a],[a]])):r[s][1].push(a)}for(var u=function(e){return"number"===t.input.type.kind?Number(e):e},l=0,p=r;l<p.length;l+=1){var c=p[l],h=c[0],f=c[1];1===f.length?e.push(u(f[0])):e.push(f.map(u)),e.push(t.outputs[h].serialize())}return e.push(this.otherwise.serialize()),e};var Bt=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};function Ct(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function It(t,e){return function(){function r(t,e,r){this.type=N,this.lhs=t,this.rhs=e,this.collator=r}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=e.parse(t[1],1,J);if(!n)return null;var i=e.parse(t[2],2,J);if(!i)return null;if(!Ct(n.type)&&!Ct(i.type))return e.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+X(n.type)+", "+X(i.type)+") instead.");if(n.type.kind!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return e.error("Cannot compare "+X(n.type)+" and "+X(i.type)+".");var o=null;if(4===t.length){if("string"!==n.type.kind&&"string"!==i.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(o=e.parse(t[3],3,$)))return null}return new r(n,i,o)},r.prototype.evaluate=function(t){var r=this.collator?0===this.collator.evaluate(t).compare(this.lhs.evaluate(t),this.rhs.evaluate(t)):this.lhs.evaluate(t)===this.rhs.evaluate(t);return e?!r:r},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},r.prototype.possibleOutputs=function(){return[!0,!1]},r.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},r}()}Bt.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,N);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Bt(r,n,s):null},Bt.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];if(i.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},Bt.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t(i),t(o)}t(this.otherwise)},Bt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.branches.map(function(t){return t[0],t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t},Bt.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Et=It("==",!1),Ft=It("!=",!0),Pt=function(t){this.type=U,this.input=t};Pt.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+X(r.type)+" instead."):new Pt(r):null},Pt.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ot("Expected value to be of type string or array, but found "+X(nt(e))+" instead.")},Pt.prototype.eachChild=function(t){t(this.input)},Pt.prototype.possibleOutputs=function(){return[void 0]},Pt.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Tt={"==":Et,"!=":Ft,array:lt,at:Mt,boolean:st,case:Bt,coalesce:zt,collator:et,interpolate:At,length:Pt,let:St,literal:it,match:Vt,number:st,object:st,step:bt,string:st,"to-color":ct,"to-number":ct,var:mt};function Ot(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=rt(r,n,i,a);if(s)throw new ot(s);return new Q(r/255*a,n/255*a,i/255*a,a)}function Lt(t,e){return t in e}function jt(t,e){var r=e[t];return void 0===r?null:r}function qt(t,e){var r=e[0],n=e[1];return r.evaluate(t)<n.evaluate(t)}function Rt(t,e){var r=e[0],n=e[1];return r.evaluate(t)>n.evaluate(t)}function Ut(t,e){var r=e[0],n=e[1];return r.evaluate(t)<=n.evaluate(t)}function Dt(t,e){var r=e[0],n=e[1];return r.evaluate(t)>=n.evaluate(t)}function Nt(t){return{type:t}}function Zt(t){return{result:"success",value:t}}function Kt(t){return{result:"error",value:t}}yt.register(Tt,{error:[{kind:"error"},[D],function(t,e){var r=e[0];throw new ot(r.evaluate(t))}],typeof:[D,[J],function(t,e){return X(nt(e[0].evaluate(t)))}],"to-string":[D,[J],function(t,e){var r=e[0],n=typeof(r=r.evaluate(t));return null===r?"":"string"===n||"number"===n||"boolean"===n?String(r):r instanceof Q?r.toString():JSON.stringify(r)}],"to-boolean":[N,[J],function(t,e){var r=e[0];return Boolean(r.evaluate(t))}],"to-rgba":[H(U,4),[Z],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Z,[U,U,U],Ot],rgba:[Z,[U,U,U,U],Ot],has:{type:N,overloads:[[[D],function(t,e){return Lt(e[0].evaluate(t),t.properties())}],[[D,K],function(t,e){var r=e[0],n=e[1];return Lt(r.evaluate(t),n.evaluate(t))}]]},get:{type:J,overloads:[[[D],function(t,e){return jt(e[0].evaluate(t),t.properties())}],[[D,K],function(t,e){var r=e[0],n=e[1];return jt(r.evaluate(t),n.evaluate(t))}]]},properties:[K,[],function(t){return t.properties()}],"geometry-type":[D,[],function(t){return t.geometryType()}],id:[J,[],function(t){return t.id()}],zoom:[U,[],function(t){return t.globals.zoom}],"heatmap-density":[U,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[U,[],function(t){return t.globals.lineProgress||0}],"+":[U,Nt(U),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[U,Nt(U),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:U,overloads:[[[U,U],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)-n.evaluate(t)}],[[U],function(t,e){return-e[0].evaluate(t)}]]},"/":[U,[U,U],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)/n.evaluate(t)}],"%":[U,[U,U],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)%n.evaluate(t)}],ln2:[U,[],function(){return Math.LN2}],pi:[U,[],function(){return Math.PI}],e:[U,[],function(){return Math.E}],"^":[U,[U,U],function(t,e){var r=e[0],n=e[1];return Math.pow(r.evaluate(t),n.evaluate(t))}],sqrt:[U,[U],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[U,[U],function(t,e){var r=e[0];return Math.log10(r.evaluate(t))}],ln:[U,[U],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[U,[U],function(t,e){var r=e[0];return Math.log2(r.evaluate(t))}],sin:[U,[U],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[U,[U],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[U,[U],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[U,[U],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[U,[U],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[U,[U],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[U,Nt(U),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[U,Nt(U),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[U,[U],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[U,[U],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[U,[U],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[U,[U],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[N,[D,J],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[N,[J],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[N,[D],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[N,[D,J],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[N,[J],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[N,[D,J],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[N,[J],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[N,[D,J],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[N,[J],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[N,[D,J],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[N,[J],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[N,[J],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[N,[],function(t){return null!==t.id()}],"filter-type-in":[N,[H(D)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[N,[H(J)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[N,[D,H(J)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[N,[D,H(J)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],">":{type:N,overloads:[[[U,U],Rt],[[D,D],Rt],[[D,D,$],function(t,e){var r=e[0],n=e[1];return e[2].evaluate(t).compare(r.evaluate(t),n.evaluate(t))>0}]]},"<":{type:N,overloads:[[[U,U],qt],[[D,D],qt],[[D,D,$],function(t,e){var r=e[0],n=e[1];return e[2].evaluate(t).compare(r.evaluate(t),n.evaluate(t))<0}]]},">=":{type:N,overloads:[[[U,U],Dt],[[D,D],Dt],[[D,D,$],function(t,e){var r=e[0],n=e[1];return e[2].evaluate(t).compare(r.evaluate(t),n.evaluate(t))>=0}]]},"<=":{type:N,overloads:[[[U,U],Ut],[[D,D],Ut],[[D,D,$],function(t,e){var r=e[0],n=e[1];return e[2].evaluate(t).compare(r.evaluate(t),n.evaluate(t))<=0}]]},all:{type:N,overloads:[[[N,N],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)&&n.evaluate(t)}],[Nt(N),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:N,overloads:[[[N,N],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)||n.evaluate(t)}],[Nt(N),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[N,[N],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[N,[D],function(t,e){var r=e[0],n=t.globals&&t.globals.isSupportedScript;return!n||n(r.evaluate(t))}],upcase:[D,[D],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[D,[D],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[D,Nt(D),function(t,e){return e.map(function(e){return e.evaluate(t)}).join("")}],"resolved-locale":[D,[$],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Jt=.95047,$t=1,Ht=1.08883,Xt=4/29,Gt=6/29,Yt=3*Gt*Gt,Wt=Gt*Gt*Gt,Qt=Math.PI/180,te=180/Math.PI;function ee(t){return t>Wt?Math.pow(t,1/3):t/Yt+Xt}function re(t){return t>Gt?t*t*t:Yt*(t-Xt)}function ne(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ie(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function oe(t){var e=ie(t.r),r=ie(t.g),n=ie(t.b),i=ee((.4124564*e+.3575761*r+.1804375*n)/Jt),o=ee((.2126729*e+.7151522*r+.072175*n)/$t);return{l:116*o-16,a:500*(i-o),b:200*(o-ee((.0193339*e+.119192*r+.9503041*n)/Ht)),alpha:t.a}}function ae(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=$t*re(e),r=Jt*re(r),n=Ht*re(n),new Q(ne(3.2404542*r-1.5371385*e-.4985314*n),ne(-.969266*r+1.8760108*e+.041556*n),ne(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}var se={forward:oe,reverse:ae,interpolate:function(t,e,r){return{l:wt(t.l,e.l,r),a:wt(t.a,e.a,r),b:wt(t.b,e.b,r),alpha:wt(t.alpha,e.alpha,r)}}},ue={forward:function(t){var e=oe(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*te;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Qt,r=t.c;return ae({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:function(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}(t.h,e.h,r),c:wt(t.c,e.c,r),l:wt(t.l,e.l,r),alpha:wt(t.alpha,e.alpha,r)}}},le=Object.freeze({lab:se,hcl:ue});function pe(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function ce(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function he(t){return t}function fe(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function ye(t,e,r,n,i){return fe(typeof r===i?n[r]:void 0,t.default,e.default)}function de(t,e,r){if("number"!==pe(r))return fe(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=ge(t.stops,r);return t.stops[i][1]}function ve(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==pe(r))return fe(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o=ge(t.stops,r),a=function(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=_t[e.type]||he;if(t.colorSpace&&"rgb"!==t.colorSpace){var p=le[t.colorSpace];l=function(t,e){return p.reverse(p.interpolate(p.forward(t),p.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return l(r,n,a)}}:l(s,u,a)}function me(t,e,r){return"color"===e.type?r=Q.parse(r):pe(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),fe(r,t.default,e.default)}function ge(t,e){for(var r,n,i=0,o=t.length-1,a=0;i<=o;){if(r=t[a=Math.floor((i+o)/2)][0],n=t[a+1][0],e===r||e>r&&e<n)return a;r<e?i=a+1:r>e&&(o=a-1)}return Math.max(a-1,0)}var xe=function(t,e){var r;this.expression=t,this._warningHistory={},this._defaultValue="color"===(r=e).type&&ce(r.default)?new Q(0,0,0,0):"color"===r.type?Q.parse(r.default)||null:void 0===r.default?null:r.default,"enum"===e.type&&(this._enumValues=e.values)};function be(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tt}function we(t,e){var r=new gt(Tt,[],function(t){var e={color:Z,string:D,number:U,enum:D,boolean:N};return"array"===t.type?H(e[t.value]||J,t.length):e[t.type]||null}(e)),n=r.parse(t);return n?Zt(new xe(n,e)):Kt(r.errors)}xe.prototype.evaluateWithoutErrorHandling=function(t,e){return this._evaluator||(this._evaluator=new ft),this._evaluator.globals=t,this._evaluator.feature=e,this.expression.evaluate(this._evaluator)},xe.prototype.evaluate=function(t,e){this._evaluator||(this._evaluator=new ft),this._evaluator.globals=t,this._evaluator.feature=e;try{var r=this.expression.evaluate(this._evaluator);if(null==r)return this._defaultValue;if(this._enumValues&&!(r in this._enumValues))throw new ot("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(r)+" instead.");return r}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var _e=function(t,e){this.kind=t,this._styleExpression=e};_e.prototype.evaluateWithoutErrorHandling=function(t,e){return this._styleExpression.evaluateWithoutErrorHandling(t,e)},_e.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)};var Ae=function(t,e,r){this.kind=t,this.zoomStops=r.labels,this._styleExpression=e,r instanceof At&&(this._interpolationType=r.interpolation)};function ke(t,e){if("error"===(t=we(t,e)).result)return t;var r=t.value.expression,n=dt(r);if(!n&&!e["property-function"])return Kt([new j("","property expressions not supported")]);var i=vt(r,["zoom"]);if(!i&&!1===e["zoom-function"])return Kt([new j("","zoom expressions not supported")]);var o=function t(e){var r=null;if(e instanceof St)r=t(e.result);else if(e instanceof zt)for(var n=0,i=e.args;n<i.length;n+=1){var o=i[n];if(r=t(o))break}else(e instanceof bt||e instanceof At)&&e.input instanceof yt&&"zoom"===e.input.name&&(r=e);return r instanceof j?r:(e.eachChild(function(e){var n=t(e);n instanceof j?r=n:!r&&n?r=new j("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new j("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r)}(r);return o||i?o instanceof j?Kt([o]):o instanceof At&&"piecewise-constant"===e.function?Kt([new j("",'"interpolate" expressions cannot be used with this property')]):Zt(o?new Ae(n?"camera":"composite",t.value,o):new _e(n?"constant":"source",t.value)):Kt([new j("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Ae.prototype.evaluateWithoutErrorHandling=function(t,e){return this._styleExpression.evaluateWithoutErrorHandling(t,e)},Ae.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)},Ae.prototype.interpolationFactor=function(t,e,r){return this._interpolationType?At.interpolationFactor(this._interpolationType,t,e,r):0};var ze=function(t,e){this._parameters=t,this._specification=e,T(this,function t(e,r){var n,i,o,a="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,l=s||!u,p=e.type||("interpolated"===r.function?"exponential":"interval");if(a&&((e=T({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],Q.parse(t[1])]})),e.default?e.default=Q.parse(e.default):e.default=Q.parse(r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!le[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===p)n=ve;else if("interval"===p)n=de;else if("categorical"===p){n=ye,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var f=h[c];i[f[0]]=f[1]}o=typeof e.stops[0][0]}else{if("identity"!==p)throw new Error('Unknown function type "'+p+'"');n=me}if(s){for(var y={},d=[],v=0;v<e.stops.length;v++){var m=e.stops[v],g=m[0].zoom;void 0===y[g]&&(y[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},d.push(g)),y[g].stops.push([m[0].value,m[1]])}for(var x=[],b=0,w=d;b<w.length;b+=1){var _=w[b];x.push([y[_].zoom,t(y[_],r)])}return{kind:"composite",interpolationFactor:At.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:x.map(function(t){return t[0]}),evaluate:function(t,n){var i=t.zoom;return ve({stops:x,base:e.base},r,i).evaluate(i,n)}}}return l?{kind:"camera",interpolationFactor:"exponential"===p?At.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var a=t.zoom;return n(e,r,a,i,o)}}:{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?fe(e.default,r.default):n(e,r,s,i,o)}}}(this._parameters,this._specification))};function Se(t,e){if(ce(t))return new ze(t,e);if(be(t)){var r=ke(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=Q.parse(t)),{kind:"constant",evaluate:function(){return n}}}function Me(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=pe(r);if("object"!==u)return[new F(e,r,"object expected, "+u+" found")];for(var l in r){var p=l.split(".")[0],c=n[p]||n["*"],h=void 0;if(i[p])h=i[p];else if(n[p])h=Ye;else if(i["*"])h=i["*"];else{if(!n["*"]){s.push(new F(e,r[l],'unknown property "'+l+'"'));continue}h=Ye}s=s.concat(h({key:(e?e+".":e)+l,value:r[l],valueSpec:c,style:o,styleSpec:a,object:r,objectKey:l},r))}for(var f in n)i[f]||n[f].required&&void 0===n[f].default&&void 0===r[f]&&s.push(new F(e,r,'missing required property "'+f+'"'));return s}function Ve(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Ye;if("array"!==pe(e))return[new F(o,e,"array expected, "+pe(e)+" found")];if(r.length&&e.length!==r.length)return[new F(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new F(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value};i.$version<7&&(s.function=r.function),"object"===pe(r.value)&&(s=r.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:n,styleSpec:i,key:o+"["+l+"]"}));return u}function Be(t){var e=t.key,r=t.value,n=t.valueSpec,i=pe(r);return"number"!==i?[new F(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new F(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new F(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function Ce(t){var e,r,n,i=t.valueSpec,o=O(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===pe(t.value.stops)&&"array"===pe(t.value.stops[0])&&"object"===pe(t.value.stops[0][0]),p=Me({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new F(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Ve({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:c})),"array"===pe(r)&&0===r.length&&e.push(new F(t.key,r,"array must have at least one stop")),e},default:function(t){return Ye({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&p.push(new F(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||p.push(new F(t.key,t.value,'missing required property "stops"')),"exponential"===o&&"piecewise-constant"===t.valueSpec.function&&p.push(new F(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!t.valueSpec["property-function"]?p.push(new F(t.key,t.value,"property functions not supported")):s&&!t.valueSpec["zoom-function"]&&"heatmap-color"!==t.objectKey&&"line-gradient"!==t.objectKey&&p.push(new F(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||p.push(new F(t.key,t.value,'"property" property is required')),p;function c(t){var e=[],o=t.value,s=t.key;if("array"!==pe(o))return[new F(s,o,"array expected, "+pe(o)+" found")];if(2!==o.length)return[new F(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==pe(o[0]))return[new F(s,o,"object expected, "+pe(o[0])+" found")];if(void 0===o[0].zoom)return[new F(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new F(s,o,"object stop key must have value")];if(n&&n>O(o[0].zoom))return[new F(s,o[0].zoom,"stop zoom values must appear in ascending order")];O(o[0].zoom)!==n&&(n=O(o[0].zoom),r=void 0,a={}),e=e.concat(Me({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Be,value:h}}))}else e=e.concat(h({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return e.concat(Ye({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function h(t,n){var s=pe(t.value),u=O(t.value),l=null!==t.value?t.value:n;if(e){if(s!==e)return[new F(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new F(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var p="number expected, "+s+" found";return i["property-function"]&&void 0===o&&(p+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new F(t.key,l,p)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==r&&u<r?[new F(t.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===o&&u in a?[new F(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new F(t.key,l,"integer expected, found "+u)]}}function Ie(t){var e=("property"===t.expressionContext?ke:we)(L(t.value),t.valueSpec);return"error"===e.result?e.value.map(function(e){return new F(""+t.key+e.key,t.value,e.message)}):"property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==e.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new F(t.key,t.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:[]}function Ee(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(O(r))&&i.push(new F(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(O(r))&&i.push(new F(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function Fe(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&(Array.isArray(t[1])||Array.isArray(t[2]));case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!Fe(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}ze.deserialize=function(t){return new ze(t._parameters,t._specification)},ze.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Pe={type:"boolean",default:!1,function:!0,"property-function":!0,"zoom-function":!0};function Te(t){if(!t)return function(){return!0};Fe(t)||(t=Le(t));var e=we(t,Pe);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,r){return e.value.evaluate(t,r)}}function Oe(t,e){return t<e?-1:t>e?1:0}function Le(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?je(t[1],t[2],"=="):"!="===r?Ue(je(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?je(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Le))):"all"===r?["all"].concat(t.slice(1).map(Le)):"none"===r?["all"].concat(t.slice(1).map(Le).map(Ue)):"in"===r?qe(t[1],t.slice(2)):"!in"===r?Ue(qe(t[1],t.slice(2))):"has"===r?Re(t[1]):"!has"!==r||Ue(Re(t[1]))}function je(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function qe(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Oe)]]:["filter-in-small",t,["literal",e]]}}function Re(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ue(t){return["!",t]}function De(t){return Fe(L(t.value))?Ie(T({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==pe(r))return[new F(n,r,"array expected, "+pe(r)+" found")];var o,i=e.styleSpec,a=[];if(r.length<1)return[new F(n,r,"filter array must have at least 1 element")];switch(a=a.concat(Ee({key:n+"[0]",value:r[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),O(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===O(r[1])&&a.push(new F(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new F(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(o=pe(r[1]))&&a.push(new F(n+"[1]",r[1],"string expected, "+o+" found"));for(var s=2;s<r.length;s++)o=pe(r[s]),"$type"===O(r[1])?a=a.concat(Ee({key:n+"["+s+"]",value:r[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&a.push(new F(n+"["+s+"]",r[s],"string, number, or boolean expected, "+o+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)a=a.concat(t({key:n+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=pe(r[1]),2!==r.length?a.push(new F(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==o&&a.push(new F(n+"[1]",r[1],"string expected, "+o+" found"))}return a}(t)}function Ne(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Ye({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var l,p=t.valueSpec||s[a];if(!p)return[new F(r,o,'unknown property "'+a+'"')];if("string"===pe(o)&&p["property-function"]&&!p.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new F(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var c=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&c.push(new F(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&ce(L(o))&&"identity"===O(o.type)&&c.push(new F(r,o,'"text-font" does not support identity functions'))),c.concat(Ye({key:t.key,value:o,valueSpec:p,style:n,styleSpec:i,expressionContext:"property",propertyKey:a}))}function Ze(t){return Ne(t,"paint")}function Ke(t){return Ne(t,"layout")}function Je(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new F(n,r,'either "type" or "ref" is required'));var a,s=O(r.type),u=O(r.ref);if(r.id)for(var l=O(r.id),p=0;p<t.arrayIndex;p++){var c=i.layers[p];O(c.id)===l&&e.push(new F(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+c.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new F(n,r[t],'"'+t+'" is prohibited for ref layers'))}),i.layers.forEach(function(t){O(t.id)===u&&(a=t)}),a?a.ref?e.push(new F(n,r.ref,"ref cannot reference another ref layer")):s=O(a.type):e.push(new F(n,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(r.source){var h=i.sources&&i.sources[r.source],f=h&&O(h.type);h?"vector"===f&&"raster"===s?e.push(new F(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new F(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new F(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&h.lineMetrics||e.push(new F(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new F(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new F(n,r.source,'source "'+r.source+'" not found'))}else e.push(new F(n,r,'missing required property "source"'));return e=e.concat(Me({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ye({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:De,layout:function(t){return Me({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Ke(T({layerType:s},t))}}})},paint:function(t){return Me({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Ze(T({layerType:s},t))}}})}}}))}function $e(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new F(r,e,'"type" is required')];var o=O(e.type),a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(Me({key:r,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new F(r+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":return Me({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n});case"video":return Me({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Me({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return a.push(new F(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),a;default:return Ee({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function He(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],a=pe(e);if(void 0===e)return o;if("object"!==a)return o.concat([new F("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=u&&n[u[1]]&&n[u[1]].transition?o.concat(Ye({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r})):n[s]?o.concat(Ye({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r})):o.concat([new F(s,e[s],'unknown property "'+s+'"')])}return o}function Xe(t){var e=t.value,r=t.key,n=pe(e);return"string"!==n?[new F(r,e,"string expected, "+n+" found")]:[]}var Ge={"*":function(){return[]},array:Ve,boolean:function(t){var e=t.value,r=t.key,n=pe(e);return"boolean"!==n?[new F(r,e,"boolean expected, "+n+" found")]:[]},number:Be,color:function(t){var e=t.key,r=t.value,n=pe(r);return"string"!==n?[new F(e,r,"color expected, "+n+" found")]:null===W(r)?[new F(e,r,'color expected, "'+r+'" found')]:[]},constants:P,enum:Ee,filter:De,function:Ce,layer:Je,object:Me,source:$e,light:He,string:Xe};function Ye(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.function&&ce(O(e))?Ce(t):r.function&&be(L(e))?Ie(t):r.type&&Ge[r.type]?Ge[r.type](t):Me(T({},t,{valueSpec:r.type?n[r.type]:r}))}function We(t){var e=t.value,r=t.key,n=Xe(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new F(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new F(r,e,'"glyphs" url must include a "{range}" token')),n)}function Qe(t,e){e=e||E;var r=[];return r=r.concat(Ye({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:We,"*":function(){return[]}}})),t.constants&&(r=r.concat(P({key:"constants",value:t.constants,style:t,styleSpec:e}))),tr(r)}function tr(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function er(t){return function(){return tr(t.apply(this,arguments))}}Qe.source=er($e),Qe.light=er(He),Qe.layer=er(Je),Qe.filter=er(De),Qe.paintProperty=er(Ze),Qe.layoutProperty=er(Ke);var rr=Qe,nr=Qe.light,ir=Qe.paintProperty,or=Qe.layoutProperty;function ar(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1){var o=i[n];t.fire(new C(new Error(o.message))),r=!0}return r}var sr=lr,ur=3;function lr(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],e=i[1],r=i[2],this.d=e+2*r;for(var o=0;o<this.d*this.d;o++){var a=i[ur+o],s=i[ur+o+1];n.push(a===s?null:i.subarray(a,s))}var u=i[ur+n.length],l=i[ur+n.length+1];this.keys=i.subarray(u,l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var p=0;p<this.d*this.d;p++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}lr.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},lr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},lr.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},lr.prototype.query=function(t,e,r,n){var i=this.min,o=this.max;if(t<=i&&e<=i&&o<=r&&o<=n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,r,n,this._queryCell,a,{}),a},lr.prototype._queryCell=function(t,e,r,n,i,o,a){var s=this.cells[i];if(null!==s)for(var u=this.keys,l=this.bboxes,p=0;p<s.length;p++){var c=s[p];if(void 0===a[c]){var h=4*c;t<=l[h+2]&&e<=l[h+3]&&r>=l[h+0]&&n>=l[h+1]?(a[c]=!0,o.push(u[c])):a[c]=!1}}},lr.prototype._forEachCell=function(t,e,r,n,i,o,a){for(var s=this._convertToCellCoord(t),u=this._convertToCellCoord(e),l=this._convertToCellCoord(r),p=this._convertToCellCoord(n),c=s;c<=l;c++)for(var h=u;h<=p;h++){var f=this.d*h+c;if(i.call(this,t,e,r,n,f,o,a))return}},lr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},lr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ur+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[ur+a]=o,i.set(s,o),o+=s.length}return i[ur+t.length]=o,i.set(this.keys,o),o+=this.keys.length,i[ur+t.length+1]=o,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var pr=self.ImageData,cr={};function hr(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),cr[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var fr in hr("Object",Object),sr.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),r},sr.deserialize=function(t){return new sr(t)},hr("Grid",sr),hr("Color",Q),hr("Error",Error),hr("StylePropertyFunction",ze),hr("StyleExpression",xe,{omit:["_evaluator"]}),hr("ZoomDependentExpression",Ae),hr("ZoomConstantExpression",_e),hr("CompoundExpression",yt,{omit:["_evaluate"]}),Tt)Tt[fr]._classRegistryKey||hr("Expression_"+fr,Tt[fr]);function yr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof pr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,o=t;i<o.length;i+=1){var a=o[i];n.push(yr(a,e))}return n}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var l={};if(s.serialize)l._serialized=s.serialize(t,e);else{for(var p in t)if(t.hasOwnProperty(p)&&!(cr[u].omit.indexOf(p)>=0)){var c=t[p];l[p]=cr[u].shallow.indexOf(p)>=0?c:yr(c,e)}t instanceof Error&&(l.message=t.message)}return{name:u,properties:l}}throw new Error("can't serialize object of type "+typeof t)}function dr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof pr)return t;if(Array.isArray(t))return t.map(function(t){return dr(t)});if("object"==typeof t){var e=t,r=e.name,n=e.properties;if(!r)throw new Error("can't deserialize object of anonymous class");var i=cr[r].klass;if(!i)throw new Error("can't deserialize unregistered class "+r);if(i.deserialize)return i.deserialize(n._serialized);for(var o=Object.create(i.prototype),a=0,s=Object.keys(n);a<s.length;a+=1){var u=s[a];o[u]=cr[r].shallow.indexOf(u)>=0?n[u]:dr(n[u])}return o}throw new Error("can't deserialize object of type "+typeof t)}var vr=function(){this.first=!0};vr.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var mr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function gr(t){for(var e=0,r=t;e<r.length;e+=1)if(br(r[e].charCodeAt(0)))return!0;return!1}function xr(t){return!(mr.Arabic(t)||mr["Arabic Supplement"](t)||mr["Arabic Extended-A"](t)||mr["Arabic Presentation Forms-A"](t)||mr["Arabic Presentation Forms-B"](t))}function br(t){return!!(746===t||747===t||!(t<4352)&&(mr["Bopomofo Extended"](t)||mr.Bopomofo(t)||mr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||mr["CJK Compatibility Ideographs"](t)||mr["CJK Compatibility"](t)||mr["CJK Radicals Supplement"](t)||mr["CJK Strokes"](t)||!(!mr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||mr["CJK Unified Ideographs Extension A"](t)||mr["CJK Unified Ideographs"](t)||mr["Enclosed CJK Letters and Months"](t)||mr["Hangul Compatibility Jamo"](t)||mr["Hangul Jamo Extended-A"](t)||mr["Hangul Jamo Extended-B"](t)||mr["Hangul Jamo"](t)||mr["Hangul Syllables"](t)||mr.Hiragana(t)||mr["Ideographic Description Characters"](t)||mr.Kanbun(t)||mr["Kangxi Radicals"](t)||mr["Katakana Phonetic Extensions"](t)||mr.Katakana(t)&&12540!==t||!(!mr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!mr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||mr["Unified Canadian Aboriginal Syllabics"](t)||mr["Unified Canadian Aboriginal Syllabics Extended"](t)||mr["Vertical Forms"](t)||mr["Yijing Hexagram Symbols"](t)||mr["Yi Syllables"](t)||mr["Yi Radicals"](t)))}function wr(t){return!(br(t)||function(t){return!!(mr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||mr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||mr["Letterlike Symbols"](t)||mr["Number Forms"](t)||mr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||mr["Control Pictures"](t)&&9251!==t||mr["Optical Character Recognition"](t)||mr["Enclosed Alphanumerics"](t)||mr["Geometric Shapes"](t)||mr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||mr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||mr["CJK Symbols and Punctuation"](t)||mr.Katakana(t)||mr["Private Use Area"](t)||mr["CJK Compatibility Forms"](t)||mr["Small Form Variants"](t)||mr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function _r(t,e){return!(!e&&(t>=1424&&t<=2303||mr["Arabic Presentation Forms-A"](t)||mr["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||mr.Khmer(t))}var Ar,kr=!1,zr=null,Sr=!1,Mr=new I,Vr={applyArabicShaping:null,processBidirectionalText:null,isLoaded:function(){return Sr||null!=Vr.applyArabicShaping}},Br=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vr,this.transition={})};Br.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!_r(n[r].charCodeAt(0),e))return!1;return!0}(t,Vr.isLoaded())},Br.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)};var Cr=function(t,e){this.property=t,this.value=e,this.expression=Se(void 0===e?t.specification.default:e,t.specification)};Cr.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Cr.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var Ir=function(t){this.property=t,this.value=new Cr(t,void 0)};Ir.prototype.transitioned=function(t,e){return new Fr(this.property,this.value,e,h({},t.transition,this.transition),t.now)},Ir.prototype.untransitioned=function(){return new Fr(this.property,this.value,null,{},0)};var Er=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Er.prototype.getValue=function(t){return g(this._values[t].value.value)},Er.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Ir(this._values[t].property)),this._values[t].value=new Cr(this._values[t].property,null===e?void 0:g(e))},Er.prototype.getTransition=function(t){return g(this._values[t].transition)},Er.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Ir(this._values[t].property)),this._values[t].transition=g(e)||void 0},Er.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},Er.prototype.transitioned=function(t,e){for(var r=new Pr(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},Er.prototype.untransitioned=function(){for(var t=new Pr(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var Fr=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};Fr.prototype.possiblyEvaluate=function(t){var e=t.now||0,r=this.value.possiblyEvaluate(t),n=this.prior;if(n){if(e>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(e<this.begin)return n.possiblyEvaluate(t);var i=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t),r,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(i))}return r};var Pr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Pr.prototype.possiblyEvaluate=function(t){for(var e=new Lr(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var i=n[r];e._values[i]=this._values[i].possiblyEvaluate(t)}return e},Pr.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var r=e[t];if(this._values[r].prior)return!0}return!1};var Tr=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Tr.prototype.getValue=function(t){return g(this._values[t].value)},Tr.prototype.setValue=function(t,e){this._values[t]=new Cr(this._values[t].property,null===e?void 0:g(e))},Tr.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},Tr.prototype.possiblyEvaluate=function(t){for(var e=new Lr(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var i=n[r];e._values[i]=this._values[i].possiblyEvaluate(t)}return e};var Or=function(t,e,r){this.property=t,this.value=e,this.globals=r};Or.prototype.isConstant=function(){return"constant"===this.value.kind},Or.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Or.prototype.evaluate=function(t){return this.property.evaluate(this.value,this.globals,t)};var Lr=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Lr.prototype.get=function(t){return this._values[t]};var jr=function(t){this.specification=t};jr.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},jr.prototype.interpolate=function(t,e,r){var n=_t[this.specification.type];return n?n(t,e,r):t};var qr=function(t){this.specification=t};qr.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Or(this,{kind:"constant",value:t.expression.evaluate(e)},e):new Or(this,t.expression,e)},qr.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Or(this,{kind:"constant",value:void 0},t.globals);var n=_t[this.specification.type];return n?new Or(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.globals):t},qr.prototype.evaluate=function(t,e,r){return"constant"===t.kind?t.value:t.evaluate(e,r)};var Rr=function(t){this.specification=t};Rr.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Br(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Br(Math.floor(e.zoom),e)),t.expression.evaluate(new Br(Math.floor(e.zoom+1),e)),e)}},Rr.prototype._calculate=function(t,e,r,n){var i=n.zoom,o=i-Math.floor(i),a=n.crossFadingFactor();return i>n.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:o+(1-o)*a}:{from:r,to:e,fromScale:.5,toScale:1,t:1-(1-a)*o}},Rr.prototype.interpolate=function(t){return t};var Ur=function(t){this.specification=t};Ur.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Ur.prototype.interpolate=function(){return!1};var Dr=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var r=t[e],n=this.defaultPropertyValues[e]=new Cr(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new Ir(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};hr("DataDrivenProperty",qr),hr("DataConstantProperty",jr),hr("CrossFadedProperty",Rr),hr("ColorRampProperty",Ur);var Nr=function(t){function e(e,r){for(var n in t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible","background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this._featureFilter=function(){return!0},r.layout&&(this._unevaluatedLayout=new Tr(r.layout)),this._transitionablePaint=new Er(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){if(null!=e){var n="layers."+this.id+".layout."+t;if(this._validate(or,n,t,e,r))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible"},e.prototype.getPaintProperty=function(t){return d(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(null!=e){var n="layers."+this.id+".paint."+t;if(this._validate(ir,n,t,e,r))return}d(t,"-transition")?this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0):this._transitionablePaint.setValue(t,e)},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),m(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,r,n,i){return(!i||!1!==i.validate)&&ar(this,t.call(rr,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:E,style:{glyphs:!0,sprite:!0}}))},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e}(I),Zr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Kr=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Jr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function $r(t,e){void 0===e&&(e=1);var r=0,n=0;return{members:t.map(function(t){var i,o=(i=t.type,Zr[i].BYTES_PER_ELEMENT),a=r=Hr(r,Math.max(e,o)),s=t.components||1;return n=Math.max(n,o),r+=o*s,{name:t.name,type:t.type,components:s,offset:a}}),size:Hr(r,Math.max(n,e)),alignment:e}}function Hr(t,e){return Math.ceil(t/e)*e}Jr.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Jr.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Jr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Jr.prototype.clear=function(){this.length=0},Jr.prototype.resize=function(t){this.reserve(t),this.length=t},Jr.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Jr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var n=2*r;return this.int16[n+0]=t,this.int16[n+1]=e,r},e}(Jr);Xr.prototype.bytesPerElement=4,hr("StructArrayLayout2i4",Xr);var Gr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;this.resize(i+1);var o=4*i;return this.int16[o+0]=t,this.int16[o+1]=e,this.int16[o+2]=r,this.int16[o+3]=n,i},e}(Jr);Gr.prototype.bytesPerElement=8,hr("StructArrayLayout4i8",Gr);var Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=i,this.int16[s+5]=o,a},e}(Jr);Yr.prototype.bytesPerElement=12,hr("StructArrayLayout2i4i12",Yr);var Wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var u=this.length;this.resize(u+1);var l=6*u,p=12*u;return this.int16[l+0]=t,this.int16[l+1]=e,this.int16[l+2]=r,this.int16[l+3]=n,this.uint8[p+8]=i,this.uint8[p+9]=o,this.uint8[p+10]=a,this.uint8[p+11]=s,u},e}(Jr);Wr.prototype.bytesPerElement=12,hr("StructArrayLayout4i4ub12",Wr);var Qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var u=this.length;this.resize(u+1);var l=8*u;return this.int16[l+0]=t,this.int16[l+1]=e,this.int16[l+2]=r,this.int16[l+3]=n,this.uint16[l+4]=i,this.uint16[l+5]=o,this.uint16[l+6]=a,this.uint16[l+7]=s,u},e}(Jr);Qr.prototype.bytesPerElement=16,hr("StructArrayLayout4i4ui16",Qr);var tn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;this.resize(n+1);var i=3*n;return this.float32[i+0]=t,this.float32[i+1]=e,this.float32[i+2]=r,n},e}(Jr);tn.prototype.bytesPerElement=12,hr("StructArrayLayout3f12",tn);var en=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var r=1*e;return this.uint32[r+0]=t,e},e}(Jr);en.prototype.bytesPerElement=4,hr("StructArrayLayout1ul4",en);var rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,l,p){var c=this.length;this.resize(c+1);var h=12*c,f=6*c;return this.int16[h+0]=t,this.int16[h+1]=e,this.int16[h+2]=r,this.int16[h+3]=n,this.int16[h+4]=i,this.int16[h+5]=o,this.uint32[f+3]=a,this.uint16[h+8]=s,this.uint16[h+9]=u,this.int16[h+10]=l,this.int16[h+11]=p,c},e}(Jr);rn.prototype.bytesPerElement=24,hr("StructArrayLayout6i1ul2ui2i24",rn);var nn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=i,this.int16[s+5]=o,a},e}(Jr);nn.prototype.bytesPerElement=12,hr("StructArrayLayout2i2i2i12",nn);var on=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var n=4*r;return this.uint8[n+0]=t,this.uint8[n+1]=e,r},e}(Jr);on.prototype.bytesPerElement=4,hr("StructArrayLayout2ub4",on);var an=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,l,p,c,h,f){var y=this.length;this.resize(y+1);var d=20*y,v=10*y,m=40*y;return this.int16[d+0]=t,this.int16[d+1]=e,this.uint16[d+2]=r,this.uint16[d+3]=n,this.uint32[v+2]=i,this.uint32[v+3]=o,this.uint32[v+4]=a,this.uint16[d+10]=s,this.uint16[d+11]=u,this.uint16[d+12]=l,this.float32[v+7]=p,this.float32[v+8]=c,this.uint8[m+36]=h,this.uint8[m+37]=f,y},e}(Jr);an.prototype.bytesPerElement=40,hr("StructArrayLayout2i2ui3ul3ui2f2ub40",an);var sn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var r=1*e;return this.float32[r+0]=t,e},e}(Jr);sn.prototype.bytesPerElement=4,hr("StructArrayLayout1f4",sn);var un=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;this.resize(n+1);var i=3*n;return this.int16[i+0]=t,this.int16[i+1]=e,this.int16[i+2]=r,n},e}(Jr);un.prototype.bytesPerElement=6,hr("StructArrayLayout3i6",un);var ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;this.resize(n+1);var i=2*n,o=4*n;return this.uint32[i+0]=t,this.uint16[o+2]=e,this.uint16[o+3]=r,n},e}(Jr);ln.prototype.bytesPerElement=8,hr("StructArrayLayout1ul2ui8",ln);var pn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;this.resize(n+1);var i=3*n;return this.uint16[i+0]=t,this.uint16[i+1]=e,this.uint16[i+2]=r,n},e}(Jr);pn.prototype.bytesPerElement=6,hr("StructArrayLayout3ui6",pn);var cn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var n=2*r;return this.uint16[n+0]=t,this.uint16[n+1]=e,r},e}(Jr);cn.prototype.bytesPerElement=4,hr("StructArrayLayout2ui4",cn);var hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var n=2*r;return this.float32[n+0]=t,this.float32[n+1]=e,r},e}(Jr);hn.prototype.bytesPerElement=8,hr("StructArrayLayout2f8",hn);var fn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;this.resize(i+1);var o=4*i;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=r,this.float32[o+3]=n,i},e}(Jr);fn.prototype.bytesPerElement=16,hr("StructArrayLayout4f16",fn);var yn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},r.anchorPoint.get=function(){return new s(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Kr);yn.prototype.size=24;var dn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new yn(this,t)},e}(rn);hr("CollisionBoxArray",dn);var vn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},Object.defineProperties(e.prototype,r),e}(Kr);vn.prototype.size=40;var mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new vn(this,t)},e}(an);hr("PlacedSymbolArray",mn);var gn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={offsetX:{configurable:!0}};return r.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},r.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,r),e}(Kr);gn.prototype.size=4;var xn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new gn(this,t)},e}(sn);hr("GlyphOffsetArray",xn);var bn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return r.x.get=function(){return this._structArray.int16[this._pos2+0]},r.x.set=function(t){this._structArray.int16[this._pos2+0]=t},r.y.get=function(){return this._structArray.int16[this._pos2+1]},r.y.set=function(t){this._structArray.int16[this._pos2+1]=t},r.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},r.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,r),e}(Kr);bn.prototype.size=6;var wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new bn(this,t)},e}(un);hr("SymbolLineVertexArray",wn);var _n=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,r),e}(Kr);_n.prototype.size=8;var An=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new _n(this,t)},e}(ln);hr("FeatureIndexArray",An);var kn=$r([{name:"a_pos",components:2,type:"Int16"}],4).members,zn=function(t){void 0===t&&(t=[]),this.segments=t};zn.prototype.prepareSegment=function(t,e,r){var n=this.segments[this.segments.length-1];return t>zn.MAX_VERTEX_ARRAY_LENGTH&&b("Max vertices per segment is "+zn.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!n||n.vertexLength+t>zn.MAX_VERTEX_ARRAY_LENGTH)&&(n={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n},zn.prototype.get=function(){return this.segments},zn.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr("SegmentVector",zn);var Sn=function(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)};function Mn(t){return[Sn(255*t.r,255*t.g),Sn(255*t.b,255*t.a)]}var Vn=function(t,e,r){this.value=t,this.name=e,this.type=r,this.statistics={max:-1/0}};Vn.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},Vn.prototype.populatePaintArray=function(){},Vn.prototype.upload=function(){},Vn.prototype.destroy=function(){},Vn.prototype.setUniforms=function(t,e,r,n){var i=n.constantOr(this.value),o=t.gl;"color"===this.type?o.uniform4f(e.uniforms["u_"+this.name],i.r,i.g,i.b,i.a):o.uniform1f(e.uniforms["u_"+this.name],i)};var Bn=function(t,e,r){this.expression=t,this.name=e,this.type=r,this.statistics={max:-1/0};var n="color"===r?hn:sn;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===r?2:1,offset:0}],this.paintVertexArray=new n};Bn.prototype.defines=function(){return[]},Bn.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,n=r.length;r.reserve(t);var i=this.expression.evaluate(new Br(0),e);if("color"===this.type)for(var o=Mn(i),a=n;a<t;a++)r.emplaceBack(o[0],o[1]);else{for(var s=n;s<t;s++)r.emplaceBack(i);this.statistics.max=Math.max(this.statistics.max,i)}},Bn.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},Bn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Bn.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0)};var Cn=function(t,e,r,n,i){this.expression=t,this.name=e,this.type=r,this.useIntegerZoom=n,this.zoom=i,this.statistics={max:-1/0};var o="color"===r?fn:hn;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===r?4:2,offset:0}],this.paintVertexArray=new o};Cn.prototype.defines=function(){return[]},Cn.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,n=r.length;r.reserve(t);var i=this.expression.evaluate(new Br(this.zoom),e),o=this.expression.evaluate(new Br(this.zoom+1),e);if("color"===this.type)for(var a=Mn(i),s=Mn(o),u=n;u<t;u++)r.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var l=n;l<t;l++)r.emplaceBack(i,o);this.statistics.max=Math.max(this.statistics.max,i,o)}},Cn.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},Cn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Cn.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},Cn.prototype.setUniforms=function(t,e,r){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(r.zoom))};var In=function(){this.binders={},this.cacheKey="",this._buffers=[]};In.createDynamic=function(t,e,r){var n=new In,i=[];for(var o in t.paint._values)if(r(o)){var a=t.paint.get(o);if(a instanceof Or&&a.property.specification["property-function"]){var s=Fn(o,t.type),u=a.property.specification.type,l=a.property.useIntegerZoom;"constant"===a.value.kind?(n.binders[o]=new Vn(a.value,s,u),i.push("/u_"+s)):"source"===a.value.kind?(n.binders[o]=new Bn(a.value,s,u),i.push("/a_"+s)):(n.binders[o]=new Cn(a.value,s,u,l,e),i.push("/z_"+s))}}return n.cacheKey=i.sort().join(""),n},In.prototype.populatePaintArrays=function(t,e){for(var r in this.binders)this.binders[r].populatePaintArray(t,e)},In.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},In.prototype.setUniforms=function(t,e,r,n){for(var i in this.binders)this.binders[i].setUniforms(t,e,n,r.get(i))},In.prototype.getPaintVertexBuffers=function(){return this._buffers},In.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var r=[];for(var n in this.binders){var i=this.binders[n];(i instanceof Bn||i instanceof Cn)&&i.paintVertexBuffer&&r.push(i.paintVertexBuffer)}this._buffers=r},In.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var En=function(t,e,r,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var i=0,o=e;i<o.length;i+=1){var a=o[i];this.programConfigurations[a.id]=In.createDynamic(a,r,n),this.programConfigurations[a.id].layoutAttributes=t}};function Fn(t,e){return{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"}[t]||t.replace(e+"-","").replace(/-/g,"_")}En.prototype.populatePaintArrays=function(t,e){for(var r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,e)},En.prototype.get=function(t){return this.programConfigurations[t]},En.prototype.upload=function(t){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t)},En.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},hr("ConstantBinder",Vn),hr("SourceExpressionBinder",Bn),hr("CompositeExpressionBinder",Cn),hr("ProgramConfiguration",In,{omit:["_buffers"]}),hr("ProgramConfigurationSet",En);var Pn=8192,On=(16,{min:-1*Math.pow(2,15),max:Math.pow(2,15)-1});function Ln(t){for(var e=Pn/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){var a=i[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<On.min||a.x>On.max||a.y<On.min||a.y>On.max)&&b("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function jn(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}var qn=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Xr,this.indexArray=new pn,this.segments=new zn,this.programConfigurations=new En(kn,t.layers,t.zoom)};function Rn(t,e,r){for(var n=0;n<t.length;n++){var i=t[n];if(Xn(i,e))return!0;if(Jn(e,i,r))return!0}return!1}function Un(t,e){if(1===t.length&&1===t[0].length)return Hn(e,t[0][0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(Hn(t,n[i]))return!0;for(var o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++)if(Hn(e,a[s]))return!0;for(var u=0;u<e.length;u++)if(Zn(a,e[u]))return!0}return!1}function Dn(t,e,r){for(var n=0;n<e.length;n++)for(var i=e[n],o=0;o<t.length;o++){var a=t[o];if(a.length>=3)for(var s=0;s<i.length;s++)if(Xn(a,i[s]))return!0;if(Nn(a,i,r))return!0}return!1}function Nn(t,e,r){if(t.length>1){if(Zn(t,e))return!0;for(var n=0;n<e.length;n++)if(Jn(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(Jn(t[i],e,r))return!0;return!1}function Zn(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],o=0;o<e.length-1;o++)if(Kn(n,i,e[o],e[o+1]))return!0;return!1}function Kn(t,e,r,n){return w(t,r,n)!==w(e,r,n)&&w(t,e,r)!==w(t,e,n)}function Jn(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if($n(t,e[i-1],e[i])<n)return!0;return!1}function $n(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return i<0?t.distSqr(e):i>1?t.distSqr(r):t.distSqr(r.sub(e)._mult(i)._add(e))}function Hn(t,e){for(var r,n,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(r=t[a]).length-1;s<r.length;u=s++)n=r[s],i=r[u],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o);return o}function Xn(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var o=t[n],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function Gn(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).binders[t].statistics.max}function Yn(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wn(t,e,r,n,i){if(!e[0]&&!e[1])return t;var o=s.convert(e);"viewport"===r&&o._rotate(-n);for(var a=[],u=0;u<t.length;u++){for(var l=t[u],p=[],c=0;c<l.length;c++)p.push(l[c].sub(o._mult(i)));a.push(p)}return a}qn.prototype.populate=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Br(this.zoom),o)){var u=Ln(o);this.addFeature(o,u),e.featureIndex.insert(o,u,a,s,this.index)}}},qn.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},qn.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kn),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},qn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qn.prototype.addFeature=function(t,e){for(var r=0,n=e;r<n.length;r+=1)for(var i=0,o=n[r];i<o.length;i+=1){var a=o[i],s=a.x,u=a.y;if(!(s<0||s>=Pn||u<0||u>=Pn)){var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=l.vertexLength;jn(this.layoutVertexArray,s,u,-1,-1),jn(this.layoutVertexArray,s,u,1,-1),jn(this.layoutVertexArray,s,u,1,1),jn(this.layoutVertexArray,s,u,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),l.vertexLength+=4,l.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hr("CircleBucket",qn,{omit:["layers"]});var Qn={paint:new Dr({"circle-radius":new qr(E.paint_circle["circle-radius"]),"circle-color":new qr(E.paint_circle["circle-color"]),"circle-blur":new qr(E.paint_circle["circle-blur"]),"circle-opacity":new qr(E.paint_circle["circle-opacity"]),"circle-translate":new jr(E.paint_circle["circle-translate"]),"circle-translate-anchor":new jr(E.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jr(E.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jr(E.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qr(E.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qr(E.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qr(E.paint_circle["circle-stroke-opacity"])})},ti=n(function(t,e){var r;t.exports=((r=new Float32Array(3))[0]=0,r[1]=0,r[2]=0,function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}(),{vec3:{transformMat3:function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}},vec4:{transformMat4:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*-s+o*u,t[3]=i*-s+a*u,t},scale:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1];return t[0]=n*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,r){var n,i,o,a,s,u,l,p,c,h,f,y,d=r[0],v=r[1],m=r[2];return e===t?(t[12]=e[0]*d+e[4]*v+e[8]*m+e[12],t[13]=e[1]*d+e[5]*v+e[9]*m+e[13],t[14]=e[2]*d+e[6]*v+e[10]*m+e[14],t[15]=e[3]*d+e[7]*v+e[11]*m+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],y=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=p,t[8]=c,t[9]=h,t[10]=f,t[11]=y,t[12]=n*d+s*v+c*m+e[12],t[13]=i*d+u*v+h*m+e[13],t[14]=o*d+l*v+f*m+e[14],t[15]=a*d+p*v+y*m+e[15]),t},scale:function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],y=e[11],d=e[12],v=e[13],m=e[14],g=e[15],x=r[0],b=r[1],w=r[2],_=r[3];return t[0]=x*n+b*s+w*c+_*d,t[1]=x*i+b*u+w*h+_*v,t[2]=x*o+b*l+w*f+_*m,t[3]=x*a+b*p+w*y+_*g,x=r[4],b=r[5],w=r[6],_=r[7],t[4]=x*n+b*s+w*c+_*d,t[5]=x*i+b*u+w*h+_*v,t[6]=x*o+b*l+w*f+_*m,t[7]=x*a+b*p+w*y+_*g,x=r[8],b=r[9],w=r[10],_=r[11],t[8]=x*n+b*s+w*c+_*d,t[9]=x*i+b*u+w*h+_*v,t[10]=x*o+b*l+w*f+_*m,t[11]=x*a+b*p+w*y+_*g,x=r[12],b=r[13],w=r[14],_=r[15],t[12]=x*n+b*s+w*c+_*d,t[13]=x*i+b*u+w*h+_*v,t[14]=x*o+b*l+w*f+_*m,t[15]=x*a+b*p+w*y+_*g,t},perspective:function(t,e,r,n,i){var o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t},rotateX:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],p=e[9],c=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+p*n,t[6]=s*i+c*n,t[7]=u*i+h*n,t[8]=l*i-o*n,t[9]=p*i-a*n,t[10]=c*i-s*n,t[11]=h*i-u*n,t},rotateZ:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],p=e[5],c=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+p*n,t[2]=s*i+c*n,t[3]=u*i+h*n,t[4]=l*i-o*n,t[5]=p*i-a*n,t[6]=c*i-s*n,t[7]=h*i-u*n,t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],p=e[8],c=e[9],h=e[10],f=e[11],y=e[12],d=e[13],v=e[14],m=e[15],g=r*s-n*a,x=r*u-i*a,b=r*l-o*a,w=n*u-i*s,_=n*l-o*s,A=i*l-o*u,k=p*d-c*y,z=p*v-h*y,S=p*m-f*y,M=c*v-h*d,V=c*m-f*d,B=h*m-f*v,C=g*B-x*V+b*M+w*S-_*z+A*k;return C?(C=1/C,t[0]=(s*B-u*V+l*M)*C,t[1]=(i*V-n*B-o*M)*C,t[2]=(d*A-v*_+m*w)*C,t[3]=(h*_-c*A-f*w)*C,t[4]=(u*S-a*B-l*z)*C,t[5]=(r*B-i*S+o*z)*C,t[6]=(v*b-y*A-m*x)*C,t[7]=(p*A-h*b+f*x)*C,t[8]=(a*V-s*S+l*k)*C,t[9]=(n*S-r*V-o*k)*C,t[10]=(y*_-d*b+m*g)*C,t[11]=(c*b-p*_-f*g)*C,t[12]=(s*z-a*M-u*k)*C,t[13]=(r*M-n*z+i*k)*C,t[14]=(d*x-y*w-v*g)*C,t[15]=(p*w-c*x+h*g)*C,t):null},ortho:function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t}}})}),ei=(ti.vec3,ti.vec4),ri=(ti.mat2,ti.mat3,ti.mat4),ni=function(t){function e(e){t.call(this,e,Qn)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new qn(t)},e.prototype.queryRadius=function(t){var e=t;return Gn("circle-radius",this,e)+Gn("circle-stroke-width",this,e)+Yn(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){for(var s=Wn(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),i.angle,o),u=this.paint.get("circle-radius").evaluate(e)+this.paint.get("circle-stroke-width").evaluate(e),l="map"===this.paint.get("circle-pitch-alignment"),p=l?s:function(t,e,r){return s.map(function(t){return t.map(function(t){return ii(t,e,r)})})}(0,a,i),c=l?u*o:u,h=0,f=r;h<f.length;h+=1)for(var y=0,d=f[h];y<d.length;y+=1){var v=d[y],m=l?v:ii(v,a,i),g=c,x=ei.transformMat4([],[v.x,v.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?g*=x[3]/i.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(g*=i.cameraToCenterDistance/x[3]),Rn(p,m,g))return!0}return!1},e}(Nr);function ii(t,e,r){var n=ei.transformMat4([],[t.x,t.y,0,1],e);return new s((n[0]/n[3]+1)*r.width*.5,(n[1]/n[3]+1)*r.height*.5)}var oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(qn);function ai(t,e,r,n){var i=e.width,o=e.height;if(n){if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return t.width=i,t.height=o,t.data=n,t}function si(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var o=ai({},{width:n,height:i},r);ui(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=o.data}}function ui(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((r.y+u)*t.width+r.x)*o,p=((n.y+u)*e.width+n.x)*o,c=0;c<i.width*o;c++)s[p+c]=a[l+c];return e}hr("HeatmapBucket",oi,{omit:["layers"]});var li=function(t,e){ai(this,t,1,e)};li.prototype.resize=function(t){si(this,t,1)},li.prototype.clone=function(){return new li({width:this.width,height:this.height},new Uint8Array(this.data))},li.copy=function(t,e,r,n,i){ui(t,e,r,n,i,1)};var pi=function(t,e){ai(this,t,4,e)};pi.prototype.resize=function(t){si(this,t,4)},pi.prototype.clone=function(){return new pi({width:this.width,height:this.height},new Uint8Array(this.data))},pi.copy=function(t,e,r,n,i){ui(t,e,r,n,i,4)},hr("AlphaImage",li),hr("RGBAImage",pi);var ci={paint:new Dr({"heatmap-radius":new qr(E.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qr(E.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jr(E.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ur(E.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jr(E.paint_heatmap["heatmap-opacity"])})};function hi(t,e){for(var r=new Uint8Array(1024),n={},i=0,o=0;i<256;i++,o+=4){n[e]=i/255;var a=t.evaluate(n);r[o+0]=Math.floor(255*a.r/a.a),r[o+1]=Math.floor(255*a.g/a.a),r[o+2]=Math.floor(255*a.b/a.a),r[o+3]=Math.floor(255*a.a)}return new pi({width:256,height:1},r)}var fi=function(t){function e(e){t.call(this,e,ci),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new oi(t)},e.prototype.setPaintProperty=function(e,r,n){t.prototype.setPaintProperty.call(this,e,r,n),"heatmap-color"===e&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=hi(t,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Nr),yi={paint:new Dr({"hillshade-illumination-direction":new jr(E.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jr(E.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jr(E.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jr(E.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jr(E.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jr(E.paint_hillshade["hillshade-accent-color"])})},di=function(t){function e(e){t.call(this,e,yi)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Nr),vi=$r([{name:"a_pos",components:2,type:"Int16"}],4).members,mi=xi,gi=xi;function xi(t,e,r){r=r||2;var n,i,o,a,s,u,l,p=e&&e.length,c=p?e[0]*r:t.length,h=bi(t,0,c,r,!0),f=[];if(!h)return f;if(p&&(h=function(t,e,r,n){var i,o,u,l=[];for(i=0,o=e.length;i<o;i++)(u=bi(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===u.next&&(u.steiner=!0),l.push(Ci(u));for(l.sort(Mi),i=0;i<l.length;i++)Vi(l[i],r),r=wi(r,r.next);return r}(t,e,h,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var y=r;y<c;y+=r)(s=t[y])<n&&(n=s),(u=t[y+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-n,a-i))?1/l:0}return _i(h,f,r,n,i,l),f}function bi(t,e,r,n,i){var o,a;if(i===Ui(t,e,r,n)>0)for(o=e;o<r;o+=n)a=ji(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=ji(o,t[o],t[o+1],a);return a&&Pi(a,a.next)&&(qi(a),a=a.next),a}function wi(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Pi(n,n.next)&&0!==Fi(n.prev,n,n.next))n=n.next;else{if(qi(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function _i(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Bi(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?ki(t,n,i,o):Ai(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),qi(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?_i(t=zi(t,e,r),e,r,n,i,o,2):2===a&&Si(t,e,r,n,i,o):_i(wi(t),e,r,n,i,o,1);break}}}function Ai(t){var e=t.prev,r=t,n=t.next;if(Fi(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Ii(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Fi(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ki(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Fi(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,p=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=Bi(s,u,e,r,n),h=Bi(l,p,e,r,n),f=t.prevZ,y=t.nextZ;f&&f.z>=c&&y&&y.z<=h;){if(f!==t.prev&&f!==t.next&&Ii(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Fi(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,y!==t.prev&&y!==t.next&&Ii(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&Fi(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&Ii(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Fi(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;y&&y.z<=h;){if(y!==t.prev&&y!==t.next&&Ii(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&Fi(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function zi(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Pi(i,o)&&Ti(i,n,n.next,o)&&Oi(i,o)&&Oi(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),qi(n),qi(n.next),n=t=o),n=n.next}while(n!==t);return n}function Si(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ei(a,s)){var u=Li(a,s);return a=wi(a,a.next),u=wi(u,u.next),_i(a,e,r,n,i,o),void _i(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function Mi(t,e){return t.x-e.x}function Vi(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var u,l=r,p=r.x,c=r.y,h=1/0;for(n=r.next;n!==l;)i>=n.x&&n.x>=p&&i!==n.x&&Ii(o<c?i:a,o,p,c,o<c?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<h||u===h&&n.x>r.x)&&Oi(n,t)&&(r=n,h=u),n=n.next;return r}(t,e)){var r=Li(e,t);wi(r,r.next)}}function Bi(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ci(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Ii(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Ei(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ti(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Oi(t,e)&&Oi(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function Fi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Pi(t,e){return t.x===e.x&&t.y===e.y}function Ti(t,e,r,n){return!!(Pi(t,e)&&Pi(r,n)||Pi(t,n)&&Pi(r,e))||Fi(t,e,r)>0!=Fi(t,e,n)>0&&Fi(r,n,t)>0!=Fi(r,n,e)>0}function Oi(t,e){return Fi(t.prev,t,t.next)<0?Fi(t,e,t.next)>=0&&Fi(t,t.prev,e)>=0:Fi(t,e,t.prev)<0||Fi(t,t.next,e)<0}function Li(t,e){var r=new Ri(t.i,t.x,t.y),n=new Ri(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function ji(t,e,r,n){var i=new Ri(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function qi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ri(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ui(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}xi.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(Ui(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*r,p=s<u-1?e[s+1]*r:t.length;a-=Math.abs(Ui(t,l,p,r))}var c=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,f=n[s+1]*r,y=n[s+2]*r;c+=Math.abs((t[h]-t[y])*(t[f+1]-t[h+1])-(t[h]-t[f])*(t[y+1]-t[h+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},xi.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r},mi.default=gi;var Di=Zi,Ni=Zi;function Zi(t,e,r,n,i){!function t(e,r,n,i,o){for(;i>n;){if(i-n>600){var a=i-n+1,s=r-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*l/a+p)),Math.min(i,Math.floor(r+(a-s)*l/a+p)),o)}var f=e[r],y=n,d=i;for(Ki(e,n,r),o(e[i],f)>0&&Ki(e,n,i);y<d;){for(Ki(e,y,d),y++,d--;o(e[y],f)<0;)y++;for(;o(e[d],f)>0;)d--}0===o(e[n],f)?Ki(e,n,d):Ki(e,++d,i),d<=r&&(n=d+1),r<=d&&(i=d-1)}}(t,e,r||0,n||t.length-1,i||Ji)}function Ki(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Ji(t,e){return t<e?-1:t>e?1:0}function $i(t,e){var r=t.length;if(r<=1)return[t];for(var n,i,o=[],a=0;a<r;a++){var s=_(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(Di(o[u],e,1,o[u].length-1,Hi),o[u]=o[u].slice(0,e));return o}function Hi(t,e){return e.area-t.area}Di.default=Ni;var Xi=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Xr,this.indexArray=new pn,this.indexArray2=new cn,this.programConfigurations=new En(vi,t.layers,t.zoom),this.segments=new zn,this.segments2=new zn};Xi.prototype.populate=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Br(this.zoom),o)){var u=Ln(o);this.addFeature(o,u),e.featureIndex.insert(o,u,a,s,this.index)}}},Xi.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Xi.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vi),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2),this.programConfigurations.upload(t)},Xi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Xi.prototype.addFeature=function(t,e){for(var r=0,n=$i(e,500);r<n.length;r+=1){for(var i=n[r],o=0,a=0,s=i;a<s.length;a+=1)o+=s[a].length;for(var u=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),l=u.vertexLength,p=[],c=[],h=0,f=i;h<f.length;h+=1){var y=f[h];if(0!==y.length){y!==i[0]&&c.push(p.length/2);var d=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),v=d.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(v+y.length-1,v),p.push(y[0].x),p.push(y[0].y);for(var m=1;m<y.length;m++)this.layoutVertexArray.emplaceBack(y[m].x,y[m].y),this.indexArray2.emplaceBack(v+m-1,v+m),p.push(y[m].x),p.push(y[m].y);d.vertexLength+=y.length,d.primitiveLength+=y.length}}for(var g=mi(p,c),x=0;x<g.length;x+=3)this.indexArray.emplaceBack(l+g[x],l+g[x+1],l+g[x+2]);u.vertexLength+=o,u.primitiveLength+=g.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hr("FillBucket",Xi,{omit:["layers"]});var Gi={paint:new Dr({"fill-antialias":new jr(E.paint_fill["fill-antialias"]),"fill-opacity":new qr(E.paint_fill["fill-opacity"]),"fill-color":new qr(E.paint_fill["fill-color"]),"fill-outline-color":new qr(E.paint_fill["fill-outline-color"]),"fill-translate":new jr(E.paint_fill["fill-translate"]),"fill-translate-anchor":new jr(E.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rr(E.paint_fill["fill-pattern"])})},Yi=function(t){function e(e){t.call(this,e,Gi)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t);var e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new Xi(t)},e.prototype.queryRadius=function(){return Yn(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o){return Un(Wn(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),i.angle,o),r)},e}(Nr),Wi=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Qi=Math.pow(2,13);function to(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,2*Math.floor(n*Qi)+a,i*Qi*2,o*Qi*2,Math.round(s))}var eo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Yr,this.indexArray=new pn,this.programConfigurations=new En(Wi,t.layers,t.zoom),this.segments=new zn};function ro(t,e){return t.x===e.x&&(t.x<0||t.x>Pn)||t.y===e.y&&(t.y<0||t.y>Pn)}function no(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>Pn})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>Pn})}eo.prototype.populate=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Br(this.zoom),o)){var u=Ln(o);this.addFeature(o,u),e.featureIndex.insert(o,u,a,s,this.index)}}},eo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},eo.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wi),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},eo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},eo.prototype.addFeature=function(t,e){for(var r=0,n=$i(e,500);r<n.length;r+=1){for(var i=n[r],o=0,a=0,s=i;a<s.length;a+=1)o+=s[a].length;for(var u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),l=0,p=i;l<p.length;l+=1){var c=p[l];if(0!==c.length&&!no(c))for(var h=0,f=0;f<c.length;f++){var y=c[f];if(f>=1){var d=c[f-1];if(!ro(y,d)){u.vertexLength+4>zn.MAX_VERTEX_ARRAY_LENGTH&&(u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var v=y.sub(d)._perp()._unit(),m=d.dist(y);h+m>32768&&(h=0),to(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,0,h),to(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,1,h),h+=m,to(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,0,h),to(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,1,h);var g=u.vertexLength;this.indexArray.emplaceBack(g,g+1,g+2),this.indexArray.emplaceBack(g+1,g+2,g+3),u.vertexLength+=4,u.primitiveLength+=2}}}}u.vertexLength+o>zn.MAX_VERTEX_ARRAY_LENGTH&&(u=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var x=[],b=[],w=u.vertexLength,_=0,A=i;_<A.length;_+=1){var k=A[_];if(0!==k.length){k!==i[0]&&b.push(x.length/2);for(var z=0;z<k.length;z++){var S=k[z];to(this.layoutVertexArray,S.x,S.y,0,0,1,1,0),x.push(S.x),x.push(S.y)}}}for(var M=mi(x,b),V=0;V<M.length;V+=3)this.indexArray.emplaceBack(w+M[V],w+M[V+1],w+M[V+2]);u.primitiveLength+=M.length/3,u.vertexLength+=o}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hr("FillExtrusionBucket",eo,{omit:["layers"]});var io={paint:new Dr({"fill-extrusion-opacity":new jr(E["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qr(E["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jr(E["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jr(E["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rr(E["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qr(E["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qr(E["paint_fill-extrusion"]["fill-extrusion-base"])})},oo=function(t){function e(e){t.call(this,e,io)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new eo(t)},e.prototype.queryRadius=function(){return Yn(this.paint.get("fill-extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o){return Un(Wn(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),i.angle,o),r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null)},e}(Nr),ao=$r([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,so=uo;function uo(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(lo,this,e)}function lo(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function po(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n+=((r=t[a]).x-e.x)*(e.y+r.y);return n}uo.types=["Unknown","Point","LineString","Polygon"],uo.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,i=0,o=0,a=0,u=[];t.pos<r;){if(i<=0){var l=t.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&u.push(e),e=[]),e.push(new s(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&u.push(e),u},uo.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(n<=0){var p=t.readVarint();r=7&p,n=p>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,u,s,l]},uo.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=uo.types[this.type];function p(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(n=0;n<u.length;n++)c[n]=u[n][0];p(u=c);break;case 2:for(n=0;n<u.length;n++)p(u[n]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=po(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)p(u[n][i])}1===u.length?u=u[0]:l="Multi"+l;var h={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(h.id=this.id),h};var co=ho;function ho(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(fo,this,e),this.length=this._features.length}function fo(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function yo(t,e,r){if(3===t){var n=new co(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}ho.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new so(this._pbf,e,this.extent,this._keys,this._values)};var vo={VectorTile:function(t,e){this.layers=t.readFields(yo,{},e)},VectorTileFeature:so,VectorTileLayer:co},mo=vo.VectorTileFeature.types,go=63,xo=Math.cos(Math.PI/180*37.5),bo=.5,wo=Math.pow(2,14)/bo;function _o(t,e,r,n,i,o,a){t.emplaceBack(e.x,e.y,n?1:0,i?1:-1,Math.round(go*r.x)+128,Math.round(go*r.y)+128,1+(0===o?0:o<0?-1:1)|(a*bo&63)<<2,a*bo>>6)}var Ao=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Wr,this.indexArray=new pn,this.programConfigurations=new En(ao,t.layers,t.zoom),this.segments=new zn};function ko(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(wo-1)}Ao.prototype.populate=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Br(this.zoom),o)){var u=Ln(o);this.addFeature(o,u),e.featureIndex.insert(o,u,a,s,this.index)}}},Ao.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ao.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},Ao.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ao.prototype.addFeature=function(t,e){for(var r=this.layers[0].layout,n=r.get("line-join").evaluate(t),i=r.get("line-cap"),o=r.get("line-miter-limit"),a=r.get("line-round-limit"),s=0,u=e;s<u.length;s+=1){var l=u[s];this.addLine(l,t,n,i,o,a)}},Ao.prototype.addLine=function(t,e,r,n,i,o){var a=null;e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")&&(a={start:e.properties.mapbox_clip_start,end:e.properties.mapbox_clip_end,tileTotal:void 0});for(var s="Polygon"===mo[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){a&&(a.tileTotal=function(t,e,r){for(var n,i,o=0,a=l;a<r-1;a++)n=t[a],i=t[a+1],o+=n.dist(i);return o}(t,0,u)),"bevel"===r&&(i=1.05);var p=Pn/(512*this.overscaling)*15,c=t[l],h=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var f,y,d,v=n,m=s?"butt":n,g=!0,x=void 0,b=void 0,w=void 0,_=void 0;this.e1=this.e2=this.e3=-1,s&&(f=t[u-2],_=c.sub(f)._unit()._perp());for(var A=l;A<u;A++)if(!(b=s&&A===u-1?t[l+1]:t[A+1])||!t[A].equals(b)){_&&(w=_),f&&(x=f),f=t[A],_=b?b.sub(f)._unit()._perp():w;var k=(w=w||_).add(_);0===k.x&&0===k.y||k._unit();var z=k.x*_.x+k.y*_.y,S=0!==z?1/z:1/0,M=z<xo&&x&&b;if(M&&A>l){var V=f.dist(x);if(V>2*p){var B=f.sub(f.sub(x)._mult(p/V)._round());this.distance+=B.dist(x),this.addCurrentVertex(B,this.distance,w.mult(1),0,0,!1,h,a),x=B}}var C=x&&b,I=C?r:b?v:m;if(C&&"round"===I&&(S<o?I="miter":S<=2&&(I="fakeround")),"miter"===I&&S>i&&(I="bevel"),"bevel"===I&&(S>2&&(I="flipbevel"),S<i&&(I="miter")),x&&(this.distance+=f.dist(x)),"miter"===I)k._mult(S),this.addCurrentVertex(f,this.distance,k,0,0,!1,h,a);else if("flipbevel"===I){if(S>100)k=_.clone().mult(-1);else{var E=w.x*_.y-w.y*_.x>0?-1:1,F=S*w.add(_).mag()/w.sub(_).mag();k._perp()._mult(F*E)}this.addCurrentVertex(f,this.distance,k,0,0,!1,h,a),this.addCurrentVertex(f,this.distance,k.mult(-1),0,0,!1,h,a)}else if("bevel"===I||"fakeround"===I){var P=w.x*_.y-w.y*_.x>0,T=-Math.sqrt(S*S-1);if(P?(d=0,y=T):(y=0,d=T),g||this.addCurrentVertex(f,this.distance,w,y,d,!1,h,a),"fakeround"===I){for(var O=Math.floor(8*(.5-(z-.5))),L=void 0,j=0;j<O;j++)L=_.mult((j+1)/(O+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,L,P,h,a);this.addPieSliceVertex(f,this.distance,k,P,h,a);for(var q=O-1;q>=0;q--)L=w.mult((q+1)/(O+1))._add(_)._unit(),this.addPieSliceVertex(f,this.distance,L,P,h,a)}b&&this.addCurrentVertex(f,this.distance,_,-y,-d,!1,h,a)}else"butt"===I?(g||this.addCurrentVertex(f,this.distance,w,0,0,!1,h,a),b&&this.addCurrentVertex(f,this.distance,_,0,0,!1,h,a)):"square"===I?(g||(this.addCurrentVertex(f,this.distance,w,1,1,!1,h,a),this.e1=this.e2=-1),b&&this.addCurrentVertex(f,this.distance,_,-1,-1,!1,h,a)):"round"===I&&(g||(this.addCurrentVertex(f,this.distance,w,0,0,!1,h,a),this.addCurrentVertex(f,this.distance,w,1,1,!0,h,a),this.e1=this.e2=-1),b&&(this.addCurrentVertex(f,this.distance,_,-1,-1,!0,h,a),this.addCurrentVertex(f,this.distance,_,0,0,!1,h,a)));if(M&&A<u-1){var R=f.dist(b);if(R>2*p){var U=f.add(b.sub(f)._mult(p/R)._round());this.distance+=U.dist(f),this.addCurrentVertex(U,this.distance,_.mult(1),0,0,!1,h,a),f=U}}g=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)}},Ao.prototype.addCurrentVertex=function(t,e,r,n,i,o,a,s){var u,l=this.layoutVertexArray,p=this.indexArray;s&&(e=ko(e,s)),u=r.clone(),n&&u._sub(r.perp()._mult(n)),_o(l,t,u,o,!1,n,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),i&&u._sub(r.perp()._mult(i)),_o(l,t,u,o,!0,-i,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>wo/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,n,i,o,a))},Ao.prototype.addPieSliceVertex=function(t,e,r,n,i,o){r=r.mult(n?-1:1);var a=this.layoutVertexArray,s=this.indexArray;o&&(e=ko(e,o)),_o(a,t,r,!1,n,0,e),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3},hr("LineBucket",Ao,{omit:["layers"]});var zo=new Dr({"line-cap":new jr(E.layout_line["line-cap"]),"line-join":new qr(E.layout_line["line-join"]),"line-miter-limit":new jr(E.layout_line["line-miter-limit"]),"line-round-limit":new jr(E.layout_line["line-round-limit"])}),So={paint:new Dr({"line-opacity":new qr(E.paint_line["line-opacity"]),"line-color":new qr(E.paint_line["line-color"]),"line-translate":new jr(E.paint_line["line-translate"]),"line-translate-anchor":new jr(E.paint_line["line-translate-anchor"]),"line-width":new qr(E.paint_line["line-width"]),"line-gap-width":new qr(E.paint_line["line-gap-width"]),"line-offset":new qr(E.paint_line["line-offset"]),"line-blur":new qr(E.paint_line["line-blur"]),"line-dasharray":new Rr(E.paint_line["line-dasharray"]),"line-pattern":new Rr(E.paint_line["line-pattern"]),"line-gradient":new Ur(E.paint_line["line-gradient"])}),layout:zo},Mo=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new Br(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n){return r=h({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n)},e}(qr))(So.paint.properties["line-width"].specification);Mo.useIntegerZoom=!0;var Vo=function(t){function e(e){t.call(this,e,So)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setPaintProperty=function(e,r,n){t.prototype.setPaintProperty.call(this,e,r,n),"line-gradient"===e&&this._updateGradient()},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=hi(t,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=Mo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ao(t)},e.prototype.queryRadius=function(t){var e=t,r=Bo(Gn("line-width",this,e),Gn("line-gap-width",this,e)),n=Gn("line-offset",this,e);return r/2+Math.abs(n)+Yn(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o){var a=Wn(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),i.angle,o),u=o/2*Bo(this.paint.get("line-width").evaluate(e),this.paint.get("line-gap-width").evaluate(e)),l=this.paint.get("line-offset").evaluate(e);return l&&(r=function(t,e){for(var r=[],n=new s(0,0),i=0;i<t.length;i++){for(var o=t[i],a=[],u=0;u<o.length;u++){var l=o[u-1],p=o[u],c=o[u+1],h=0===u?n:p.sub(l)._unit()._perp(),f=u===o.length-1?n:c.sub(p)._unit()._perp(),y=h._add(f)._unit(),d=y.x*f.x+y.y*f.y;y._mult(1/d),a.push(y._mult(e)._add(p))}r.push(a)}return r}(r,l*o)),Dn(a,r,u)},e}(Nr);function Bo(t,e){return e>0?e+2*t:t}var Co=$r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),Io=$r([{name:"a_projected_pos",components:3,type:"Float32"}],4),Eo=($r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),$r([{name:"a_placed",components:2,type:"Uint8"}],4)),Fo=($r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Po=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function To(t,e,r){var n=e.layout.get("text-transform").evaluate(r);return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Vr.applyArabicShaping&&(t=Vr.applyArabicShaping(t)),t}$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),$r([{type:"Float32",name:"offsetX"}]),$r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Oo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Lo=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(s);function jo(t,e){var r=e.expression;if("constant"===r.kind)return{functionType:"constant",layoutSize:r.evaluate(new Br(t+1))};if("source"===r.kind)return{functionType:"source"};for(var n=r.zoomStops,i=0;i<n.length&&n[i]<=t;)i++;for(var o=i=Math.max(0,i-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var a={min:n[i],max:n[o]};return"composite"===r.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:r.evaluate(new Br(t+1)),zoomRange:a,sizeRange:{min:r.evaluate(new Br(a.min)),max:r.evaluate(new Br(a.max))},propertyValue:e.value}}hr("Anchor",Lo);var qo=vo.VectorTileFeature.types,Ro=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uo(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),o,a,s?s[0]:0,s?s[1]:0)}function Do(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}var No=function(t){this.layoutVertexArray=new Qr,this.indexArray=new pn,this.programConfigurations=t,this.segments=new zn,this.dynamicLayoutVertexArray=new tn,this.opacityVertexArray=new en,this.placedSymbolArray=new mn};No.prototype.upload=function(t,e){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Co.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.programConfigurations.upload(t),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Io.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ro,!0),this.opacityVertexBuffer.itemSize=1},No.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},hr("SymbolBuffers",No);var Zo=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new zn,this.collisionVertexArray=new on};Zo.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Eo.members,!0)},Zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},hr("CollisionBuffers",Zo);var Ko=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jo(this.zoom,e["text-size"]),this.iconSizeData=jo(this.zoom,e["icon-size"]);var r=this.layers[0].layout;this.sortFeaturesByY=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")};Ko.prototype.createArrays=function(){this.text=new No(new En(Co.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new No(new En(Co.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Zo(nn,Fo.members,cn),this.collisionCircle=new Zo(nn,Po.members,pn),this.glyphOffsetArray=new xn,this.lineVertexArray=new wn},Ko.prototype.populate=function(t,e){var r=this.layers[0],n=r.layout,i=n.get("text-font"),o=n.get("text-field"),a=n.get("icon-image"),s=("constant"!==o.value.kind||o.value.value.length>0)&&("constant"!==i.value.kind||i.value.value.length>0),u="constant"!==a.value.kind||a.value.value&&a.value.value.length>0;if(this.features=[],s||u){for(var l=e.iconDependencies,p=e.glyphDependencies,c=new Br(this.zoom),h=0,f=t;h<f.length;h+=1){var y=f[h],d=y.feature,v=y.index,m=y.sourceLayerIndex;if(r._featureFilter(c,d)){var g=void 0;s&&(g=To(g=r.getValueAndResolveTokens("text-field",d),r,d));var x=void 0;if(u&&(x=r.getValueAndResolveTokens("icon-image",d)),g||x){var b={text:g,icon:x,index:v,sourceLayerIndex:m,geometry:Ln(d),properties:d.properties,type:qo[d.type]};if(void 0!==d.id&&(b.id=d.id),this.features.push(b),x&&(l[x]=!0),g)for(var w=i.evaluate(d).join(","),_=p[w]=p[w]||{},A="map"===n.get("text-rotation-alignment")&&"line"===n.get("symbol-placement"),k=gr(g),z=0;z<g.length;z++)if(_[g.charCodeAt(z)]=!0,A&&k){var S=Oo[g.charAt(z)];S&&(_[S.charCodeAt(0)]=!0)}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function o(e){n.push(t[e]),i++}function a(t,e,i){var o=r[t];return delete r[t],r[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function s(t,r,i){var o=e[r];return delete e[r],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function u(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var l=0;l<t.length;l++){var p=t[l],c=p.geometry,h=p.text;if(h){var f=u(h,c),y=u(h,c,!0);if(f in r&&y in e&&r[f]!==e[y]){var d=s(f,y,c),v=a(f,y,n[d].geometry);delete e[f],delete r[y],r[u(h,n[v].geometry,!0)]=v,n[d].geometry=null}else f in r?a(f,y,c):y in e?s(f,y,c):(o(l),e[f]=i-1,r[y]=i-1)}else o(l)}return n.filter(function(t){return t.geometry})}(this.features))}},Ko.prototype.isEmpty=function(){return 0===this.symbolInstances.length},Ko.prototype.upload=function(t){this.text.upload(t,this.sortFeaturesByY),this.icon.upload(t,this.sortFeaturesByY),this.collisionBox.upload(t),this.collisionCircle.upload(t)},Ko.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},Ko.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Ko.prototype.addSymbols=function(t,e,r,n,i,o,a,s,u,l){for(var p=t.indexArray,c=t.layoutVertexArray,h=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),y=this.glyphOffsetArray.length,d=f.vertexLength,v=0,m=e;v<m.length;v+=1){var g=m[v],x=g.tl,b=g.tr,w=g.bl,_=g.br,A=g.tex,k=f.vertexLength,z=g.glyphOffset[1];Uo(c,s.x,s.y,x.x,z+x.y,A.x,A.y,r),Uo(c,s.x,s.y,b.x,z+b.y,A.x+A.w,A.y,r),Uo(c,s.x,s.y,w.x,z+w.y,A.x,A.y+A.h,r),Uo(c,s.x,s.y,_.x,z+_.y,A.x+A.w,A.y+A.h,r),Do(h,s,0),p.emplaceBack(k,k+1,k+2),p.emplaceBack(k+1,k+2,k+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(g.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,y,this.glyphOffsetArray.length-y,d,u,l,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o)},Ko.prototype._addCollisionDebugVertex=function(t,e,r,n,i){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n.x,n.y,Math.round(i.x),Math.round(i.y))},Ko.prototype.addCollisionDebugVertices=function(t,e,r,n,i,o,a,u){var l=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),p=l.vertexLength,c=i.layoutVertexArray,h=i.collisionVertexArray;if(this._addCollisionDebugVertex(c,h,o,a.anchor,new s(t,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new s(r,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new s(r,n)),this._addCollisionDebugVertex(c,h,o,a.anchor,new s(t,n)),l.vertexLength+=4,u){var f=i.indexArray;f.emplaceBack(p,p+1,p+2),f.emplaceBack(p,p+2,p+3),l.primitiveLength+=2}else{var y=i.indexArray;y.emplaceBack(p,p+1),y.emplaceBack(p+1,p+2),y.emplaceBack(p+2,p+3),y.emplaceBack(p+3,p),l.primitiveLength+=4}},Ko.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var r=e[t];r.textCollisionFeature={boxStartIndex:r.textBoxStartIndex,boxEndIndex:r.textBoxEndIndex},r.iconCollisionFeature={boxStartIndex:r.iconBoxStartIndex,boxEndIndex:r.iconBoxEndIndex};for(var n=0;n<2;n++){var i=r[0===n?"textCollisionFeature":"iconCollisionFeature"];if(i)for(var o=i.boxStartIndex;o<i.boxEndIndex;o++){var a=this.collisionBoxArray.get(o),s=a.x1,u=a.y1,l=a.x2,p=a.y2,c=a.radius>0;this.addCollisionDebugVertices(s,u,l,p,c?this.collisionCircle:this.collisionBox,a.anchorPoint,r,c)}}}},Ko.prototype.deserializeCollisionBoxes=function(t,e,r,n,i){for(var o={},a=e;a<r;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},o.textFeatureIndex=s.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=s.featureIndex),o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var u=n;u<i;u++){var l=t.get(u);if(0===l.radius){o.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},o.iconFeatureIndex=l.featureIndex;break}}return o},Ko.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ko.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ko.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},Ko.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},Ko.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],n=0;n<this.symbolInstances.length;n++)r.push(n);var i=Math.sin(t),o=Math.cos(t);r.sort(function(t,r){var n=e.symbolInstances[t],a=e.symbolInstances[r];return(i*n.anchor.x+o*n.anchor.y|0)-(i*a.anchor.x+o*a.anchor.y|0)||a.featureIndex-n.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var a=0,s=r;a<s.length;a+=1){var u=s[a],l=e.symbolInstances[u];e.featureSortOrder.push(l.featureIndex);for(var p=0,c=l.placedTextSymbolIndices;p<c.length;p+=1)for(var h=c[p],f=e.text.placedSymbolArray.get(h),y=f.vertexStartIndex+4*f.numGlyphs,d=f.vertexStartIndex;d<y;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var v=e.icon.placedSymbolArray.get(u);if(v.numGlyphs){var m=v.vertexStartIndex;e.icon.indexArray.emplaceBack(m,m+1,m+2),e.icon.indexArray.emplaceBack(m+1,m+2,m+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},hr("SymbolBucket",Ko,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),Ko.MAX_GLYPHS=65535,Ko.addDynamicAttributes=Do;var Jo=new Dr({"symbol-placement":new jr(E.layout_symbol["symbol-placement"]),"symbol-spacing":new jr(E.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jr(E.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new jr(E.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jr(E.layout_symbol["icon-ignore-placement"]),"icon-optional":new jr(E.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jr(E.layout_symbol["icon-rotation-alignment"]),"icon-size":new qr(E.layout_symbol["icon-size"]),"icon-text-fit":new jr(E.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jr(E.layout_symbol["icon-text-fit-padding"]),"icon-image":new qr(E.layout_symbol["icon-image"]),"icon-rotate":new qr(E.layout_symbol["icon-rotate"]),"icon-padding":new jr(E.layout_symbol["icon-padding"]),"icon-keep-upright":new jr(E.layout_symbol["icon-keep-upright"]),"icon-offset":new qr(E.layout_symbol["icon-offset"]),"icon-anchor":new qr(E.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jr(E.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jr(E.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jr(E.layout_symbol["text-rotation-alignment"]),"text-field":new qr(E.layout_symbol["text-field"]),"text-font":new qr(E.layout_symbol["text-font"]),"text-size":new qr(E.layout_symbol["text-size"]),"text-max-width":new qr(E.layout_symbol["text-max-width"]),"text-line-height":new jr(E.layout_symbol["text-line-height"]),"text-letter-spacing":new qr(E.layout_symbol["text-letter-spacing"]),"text-justify":new qr(E.layout_symbol["text-justify"]),"text-anchor":new qr(E.layout_symbol["text-anchor"]),"text-max-angle":new jr(E.layout_symbol["text-max-angle"]),"text-rotate":new qr(E.layout_symbol["text-rotate"]),"text-padding":new jr(E.layout_symbol["text-padding"]),"text-keep-upright":new jr(E.layout_symbol["text-keep-upright"]),"text-transform":new qr(E.layout_symbol["text-transform"]),"text-offset":new qr(E.layout_symbol["text-offset"]),"text-allow-overlap":new jr(E.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jr(E.layout_symbol["text-ignore-placement"]),"text-optional":new jr(E.layout_symbol["text-optional"])}),$o={paint:new Dr({"icon-opacity":new qr(E.paint_symbol["icon-opacity"]),"icon-color":new qr(E.paint_symbol["icon-color"]),"icon-halo-color":new qr(E.paint_symbol["icon-halo-color"]),"icon-halo-width":new qr(E.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qr(E.paint_symbol["icon-halo-blur"]),"icon-translate":new jr(E.paint_symbol["icon-translate"]),"icon-translate-anchor":new jr(E.paint_symbol["icon-translate-anchor"]),"text-opacity":new qr(E.paint_symbol["text-opacity"]),"text-color":new qr(E.paint_symbol["text-color"]),"text-halo-color":new qr(E.paint_symbol["text-halo-color"]),"text-halo-width":new qr(E.paint_symbol["text-halo-width"]),"text-halo-blur":new qr(E.paint_symbol["text-halo-blur"]),"text-translate":new jr(E.paint_symbol["text-translate"]),"text-translate-anchor":new jr(E.paint_symbol["text-translate-anchor"])}),layout:Jo},Ho=function(t){function e(e){t.call(this,e,$o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var r,n=this.layout.get(t).evaluate(e),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||be(i.value)?n:(r=e.properties,n.replace(/{([^{}]+)}/g,function(t,e){return e in r?String(r[e]):""}))},e.prototype.createBucket=function(t){return new Ko(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Nr),Xo={paint:new Dr({"background-color":new jr(E.paint_background["background-color"]),"background-pattern":new Rr(E.paint_background["background-pattern"]),"background-opacity":new jr(E.paint_background["background-opacity"])})},Go=function(t){function e(e){t.call(this,e,Xo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Nr),Yo={paint:new Dr({"raster-opacity":new jr(E.paint_raster["raster-opacity"]),"raster-hue-rotate":new jr(E.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jr(E.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jr(E.paint_raster["raster-brightness-max"]),"raster-saturation":new jr(E.paint_raster["raster-saturation"]),"raster-contrast":new jr(E.paint_raster["raster-contrast"]),"raster-fade-duration":new jr(E.paint_raster["raster-fade-duration"])})},Wo={circle:ni,heatmap:fi,hillshade:di,fill:Yi,"fill-extrusion":oo,line:Vo,symbol:Ho,background:Go,raster:function(t){function e(e){t.call(this,e,Yo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Nr)},Qo=n(function(t,e){t.exports=function(){function t(t,e,r){r=r||{},this.w=t||64,this.h=e||64,this.autoResize=!!r.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,r){this.x=0,this.y=t,this.w=this.free=e,this.h=r}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var r,n,i,o,a=[],s=0;s<t.length;s++)if(r=t[s].w||t[s].width,n=t[s].h||t[s].height,i=t[s].id,r&&n){if(!(o=this.packOne(r,n,i)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}return this.shrink(),a},t.prototype.packOne=function(t,r,n){var i,o,a,s,u,l,p,c,h={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof n||"number"==typeof n){if(i=this.getBin(n))return this.ref(i),i;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(r===(i=this.freebins[s]).maxh&&t===i.maxw)return this.allocFreebin(s,t,r,n);r>i.maxh||t>i.maxw||r<=i.maxh&&t<=i.maxw&&(a=i.maxw*i.maxh-t*r)<h.waste&&(h.waste=a,h.freebin=s)}for(s=0;s<this.shelves.length;s++)if(f+=(o=this.shelves[s]).h,!(t>o.free)){if(r===o.h)return this.allocShelf(s,t,r,n);r>o.h||r<o.h&&(a=(o.h-r)*t)<h.waste&&(h.freebin=-1,h.waste=a,h.shelf=s)}return-1!==h.freebin?this.allocFreebin(h.freebin,t,r,n):-1!==h.shelf?this.allocShelf(h.shelf,t,r,n):r<=this.h-f&&t<=this.w?(o=new e(f,this.w,r),this.allocShelf(this.shelves.push(o)-1,t,r,n)):this.autoResize?(u=l=this.h,((p=c=this.w)<=u||t>p)&&(c=2*Math.max(t,p)),(u<p||r>u)&&(l=2*Math.max(r,u)),this.resize(c,l),this.packOne(t,r,n)):null},t.prototype.allocFreebin=function(t,e,r,n){var i=this.freebins.splice(t,1)[0];return i.id=n,i.w=e,i.h=r,i.refcount=0,this.bins[n]=i,this.ref(i),i},t.prototype.allocShelf=function(t,e,r,n){var i=this.shelves[t].alloc(e,r,n);return this.bins[n]=i,this.ref(i),i},t.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,r=0;r<this.shelves.length;r++){var n=this.shelves[r];e+=n.h,t=Math.max(n.w-n.free,t)}this.resize(t,e)}},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var r=0;r<this.shelves.length;r++)this.shelves[r].resize(t);return!0},e.prototype.alloc=function(t,e,r){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new function(t,e,r,n,i,o,a){this.id=t,this.x=e,this.y=r,this.w=n,this.h=i,this.maxw=o||n,this.maxh=a||i,this.refcount=0}(r,n,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t}()}),ta=function(t,e){var r=e.pixelRatio;this.paddedRect=t,this.pixelRatio=r},ea={tl:{configurable:!0},br:{configurable:!0},displaySize:{configurable:!0}};ea.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},ea.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},ea.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ta.prototype,ea);var ra=function(t){var e=new pi({width:0,height:0}),r={},n=new Qo(0,0,{autoResize:!0});for(var i in t){var o=t[i],a=n.packOne(o.data.width+2,o.data.height+2);e.resize({width:n.w,height:n.h}),pi.copy(o.data,e,{x:0,y:0},{x:a.x+1,y:a.y+1},o.data),r[i]=new ta(a,o)}n.shrink(),e.resize({width:n.w,height:n.h}),this.image=e,this.positions=r};hr("ImagePosition",ta),hr("ImageAtlas",ra);var na=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,p=-7,c=r?i-1:0,h=r?-1:1,f=t[e+c];for(c+=h,o=f&(1<<-p)-1,f>>=-p,p+=s;p>0;o=256*o+t[e+c],c+=h,p-=8);for(a=o&(1<<-p)-1,o>>=-p,p+=n;p>0;a=256*a+t[e+c],c+=h,p-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=l}return(f?-1:1)*a*Math.pow(2,o-n)},ia=function(t,e,r,n,i,o){var a,s,u,l=8*o-i-1,p=(1<<l)-1,c=p>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,y=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=p):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+c>=1?h/u:h*Math.pow(2,1-c))*u>=2&&(a++,u/=2),a+c>=p?(s=0,a=p):a+c>=1?(s=(e*u-1)*Math.pow(2,i),a+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;t[r+f]=255&s,f+=y,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[r+f]=255&a,f+=y,a/=256,l-=8);t[r+f-y]|=128*d},oa=aa;function aa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function sa(t){return t.type===aa.Bytes?t.readVarint()+t.pos:t.pos+1}function ua(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function la(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function pa(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function ca(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function ha(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function fa(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function ya(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function da(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function va(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function ma(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function ga(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function xa(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ba(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function wa(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}aa.Varint=0,aa.Fixed64=1,aa.Bytes=2,aa.Fixed32=5,aa.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=xa(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wa(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=xa(this.buf,this.pos)+4294967296*xa(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=xa(this.buf,this.pos)+4294967296*wa(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=na(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=na(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return ua(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return ua(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return ua(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return ua(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return ua(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return ua(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,u=t[i],l=null,p=u>239?4:u>223?3:u>191?2:1;if(i+p>r)break;1===p?u<128&&(l=u):2===p?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===p?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===p&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,p=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=p}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=sa(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=sa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===aa.Varint)for(;this.buf[this.pos++]>127;);else if(e===aa.Bytes)this.pos=this.readVarint()+this.pos;else if(e===aa.Fixed32)this.pos+=4;else{if(e!==aa.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ba(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ba(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ba(this.buf,-1&t,this.pos),ba(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ba(this.buf,-1&t,this.pos),ba(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&la(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),ia(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ia(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&la(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,aa.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,pa,e)},writePackedSVarint:function(t,e){this.writeMessage(t,ca,e)},writePackedBoolean:function(t,e){this.writeMessage(t,ya,e)},writePackedFloat:function(t,e){this.writeMessage(t,ha,e)},writePackedDouble:function(t,e){this.writeMessage(t,fa,e)},writePackedFixed32:function(t,e){this.writeMessage(t,da,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,va,e)},writePackedFixed64:function(t,e){this.writeMessage(t,ma,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,ga,e)},writeBytesField:function(t,e){this.writeTag(t,aa.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,aa.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,aa.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,aa.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,aa.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,aa.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,aa.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,aa.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,aa.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,aa.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var _a=3;function Aa(t,e,r){1===t&&r.readMessage(ka,e)}function ka(t,e,r){if(3===t){var n=r.readMessage(za,{}),i=n.id,o=n.bitmap,a=n.width,s=n.height,u=n.left,l=n.top,p=n.advance;e.push({id:i,bitmap:new li({width:a+2*_a,height:s+2*_a},o),metrics:{width:a,height:s,left:u,top:l,advance:p}})}}function za(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}var Sa=_a,Ma=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.callbackID=0,y(["receive"],this),this.target.addEventListener("message",this.receive,!1)};Ma.prototype.send=function(t,e,r,n){var i=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[i]=r);var o=[];this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:t,id:String(i),data:yr(e,o)},o)},Ma.prototype.receive=function(t){var e,r=this,n=t.data,i=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var o=function(t,e){var n=[];r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(i),error:t?yr(t):null,data:yr(e,n)},n)};if("<response>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&n.error?e(dr(n.error)):e&&e(null,dr(n.data));else if(void 0!==n.id&&this.parent[n.type])this.parent[n.type](n.sourceMapId,dr(n.data),o);else if(void 0!==n.id&&this.parent.getWorkerSource){var a=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,a[0],a[1])[a[2]](dr(n.data),o)}else this.parent[n.type](dr(n.data))}},Ma.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var Va=r(n(function(t,e){!function(t){function e(t,e,n){var i=r(256*t,256*(e=Math.pow(2,n)-e-1),n),o=r(256*(t+1),256*(e+1),n);return i[0]+","+i[1]+","+o[0]+","+o[1]}function r(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,r,n,i,o,a){return a=a||{},t+"?"+["bbox="+e(n,i,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+r].join("&")},t.getTileBBox=e,t.getMercCoords=r,Object.defineProperty(t,"__esModule",{value:!0})}(e)})),Ba=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Ea(0,t,e,r)};Ba.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Ba.prototype.url=function(t,e){var r=Va.getTileBBox(this.x,this.y,this.z),n=function(t,e,r){for(var n,i="",o=t;o>0;o--)i+=(e&(n=1<<o-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)};var Ca=function(t,e){this.wrap=t,this.canonical=e,this.key=Ea(t,e.z,e.x,e.y)},Ia=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Ba(r,+n,+i),this.key=Ea(e,t,n,i)};function Ea(t,e,r,n){(t*=2)<0&&(t=-1*t-1);var i=1<<e;return 32*(i*i*t+i*n+r)+e}Ia.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Ia.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Ia(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ia(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Ia.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Ia.prototype.children=function(t){if(this.overscaledZ>=t)return[new Ia(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Ia(e,this.wrap,e,r,n),new Ia(e,this.wrap,e,r+1,n),new Ia(e,this.wrap,e,r,n+1),new Ia(e,this.wrap,e,r+1,n+1)]},Ia.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Ia.prototype.wrapped=function(){return new Ia(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ia.prototype.unwrapTo=function(t){return new Ia(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Ia.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ia.prototype.toUnwrapped=function(){return new Ca(this.wrap,this.canonical)},Ia.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ia.prototype.toCoordinate=function(){return new a(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},hr("CanonicalTileID",Ba),hr("OverscaledTileID",Ia,{omit:["posMatrix"]});var Fa=function(t,e,r){if(t<=0)throw new RangeError("Level must have positive dimension");this.dim=t,this.border=e,this.stride=this.dim+2*this.border,this.data=r||new Int32Array((this.dim+2*this.border)*(this.dim+2*this.border))};Fa.prototype.set=function(t,e,r){this.data[this._idx(t,e)]=r+65536},Fa.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},Fa.prototype._idx=function(t,e){if(t<-this.border||t>=this.dim+this.border||e<-this.border||e>=this.dim+this.border)throw new RangeError("out of range source coordinates for DEM data");return(e+this.border)*this.stride+(t+this.border)},hr("Level",Fa);var Pa=function(t,e,r){this.uid=t,this.scale=e||1,this.level=r||new Fa(256,512),this.loaded=!!r};Pa.prototype.loadFromImage=function(t,e){if(t.height!==t.width)throw new RangeError("DEM tiles must be square");if(e&&"mapbox"!==e&&"terrarium"!==e)return b('"'+e+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');var r=this.level=new Fa(t.width,t.width/2),n=t.data;this._unpackData(r,n,e||"mapbox");for(var i=0;i<r.dim;i++)r.set(-1,i,r.get(0,i)),r.set(r.dim,i,r.get(r.dim-1,i)),r.set(i,-1,r.get(i,0)),r.set(i,r.dim,r.get(i,r.dim-1));r.set(-1,-1,r.get(0,0)),r.set(r.dim,-1,r.get(r.dim-1,0)),r.set(-1,r.dim,r.get(0,r.dim-1)),r.set(r.dim,r.dim,r.get(r.dim-1,r.dim-1)),this.loaded=!0},Pa.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Pa.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Pa.prototype._unpackData=function(t,e,r){for(var n={mapbox:this._unpackMapbox,terrarium:this._unpackTerrarium}[r],i=0;i<t.dim;i++)for(var o=0;o<t.dim;o++){var a=4*(i*t.dim+o);t.set(o,i,this.scale*n(e[a],e[a+1],e[a+2]))}},Pa.prototype.getPixels=function(){return new pi({width:this.level.dim+2*this.level.border,height:this.level.dim+2*this.level.border},new Uint8Array(this.level.data.buffer))},Pa.prototype.backfillBorder=function(t,e,r){var n=this.level,i=t.level;if(n.dim!==i.dim)throw new Error("level mismatch (dem dimension)");var o=e*n.dim,a=e*n.dim+n.dim,s=r*n.dim,u=r*n.dim+n.dim;switch(e){case-1:o=a-1;break;case 1:a=o+1}switch(r){case-1:s=u-1;break;case 1:u=s+1}for(var l=c(o,-n.border,n.dim+n.border),p=c(a,-n.border,n.dim+n.border),h=c(s,-n.border,n.dim+n.border),f=c(u,-n.border,n.dim+n.border),y=-e*n.dim,d=-r*n.dim,v=h;v<f;v++)for(var m=l;m<p;m++)n.set(m,v,i.get(m+y,v+d))},hr("DEMData",Pa);var Ta=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Ta.prototype.encode=function(t){return this._stringToNumber[t]},Ta.prototype.decode=function(t){return this._numberToString[t]};var Oa=function(t,e,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},La={geometry:{configurable:!0}};La.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},La.geometry.set=function(t){this._geometry=t},Oa.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Oa.prototype,La);var ja=function(t,e,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new sr(Pn,16,0),this.featureIndexArray=r||new An};function qa(t,e){return e-t}ja.prototype.insert=function(t,e,r,n,i){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var a=0;a<e.length;a++){for(var s=e[a],u=[1/0,1/0,-1/0,-1/0],l=0;l<s.length;l++){var p=s[l];u[0]=Math.min(u[0],p.x),u[1]=Math.min(u[1],p.y),u[2]=Math.max(u[2],p.x),u[3]=Math.max(u[3],p.y)}u[0]<Pn&&u[1]<Pn&&u[2]>=0&&u[3]>=0&&this.grid.insert(o,u[0],u[1],u[2],u[3])}},ja.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new vo.VectorTile(new oa(this.rawTileData)).layers,this.sourceLayerCoder=new Ta(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ja.prototype.query=function(t,e){var r=this;this.loadVTLayers();for(var n=t.params||{},i=Pn/t.tileSize/t.scale,o=Te(n.filter),a=t.queryGeometry,s=t.queryPadding*i,u=1/0,l=1/0,p=-1/0,c=-1/0,h=0;h<a.length;h++)for(var f=a[h],y=0;y<f.length;y++){var d=f[y];u=Math.min(u,d.x),l=Math.min(l,d.y),p=Math.max(p,d.x),c=Math.max(c,d.y)}var v=this.grid.query(u-s,l-s,p+s,c+s);v.sort(qa);for(var m,g={},x=function(s){var u=v[s];if(u!==m){m=u;var l=r.featureIndexArray.get(u),p=null;r.loadMatchingFeature(g,l.bucketIndex,l.sourceLayerIndex,l.featureIndex,o,n.layers,e,function(e,n){return p||(p=Ln(e)),n.queryIntersectsFeature(a,e,p,r.z,t.transform,i,t.posMatrix)})}},b=0;b<v.length;b++)x(b);return g},ja.prototype.loadMatchingFeature=function(t,e,r,n,i,o,a,s){var u=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(o,u)){var l=this.sourceLayerCoder.decode(r),p=this.vtLayers[l].feature(n);if(i(new Br(this.tileID.overscaledZ),p))for(var c=0;c<u.length;c++){var h=u[c];if(!(o&&o.indexOf(h)<0)){var f=a[h];if(f&&(!s||s(p,f))){var y=new Oa(p,this.z,this.x,this.y);y.layer=f.serialize();var d=t[h];void 0===d&&(d=t[h]=[]),d.push({featureIndex:n,feature:y})}}}}},ja.prototype.lookupSymbolFeatures=function(t,e,r,n,i,o){var a={};this.loadVTLayers();for(var s=Te(n),u=0,l=t;u<l.length;u+=1){var p=l[u];this.loadMatchingFeature(a,e,r,p,s,i,o)}return a},ja.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},hr("FeatureIndex",ja,{omit:["rawTileData","sourceLayerCoder"]});var Ra={horizontal:1,vertical:2,horizontalOnly:3},Ua={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Da={};function Na(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Za(t,e){var r=0;return 10===t&&(r-=1e4),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Ka(t,e,r,n,i,o){for(var a=null,s=Na(e,r,i,o),u=0,l=n;u<l.length;u+=1){var p=l[u],c=Na(e-p.x,r,i,o)+p.badness;c<=s&&(a=p,s=c)}return{index:t,x:e,priorBreak:a,badness:s}}function Ja(t,e,r,n){if(!r)return[];if(!t)return[];for(var i,o=[],a=function(t,e,r,n){for(var i=0,o=0;o<t.length;o++){var a=n[t.charCodeAt(o)];a&&(i+=a.metrics.advance+e)}return i/Math.max(1,Math.ceil(i/r))}(t,e,r,n),s=0,u=0;u<t.length;u++){var l=t.charCodeAt(u),p=n[l];p&&!Ua[l]&&(s+=p.metrics.advance+e),u<t.length-1&&(Da[l]||!((i=l)<11904)&&(mr["Bopomofo Extended"](i)||mr.Bopomofo(i)||mr["CJK Compatibility Forms"](i)||mr["CJK Compatibility Ideographs"](i)||mr["CJK Compatibility"](i)||mr["CJK Radicals Supplement"](i)||mr["CJK Strokes"](i)||mr["CJK Symbols and Punctuation"](i)||mr["CJK Unified Ideographs Extension A"](i)||mr["CJK Unified Ideographs"](i)||mr["Enclosed CJK Letters and Months"](i)||mr["Halfwidth and Fullwidth Forms"](i)||mr.Hiragana(i)||mr["Ideographic Description Characters"](i)||mr["Kangxi Radicals"](i)||mr["Katakana Phonetic Extensions"](i)||mr.Katakana(i)||mr["Vertical Forms"](i)||mr["Yi Radicals"](i)||mr["Yi Syllables"](i)))&&o.push(Ka(u+1,s,a,o,Za(l,t.charCodeAt(u+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Ka(t.length,s,a,o,0,!0))}function $a(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Ha(t,e,r,n,i){if(i){var o=e[t[n].glyph];if(o)for(var a=o.metrics.advance,s=(t[n].x+a)*i,u=r;u<=n;u++)t[u].x-=s}}Da[10]=!0,Da[32]=!0,Da[38]=!0,Da[40]=!0,Da[41]=!0,Da[43]=!0,Da[45]=!0,Da[47]=!0,Da[173]=!0,Da[183]=!0,Da[8203]=!0,Da[8208]=!0,Da[8211]=!0,Da[8231]=!0,t.commonjsGlobal=e,t.unwrapExports=r,t.createCommonjsModule=n,t.default=self,t.default$1=s,t.getJSON=function(t,e){var r=z(t);return r.setRequestHeader("Accept","application/json"),r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if(r.status>=200&&r.status<300&&r.response){var n;try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n)}else 401===r.status&&t.url.match(/mapbox.com/)?e(new k(r.statusText+": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens",r.status,t.url)):e(new k(r.statusText,r.status,t.url))},r.send(),r},t.getImage=function(t,e){return S(t,function(t,r){if(t)e(t);else if(r){var n=new self.Image,i=self.URL||self.webkitURL;n.onload=function(){e(null,n),i.revokeObjectURL(n.src)};var o=new self.Blob([new Uint8Array(r.data)],{type:"image/png"});n.cacheControl=r.cacheControl,n.expires=r.expires,n.src=r.data.byteLength?i.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}})},t.ResourceType=A,t.RGBAImage=pi,t.default$2=Qo,t.ImagePosition=ta,t.getArrayBuffer=S,t.default$3=function(t){return new oa(t).readFields(Aa,[])},t.default$4=mr,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),i[a]=e,0==--n&&r(o,i)})})},t.AlphaImage=li,t.default$5=E,t.endsWith=d,t.extend=h,t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.Evented=I,t.validateStyle=rr,t.validateLight=nr,t.emitValidationErrors=ar,t.default$6=Q,t.number=wt,t.Properties=Dr,t.Transitionable=Er,t.Transitioning=Pr,t.PossiblyEvaluated=Lr,t.DataConstantProperty=jr,t.warnOnce=b,t.uniqueId=function(){return f++},t.default$7=Ma,t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.wrap=function(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i},t.clamp=c,t.Event=B,t.ErrorEvent=C,t.OverscaledTileID=Ia,t.default$8=Pn,t.createLayout=$r,t.getCoordinatesCenter=function(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,o=0;o<t.length;o++)e=Math.min(e,t[o].column),r=Math.min(r,t[o].row),n=Math.max(n,t[o].column),i=Math.max(i,t[o].row);var s=n-e,u=i-r,l=Math.max(s,u),p=Math.max(0,Math.floor(-Math.log(l)/Math.LN2));return new a((e+n)/2,(r+i)/2,0).zoomTo(p)},t.CanonicalTileID=Ba,t.RasterBoundsArray=Gr,t.getVideo=function(t,e){var r,n,i=self.document.createElement("video");i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");r=t[o],n=void 0,(n=self.document.createElement("a")).href=r,(n.protocol!==self.document.location.protocol||n.host!==self.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return i},t.default$9=F,t.bindAll=y,t.default$10=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var i in e)if(!t(e[i],r[i]))return!1;return!0}return e===r},t.parseCacheControl=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,r,n,i){var o=n||i;return e[r]=!o||o.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},t.default$11=ja,t.default$12=Oa,t.default$13=Te,t.default$14=Ko,t.CollisionBoxArray=dn,t.default$15=zn,t.TriangleIndexArray=pn,t.default$16=Br,t.default$17=a,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.default$18=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.mat4=ri,t.vec4=ei,t.getSizeData=jo,t.evaluateSizeForFeature=function(t,e,r){var n=e;return"source"===t.functionType?r.lowerSize/10:"composite"===t.functionType?wt(r.lowerSize/10,r.upperSize/10,n.uSizeT):n.uSize},t.evaluateSizeForZoom=function(t,e,r){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var n=t.propertyValue,i=t.zoomRange,o=t.sizeRange,a=c(Se(n,r.specification).interpolationFactor(e,i.min,i.max),0,1);return{uSizeT:0,uSize:o.min+a*(o.max-o.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:c(Se(s,r.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}},t.addDynamicAttributes=Do,t.default$19=$o,t.WritingMode=Ra,t.multiPolygonIntersectsBufferedPoint=Rn,t.multiPolygonIntersectsMultiPolygon=Un,t.multiPolygonIntersectsBufferedMultiLine=Dn,t.polygonIntersectsPolygon=function(t,e){for(var r=0;r<t.length;r++)if(Xn(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(Xn(t,e[n]))return!0;return!!Zn(t,e)},t.distToSegmentSquared=$n,t.default$20=ti,t.default$21=Nr,t.default$22=function(t){return new Wo[t.type](t)},t.clone=g,t.filterObject=m,t.mapObject=v,t.registerForPluginAvailability=function(t){return zr?t({pluginURL:zr,completionCallback:Ar}):Mr.once("pluginAvailable",t),t},t.evented=Mr,t.default$23=vr,t.default$24=In,t.PosArray=Xr,t.UnwrappedTileID=Ca,t.ease=p,t.bezier=l,t.setRTLTextPlugin=function(t,e){if(kr)throw new Error("setRTLTextPlugin cannot be called multiple times.");kr=!0,zr=t,Ar=function(t){t?(kr=!1,zr=null,e&&e(t)):Sr=!0},Mr.fire(new B("pluginAvailable",{pluginURL:zr,completionCallback:Ar}))},t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.default$25=Lo,t.register=hr,t.GLYPH_PBF_BORDER=Sa,t.shapeText=function(t,e,r,n,i,o,a,s,u,l){var p=t.trim();l===Ra.vertical&&(p=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;n&&wr(n)&&!Oo[t[r+1]]||i&&wr(i)&&!Oo[t[r-1]]||!Oo[t[r]]?e+=t[r]:e+=Oo[t[r]]}return e}(p));var c=[],h={positionedGlyphs:c,text:p,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:l},f=Vr.processBidirectionalText;return function(t,e,r,n,i,o,a,s,u){for(var l=0,p=-17,c=0,h=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,y=0,d=r;y<d.length;y+=1){var v=d[y];if((v=v.trim()).length){for(var m=h.length,g=0;g<v.length;g++){var x=v.charCodeAt(g),b=e[x];b&&(br(x)&&a!==Ra.horizontal?(h.push({glyph:x,x:l,y:0,vertical:!0}),l+=u+s):(h.push({glyph:x,x:l,y:p,vertical:!1}),l+=b.metrics.advance+s))}if(h.length!==m){var w=l-s;c=Math.max(w,c),Ha(h,e,m,h.length-1,f)}l=0,p+=n}else p+=n}var _=$a(i),A=_.horizontalAlign,k=_.verticalAlign;!function(t,e,r,n,i,o,a){for(var s=(e-r)*i,u=(-n*a+.5)*o,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u}(h,f,A,k,c,n,r.length);var z=r.length*n;t.top+=-k*z,t.bottom=t.top+z,t.left+=-A*c,t.right=t.left+c}(h,e,f?f(p,Ja(p,a,r,e)):function(t,e){for(var r=[],n=0,i=0,o=e;i<o.length;i+=1){var a=o[i];r.push(t.substring(n,a)),n=a}return n<t.length&&r.push(t.substring(n,t.length)),r}(p,Ja(p,a,r,e)),n,i,o,l,a,u),!!c.length&&h},t.shapeIcon=function(t,e,r){var n=$a(r),i=n.horizontalAlign,o=n.verticalAlign,a=e[0],s=e[1],u=a-t.displaySize[0]*i,l=u+t.displaySize[0],p=s-t.displaySize[1]*o;return{image:t,top:p,bottom:p+t.displaySize[1],left:u,right:l}},t.allowsVerticalWritingMode=gr,t.allowsLetterSpacing=function(t){for(var e=0,r=t;e<r.length;e+=1)if(!xr(r[e].charCodeAt(0)))return!1;return!0},t.default$26=$i,t.default$27=Ta,t.default$28=ra,t.default$29=vo,t.default$30=oa,t.default$31=Pa,t.__moduleExports=vo,t.default$32=s,t.__moduleExports$1=oa,t.plugin=Vr}),define(0,function(e){function t(e){var i=typeof e;if("number"===i||"boolean"===i||"string"===i||null==e)return JSON.stringify(e);if(Array.isArray(e)){for(var r="[",n=0,o=e;n<o.length;n+=1)r+=t(o[n])+",";return r+"]"}for(var a=Object.keys(e).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+t(e[a[l]])+",";return s+"}"}function i(i){for(var r="",n=0,o=e.default$18;n<o.length;n+=1)r+="/"+t(i[o[n]]);return r}var r=function(e){e&&this.replace(e)};function n(e,t,i,r,n){if(void 0===t.segment)return!0;for(var o=t,a=t.segment+1,s=0;s>-i/2;){if(--a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;for(var l=[],u=0;s<i/2;){var h=e[a-1],c=e[a],f=e[a+1];if(!f)return!1;var p=h.angleTo(c)-c.angleTo(f);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),u+=p;s-l[0].distance>r;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=c.dist(f)}return!0}function o(t,i,r,o,a,s,l,u,h){var c=o?.6*s*l:0,f=Math.max(o?o.right-o.left:0,a?a.right-a.left:0),p=0===t[0].x||t[0].x===h||0===t[0].y||t[0].y===h;return i-f*l<i/4&&(i=f*l+i/4),function t(i,r,o,a,s,l,u,h,c){for(var f=l/2,p=0,d=0;d<i.length-1;d++)p+=i[d].dist(i[d+1]);for(var g=0,v=r-o,y=[],m=0;m<i.length-1;m++){for(var x=i[m],w=i[m+1],S=x.dist(w),M=w.angleTo(x);v+o<g+S;){var b=((v+=o)-g)/S,_=e.number(x.x,w.x,b),I=e.number(x.y,w.y,b);if(_>=0&&_<c&&I>=0&&I<c&&v-f>=0&&v+f<=p){var z=new e.default$25(_,I,M,m);z._round(),a&&!n(i,z,l,a,s)||y.push(z)}}g+=S}return h||y.length||u||(y=t(i,g/2,o,a,s,l,u,!0,c)),y}(t,p?i/2*u%i:(f/2+2*s)*l*u%i,i,c,r,f*l,p,!1,h)}r.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[])},r.prototype.update=function(t,r){for(var n=this,o=0,a=t;o<a.length;o+=1){var s=a[o];n._layerConfigs[s.id]=s;var l=n._layers[s.id]=e.default$22(s);l._featureFilter=e.default$13(l.filter)}for(var u=0,h=r;u<h.length;u+=1){var c=h[u];delete n._layerConfigs[c],delete n._layers[c]}this.familiesBySource={};for(var f=0,p=function(e){for(var t={},r=0;r<e.length;r++){var n=i(e[r]),o=t[n];o||(o=t[n]=[]),o.push(e[r])}var a=[];for(var s in t)a.push(t[s]);return a}(e.values(this._layerConfigs));f<p.length;f+=1){var d=p[f].map(function(e){return n._layers[e.id]}),g=d[0];if("none"!==g.visibility){var v=g.source||"",y=n.familiesBySource[v];y||(y=n.familiesBySource[v]={});var m=g.sourceLayer||"_geojsonTileLayer",x=y[m];x||(x=y[m]=[]),x.push(d)}}};var a=function(){this.opacity=0,this.targetOpacity=0,this.time=0};a.prototype.clone=function(){var e=new a;return e.opacity=this.opacity,e.targetOpacity=this.targetOpacity,e.time=this.time,e},e.register("OpacityState",a);var s=function(e,t,i,r,n,o,a,s,l,u,h){var c=a.top*s-l,f=a.bottom*s+l,p=a.left*s-l,d=a.right*s+l;if(this.boxStartIndex=e.length,u){var g=f-c,v=d-p;g>0&&(g=Math.max(10*s,g),this._addLineCollisionCircles(e,t,i,i.segment,v,g,r,n,o,h))}else e.emplaceBack(i.x,i.y,p,c,d,f,r,n,o,0,0);this.boxEndIndex=e.length};s.prototype._addLineCollisionCircles=function(e,t,i,r,n,o,a,s,l,u){var h=o/2,c=Math.floor(n/h),f=1+.4*Math.log(u)/Math.LN2,p=Math.floor(c*f/2),d=-o/2,g=i,v=r+1,y=d,m=-n/2,x=m-n/4;do{if(--v<0){if(y>m)return;v=0;break}y-=t[v].dist(g),g=t[v]}while(y>x);for(var w=t[v].dist(t[v+1]),S=-p;S<c+p;S++){var M=S*h,b=m+M;if(M<0&&(b+=M),M>n&&(b+=M-n),!(b<y)){for(;y+w<b;){if(y+=w,++v+1>=t.length)return;w=t[v].dist(t[v+1])}var _=b-y,I=t[v],z=t[v+1].sub(I)._unit()._mult(_)._add(I)._round(),T=Math.abs(b-d)<h?0:.8*(b-d);e.emplaceBack(z.x,z.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,T)}}};var l=h,u=h;function h(e,t){if(!(this instanceof h))return new h(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||c,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function c(e,t){return e<t?-1:e>t?1:0}function f(t,i,r){void 0===i&&(i=1),void 0===r&&(r=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],h=0;h<u.length;h++){var c=u[h];(!h||c.x<n)&&(n=c.x),(!h||c.y<o)&&(o=c.y),(!h||c.x>a)&&(a=c.x),(!h||c.y>s)&&(s=c.y)}var f=a-n,g=s-o,v=Math.min(f,g),y=v/2,m=new l(null,p);if(0===v)return new e.default$1(n,o);for(var x=n;x<a;x+=v)for(var w=o;w<s;w+=v)m.push(new d(x+y,w+y,y,t));for(var S=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],u=n[s],h=l.x*u.y-u.x*l.y;i+=(l.x+u.x)*h,r+=(l.y+u.y)*h,t+=3*h}return new d(i/t,r/t,0,e)}(t),M=m.length;m.length;){var b=m.pop();(b.d>S.d||!S.d)&&(S=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,M)),b.max-S.d<=i||(y=b.h/2,m.push(new d(b.p.x-y,b.p.y-y,y,t)),m.push(new d(b.p.x+y,b.p.y-y,y,t)),m.push(new d(b.p.x-y,b.p.y+y,y,t)),m.push(new d(b.p.x+y,b.p.y+y,y,t)),M+=4)}return r&&(console.log("num probes: "+M),console.log("best distance: "+S.d)),S.p}function p(e,t){return t.max-e.max}function d(t,i,r,n){this.p=new e.default$1(t,i),this.h=r,this.d=function(t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],s=0,l=a.length,u=l-1;s<l;u=s++){var h=a[s],c=a[u];h.y>t.y!=c.y>t.y&&t.x<(c.x-h.x)*(t.y-h.y)/(c.y-h.y)+h.x&&(r=!r),n=Math.min(n,e.distToSegmentSquared(t,h,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}function g(t,i,r,n,o,a){t.createArrays(),t.symbolInstances=[];var s=512*t.overscaling;t.tilePixelRatio=e.default$8/s,t.compareText={},t.iconsNeedLinear=!1;var l=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,h={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,f=c.min,p=c.max;h.compositeTextSizes=[u["text-size"].possiblyEvaluate(new e.default$16(f)),u["text-size"].possiblyEvaluate(new e.default$16(p))]}if("composite"===t.iconSizeData.functionType){var d=t.iconSizeData.zoomRange,g=d.min,y=d.max;h.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new e.default$16(g)),u["icon-size"].possiblyEvaluate(new e.default$16(y))]}h.layoutTextSize=u["text-size"].possiblyEvaluate(new e.default$16(t.zoom+1)),h.layoutIconSize=u["icon-size"].possiblyEvaluate(new e.default$16(t.zoom+1)),h.textMaxSize=u["text-size"].possiblyEvaluate(new e.default$16(18));for(var m=24*l.get("text-line-height"),x="map"===l.get("text-rotation-alignment")&&"line"===l.get("symbol-placement"),w=l.get("text-keep-upright"),S=0,M=t.features;S<M.length;S+=1){var b=M[S],_=l.get("text-font").evaluate(b).join(","),I=i[_]||{},z=r[_]||{},T={},P=b.text;if(P){var k=l.get("text-offset").evaluate(b).map(function(e){return 24*e}),L=24*l.get("text-letter-spacing").evaluate(b),$=e.allowsLetterSpacing(P)?L:0,D=l.get("text-anchor").evaluate(b),O=l.get("text-justify").evaluate(b),C="line"!==l.get("symbol-placement")?24*l.get("text-max-width").evaluate(b):0;T.horizontal=e.shapeText(P,I,C,m,D,O,$,k,24,e.WritingMode.horizontal),e.allowsVerticalWritingMode(P)&&x&&w&&(T.vertical=e.shapeText(P,I,C,m,D,O,$,k,24,e.WritingMode.vertical))}var A=void 0;if(b.icon){var E=n[b.icon];E&&(A=e.shapeIcon(o[b.icon],l.get("icon-offset").evaluate(b),l.get("icon-anchor").evaluate(b)),void 0===t.sdfIcons?t.sdfIcons=E.sdf:t.sdfIcons!==E.sdf&&e.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),E.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==l.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(T.horizontal||A)&&v(t,b,T,A,z,h)}a&&t.generateCollisionDebugBuffers()}function v(t,i,r,n,l,u){var h=u.layoutTextSize.evaluate(i),c=u.layoutIconSize.evaluate(i),p=u.textMaxSize.evaluate(i);void 0===p&&(p=h);var d=t.layers[0].layout,g=d.get("text-offset").evaluate(i),v=d.get("icon-offset").evaluate(i),x=h/24,w=t.tilePixelRatio*x,S=t.tilePixelRatio*p/24,M=t.tilePixelRatio*c,b=t.tilePixelRatio*d.get("symbol-spacing"),_=d.get("text-padding")*t.tilePixelRatio,I=d.get("icon-padding")*t.tilePixelRatio,z=d.get("text-max-angle")/180*Math.PI,T="map"===d.get("text-rotation-alignment")&&"line"===d.get("symbol-placement"),P="map"===d.get("icon-rotation-alignment")&&"line"===d.get("symbol-placement"),k=b/2,L=function(o,h){h.x<0||h.x>=e.default$8||h.y<0||h.y>=e.default$8||t.symbolInstances.push(function(t,i,r,n,o,l,u,h,c,f,p,d,g,v,m,x,w,S,M,b,_){var I,z,T=t.addToLineVertexArray(i,r),P=0,k=0,L=0,$=n.horizontal?n.horizontal.text:"",D=[];n.horizontal&&(I=new s(u,r,i,h,c,f,n.horizontal,p,d,g,t.overscaling),k+=y(t,i,n.horizontal,l,g,M,v,T,n.vertical?e.WritingMode.horizontal:e.WritingMode.horizontalOnly,D,b,_),n.vertical&&(L+=y(t,i,n.vertical,l,g,M,v,T,e.WritingMode.vertical,D,b,_)));var O=I?I.boxStartIndex:t.collisionBoxArray.length,C=I?I.boxEndIndex:t.collisionBoxArray.length;if(o){var A=function(t,i,r,n,o,a){var s,l,u,h,c=i.image,f=r.layout,p=i.top-1/c.pixelRatio,d=i.left-1/c.pixelRatio,g=i.bottom+1/c.pixelRatio,v=i.right+1/c.pixelRatio;if("none"!==f.get("icon-text-fit")&&o){var y=v-d,m=g-p,x=f.get("text-size").evaluate(a)/24,w=o.left*x,S=o.right*x,M=o.top*x,b=S-w,_=o.bottom*x-M,I=f.get("icon-text-fit-padding")[0],z=f.get("icon-text-fit-padding")[1],T=f.get("icon-text-fit-padding")[2],P=f.get("icon-text-fit-padding")[3],k="width"===f.get("icon-text-fit")?.5*(_-m):0,L="height"===f.get("icon-text-fit")?.5*(b-y):0,$="width"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?b:y,D="height"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?_:m;s=new e.default$1(w+L-P,M+k-I),l=new e.default$1(w+L+z+$,M+k-I),u=new e.default$1(w+L+z+$,M+k+T+D),h=new e.default$1(w+L-P,M+k+T+D)}else s=new e.default$1(d,p),l=new e.default$1(v,p),u=new e.default$1(v,g),h=new e.default$1(d,g);var O=r.layout.get("icon-rotate").evaluate(a)*Math.PI/180;if(O){var C=Math.sin(O),A=Math.cos(O),E=[A,-C,C,A];s._matMult(E),l._matMult(E),h._matMult(E),u._matMult(E)}return[{tl:s,tr:l,bl:h,br:u,tex:c.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,o,l,0,n.horizontal,M);z=new s(u,r,i,h,c,f,o,m,x,!1,t.overscaling),P=4*A.length;var E=t.iconSizeData,N=null;"source"===E.functionType?N=[10*l.layout.get("icon-size").evaluate(M)]:"composite"===E.functionType&&(N=[10*_.compositeIconSizes[0].evaluate(M),10*_.compositeIconSizes[1].evaluate(M)]),t.addSymbols(t.icon,A,N,S,w,M,!1,i,T.lineStartIndex,T.lineLength)}var R=z?z.boxStartIndex:t.collisionBoxArray.length,B=z?z.boxEndIndex:t.collisionBoxArray.length;return t.glyphOffsetArray.length>=e.default$14.MAX_GLYPHS&&e.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),{key:$,textBoxStartIndex:O,textBoxEndIndex:C,iconBoxStartIndex:R,iconBoxEndIndex:B,textOffset:v,iconOffset:S,anchor:i,line:r,featureIndex:h,feature:M,numGlyphVertices:k,numVerticalGlyphVertices:L,numIconVertices:P,textOpacityState:new a,iconOpacityState:new a,isDuplicate:!1,placedTextSymbolIndices:D,crossTileID:0}}(t,h,o,r,n,t.layers[0],t.collisionBoxArray,i.index,i.sourceLayerIndex,t.index,w,_,T,g,M,I,P,v,i,l,u))};if("line"===d.get("symbol-placement"))for(var $=0,D=function(t,i,r,n,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,h=0;h<l.length-1;h++){var c=l[h],f=l[h+1];c.x<0&&f.x<0||(c.x<0?c=new e.default$1(0,c.y+(f.y-c.y)*((0-c.x)/(f.x-c.x)))._round():f.x<0&&(f=new e.default$1(0,c.y+(f.y-c.y)*((0-c.x)/(f.x-c.x)))._round()),c.y<0&&f.y<0||(c.y<0?c=new e.default$1(c.x+(f.x-c.x)*((0-c.y)/(f.y-c.y)),0)._round():f.y<0&&(f=new e.default$1(c.x+(f.x-c.x)*((0-c.y)/(f.y-c.y)),0)._round()),c.x>=n&&f.x>=n||(c.x>=n?c=new e.default$1(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round():f.x>=n&&(f=new e.default$1(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round()),c.y>=o&&f.y>=o||(c.y>=o?c=new e.default$1(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round():f.y>=o&&(f=new e.default$1(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round()),u&&c.equals(u[u.length-1])||(u=[c],a.push(u)),u.push(f)))))}return a}(i.geometry,0,0,e.default$8,e.default$8);$<D.length;$+=1)for(var O=D[$],C=0,A=o(O,b,z,r.vertical||r.horizontal,n,24,S,t.overscaling,e.default$8);C<A.length;C+=1){var E=A[C],N=r.horizontal;N&&m(t,N.text,k,E)||L(O,E)}else if("Polygon"===i.type)for(var R=0,B=e.default$26(i.geometry,0);R<B.length;R+=1){var F=B[R],G=f(F,16);L(F[0],new e.default$25(G.x,G.y,0))}else if("LineString"===i.type)for(var V=0,J=i.geometry;V<J.length;V+=1){var W=J[V];L(W,new e.default$25(W[0].x,W[0].y,0))}else if("Point"===i.type)for(var Y=0,Z=i.geometry;Y<Z.length;Y+=1)for(var j=0,X=Z[Y];j<X.length;j+=1){var q=X[j];L([q],new e.default$25(q.x,q.y,0))}}function y(t,i,r,n,o,a,s,l,u,h,c,f){var p=function(t,i,r,n,o,a){for(var s=r.layout.get("text-rotate").evaluate(o)*Math.PI/180,l=r.layout.get("text-offset").evaluate(o).map(function(e){return 24*e}),u=i.positionedGlyphs,h=[],c=0;c<u.length;c++){var f=u[c],p=a[f.glyph];if(p){var d=p.rect;if(d){var g=e.GLYPH_PBF_BORDER+1,v=p.metrics.advance/2,y=n?[f.x+v,f.y]:[0,0],m=n?[0,0]:[f.x+v+l[0],f.y+l[1]],x=p.metrics.left-g-v+m[0],w=-p.metrics.top-g+m[1],S=x+d.w,M=w+d.h,b=new e.default$1(x,w),_=new e.default$1(S,w),I=new e.default$1(x,M),z=new e.default$1(S,M);if(n&&f.vertical){var T=new e.default$1(-v,v),P=-Math.PI/2,k=new e.default$1(5,0);b._rotateAround(P,T)._add(k),_._rotateAround(P,T)._add(k),I._rotateAround(P,T)._add(k),z._rotateAround(P,T)._add(k)}if(s){var L=Math.sin(s),$=Math.cos(s),D=[$,-L,L,$];b._matMult(D),_._matMult(D),I._matMult(D),z._matMult(D)}h.push({tl:b,tr:_,bl:I,br:z,tex:d,writingMode:i.writingMode,glyphOffset:y})}}}return h}(0,r,n,o,a,c),d=t.textSizeData,g=null;return"source"===d.functionType?g=[10*n.layout.get("text-size").evaluate(a)]:"composite"===d.functionType&&(g=[10*f.compositeTextSizes[0].evaluate(a),10*f.compositeTextSizes[1].evaluate(a)]),t.addSymbols(t.text,p,g,s,o,a,u,i,l.lineStartIndex,l.lineLength),h.push(t.text.placedSymbolArray.length-1),4*p.length}function m(e,t,i,r){var n=e.compareText;if(t in n){for(var o=n[t],a=o.length-1;a>=0;a--)if(r.dist(o[a])<i)return!0}else n[t]=[];return n[t].push(r),!1}h.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&i(t[a],s)<0&&(o=a,s=t[a]),i(s,n)>=0)break;t[e]=s,e=o}t[e]=n}},l.default=u;var x=function(t){var i=new e.AlphaImage({width:0,height:0}),r={},n=new e.default$2(0,0,{autoResize:!0});for(var o in t){var a=t[o],s=r[o]={};for(var l in a){var u=a[+l];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var h=n.packOne(u.bitmap.width+2,u.bitmap.height+2);i.resize({width:n.w,height:n.h}),e.AlphaImage.copy(u.bitmap,i,{x:0,y:0},{x:h.x+1,y:h.y+1},u.bitmap),s[l]={rect:h,metrics:u.metrics}}}}n.shrink(),i.resize({width:n.w,height:n.h}),this.image=i,this.positions=r};e.register("GlyphAtlas",x);var w=function(t){this.tileID=new e.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming};function S(t,i){for(var r=new e.default$16(i),n=0,o=t;n<o.length;n+=1)o[n].recalculate(r)}w.prototype.parse=function(t,i,r,n){var o=this;this.status="parsing",this.data=t,this.collisionBoxArray=new e.CollisionBoxArray;var a=new e.default$27(Object.keys(t.layers).sort()),s=new e.default$11(this.tileID);s.bucketLayerIDs=[];var l,u,h,c={},f={featureIndex:s,iconDependencies:{},glyphDependencies:{}},p=i.familiesBySource[this.source];for(var d in p){var v=t.layers[d];if(v){1===v.version&&e.warnOnce('Vector tile source "'+o.source+'" layer "'+d+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var y=a.encode(d),m=[],w=0;w<v.length;w++){var M=v.feature(w);m.push({feature:M,index:w,sourceLayerIndex:y})}for(var b=0,_=p[d];b<_.length;b+=1){var I=_[b],z=I[0];z.minzoom&&o.zoom<Math.floor(z.minzoom)||z.maxzoom&&o.zoom>=z.maxzoom||"none"!==z.visibility&&(S(I,o.zoom),(c[z.id]=z.createBucket({index:s.bucketLayerIDs.length,layers:I,zoom:o.zoom,pixelRatio:o.pixelRatio,overscaling:o.overscaling,collisionBoxArray:o.collisionBoxArray,sourceLayerIndex:y})).populate(m,f),s.bucketLayerIDs.push(I.map(function(e){return e.id})))}}}var T=e.mapObject(f.glyphDependencies,function(e){return Object.keys(e).map(Number)});Object.keys(T).length?r.send("getGlyphs",{uid:this.uid,stacks:T},function(e,t){l||(l=e,u=t,k.call(o))}):u={};var P=Object.keys(f.iconDependencies);function k(){if(l)return n(l);if(u&&h){var t=new x(u),i=new e.default$28(h);for(var r in c){var o=c[r];o instanceof e.default$14&&(S(o.layers,this.zoom),g(o,u,t.positions,h,i.positions,this.showCollisionBoxes))}this.status="done",n(null,{buckets:e.values(c).filter(function(e){return!e.isEmpty()}),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,iconAtlasImage:i.image})}}P.length?r.send("getImages",{icons:P},function(e,t){l||(l=e,h=t,k.call(o))}):h={},k.call(this)};var M=function(e){return!(!performance||!performance.getEntriesByName)&&performance.getEntriesByName(e)};function b(t,i){var r=e.getArrayBuffer(t.request,function(t,r){t?i(t):r&&i(null,{vectorTile:new e.default$29.VectorTile(new e.default$30(r.data)),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires})});return function(){r.abort(),i()}}var _=function(e,t,i){this.actor=e,this.layerIndex=t,this.loadVectorData=i||b,this.loading={},this.loaded={}};_.prototype.loadTile=function(t,i){var r=this,n=t.uid;this.loading||(this.loading={});var o=this.loading[n]=new w(t);o.abort=this.loadVectorData(t,function(a,s){if(delete r.loading[n],a||!s)return i(a);var l=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl);var h={};if(t.request&&t.request.collectResourceTiming){var c=M(t.request.url);c&&(h.resourceTiming=JSON.parse(JSON.stringify(c)))}o.vectorTile=s.vectorTile,o.parse(s.vectorTile,r.layerIndex,r.actor,function(t,r){if(t||!r)return i(t);i(null,e.extend({rawTileData:l.slice(0)},r,u,h))}),r.loaded=r.loaded||{},r.loaded[n]=o})},_.prototype.reloadTile=function(e,t){var i=this.loaded,r=e.uid,n=this;if(i&&i[r]){var o=i[r];o.showCollisionBoxes=e.showCollisionBoxes;var a=function(e,i){var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,n.actor,r)),t(e,i)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,a)}},_.prototype.abortTile=function(e,t){var i=this.loading,r=e.uid;i&&i[r]&&i[r].abort&&(i[r].abort(),delete i[r]),t()},_.prototype.removeTile=function(e,t){var i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()};var I=function(){this.loading={},this.loaded={}};I.prototype.loadTile=function(t,i){var r=t.uid,n=t.encoding,o=new e.default$31(r);this.loading[r]=o,o.loadFromImage(t.rawImageData,n),delete this.loading[r],this.loaded=this.loaded||{},this.loaded[r]=o,i(null,o)},I.prototype.removeTile=function(e){var t=this.loaded,i=e.uid;t&&t[i]&&delete t[i]};var z={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function T(e){var t=0;if(e&&e.length>0){t+=Math.abs(P(e[0]));for(var i=1;i<e.length;i++)t-=Math.abs(P(e[i]))}return t}function P(e){var t,i,r,n,o,a,s=0,l=e.length;if(l>2){for(a=0;a<l;a++)a===l-2?(r=l-2,n=l-1,o=0):a===l-1?(r=l-1,n=0,o=1):(r=a,n=a+1,o=a+2),t=e[r],i=e[n],s+=(k(e[o][0])-k(t[0]))*Math.sin(k(i[1]));s=s*z.RADIUS*z.RADIUS/2}return s}function k(e){return e*Math.PI/180}var L={geometry:function e(t){var i,r=0;switch(t.type){case"Polygon":return T(t.coordinates);case"MultiPolygon":for(i=0;i<t.coordinates.length;i++)r+=T(t.coordinates[i]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<t.geometries.length;i++)r+=e(t.geometries[i]);return r}},ring:P};function D(e,t){return function(i){return e(i,t)}}function O(e,t){t=!!t,e[0]=C(e[0],t);for(var i=1;i<e.length;i++)e[i]=C(e[i],!t);return e}function C(e,t){return function(e){return L.ring(e)>=0}(e)===t?e:e.reverse()}var A=e.default$29.VectorTileFeature.prototype.toGeoJSON,E=function(t){this._feature=t,this.extent=e.default$8,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};E.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],i=0,r=this._feature.geometry;i<r.length;i+=1){var n=r[i];t.push([new e.default$1(n[0],n[1])])}return t}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,h=s[a];u<h.length;u+=1){var c=h[u];l.push(new e.default$1(c[0],c[1]))}o.push(l)}return o},E.prototype.toGeoJSON=function(e,t,i){return A.call(this,e,t,i)};var N=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.default$8,this.length=t.length,this._features=t};N.prototype.feature=function(e){return new E(this._features[e])};var R=e.__moduleExports.VectorTileFeature,B=F;function F(e,t){this.options=t||{},this.features=e,this.length=e.length}function G(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}F.prototype.feature=function(e){return new G(this.features[e],this.options.extent)},G.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var r=t[i],n=[],o=0;o<r.length;o++)n.push(new e.default$32(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},G.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var l=a[s];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},G.prototype.toGeoJSON=R.prototype.toGeoJSON;var V=Z,J=Z,Y=B;function Z(t){var i=new e.__moduleExports$1;return function(e,t){for(var i in e.layers)t.writeMessage(3,j,e.layers[i])}(t,i),i.finish()}function j(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,X,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)t.writeMessage(4,K,o[i])}function X(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,q,e),t.writeVarintField(3,i.type),t.writeMessage(4,Q,i)}function q(e,t){var i=e.feature,r=e.keys,n=e.values,o=e.keycache,a=e.valuecache;for(var s in i.properties){var l=o[s];void 0===l&&(r.push(s),l=r.length-1,o[s]=l),t.writeVarint(l);var u=i.properties[s],h=typeof u;"string"!==h&&"boolean"!==h&&"number"!==h&&(u=JSON.stringify(u));var c=h+":"+u,f=a[c];void 0===f&&(n.push(u),f=n.length-1,a[c]=f),t.writeVarint(f)}}function U(e,t){return(t<<3)+(7&e)}function H(e){return e<<1^e>>31}function Q(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],u=1;1===r&&(u=l.length),t.writeVarint(U(1,u));for(var h=3===r?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==r&&t.writeVarint(U(2,h-1));var f=l[c].x-n,p=l[c].y-o;t.writeVarint(H(f)),t.writeVarint(H(p)),n+=f,o+=p}3===r&&t.writeVarint(U(7,0))}}function K(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}V.fromVectorTileJs=J,V.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new B(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return Z({layers:i})},V.GeoJSONWrapper=Y;var ee=function e(t,i,r,n,o,a){if(!(o-n<=r)){var s=Math.floor((n+o)/2);!function e(t,i,r,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=r-n+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1);e(t,i,r,Math.max(n,Math.floor(r-l*h/s+c)),Math.min(o,Math.floor(r+(s-l)*h/s+c)),a)}var d=i[2*r+a],g=n,v=o;for(te(t,i,n,r),i[2*o+a]>d&&te(t,i,n,o);g<v;){for(te(t,i,g,v),g++,v--;i[2*g+a]<d;)g++;for(;i[2*v+a]>d;)v--}i[2*n+a]===d?te(t,i,n,v):te(t,i,++v,o),v<=r&&(n=v+1),r<=v&&(o=v-1)}}(t,i,s,n,o,a%2),e(t,i,r,n,s-1,a+1),e(t,i,r,s+1,o,a+1)}};function te(e,t,i,r){ie(e,i,r),ie(t,2*i,2*r),ie(t,2*i+1,2*r+1)}function ie(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function oe(e,t,i,r){var n=e-i,o=t-r;return n*n+o*o}var ae=function(e,t,i,r,n){return new se(e,t,i,r,n)};function se(e,t,i,r,n){t=t||le,i=i||ue,n=n||Array,this.nodeSize=r||64,this.points=e,this.ids=new n(e.length),this.coords=new n(2*e.length);for(var o=0;o<e.length;o++)this.ids[o]=o,this.coords[2*o]=t(e[o]),this.coords[2*o+1]=i(e[o]);ee(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function le(e){return e[0]}function ue(e){return e[1]}se.prototype={range:function(e,t,i,r){return function(e,t,i,r,n,o,a){for(var s,l,u=[0,e.length-1,0],h=[];u.length;){var c=u.pop(),f=u.pop(),p=u.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=t[2*d],l=t[2*d+1],s>=i&&s<=n&&l>=r&&l<=o&&h.push(e[d]);else{var g=Math.floor((p+f)/2);s=t[2*g],l=t[2*g+1],s>=i&&s<=n&&l>=r&&l<=o&&h.push(e[g]);var v=(c+1)%2;(0===c?i<=s:r<=l)&&(u.push(p),u.push(g-1),u.push(v)),(0===c?n>=s:o>=l)&&(u.push(g+1),u.push(f),u.push(v))}}return h}(this.ids,this.coords,e,t,i,r,this.nodeSize)},within:function(e,t,i){return function(e,t,i,r,n,o){for(var a=[0,e.length-1,0],s=[],l=n*n;a.length;){var u=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(var f=c;f<=h;f++)oe(t[2*f],t[2*f+1],i,r)<=l&&s.push(e[f]);else{var p=Math.floor((c+h)/2),d=t[2*p],g=t[2*p+1];oe(d,g,i,r)<=l&&s.push(e[p]);var v=(u+1)%2;(0===u?i-n<=d:r-n<=g)&&(a.push(c),a.push(p-1),a.push(v)),(0===u?i+n>=d:r+n>=g)&&(a.push(p+1),a.push(h),a.push(v))}}return s}(this.ids,this.coords,e,t,i,this.nodeSize)}};function ce(e){this.options=me(Object.create(this.options),e),this.trees=new Array(this.options.maxZoom+1)}function fe(e,t,i,r,n){return{x:e,y:t,zoom:1/0,id:r,properties:n,parentId:-1,numPoints:i}}function pe(e,t){var i=e.geometry.coordinates;return{x:ve(i[0]),y:ye(i[1]),zoom:1/0,id:t,parentId:-1}}function de(e){return{type:"Feature",properties:ge(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,i=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var t,i,r}function ge(e){var t=e.numPoints,i=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return me(me({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function ve(e){return e/360+.5}function ye(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function me(e,t){for(var i in t)e[i]=t[i];return e}function xe(e){return e.x}function we(e){return e.y}function Se(e,t,i,r,n,o){var a=n-i,s=o-r;if(0!==a||0!==s){var l=((e-i)*a+(t-r)*s)/(a*a+s*s);l>1?(i=n,r=o):l>0&&(i+=a*l,r+=s*l)}return(a=e-i)*a+(s=t-r)*s}function Me(e,t,i,r){var n={id:e||null,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)be(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)be(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)be(e,t[r][n])}(n),n}function be(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function _e(e,t,i){if(t.geometry){var r=t.geometry.coordinates,n=t.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[];if("Point"===n)Ie(r,a);else if("MultiPoint"===n)for(var s=0;s<r.length;s++)Ie(r[s],a);else if("LineString"===n)ze(r,a,o,!1);else if("MultiLineString"===n)if(i.lineMetrics)for(s=0;s<r.length;s++)return a=[],ze(r[s],a,o,!1),void e.push(Me(t.id,"LineString",a,t.properties));else Te(r,a,o,!1);else if("Polygon"===n)Te(r,a,o,!0);else{if("MultiPolygon"!==n){if("GeometryCollection"===n){for(s=0;s<t.geometry.geometries.length;s++)_e(e,{id:t.id,geometry:t.geometry.geometries[s],properties:t.properties},i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(s=0;s<r.length;s++){var l=[];Te(r[s],l,o,!0),a.push(l)}}e.push(Me(t.id,n,a,t.properties))}}function Ie(e,t){t.push(Pe(e[0])),t.push(ke(e[1])),t.push(0)}function ze(e,t,i,r){for(var n,o,a=0,s=0;s<e.length;s++){var l=Pe(e[s][0]),u=ke(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(a+=r?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var h=t.length-3;t[2]=1,function e(t,i,r,n){for(var o,a=n,s=t[i],l=t[i+1],u=t[r],h=t[r+1],c=i+3;c<r;c+=3){var f=Se(t[c],t[c+1],s,l,u,h);f>a&&(o=c,a=f)}a>n&&(o-i>3&&e(t,i,o,n),t[o+2]=a,r-o>3&&e(t,o,r,n))}(t,0,h,i),t[h+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function Te(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];ze(e[n],o,i,r),t.push(o)}}function Pe(e){return e/360+.5}function ke(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function Le(e,t,i,r,n,o,a,s){if(r/=t,o>=(i/=t)&&a<=r)return e;if(o>r||a<i)return null;for(var l=[],u=0;u<e.length;u++){var h=e[u],c=h.geometry,f=h.type,p=0===n?h.minX:h.minY,d=0===n?h.maxX:h.maxY;if(p>=i&&d<=r)l.push(h);else if(!(p>r||d<i)){var g=[];if("Point"===f||"MultiPoint"===f)$e(c,g,i,r,n);else if("LineString"===f)De(c,g,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===f)Ce(c,g,i,r,n,!1);else if("Polygon"===f)Ce(c,g,i,r,n,!0);else if("MultiPolygon"===f)for(var v=0;v<c.length;v++){var y=[];Ce(c[v],y,i,r,n,!0),y.length&&g.push(y)}if(g.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<g.length;v++)l.push(Me(h.id,f,g[v],h.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===g.length?(f="LineString",g=g[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===g.length?"Point":"MultiPoint"),l.push(Me(h.id,f,g,h.tags))}}}return l.length?l:null}function $e(e,t,i,r,n){for(var o=0;o<e.length;o+=3){var a=e[o+n];a>=i&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function De(e,t,i,r,n,o,a){for(var s,l,u=Oe(e),h=0===n?Ee:Ne,c=e.start,f=0;f<e.length-3;f+=3){var p=e[f],d=e[f+1],g=e[f+2],v=e[f+3],y=e[f+4],m=0===n?p:d,x=0===n?v:y,w=!1;a&&(s=Math.sqrt(Math.pow(p-v,2)+Math.pow(d-y,2))),m<i?x>=i&&(l=h(u,p,d,v,y,i),a&&(u.start=c+s*l)):m>r?x<=r&&(l=h(u,p,d,v,y,r),a&&(u.start=c+s*l)):Ae(u,p,d,g),x<i&&m>=i&&(l=h(u,p,d,v,y,i),w=!0),x>r&&m<=r&&(l=h(u,p,d,v,y,r),w=!0),!o&&w&&(a&&(u.end=c+s*l),t.push(u),u=Oe(e)),a&&(c+=s)}var S=e.length-3;p=e[S],d=e[S+1],g=e[S+2],(m=0===n?p:d)>=i&&m<=r&&Ae(u,p,d,g),S=u.length-3,o&&S>=3&&(u[S]!==u[0]||u[S+1]!==u[1])&&Ae(u,u[0],u[1],u[2]),u.length&&t.push(u)}function Oe(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Ce(e,t,i,r,n,o){for(var a=0;a<e.length;a++)De(e[a],t,i,r,n,o,!1)}function Ae(e,t,i,r){e.push(t),e.push(i),e.push(r)}function Ee(e,t,i,r,n,o){var a=(o-t)/(r-t);return e.push(o),e.push(i+(n-i)*a),e.push(1),a}function Ne(e,t,i,r,n,o){var a=(o-i)/(n-i);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function Re(e,t){for(var i=[],r=0;r<e.length;r++){var n,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=Be(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(Be(o.geometry[s],t))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(Be(o.geometry[s][u],t));n.push(l)}i.push(Me(o.id,a,n,o.tags))}return i}function Be(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function Fe(e,t){if(e.transformed)return e;var i,r,n,o=1<<e.z,a=e.x,s=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(r=0;r<u.length;r+=2)l.geometry.push(Ge(u[r],u[r+1],t,o,a,s));else for(r=0;r<u.length;r++){var c=[];for(n=0;n<u[r].length;n+=2)c.push(Ge(u[r][n],u[r][n+1],t,o,a,s));l.geometry.push(c)}}return e.transformed=!0,e}function Ge(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function Ve(e,t,i,r,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,Je(a,e[s],o,n);var l=e[s].minX,u=e[s].minY,h=e[s].maxX,c=e[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),h>a.maxX&&(a.maxX=h),c>a.maxY&&(a.maxY=c)}return a}function Je(e,t,i,r){var n=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)We(a,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)We(a,n[s],e,i,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)We(a,u[s],e,i,!0,0===s)}if(a.length){var h=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var c in h={},t.tags)h[c]=t.tags[c];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:h};null!==t.id&&(f.id=t.id),e.features.push(f)}}function We(e,t,i,r,n,o){var a=r*r;if(r>0&&t.size<(n?a:r))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>a)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,o=n-2;r<n;o=r,r+=2)i+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=a,e[n-1-r]=s}}(s,o),e.push(s)}}function Ye(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)_e(i,e.features[r],t);else"Feature"===e.type?_e(i,e,t):_e(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=Le(e,1,-1-i,i,0,-1,2,t),o=Le(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=Le(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=Re(n,1).concat(r)),o&&(r=r.concat(Re(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ze(e,t,i){return 32*((1<<e)*i+t)+e}function je(e,t){var i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);var n=new N(r.features),o=V(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:n,rawData:o.buffer})}ce.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(e){return e}},load:function(e){var t=this.options.log;t&&console.time("total time");var i="prepare "+e.length+" points";t&&console.time(i),this.points=e;var r=e.map(pe);t&&console.timeEnd(i);for(var n=this.options.maxZoom;n>=this.options.minZoom;n--){var o=+Date.now();this.trees[n+1]=ae(r,xe,we,this.options.nodeSize,Float32Array),r=this._cluster(r,n),t&&console.log("z%d: %d clusters in %dms",n,r.length,+Date.now()-o)}return this.trees[this.options.minZoom]=ae(r,xe,we,this.options.nodeSize,Float32Array),t&&console.timeEnd("total time"),this},getClusters:function(e,t){for(var i=this.trees[this._limitZoom(t)],r=i.range(ve(e[0]),ye(e[3]),ve(e[2]),ye(e[1])),n=[],o=0;o<r.length;o++){var a=i.points[r[o]];n.push(a.numPoints?de(a):this.points[a.id])}return n},getChildren:function(e,t){for(var i=this.trees[t+1].points[e],r=this.options.radius/(this.options.extent*Math.pow(2,t)),n=this.trees[t+1].within(i.x,i.y,r),o=[],a=0;a<n.length;a++){var s=this.trees[t+1].points[n[a]];s.parentId===e&&o.push(s.numPoints?de(s):this.points[s.id])}return o},getLeaves:function(e,t,i,r){i=i||10,r=r||0;var n=[];return this._appendLeaves(n,e,t,i,r,0),n},getTile:function(e,t,i){var r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),o=this.options.extent,a=this.options.radius/o,s=(i-a)/n,l=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((t-a)/n,s,(t+1+a)/n,l),r.points,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-a/n,s,1,l),r.points,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,s,a/n,l),r.points,-1,i,n,u),u.features.length?u:null},getClusterExpansionZoom:function(e,t){for(;t<this.options.maxZoom;){var i=this.getChildren(e,t);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t},_appendLeaves:function(e,t,i,r,n,o){for(var a=this.getChildren(t,i),s=0;s<a.length;s++){var l=a[s].properties;if(l.cluster?o+l.point_count<=n?o+=l.point_count:o=this._appendLeaves(e,l.cluster_id,i+1,r,n,o):o<n?o++:e.push(a[s]),e.length===r)break}return o},_addTileFeatures:function(e,t,i,r,n,o){for(var a=0;a<e.length;a++){var s=t[e[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*n-i)),Math.round(this.options.extent*(s.y*n-r))]],tags:s.numPoints?ge(s):this.points[s.id].properties})}},_limitZoom:function(e){return Math.max(this.options.minZoom,Math.min(e,this.options.maxZoom+1))},_cluster:function(e,t){for(var i=[],r=this.options.radius/(this.options.extent*Math.pow(2,t)),n=0;n<e.length;n++){var o=e[n];if(!(o.zoom<=t)){o.zoom=t;var a=this.trees[t+1],s=a.within(o.x,o.y,r),l=o.numPoints||1,u=o.x*l,h=o.y*l,c=null;this.options.reduce&&(c=this.options.initial(),this._accumulate(c,o));for(var f=0;f<s.length;f++){var p=a.points[s[f]];if(t<p.zoom){var d=p.numPoints||1;p.zoom=t,u+=p.x*d,h+=p.y*d,l+=d,p.parentId=n,this.options.reduce&&this._accumulate(c,p)}}1===l?i.push(o):(o.parentId=n,i.push(fe(u/l,h/l,l,n,c)))}}return i},_accumulate:function(e,t){var i=t.numPoints?t.properties:this.options.map(this.points[t.id].properties);this.options.reduce(e,i)}},Ye.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,debug:0},Ye.prototype.splitTile=function(e,t,i,r,n,o,a){for(var s=[e,t,i,r],l=this.options,u=l.debug;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var h=1<<t,c=Ze(t,i,r),f=this.tiles[c];if(!f&&(u>1&&console.time("creation"),f=this.tiles[c]=Ve(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,n){if(t===l.maxZoom||t===n)continue;var d=1<<n-t;if(i!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){u>1&&console.time("clipping");var g,v,y,m,x,w,S=.5*l.buffer/l.extent,M=.5-S,b=.5+S,_=1+S;g=v=y=m=null,x=Le(e,h,i-S,i+b,0,f.minX,f.maxX,l),w=Le(e,h,i+M,i+_,0,f.minX,f.maxX,l),e=null,x&&(g=Le(x,h,r-S,r+b,1,f.minY,f.maxY,l),v=Le(x,h,r+M,r+_,1,f.minY,f.maxY,l),x=null),w&&(y=Le(w,h,r-S,r+b,1,f.minY,f.maxY,l),m=Le(w,h,r+M,r+_,1,f.minY,f.maxY,l),w=null),u>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*i,2*r),s.push(v||[],t+1,2*i,2*r+1),s.push(y||[],t+1,2*i+1,2*r),s.push(m||[],t+1,2*i+1,2*r+1)}}},Ye.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=Ze(e,t=(t%a+a)%a,i);if(this.tiles[s])return Fe(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,u=e,h=t,c=i;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[Ze(u,h,c)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,h,c),o>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Fe(this.tiles[s],n):null):null};var Xe=function(t){function i(e,i,r){t.call(this,e,i,je),r&&(this.loadGeoJSON=r)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},i.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var t=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams,this.loadGeoJSON(i,function(r,n){if(r||!n)return t(r);if("object"!=typeof n)return t(new Error("Input data is not a valid GeoJSON object."));!function e(t,i){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(D(e,i)),t;case"Feature":return t.geometry=e(t.geometry,i),t;case"Polygon":case"MultiPolygon":return function(e,t){return"Polygon"===e.type?e.coordinates=O(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(D(O,t))),e}(t,i);default:return t}}(n,!0);try{e._geoJSONIndex=i.cluster?function(e){return new ce(e)}(i.superclusterOptions).load(n.features):new Ye(n,i.geojsonVtOptions)}catch(r){return t(r)}e.loaded={};var o={};if(i.request&&i.request.collectResourceTiming){var a=M(i.request.url);a&&(o.resourceTiming={},o.resourceTiming[i.source]=JSON.parse(JSON.stringify(a)))}t(null,o)})}},i.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},i.prototype.reloadTile=function(e,i){var r=this.loaded,n=e.uid;return r&&r[n]?t.prototype.reloadTile.call(this,e,i):this.loadTile(e,i)},i.prototype.loadGeoJSON=function(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error("Input data is not a valid GeoJSON object."));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error("Input data is not a valid GeoJSON object."))}}},i.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()},i}(_),qe=function(t){var i=this;this.self=t,this.actor=new e.default$7(t,this),this.layerIndexes={},this.workerSourceTypes={vector:_,geojson:Xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(i.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');i.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isLoaded())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText}};return qe.prototype.setLayers=function(e,t,i){this.getLayerIndex(e).replace(t),i()},qe.prototype.updateLayers=function(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()},qe.prototype.loadTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).loadTile(t,i)},qe.prototype.loadDEMTile=function(e,t,i){this.getDEMWorkerSource(e,t.source).loadTile(t,i)},qe.prototype.reloadTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).reloadTile(t,i)},qe.prototype.abortTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)},qe.prototype.removeTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)},qe.prototype.removeDEMTile=function(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)},qe.prototype.removeSource=function(e,t,i){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}},qe.prototype.loadWorkerSource=function(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}},qe.prototype.loadRTLTextPlugin=function(t,i,r){try{e.plugin.isLoaded()||(this.self.importScripts(i),r(e.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+i)))}catch(e){r(e.toString())}},qe.prototype.getLayerIndex=function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t},qe.prototype.getWorkerSource=function(e,t,i){var r=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][i]){var n={send:function(t,i,n){r.actor.send(t,i,n,e)}};this.workerSources[e][t][i]=new this.workerSourceTypes[t](n,this.getLayerIndex(e))}return this.workerSources[e][t][i]},qe.prototype.getDEMWorkerSource=function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new I),this.demWorkerSources[e][t]},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&new qe(self),qe}),define(0,function(t){var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&function(t){return void 0===i[t]&&(i[t]=function(t){var i=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",n)||i.probablySupportsContext("experimental-webgl",n):i.supportsContext?i.supportsContext("webgl",n)||i.supportsContext("experimental-webgl",n):i.getContext("webgl",n)||i.getContext("experimental-webgl",n)}(t)),i[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),i=t.default.performance&&t.default.performance.now?t.default.performance.now.bind(t.default.performance):Date.now.bind(Date),n=t.default.requestAnimationFrame||t.default.mozRequestAnimationFrame||t.default.webkitRequestAnimationFrame||t.default.msRequestAnimationFrame,o=t.default.cancelAnimationFrame||t.default.mozCancelAnimationFrame||t.default.webkitCancelAnimationFrame||t.default.msCancelAnimationFrame,r={now:i,frame:function(t){return n(t)},cancelFrame:function(t){return o(t)},getImageData:function(e){var i=t.default.document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return i.width=e.width,i.height=e.height,n.drawImage(e,0,0,e.width,e.height),n.getImageData(0,0,e.width,e.height)},hardwareConcurrency:t.default.navigator.hardwareConcurrency||4,get devicePixelRatio(){return t.default.devicePixelRatio},supportsWebp:!1};if(t.default.document){var a=t.default.document.createElement("img");a.onload=function(){r.supportsWebp=!0},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="}var s={create:function(e,i,n){var o=t.default.document.createElement(e);return i&&(o.className=i),n&&n.appendChild(o),o},createNS:function(e,i){return t.default.document.createElementNS(e,i)}},l=t.default.document?t.default.document.documentElement.style:null;function c(t){if(!l)return null;for(var e=0;e<t.length;e++)if(t[e]in l)return t[e];return t[0]}var u,h=c(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);s.disableDrag=function(){l&&h&&(u=l[h],l[h]="none")},s.enableDrag=function(){l&&h&&(l[h]=u)};var p=c(["transform","WebkitTransform"]);s.setTransform=function(t,e){t.style[p]=e};var d=!1;try{var f=Object.defineProperty({},"passive",{get:function(){d=!0}});t.default.addEventListener("test",f,f),t.default.removeEventListener("test",f,f)}catch(t){d=!1}s.addEventListener=function(t,e,i,n){void 0===n&&(n={}),"passive"in n&&d?t.addEventListener(e,i,n):t.addEventListener(e,i,n.capture)},s.removeEventListener=function(t,e,i,n){void 0===n&&(n={}),"passive"in n&&d?t.removeEventListener(e,i,n):t.removeEventListener(e,i,n.capture)};var m=function(e){e.preventDefault(),e.stopPropagation(),t.default.removeEventListener("click",m,!0)};s.suppressClick=function(){t.default.addEventListener("click",m,!0),t.default.setTimeout(function(){t.default.removeEventListener("click",m,!0)},0)},s.mousePos=function(e,i){var n=e.getBoundingClientRect();return i=i.touches?i.touches[0]:i,new t.default$1(i.clientX-n.left-e.clientLeft,i.clientY-n.top-e.clientTop)},s.touchPos=function(e,i){for(var n=e.getBoundingClientRect(),o=[],r="touchend"===i.type?i.changedTouches:i.touches,a=0;a<r.length;a++)o.push(new t.default$1(r[a].clientX-n.left-e.clientLeft,r[a].clientY-n.top-e.clientTop));return o},s.mouseButton=function(e){return void 0!==t.default.InstallTrigger&&2===e.button&&e.ctrlKey&&t.default.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},s.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var _={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null},g="See https://www.mapbox.com/api-documentation/#access-tokens";function v(t,e){var i=C(_.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"/"!==i.path&&(t.path=""+i.path+t.path),!_.REQUIRE_ACCESS_TOKEN)return S(t);if(!(e=e||_.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+g);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+g);return t.params.push("access_token="+e),S(t)}function y(t){return 0===t.indexOf("mapbox:")}var b=function(t,e){if(!y(t))return t;var i=C(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),v(i,e)},w=function(t,e,i,n){var o=C(t);return y(t)?(o.path="/styles/v1"+o.path+"/sprite"+e+i,v(o,n)):(o.path+=""+e+i,S(o))},E=/(\.(png|jpg)\d*)(?=$)/,T=function(t,e,i){if(!e||!y(e))return t;var n=C(t),o=r.devicePixelRatio>=2||512===i?"@2x":"",a=r.supportsWebp?".webp":"$1";return n.path=n.path.replace(E,""+o+a),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(_.ACCESS_TOKEN||""))}(n.params),S(n)},I=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(t){var e=t.match(I);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function S(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var z=t.default.HTMLImageElement,A=t.default.HTMLCanvasElement,R=t.default.HTMLVideoElement,D=t.default.ImageData,M=function(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)};M.prototype.update=function(t,e){var i=t.width,n=t.height,o=!this.size||this.size[0]!==i||this.size[1]!==n,r=this.context,a=r.gl;this.useMipmap=Boolean(e&&e.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),o?(this.size=[i,n],r.pixelStoreUnpack.set(1),this.format!==a.RGBA||e&&!1===e.premultiply||r.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof z||t instanceof A||t instanceof R||t instanceof D?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,i,n,0,this.format,a.UNSIGNED_BYTE,t.data)):t instanceof z||t instanceof A||t instanceof R||t instanceof D?a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,0,0,i,n,a.RGBA,a.UNSIGNED_BYTE,t.data),this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)},M.prototype.bind=function(t,e,i){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},M.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},M.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var L=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new t.default$2(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new t.RGBAImage({width:64,height:64}),this.dirty=!0};L.prototype.isLoaded=function(){return this.loaded},L.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var n=i[e],o=n.ids,r=n.callback;this._notify(o,r)}this.requestors=[]}},L.prototype.getImage=function(t){return this.images[t]},L.prototype.addImage=function(t,e){this.images[t]=e},L.prototype.removeImage=function(t){delete this.images[t];var e=this.patterns[t];e&&(this.shelfPack.unref(e.bin),delete this.patterns[t])},L.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var n=0,o=t;n<o.length;n+=1){var r=o[n];this.images[r]||(i=!1)}this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})},L.prototype._notify=function(t,e){for(var i={},n=0,o=t;n<o.length;n+=1){var r=o[n],a=this.images[r];a&&(i[r]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf})}e(null,i)},L.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},L.prototype.getPattern=function(e){var i=this.patterns[e];if(i)return i.position;var n=this.getImage(e);if(!n)return null;var o=n.data.width+2,r=n.data.height+2,a=this.shelfPack.packOne(o,r);if(!a)return null;this.atlasImage.resize(this.getPixelSize());var s=n.data,l=this.atlasImage,c=a.x+1,u=a.y+1,h=s.width,p=s.height;t.RGBAImage.copy(s,l,{x:0,y:0},{x:c,y:u},{width:h,height:p}),t.RGBAImage.copy(s,l,{x:0,y:p-1},{x:c,y:u-1},{width:h,height:1}),t.RGBAImage.copy(s,l,{x:0,y:0},{x:c,y:u+p},{width:h,height:1}),t.RGBAImage.copy(s,l,{x:h-1,y:0},{x:c-1,y:u},{width:1,height:p}),t.RGBAImage.copy(s,l,{x:0,y:0},{x:c+h,y:u},{width:1,height:p}),this.dirty=!0;var d=new t.ImagePosition(a,n);return this.patterns[e]={bin:a,position:d},d},L.prototype.bind=function(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new M(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)};var P=B,k=1e20;function B(t,e,i,n,o,r){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=o||"sans-serif",this.fontWeight=r||"normal",this.radius=i||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function O(t,e,i,n,o,r,a){for(var s=0;s<e;s++){for(var l=0;l<i;l++)n[l]=t[l*e+s];for(F(n,o,r,a,i),l=0;l<i;l++)t[l*e+s]=o[l]}for(l=0;l<i;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(F(n,o,r,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(o[s])}}function F(t,e,i,n,o){i[0]=0,n[0]=-k,n[1]=+k;for(var r=1,a=0;r<o;r++){for(var s=(t[r]+r*r-(t[i[a]]+i[a]*i[a]))/(2*r-2*i[a]);s<=n[a];)a--,s=(t[r]+r*r-(t[i[a]]+i[a]*i[a]))/(2*r-2*i[a]);i[++a]=r,n[a]=s,n[a+1]=+k}for(r=0,a=0;r<o;r++){for(;n[a+1]<r;)a++;e[r]=(r-i[a])*(r-i[a])+t[i[a]]}}B.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var o=e.data[4*n+3]/255;this.gridOuter[n]=1===o?0:0===o?k:Math.pow(Math.max(0,.5-o),2),this.gridInner[n]=1===o?k:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(O(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),O(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++){var r=this.gridOuter[n]-this.gridInner[n];i[n]=Math.max(0,Math.min(255,Math.round(255-255*(r/this.radius+this.cutoff))))}return i};var N=function(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={}};N.prototype.setURL=function(t){this.url=t},N.prototype.getGlyphs=function(e,i){var n=this,o=[];for(var r in e)for(var a=0,s=e[r];a<s.length;a+=1){var l=s[a];o.push({stack:r,id:l})}t.asyncAll(o,function(t,e){var i=t.stack,o=t.id,r=n.entries[i];r||(r=n.entries[i]={glyphs:{},requests:{}});var a=r.glyphs[o];if(void 0===a)if(a=n._tinySDF(r,i,o))e(null,{stack:i,id:o,glyph:a});else{var s=Math.floor(o/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var l=r.requests[s];l||(l=r.requests[s]=[],N.loadGlyphRange(i,s,n.url,n.requestTransform,function(t,e){if(e)for(var i in e)r.glyphs[+i]=e[+i];for(var n=0,o=l;n<o.length;n+=1)(0,o[n])(t,e);delete r.requests[s]})),l.push(function(t,n){t?e(t):n&&e(null,{stack:i,id:o,glyph:n[o]||null})})}}else e(null,{stack:i,id:o,glyph:a})},function(t,e){if(t)i(t);else if(e){for(var n={},o=0,r=e;o<r.length;o+=1){var a=r[o],s=a.stack,l=a.id,c=a.glyph;(n[s]||(n[s]={}))[l]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}i(null,n)}})},N.prototype._tinySDF=function(e,i,n){var o=this.localIdeographFontFamily;if(o&&(t.default$4["CJK Unified Ideographs"](n)||t.default$4["Hangul Syllables"](n))){var r=e.tinySDF;if(!r){var a="400";/bold/i.test(i)?a="900":/medium/i.test(i)?a="500":/light/i.test(i)&&(a="200"),r=e.tinySDF=new N.TinySDF(24,3,8,.25,o,a)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},r.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},N.loadGlyphRange=function(e,i,n,o,r){var a=256*i,s=a+255,l=o(function(t,e){if(!y(t))return t;var i=C(t);return i.path="/fonts/v1"+i.path,v(i,e)}(n).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,function(e,i){if(e)r(e);else if(i){for(var n={},o=0,a=t.default$3(i.data);o<a.length;o+=1){var s=a[o];n[s.id]=s}r(null,n)}})},N.TinySDF=P;var U=function(){this.specification=t.default$5.light.position};U.prototype.possiblyEvaluate=function(e,i){return t.sphericalToCartesian(e.expression.evaluate(i))},U.prototype.interpolate=function(e,i,n){return{x:t.number(e.x,i.x,n),y:t.number(e.y,i.y,n),z:t.number(e.z,i.z,n)}};var Z=new t.Properties({anchor:new t.DataConstantProperty(t.default$5.light.anchor),position:new U,color:new t.DataConstantProperty(t.default$5.light.color),intensity:new t.DataConstantProperty(t.default$5.light.intensity)}),V=function(e){function i(i){e.call(this),this._transitionable=new t.Transitionable(Z),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(e){if(!this._validate(t.validateLight,e))for(var i in e){var n=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),n):this._transitionable.setValue(i,n)}},i.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},i.prototype._validate=function(e,i){return t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.default$5})))},i}(t.Evented),j=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};j.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},j.prototype.addDash=function(e,i){var n=i?7:0,o=2*n+1;if(this.nextRow+o>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var r=0,a=0;a<e.length;a++)r+=e[a];for(var s=this.width/r,l=s/2,c=e.length%2==1,u=-n;u<=n;u++)for(var h=this.nextRow+n+u,p=this.width*h,d=c?-e[e.length-1]:0,f=e[0],m=1,_=0;_<this.width;_++){for(;f<_/s;)d=f,f+=e[m],c&&m===e.length-1&&(f+=e[0]),m++;var g=Math.abs(_-d*s),v=Math.abs(_-f*s),y=Math.min(g,v),x=m%2==1,b=void 0;if(i){var w=n?u/n*(l+1):0;if(x){var E=l-Math.abs(w);b=Math.sqrt(y*y+E*E)}else b=l-Math.sqrt(y*y+w*w)}else b=(x?1:-1)*y;this.data[3+4*(p+_)]=Math.max(0,Math.min(255,b+128))}var T={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:r};return this.nextRow+=o,this.dirty=!0,T},j.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var $=function e(i,n){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var o=this.workerPool.acquire(this.id),r=0;r<o.length;r++){var a=o[r],s=new e.Actor(a,n,this.id);s.name="Worker "+r,this.actors.push(s)}};function G(e,i,n){var o=function(e,i){if(e)return n(e);if(i){var o=t.pick(i,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);i.vector_layers&&(o.vectorLayers=i.vector_layers,o.vectorLayerIds=o.vectorLayers.map(function(t){return t.id})),n(null,o)}};e.url?t.getJSON(i(b(e.url),t.ResourceType.Source),o):r.frame(function(){return o(null,e)})}$.prototype.broadcast=function(e,i,n){n=n||function(){},t.asyncAll(this.actors,function(t,n){t.send(e,i,n)},n)},$.prototype.send=function(t,e,i,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i),n},$.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},$.Actor=t.default$7;var W=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};W.prototype.wrap=function(){return new W(t.wrap(this.lng,-180,180),this.lat)},W.prototype.toArray=function(){return[this.lng,this.lat]},W.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},W.prototype.toBounds=function(t){var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new q(new W(this.lng-i,this.lat-e),new W(this.lng+i,this.lat+e))},W.convert=function(t){if(t instanceof W)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new W(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new W(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var q=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};q.prototype.setNorthEast=function(t){return this._ne=t instanceof W?new W(t.lng,t.lat):W.convert(t),this},q.prototype.setSouthWest=function(t){return this._sw=t instanceof W?new W(t.lng,t.lat):W.convert(t),this},q.prototype.extend=function(t){var e,i,n=this._sw,o=this._ne;if(t instanceof W)e=t,i=t;else{if(!(t instanceof q))return Array.isArray(t)?t.every(Array.isArray)?this.extend(q.convert(t)):this.extend(W.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return n||o?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),o.lng=Math.max(i.lng,o.lng),o.lat=Math.max(i.lat,o.lat)):(this._sw=new W(e.lng,e.lat),this._ne=new W(i.lng,i.lat)),this},q.prototype.getCenter=function(){return new W((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},q.prototype.getSouthWest=function(){return this._sw},q.prototype.getNorthEast=function(){return this._ne},q.prototype.getNorthWest=function(){return new W(this.getWest(),this.getNorth())},q.prototype.getSouthEast=function(){return new W(this.getEast(),this.getSouth())},q.prototype.getWest=function(){return this._sw.lng},q.prototype.getSouth=function(){return this._sw.lat},q.prototype.getEast=function(){return this._ne.lng},q.prototype.getNorth=function(){return this._ne.lat},q.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},q.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},q.prototype.isEmpty=function(){return!(this._sw&&this._ne)},q.convert=function(t){return!t||t instanceof q?t:new q(t)};var X=function(t,e,i){this.bounds=q.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24};X.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},X.prototype.contains=function(t){var e=Math.floor(this.lngX(this.bounds.getWest(),t.z)),i=Math.floor(this.latY(this.bounds.getNorth(),t.z)),n=Math.ceil(this.lngX(this.bounds.getEast(),t.z)),o=Math.ceil(this.latY(this.bounds.getSouth(),t.z));return t.x>=e&&t.x<n&&t.y>=i&&t.y<o},X.prototype.lngX=function(t,e){return(t+180)*(Math.pow(2,e)/360)},X.prototype.latY=function(e,i){var n=t.clamp(Math.sin(Math.PI/180*e),-.9999,.9999),o=Math.pow(2,i)/(2*Math.PI);return Math.pow(2,i-1)+.5*Math.log((1+n)/(1-n))*-o};var H=function(e){function i(i,n,o,r){if(e.call(this),this.id=i,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,t.extend(this,t.pick(n,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),G(this._options,this.map._transformRequest,function(i,n){i?e.fire(new t.ErrorEvent(i)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new X(n.bounds,e.minzoom,e.maxzoom)),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.loadTile=function(e,i){var n=T(e.tileID.canonical.url(this.tiles,this.scheme),this.url),o={request:this.map._transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function a(t,n){return e.aborted?i(null):t?i(t):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}o.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",o,a.bind(this)):"loading"===e.state?e.reloadCallback=i:this.dispatcher.send("reloadTile",o,a.bind(this),e.workerID)},i.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},i.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},i.prototype.hasTransition=function(){return!1},i}(t.Evented),K=function(e){function i(i,n,o,r){e.call(this),this.id=i,this.dispatcher=o,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),G(this._options,this.map._transformRequest,function(i,n){i?e.fire(new t.ErrorEvent(i)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new X(n.bounds,e.minzoom,e.maxzoom)),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.loadTile=function(e,i){var n=this,o=T(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._transformRequest(o,t.ResourceType.Tile),function(t,o){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(t)e.state="errored",i(t);else if(o){n.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var r=n.map.painter.context,a=r.gl;e.texture=n.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new M(r,o,a.RGBA,{useMipmap:!0}),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),e.state="loaded",i(null)}})},i.prototype.abortTile=function(t,e){t.request&&(t.request.abort(),delete t.request),e()},i.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},i.prototype.hasTransition=function(){return!1},i}(t.Evented),Y=function(e){function i(i,n,o,r){e.call(this,i,n,o,r),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({},n),this.encoding=n.encoding||"mapbox"}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(e,i){var n=T(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._transformRequest(n,t.ResourceType.Tile),function(t,n){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(t)e.state="errored",i(t);else if(n){this.map._refreshExpiredTiles&&e.setExpiryData(n),delete n.cacheControl,delete n.expires;var o=r.getImageData(n),a={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",a,function(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",i(null))}.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},i.prototype._getNeighboringTiles=function(e){var i=e.canonical,n=Math.pow(2,i.z),o=(i.x-1+n)%n,r=0===i.x?e.wrap-1:e.wrap,a=(i.x+1+n)%n,s=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,r,i.z,o,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,r,i.z,o,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,r,i.z,o,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y+1).key]={backfilled:!1}),l},i.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},i}(K),J=function(e){function i(i,n,o,r){e.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=o,this.setEventedParent(r),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type);var a=t.default$8/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:t.default$8,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.default$8,radius:(n.clusterRadius||50)*a,log:!1}},n.workerOptions)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(i){if(i)e.fire(new t.ErrorEvent(i));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}})},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setData=function(e){var i=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)return i.fire(new t.ErrorEvent(e));var n={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(n.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new t.Event("data",n))}),this},i.prototype._updateWorkerData=function(e){var i,n,o=this,r=t.extend({},this.workerOptions),a=this._data;"string"==typeof a?(r.request=this.map._transformRequest((i=a,(n=t.default.document.createElement("a")).href=i,n.href),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(a),this.workerID=this.dispatcher.send(this.type+"."+r.source+".loadData",r,function(t,i){o._removed||i&&i.abandoned||(o._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[o.id]&&(o._resourceTiming=i.resourceTiming[o.id].slice(0)),o.dispatcher.send(o.type+"."+r.source+".coalesce",null,null,o.workerID),e(t))},this.workerID)},i.prototype.loadTile=function(t,e){var i=this,n=void 0===t.workerID?"loadTile":"reloadTile",o={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send(n,o,function(o,r){return t.unloadVectorData(),t.aborted?e(null):o?e(o):(t.loadVectorData(r,i.map.painter,"reloadTile"===n),e(null))},this.workerID)},i.prototype.abortTile=function(t){t.aborted=!0},i.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},i.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},i.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i}(t.Evented),Q=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),tt=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};tt.prototype.bind=function(t,e,i,n,o,r,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,c=0;!l&&c<n.length;c++)this.boundPaintVertexBuffers[c]!==n[c]&&(l=!0);var u=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||this.boundIndexBuffer!==o||this.boundVertexOffset!==r||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||u?this.freshBind(e,i,n,o,r,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),o&&o.dynamicDraw&&o.bind(),s&&s.bind())},tt.prototype.freshBind=function(t,e,i,n,o,r,a){var s,l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=o,this.boundDynamicVertexBuffer=r,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(var h=l;h<s;h++)u.disableVertexAttribArray(h)}e.enableAttributes(u,t);for(var p=0,d=i;p<d.length;p+=1)d[p].enableAttributes(u,t);r&&r.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,o);for(var f=0,m=i;f<m.length;f+=1){var _=m[f];_.bind(),_.setVertexAttribPointers(u,t,o)}r&&(r.bind(),r.setVertexAttribPointers(u,t,o)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(u,t,o)),c.currentNumAttributes=l},tt.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var et=function(e){function i(t,i,n,o){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(o),this.options=i}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._transformRequest(this.url,t.ResourceType.Image),function(i,n){i?e.fire(new t.ErrorEvent(i)):n&&(e.image=r.getImageData(n),e._finishLoading())})},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setCoordinates=function(e){this.coordinates=e;var i=this.map,n=e.map(function(t){return i.transform.locationCoordinate(W.convert(t)).zoomTo(0)}),o=this.centerCoord=t.getCoordinatesCenter(n);o.column=Math.floor(o.column),o.row=Math.floor(o.row),this.tileID=new t.CanonicalTileID(o.zoom,o.column,o.row),this.minzoom=this.maxzoom=o.zoom;var r=n.map(function(e){var i=e.zoomTo(o.zoom);return new t.default$1(Math.round((i.column-o.column)*t.default$8),Math.round((i.row-o.row)*t.default$8))});return this._boundsArray=new t.RasterBoundsArray,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.default$8,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.default$8),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.default$8,t.default$8),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Q.members)),this.boundsVAO||(this.boundsVAO=new tt),this.texture||(this.texture=new M(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i}(t.Evented),it=function(e){function i(t,i,n,o){e.call(this,t,i,n,o),this.roundZoom=!0,this.type="video",this.options=i}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){var e=this,i=this.options;this.urls=[];for(var n=0,o=i.urls;n<o.length;n+=1){var r=o[n];e.urls.push(e.map._transformRequest(r,t.ResourceType.Source).url)}t.getVideo(this.urls,function(i,n){i?e.fire(new t.ErrorEvent(i)):n&&(e.video=n,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map._rerender()}),e.map&&e.video.play(),e._finishLoading())})},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Q.members)),this.boundsVAO||(this.boundsVAO=new tt),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new M(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(et),nt=function(e){function i(i,n,o,r){e.call(this,i,n,o,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new t.ErrorEvent(new t.default$9("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.default$9("sources."+i,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.default$9("sources."+i,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.default.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.default$9("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.default$9("sources."+i,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof t.default.HTMLCanvasElement?this.options.canvas:t.default.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map._rerender()},this.pause=function(){this._playing=!1},this._finishLoading())},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},i.prototype.onRemove=function(){this.pause()},i.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,i=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Q.members)),this.boundsVAO||(this.boundsVAO=new tt),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.canvas)):(this.texture=new M(e,this.canvas,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var o=this.tiles[n];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},i}(et),ot={vector:H,raster:K,"raster-dem":Y,geojson:J,video:it,image:et,canvas:nt},rt=function(e,i,n,o){var r=new ot[i.type](e,i,n,o);if(r.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+r.id);return t.bindAll(["load","abort","unload","serialize","prepare"],r),r};function at(t,e,i,n,o){var r=o.maxPitchScaleFactor(),a=t.tilesIn(i,r);a.sort(st);for(var s=[],l=0,c=a;l<c.length;l+=1){var u=c[l];s.push({wrappedTileID:u.tileID.wrapped().key,queryResults:u.tile.queryRenderedFeatures(e,u.queryGeometry,u.scale,n,o,r,t.transform.calculatePosMatrix(u.tileID.toUnwrapped()))})}return function(t){for(var e={},i={},n=0,o=t;n<o.length;n+=1){var r=o[n],a=r.queryResults,s=r.wrappedTileID,l=i[s]=i[s]||{};for(var c in a)for(var u=a[c],h=l[c]=l[c]||{},p=e[c]=e[c]||[],d=0,f=u;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m.feature))}}return e}(s)}function st(t,e){var i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}var lt=function(e,i){this.tileID=e,this.uid=t.uniqueId(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.expiredRequestCount=0,this.state="loading"};lt.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<r.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},lt.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},lt.prototype.loadVectorData=function(e,i,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){if(e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){var i={};if(!e)return i;for(var n=0,o=t;n<o.length;n+=1){var r=o[n],a=r.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==a.length){r.layers=a;for(var s=0,l=a;s<l.length;s+=1)i[l[s].id]=r}}return i}(e.buckets,i.style),n)for(var o in this.buckets){var r=this.buckets[o];r instanceof t.default$14&&(r.justReloaded=!0)}for(var a in this.queryPadding=0,this.buckets){var s=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(s.layerIds[0]).queryRadius(s))}e.iconAtlasImage&&(this.iconAtlasImage=e.iconAtlasImage),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.CollisionBoxArray},lt.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},lt.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},lt.prototype.getBucket=function(t){return this.buckets[t.id]},lt.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploaded||(i.upload(t),i.uploaded=!0)}var n=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new M(t,this.iconAtlasImage,n.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new M(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},lt.prototype.queryRenderedFeatures=function(t,e,i,n,o,r,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:e,scale:i,tileSize:this.tileSize,posMatrix:a,transform:o,params:n,queryPadding:this.queryPadding*r},t):{}},lt.prototype.querySourceFeatures=function(e,i){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var n=this.latestFeatureIndex.loadVTLayers(),o=i?i.sourceLayer:"",r=n._geojsonTileLayer||n[o];if(r)for(var a=t.default$13(i&&i.filter),s={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},l=0;l<r.length;l++){var c=r.feature(l);if(a(new t.default$16(this.tileID.overscaledZ),c)){var u=new t.default$12(c,s.z,s.x,s.y);u.tile=s,e.push(u)}}}},lt.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},lt.prototype.setMask=function(e,i){if(!t.default$10(this.mask,e)&&(this.mask=e,this.clearMask(),!t.default$10(e,{0:!0}))){var n=new t.RasterBoundsArray,o=new t.TriangleIndexArray;this.segments=new t.default$15,this.segments.prepareSegment(0,n,o);for(var r=Object.keys(e),a=0;a<r.length;a++){var s=e[r[a]],l=t.default$8>>s.z,c=new t.default$1(s.x*l,s.y*l),u=new t.default$1(c.x+l,c.y+l),h=this.segments.prepareSegment(4,n,o);n.emplaceBack(c.x,c.y,c.x,c.y),n.emplaceBack(u.x,c.y,u.x,c.y),n.emplaceBack(c.x,u.y,c.x,u.y),n.emplaceBack(u.x,u.y,u.x,u.y);var p=h.vertexLength;o.emplaceBack(p,p+1,p+2),o.emplaceBack(p+1,p+2,p+3),h.vertexLength+=4,h.primitiveLength+=2}this.maskedBoundsBuffer=i.createVertexBuffer(n,Q.members),this.maskedIndexBuffer=i.createIndexBuffer(o)}},lt.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},lt.prototype.setExpiryData=function(e){var i=this.expirationTime;if(e.cacheControl){var n=t.parseCacheControl(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var o=Date.now(),r=!1;if(this.expirationTime>o)r=!1;else if(i)if(this.expirationTime<i)r=!0;else{var a=this.expirationTime-i;a?this.expirationTime=o+Math.max(a,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},lt.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)};var ct=function(t,e){this.max=t,this.onRemove=e,this.reset()};ct.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var n=i[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},ct.prototype.add=function(t,e,i){var n=this,o=t.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);var r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout(function(){n.remove(t,r)},i)),this.data[o].push(r),this.order.push(o),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},ct.prototype.has=function(t){return t.wrapped().key in this.data},ct.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},ct.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},ct.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},ct.prototype.remove=function(t,e){if(!this.has(t))return this;var i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),o=this.data[i][n];return this.data[i].splice(n,1),o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(o.value),this.order.splice(this.order.indexOf(i),1),this},ct.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var ut=function(t,e,i){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};ut.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null)},ut.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ut.prototype.updateData=function(t){var e=this.context.gl;this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},ut.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var ht={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},pt=function(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var o=t.gl;this.buffer=o.createBuffer(),t.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};pt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},pt.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},pt.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],o=e.attributes[n.name];void 0!==o&&t.enableVertexAttribArray(o)}},pt.prototype.setVertexAttribPointers=function(t,e,i){for(var n=0;n<this.attributes.length;n++){var o=this.attributes[n],r=e.attributes[o.name];void 0!==r&&t.vertexAttribPointer(r,o.components,t[ht[o.type]],!1,this.itemSize,o.offset+this.itemSize*(i||0))}},pt.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var dt=function(e){this.context=e,this.current=t.default$6.transparent};dt.prototype.get=function(){return this.current},dt.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t)};var ft=function(t){this.context=t,this.current=1};ft.prototype.get=function(){return this.current},ft.prototype.set=function(t){this.current!==t&&(this.context.gl.clearDepth(t),this.current=t)};var mt=function(t){this.context=t,this.current=0};mt.prototype.get=function(){return this.current},mt.prototype.set=function(t){this.current!==t&&(this.context.gl.clearStencil(t),this.current=t)};var _t=function(t){this.context=t,this.current=[!0,!0,!0,!0]};_t.prototype.get=function(){return this.current},_t.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t)};var gt=function(t){this.context=t,this.current=!0};gt.prototype.get=function(){return this.current},gt.prototype.set=function(t){this.current!==t&&(this.context.gl.depthMask(t),this.current=t)};var vt=function(t){this.context=t,this.current=255};vt.prototype.get=function(){return this.current},vt.prototype.set=function(t){this.current!==t&&(this.context.gl.stencilMask(t),this.current=t)};var yt=function(t){this.context=t,this.current={func:t.gl.ALWAYS,ref:0,mask:255}};yt.prototype.get=function(){return this.current},yt.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t)};var xt=function(t){this.context=t;var e=this.context.gl;this.current=[e.KEEP,e.KEEP,e.KEEP]};xt.prototype.get=function(){return this.current},xt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t)};var bt=function(t){this.context=t,this.current=!1};bt.prototype.get=function(){return this.current},bt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t}};var wt=function(t){this.context=t,this.current=[0,1]};wt.prototype.get=function(){return this.current},wt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.depthRange(t[0],t[1]),this.current=t)};var Et=function(t){this.context=t,this.current=!1};Et.prototype.get=function(){return this.current},Et.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t}};var Tt=function(t){this.context=t,this.current=t.gl.LESS};Tt.prototype.get=function(){return this.current},Tt.prototype.set=function(t){this.current!==t&&(this.context.gl.depthFunc(t),this.current=t)};var It=function(t){this.context=t,this.current=!1};It.prototype.get=function(){return this.current},It.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t}};var Ct=function(t){this.context=t;var e=this.context.gl;this.current=[e.ONE,e.ZERO]};Ct.prototype.get=function(){return this.current},Ct.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.blendFunc(t[0],t[1]),this.current=t)};var St=function(e){this.context=e,this.current=t.default$6.transparent};St.prototype.get=function(){return this.current},St.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t)};var zt=function(t){this.context=t,this.current=null};zt.prototype.get=function(){return this.current},zt.prototype.set=function(t){this.current!==t&&(this.context.gl.useProgram(t),this.current=t)};var At=function(t){this.context=t,this.current=1};At.prototype.get=function(){return this.current},At.prototype.set=function(e){var i=this.context.lineWidthRange,n=t.clamp(e,i[0],i[1]);this.current!==n&&(this.context.gl.lineWidth(n),this.current=e)};var Rt=function(t){this.context=t,this.current=t.gl.TEXTURE0};Rt.prototype.get=function(){return this.current},Rt.prototype.set=function(t){this.current!==t&&(this.context.gl.activeTexture(t),this.current=t)};var Dt=function(t){this.context=t;var e=this.context.gl;this.current=[0,0,e.drawingBufferWidth,e.drawingBufferHeight]};Dt.prototype.get=function(){return this.current},Dt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t)};var Mt=function(t){this.context=t,this.current=null};Mt.prototype.get=function(){return this.current},Mt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t}};var Lt=function(t){this.context=t,this.current=null};Lt.prototype.get=function(){return this.current},Lt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t}};var Pt=function(t){this.context=t,this.current=null};Pt.prototype.get=function(){return this.current},Pt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t}};var kt=function(t){this.context=t,this.current=null};kt.prototype.get=function(){return this.current},kt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t}};var Bt=function(t){this.context=t,this.current=null};Bt.prototype.get=function(){return this.current},Bt.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t};var Ot=function(t){this.context=t,this.current=null};Ot.prototype.get=function(){return this.current},Ot.prototype.set=function(t){this.current!==t&&this.context.extVertexArrayObject&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t)};var Ft=function(t){this.context=t,this.current=4};Ft.prototype.get=function(){return this.current},Ft.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t}};var Nt=function(t){this.context=t,this.current=!1};Nt.prototype.get=function(){return this.current},Nt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t}};var Ut=function(t,e){this.context=t,this.current=null,this.parent=e};Ut.prototype.get=function(){return this.current};var Zt=function(t){function e(e,i){t.call(this,e,i),this.dirty=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e.prototype.setDirty=function(){this.dirty=!0},e}(Ut),Vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t}},e}(Ut),jt=function(t,e,i){this.context=t,this.width=e,this.height=i;var n=t.gl,o=this.framebuffer=n.createFramebuffer();this.colorAttachment=new Zt(t,o),this.depthAttachment=new Vt(t,o)};jt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i),t.deleteFramebuffer(this.framebuffer)};var $t=function(t,e,i){this.func=t,this.mask=e,this.range=i};$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);var Gt=function(t,e,i,n,o,r){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=o,this.pass=r};Gt.disabled=new Gt({func:519,mask:0},0,0,7680,7680,7680);var Wt=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i};Wt.disabled=new Wt(Wt.Replace=[1,0],t.default$6.transparent,[!1,!1,!1,!1]),Wt.unblended=new Wt(Wt.Replace,t.default$6.transparent,[!0,!0,!0,!0]),Wt.alphaBlended=new Wt([1,771],t.default$6.transparent,[!0,!0,!0,!0]);var qt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.clearColor=new dt(this),this.clearDepth=new ft(this),this.clearStencil=new mt(this),this.colorMask=new _t(this),this.depthMask=new gt(this),this.stencilMask=new vt(this),this.stencilFunc=new yt(this),this.stencilOp=new xt(this),this.stencilTest=new bt(this),this.depthRange=new wt(this),this.depthTest=new Et(this),this.depthFunc=new Tt(this),this.blend=new It(this),this.blendFunc=new Ct(this),this.blendColor=new St(this),this.program=new zt(this),this.lineWidth=new At(this),this.activeTexture=new Rt(this),this.viewport=new Dt(this),this.bindFramebuffer=new Mt(this),this.bindRenderbuffer=new Lt(this),this.bindTexture=new Pt(this),this.bindVertexBuffer=new kt(this),this.bindElementBuffer=new Bt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ot(this),this.pixelStoreUnpack=new Ft(this),this.pixelStoreUnpackPremultiplyAlpha=new Nt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};qt.prototype.createIndexBuffer=function(t,e){return new ut(this,t,e)},qt.prototype.createVertexBuffer=function(t,e,i){return new pt(this,t,e,i)},qt.prototype.createRenderbuffer=function(t,e,i){var n=this.gl,o=n.createRenderbuffer();return this.bindRenderbuffer.set(o),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),o},qt.prototype.createFramebuffer=function(t,e){return new jt(this,t,e)},qt.prototype.clear=function(t){var e=t.color,i=t.depth,n=this.gl,o=0;e&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(o|=n.DEPTH_BUFFER_BIT,this.clearDepth.set(i),this.depthMask.set(!0)),n.clear(o)},qt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},qt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},qt.prototype.setColorMode=function(e){t.default$10(e.blendFunction,Wt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)};var Xt=function(e){function i(t,i,n){var o=this;e.call(this),this.id=t,this.dispatcher=n,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))}),this.on("error",function(){o._sourceErrored=!0}),this._source=rt(t,i,n,this),this._tiles={},this._cache=new ct(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={}}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},i.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},i.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},i.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},i.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._tiles)this._tiles[e].upload(t)},i.prototype.getIds=function(){var e=this;return Object.keys(this._tiles).map(Number).sort(function(i,n){var o=e._tiles[i].tileID,r=e._tiles[n].tileID,a=new t.default$1(o.canonical.x,o.canonical.y).rotate(e.transform.angle),s=new t.default$1(r.canonical.x,r.canonical.y).rotate(e.transform.angle);return o.overscaledZ-r.overscaledZ||s.y-a.y||s.x-a.x})},i.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},i.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0,{});return!!e&&this._isIdRenderable(e.tileID.key)},i.prototype._isIdRenderable=function(t){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)this._reloadTile(t,"reloading")},i.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))},i.prototype._tileLoaded=function(e,i,n,o){if(o)return e.state="errored",void(404!==o.status?this._source.fire(new t.ErrorEvent(o,{tile:e})):this.update(this.transform));e.timeAdded=r.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null)},i.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),i=0;i<e.length;i++){var n=e[i];if(t.neighboringTiles&&t.neighboringTiles[n]){var o=this.getTileByID(n);r(t,o),r(o,t)}}function r(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,o=Math.pow(2,t.tileID.canonical.z),r=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+o)?i+=o:1===Math.abs(i-o)&&(i-=o)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[r]&&(t.neighboringTiles[r].backfilled=!0)))}},i.prototype.getTile=function(t){return this.getTileByID(t.key)},i.prototype.getTileByID=function(t){return this._tiles[t]},i.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},i.prototype._findLoadedChildren=function(t,e,i){var n=!1;for(var o in this._tiles){var r=this._tiles[o];if(!(i[o]||!r.hasData()||r.tileID.overscaledZ<=t.overscaledZ||r.tileID.overscaledZ>e)){var a=Math.pow(2,r.tileID.canonical.z-t.canonical.z);if(Math.floor(r.tileID.canonical.x/a)===t.canonical.x&&Math.floor(r.tileID.canonical.y/a)===t.canonical.y)for(i[o]=r.tileID,n=!0;r&&r.tileID.overscaledZ-1>t.overscaledZ;){var s=r.tileID.scaledTo(r.tileID.overscaledZ-1);if(!s)break;(r=this._tiles[s.key])&&r.hasData()&&(delete i[o],i[s.key]=s)}}}return n},i.prototype.findLoadedParent=function(t,e,i){for(var n=t.overscaledZ-1;n>=e;n--){var o=t.scaledTo(n);if(!o)return;var r=String(o.key),a=this._tiles[r];if(a&&a.hasData())return i[r]=o,a;if(this._cache.has(o))return i[r]=o,this._cache.get(o)}},i.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),i=Math.floor(5*e),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(n)},i.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,i=Math.round(e);if(this._prevLng=t,i){var n={};for(var o in this._tiles){var r=this._tiles[o];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+i),n[r.tileID.key]=r}for(var a in this._tiles=n,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var s in this._tiles){var l=this._tiles[s];this._setTileReloadTimer(s,l)}}},i.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var o;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(o=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(o=o.filter(function(t){return n._source.hasTile(t)}))):o=[];var a,s=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),l=Math.max(s-i.maxOverzooming,this._source.minzoom),c=Math.max(s+i.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(o,s),h={};if(Kt(this._source.type))for(var p=Object.keys(u),d=0;d<p.length;d++){var f=p[d],m=u[f],_=n._tiles[f];if(_&&(void 0===_.fadeEndTime||_.fadeEndTime>=r.now())){n._findLoadedChildren(m,c,u)&&(u[f]=m);var g=n.findLoadedParent(m,l,h);g&&n._addTile(g.tileID)}}for(a in h)u[a]||(n._coveredTiles[a]=!0);for(a in h)u[a]=h[a];for(var v=t.keysDifference(this._tiles,u),y=0;y<v.length;y++)n._removeTile(v[y])}},i.prototype._updateRetainedTiles=function(t,e){for(var n={},o={},r=Math.max(e-i.maxOverzooming,this._source.minzoom),a=Math.max(e+i.maxUnderzooming,this._source.minzoom),s=0;s<t.length;s++){var l=t[s],c=this._addTile(l),u=!1;if(c.hasData())n[l.key]=l;else{u=c.wasRequested(),n[l.key]=l;var h=!0;if(e+1>this._source.maxzoom){var p=l.children(this._source.maxzoom)[0],d=this.getTile(p);d&&d.hasData()?n[p.key]=p:h=!1}else{this._findLoadedChildren(l,a,n);for(var f=l.children(this._source.maxzoom),m=0;m<f.length;m++)if(!n[f[m].key]){h=!1;break}}if(!h)for(var _=l.overscaledZ-1;_>=r;--_){var g=l.scaledTo(_);if(o[g.key])break;if(o[g.key]=!0,!(c=this.getTile(g))&&u&&(c=this._addTile(g)),c&&(n[g.key]=g,u=c.wasRequested(),c.hasData()))break}}}return n},i.prototype._addTile=function(e){var i=this._tiles[e.key];if(i)return i;(i=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,i),i.tileID=e);var n=Boolean(i);return n||(i=new lt(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new t.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){i._reloadTile(t,"expired"),delete i._timers[t]},n))},i.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},i.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},i.prototype.tilesIn=function(e,i){for(var n=[],o=this.getIds(),r=1/0,a=1/0,s=-1/0,l=-1/0,c=e[0].zoom,u=0;u<e.length;u++){var h=e[u];r=Math.min(r,h.column),a=Math.min(a,h.row),s=Math.max(s,h.column),l=Math.max(l,h.row)}for(var p=0;p<o.length;p++){var d=this._tiles[o[p]],f=d.tileID,m=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),_=i*d.queryPadding*t.default$8/d.tileSize/m,g=[Ht(f,new t.default$17(r,a,c)),Ht(f,new t.default$17(s,l,c))];if(g[0].x-_<t.default$8&&g[0].y-_<t.default$8&&g[1].x+_>=0&&g[1].y+_>=0){for(var v=[],y=0;y<e.length;y++)v.push(Ht(f,e[y]));n.push({tile:d,tileID:f,queryGeometry:[v],scale:m})}}return n},i.prototype.getVisibleCoordinates=function(){for(var t=this,e=this.getRenderableIds().map(function(e){return t._tiles[e].tileID}),i=0,n=e;i<n.length;i+=1){var o=n[i];o.posMatrix=t.transform.calculatePosMatrix(o.toUnwrapped())}return e},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Kt(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=r.now())return!0}return!1},i}(t.Evented);function Ht(e,i){var n=i.zoomTo(e.canonical.z);return new t.default$1((n.column-(e.canonical.x+e.wrap*Math.pow(2,e.canonical.z)))*t.default$8,(n.row-e.canonical.y)*t.default$8)}function Kt(t){return"raster"===t||"image"===t||"video"===t}function Yt(){return new t.default.Worker(Rn.workerUrl)}Xt.maxOverzooming=10,Xt.maxUnderzooming=3;var Jt,Qt=function(){this.active={}};function te(e,i){var n={};for(var o in e)"ref"!==o&&(n[o]=e[o]);return t.default$18.forEach(function(t){t in i&&(n[t]=i[t])}),n}function ee(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=te(t[n],e[t[n].ref]));return t}Qt.prototype.acquire=function(t){if(!this.workers){var e=Rn.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new Yt)}return this.active[t]=!0,this.workers.slice()},Qt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ne(t,e,i){i.push({command:ie.addSource,args:[t,e[t]]})}function oe(t,e,i){e.push({command:ie.removeSource,args:[t]}),i[t]=!0}function re(t,e,i,n){oe(t,i,n),ne(t,e,i)}function ae(e,i,n){var o;for(o in e[n])if(e[n].hasOwnProperty(o)&&"data"!==o&&!t.default$10(e[n][o],i[n][o]))return!1;for(o in i[n])if(i[n].hasOwnProperty(o)&&"data"!==o&&!t.default$10(e[n][o],i[n][o]))return!1;return!0}function se(e,i,n,o,r,a){var s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t.default$10(e[s],i[s])||n.push({command:a,args:[o,s,i[s],r]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.default$10(e[s],i[s])||n.push({command:a,args:[o,s,i[s],r]}))}function le(t){return t.id}function ce(t,e){return t[e.id]=e,t}var he=function(t,e,i){var n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var r=0;r<this.xCellCount*this.yCellCount;r++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};he.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},he.prototype.insert=function(t,e,i,n,o){this._forEachCell(e,i,n,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(o)},he.prototype.insertCircle=function(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)},he.prototype._insertBoxCell=function(t,e,i,n,o,r){this.boxCells[o].push(r)},he.prototype._insertCircleCell=function(t,e,i,n,o,r){this.circleCells[o].push(r)},he.prototype._query=function(t,e,i,n,o){if(i<0||t>this.width||n<0||e>this.height)return!o&&[];var r=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(o)return!0;for(var a=0;a<this.boxKeys.length;a++)r.push({key:this.boxKeys[a],x1:this.bboxes[4*a],y1:this.bboxes[4*a+1],x2:this.bboxes[4*a+2],y2:this.bboxes[4*a+3]});for(var s=0;s<this.circleKeys.length;s++){var l=this.circles[3*s],c=this.circles[3*s+1],u=this.circles[3*s+2];r.push({key:this.circleKeys[s],x1:l-u,y1:c-u,x2:l+u,y2:c+u})}}else{var h={hitTest:o,seenUids:{box:{},circle:{}}};this._forEachCell(t,e,i,n,this._queryCell,r,h)}return o?r.length>0:r},he.prototype._queryCircle=function(t,e,i,n){var o=t-i,r=t+i,a=e-i,s=e+i;if(r<0||o>this.width||s<0||a>this.height)return!n&&[];var l=[],c={hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(o,a,r,s,this._queryCellCircle,l,c),n?l.length>0:l},he.prototype.query=function(t,e,i,n){return this._query(t,e,i,n,!1)},he.prototype.hitTest=function(t,e,i,n){return this._query(t,e,i,n,!0)},he.prototype.hitTestCircle=function(t,e,i){return this._queryCircle(t,e,i,!0)},he.prototype._queryCell=function(t,e,i,n,o,r,a){var s=a.seenUids,l=this.boxCells[o];if(null!==l)for(var c=this.bboxes,u=0,h=l;u<h.length;u+=1){var p=h[u];if(!s.box[p]){s.box[p]=!0;var d=4*p;if(t<=c[d+2]&&e<=c[d+3]&&i>=c[d+0]&&n>=c[d+1]){if(a.hitTest)return r.push(!0),!0;r.push({key:this.boxKeys[p],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var f=this.circleCells[o];if(null!==f)for(var m=this.circles,_=0,g=f;_<g.length;_+=1){var v=g[_];if(!s.circle[v]){s.circle[v]=!0;var y=3*v;if(this._circleAndRectCollide(m[y],m[y+1],m[y+2],t,e,i,n)){if(a.hitTest)return r.push(!0),!0;var x=m[y],b=m[y+1],w=m[y+2];r.push({key:this.circleKeys[v],x1:x-w,y1:b-w,x2:x+w,y2:b+w})}}}},he.prototype._queryCellCircle=function(t,e,i,n,o,r,a){var s=a.circle,l=a.seenUids,c=this.boxCells[o];if(null!==c)for(var u=this.bboxes,h=0,p=c;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(this._circleAndRectCollide(s.x,s.y,s.radius,u[f+0],u[f+1],u[f+2],u[f+3]))return r.push(!0),!0}}var m=this.circleCells[o];if(null!==m)for(var _=this.circles,g=0,v=m;g<v.length;g+=1){var y=v[g];if(!l.circle[y]){l.circle[y]=!0;var x=3*y;if(this._circlesCollide(_[x],_[x+1],_[x+2],s.x,s.y,s.radius))return r.push(!0),!0}}},he.prototype._forEachCell=function(t,e,i,n,o,r,a){for(var s=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(i),u=this._convertToYCellCoord(n),h=s;h<=c;h++)for(var p=l;p<=u;p++){var d=this.xCellCount*p+h;if(o.call(this,t,e,i,n,d,r,a))return}},he.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},he.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},he.prototype._circlesCollide=function(t,e,i,n,o,r){var a=n-t,s=o-e,l=i+r;return l*l>a*a+s*s},he.prototype._circleAndRectCollide=function(t,e,i,n,o,r,a){var s=(r-n)/2,l=Math.abs(t-(n+s));if(l>s+i)return!1;var c=(a-o)/2,u=Math.abs(e-(o+c));if(u>c+i)return!1;if(l<=s||u<=c)return!0;var h=l-s,p=u-c;return h*h+p*p<=i*i};var pe=t.default$19.layout;function de(e,i,n,o,r){var a=t.mat4.identity(new Float32Array(16));return i?(t.mat4.identity(a),t.mat4.scale(a,a,[1/r,1/r,1]),n||t.mat4.rotateZ(a,a,o.angle)):(t.mat4.scale(a,a,[o.width/2,-o.height/2,1]),t.mat4.translate(a,a,[1,-1,0]),t.mat4.multiply(a,a,e)),a}function fe(e,i,n,o,r){var a=t.mat4.identity(new Float32Array(16));return i?(t.mat4.multiply(a,a,e),t.mat4.scale(a,a,[r,r,1]),n||t.mat4.rotateZ(a,a,-o.angle)):(t.mat4.scale(a,a,[1,-1,1]),t.mat4.translate(a,a,[-1,-1,0]),t.mat4.scale(a,a,[2/o.width,2/o.height,1])),a}function me(e,i){var n=[e.x,e.y,0,1];Ie(n,n,i);var o=n[3];return{point:new t.default$1(n[0]/o,n[1]/o),signedDistanceFromCamera:o}}function _e(t,e){var i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function ge(e,i,n,o,r,a,s,l){var c=o?e.textSizeData:e.iconSizeData,u=t.evaluateSizeForZoom(c,n.transform.zoom,pe.properties[o?"text-size":"icon-size"]),h=[256/n.width*2+1,256/n.height*2+1],p=o?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,f=o?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,_=!1,g=0;g<f.length;g++){var v=f.get(g);if(v.hidden||v.writingMode===t.WritingMode.vertical&&!_)Te(v.numGlyphs,p);else{_=!1;var y=[v.anchorX,v.anchorY,0,1];if(t.vec4.transformMat4(y,y,i),_e(y,h)){var x=.5+y[3]/n.transform.cameraToCenterDistance*.5,b=t.evaluateSizeForFeature(c,u,v),w=s?b*x:b/x,E=new t.default$1(v.anchorX,v.anchorY),T=me(E,r).point,I={},C=xe(v,w,!1,l,i,r,a,e.glyphOffsetArray,d,p,T,E,I,m);_=C.useVertical,(C.notEnoughRoom||_||C.needsFlipping&&xe(v,w,!0,l,i,r,a,e.glyphOffsetArray,d,p,T,E,I,m).notEnoughRoom)&&Te(v.numGlyphs,p)}else Te(v.numGlyphs,p)}}o?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function ve(t,e,i,n,o,r,a,s,l,c,u,h){var p=s.glyphStartIndex+s.numGlyphs,d=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),_=e.getoffsetX(p-1),g=we(t*m,i,n,o,r,a,s.segment,d,f,l,c,u,h);if(!g)return null;var v=we(t*_,i,n,o,r,a,s.segment,d,f,l,c,u,h);return v?{first:g,last:v}:null}function ye(e,i,n,o){return e===t.WritingMode.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*o?{useVertical:!0}:(e===t.WritingMode.vertical?i.y<n.y:i.x>n.x)?{needsFlipping:!0}:null}function xe(e,i,n,o,r,a,s,l,c,u,h,p,d,f){var m,_=i/24,g=e.lineOffsetX*i,v=e.lineOffsetY*i;if(e.numGlyphs>1){var y=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=ve(_,l,g,v,n,h,p,e,c,a,d,!1);if(!w)return{notEnoughRoom:!0};var E=me(w.first.point,s).point,T=me(w.last.point,s).point;if(o&&!n){var I=ye(e.writingMode,E,T,f);if(I)return I}m=[w.first];for(var C=e.glyphStartIndex+1;C<y-1;C++)m.push(we(_*l.getoffsetX(C),g,v,n,h,p,e.segment,x,b,c,a,d,!1));m.push(w.last)}else{if(o&&!n){var S=me(p,r).point,z=e.lineStartIndex+e.segment+1,A=new t.default$1(c.getx(z),c.gety(z)),R=me(A,r),D=R.signedDistanceFromCamera>0?R.point:be(p,A,S,1,r),M=ye(e.writingMode,S,D,f);if(M)return M}var L=we(_*l.getoffsetX(e.glyphStartIndex),g,v,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,a,d,!1);if(!L)return{notEnoughRoom:!0};m=[L]}for(var P=0,k=m;P<k.length;P+=1){var B=k[P];t.addDynamicAttributes(u,B.point,B.angle)}return{}}function be(t,e,i,n,o){var r=me(t.add(t.sub(e)._unit()),o).point,a=i.sub(r);return i.add(a._mult(n/a.mag()))}function we(e,i,n,o,r,a,s,l,c,u,h,p,d){var f=o?e-i:e+i,m=f>0?1:-1,_=0;o&&(m*=-1,_=Math.PI),m<0&&(_+=Math.PI);for(var g=m>0?l+s:l+s+1,v=g,y=r,x=r,b=0,w=0,E=Math.abs(f);b+w<=E;){if((g+=m)<l||g>=c)return null;if(x=y,void 0===(y=p[g])){var T=new t.default$1(u.getx(g),u.gety(g)),I=me(T,h);if(I.signedDistanceFromCamera>0)y=p[g]=I.point;else{var C=g-m;y=be(0===b?a:new t.default$1(u.getx(C),u.gety(C)),T,x,E-b+1,h)}}b+=w,w=x.dist(y)}var S=(E-b)/w,z=y.sub(x),A=z.mult(S)._add(x);return A._add(z._unit()._perp()._mult(n*m)),{point:A,angle:_+Math.atan2(y.y-x.y,y.x-x.x),tileDistance:d?{prevTileDistance:g-m===v?0:u.gettileUnitDistanceFromAnchor(g-m),lastSegmentViewportDistance:E-b}:null}}var Ee=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Te(t,e){for(var i=0;i<t;i++){var n=e.length;e.resize(n+4),e.float32.set(Ee,3*n)}}function Ie(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[4]*o+i[12],t[1]=i[1]*n+i[5]*o+i[13],t[3]=i[3]*n+i[7]*o+i[15],t}t.default$20.mat4;var Ce=function(t,e,i){void 0===e&&(e=new he(t.width+200,t.height+200,25)),void 0===i&&(i=new he(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100};function Se(t,e,i){t[e+4]=i?1:0}function ze(e,i,n){return i*(t.default$8/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}Ce.prototype.placeCollisionBox=function(t,e,i,n){var o=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),r=i*o.perspectiveRatio,a=t.x1*r+o.point.x,s=t.y1*r+o.point.y,l=t.x2*r+o.point.x,c=t.y2*r+o.point.y;return!e&&this.grid.hitTest(a,s,l,c)?{box:[],offscreen:!1}:{box:[a,s,l,c],offscreen:this.isOffscreen(a,s,l,c)}},Ce.prototype.approximateTileDistance=function(t,e,i,n,o){var r=o?1:n/this.pitchfactor,a=t.lastSegmentViewportDistance*i;return t.prevTileDistance+a+(r-1)*a*Math.abs(Math.sin(e))},Ce.prototype.placeCollisionCircles=function(e,i,n,o,r,a,s,l,c,u,h,p,d){var f=[],m=this.projectAnchor(u,a.anchorX,a.anchorY),_=c/24,g=a.lineOffsetX*c,v=a.lineOffsetY*c,y=new t.default$1(a.anchorX,a.anchorY),x=ve(_,l,g,v,!1,me(y,h).point,y,a,s,h,{},!0),b=!1,w=!0,E=m.perspectiveRatio*o,T=1/(o*n),I=0,C=0;x&&(I=this.approximateTileDistance(x.first.tileDistance,x.first.angle,T,m.cameraDistance,d),C=this.approximateTileDistance(x.last.tileDistance,x.last.angle,T,m.cameraDistance,d));for(var S=0;S<e.length;S+=5){var z=e[S],A=e[S+1],R=e[S+2],D=e[S+3];if(!x||D<-I||D>C)Se(e,S,!1);else{var M=this.projectPoint(u,z,A),L=R*E;if(f.length>0){var P=M.x-f[f.length-4],k=M.y-f[f.length-3];if(L*L*2>P*P+k*k&&S+8<e.length){var B=e[S+8];if(B>-I&&B<C){Se(e,S,!1);continue}}}var O=S/5;if(f.push(M.x,M.y,L,O),Se(e,S,!0),w=w&&this.isOffscreen(M.x-L,M.y-L,M.x+L,M.y+L),!i&&this.grid.hitTestCircle(M.x,M.y,L)){if(!p)return{circles:[],offscreen:!1};b=!0}}}return{circles:b?[]:f,offscreen:w}},Ce.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],n=1/0,o=1/0,r=-1/0,a=-1/0,s=0,l=e;s<l.length;s+=1){var c=l[s],u=new t.default$1(c.x+100,c.y+100);n=Math.min(n,u.x),o=Math.min(o,u.y),r=Math.max(r,u.x),a=Math.max(a,u.y),i.push(u)}for(var h={},p={},d=0,f=this.grid.query(n,o,r,a).concat(this.ignoredGrid.query(n,o,r,a));d<f.length;d+=1){var m=f[d],_=m.key;if(void 0===h[_.bucketInstanceId]&&(h[_.bucketInstanceId]={}),!h[_.bucketInstanceId][_.featureIndex]){var g=[new t.default$1(m.x1,m.y1),new t.default$1(m.x2,m.y1),new t.default$1(m.x2,m.y2),new t.default$1(m.x1,m.y2)];t.polygonIntersectsPolygon(i,g)&&(h[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}}return p},Ce.prototype.insertCollisionBox=function(t,e,i,n){var o={bucketInstanceId:i,featureIndex:n};(e?this.ignoredGrid:this.grid).insert(o,t[0],t[1],t[2],t[3])},Ce.prototype.insertCollisionCircles=function(t,e,i,n){for(var o=e?this.ignoredGrid:this.grid,r={bucketInstanceId:i,featureIndex:n},a=0;a<t.length;a+=4)o.insertCircle(r,t[a],t[a+1],t[a+2])},Ce.prototype.projectAnchor=function(t,e,i){var n=[e,i,0,1];return Ie(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},Ce.prototype.projectPoint=function(e,i,n){var o=[i,n,0,1];return Ie(o,o,e),new t.default$1((o[0]/o[3]+1)/2*this.transform.width+100,(-o[1]/o[3]+1)/2*this.transform.height+100)},Ce.prototype.projectAndGetPerspectiveRatio=function(e,i,n){var o=[i,n,0,1];return Ie(o,o,e),{point:new t.default$1((o[0]/o[3]+1)/2*this.transform.width+100,(-o[1]/o[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/o[3]*.5}},Ce.prototype.isOffscreen=function(t,e,i,n){return i<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary};var Ae=t.default$19.layout,Re=function(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i};Re.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var De=function(t,e,i,n,o){this.text=new Re(t?t.text:null,e,i,o),this.icon=new Re(t?t.icon:null,e,n,o)};De.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Me=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},Le=function(t,e){this.transform=t.clone(),this.collisionIndex=new Ce(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=e,this.retainedQueryData={}};function Pe(t,e,i){t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0)}Le.prototype.placeLayerTile=function(e,i,n,o){var r=i.getBucket(e),a=i.latestFeatureIndex;if(r&&a&&e.id===r.layerIds[0]){var s=i.collisionBoxArray,l=r.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/t.default$8,h=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),p=de(h,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,ze(i,1,this.transform.zoom)),d=de(h,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.transform,ze(i,1,this.transform.zoom));this.retainedQueryData[r.bucketInstanceId]=new function(t,e,i,n,o){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=o}(r.bucketInstanceId,a,r.sourceLayerIndex,r.index,i.tileID),this.placeLayerBucket(r,h,p,d,c,u,n,o,s)}},Le.prototype.placeLayerBucket=function(e,i,n,o,r,a,s,l,c){for(var u=e.layers[0].layout,h=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,Ae.properties["text-size"]),p=!e.hasTextData()||u.get("text-optional"),d=!e.hasIconData()||u.get("icon-optional"),f=0,m=e.symbolInstances;f<m.length;f+=1){var _=m[f];if(!l[_.crossTileID]){var g=void 0!==_.feature.text,v=void 0!==_.feature.icon,y=!0,x=null,b=null,w=null,E=0,T=0;_.collisionArrays||(_.collisionArrays=e.deserializeCollisionBoxes(c,_.textBoxStartIndex,_.textBoxEndIndex,_.iconBoxStartIndex,_.iconBoxEndIndex)),_.collisionArrays.textFeatureIndex&&(E=_.collisionArrays.textFeatureIndex),_.collisionArrays.textBox&&(g=(x=this.collisionIndex.placeCollisionBox(_.collisionArrays.textBox,u.get("text-allow-overlap"),a,i)).box.length>0,y=y&&x.offscreen);var I=_.collisionArrays.textCircles;if(I){var C=e.text.placedSymbolArray.get(_.placedTextSymbolIndices[0]),S=t.evaluateSizeForFeature(e.textSizeData,h,C);b=this.collisionIndex.placeCollisionCircles(I,u.get("text-allow-overlap"),r,a,_.key,C,e.lineVertexArray,e.glyphOffsetArray,S,i,n,s,"map"===u.get("text-pitch-alignment")),g=u.get("text-allow-overlap")||b.circles.length>0,y=y&&b.offscreen}_.collisionArrays.iconFeatureIndex&&(T=_.collisionArrays.iconFeatureIndex),_.collisionArrays.iconBox&&(v=(w=this.collisionIndex.placeCollisionBox(_.collisionArrays.iconBox,u.get("icon-allow-overlap"),a,i)).box.length>0,y=y&&w.offscreen),p||d?d?p||(v=v&&g):g=v&&g:v=g=v&&g,g&&x&&this.collisionIndex.insertCollisionBox(x.box,u.get("text-ignore-placement"),e.bucketInstanceId,E),v&&w&&this.collisionIndex.insertCollisionBox(w.box,u.get("icon-ignore-placement"),e.bucketInstanceId,T),g&&b&&this.collisionIndex.insertCollisionCircles(b.circles,u.get("text-ignore-placement"),e.bucketInstanceId,E),this.placements[_.crossTileID]=new Me(g,v,y||e.justReloaded),l[_.crossTileID]=!0}}e.justReloaded=!1},Le.prototype.commit=function(t,e){this.commitTime=e;var i=!1,n=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,o=t?t.opacities:{};for(var r in this.placements){var a=this.placements[r],s=o[r];s?(this.opacities[r]=new De(s,n,a.text,a.icon),i=i||a.text!==s.text.placed||a.icon!==s.icon.placed):(this.opacities[r]=new De(null,n,a.text,a.icon,a.skipFade),i=i||a.text||a.icon)}for(var l in o){var c=o[l];if(!this.opacities[l]){var u=new De(c,n,!1,!1);u.isHidden()||(this.opacities[l]=u,i=i||c.text.placed||c.icon.placed)}}i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},Le.prototype.updateLayerOpacities=function(t,e){for(var i={},n=0,o=e;n<o.length;n+=1){var r=o[n],a=r.getBucket(t);a&&r.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,i,r.collisionBoxArray)}},Le.prototype.updateBucketOpacities=function(t,e,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var n=t.layers[0].layout,o=new De(null,0,!1,!1,!0),r=new De(null,0,n.get("text-allow-overlap"),n.get("icon-allow-overlap"),!0),a=0;a<t.symbolInstances.length;a++){var s=t.symbolInstances[a],l=e[s.crossTileID],c=this.opacities[s.crossTileID];l?c=o:c||(c=r,this.opacities[s.crossTileID]=c),e[s.crossTileID]=!0;var u=s.numGlyphVertices>0||s.numVerticalGlyphVertices>0,h=s.numIconVertices>0;if(u){for(var p=Ve(c.text),d=(s.numGlyphVertices+s.numVerticalGlyphVertices)/4,f=0;f<d;f++)t.text.opacityVertexArray.emplaceBack(p);for(var m=0,_=s.placedTextSymbolIndices;m<_.length;m+=1){var g=_[m];t.text.placedSymbolArray.get(g).hidden=c.text.isHidden()}}if(h){for(var v=Ve(c.icon),y=0;y<s.numIconVertices/4;y++)t.icon.opacityVertexArray.emplaceBack(v);t.icon.placedSymbolArray.get(a).hidden=c.icon.isHidden()}s.collisionArrays||(s.collisionArrays=t.deserializeCollisionBoxes(i,s.textBoxStartIndex,s.textBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex));var x=s.collisionArrays;if(x){x.textBox&&t.hasCollisionBoxData()&&Pe(t.collisionBox.collisionVertexArray,c.text.placed,!1),x.iconBox&&t.hasCollisionBoxData()&&Pe(t.collisionBox.collisionVertexArray,c.icon.placed,!1);var b=x.textCircles;if(b&&t.hasCollisionCircleData())for(var w=0;w<b.length;w+=5){var E=l||0===b[w+4];Pe(t.collisionCircle.collisionVertexArray,c.text.placed,E)}}}t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray)},Le.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},Le.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},Le.prototype.stillRecent=function(t){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>t},Le.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),Be=Math.pow(2,24),Oe=Math.pow(2,17),Fe=Math.pow(2,16),Ne=Math.pow(2,9),Ue=Math.pow(2,8),Ze=Math.pow(2,1);function Ve(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*ke+e*Be+i*Oe+e*Fe+i*Ne+e*Ue+i*Ze+e}var je=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};je.prototype.continuePlacement=function(t,e,i,n,o){for(;this._currentTileIndex<t.length;){var r=t[this._currentTileIndex];if(e.placeLayerTile(n,r,i,this._seenCrossTileIDs),this._currentTileIndex++,o())return!0}};var $e=function(t,e,i,n,o){this.placement=new Le(t,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1};$e.prototype.isDone=function(){return this._done},$e.prototype.continuePlacement=function(t,e,i){for(var n=this,o=r.now(),a=function(){var t=r.now()-o;return!n._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=e[t[n._currentPlacementIndex]],l=n.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(n._inProgressLayer||(n._inProgressLayer=new je),n._inProgressLayer.continuePlacement(i[s.source],n.placement,n._showCollisionBoxes,s,a))return;delete n._inProgressLayer}n._currentPlacementIndex--}this._done=!0},$e.prototype.commit=function(t,e){return this.placement.commit(t,e),this.placement};var Ge=512/t.default$8/2,We=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var n=0,o=e;n<o.length;n+=1){var r=o[n],a=r.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}};We.prototype.getScaledCoordinates=function(e,i){var n=i.canonical.z-this.tileID.canonical.z,o=Ge/Math.pow(2,n),r=e.anchor;return{x:Math.floor((i.canonical.x*t.default$8+r.x)*o),y:Math.floor((i.canonical.y*t.default$8+r.y)*o)}},We.prototype.findMatches=function(t,e,i){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),o=0,r=t;o<r.length;o+=1){var a=r[o];if(!a.crossTileID){var s=this.indexedSymbolInstances[a.key];if(s)for(var l=this.getScaledCoordinates(a,e),c=0,u=s;c<u.length;c+=1){var h=u[c];if(Math.abs(h.coord.x-l.x)<=n&&Math.abs(h.coord.y-l.y)<=n&&!i[h.crossTileID]){i[h.crossTileID]=!0,a.crossTileID=h.crossTileID;break}}}}};var qe=function(){this.maxCrossTileID=0};qe.prototype.generate=function(){return++this.maxCrossTileID};var Xe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Xe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var i in this.indexes){var n=this.indexes[i],o={};for(var r in n){var a=n[r];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),o[a.tileID.key]=a}this.indexes[i]=o}this.lng=t},Xe.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0,o=e.symbolInstances;n<o.length;n+=1)o[n].crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var s=this.indexes[a];if(Number(a)>t.overscaledZ)for(var l in s){var c=s[l];c.tileID.isChildOf(t)&&c.findMatches(e.symbolInstances,t,r)}else{var u=s[t.scaledTo(Number(a)).key];u&&u.findMatches(e.symbolInstances,t,r)}}for(var h=0,p=e.symbolInstances;h<p.length;h+=1){var d=p[h];d.crossTileID||(d.crossTileID=i.generate(),r[d.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new We(t,e.symbolInstances,e.bucketInstanceId),!0},Xe.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var n=0,o=e.indexedSymbolInstances[i];n<o.length;n+=1){var r=o[n];delete this.usedCrossTileIDs[t][r.crossTileID]}},Xe.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var n=this.indexes[i];for(var o in n)t[n[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[o]),delete n[o],e=!0)}return e};var He=function(){this.layerIndexes={},this.crossTileIDs=new qe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};He.prototype.addLayer=function(t,e,i){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new Xe);var o=!1,r={};n.handleWrapJump(i);for(var a=0,s=e;a<s.length;a+=1){var l=s[a],c=l.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(l.tileID,c,this.crossTileIDs)&&(o=!0),r[c.bucketInstanceId]=!0)}return n.removeStaleBuckets(r)&&(o=!0),o},He.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[i]||delete this.layerIndexes[i]};var Ke=function(e,i){return t.emitValidationErrors(e,i&&i.filter(function(t){return"source.canvas"!==t.identifier}))},Ye=t.pick(ie,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Je=t.pick(ie,["setCenter","setZoom","setBearing","setPitch"]),Qe=function(e){function i(n,o){var r=this;void 0===o&&(o={}),e.call(this),this.map=n,this.dispatcher=new $((Jt||(Jt=new Qt),Jt),this),this.imageManager=new L,this.glyphManager=new N(n._transformRequest,o.localIdeographFontFamily),this.lineAtlas=new j(256,512),this.crossTileSymbolIndex=new He,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.default$23,this._loaded=!1,this._resetUpdates();var a=this;this._rtlTextPluginCallback=i.registerForPluginAvailability(function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),a.sourceCaches)a.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=r.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var n in r._layers){var o=r._layers[n];o.source===i.id&&r._validateLayer(o)}}}})}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.loadURL=function(e,i){var n=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var o="boolean"==typeof i.validate?i.validate:!y(e);e=function(t,e){if(!y(t))return t;var i=C(t);return i.path="/styles/v1"+i.path,v(i,e)}(e,i.accessToken);var r=this.map._transformRequest(e,t.ResourceType.Style);t.getJSON(r,function(e,i){e?n.fire(new t.ErrorEvent(e)):i&&n._load(i,o)})},i.prototype.loadJSON=function(e,i){var n=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"})),r.frame(function(){n._load(e,!1!==i.validate)})},i.prototype._load=function(e,i){var n=this;if(!i||!Ke(this,t.validateStyle(e))){for(var o in this._loaded=!0,this.stylesheet=e,e.sources)n.addSource(o,e.sources[o],{validate:!1});e.sprite?function(e,i,n){var o,a,s,l=r.devicePixelRatio>1?"@2x":"";function c(){if(s)n(s);else if(o&&a){var e=r.getImageData(a),i={};for(var l in o){var c=o[l],u=c.width,h=c.height,p=c.x,d=c.y,f=c.sdf,m=c.pixelRatio,_=new t.RGBAImage({width:u,height:h});t.RGBAImage.copy(e,_,{x:p,y:d},{x:0,y:0},{width:u,height:h}),i[l]={data:_,pixelRatio:m,sdf:f}}n(null,i)}}t.getJSON(i(w(e,l,".json"),t.ResourceType.SpriteJSON),function(t,e){s||(s=t,o=e,c())}),t.getImage(i(w(e,l,".png"),t.ResourceType.SpriteImage),function(t,e){s||(s=t,a=e,c())})}(e.sprite,this.map._transformRequest,function(e,i){if(e)n.fire(new t.ErrorEvent(e));else if(i)for(var o in i)n.imageManager.addImage(o,i[o]);n.imageManager.setLoaded(!0),n.fire(new t.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var a=ee(this.stylesheet.layers);this._order=a.map(function(t){return t.id}),this._layers={};for(var s=0,l=a;s<l.length;s+=1){var c=l[s];(c=t.default$22(c)).setEventedParent(n,{layer:{id:c.id}}),n._layers[c.id]=c}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new V(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},i.prototype._validateLayer=function(e){var i=this.sourceCaches[e.source];if(i){var n=e.sourceLayer;if(n){var o=i.getSource();("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+o.id+'" as specified by style layer "'+e.id+'"')))}}},i.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(e){if(this._loaded){if(this._changed){var i=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var o in(i.length||n.length)&&this._updateWorkerLayers(i,n),this._updatedSources){var r=this._updatedSources[o];"reload"===r?this._reloadSource(o):"clear"===r&&this._clearSource(o)}for(var a in this._updatedPaintProps)this._layers[a].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates(),this.fire(new t.Event("data",{dataType:"style"}))}for(var s in this.sourceCaches)this.sourceCaches[s].used=!1;for(var l=0,c=this._order;l<c.length;l+=1){var u=c[l],h=this._layers[u];h.recalculate(e),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}this.light.recalculate(e),this.z=e.zoom}},i.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},i.prototype.setState=function(e){var i=this;if(this._checkLoaded(),Ke(this,t.validateStyle(e)))return!1;(e=t.clone(e)).layers=ee(e.layers);var n=function ue(e,i){if(!e)return[{command:ie.setStyle,args:[i]}];var n=[];try{if(!t.default$10(e.version,i.version))return[{command:ie.setStyle,args:[i]}];t.default$10(e.center,i.center)||n.push({command:ie.setCenter,args:[i.center]}),t.default$10(e.zoom,i.zoom)||n.push({command:ie.setZoom,args:[i.zoom]}),t.default$10(e.bearing,i.bearing)||n.push({command:ie.setBearing,args:[i.bearing]}),t.default$10(e.pitch,i.pitch)||n.push({command:ie.setPitch,args:[i.pitch]}),t.default$10(e.sprite,i.sprite)||n.push({command:ie.setSprite,args:[i.sprite]}),t.default$10(e.glyphs,i.glyphs)||n.push({command:ie.setGlyphs,args:[i.glyphs]}),t.default$10(e.transition,i.transition)||n.push({command:ie.setTransition,args:[i.transition]}),t.default$10(e.light,i.light)||n.push({command:ie.setLight,args:[i.light]});var o={},r=[];!function(e,i,n,o){var r;for(r in i=i||{},e=e||{})e.hasOwnProperty(r)&&(i.hasOwnProperty(r)||oe(r,n,o));for(r in i)i.hasOwnProperty(r)&&(e.hasOwnProperty(r)?t.default$10(e[r],i[r])||("geojson"===e[r].type&&"geojson"===i[r].type&&ae(e,i,r)?n.push({command:ie.setGeoJSONSourceData,args:[r,i[r].data]}):re(r,i,n,o)):ne(r,i,n))}(e.sources,i.sources,r,o);var a=[];e.layers&&e.layers.forEach(function(t){o[t.source]?n.push({command:ie.removeLayer,args:[t.id]}):a.push(t)}),n=n.concat(r),function(e,i,n){i=i||[];var o,r,a,s,l,c,u,h=(e=e||[]).map(le),p=i.map(le),d=e.reduce(ce,{}),f=i.reduce(ce,{}),m=h.slice(),_=Object.create(null);for(o=0,r=0;o<h.length;o++)a=h[o],f.hasOwnProperty(a)?r++:(n.push({command:ie.removeLayer,args:[a]}),m.splice(m.indexOf(a,r),1));for(o=0,r=0;o<p.length;o++)a=p[p.length-1-o],m[m.length-1-o]!==a&&(d.hasOwnProperty(a)?(n.push({command:ie.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-r),1)):r++,c=m[m.length-o],n.push({command:ie.addLayer,args:[f[a],c]}),m.splice(m.length-o,0,a),_[a]=!0);for(o=0;o<p.length;o++)if(s=d[a=p[o]],l=f[a],!_[a]&&!t.default$10(s,l))if(t.default$10(s.source,l.source)&&t.default$10(s["source-layer"],l["source-layer"])&&t.default$10(s.type,l.type)){for(u in se(s.layout,l.layout,n,a,null,ie.setLayoutProperty),se(s.paint,l.paint,n,a,null,ie.setPaintProperty),t.default$10(s.filter,l.filter)||n.push({command:ie.setFilter,args:[a,l.filter]}),t.default$10(s.minzoom,l.minzoom)&&t.default$10(s.maxzoom,l.maxzoom)||n.push({command:ie.setLayerZoomRange,args:[a,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?se(s[u],l[u],n,a,u.slice(6),ie.setPaintProperty):t.default$10(s[u],l[u])||n.push({command:ie.setLayerProperty,args:[a,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?se(s[u],l[u],n,a,u.slice(6),ie.setPaintProperty):t.default$10(s[u],l[u])||n.push({command:ie.setLayerProperty,args:[a,u,l[u]]}))}else n.push({command:ie.removeLayer,args:[a]}),c=m[m.lastIndexOf(a)+1],n.push({command:ie.addLayer,args:[l,c]})}(a,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:ie.setStyle,args:[i]}]}return n}(this.serialize(),e).filter(function(t){return!(t.command in Je)});if(0===n.length)return!1;var o=n.filter(function(t){return!(t.command in Ye)});if(o.length>0)throw new Error("Unimplemented: "+o.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&i[t.command].apply(i,t.args)}),this.stylesheet=e,!0},i.prototype.addImage=function(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this.fire(new t.Event("data",{dataType:"style"}))},i.prototype.getImage=function(t){return this.imageManager.getImage(t)},i.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},i.prototype.addSource=function(e,i,n){var o=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(i).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,i,null,n))){this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var r=this.sourceCaches[e]=new Xt(e,i,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:o.loaded(),source:r.serialize(),sourceId:e}}),r.onAdd(this.map),this._changed=!0}},i.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+i+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},i.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},i.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},i.prototype.addLayer=function(e,i,n){this._checkLoaded();var o=e.id;if(this.getLayer(o))this.fire(new t.ErrorEvent(new Error('Layer with id "'+o+'" already exists on this map')));else if("object"==typeof e.source&&(this.addSource(o,e.source),e=t.clone(e),e=t.extend(e,{source:o})),!this._validate(t.validateStyle.layer,"layers."+o,e,{arrayIndex:-1},n)){var r=t.default$22(e);this._validateLayer(r),r.setEventedParent(this,{layer:{id:o}});var a=i?this._order.indexOf(i):this._order.length;if(i&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(a,0,o),this._layerOrderChanged=!0,this._layers[o]=r,this._removedLayers[o]&&r.source){var s=this._removedLayers[o];delete this._removedLayers[o],s.type!==r.type?this._updatedSources[r.source]="clear":(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause())}this._updateLayer(r)}}},i.prototype.moveLayer=function(e,i){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==i){var n=this._order.indexOf(e);this._order.splice(n,1);var o=i?this._order.indexOf(i):this._order.length;i&&-1===o?this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},i.prototype.removeLayer=function(e){this._checkLoaded();var i=this._layers[e];if(i){i.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e]}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},i.prototype.getLayer=function(t){return this._layers[t]},i.prototype.setLayerZoomRange=function(e,i,n){this._checkLoaded();var o=this.getLayer(e);o?o.minzoom===i&&o.maxzoom===n||(null!=i&&(o.minzoom=i),null!=n&&(o.maxzoom=n),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},i.prototype.setFilter=function(e,i){this._checkLoaded();var n=this.getLayer(e);if(n){if(!t.default$10(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.validateStyle.filter,"layers."+n.id+".filter",i)||(n.filter=t.clone(i),this._updateLayer(n)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},i.prototype.getFilter=function(e){return t.clone(this.getLayer(e).filter)},i.prototype.setLayoutProperty=function(e,i,n){this._checkLoaded();var o=this.getLayer(e);o?t.default$10(o.getLayoutProperty(i),n)||(o.setLayoutProperty(i,n),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},i.prototype.setPaintProperty=function(e,i,n){this._checkLoaded();var o=this.getLayer(e);if(o){if(!t.default$10(o.getPaintProperty(i),n)){var r=o._transitionablePaint._values[i].value.isDataDriven();o.setPaintProperty(i,n),(o._transitionablePaint._values[i].value.isDataDriven()||r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},i.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){var e=this;return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(t){return void 0!==t})},i.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},i.prototype._flattenRenderedFeatures=function(t){for(var e=[],i=this._order.length-1;i>=0;i--)for(var n=this._order[i],o=0,r=t;o<r.length;o+=1){var a=r[o][n];if(a)for(var s=0,l=a;s<l.length;s+=1){var c=l[s];e.push(c)}}return e},i.prototype.queryRenderedFeatures=function(e,i,n){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);var o={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var r=0,a=i.layers;r<a.length;r+=1){var s=a[r],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];o[l.source]=!0}}var c=[];for(var u in this.sourceCaches)i.layers&&!o[u]||c.push(at(this.sourceCaches[u],this._layers,e.worldCoordinate,i,n));return this.placement&&c.push(function(t,e,i,n,o){for(var r={},a=n.queryRenderedSymbols(e),s=[],l=0,c=Object.keys(a).map(Number);l<c.length;l+=1){var u=c[l];s.push(o[u])}s.sort(st);for(var h=function(){var e=d[p],n=e.featureIndex.lookupSymbolFeatures(a[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,i.filter,i.layers,t);for(var o in n){var s=r[o]=r[o]||[],l=n[o];l.sort(function(t,i){var n=e.featureSortOrder;if(n){var o=n.indexOf(t.featureIndex);return n.indexOf(i.featureIndex)-o}return i.featureIndex-t.featureIndex});for(var c=0,u=l;c<u.length;c+=1){var h=u[c];s.push(h.feature)}}},p=0,d=s;p<d.length;p+=1)h();return r}(this._layers,e.viewport,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenRenderedFeatures(c)},i.prototype.querySourceFeatures=function(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter);var n=this.sourceCaches[e];return n?function(t,e){for(var i=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],o={},r=0;r<i.length;r++){var a=i[r],s=a.tileID.canonical.key;o[s]||(o[s]=!0,a.querySourceFeatures(n,e))}return n}(n,i):[]},i.prototype.addSourceType=function(t,e,n){return i.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(i.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(e){this._checkLoaded();var i=this.light.getLight(),n=!1;for(var o in e)if(!t.default$10(e[o],i[o])){n=!0;break}if(n){var a={now:r.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e),this.light.updateTransitions(a)}},i.prototype._validate=function(e,i,n,o,r){return(!r||!1!==r.validate)&&Ke(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:n,styleSpec:t.default$5},o)))},i.prototype._remove=function(){for(var e in t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},i.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},i.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},i.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},i.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},i.prototype._updatePlacement=function(t,e,i){for(var n=!1,o=!1,a={},s=0,l=this._order;s<l.length;s+=1){var c=l[s],u=this._layers[c];if("symbol"===u.type){if(!a[u.source]){var h=this.sourceCaches[u.source];a[u.source]=h.getRenderableIds().map(function(t){return h.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(u,a[u.source],t.center.lng);n=n||p}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var d=this._layerOrderChanged;if((d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.now()))&&(this.pauseablePlacement=new $e(t,this._order,d,e,i),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,a),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,r.now()),o=!0),n&&this.pauseablePlacement.placement.setStale()),o||n)for(var f=0,m=this._order;f<m.length;f+=1){var _=m[f],g=this._layers[_];"symbol"===g.type&&this.placement.updateLayerOpacities(g,a[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.now())},i.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i)},i.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)},i}(t.Evented);Qe.getSourceType=function(t){return ot[t]},Qe.setSourceType=function(t,e){ot[t]=e},Qe.registerForPluginAvailability=t.registerForPluginAvailability;var ti=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),ei={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n// Unpack a pair of values that have been packed into a single float.\n// The packed values are assumed to be 8-bit unsigned integers, and are\n// packed like so:\n// packedValue = floor(input[0]) * 256 + input[1],\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue = int(packedValue);\n    int v0 = packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity = int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\n\n// To minimize the number of attributes needed, we encode a 4-component\n// color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},background:{fragmentSource:"uniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main() {\n    gl_FragColor = u_color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},backgroundPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\nuniform float u_opacity;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},circle:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main(void) {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center = floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position = circle_center;\n        if (u_scale_with_map) {\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\n    } else {\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\n}\n"},clippingMask:{fragmentSource:"void main() {\n    gl_FragColor = vec4(1.0);\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},heatmap:{fragmentSource:"#pragma mapbox: define highp float weight\n\nuniform highp float u_intensity;\nvarying vec2 v_extrude;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main() {\n    #pragma mapbox: initialize highp float weight\n\n    // Kernel density estimation with a Gaussian kernel of size 5x5\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = weight * u_intensity * GAUSS_COEF * exp(d);\n\n    gl_FragColor = vec4(val, 1.0, 1.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\n\nuniform mat4 u_matrix;\nuniform float u_extrude_scale;\nuniform float u_opacity;\nuniform float u_intensity;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_extrude;\n\n// Effective \"0\" in the kernel density texture to adjust the kernel size to;\n// this empirically chosen number minimizes artifacts on overlapping kernels\n// for typical heatmap cases (assuming clustered source)\nconst highp float ZERO = 1.0 / 255.0 / 16.0;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main(void) {\n    #pragma mapbox: initialize highp float weight\n    #pragma mapbox: initialize mediump float radius\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 unscaled_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // This 'extrude' comes in ranging from [-1, -1], to [1, 1].  We'll use\n    // it to produce the vertices of a square mesh framing the point feature\n    // we're adding to the kernel density texture.  We'll also pass it as\n    // a varying, so that the fragment shader can determine the distance of\n    // each fragment from the point feature.\n    // Before we do so, we need to scale it up sufficiently so that the\n    // kernel falls effectively to zero at the edge of the mesh.\n    // That is, we want to know S such that\n    // weight * u_intensity * GAUSS_COEF * exp(-0.5 * 3.0^2 * S^2) == ZERO\n    // Which solves to:\n    // S = sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\n    float S = sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\n\n    // Pass the varying in units of radius\n    v_extrude = S * unscaled_extrude;\n\n    // Scale by radius and the zoom-based scale factor to produce actual\n    // mesh position\n    vec2 extrude = v_extrude * radius * u_extrude_scale;\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec4 pos = vec4(floor(a_pos * 0.5) + extrude, 0, 1);\n\n    gl_Position = u_matrix * pos;\n}\n"},heatmapTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform sampler2D u_color_ramp;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    float t = texture2D(u_image, v_pos).r;\n    vec4 color = texture2D(u_color_ramp, vec2(t, 0.5));\n    gl_FragColor = color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},collisionBox:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        gl_FragColor *= .1;\n    }\n}",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = clamp(\n        0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance),\n        0.0, // Prevents oversized near-field boxes in pitched/overzoomed tiles\n        4.0);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position.xy += a_extrude * u_extrude_scale * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n}\n"},collisionCircle:{fragmentSource:"uniform float u_overscale_factor;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    vec4 color = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        color = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        color *= .2;\n    }\n\n    float extrude_scale_length = length(v_extrude_scale);\n    float extrude_length = length(v_extrude) * extrude_scale_length;\n    float stroke_width = 15.0 * extrude_scale_length / u_overscale_factor;\n    float radius = v_radius * extrude_scale_length;\n\n    float distance_to_edge = abs(extrude_length - radius);\n    float opacity_t = smoothstep(-stroke_width, 0.0, -distance_to_edge);\n\n    gl_FragColor = opacity_t * color;\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\n\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = clamp(\n        0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance),\n        0.0, // Prevents oversized near-field circles in pitched/overzoomed tiles\n        4.0);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n\n    highp float padding_factor = 1.2; // Pad the vertices slightly to make room for anti-alias blur\n    gl_Position.xy += a_extrude * u_extrude_scale * padding_factor * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n    v_radius = abs(a_extrude.y); // We don't pitch the circles, so both units of the extrusion vector are equal in magnitude to the radius\n\n    v_extrude = a_extrude * padding_factor;\n    v_extrude_scale = u_extrude_scale * u_camera_to_center_distance * collision_perspective_ratio;\n}\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    vec3 normal = a_normal_ed.xyz;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec3 normal = a_normal_ed.xyz;\n    float edgedistance = a_normal_ed.w;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = normal.x == 1.0 && normal.y == 0.0 && normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},hillshadePrepare:{fragmentSource:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D u_image;\nvarying vec2 v_pos;\nuniform vec2 u_dimension;\nuniform float u_zoom;\nuniform float u_maxzoom;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_image, coord) * 255.0;\n    return (data.r + data.g * 256.0 + data.b * 256.0 * 256.0) / 4.0;\n}\n\nvoid main() {\n    vec2 epsilon = 1.0 / u_dimension;\n\n    // queried pixels:\n    // +-----------+\n    // |   |   |   |\n    // | a | b | c |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | d | e | f |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | g | h | i |\n    // |   |   |   |\n    // +-----------+\n\n    float a = getElevation(v_pos + vec2(-epsilon.x, -epsilon.y), 0.0);\n    float b = getElevation(v_pos + vec2(0, -epsilon.y), 0.0);\n    float c = getElevation(v_pos + vec2(epsilon.x, -epsilon.y), 0.0);\n    float d = getElevation(v_pos + vec2(-epsilon.x, 0), 0.0);\n    float e = getElevation(v_pos, 0.0);\n    float f = getElevation(v_pos + vec2(epsilon.x, 0), 0.0);\n    float g = getElevation(v_pos + vec2(-epsilon.x, epsilon.y), 0.0);\n    float h = getElevation(v_pos + vec2(0, epsilon.y), 0.0);\n    float i = getElevation(v_pos + vec2(epsilon.x, epsilon.y), 0.0);\n\n    // here we divide the x and y slopes by 8 * pixel size\n    // where pixel size (aka meters/pixel) is:\n    // circumference of the world / (pixels per tile * number of tiles)\n    // which is equivalent to: 8 * 40075016.6855785 / (512 * pow(2, u_zoom))\n    // which can be reduced to: pow(2, 19.25619978527 - u_zoom)\n    // we want to vertically exaggerate the hillshading though, because otherwise\n    // it is barely noticeable at low zooms. to do this, we multiply this by some\n    // scale factor pow(2, (u_zoom - u_maxzoom) * a) where a is an arbitrary value\n    // Here we use a=0.3 which works out to the expression below. see \n    // nickidlugash's awesome breakdown for more info\n    // https://github.com/mapbox/mapbox-gl-js/pull/5286#discussion_r148419556\n    float exaggeration = u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\n\n    vec2 deriv = vec2(\n        (c + f + f + i) - (a + d + d + g),\n        (g + h + h + i) - (a + b + b + c)\n    ) /  pow(2.0, (u_zoom - u_maxzoom) * exaggeration + 19.2562 - u_zoom);\n\n    gl_FragColor = clamp(vec4(\n        deriv.x / 2.0 + 0.5,\n        deriv.y / 2.0 + 0.5,\n        1.0,\n        1.0), 0.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (a_texture_pos / 8192.0) / 2.0 + 0.25;\n}\n"},hillshade:{fragmentSource:"uniform sampler2D u_image;\nvarying vec2 v_pos;\n\nuniform vec2 u_latrange;\nuniform vec2 u_light;\nuniform vec4 u_shadow;\nuniform vec4 u_highlight;\nuniform vec4 u_accent;\n\n#define PI 3.141592653589793\n\nvoid main() {\n    vec4 pixel = texture2D(u_image, v_pos);\n\n    vec2 deriv = ((pixel.rg * 2.0) - 1.0);\n\n    // We divide the slope by a scale factor based on the cosin of the pixel's approximate latitude\n    // to account for mercator projection distortion. see #4807 for details\n    float scaleFactor = cos(radians((u_latrange[0] - u_latrange[1]) * (1.0 - v_pos.y) + u_latrange[1]));\n    // We also multiply the slope by an arbitrary z-factor of 1.25\n    float slope = atan(1.25 * length(deriv) / scaleFactor);\n    float aspect = deriv.x != 0.0 ? atan(deriv.y, -deriv.x) : PI / 2.0 * (deriv.y > 0.0 ? 1.0 : -1.0);\n\n    float intensity = u_light.x;\n    // We add PI to make this property match the global light object, which adds PI/2 to the light's azimuthal\n    // position property to account for 0deg corresponding to north/the top of the viewport in the style spec\n    // and the original shader was written to accept (-illuminationDirection - 90) as the azimuthal.\n    float azimuth = u_light.y + PI;\n\n    // We scale the slope exponentially based on intensity, using a calculation similar to\n    // the exponential interpolation function in the style spec:\n    // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/expression/definitions/interpolate.js#L217-L228\n    // so that higher intensity values create more opaque hillshading.\n    float base = 1.875 - intensity * 1.75;\n    float maxValue = 0.5 * PI;\n    float scaledSlope = intensity != 0.5 ? ((pow(base, slope) - 1.0) / (pow(base, maxValue) - 1.0)) * maxValue : slope;\n\n    // The accent color is calculated with the cosine of the slope while the shade color is calculated with the sine\n    // so that the accent color's rate of change eases in while the shade color's eases out.\n    float accent = cos(scaledSlope);\n    // We multiply both the accent and shade color by a clamped intensity value\n    // so that intensities >= 0.5 do not additionally affect the color values\n    // while intensity values < 0.5 make the overall color more transparent.\n    vec4 accent_color = (1.0 - accent) * u_accent * clamp(intensity * 2.0, 0.0, 1.0);\n    float shade = abs(mod((aspect + azimuth) / PI + 0.5, 2.0) - 1.0);\n    vec4 shade_color = mix(u_shadow, u_highlight, shade) * sin(scaledSlope) * clamp(intensity * 2.0, 0.0, 1.0);\n    gl_FragColor = accent_color * (1.0 - shade_color.a) + shade_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = a_texture_pos / 8192.0;\n}\n"},line:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_linesofar;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    v_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},lineGradient:{fragmentSource:"\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nuniform sampler2D u_image;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying highp float v_lineprogress;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    // For gradient lines, v_lineprogress is the ratio along the entire line,\n    // scaled to [0, 2^15), and the gradient ramp is stored in a texture.\n    vec4 color = texture2D(u_image, vec2(v_lineprogress, 0.5));\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n// the attribute conveying progress along a line is scaled to [0, 2^15)\n#define MAX_LINE_DISTANCE 32767.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_lineprogress;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    v_lineprogress = (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0 / MAX_LINE_DISTANCE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n\n    // v_normal.y is 0 at the midpoint of the line, -1 at the lower edge, 1 at the upper edge\n    // we clamp the line width outset to be between 0 and half the pattern height plus padding (2.0)\n    // to ensure we don't sample outside the designated symbol on the sprite sheet.\n    // 0.5 is added to shift the component to be bounded between 0 and 1 for interpolation of\n    // the texture coordinate\n    float y_a = 0.5 + (v_normal.y * clamp(v_width2.s, 0.0, (u_pattern_size_a.y + 2.0) / 2.0) / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * clamp(v_width2.s, 0.0, (u_pattern_size_b.y + 2.0) / 2.0) / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    if (color0.a > 0.0) {\n        color0.rgb = color0.rgb / color0.a;\n    }\n    if (color1.a > 0.0) {\n        color1.rgb = color1.rgb / color1.a;\n    }\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\n\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    lowp float alpha = opacity * v_fade_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform float u_fade_change;\n\n#pragma mapbox: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = clamp(\n            0.5 + 0.5 * distance_ratio,\n            0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n            4.0);\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 tex = v_data0.xy;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n    float fade_opacity = v_data1[2];\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n    gl_FragColor = color * (alpha * opacity * fade_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform float u_fade_change;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = clamp(\n        0.5 + 0.5 * distance_ratio,\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n        4.0);\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n\n    v_data0 = vec2(tex.x, tex.y);\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\n}\n"}},ii=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,ni=function(t){var e=ei[t],i={};e.fragmentSource=e.fragmentSource.replace(ii,function(t,e,n,o,r){return i[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+n+" "+o+" "+r+";\n#else\nuniform "+n+" "+o+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+n+" "+o+" "+r+" = u_"+r+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(ii,function(t,e,n,o,r){var a="float"===o?"vec2":"vec4";return i[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+n+" "+a+" a_"+r+";\nvarying "+n+" "+o+" "+r+";\n#else\nuniform "+n+" "+o+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+a+"(a_"+r+", a_"+r+"_t);\n#else\n    "+n+" "+o+" "+r+" = u_"+r+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+n+" "+a+" a_"+r+";\n#else\nuniform "+n+" "+o+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+n+" "+o+" "+r+" = unpack_mix_"+a+"(a_"+r+", a_"+r+"_t);\n#else\n    "+n+" "+o+" "+r+" = u_"+r+";\n#endif\n"})};for(var oi in ei)ni(oi);var ri=ei,ai=function(t,e,i,n){var o=t.gl;this.program=o.createProgram();var a=i.defines().concat("#define DEVICE_PIXEL_RATIO "+r.devicePixelRatio.toFixed(1));n&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(ri.prelude.fragmentSource,e.fragmentSource).join("\n"),l=a.concat(ri.prelude.vertexSource,e.vertexSource).join("\n"),c=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(c,s),o.compileShader(c),o.attachShader(this.program,c);var u=o.createShader(o.VERTEX_SHADER);o.shaderSource(u,l),o.compileShader(u),o.attachShader(this.program,u);for(var h=i.layoutAttributes||[],p=0;p<h.length;p++)o.bindAttribLocation(this.program,p,h[p].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var d=0;d<this.numAttributes;d++){var f=o.getActiveAttrib(this.program,d);f&&(this.attributes[f.name]=o.getAttribLocation(this.program,f.name))}for(var m=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),_=0;_<m;_++){var g=o.getActiveUniform(this.program,_);g&&(this.uniforms[g.name]=o.getUniformLocation(this.program,g.name))}};function si(e,i,n,o,r){for(var a=0;a<n.length;a++){var s=n[a];if(o.isLessThan(s.tileID))break;if(i.key===s.tileID.key)return;if(s.tileID.isChildOf(i)){for(var l=i.children(1/0),c=0;c<l.length;c++)si(e,l[c],n.slice(a),o,r);return}}var u=i.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(u,i.canonical.x-(e.canonical.x<<u),i.canonical.y-(e.canonical.y<<u));r[h.key]=r[h.key]||h}function li(t,e,i,n,o){var r=t.context,a=r.gl,s=o?t.useProgram("collisionCircle"):t.useProgram("collisionBox");r.setDepthMode($t.disabled),r.setStencilMode(Gt.disabled),r.setColorMode(t.colorModeForRenderPass());for(var l=0;l<n.length;l++){var c=n[l],u=e.getTile(c),h=u.getBucket(i);if(h){var p=o?h.collisionCircle:h.collisionBox;if(p){a.uniformMatrix4fv(s.uniforms.u_matrix,!1,c.posMatrix),o||r.lineWidth.set(1),a.uniform1f(s.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var d=ze(u,1,t.transform.zoom),f=Math.pow(2,t.transform.zoom-u.tileID.overscaledZ);a.uniform1f(s.uniforms.u_pixels_to_tile_units,d),a.uniform2f(s.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(d*f),t.transform.pixelsToGLUnits[1]/(d*f)),a.uniform1f(s.uniforms.u_overscale_factor,u.tileID.overscaleFactor()),s.draw(r,o?a.TRIANGLES:a.LINES,i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,p.collisionVertexBuffer,null)}}}}ai.prototype.draw=function(t,e,i,n,o,r,a,s,l){for(var c,u=t.gl,h=(c={},c[u.LINES]=2,c[u.TRIANGLES]=3,c)[e],p=0,d=r.get();p<d.length;p+=1){var f=d[p],m=f.vaos||(f.vaos={});(m[i]||(m[i]=new tt)).bind(t,this,n,a?a.getPaintVertexBuffers():[],o,f.vertexOffset,s,l),u.drawElements(e,f.primitiveLength*h,u.UNSIGNED_SHORT,f.primitiveOffset*h*2)}};var ci=t.mat4.identity(new Float32Array(16)),ui=t.default$19.layout;function hi(t,e,i,n,o,r,a,s,l,c){var u,h=t.context,p=h.gl,d=t.transform,f="map"===s,m="map"===l,_=f&&"line"===i.layout.get("symbol-placement"),g=f&&!m&&!_,v=m;h.setDepthMode(v?t.depthModeForSublayer(0,$t.ReadOnly):$t.disabled);for(var y=0,x=n;y<x.length;y+=1){var b=x[y],w=e.getTile(b),E=w.getBucket(i);if(E){var T=o?E.text:E.icon;if(T&&T.segments.get().length){var I=T.programConfigurations.get(i.id),C=o||E.sdfIcons,S=o?E.textSizeData:E.iconSizeData;if(u||(u=t.useProgram(C?"symbolSDF":"symbolIcon",I),I.setUniforms(t.context,u,i.paint,{zoom:t.transform.zoom}),pi(u,t,i,o,g,m,S)),h.activeTexture.set(p.TEXTURE0),p.uniform1i(u.uniforms.u_texture,0),o)w.glyphAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.uniform2fv(u.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var z=1!==i.layout.get("icon-size").constantOr(0)||E.iconsNeedLinear,A=m||0!==d.pitch;w.iconAtlasTexture.bind(C||t.options.rotating||t.options.zooming||z||A?p.LINEAR:p.NEAREST,p.CLAMP_TO_EDGE),p.uniform2fv(u.uniforms.u_texsize,w.iconAtlasTexture.size)}p.uniformMatrix4fv(u.uniforms.u_matrix,!1,t.translatePosMatrix(b.posMatrix,w,r,a));var R=ze(w,1,t.transform.zoom),D=de(b.posMatrix,m,f,t.transform,R),M=fe(b.posMatrix,m,f,t.transform,R);p.uniformMatrix4fv(u.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(M,w,r,a,!0)),_?(p.uniformMatrix4fv(u.uniforms.u_label_plane_matrix,!1,ci),ge(E,b.posMatrix,t,o,D,M,m,c)):p.uniformMatrix4fv(u.uniforms.u_label_plane_matrix,!1,D),p.uniform1f(u.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),di(u,I,t,i,w,T,o,C,m)}}}}function pi(e,i,n,o,r,a,s){var l=i.context.gl,c=i.transform;l.uniform1i(e.uniforms.u_pitch_with_map,a?1:0),l.uniform1f(e.uniforms.u_is_text,o?1:0),l.uniform1f(e.uniforms.u_pitch,c.pitch/360*2*Math.PI);var u="constant"===s.functionType||"source"===s.functionType,h="constant"===s.functionType||"camera"===s.functionType;l.uniform1i(e.uniforms.u_is_size_zoom_constant,u?1:0),l.uniform1i(e.uniforms.u_is_size_feature_constant,h?1:0),l.uniform1f(e.uniforms.u_camera_to_center_distance,c.cameraToCenterDistance);var p=t.evaluateSizeForZoom(s,c.zoom,ui.properties[o?"text-size":"icon-size"]);void 0!==p.uSizeT&&l.uniform1f(e.uniforms.u_size_t,p.uSizeT),void 0!==p.uSize&&l.uniform1f(e.uniforms.u_size,p.uSize),l.uniform1f(e.uniforms.u_aspect_ratio,c.width/c.height),l.uniform1i(e.uniforms.u_rotate_symbol,r?1:0)}function di(t,e,i,n,o,r,a,s,l){var c=i.context,u=c.gl,h=i.transform;if(s){var p=0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),d=l?Math.cos(h._pitch)*h.cameraToCenterDistance:1;u.uniform1f(t.uniforms.u_gamma_scale,d),p&&(u.uniform1f(t.uniforms.u_is_halo,1),fi(r,n,c,t)),u.uniform1f(t.uniforms.u_is_halo,0)}fi(r,n,c,t)}function fi(t,e,i,n){n.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function mi(t,e,i,n,o,a,s,l,c){var u,h,p,d,f=e.context,m=f.gl,_=o.paint.get("line-dasharray"),g=o.paint.get("line-pattern");if(l||c){var v=1/ze(i,1,e.transform.tileZoom);if(_){u=e.lineAtlas.getDash(_.from,"round"===o.layout.get("line-cap")),h=e.lineAtlas.getDash(_.to,"round"===o.layout.get("line-cap"));var y=u.width*_.fromScale,x=h.width*_.toScale;m.uniform2f(t.uniforms.u_patternscale_a,v/y,-u.height/2),m.uniform2f(t.uniforms.u_patternscale_b,v/x,-h.height/2),m.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(y,x)*r.devicePixelRatio)/2)}else if(g){if(p=e.imageManager.getPattern(g.from),d=e.imageManager.getPattern(g.to),!p||!d)return;m.uniform2f(t.uniforms.u_pattern_size_a,p.displaySize[0]*g.fromScale/v,p.displaySize[1]),m.uniform2f(t.uniforms.u_pattern_size_b,d.displaySize[0]*g.toScale/v,d.displaySize[1]);var b=e.imageManager.getPixelSize(),w=b.width,E=b.height;m.uniform2fv(t.uniforms.u_texsize,[w,E])}m.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}l&&(_?(m.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(f),m.uniform1f(t.uniforms.u_tex_y_a,u.y),m.uniform1f(t.uniforms.u_tex_y_b,h.y),m.uniform1f(t.uniforms.u_mix,_.t)):g&&(m.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(m.TEXTURE0),e.imageManager.bind(f),m.uniform2fv(t.uniforms.u_pattern_tl_a,p.tl),m.uniform2fv(t.uniforms.u_pattern_br_a,p.br),m.uniform2fv(t.uniforms.u_pattern_tl_b,d.tl),m.uniform2fv(t.uniforms.u_pattern_br_b,d.br),m.uniform1f(t.uniforms.u_fade,g.t))),f.setStencilMode(e.stencilModeForClipping(a));var T=e.translatePosMatrix(a.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"));if(m.uniformMatrix4fv(t.uniforms.u_matrix,!1,T),m.uniform1f(t.uniforms.u_ratio,1/ze(i,1,e.transform.zoom)),o.paint.get("line-gradient")){f.activeTexture.set(m.TEXTURE0);var I=o.gradientTexture;if(!o.gradient)return;I||(I=o.gradientTexture=new M(f,o.gradient,m.RGBA)),I.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.uniform1i(t.uniforms.u_image,0)}t.draw(f,m.TRIANGLES,o.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,s)}var _i=function(t,e){if(!t)return!1;var i=e.imageManager.getPattern(t.from),n=e.imageManager.getPattern(t.to);return!i||!n},gi=function(t,e,i){var n=e.context,o=n.gl,r=e.imageManager.getPattern(t.from),a=e.imageManager.getPattern(t.to);o.uniform1i(i.uniforms.u_image,0),o.uniform2fv(i.uniforms.u_pattern_tl_a,r.tl),o.uniform2fv(i.uniforms.u_pattern_br_a,r.br),o.uniform2fv(i.uniforms.u_pattern_tl_b,a.tl),o.uniform2fv(i.uniforms.u_pattern_br_b,a.br);var s=e.imageManager.getPixelSize(),l=s.width,c=s.height;o.uniform2fv(i.uniforms.u_texsize,[l,c]),o.uniform1f(i.uniforms.u_mix,t.t),o.uniform2fv(i.uniforms.u_pattern_size_a,r.displaySize),o.uniform2fv(i.uniforms.u_pattern_size_b,a.displaySize),o.uniform1f(i.uniforms.u_scale_a,t.fromScale),o.uniform1f(i.uniforms.u_scale_b,t.toScale),n.activeTexture.set(o.TEXTURE0),e.imageManager.bind(e.context)},vi=function(t,e,i){var n=e.context.gl;n.uniform1f(i.uniforms.u_tile_units_to_pixels,1/ze(t,1,e.transform.tileZoom));var o=Math.pow(2,t.tileID.overscaledZ),r=t.tileSize*Math.pow(2,e.transform.tileZoom)/o,a=r*(t.tileID.canonical.x+t.tileID.wrap*o),s=r*t.tileID.canonical.y;n.uniform2f(i.uniforms.u_pixel_coord_upper,a>>16,s>>16),n.uniform2f(i.uniforms.u_pixel_coord_lower,65535&a,65535&s)};function yi(t,e,i,n,o){if(!_i(i.paint.get("fill-pattern"),t))for(var r=!0,a=0,s=n;a<s.length;a+=1){var l=s[a],c=e.getTile(l),u=c.getBucket(i);u&&(t.context.setStencilMode(t.stencilModeForClipping(l)),o(t,e,i,c,l,u,r),r=!1)}}function xi(t,e,i,n,o,r,a){var s=t.context.gl,l=r.programConfigurations.get(i.id);wi("fill",i.paint.get("fill-pattern"),t,l,i,n,o,a).draw(t.context,s.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,l)}function bi(t,e,i,n,o,r,a){var s=t.context.gl,l=r.programConfigurations.get(i.id),c=wi("fillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),t,l,i,n,o,a);s.uniform2f(c.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),c.draw(t.context,s.LINES,i.id,r.layoutVertexBuffer,r.indexBuffer2,r.segments2,l)}function wi(t,e,i,n,o,r,a,s){var l,c=i.context.program.get();return e?(l=i.useProgram(t+"Pattern",n),(s||l.program!==c)&&(n.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom}),gi(e,i,l)),vi(r,i,l)):(l=i.useProgram(t,n),(s||l.program!==c)&&n.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom})),i.context.gl.uniformMatrix4fv(l.uniforms.u_matrix,!1,i.translatePosMatrix(a.posMatrix,r,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"))),l}var Ei=t.default$20.mat3,Ti=t.default$20.mat4,Ii=t.default$20.vec3;function Ci(t,e,i,n,o,r,a){var s=t.context,l=s.gl,c=i.paint.get("fill-extrusion-pattern"),u=t.context.program.get(),h=r.programConfigurations.get(i.id),p=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",h);if((a||p.program!==u)&&h.setUniforms(s,p,i.paint,{zoom:t.transform.zoom}),c){if(_i(c,t))return;gi(c,t,p),vi(n,t,p),l.uniform1f(p.uniforms.u_height_factor,-Math.pow(2,o.overscaledZ)/n.tileSize/8)}t.context.gl.uniformMatrix4fv(p.uniforms.u_matrix,!1,t.translatePosMatrix(o.posMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor"))),function(t,e){var i=e.context.gl,n=e.style.light,o=n.properties.get("position"),r=[o.x,o.y,o.z],a=Ei.create();"viewport"===n.properties.get("anchor")&&Ei.fromRotation(a,-e.transform.angle),Ii.transformMat3(r,r,a);var s=n.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,r),i.uniform1f(t.uniforms.u_lightintensity,n.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b)}(p,t),p.draw(s,l.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,h)}function Si(e,i,n){var o=e.context,r=o.gl,a=i.fbo;if(a){var s=e.useProgram("hillshade"),l=e.transform.calculatePosMatrix(i.tileID.toUnwrapped(),!0);!function(t,e,i){var n=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(n-=e.transform.angle),e.context.gl.uniform2f(t.uniforms.u_light,i.paint.get("hillshade-exaggeration"),n)}(s,e,n);var c=function(e,i){var n=i.toCoordinate(),o=new t.default$17(n.column,n.row+1,n.zoom);return[e.transform.coordinateLocation(n).lat,e.transform.coordinateLocation(o).lat]}(e,i.tileID);o.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,l),r.uniform2fv(s.uniforms.u_latrange,c),r.uniform1i(s.uniforms.u_image,0);var u=n.paint.get("hillshade-shadow-color");r.uniform4f(s.uniforms.u_shadow,u.r,u.g,u.b,u.a);var h=n.paint.get("hillshade-highlight-color");r.uniform4f(s.uniforms.u_highlight,h.r,h.g,h.b,h.a);var p=n.paint.get("hillshade-accent-color");if(r.uniform4f(s.uniforms.u_accent,p.r,p.g,p.b,p.a),i.maskedBoundsBuffer&&i.maskedIndexBuffer&&i.segments)s.draw(o,r.TRIANGLES,n.id,i.maskedBoundsBuffer,i.maskedIndexBuffer,i.segments);else{var d=e.rasterBoundsBuffer;e.rasterBoundsVAO.bind(o,s,d,[]),r.drawArrays(r.TRIANGLE_STRIP,0,d.length)}}}function zi(e,i,n){var o=e.context,r=o.gl;if(i.dem&&i.dem.level){var a=i.dem.level.dim,s=i.dem.getPixels();if(o.activeTexture.set(r.TEXTURE1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(i.tileSize),i.demTexture){var l=i.demTexture;l.update(s,{premultiply:!1}),l.bind(r.NEAREST,r.CLAMP_TO_EDGE)}else i.demTexture=new M(o,s,r.RGBA,{premultiply:!1}),i.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);o.activeTexture.set(r.TEXTURE0);var c=i.fbo;if(!c){var u=new M(o,{width:a,height:a,data:null},r.RGBA);u.bind(r.LINEAR,r.CLAMP_TO_EDGE),(c=i.fbo=o.createFramebuffer(a,a)).colorAttachment.set(u.texture)}o.bindFramebuffer.set(c.framebuffer),o.viewport.set([0,0,a,a]);var h=t.mat4.create();t.mat4.ortho(h,0,t.default$8,-t.default$8,0,0,1),t.mat4.translate(h,h,[0,-t.default$8,0]);var p=e.useProgram("hillshadePrepare");r.uniformMatrix4fv(p.uniforms.u_matrix,!1,h),r.uniform1f(p.uniforms.u_zoom,i.tileID.overscaledZ),r.uniform2fv(p.uniforms.u_dimension,[2*a,2*a]),r.uniform1i(p.uniforms.u_image,1),r.uniform1f(p.uniforms.u_maxzoom,n);var d=e.rasterBoundsBuffer;e.rasterBoundsVAO.bind(o,p,d,[]),r.drawArrays(r.TRIANGLE_STRIP,0,d.length),i.needsHillshadePrepare=!1}}function Ai(e,i,n,o,a){var s=o.paint.get("raster-fade-duration");if(s>0){var l=r.now(),c=(l-e.timeAdded)/s,u=i?(l-i.timeAdded)/s:-1,h=n.getSource(),p=a.coveringZoomLevel({tileSize:h.tileSize,roundZoom:h.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-p)>Math.abs(e.tileID.overscaledZ-p),f=d&&e.refreshedUponExpiration?1:t.clamp(d?c:1-u,0,1);return e.refreshedUponExpiration&&c>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function Ri(e,i,n){var o=e.context,a=o.gl;o.lineWidth.set(1*r.devicePixelRatio);var s=n.posMatrix,l=e.useProgram("debug");o.setDepthMode($t.disabled),o.setStencilMode(Gt.disabled),o.setColorMode(e.colorModeForRenderPass()),a.uniformMatrix4fv(l.uniforms.u_matrix,!1,s),a.uniform4f(l.uniforms.u_color,1,0,0,1),e.debugVAO.bind(o,l,e.debugBuffer,[]),a.drawArrays(a.LINE_STRIP,0,e.debugBuffer.length);for(var c=function(t,e,i,n){n=n||1;var o,r,a,s,l,c,u,h,p=[];for(o=0,r=t.length;o<r;o++)if(l=Di[t[o]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)-1===l[1][a]&&-1===l[1][a+1]?h=null:(c=e+l[1][a]*n,u=200-l[1][a+1]*n,h&&p.push(h.x,h.y,c,u),h={x:c,y:u});e+=l[0]*n}return p}(n.toString(),50,0,5),u=new t.PosArray,h=0;h<c.length;h+=2)u.emplaceBack(c[h],c[h+1]);var p=o.createVertexBuffer(u,ti.members);(new tt).bind(o,l,p,[]),a.uniform4f(l.uniforms.u_color,1,1,1,1);for(var d=i.getTile(n).tileSize,f=t.default$8/(Math.pow(2,e.transform.zoom-n.overscaledZ)*d),m=[[-1,-1],[-1,1],[1,-1],[1,1]],_=0;_<m.length;_++){var g=m[_];a.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.mat4.translate([],s,[f*g[0],f*g[1],0])),a.drawArrays(a.LINES,0,p.length)}a.uniform4f(l.uniforms.u_color,0,0,0,1),a.uniformMatrix4fv(l.uniforms.u_matrix,!1,s),a.drawArrays(a.LINES,0,p.length)}var Di={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},Mi={symbol:function(t,e,i,n){if("translucent"===t.renderPass){var o=t.context;o.setStencilMode(Gt.disabled),o.setColorMode(t.colorModeForRenderPass()),0!==i.paint.get("icon-opacity").constantOr(1)&&hi(t,e,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&hi(t,e,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&function(t,e,i,n){li(t,e,i,n,!1),li(t,e,i,n,!0)}(t,e,i,n)}},circle:function(t,e,i,n){if("translucent"===t.renderPass){var o=i.paint.get("circle-opacity"),r=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity");if(0!==o.constantOr(1)||0!==r.constantOr(1)&&0!==a.constantOr(1)){var s=t.context,l=s.gl;s.setDepthMode(t.depthModeForSublayer(0,$t.ReadOnly)),s.setStencilMode(Gt.disabled),s.setColorMode(t.colorModeForRenderPass());for(var c=!0,u=0;u<n.length;u++){var h=n[u],p=e.getTile(h),d=p.getBucket(i);if(d){var f=t.context.program.get(),m=d.programConfigurations.get(i.id),_=t.useProgram("circle",m);if((c||_.program!==f)&&(m.setUniforms(s,_,i.paint,{zoom:t.transform.zoom}),c=!1),l.uniform1f(_.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),l.uniform1i(_.uniforms.u_scale_with_map,"map"===i.paint.get("circle-pitch-scale")?1:0),"map"===i.paint.get("circle-pitch-alignment")){l.uniform1i(_.uniforms.u_pitch_with_map,1);var g=ze(p,1,t.transform.zoom);l.uniform2f(_.uniforms.u_extrude_scale,g,g)}else l.uniform1i(_.uniforms.u_pitch_with_map,0),l.uniform2fv(_.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);l.uniformMatrix4fv(_.uniforms.u_matrix,!1,t.translatePosMatrix(h.posMatrix,p,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor"))),_.draw(s,l.TRIANGLES,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,m)}}}}},heatmap:function(e,i,n,o){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var r=e.context,a=r.gl;r.setDepthMode(e.depthModeForSublayer(0,$t.ReadOnly)),r.setStencilMode(Gt.disabled),function(t,e,i){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var o=i.heatmapFbo;if(o)n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),t.bindFramebuffer.set(o.framebuffer);else{var r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),function t(e,i,n,o){var r=e.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i.width/4,i.height/4,0,r.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),o.colorAttachment.set(n),e.extTextureHalfFloat&&r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,o.colorAttachment.setDirty(),t(e,i,n,o))}(t,e,r,o=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4))}}(r,e,n),r.clear({color:t.default$6.transparent}),r.setColorMode(new Wt([a.ONE,a.ONE],t.default$6.transparent,[!0,!0,!0,!0]));for(var s=!0,l=0;l<o.length;l++){var c=o[l];if(!i.hasRenderableParent(c)){var u=i.getTile(c),h=u.getBucket(n);if(h){var p=e.context.program.get(),d=h.programConfigurations.get(n.id),f=e.useProgram("heatmap",d),m=e.transform.zoom;(s||f.program!==p)&&(d.setUniforms(e.context,f,n.paint,{zoom:m}),s=!1),a.uniform1f(f.uniforms.u_extrude_scale,ze(u,1,m)),a.uniform1f(f.uniforms.u_intensity,n.paint.get("heatmap-intensity")),a.uniformMatrix4fv(f.uniforms.u_matrix,!1,c.posMatrix),f.draw(r,a.TRIANGLES,n.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,d)}}}r.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){var n=e.context,o=n.gl,r=i.heatmapFbo;if(r){n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(o.TEXTURE1);var a=i.colorRampTexture;a||(a=i.colorRampTexture=new M(n,i.colorRamp,o.RGBA)),a.bind(o.LINEAR,o.CLAMP_TO_EDGE),n.setDepthMode($t.disabled);var s=e.useProgram("heatmapTexture"),l=i.paint.get("heatmap-opacity");o.uniform1f(s.uniforms.u_opacity,l),o.uniform1i(s.uniforms.u_image,0),o.uniform1i(s.uniforms.u_color_ramp,1);var c=t.mat4.create();t.mat4.ortho(c,0,e.width,e.height,0,0,1),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,c),o.uniform2f(s.uniforms.u_world,o.drawingBufferWidth,o.drawingBufferHeight),e.viewportVAO.bind(e.context,s,e.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4)}}(e,n))},line:function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("line-opacity").constantOr(1)){var o=t.context;o.setDepthMode(t.depthModeForSublayer(0,$t.ReadOnly)),o.setColorMode(t.colorModeForRenderPass());for(var r,a=i.paint.get("line-dasharray")?"lineSDF":i.paint.get("line-pattern")?"linePattern":i.paint.get("line-gradient")?"lineGradient":"line",s=!0,l=0,c=n;l<c.length;l+=1){var u=c[l],h=e.getTile(u),p=h.getBucket(i);if(p){var d=p.programConfigurations.get(i.id),f=t.context.program.get(),m=t.useProgram(a,d),_=s||m.program!==f,g=r!==h.tileID.overscaledZ;_&&d.setUniforms(t.context,m,i.paint,{zoom:t.transform.zoom}),mi(m,t,h,p,i,u,d,_,g),r=h.tileID.overscaledZ,s=!1}}}},fill:function(e,i,n,o){var r=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.context;s.setColorMode(e.colorModeForRenderPass());var l=n.paint.get("fill-pattern")||1!==r.constantOr(t.default$6.transparent).a||1!==a.constantOr(0)?"translucent":"opaque";e.renderPass===l&&(s.setDepthMode(e.depthModeForSublayer(1,"opaque"===e.renderPass?$t.ReadWrite:$t.ReadOnly)),yi(e,i,n,o,xi)),"translucent"===e.renderPass&&n.paint.get("fill-antialias")&&(s.lineWidth.set(2),s.setDepthMode(e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly)),yi(e,i,n,o,bi))}},"fill-extrusion":function(e,i,n,o){if(0!==n.paint.get("fill-extrusion-opacity"))if("offscreen"===e.renderPass){!function(e,i){var n=e.context,o=n.gl,r=i.viewportFrame;if(e.depthRboNeedsClear&&e.setupOffscreenDepthRenderbuffer(),!r){var a=new M(n,{width:e.width,height:e.height,data:null},o.RGBA);a.bind(o.LINEAR,o.CLAMP_TO_EDGE),(r=i.viewportFrame=n.createFramebuffer(e.width,e.height)).colorAttachment.set(a.texture)}n.bindFramebuffer.set(r.framebuffer),r.depthAttachment.set(e.depthRbo),e.depthRboNeedsClear&&(n.clear({depth:1}),e.depthRboNeedsClear=!1),n.clear({color:t.default$6.transparent}),n.setStencilMode(Gt.disabled),n.setDepthMode(new $t(o.LEQUAL,$t.ReadWrite,[0,1])),n.setColorMode(e.colorModeForRenderPass())}(e,n);for(var r=!0,a=0,s=o;a<s.length;a+=1){var l=s[a],c=i.getTile(l),u=c.getBucket(n);u&&(Ci(e,0,n,c,l,u,r),r=!1)}}else"translucent"===e.renderPass&&function(t,e){var i=e.viewportFrame;if(i){var n=t.context,o=n.gl,r=t.useProgram("extrusionTexture");n.setStencilMode(Gt.disabled),n.setDepthMode($t.disabled),n.setColorMode(t.colorModeForRenderPass()),n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,i.colorAttachment.get()),o.uniform1f(r.uniforms.u_opacity,e.paint.get("fill-extrusion-opacity")),o.uniform1i(r.uniforms.u_image,0);var a=Ti.create();Ti.ortho(a,0,t.width,t.height,0,0,1),o.uniformMatrix4fv(r.uniforms.u_matrix,!1,a),o.uniform2f(r.uniforms.u_world,o.drawingBufferWidth,o.drawingBufferHeight),t.viewportVAO.bind(n,r,t.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4)}}(e,n)},hillshade:function(t,e,i,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var o=t.context,r=e.getSource().maxzoom;o.setDepthMode(t.depthModeForSublayer(0,$t.ReadOnly)),o.setStencilMode(Gt.disabled),o.setColorMode(t.colorModeForRenderPass());for(var a=0,s=n;a<s.length;a+=1){var l=s[a],c=e.getTile(l);c.needsHillshadePrepare&&"offscreen"===t.renderPass?zi(t,c,r):"translucent"===t.renderPass&&Si(t,c,i)}o.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")){var o,r,a=t.context,s=a.gl,l=e.getSource(),c=t.useProgram("raster");a.setStencilMode(Gt.disabled),a.setColorMode(t.colorModeForRenderPass()),s.uniform1f(c.uniforms.u_brightness_low,i.paint.get("raster-brightness-min")),s.uniform1f(c.uniforms.u_brightness_high,i.paint.get("raster-brightness-max")),s.uniform1f(c.uniforms.u_saturation_factor,(o=i.paint.get("raster-saturation"))>0?1-1/(1.001-o):-o),s.uniform1f(c.uniforms.u_contrast_factor,(r=i.paint.get("raster-contrast"))>0?1/(1-r):1+r),s.uniform3fv(c.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint.get("raster-hue-rotate"))),s.uniform1f(c.uniforms.u_buffer_scale,1),s.uniform1i(c.uniforms.u_image0,0),s.uniform1i(c.uniforms.u_image1,1);for(var u=n.length&&n[0].overscaledZ,h=0,p=n;h<p.length;h+=1){var d=p[h];a.setDepthMode(t.depthModeForSublayer(d.overscaledZ-u,1===i.paint.get("raster-opacity")?$t.ReadWrite:$t.ReadOnly,s.LESS));var f=e.getTile(d),m=t.transform.calculatePosMatrix(d.toUnwrapped(),!0);f.registerFadeDuration(i.paint.get("raster-fade-duration")),s.uniformMatrix4fv(c.uniforms.u_matrix,!1,m);var _=e.findLoadedParent(d,0,{}),g=Ai(f,_,e,i,t.transform),v=void 0,y=void 0;if(a.activeTexture.set(s.TEXTURE0),f.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.activeTexture.set(s.TEXTURE1),_?(_.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),v=Math.pow(2,_.tileID.overscaledZ-f.tileID.overscaledZ),y=[f.tileID.canonical.x*v%1,f.tileID.canonical.y*v%1]):f.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),s.uniform2fv(c.uniforms.u_tl_parent,y||[0,0]),s.uniform1f(c.uniforms.u_scale_parent,v||1),s.uniform1f(c.uniforms.u_fade_t,g.mix),s.uniform1f(c.uniforms.u_opacity,g.opacity*i.paint.get("raster-opacity")),l instanceof et){var x=l.boundsBuffer;l.boundsVAO.bind(a,c,x,[]),s.drawArrays(s.TRIANGLE_STRIP,0,x.length)}else if(f.maskedBoundsBuffer&&f.maskedIndexBuffer&&f.segments)c.draw(a,s.TRIANGLES,i.id,f.maskedBoundsBuffer,f.maskedIndexBuffer,f.segments);else{var b=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(a,c,b,[]),s.drawArrays(s.TRIANGLE_STRIP,0,b.length)}}}},background:function(t,e,i){var n=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0!==o){var r=t.context,a=r.gl,s=t.transform,l=s.tileSize,c=i.paint.get("background-pattern"),u=c||1!==n.a||1!==o?"translucent":"opaque";if(t.renderPass===u){var h;if(r.setStencilMode(Gt.disabled),r.setDepthMode(t.depthModeForSublayer(0,"opaque"===u?$t.ReadWrite:$t.ReadOnly)),r.setColorMode(t.colorModeForRenderPass()),c){if(_i(c,t))return;h=t.useProgram("backgroundPattern"),gi(c,t,h),t.tileExtentPatternVAO.bind(r,h,t.tileExtentBuffer,[])}else h=t.useProgram("background"),a.uniform4fv(h.uniforms.u_color,[n.r,n.g,n.b,n.a]),t.tileExtentVAO.bind(r,h,t.tileExtentBuffer,[]);a.uniform1f(h.uniforms.u_opacity,o);for(var p=0,d=s.coveringTiles({tileSize:l});p<d.length;p+=1){var f=d[p];c&&vi({tileID:f,tileSize:l},t,h),a.uniformMatrix4fv(h.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(f.toUnwrapped())),a.drawArrays(a.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}},debug:function(t,e,i){for(var n=0;n<i.length;n++)Ri(t,e,i[n])}},Li=function(e,i){this.context=new qt(e),this.transform=i,this._tileTextures={},this.setup(),this.numSublayers=Xt.maxUnderzooming+Xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.default$24,this.crossTileSymbolIndex=new He};function Pi(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function ki(t,e,i,n,o){var r=Math.max(i,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,c=e.dx/e.dy,u=t.dx>0,h=e.dx<0,p=r;p<a;p++){var d=l*Math.max(0,Math.min(t.dy,p+u-t.y0))+t.x0,f=c*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;o(Math.floor(f),Math.ceil(d),p)}}function Bi(t,e,i,n,o,r){var a,s=Pi(t,e),l=Pi(e,i),c=Pi(i,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>c.dy&&(a=s,s=c,c=a),l.dy>c.dy&&(a=l,l=c,c=a),s.dy&&ki(c,s,n,o,r),l.dy&&ki(c,l,n,o,r)}Li.prototype.resize=function(t,e){var i=this.context.gl;if(this.width=t*r.devicePixelRatio,this.height=e*r.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,o=this.style._order;n<o.length;n+=1){var a=o[n];this.style._layers[a].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},Li.prototype.setup=function(){var e=this.context,i=new t.PosArray;i.emplaceBack(0,0),i.emplaceBack(t.default$8,0),i.emplaceBack(0,t.default$8),i.emplaceBack(t.default$8,t.default$8),this.tileExtentBuffer=e.createVertexBuffer(i,ti.members),this.tileExtentVAO=new tt,this.tileExtentPatternVAO=new tt;var n=new t.PosArray;n.emplaceBack(0,0),n.emplaceBack(t.default$8,0),n.emplaceBack(t.default$8,t.default$8),n.emplaceBack(0,t.default$8),n.emplaceBack(0,0),this.debugBuffer=e.createVertexBuffer(n,ti.members),this.debugVAO=new tt;var o=new t.RasterBoundsArray;o.emplaceBack(0,0,0,0),o.emplaceBack(t.default$8,0,t.default$8,0),o.emplaceBack(0,t.default$8,0,t.default$8),o.emplaceBack(t.default$8,t.default$8,t.default$8,t.default$8),this.rasterBoundsBuffer=e.createVertexBuffer(o,Q.members),this.rasterBoundsVAO=new tt;var r=new t.PosArray;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,ti.members),this.viewportVAO=new tt},Li.prototype.clearStencil=function(){var e=this.context,i=e.gl;e.setColorMode(Wt.disabled),e.setDepthMode($t.disabled),e.setStencilMode(new Gt({func:i.ALWAYS,mask:0},0,255,i.ZERO,i.ZERO,i.ZERO));var n=t.mat4.create();t.mat4.ortho(n,0,this.width,this.height,0,0,1),t.mat4.scale(n,n,[i.drawingBufferWidth,i.drawingBufferHeight,0]);var o=this.useProgram("clippingMask");i.uniformMatrix4fv(o.uniforms.u_matrix,!1,n),this.viewportVAO.bind(e,o,this.viewportBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,4)},Li.prototype._renderTileClippingMasks=function(t){var e=this.context,i=e.gl;e.setColorMode(Wt.disabled),e.setDepthMode($t.disabled);var n=1;this._tileClippingMaskIDs={};for(var o=0,r=t;o<r.length;o+=1){var a=r[o],s=this._tileClippingMaskIDs[a.key]=n++;e.setStencilMode(new Gt({func:i.ALWAYS,mask:0},s,255,i.KEEP,i.KEEP,i.REPLACE));var l=this.useProgram("clippingMask");i.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.posMatrix),this.tileExtentVAO.bind(this.context,l,this.tileExtentBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,this.tileExtentBuffer.length)}},Li.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Gt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},Li.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Wt([e.CONSTANT_COLOR,e.ONE],new t.default$6(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Wt.unblended:Wt.alphaBlended},Li.prototype.depthModeForSublayer=function(t,e,i){var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,o=n-1+this.depthRange;return new $t(i||this.context.gl.LEQUAL,e,[o,n])},Li.prototype.render=function(e,i){var n=this;for(var o in this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(r.now()),e.sourceCaches){var a=n.style.sourceCaches[o];a.used&&a.prepare(n.context)}var s=this.style._order,l=t.filterObject(this.style.sourceCaches,function(t){return"raster"===t.getSource().type||"raster-dem"===t.getSource().type}),c=function(e){var i=l[e];!function(e,i){for(var n=e.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),o=0;o<n.length;o++){var r={},a=n[o],s=n.slice(o+1);si(a.tileID.wrapped(),a.tileID,s,new t.OverscaledTileID(0,a.tileID.wrap+1,0,0,0),r),a.setMask(r,i)}}(i.getVisibleCoordinates().map(function(t){return i.getTile(t)}),n.context)};for(var u in l)c(u);this.renderPass="offscreen";var h,p=[];this.depthRboNeedsClear=!0;for(var d=0;d<s.length;d++){var f=n.style._layers[s[d]];f.hasOffscreenPass()&&!f.isHidden(n.transform.zoom)&&(f.source!==(h&&h.id)&&(p=[],(h=n.style.sourceCaches[f.source])&&(p=h.getVisibleCoordinates()).reverse()),p.length&&n.renderLayer(n,h,f,p))}this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.default$6.black:t.default$6.transparent,depth:1}),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRange=(e._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var m,_=[];for(this.currentLayer=s.length-1,this.currentLayer;this.currentLayer>=0;this.currentLayer--){var g=n.style._layers[s[n.currentLayer]];g.source!==(m&&m.id)&&(_=[],(m=n.style.sourceCaches[g.source])&&(n.clearStencil(),_=m.getVisibleCoordinates(),m.getSource().isTileClipped&&n._renderTileClippingMasks(_))),n.renderLayer(n,m,g,_)}this.renderPass="translucent";var v,y=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<s.length;this.currentLayer++){var x=n.style._layers[s[n.currentLayer]];x.source!==(v&&v.id)&&(y=[],(v=n.style.sourceCaches[x.source])&&(n.clearStencil(),y=v.getVisibleCoordinates(),v.getSource().isTileClipped&&n._renderTileClippingMasks(y)),y.reverse()),n.renderLayer(n,v,x,y)}if(this.options.showTileBoundaries){var b=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];b&&Mi.debug(this,b,b.getVisibleCoordinates())}},Li.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},Li.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||n.length)&&(this.id=i.id,Mi[i.type](t,e,i,n))},Li.prototype.translatePosMatrix=function(e,i,n,o,r){if(!n[0]&&!n[1])return e;var a=r?"map"===o?this.transform.angle:0:"viewport"===o?-this.transform.angle:0;if(a){var s=Math.sin(a),l=Math.cos(a);n=[n[0]*l-n[1]*s,n[0]*s+n[1]*l]}var c=[r?n[0]:ze(i,n[0],this.transform.zoom),r?n[1]:ze(i,n[1],this.transform.zoom),0],u=new Float32Array(16);return t.mat4.translate(u,e,c),u},Li.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},Li.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},Li.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new ai(this.context,ri[t],e,this._showOverdrawInspector)),this.cache[i]},Li.prototype.useProgram=function(t,e){var i=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.context.program.set(i.program),i};var Oi=t.default$20.vec4,Fi=t.default$20.mat4,Ni=t.default$20.mat2,Ui=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new W(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},Zi={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},x:{configurable:!0},y:{configurable:!0},point:{configurable:!0}};Ui.prototype.clone=function(){var t=new Ui(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},Zi.minZoom.get=function(){return this._minZoom},Zi.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Zi.maxZoom.get=function(){return this._maxZoom},Zi.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Zi.renderWorldCopies.get=function(){return this._renderWorldCopies},Zi.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Zi.worldSize.get=function(){return this.tileSize*this.scale},Zi.centerPoint.get=function(){return this.size._div(2)},Zi.size.get=function(){return new t.default$1(this.width,this.height)},Zi.bearing.get=function(){return-this.angle/Math.PI*180},Zi.bearing.set=function(e){var i=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=Ni.create(),Ni.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Zi.pitch.get=function(){return this._pitch/Math.PI*180},Zi.pitch.set=function(e){var i=t.clamp(e,0,60)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},Zi.fov.get=function(){return this._fov/Math.PI*180},Zi.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Zi.zoom.get=function(){return this._zoom},Zi.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Zi.center.get=function(){return this._center},Zi.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Ui.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},Ui.prototype.getVisibleUnwrappedCoordinates=function(e){var i=this.pointCoordinate(new t.default$1(0,0),0),n=this.pointCoordinate(new t.default$1(this.width,0),0),o=Math.floor(i.column),r=Math.floor(n.column),a=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var s=o;s<=r;s++)0!==s&&a.push(new t.UnwrappedTileID(s,e));return a},Ui.prototype.coveringTiles=function(e){var i=this.coveringZoomLevel(e),n=i;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);var o=this.pointCoordinate(this.centerPoint,i),r=new t.default$1(o.column-.5,o.row-.5);return function(e,i,n,o){void 0===o&&(o=!0);var r=1<<e,a={};function s(i,s,l){var c,u,h,p;if(l>=0&&l<=r)for(c=i;c<s;c++)u=Math.floor(c/r),h=(c%r+r)%r,0!==u&&!0!==o||(p=new t.OverscaledTileID(n,u,e,h,l),a[p.key]=p)}return Bi(i[0],i[1],i[2],0,r,s),Bi(i[2],i[3],i[0],0,r,s),Object.keys(a).map(function(t){return a[t]})}(i,[this.pointCoordinate(new t.default$1(0,0),i),this.pointCoordinate(new t.default$1(this.width,0),i),this.pointCoordinate(new t.default$1(this.width,this.height),i),this.pointCoordinate(new t.default$1(0,this.height),i)],e.reparseOverscaled?n:i,this._renderWorldCopies).sort(function(t,e){return r.dist(t.canonical)-r.dist(e.canonical)})},Ui.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Zi.unmodified.get=function(){return this._unmodified},Ui.prototype.zoomScale=function(t){return Math.pow(2,t)},Ui.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Ui.prototype.project=function(e){return new t.default$1(this.lngX(e.lng),this.latY(e.lat))},Ui.prototype.unproject=function(t){return new W(this.xLng(t.x),this.yLat(t.y))},Zi.x.get=function(){return this.lngX(this.center.lng)},Zi.y.get=function(){return this.latY(this.center.lat)},Zi.point.get=function(){return new t.default$1(this.x,this.y)},Ui.prototype.lngX=function(t){return(180+t)*this.worldSize/360},Ui.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},Ui.prototype.xLng=function(t){return 360*t/this.worldSize-180},Ui.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},Ui.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i)),this._renderWorldCopies&&(this.center=this.center.wrap())},Ui.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Ui.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Ui.prototype.locationCoordinate=function(e){return new t.default$17(this.lngX(e.lng)/this.tileSize,this.latY(e.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},Ui.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new W(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},Ui.prototype.pointCoordinate=function(e,i){void 0===i&&(i=this.tileZoom);var n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];Oi.transformMat4(n,n,this.pixelMatrixInverse),Oi.transformMat4(o,o,this.pixelMatrixInverse);var r=n[3],a=o[3],s=n[0]/r,l=o[0]/a,c=n[1]/r,u=o[1]/a,h=n[2]/r,p=o[2]/a,d=h===p?0:(0-h)/(p-h);return new t.default$17(t.number(s,l,d)/this.tileSize,t.number(c,u,d)/this.tileSize,this.zoom)._zoomTo(i)},Ui.prototype.coordinatePoint=function(e){var i=e.zoomTo(this.zoom),n=[i.column*this.tileSize,i.row*this.tileSize,0,1];return Oi.transformMat4(n,n,this.pixelMatrix),new t.default$1(n[0]/n[3],n[1]/n[3])},Ui.prototype.calculatePosMatrix=function(e,i){void 0===i&&(i=!1);var n=e.key,o=i?this._alignedPosMatrixCache:this._posMatrixCache;if(o[n])return o[n];var r=e.canonical,a=this.worldSize/this.zoomScale(r.z),s=r.x+Math.pow(2,r.z)*e.wrap,l=Fi.identity(new Float64Array(16));return Fi.translate(l,l,[s*a,r.y*a,0]),Fi.scale(l,l,[a/t.default$8,a/t.default$8,1]),Fi.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),o[n]=new Float32Array(l),o[n]},Ui.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,i,n,o,r=-90,a=90,s=-180,l=180,c=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;r=this.latY(h[1]),e=(a=this.latY(h[0]))-r<c.y?c.y/(a-r):0}if(this.lngRange){var p=this.lngRange;s=this.lngX(p[0]),i=(l=this.lngX(p[1]))-s<c.x?c.x/(l-s):0}var d=Math.max(i||0,e||0);if(d)return this.center=this.unproject(new t.default$1(i?(l+s)/2:this.x,e?(a+r)/2:this.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var f=this.y,m=c.y/2;f-m<r&&(o=r+m),f+m>a&&(o=a-m)}if(this.lngRange){var _=this.x,g=c.x/2;_-g<s&&(n=s+g),_+g>l&&(n=l-g)}void 0===n&&void 0===o||(this.center=this.unproject(new t.default$1(void 0!==n?n:this.x,void 0!==o?o:this.y))),this._unmodified=u,this._constraining=!1}},Ui.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),n=this.x,o=this.y,r=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),a=new Float64Array(16);Fi.perspective(a,this._fov,this.width/this.height,1,r),Fi.scale(a,a,[1,-1,1]),Fi.translate(a,a,[0,0,-this.cameraToCenterDistance]),Fi.rotateX(a,a,this._pitch),Fi.rotateZ(a,a,this.angle),Fi.translate(a,a,[-n,-o,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));Fi.scale(a,a,[1,1,s,1]),this.projMatrix=a;var l=this.width%2/2,c=this.height%2/2,u=Math.cos(this.angle),h=Math.sin(this.angle),p=n-Math.round(n)+u*l+h*c,d=o-Math.round(o)+u*c+h*l,f=new Float64Array(a);if(Fi.translate(f,f,[p>.5?p-1:p,d>.5?d-1:d,0]),this.alignedProjMatrix=f,a=Fi.create(),Fi.scale(a,a,[this.width/2,-this.height/2,1]),Fi.translate(a,a,[1,-1,0]),this.pixelMatrix=Fi.multiply(new Float64Array(16),a,this.projMatrix),!(a=Fi.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ui.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.default$1(0,0)).zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return Oi.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},Object.defineProperties(Ui.prototype,Zi);var Vi=function(){var e,n,o,r;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),300,n=!1,o=0,r=function(){o=0,n&&(e(),o=setTimeout(r,300),n=!1)},function(){return n=!0,o||r(),o})};Vi.prototype.addTo=function(e){return this._map=e,t.default.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Vi.prototype.remove=function(){return t.default.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Vi.prototype.getHashString=function(t){var e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),r=Math.round(e.lng*o)/o,a=Math.round(e.lat*o)/o,s=this._map.getBearing(),l=this._map.getPitch(),c="";return c+=t?"#/"+r+"/"+a+"/"+i:"#"+i+"/"+a+"/"+r,(s||l)&&(c+="/"+Math.round(10*s)/10),l&&(c+="/"+Math.round(l)),c},Vi.prototype._onHashChange=function(){var e=t.default.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},Vi.prototype._updateHashUnthrottled=function(){var e=this.getHashString();t.default.history.replaceState(t.default.history.state,"",e)};var ji=function(e){function i(i,n,o,r){void 0===r&&(r={});var a=s.mousePos(n.getCanvasContainer(),o),l=n.unproject(a);e.call(this,i,t.extend({point:a,lngLat:l,originalEvent:o},r)),this._defaultPrevented=!1,this.target=n}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),$i=function(e){function i(i,n,o){var r=s.touchPos(n.getCanvasContainer(),o),a=r.map(function(t){return n.unproject(t)}),l=r.reduce(function(t,e,i,n){return t.add(e.div(n.length))},new t.default$1(0,0)),c=n.unproject(l);e.call(this,i,{points:r,point:l,lngLats:a,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),Gi=function(t){function e(e,i,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,i),e}(t.Event),Wi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};Wi.prototype.isEnabled=function(){return!!this._enabled},Wi.prototype.isActive=function(){return!!this._active},Wi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},Wi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Wi.prototype.onWheel=function(e){if(this.isEnabled()){var i=e.deltaMode===t.default.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=r.now(),o=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this.isActive()||this._start(e)),e.preventDefault()}},Wi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},Wi.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=s.mousePos(this._el,e);this._around=W.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},Wi.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var i=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,o=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==o&&(o=1/o);var a="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(a*o))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var s=!1;if("wheel"===this._type){var l=Math.min((r.now()-this._lastWheelEventTime)/200,1),c=this._easing(l);i.zoom=t.number(this._startZoom,this._targetZoom,c),l<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):s=!0}else i.zoom=this._targetZoom,s=!0;i.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),s&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom},200))}},Wi.prototype._smoothOutEasing=function(e){var i=t.ease;if(this._prevEase){var n=this._prevEase,o=(r.now()-n.start)/n.duration,a=n.easing(o+.01)-n.easing(o),s=.27/Math.sqrt(a*a+1e-4)*.01,l=Math.sqrt(.0729-s*s);i=t.bezier(s,l,.25,1)}return this._prevEase={start:r.now(),duration:e,easing:i},i};var qi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};qi.prototype.isEnabled=function(){return!!this._enabled},qi.prototype.isActive=function(){return!!this._active},qi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},qi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qi.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.default.document.addEventListener("mousemove",this._onMouseMove,!1),t.default.document.addEventListener("keydown",this._onKeyDown,!1),t.default.document.addEventListener("mouseup",this._onMouseUp,!1),s.disableDrag(),this._startPos=s.mousePos(this._el,e),this._active=!0)},qi.prototype._onMouseMove=function(t){var e=this._startPos,i=s.mousePos(this._el,t);this._box||(this._box=s.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var n=Math.min(e.x,i.x),o=Math.max(e.x,i.x),r=Math.min(e.y,i.y),a=Math.max(e.y,i.y);s.setTransform(this._box,"translate("+n+"px,"+r+"px)"),this._box.style.width=o-n+"px",this._box.style.height=a-r+"px"},qi.prototype._onMouseUp=function(e){if(0===e.button){var i=this._startPos,n=s.mousePos(this._el,e),o=(new q).extend(this._map.unproject(i)).extend(this._map.unproject(n));this._finish(),s.suppressClick(),i.x===n.x&&i.y===n.y?this._fireEvent("boxzoomcancel",e):this._map.fitBounds(o,{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e,boxZoomBounds:o}))}},qi.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},qi.prototype._finish=function(){this._active=!1,t.default.document.removeEventListener("mousemove",this._onMouseMove,!1),t.default.document.removeEventListener("keydown",this._onKeyDown,!1),t.default.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag()},qi.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))};var Xi=t.bezier(0,0,.25,1),Hi=function(e,i){this._map=e,this._el=i.element||e.getCanvasContainer(),this._state="disabled",this._button=i.button||"right",this._bearingSnap=i.bearingSnap||0,this._pitchWithRotate=!1!==i.pitchWithRotate,t.bindAll(["_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};Hi.prototype.isEnabled=function(){return"disabled"!==this._state},Hi.prototype.isActive=function(){return"active"===this._state},Hi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},Hi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Hi.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=s.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==s.mouseButton(e))return;this._eventButton=0}s.disableDrag(),t.default.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.default.document.addEventListener("mouseup",this._onMouseUp),t.default.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[r.now(),this._map.getBearing()]],this._previousPos=s.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},Hi.prototype._onMouseMove=function(t){this._lastMoveEvent=t,this._pos=s.mousePos(this._el,t),"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},Hi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform,i=this._previousPos,n=this._pos,o=.8*(i.x-n.x),a=-.5*(i.y-n.y),s=e.bearing-o,l=e.pitch-a,c=this._inertia,u=c[c.length-1];this._drainInertiaBuffer(),c.push([r.now(),this._map._normalizeBearing(s,u[1])]),e.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",t),e.pitch=l),this._fireEvent("rotate",t),this._fireEvent("move",t),delete this._lastMoveEvent,this._previousPos=this._pos}},Hi.prototype._onMouseUp=function(t){if(s.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",s.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},Hi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},Hi.prototype._unbind=function(){t.default.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.default.document.removeEventListener("mouseup",this._onMouseUp),t.default.removeEventListener("blur",this._onBlur),s.enableDrag()},Hi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos},Hi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),o=this._inertia,r=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(o.length<2)r();else{var a=o[0],s=o[o.length-1],l=o[o.length-2],c=i._normalizeBearing(n,l[1]),u=s[1]-a[1],h=u<0?-1:1,p=(s[0]-a[0])/1e3;if(0!==u&&0!==p){var d=Math.abs(u*(.25/p));d>180&&(d=180);var f=d/180;c+=h*d*(f/2),Math.abs(i._normalizeBearing(c,0))<this._bearingSnap&&(c=i._normalizeBearing(0,c)),i.rotateTo(c,{duration:1e3*f,easing:Xi,noMoveStart:!0},{originalEvent:t})}else r()}},Hi.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},Hi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=r.now();t.length>0&&e-t[0][0]>160;)t.shift()};var Ki=t.bezier(0,0,.3,1),Yi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};Yi.prototype.isEnabled=function(){return"disabled"!==this._state},Yi.prototype.isActive=function(){return"active"===this._state},Yi.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},Yi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Yi.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==s.mouseButton(e)||(s.addEventListener(t.default.document,"mousemove",this._onMove,{capture:!0}),s.addEventListener(t.default.document,"mouseup",this._onMouseUp),this._start(e)))},Yi.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(s.addEventListener(t.default.document,"touchmove",this._onMove,{capture:!0,passive:!1}),s.addEventListener(t.default.document,"touchend",this._onTouchEnd),this._start(e)))},Yi.prototype._start=function(e){t.default.addEventListener("blur",this._onBlur),this._state="pending",this._previousPos=s.mousePos(this._el,e),this._inertia=[[r.now(),this._previousPos]]},Yi.prototype._onMove=function(t){this._lastMoveEvent=t,t.preventDefault(),this._pos=s.mousePos(this._el,t),this._drainInertiaBuffer(),this._inertia.push([r.now(),this._pos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",t),this._fireEvent("movestart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},Yi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._previousPos),this._pos),this._fireEvent("drag",t),this._fireEvent("move",t),this._previousPos=this._pos,delete this._lastMoveEvent}},Yi.prototype._onMouseUp=function(t){if(0===s.mouseButton(t))switch(this._state){case"active":this._state="enabled",s.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},Yi.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},Yi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},Yi.prototype._unbind=function(){s.removeEventListener(t.default.document,"touchmove",this._onMove,{capture:!0,passive:!1}),s.removeEventListener(t.default.document,"touchend",this._onTouchEnd),s.removeEventListener(t.default.document,"mousemove",this._onMove,{capture:!0}),s.removeEventListener(t.default.document,"mouseup",this._onMouseUp),s.removeEventListener(t.default,"blur",this._onBlur)},Yi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos,delete this._pos},Yi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var i=e[e.length-1],n=e[0],o=i[1].sub(n[1]),r=(i[0]-n[0])/1e3;if(0===r||i[1].equals(n[1]))this._fireEvent("moveend",t);else{var a=o.mult(.3/r),s=a.mag();s>1400&&(s=1400,a._unit()._mult(s));var l=s/750,c=a.mult(-l/2);this._map.panBy(c,{duration:1e3*l,easing:Ki,noMoveStart:!0},{originalEvent:t})}}},Yi.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},Yi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=r.now();t.length>0&&e-t[0][0]>160;)t.shift()};var Ji=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function Qi(t){return t*(2-t)}Ji.prototype.isEnabled=function(){return!!this._enabled},Ji.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},Ji.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},Ji.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,n=0,o=0,r=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),r=-1);break;case 40:t.shiftKey?n=-1:(r=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),l={duration:300,delayEndEvents:500,easing:Qi,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*i,pitch:a.getPitch()+10*n,offset:[100*-o,100*-r],center:a.getCenter()};a.easeTo(l,{originalEvent:t})}};var tn=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};tn.prototype.isEnabled=function(){return!!this._enabled},tn.prototype.isActive=function(){return!!this._active},tn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},tn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},tn.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null},300)))},tn.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},tn.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},tn.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var en=t.bezier(0,0,.15,1),nn=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};nn.prototype.isEnabled=function(){return!!this._enabled},nn.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},nn.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},nn.prototype.disableRotation=function(){this._rotationDisabled=!0},nn.prototype.enableRotation=function(){this._rotationDisabled=!1},nn.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var i=s.mousePos(this._el,e.touches[0]),n=s.mousePos(this._el,e.touches[1]);this._startVec=i.sub(n),this._gestureIntent=void 0,this._inertia=[],s.addEventListener(t.default.document,"touchmove",this._onMove,{passive:!1}),s.addEventListener(t.default.document,"touchend",this._onEnd)}},nn.prototype._getTouchEventData=function(t){var e=s.mousePos(this._el,t.touches[0]),i=s.mousePos(this._el,t.touches[1]),n=e.sub(i);return{vec:n,center:e.add(i).div(2),scale:n.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI}},nn.prototype._onMove=function(e){if(2===e.touches.length){var i=this._getTouchEventData(e),n=i.vec,o=i.scale,r=i.bearing;if(!this._gestureIntent){var a=Math.abs(1-o)>.15;Math.abs(r)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=n)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},nn.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var i=this._map.transform;this._startScale||(this._startScale=i.scale,this._startBearing=i.bearing);var n=this._getTouchEventData(this._lastTouchEvent),o=n.center,a=n.bearing,s=n.scale,l=i.pointLocation(o),c=i.locationPoint(l);"rotate"===e&&(i.bearing=this._startBearing+a),i.zoom=i.scaleZoom(this._startScale*s),i.setLocationAtPoint(l,c),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([r.now(),s,o])}},nn.prototype._onEnd=function(e){s.removeEventListener(t.default.document,"touchmove",this._onMove,{passive:!1}),s.removeEventListener(t.default.document,"touchend",this._onEnd);var i=this._gestureIntent,n=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new t.Event(i+"end",{originalEvent:e})),this._drainInertiaBuffer();var o=this._inertia,r=this._map;if(o.length<2)r.snapToNorth({},{originalEvent:e});else{var a=o[o.length-1],l=o[0],c=r.transform.scaleZoom(n*a[1]),u=r.transform.scaleZoom(n*l[1]),h=c-u,p=(a[0]-l[0])/1e3,d=a[2];if(0!==p&&c!==u){var f=.15*h/p;Math.abs(f)>2.5&&(f=f>0?2.5:-2.5);var m=1e3*Math.abs(f/(12*.15)),_=c+f*m/2e3;_<0&&(_=0),r.easeTo({zoom:_,duration:m,easing:en,around:this._aroundCenter?r.getCenter():r.unproject(d),noMoveStart:!0},{originalEvent:e})}else r.snapToNorth({},{originalEvent:e})}}},nn.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=r.now();t.length>2&&e-t[0][0]>160;)t.shift()};var on={scrollZoom:Wi,boxZoom:qi,dragRotate:Hi,dragPan:Yi,keyboard:Ji,doubleClickZoom:tn,touchZoomRotate:nn},rn=function(e){function i(i,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getCenter=function(){return this.transform.center},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},i.prototype.panBy=function(e,i,n){return e=t.default$1.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),n)},i.prototype.panTo=function(e,i,n){return this.easeTo(t.extend({center:e},i),n)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(e,i,n){return this.easeTo(t.extend({zoom:e},i),n)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.rotateTo=function(e,i,n){return this.easeTo(t.extend({bearing:e},i),n)},i.prototype.resetNorth=function(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.fitBounds=function(e,i,n){if("number"==typeof(i=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}if(!t.default$10(Object.keys(i.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"]))return t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'"),this;e=q.convert(e);var r=[(i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2],a=Math.min(i.padding.right,i.padding.left),s=Math.min(i.padding.top,i.padding.bottom);i.offset=[i.offset[0]+r[0],i.offset[1]+r[1]];var l=t.default$1.convert(i.offset),c=this.transform,u=c.project(e.getNorthWest()),h=c.project(e.getSouthEast()),p=h.sub(u),d=(c.width-2*a-2*Math.abs(l.x))/p.x,f=(c.height-2*s-2*Math.abs(l.y))/p.y;return f<0||d<0?(t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."),this):(i.center=c.unproject(u.add(h).div(2)),i.zoom=Math.min(c.scaleZoom(c.scale*Math.min(d,f)),i.maxZoom),i.bearing=0,i.linear?this.easeTo(i,n):this.flyTo(i,n))},i.prototype.jumpTo=function(e,i){this.stop();var n=this.transform,o=!1,r=!1,a=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(o=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=W.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(r=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),o&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),r&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),a&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))},i.prototype.easeTo=function(e,i){var n=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var o=this.transform,r=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,u="pitch"in e?+e.pitch:s,h=o.centerPoint.add(t.default$1.convert(e.offset)),p=o.pointLocation(h),d=W.convert(e.center||p);this._normalizeCenter(d);var f,m,_=o.project(p),g=o.project(d).sub(_),v=o.zoomScale(l-r);return e.around&&(f=W.convert(e.around),m=o.locationPoint(f)),this._zooming=l!==r,this._rotating=a!==c,this._pitching=u!==s,this._prepareEase(i,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(n._zooming&&(o.zoom=t.number(r,l,e)),n._rotating&&(o.bearing=t.number(a,c,e)),n._pitching&&(o.pitch=t.number(s,u,e)),f)o.setLocationAtPoint(f,m);else{var p=o.zoomScale(o.zoom-r),d=l>r?Math.min(2,v):Math.max(.5,v),y=Math.pow(d,1-e),x=o.unproject(_.add(g.mult(e*y)).mult(p));o.setLocationAtPoint(o.renderWorldCopies?x.wrap():x,h)}n._fireMoveEvents(i)},function(){e.delayEndEvents?n._easeEndTimeoutID=setTimeout(function(){return n._afterEase(i)},e.delayEndEvents):n._afterEase(i)},e),this},i.prototype._prepareEase=function(e,i){this._moving=!0,i||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},i.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},i.prototype._afterEase=function(e){var i=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,i&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},i.prototype.flyTo=function(e,i){var n=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,r=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):r,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,u="pitch"in e?+e.pitch:s,h=o.zoomScale(l-r),p=o.centerPoint.add(t.default$1.convert(e.offset)),d=o.pointLocation(p),f=W.convert(e.center||d);this._normalizeCenter(f);var m=o.project(d),_=o.project(f).sub(m),g=e.curve,v=Math.max(o.width,o.height),y=v/h,x=_.mag();if("minZoom"in e){var b=t.clamp(Math.min(e.minZoom,r,l),o.minZoom,o.maxZoom),w=v/o.zoomScale(b-r);g=Math.sqrt(w/x*2)}var E=g*g;function T(t){var e=(y*y-v*v+(t?-1:1)*E*E*x*x)/(2*(t?y:v)*E*x);return Math.log(Math.sqrt(e*e+1)-e)}function I(t){return(Math.exp(t)-Math.exp(-t))/2}function C(t){return(Math.exp(t)+Math.exp(-t))/2}var S=T(0),z=function(t){return C(S)/C(S+g*t)},A=function(t){return v*((C(S)*(I(e=S+g*t)/C(e))-I(S))/E)/x;var e},R=(T(1)-S)/g;if(Math.abs(x)<1e-6||!isFinite(R)){if(Math.abs(v-y)<1e-6)return this.easeTo(e,i);var D=y<v?-1:1;R=Math.abs(Math.log(y/v))/g,A=function(){return 0},z=function(t){return Math.exp(D*g*t)}}if("duration"in e)e.duration=+e.duration;else{var M="screenSpeed"in e?+e.screenSpeed/g:+e.speed;e.duration=1e3*R/M}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=a!==c,this._pitching=u!==s,this._prepareEase(i,!1),this._ease(function(e){var l=e*R,h=1/z(l);o.zoom=r+o.scaleZoom(h),n._rotating&&(o.bearing=t.number(a,c,e)),n._pitching&&(o.pitch=t.number(s,u,e));var d=o.unproject(m.add(_.mult(A(l))).mult(h));o.setLocationAtPoint(o.renderWorldCopies?d.wrap():d,p),n._fireMoveEvents(i)},function(){return n._afterEase(i)},e),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},i.prototype._ease=function(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=r.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},i.prototype._renderFrameCallback=function(){var t=Math.min((r.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},i.prototype._normalizeBearing=function(e,i){e=t.wrap(e,-180,180);var n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e},i.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}},i}(t.Evented),an=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};an.prototype.getDefaultPosition=function(){return"bottom-right"},an.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},an.prototype.onRemove=function(){s.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},an.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var e=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:_.ACCESS_TOKEN}];if(t){var i=e.reduce(function(t,i,n){return i.value&&(t+=i.key+"="+i.value+(n<e.length-1?"&":"")),t},"?");t.href="https://www.mapbox.com/feedback/"+i+(this._map._hash?this._map._hash.getHashString(!0):"")}},an.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},an.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var i=this._map.style.sourceCaches;for(var n in i){var o=i[n].getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,i){for(var n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})).length?(this._container.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},an.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var sn=function(){t.bindAll(["_updateLogo"],this)};sn.prototype.onAdd=function(t){this._map=t,this._container=s.create("div","mapboxgl-ctrl");var e=s.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},sn.prototype.onRemove=function(){s.remove(this._container),this._map.off("sourcedata",this._updateLogo)},sn.prototype.getDefaultPosition=function(){return"bottom-left"},sn.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},sn.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}};var ln=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ln.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},ln.prototype.remove=function(t){for(var e=this._currentlyRunning,i=0,n=e?this._queue.concat(e):this._queue;i<n.length;i+=1){var o=n[i];if(o.id===t)return void(o.cancelled=!0)}},ln.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(!n.cancelled&&(n.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ln.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var cn=t.default.HTMLImageElement,un=t.default.HTMLElement,hn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300},pn=function(i){function n(e){if(null!=(e=t.extend({},hn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var n=new Ui(e.minZoom,e.maxZoom,e.renderWorldCopies);i.call(this,n,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new ln;var o=e.transformRequest;if(this._transformRequest=o?function(t,e){return o(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof e.container){var r=t.default.document.getElementById(e.container);if(!r)throw new Error("Container '"+e.container+"' not found.");this._container=r}else{if(!(e.container instanceof un))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==t.default&&(t.default.addEventListener("online",this._onWindowOnline,!1),t.default.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var i=t.getCanvasContainer(),n=null,o=!1;for(var r in on)t[r]=new on[r](t,e),e.interactive&&e[r]&&t[r].enable(e[r]);s.addEventListener(i,"mouseout",function(e){t.fire(new ji("mouseout",t,e))}),s.addEventListener(i,"mousedown",function(i){o=!0;var n=new ji("mousedown",t,i);t.fire(n),n.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(i),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(i),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(i))}),s.addEventListener(i,"mouseup",function(e){var i=t.dragRotate.isActive();n&&!i&&t.fire(new ji("contextmenu",t,n)),n=null,o=!1,t.fire(new ji("mouseup",t,e))}),s.addEventListener(i,"mousemove",function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var n=e.toElement||e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new ji("mousemove",t,e))}}),s.addEventListener(i,"mouseover",function(e){for(var n=e.toElement||e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new ji("mouseover",t,e))}),s.addEventListener(i,"touchstart",function(i){var n=new $i("touchstart",t,i);t.fire(n),n.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(i),t.touchZoomRotate.onStart(i),t.doubleClickZoom.onTouchStart(n))},{passive:!1}),s.addEventListener(i,"touchmove",function(e){t.fire(new $i("touchmove",t,e))},{passive:!1}),s.addEventListener(i,"touchend",function(e){t.fire(new $i("touchend",t,e))}),s.addEventListener(i,"touchcancel",function(e){t.fire(new $i("touchcancel",t,e))}),s.addEventListener(i,"click",function(e){t.fire(new ji("click",t,e))}),s.addEventListener(i,"dblclick",function(e){var i=new ji("dblclick",t,e);t.fire(i),i.defaultPrevented||t.doubleClickZoom.onDblClick(i)}),s.addEventListener(i,"contextmenu",function(e){var i=t.dragRotate.isActive();o||i?o&&(n=e):t.fire(new ji("contextmenu",t,e)),e.preventDefault()}),s.addEventListener(i,"wheel",function(e){var i=new Gi("wheel",t,e);t.fire(i),i.defaultPrevented||t.scrollZoom.onWheel(e)},{passive:!1})}(this,e),this._hash=e.hash&&(new Vi).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this.resize(),e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new an),this.addControl(new sn,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return n.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),n=this._controlPositions[e];return-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},n.prototype.removeControl=function(t){return t.onRemove(this),this},n.prototype.resize=function(e){var i=this._containerDimensions(),n=i[0],o=i[1];return this._resizeCanvas(n,o),this.transform.resize(n,o),this.painter.resize(n,o),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e))},n.prototype.getBounds=function(){var e=new q(this.transform.pointLocation(new t.default$1(0,this.transform.height)),this.transform.pointLocation(new t.default$1(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(e.extend(this.transform.pointLocation(new t.default$1(this.transform.size.x,0))),e.extend(this.transform.pointLocation(new t.default$1(0,this.transform.size.y)))),e},n.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new q([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},n.prototype.setMaxBounds=function(t){if(t){var e=q.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null==t&&(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},n.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},n.prototype.getMinZoom=function(){return this.transform.minZoom},n.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},n.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},n.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update(),this},n.prototype.getMaxZoom=function(){return this.transform.maxZoom},n.prototype.project=function(t){return this.transform.locationPoint(W.convert(t))},n.prototype.unproject=function(e){return this.transform.pointLocation(t.default$1.convert(e))},n.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},n.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isActive()},n.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},n.prototype.on=function(t,e,n){var o,r=this;if(void 0===n)return i.prototype.on.call(this,t,e);var a=function(){if("mouseenter"===t||"mouseover"===t){var i=!1;return{layer:e,listener:n,delegates:{mousemove:function(o){var a=r.getLayer(e)?r.queryRenderedFeatures(o.point,{layers:[e]}):[];a.length?i||(i=!0,n.call(r,new ji(t,r,o.originalEvent,{features:a}))):i=!1},mouseout:function(){i=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){(r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(r,new ji(t,r,i.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(r,new ji(t,r,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(o={},o[t]=function(t){var i=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(r,t),delete t.features)},o)}}();for(var s in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(a),a.delegates)r.on(s,a.delegates[s]);return this},n.prototype.off=function(t,e,n){if(void 0===n)return i.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var o=this._delegatedListeners[t],r=0;r<o.length;r++){var a=o[r];if(a.layer===e&&a.listener===n){for(var s in a.delegates)this.off(s,a.delegates[s]);return o.splice(r,1),this}}return this},n.prototype.queryRenderedFeatures=function(e,i){var n;return 2===arguments.length?(e=arguments[0],i=arguments[1]):1===arguments.length&&((n=arguments[0])instanceof t.default$1||Array.isArray(n))?(e=arguments[0],i={}):1===arguments.length?(e=void 0,i=arguments[0]):(e=void 0,i={}),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(e),i,this.transform):[]},n.prototype._makeQueryGeometry=function(e){var i,n=this;if(void 0===e&&(e=[t.default$1.convert([0,0]),t.default$1.convert([this.transform.width,this.transform.height])]),e instanceof t.default$1||"number"==typeof e[0])i=[t.default$1.convert(e)];else{var o=[t.default$1.convert(e[0]),t.default$1.convert(e[1])];i=[o[0],new t.default$1(o[1].x,o[0].y),o[1],new t.default$1(o[0].x,o[1].y),o[0]]}return{viewport:i,worldCoordinate:i.map(function(t){return n.transform.pointCoordinate(t)})}},n.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},n.prototype.setStyle=function(e,i){if((!i||!1!==i.diff&&!i.localIdeographFontFamily)&&this.style&&e&&"object"==typeof e)try{return this.style.setState(e)&&this._update(!0),this}catch(e){t.warnOnce("Unable to perform style diff: "+(e.message||e.error||e)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new Qe(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)},n.prototype.getStyle=function(){if(this.style)return this.style.serialize()},n.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},n.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},n.prototype.isSourceLoaded=function(e){var i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},n.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var n in i){var o=i[n];if("loaded"!==o.state&&"errored"!==o.state)return!1}}return!0},n.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},n.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},n.prototype.getSource=function(t){return this.style.getSource(t)},n.prototype.addImage=function(e,i,n){void 0===n&&(n={});var o=n.pixelRatio;void 0===o&&(o=1);var a=n.sdf;if(void 0===a&&(a=!1),i instanceof cn){var s=r.getImageData(i),l=s.width,c=s.height,u=s.data;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:o,sdf:a})}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var h=i.width,p=i.height,d=i.data;this.style.addImage(e,{data:new t.RGBAImage({width:h,height:p},d.slice(0)),pixelRatio:o,sdf:a})}},n.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},n.prototype.removeImage=function(t){this.style.removeImage(t)},n.prototype.loadImage=function(e,i){t.getImage(this._transformRequest(e,t.ResourceType.Image),i)},n.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},n.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},n.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},n.prototype.getLayer=function(t){return this.style.getLayer(t)},n.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},n.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},n.prototype.getFilter=function(t){return this.style.getFilter(t)},n.prototype.setPaintProperty=function(t,e,i){return this.style.setPaintProperty(t,e,i),this._update(!0),this},n.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},n.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},n.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},n.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},n.prototype.getLight=function(){return this.style.getLight()},n.prototype.getContainer=function(){return this._container},n.prototype.getCanvasContainer=function(){return this._canvasContainer},n.prototype.getCanvas=function(){return this._canvas},n.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},n.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSContainer=s.create("div","mapboxgl-missing-css",t)).innerHTML="Missing Mapbox GL JS CSS";var e=this._canvasContainer=s.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=s.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=s.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){o[t]=s.create("div","mapboxgl-ctrl-"+t,n)})},n.prototype._resizeCanvas=function(e,i){var n=t.default.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*i,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px"},n.prototype._setupPainter=function(){var i=t.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},e.webGLContextAttributes),n=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);n?this.painter=new Li(n,this.transform):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},n.prototype._contextLost=function(e){e.preventDefault(),this._frameId&&(r.cancelFrame(this._frameId),this._frameId=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},n.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},n.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},n.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender())},n.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},n.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},n.prototype._render=function(){this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var i=this.transform.zoom,n=r.now();this.style.zoomHistory.update(i,n);var o=new t.default$16(i,{now:n,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=o.crossFadingFactor();1===a&&a===this._crossFadingFactor||(e=!0,this._crossFadingFactor=a),this.style.update(o)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this._rerender(),this},n.prototype.remove=function(){this._hash&&this._hash.remove(),r.cancelFrame(this._frameId),this._renderTaskQueue.clear(),this._frameId=null,this.setStyle(null),void 0!==t.default&&(t.default.removeEventListener("resize",this._onWindowResize,!1),t.default.removeEventListener("online",this._onWindowOnline,!1));var e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),dn(this._canvasContainer),dn(this._controlContainer),dn(this._missingCSSContainer),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},n.prototype._rerender=function(){var t=this;this.style&&!this._frameId&&(this._frameId=r.frame(function(){t._frameId=null,t._render()}))},n.prototype._onWindowOnline=function(){this._update()},n.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint=t,this._update()},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},n.prototype._onData=function(e){this._update("style"===e.dataType),this.fire(new t.Event(e.dataType+"data",e))},n.prototype._onDataLoading=function(e){this.fire(new t.Event(e.dataType+"dataloading",e))},Object.defineProperties(n.prototype,o),n}(rn);function dn(t){t.parentNode&&t.parentNode.removeChild(t)}var fn={showCompass:!0,showZoom:!0},mn=function(e){var i=this;this.options=t.extend({},fn,e),this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom In",function(){return i._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom Out",function(){return i._map.zoomOut()})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset North",function(){return i._map.resetNorth()}),this._compassArrow=s.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function _n(t,e,i){if(t=new W(t.lng,t.lat),e){var n=new W(t.lng-360,t.lat),o=new W(t.lng+360,t.lat),r=i.locationPoint(t).distSqr(e);i.locationPoint(n).distSqr(e)<r?t=n:i.locationPoint(o).distSqr(e)<r&&(t=o)}for(;Math.abs(t.lng-i.center.lng)>180;){var a=i.locationPoint(t);if(a.x>=0&&a.y>=0&&a.x<=i.width&&a.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}mn.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},mn.prototype.onAdd=function(t){return this._map=t,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hi(t,{button:"left",element:this._compass}),this._handler.enable()),this._container},mn.prototype.onRemove=function(){s.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._handler.disable(),delete this._handler),delete this._map},mn.prototype._createButton=function(t,e,i){var n=s.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",e),n.addEventListener("click",i),n};var gn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vn(t,e,i){var n=t.classList;for(var o in gn)n.remove("mapboxgl-"+i+"-anchor-"+o);n.add("mapboxgl-"+i+"-anchor-"+e)}var yn=function(e){if((arguments[0]instanceof t.default.HTMLElement||2===arguments.length)&&(e=t.extend({element:e},arguments[1])),t.bindAll(["_update","_onMapClick"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",e&&e.element)this._element=e.element,this._offset=t.default$1.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div");var i=s.createNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS(null,"height","41px"),i.setAttributeNS(null,"width","27px"),i.setAttributeNS(null,"viewBox","0 0 27 41");var n=s.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"stroke-width","1"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"fill-rule","evenodd");var o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");var r=s.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"transform","translate(3.0, 29.0)"),r.setAttributeNS(null,"fill","#000000");for(var a=0,l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];a<l.length;a+=1){var c=l[a],u=s.createNS("http://www.w3.org/2000/svg","ellipse");u.setAttributeNS(null,"opacity","0.04"),u.setAttributeNS(null,"cx","10.5"),u.setAttributeNS(null,"cy","5.80029008"),u.setAttributeNS(null,"rx",c.rx),u.setAttributeNS(null,"ry",c.ry),r.appendChild(u)}var h=s.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill",this._color);var p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(p);var d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");var f=s.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(f);var m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(6.0, 7.0)"),m.setAttributeNS(null,"fill","#FFFFFF");var _=s.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");var g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");var v=s.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),_.appendChild(g),_.appendChild(v),o.appendChild(r),o.appendChild(h),o.appendChild(d),o.appendChild(m),o.appendChild(_),i.appendChild(o),this._element.appendChild(i),this._offset=t.default$1.convert(e&&e.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._popup=null};yn.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},yn.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this},yn.prototype.getLngLat=function(){return this._lngLat},yn.prototype.setLngLat=function(t){return this._lngLat=W.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},yn.prototype.getElement=function(){return this._element},yn.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},yn.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},yn.prototype.getPopup=function(){return this._popup},yn.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},yn.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=_n(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,gn[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"),vn(this._element,this._anchor,"marker"))},yn.prototype.getOffset=function(){return this._offset},yn.prototype.setOffset=function(e){return this._offset=t.default$1.convert(e),this._update(),this};var xn,bn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},wn=function(e){function i(i){e.call(this),this.options=t.extend({},bn,i),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==xn?i(xn):void 0!==t.default.navigator.permissions?t.default.navigator.permissions.query({name:"geolocation"}).then(function(t){xn="denied"!==t.state,i(xn)}):(xn=!!t.default.navigator.geolocation,i(xn)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.default.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),s.remove(this._container),this._map=void 0},i.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},i.prototype._updateCamera=function(t){var e=new W(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy;this._map.fitBounds(e.toBounds(i),this.options.fitBoundsOptions,{geolocateSource:!0})},i.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},i.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;!1!==e&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=s.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new yn(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))}))},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.default.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.default.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.default.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),En={maxWidth:100,unit:"metric"},Tn=function(e){this.options=t.extend({},En,e),t.bindAll(["_onMove","setUnit"],this)};function In(t,e,i){var n,o,r,a,s,l,c=i&&i.maxWidth||100,u=t._container.clientHeight/2,h=(n=t.unproject([0,u]),o=t.unproject([c,u]),r=Math.PI/180,a=n.lat*r,s=o.lat*r,l=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((o.lng-n.lng)*r),6371e3*Math.acos(Math.min(l,1)));if(i&&"imperial"===i.unit){var p=3.2808*h;p>5280?Cn(e,c,p/5280,"mi"):Cn(e,c,p,"ft")}else i&&"nautical"===i.unit?Cn(e,c,h/1852,"nm"):Cn(e,c,h,"m")}function Cn(t,e,i,n){var o,r,a,s=(o=i,(r=Math.pow(10,(""+Math.floor(o)).length-1))*(a=(a=o/r)>=10?10:a>=5?5:a>=3?3:a>=2?2:1)),l=s/i;"m"===n&&s>=1e3&&(s/=1e3,n="km"),t.style.width=e*l+"px",t.innerHTML=s+n}Tn.prototype.getDefaultPosition=function(){return"bottom-left"},Tn.prototype._onMove=function(){In(this._map,this._container,this.options)},Tn.prototype.onAdd=function(t){return this._map=t,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Tn.prototype.onRemove=function(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Tn.prototype.setUnit=function(t){this.options.unit=t,In(this._map,this._container,this.options)};var Sn=function(){this._fullscreen=!1,t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.default.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.default.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.default.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.default.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Sn.prototype.onAdd=function(e){return this._map=e,this._mapContainer=this._map.getContainer(),this._container=s.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._container},Sn.prototype.onRemove=function(){s.remove(this._container),this._map=null,t.default.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Sn.prototype._checkFullscreenSupport=function(){return!!(t.default.document.fullscreenEnabled||t.default.document.mozFullScreenEnabled||t.default.document.msFullscreenEnabled||t.default.document.webkitFullscreenEnabled)},Sn.prototype._setupUI=function(){var e=this._fullscreenButton=s.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);e.setAttribute("aria-label","Toggle fullscreen"),e.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.default.document.addEventListener(this._fullscreenchange,this._changeIcon)},Sn.prototype._isFullscreen=function(){return this._fullscreen},Sn.prototype._changeIcon=function(){(t.default.document.fullscreenElement||t.default.document.mozFullScreenElement||t.default.document.webkitFullscreenElement||t.default.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},Sn.prototype._onClickFullscreen=function(){this._isFullscreen()?t.default.document.exitFullscreen?t.default.document.exitFullscreen():t.default.document.mozCancelFullScreen?t.default.document.mozCancelFullScreen():t.default.document.msExitFullscreen?t.default.document.msExitFullscreen():t.default.document.webkitCancelFullScreen&&t.default.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()};var zn={closeButton:!0,closeOnClick:!0},An=function(e){function i(i){e.call(this),this.options=t.extend(Object.create(zn),i),t.bindAll(["_update","_onClickClose"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(t){return this._lngLat=W.convert(t),this._pos=null,this._update(),this},i.prototype.setText=function(e){return this.setDOMContent(t.default.document.createTextNode(e))},i.prototype.setHTML=function(e){var i,n=t.default.document.createDocumentFragment(),o=t.default.document.createElement("body");for(o.innerHTML=e;i=o.firstChild;)n.appendChild(i);return this.setDOMContent(n)},i.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},i.prototype._createContent=function(){this._content&&s.remove(this._content),this._content=s.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=s.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},i.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=s.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=s.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this._map.transform.renderWorldCopies&&(this._lngLat=_n(this._lngLat,this._pos,this._map.transform));var e=this._pos=this._map.project(this._lngLat),i=this.options.anchor,n=function e(i){if(i){if("number"==typeof i){var n=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new t.default$1(0,0),top:new t.default$1(0,i),"top-left":new t.default$1(n,n),"top-right":new t.default$1(-n,n),bottom:new t.default$1(0,-i),"bottom-left":new t.default$1(n,-n),"bottom-right":new t.default$1(-n,-n),left:new t.default$1(i,0),right:new t.default$1(-i,0)}}if(i instanceof t.default$1||Array.isArray(i)){var o=t.default$1.convert(i);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:t.default$1.convert(i.center||[0,0]),top:t.default$1.convert(i.top||[0,0]),"top-left":t.default$1.convert(i["top-left"]||[0,0]),"top-right":t.default$1.convert(i["top-right"]||[0,0]),bottom:t.default$1.convert(i.bottom||[0,0]),"bottom-left":t.default$1.convert(i["bottom-left"]||[0,0]),"bottom-right":t.default$1.convert(i["bottom-right"]||[0,0]),left:t.default$1.convert(i.left||[0,0]),right:t.default$1.convert(i.right||[0,0])}}return e(new t.default$1(0,0))}(this.options.offset);if(!i){var o,r=this._container.offsetWidth,a=this._container.offsetHeight;o=e.y+n.bottom.y<a?["top"]:e.y>this._map.transform.height-a?["bottom"]:[],e.x<r/2?o.push("left"):e.x>this._map.transform.width-r/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}var l=e.add(n[i]).round();s.setTransform(this._container,gn[i]+" translate("+l.x+"px,"+l.y+"px)"),vn(this._container,i,"popup")}},i.prototype._onClickClose=function(){this.remove()},i}(t.Evented),Rn={version:"0.45.0",supported:e,workerCount:Math.max(Math.floor(r.hardwareConcurrency/2),1),setRTLTextPlugin:t.setRTLTextPlugin,Map:pn,NavigationControl:mn,GeolocateControl:wn,AttributionControl:an,ScaleControl:Tn,FullscreenControl:Sn,Popup:An,Marker:yn,Style:Qe,LngLat:W,LngLatBounds:q,Point:t.default$1,Evented:t.Evented,config:_,get accessToken(){return _.ACCESS_TOKEN},set accessToken(t){_.ACCESS_TOKEN=t},workerUrl:""};return Rn}),mapboxgl})}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],407:[function(_dereq_,module,exports){"use strict";module.exports=function createTable(dimension){for(var numCells=1<<dimension+1,result=new Array(numCells),i=0;i<numCells;++i)result[i]=constructCell(dimension,i);return result};var chull=_dereq_("convex-hull");function constructVertex(d,a,b){for(var x=new Array(d),i=0;i<d;++i)x[i]=0,i===a&&(x[i]+=.5),i===b&&(x[i]+=.5);return x}function constructCell(dimension,mask){if(0===mask||mask===(1<<dimension+1)-1)return[];for(var points=[],index=[],i=0;i<=dimension;++i)if(mask&1<<i){points.push(constructVertex(dimension,i-1,i-1)),index.push(null);for(var j=0;j<=dimension;++j)~mask&1<<j&&(points.push(constructVertex(dimension,i-1,j-1)),index.push([i,j]))}var hull=chull(points),faces=[];i_loop:for(i=0;i<hull.length;++i){var face=hull[i],nface=[];for(j=0;j<face.length;++j){if(!index[face[j]])continue i_loop;nface.push(index[face[j]].slice())}faces.push(nface)}return faces}},{"convex-hull":117}],408:[function(_dereq_,module,exports){var normalize=_dereq_("./normalize"),create=_dereq_("gl-mat4/create"),clone=_dereq_("gl-mat4/clone"),determinant=_dereq_("gl-mat4/determinant"),invert=_dereq_("gl-mat4/invert"),transpose=_dereq_("gl-mat4/transpose"),vec3={length:_dereq_("gl-vec3/length"),normalize:_dereq_("gl-vec3/normalize"),dot:_dereq_("gl-vec3/dot"),cross:_dereq_("gl-vec3/cross")},tmp=create(),perspectiveMatrix=create(),tmpVec4=[0,0,0,0],row=[[0,0,0],[0,0,0],[0,0,0]],pdum3=[0,0,0];function combine(out,a,b,scale1,scale2){out[0]=a[0]*scale1+b[0]*scale2,out[1]=a[1]*scale1+b[1]*scale2,out[2]=a[2]*scale1+b[2]*scale2}module.exports=function decomposeMat4(matrix,translation,scale,skew,perspective,quaternion){if(translation||(translation=[0,0,0]),scale||(scale=[0,0,0]),skew||(skew=[0,0,0]),perspective||(perspective=[0,0,0,1]),quaternion||(quaternion=[0,0,0,1]),!normalize(tmp,matrix))return!1;if(clone(perspectiveMatrix,tmp),perspectiveMatrix[3]=0,perspectiveMatrix[7]=0,perspectiveMatrix[11]=0,perspectiveMatrix[15]=1,Math.abs(determinant(perspectiveMatrix)<1e-8))return!1;var a03=tmp[3],a13=tmp[7],a23=tmp[11],a30=tmp[12],a31=tmp[13],a32=tmp[14],a33=tmp[15];if(0!==a03||0!==a13||0!==a23){if(tmpVec4[0]=a03,tmpVec4[1]=a13,tmpVec4[2]=a23,tmpVec4[3]=a33,!invert(perspectiveMatrix,perspectiveMatrix))return!1;transpose(perspectiveMatrix,perspectiveMatrix),function vec4multMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}(perspective,tmpVec4,perspectiveMatrix)}else perspective[0]=perspective[1]=perspective[2]=0,perspective[3]=1;if(translation[0]=a30,translation[1]=a31,translation[2]=a32,function mat3from4(out,mat4x4){out[0][0]=mat4x4[0],out[0][1]=mat4x4[1],out[0][2]=mat4x4[2],out[1][0]=mat4x4[4],out[1][1]=mat4x4[5],out[1][2]=mat4x4[6],out[2][0]=mat4x4[8],out[2][1]=mat4x4[9],out[2][2]=mat4x4[10]}(row,tmp),scale[0]=vec3.length(row[0]),vec3.normalize(row[0],row[0]),skew[0]=vec3.dot(row[0],row[1]),combine(row[1],row[1],row[0],1,-skew[0]),scale[1]=vec3.length(row[1]),vec3.normalize(row[1],row[1]),skew[0]/=scale[1],skew[1]=vec3.dot(row[0],row[2]),combine(row[2],row[2],row[0],1,-skew[1]),skew[2]=vec3.dot(row[1],row[2]),combine(row[2],row[2],row[1],1,-skew[2]),scale[2]=vec3.length(row[2]),vec3.normalize(row[2],row[2]),skew[1]/=scale[2],skew[2]/=scale[2],vec3.cross(pdum3,row[1],row[2]),vec3.dot(row[0],pdum3)<0)for(var i=0;i<3;i++)scale[i]*=-1,row[i][0]*=-1,row[i][1]*=-1,row[i][2]*=-1;return quaternion[0]=.5*Math.sqrt(Math.max(1+row[0][0]-row[1][1]-row[2][2],0)),quaternion[1]=.5*Math.sqrt(Math.max(1-row[0][0]+row[1][1]-row[2][2],0)),quaternion[2]=.5*Math.sqrt(Math.max(1-row[0][0]-row[1][1]+row[2][2],0)),quaternion[3]=.5*Math.sqrt(Math.max(1+row[0][0]+row[1][1]+row[2][2],0)),row[2][1]>row[1][2]&&(quaternion[0]=-quaternion[0]),row[0][2]>row[2][0]&&(quaternion[1]=-quaternion[1]),row[1][0]>row[0][1]&&(quaternion[2]=-quaternion[2]),!0}},{"./normalize":409,"gl-mat4/clone":247,"gl-mat4/create":248,"gl-mat4/determinant":249,"gl-mat4/invert":253,"gl-mat4/transpose":263,"gl-vec3/cross":315,"gl-vec3/dot":320,"gl-vec3/length":330,"gl-vec3/normalize":337}],409:[function(_dereq_,module,exports){module.exports=function normalize(out,mat){var m44=mat[15];if(0===m44)return!1;for(var scale=1/m44,i=0;i<16;i++)out[i]=mat[i]*scale;return!0}},{}],410:[function(_dereq_,module,exports){var lerp=_dereq_("gl-vec3/lerp"),recompose=_dereq_("mat4-recompose"),decompose=_dereq_("mat4-decompose"),determinant=_dereq_("gl-mat4/determinant"),slerp=_dereq_("quat-slerp"),state0=state(),state1=state(),tmp=state();function state(){return{translate:vec3(),scale:vec3(1),skew:vec3(),perspective:[0,0,0,1],quaternion:[0,0,0,1]}}function vec3(n){return[n||0,n||0,n||0]}module.exports=function interpolate(out,start,end,alpha){if(0===determinant(start)||0===determinant(end))return!1;var r0=decompose(start,state0.translate,state0.scale,state0.skew,state0.perspective,state0.quaternion),r1=decompose(end,state1.translate,state1.scale,state1.skew,state1.perspective,state1.quaternion);return!(!r0||!r1||(lerp(tmp.translate,state0.translate,state1.translate,alpha),lerp(tmp.skew,state0.skew,state1.skew,alpha),lerp(tmp.scale,state0.scale,state1.scale,alpha),lerp(tmp.perspective,state0.perspective,state1.perspective,alpha),slerp(tmp.quaternion,state0.quaternion,state1.quaternion,alpha),recompose(out,tmp.translate,tmp.scale,tmp.skew,tmp.perspective,tmp.quaternion),0))}},{"gl-mat4/determinant":249,"gl-vec3/lerp":331,"mat4-decompose":408,"mat4-recompose":411,"quat-slerp":463}],411:[function(_dereq_,module,exports){var mat4={identity:_dereq_("gl-mat4/identity"),translate:_dereq_("gl-mat4/translate"),multiply:_dereq_("gl-mat4/multiply"),create:_dereq_("gl-mat4/create"),scale:_dereq_("gl-mat4/scale"),fromRotationTranslation:_dereq_("gl-mat4/fromRotationTranslation")},temp=(mat4.create(),mat4.create());module.exports=function recomposeMat4(matrix,translation,scale,skew,perspective,quaternion){return mat4.identity(matrix),mat4.fromRotationTranslation(matrix,quaternion,translation),matrix[3]=perspective[0],matrix[7]=perspective[1],matrix[11]=perspective[2],matrix[15]=perspective[3],mat4.identity(temp),0!==skew[2]&&(temp[9]=skew[2],mat4.multiply(matrix,matrix,temp)),0!==skew[1]&&(temp[9]=0,temp[8]=skew[1],mat4.multiply(matrix,matrix,temp)),0!==skew[0]&&(temp[8]=0,temp[4]=skew[0],mat4.multiply(matrix,matrix,temp)),mat4.scale(matrix,matrix,scale),matrix}},{"gl-mat4/create":248,"gl-mat4/fromRotationTranslation":251,"gl-mat4/identity":252,"gl-mat4/multiply":255,"gl-mat4/scale":261,"gl-mat4/translate":262}],412:[function(_dereq_,module,exports){"use strict";module.exports=Math.log2||function(x){return Math.log(x)*Math.LOG2E}},{}],413:[function(_dereq_,module,exports){"use strict";var bsearch=_dereq_("binary-search-bounds"),m4interp=_dereq_("mat4-interpolate"),invert44=_dereq_("gl-mat4/invert"),rotateX=_dereq_("gl-mat4/rotateX"),rotateY=_dereq_("gl-mat4/rotateY"),rotateZ=_dereq_("gl-mat4/rotateZ"),lookAt=_dereq_("gl-mat4/lookAt"),translate=_dereq_("gl-mat4/translate"),normalize=(_dereq_("gl-mat4/scale"),_dereq_("gl-vec3/normalize")),DEFAULT_CENTER=[0,0,0];function MatrixCameraController(initialMatrix){this._components=initialMatrix.slice(),this._time=[0],this.prevMatrix=initialMatrix.slice(),this.nextMatrix=initialMatrix.slice(),this.computedMatrix=initialMatrix.slice(),this.computedInverse=initialMatrix.slice(),this.computedEye=[0,0,0],this.computedUp=[0,0,0],this.computedCenter=[0,0,0],this.computedRadius=[0],this._limits=[-1/0,1/0]}module.exports=function createMatrixCameraController(options){return new MatrixCameraController((options=options||{}).matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};var proto=MatrixCameraController.prototype;proto.recalcMatrix=function(t){var time=this._time,tidx=bsearch.le(time,t),mat=this.computedMatrix;if(!(tidx<0)){var comps=this._components;if(tidx===time.length-1)for(var ptr=16*tidx,i=0;i<16;++i)mat[i]=comps[ptr++];else{var dt=time[tidx+1]-time[tidx],prev=(ptr=16*tidx,this.prevMatrix),allEqual=!0;for(i=0;i<16;++i)prev[i]=comps[ptr++];var next=this.nextMatrix;for(i=0;i<16;++i)next[i]=comps[ptr++],allEqual=allEqual&&prev[i]===next[i];if(dt<1e-6||allEqual)for(i=0;i<16;++i)mat[i]=prev[i];else m4interp(mat,prev,next,(t-time[tidx])/dt)}var up=this.computedUp;up[0]=mat[1],up[1]=mat[5],up[2]=mat[9],normalize(up,up);var imat=this.computedInverse;invert44(imat,mat);var eye=this.computedEye,w=imat[15];eye[0]=imat[12]/w,eye[1]=imat[13]/w,eye[2]=imat[14]/w;var center=this.computedCenter,radius=Math.exp(this.computedRadius[0]);for(i=0;i<3;++i)center[i]=eye[i]-mat[2+4*i]*radius}},proto.idle=function(t){if(!(t<this.lastT())){for(var mc=this._components,ptr=mc.length-16,i=0;i<16;++i)mc.push(mc[ptr++]);this._time.push(t)}},proto.flush=function(t){var idx=bsearch.gt(this._time,t)-2;idx<0||(this._time.splice(0,idx),this._components.splice(0,16*idx))},proto.lastT=function(){return this._time[this._time.length-1]},proto.lookAt=function(t,eye,center,up){this.recalcMatrix(t),eye=eye||this.computedEye,center=center||DEFAULT_CENTER,up=up||this.computedUp,this.setMatrix(t,lookAt(this.computedMatrix,eye,center,up));for(var d2=0,i=0;i<3;++i)d2+=Math.pow(center[i]-eye[i],2);d2=Math.log(Math.sqrt(d2)),this.computedRadius[0]=d2},proto.rotate=function(t,yaw,pitch,roll){this.recalcMatrix(t);var mat=this.computedInverse;yaw&&rotateY(mat,mat,yaw),pitch&&rotateX(mat,mat,pitch),roll&&rotateZ(mat,mat,roll),this.setMatrix(t,invert44(this.computedMatrix,mat))};var tvec=[0,0,0];proto.pan=function(t,dx,dy,dz){tvec[0]=-(dx||0),tvec[1]=-(dy||0),tvec[2]=-(dz||0),this.recalcMatrix(t);var mat=this.computedInverse;translate(mat,mat,tvec),this.setMatrix(t,invert44(mat,mat))},proto.translate=function(t,dx,dy,dz){tvec[0]=dx||0,tvec[1]=dy||0,tvec[2]=dz||0,this.recalcMatrix(t);var mat=this.computedMatrix;translate(mat,mat,tvec),this.setMatrix(t,mat)},proto.setMatrix=function(t,mat){if(!(t<this.lastT())){this._time.push(t);for(var i=0;i<16;++i)this._components.push(mat[i])}},proto.setDistance=function(t,d){this.computedRadius[0]=d},proto.setDistanceLimits=function(a,b){var lim=this._limits;lim[0]=a,lim[1]=b},proto.getDistanceLimits=function(out){var lim=this._limits;return out?(out[0]=lim[0],out[1]=lim[1],out):lim}},{"binary-search-bounds":78,"gl-mat4/invert":253,"gl-mat4/lookAt":254,"gl-mat4/rotateX":258,"gl-mat4/rotateY":259,"gl-mat4/rotateZ":260,"gl-mat4/scale":261,"gl-mat4/translate":262,"gl-vec3/normalize":337,"mat4-interpolate":410}],414:[function(_dereq_,module,exports){"use strict";module.exports=function monotoneConvexHull2D(points){var n=points.length;if(n<3){for(var result=new Array(n),i=0;i<n;++i)result[i]=i;return 2===n&&points[0][0]===points[1][0]&&points[0][1]===points[1][1]?[0]:result}for(var sorted=new Array(n),i=0;i<n;++i)sorted[i]=i;sorted.sort(function(a,b){var d=points[a][0]-points[b][0];return d||points[a][1]-points[b][1]});for(var lower=[sorted[0],sorted[1]],upper=[sorted[0],sorted[1]],i=2;i<n;++i){for(var idx=sorted[i],p=points[idx],m=lower.length;m>1&&orient(points[lower[m-2]],points[lower[m-1]],p)<=0;)m-=1,lower.pop();for(lower.push(idx),m=upper.length;m>1&&orient(points[upper[m-2]],points[upper[m-1]],p)>=0;)m-=1,upper.pop();upper.push(idx)}for(var result=new Array(upper.length+lower.length-2),ptr=0,i=0,nl=lower.length;i<nl;++i)result[ptr++]=lower[i];for(var j=upper.length-2;j>0;--j)result[ptr++]=upper[j];return result};var orient=_dereq_("robust-orientation")[3]},{"robust-orientation":483}],415:[function(_dereq_,module,exports){"use strict";module.exports=function mouseListen(element,callback){callback||(callback=element,element=window);var buttonState=0,x=0,y=0,mods={shift:!1,alt:!1,control:!1,meta:!1},attached=!1;function updateMods(ev){var changed=!1;return"altKey"in ev&&(changed=changed||ev.altKey!==mods.alt,mods.alt=!!ev.altKey),"shiftKey"in ev&&(changed=changed||ev.shiftKey!==mods.shift,mods.shift=!!ev.shiftKey),"ctrlKey"in ev&&(changed=changed||ev.ctrlKey!==mods.control,mods.control=!!ev.ctrlKey),"metaKey"in ev&&(changed=changed||ev.metaKey!==mods.meta,mods.meta=!!ev.metaKey),changed}function handleEvent(nextButtons,ev){var nextX=mouse.x(ev),nextY=mouse.y(ev);"buttons"in ev&&(nextButtons=0|ev.buttons),(nextButtons!==buttonState||nextX!==x||nextY!==y||updateMods(ev))&&(buttonState=0|nextButtons,x=nextX||0,y=nextY||0,callback&&callback(buttonState,x,y,mods))}function clearState(ev){handleEvent(0,ev)}function handleBlur(){(buttonState||x||y||mods.shift||mods.alt||mods.meta||mods.control)&&(x=y=0,buttonState=0,mods.shift=mods.alt=mods.control=mods.meta=!1,callback&&callback(0,0,0,mods))}function handleMods(ev){updateMods(ev)&&callback&&callback(buttonState,x,y,mods)}function handleMouseMove(ev){0===mouse.buttons(ev)?handleEvent(0,ev):handleEvent(buttonState,ev)}function handleMouseDown(ev){handleEvent(buttonState|mouse.buttons(ev),ev)}function handleMouseUp(ev){handleEvent(buttonState&~mouse.buttons(ev),ev)}function attachListeners(){attached||(attached=!0,element.addEventListener("mousemove",handleMouseMove),element.addEventListener("mousedown",handleMouseDown),element.addEventListener("mouseup",handleMouseUp),element.addEventListener("mouseleave",clearState),element.addEventListener("mouseenter",clearState),element.addEventListener("mouseout",clearState),element.addEventListener("mouseover",clearState),element.addEventListener("blur",handleBlur),element.addEventListener("keyup",handleMods),element.addEventListener("keydown",handleMods),element.addEventListener("keypress",handleMods),element!==window&&(window.addEventListener("blur",handleBlur),window.addEventListener("keyup",handleMods),window.addEventListener("keydown",handleMods),window.addEventListener("keypress",handleMods)))}attachListeners();var result={element:element};return Object.defineProperties(result,{enabled:{get:function(){return attached},set:function(f){f?attachListeners():function detachListeners(){attached&&(attached=!1,element.removeEventListener("mousemove",handleMouseMove),element.removeEventListener("mousedown",handleMouseDown),element.removeEventListener("mouseup",handleMouseUp),element.removeEventListener("mouseleave",clearState),element.removeEventListener("mouseenter",clearState),element.removeEventListener("mouseout",clearState),element.removeEventListener("mouseover",clearState),element.removeEventListener("blur",handleBlur),element.removeEventListener("keyup",handleMods),element.removeEventListener("keydown",handleMods),element.removeEventListener("keypress",handleMods),element!==window&&(window.removeEventListener("blur",handleBlur),window.removeEventListener("keyup",handleMods),window.removeEventListener("keydown",handleMods),window.removeEventListener("keypress",handleMods)))}()},enumerable:!0},buttons:{get:function(){return buttonState},enumerable:!0},x:{get:function(){return x},enumerable:!0},y:{get:function(){return y},enumerable:!0},mods:{get:function(){return mods},enumerable:!0}}),result};var mouse=_dereq_("mouse-event")},{"mouse-event":417}],416:[function(_dereq_,module,exports){var rootPosition={left:0,top:0};module.exports=function mouseEventOffset(ev,target,out){target=target||ev.currentTarget||ev.srcElement,Array.isArray(out)||(out=[0,0]);var cx=ev.clientX||0,cy=ev.clientY||0,rect=function getBoundingClientOffset(element){return element===window||element===document||element===document.body?rootPosition:element.getBoundingClientRect()}(target);return out[0]=cx-rect.left,out[1]=cy-rect.top,out}},{}],417:[function(_dereq_,module,exports){"use strict";function mouseElement(ev){return ev.target||ev.srcElement||window}exports.buttons=function mouseButtons(ev){if("object"==typeof ev){if("buttons"in ev)return ev.buttons;if("which"in ev){if(2===(b=ev.which))return 4;if(3===b)return 2;if(b>0)return 1<<b-1}else if("button"in ev){var b;if(1===(b=ev.button))return 4;if(2===b)return 2;if(b>=0)return 1<<b}}return 0},exports.element=mouseElement,exports.x=function mouseRelativeX(ev){if("object"==typeof ev){if("offsetX"in ev)return ev.offsetX;var bounds=mouseElement(ev).getBoundingClientRect();return ev.clientX-bounds.left}return 0},exports.y=function mouseRelativeY(ev){if("object"==typeof ev){if("offsetY"in ev)return ev.offsetY;var bounds=mouseElement(ev).getBoundingClientRect();return ev.clientY-bounds.top}return 0}},{}],418:[function(_dereq_,module,exports){"use strict";var toPX=_dereq_("to-px");module.exports=function mouseWheelListen(element,callback,noScroll){"function"==typeof element&&(noScroll=!!callback,callback=element,element=window);var lineHeight=toPX("ex",element),listener=function(ev){noScroll&&ev.preventDefault();var dx=ev.deltaX||0,dy=ev.deltaY||0,dz=ev.deltaZ||0,mode=ev.deltaMode,scale=1;switch(mode){case 1:scale=lineHeight;break;case 2:scale=window.innerHeight}if(dy*=scale,dz*=scale,(dx*=scale)||dy||dz)return callback(dx,dy,dz,ev)};return element.addEventListener("wheel",listener),listener}},{"to-px":513}],419:[function(_dereq_,module,exports){"use strict";var pool=_dereq_("typedarray-pool");function array(i){return"a"+i}function data(i){return"d"+i}function cube(i,bitmask){return"c"+i+"_"+bitmask}function shape(i){return"s"+i}function stride(i,j){return"t"+i+"_"+j}function offset(i){return"o"+i}function scalar(i){return"x"+i}function pointer(i){return"p"+i}function delta(i,bitmask){return"d"+i+"_"+bitmask}function index(i){return"i"+i}function step(i,j){return"u"+i+"_"+j}function pcube(bitmask){return"b"+bitmask}function qcube(bitmask){return"y"+bitmask}function pdelta(bitmask){return"e"+bitmask}function vert(i){return"v"+i}module.exports=function createSurfaceExtractor(args){function error(msg){throw new Error("ndarray-extract-contour: "+msg)}"object"!=typeof args&&error("Must specify arguments");var order=args.order;Array.isArray(order)||error("Must specify order");var arrays=args.arrayArguments||1;arrays<1&&error("Must have at least one array argument");var scalars=args.scalarArguments||0;scalars<0&&error("Scalar arg count must be > 0");"function"!=typeof args.vertex&&error("Must specify vertex creation function");"function"!=typeof args.cell&&error("Must specify cell creation function");"function"!=typeof args.phase&&error("Must specify phase function");for(var getters=args.getters||[],typesig=new Array(arrays),i=0;i<arrays;++i)getters.indexOf(i)>=0?typesig[i]=!0:typesig[i]=!1;return function compileSurfaceProcedure(vertexFunc,faceFunc,phaseFunc,scalarArgs,order,typesig){var arrayArgs=typesig.length,dimension=order.length;if(dimension<2)throw new Error("ndarray-extract-contour: Dimension must be at least 2");for(var funcName="extractContour"+order.join("_"),code=[],vars=[],args=[],i=0;i<arrayArgs;++i)args.push(array(i));for(var i=0;i<scalarArgs;++i)args.push(scalar(i));for(var i=0;i<dimension;++i)vars.push(shape(i)+"="+array(0)+".shape["+i+"]|0");for(var i=0;i<arrayArgs;++i){vars.push(data(i)+"="+array(i)+".data",offset(i)+"="+array(i)+".offset|0");for(var j=0;j<dimension;++j)vars.push(stride(i,j)+"="+array(i)+".stride["+j+"]|0")}for(var i=0;i<arrayArgs;++i){vars.push(pointer(i)+"="+offset(i)),vars.push(cube(i,0));for(var j=1;j<1<<dimension;++j){for(var ptrStr=[],k=0;k<dimension;++k)j&1<<k&&ptrStr.push("-"+stride(i,k));vars.push(delta(i,j)+"=("+ptrStr.join("")+")|0"),vars.push(cube(i,j)+"=0")}}for(var i=0;i<arrayArgs;++i)for(var j=0;j<dimension;++j){var stepVal=[stride(i,order[j])];j>0&&stepVal.push(stride(i,order[j-1])+"*"+shape(order[j-1])),vars.push(step(i,order[j])+"=("+stepVal.join("-")+")|0")}for(var i=0;i<dimension;++i)vars.push(index(i)+"=0");vars.push(VERTEX_COUNT+"=0");for(var sizeVariable=["2"],i=dimension-2;i>=0;--i)sizeVariable.push(shape(order[i]));vars.push(POOL_SIZE+"=("+sizeVariable.join("*")+")|0",PHASES+"=mallocUint32("+POOL_SIZE+")",VERTEX_IDS+"=mallocUint32("+POOL_SIZE+")",POINTER+"=0"),vars.push(pcube(0)+"=0");for(var j=1;j<1<<dimension;++j){for(var cubeDelta=[],cubeStep=[],k=0;k<dimension;++k)j&1<<k&&(0===cubeStep.length?cubeDelta.push("1"):cubeDelta.unshift(cubeStep.join("*"))),cubeStep.push(shape(order[k]));var signFlag="";cubeDelta[0].indexOf(shape(order[dimension-2]))<0&&(signFlag="-");var jperm=permBitmask(dimension,j,order);vars.push(pdelta(jperm)+"=(-"+cubeDelta.join("-")+")|0",qcube(jperm)+"=("+signFlag+cubeDelta.join("-")+")|0",pcube(jperm)+"=0")}function forLoopBegin(i,start){code.push("for(",index(order[i]),"=",start,";",index(order[i]),"<",shape(order[i]),";","++",index(order[i]),"){")}function forLoopEnd(i){for(var j=0;j<arrayArgs;++j)code.push(pointer(j),"+=",step(j,order[i]),";");code.push("}")}function flip(){for(var j=1;j<1<<dimension;++j)code.push(TEMPORARY,"=",pdelta(j),";",pdelta(j),"=",qcube(j),";",qcube(j),"=",TEMPORARY,";")}vars.push(vert(0)+"=0",TEMPORARY+"=0"),function createLoop(i,mask){if(i<0)return void function processGridCell(mask){for(var i=0;i<arrayArgs;++i)typesig[i]?code.push(cube(i,0),"=",data(i),".get(",pointer(i),");"):code.push(cube(i,0),"=",data(i),"[",pointer(i),"];");for(var phaseFuncArgs=[],i=0;i<arrayArgs;++i)phaseFuncArgs.push(cube(i,0));for(var i=0;i<scalarArgs;++i)phaseFuncArgs.push(scalar(i));code.push(pcube(0),"=",PHASES,"[",POINTER,"]=phase(",phaseFuncArgs.join(),");");for(var j=1;j<1<<dimension;++j)code.push(pcube(j),"=",PHASES,"[",POINTER,"+",pdelta(j),"];");for(var vertexPredicate=[],j=1;j<1<<dimension;++j)vertexPredicate.push("("+pcube(0)+"!=="+pcube(j)+")");code.push("if(",vertexPredicate.join("||"),"){");for(var vertexArgs=[],i=0;i<dimension;++i)vertexArgs.push(index(i));for(var i=0;i<arrayArgs;++i){vertexArgs.push(cube(i,0));for(var j=1;j<1<<dimension;++j)typesig[i]?code.push(cube(i,j),"=",data(i),".get(",pointer(i),"+",delta(i,j),");"):code.push(cube(i,j),"=",data(i),"[",pointer(i),"+",delta(i,j),"];"),vertexArgs.push(cube(i,j))}for(var i=0;i<1<<dimension;++i)vertexArgs.push(pcube(i));for(var i=0;i<scalarArgs;++i)vertexArgs.push(scalar(i));code.push("vertex(",vertexArgs.join(),");",vert(0),"=",VERTEX_IDS,"[",POINTER,"]=",VERTEX_COUNT,"++;");for(var base=(1<<dimension)-1,corner=pcube(base),j=0;j<dimension;++j)if(0==(mask&~(1<<j))){for(var subset=base^1<<j,edge=pcube(subset),faceArgs=[],k=subset;k>0;k=k-1&subset)faceArgs.push(VERTEX_IDS+"["+POINTER+"+"+pdelta(k)+"]");faceArgs.push(vert(0));for(var k=0;k<arrayArgs;++k)1&j?faceArgs.push(cube(k,base),cube(k,subset)):faceArgs.push(cube(k,subset),cube(k,base));1&j?faceArgs.push(corner,edge):faceArgs.push(edge,corner);for(var k=0;k<scalarArgs;++k)faceArgs.push(scalar(k));code.push("if(",corner,"!==",edge,"){","face(",faceArgs.join(),")}")}code.push("}",POINTER,"+=1;")}(mask);!function fillEmptySlice(k){for(var i=k-1;i>=0;--i)forLoopBegin(i,0);for(var phaseFuncArgs=[],i=0;i<arrayArgs;++i)typesig[i]?phaseFuncArgs.push(data(i)+".get("+pointer(i)+")"):phaseFuncArgs.push(data(i)+"["+pointer(i)+"]");for(var i=0;i<scalarArgs;++i)phaseFuncArgs.push(scalar(i));code.push(PHASES,"[",POINTER,"++]=phase(",phaseFuncArgs.join(),");");for(var i=0;i<k;++i)forLoopEnd(i);for(var j=0;j<arrayArgs;++j)code.push(pointer(j),"+=",step(j,order[k]),";")}(i);code.push("if(",shape(order[i]),">0){",index(order[i]),"=1;");createLoop(i-1,mask|1<<order[i]);for(var j=0;j<arrayArgs;++j)code.push(pointer(j),"+=",step(j,order[i]),";");i===dimension-1&&(code.push(POINTER,"=0;"),flip());forLoopBegin(i,2);createLoop(i-1,mask);i===dimension-1&&(code.push("if(",index(order[dimension-1]),"&1){",POINTER,"=0;}"),flip());forLoopEnd(i);code.push("}")}(dimension-1,0),code.push("freeUint32(",VERTEX_IDS,");freeUint32(",PHASES,");");var procedureCode=["'use strict';","function ",funcName,"(",args.join(),"){","var ",vars.join(),";",code.join(""),"}","return ",funcName].join("");return new Function("vertex","face","phase","mallocUint32","freeUint32",procedureCode)(vertexFunc,faceFunc,phaseFunc,pool.mallocUint32,pool.freeUint32)}(args.vertex,args.cell,args.phase,scalars,order,typesig)};var VERTEX_IDS="V",PHASES="P",VERTEX_COUNT="N",POOL_SIZE="Q",POINTER="X",TEMPORARY="T";function permBitmask(dimension,mask,order){for(var r=0,i=0;i<dimension;++i)mask&1<<i&&(r|=1<<order[i]);return r}},{"typedarray-pool":519}],420:[function(_dereq_,module,exports){"use strict";var fill=_dereq_("cwise/lib/wrapper")({args:["index","array","scalar"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{_inline_1_arg1_=_inline_1_arg2_.apply(void 0,_inline_1_arg0_)}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg1_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:[],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"cwise",blockSize:64});module.exports=function(array,f){return fill(array,f),array}},{"cwise/lib/wrapper":136}],421:[function(_dereq_,module,exports){"use strict";module.exports=function gradient(out,inp,bc){if(Array.isArray(bc)){if(bc.length!==inp.dimension)throw new Error("ndarray-gradient: invalid boundary conditions")}else bc=dup(inp.dimension,"string"==typeof bc?bc:"clamp");if(out.dimension!==inp.dimension+1)throw new Error("ndarray-gradient: output dimension must be +1 input dimension");if(out.shape[inp.dimension]!==inp.dimension)throw new Error("ndarray-gradient: output shape must match input shape");for(var i=0;i<inp.dimension;++i)if(out.shape[i]!==inp.shape[i])throw new Error("ndarray-gradient: shape mismatch");if(0===inp.size)return out;if(inp.dimension<=0)return out.set(0),out;return function generateGradient(boundaryConditions){var token=boundaryConditions.join();if(proc=GRADIENT_CACHE[token])return proc;var d=boundaryConditions.length,code=["function gradient(dst,src){var s=src.shape.slice();"];function handleBoundary(facet){for(var cod=d-facet.length,loStr=[],hiStr=[],pickStr=[],i=0;i<d;++i)facet.indexOf(i+1)>=0?pickStr.push("0"):facet.indexOf(-(i+1))>=0?pickStr.push("s["+i+"]-1"):(pickStr.push("-1"),loStr.push("1"),hiStr.push("s["+i+"]-2"));var boundStr=".lo("+loStr.join()+").hi("+hiStr.join()+")";if(0===loStr.length&&(boundStr=""),cod>0){code.push("if(1");for(var i=0;i<d;++i)facet.indexOf(i+1)>=0||facet.indexOf(-(i+1))>=0||code.push("&&s[",i,"]>2");code.push("){grad",cod,"(src.pick(",pickStr.join(),")",boundStr);for(var i=0;i<d;++i)facet.indexOf(i+1)>=0||facet.indexOf(-(i+1))>=0||code.push(",dst.pick(",pickStr.join(),",",i,")",boundStr);code.push(");")}for(var i=0;i<facet.length;++i){var bnd=Math.abs(facet[i])-1,outStr="dst.pick("+pickStr.join()+","+bnd+")"+boundStr;switch(boundaryConditions[bnd]){case"clamp":var cPickStr=pickStr.slice(),dPickStr=pickStr.slice();facet[i]<0?cPickStr[bnd]="s["+bnd+"]-2":dPickStr[bnd]="1",0===cod?code.push("if(s[",bnd,"]>1){dst.set(",pickStr.join(),",",bnd,",0.5*(src.get(",cPickStr.join(),")-src.get(",dPickStr.join(),")))}else{dst.set(",pickStr.join(),",",bnd,",0)};"):code.push("if(s[",bnd,"]>1){diff(",outStr,",src.pick(",cPickStr.join(),")",boundStr,",src.pick(",dPickStr.join(),")",boundStr,");}else{zero(",outStr,");};");break;case"mirror":0===cod?code.push("dst.set(",pickStr.join(),",",bnd,",0);"):code.push("zero(",outStr,");");break;case"wrap":var aPickStr=pickStr.slice(),bPickStr=pickStr.slice();facet[i]<0?(aPickStr[bnd]="s["+bnd+"]-2",bPickStr[bnd]="0"):(aPickStr[bnd]="s["+bnd+"]-1",bPickStr[bnd]="1"),0===cod?code.push("if(s[",bnd,"]>2){dst.set(",pickStr.join(),",",bnd,",0.5*(src.get(",aPickStr.join(),")-src.get(",bPickStr.join(),")))}else{dst.set(",pickStr.join(),",",bnd,",0)};"):code.push("if(s[",bnd,"]>2){diff(",outStr,",src.pick(",aPickStr.join(),")",boundStr,",src.pick(",bPickStr.join(),")",boundStr,");}else{zero(",outStr,");};");break;default:throw new Error("ndarray-gradient: Invalid boundary condition")}}cod>0&&code.push("};")}for(var i=0;i<1<<d;++i){for(var faces=[],j=0;j<d;++j)i&1<<j&&faces.push(j+1);for(var k=0;k<1<<faces.length;++k){for(var sfaces=faces.slice(),j=0;j<faces.length;++j)k&1<<j&&(sfaces[j]=-sfaces[j]);handleBoundary(sfaces)}}code.push("return dst;};return gradient");for(var linkNames=["diff","zero"],linkArgs=[centralDiff,zeroOut],i=1;i<=d;++i)linkNames.push("grad"+i),linkArgs.push(generateTemplate(i));linkNames.push(code.join(""));var proc=Function.apply(void 0,linkNames).apply(void 0,linkArgs);return TEMPLATE_CACHE[token]=proc,proc}(bc)(out,inp)};var dup=_dereq_("dup"),cwiseCompiler=_dereq_("cwise-compiler"),TEMPLATE_CACHE={},GRADIENT_CACHE={},EmptyProc={body:"",args:[],thisVars:[],localVars:[]},centralDiff=cwiseCompiler({args:["array","array","array"],pre:EmptyProc,post:EmptyProc,body:{args:[{name:"out",lvalue:!0,rvalue:!1,count:1},{name:"left",lvalue:!1,rvalue:!0,count:1},{name:"right",lvalue:!1,rvalue:!0,count:1}],body:"out=0.5*(left-right)",thisVars:[],localVars:[]},funcName:"cdiff"}),zeroOut=cwiseCompiler({args:["array"],pre:EmptyProc,post:EmptyProc,body:{args:[{name:"out",lvalue:!0,rvalue:!1,count:1}],body:"out=0",thisVars:[],localVars:[]},funcName:"zero"});function generateTemplate(d){if(d in TEMPLATE_CACHE)return TEMPLATE_CACHE[d];for(var code=[],i=0;i<d;++i)code.push("out",i,"s=0.5*(inp",i,"l-inp",i,"r);");var args=["array"],names=["junk"];for(i=0;i<d;++i){args.push("array"),names.push("out"+i+"s");var o=dup(d);o[i]=-1,args.push({array:0,offset:o.slice()}),o[i]=1,args.push({array:0,offset:o.slice()}),names.push("inp"+i+"l","inp"+i+"r")}return TEMPLATE_CACHE[d]=cwiseCompiler({args:args,pre:EmptyProc,post:EmptyProc,body:{body:code.join(""),args:names.map(function(n){return{name:n,lvalue:0===n.indexOf("out"),rvalue:0===n.indexOf("inp"),count:"junk"!==n|0}}),thisVars:[],localVars:[]},funcName:"fdTemplate"+d})}},{"cwise-compiler":133,dup:154}],422:[function(_dereq_,module,exports){"use strict";var warp=_dereq_("ndarray-warp"),invert=_dereq_("gl-matrix-invert");module.exports=function applyHomography(dest,src,Xi){var n=src.dimension,X=invert([],Xi);return warp(dest,src,function(out_c,inp_c){for(var i=0;i<n;++i){out_c[i]=X[(n+1)*n+i];for(var j=0;j<n;++j)out_c[i]+=X[(n+1)*j+i]*inp_c[j]}var w=X[(n+1)*(n+1)-1];for(j=0;j<n;++j)w+=X[(n+1)*j+n]*inp_c[j];var wr=1/w;for(i=0;i<n;++i)out_c[i]*=wr;return out_c}),dest}},{"gl-matrix-invert":264,"ndarray-warp":429}],423:[function(_dereq_,module,exports){"use strict";function interp1d(arr,x){var ix=Math.floor(x),fx=x-ix,s0=0<=ix&&ix<arr.shape[0],s1=0<=ix+1&&ix+1<arr.shape[0];return(1-fx)*(s0?+arr.get(ix):0)+fx*(s1?+arr.get(ix+1):0)}function interp2d(arr,x,y){var ix=Math.floor(x),fx=x-ix,s0=0<=ix&&ix<arr.shape[0],s1=0<=ix+1&&ix+1<arr.shape[0],iy=Math.floor(y),fy=y-iy,t0=0<=iy&&iy<arr.shape[1],t1=0<=iy+1&&iy+1<arr.shape[1],w00=s0&&t0?arr.get(ix,iy):0,w01=s0&&t1?arr.get(ix,iy+1):0;return(1-fy)*((1-fx)*w00+fx*(s1&&t0?arr.get(ix+1,iy):0))+fy*((1-fx)*w01+fx*(s1&&t1?arr.get(ix+1,iy+1):0))}function interp3d(arr,x,y,z){var ix=Math.floor(x),fx=x-ix,s0=0<=ix&&ix<arr.shape[0],s1=0<=ix+1&&ix+1<arr.shape[0],iy=Math.floor(y),fy=y-iy,t0=0<=iy&&iy<arr.shape[1],t1=0<=iy+1&&iy+1<arr.shape[1],iz=Math.floor(z),fz=z-iz,u0=0<=iz&&iz<arr.shape[2],u1=0<=iz+1&&iz+1<arr.shape[2],w000=s0&&t0&&u0?arr.get(ix,iy,iz):0,w010=s0&&t1&&u0?arr.get(ix,iy+1,iz):0,w100=s1&&t0&&u0?arr.get(ix+1,iy,iz):0,w110=s1&&t1&&u0?arr.get(ix+1,iy+1,iz):0,w001=s0&&t0&&u1?arr.get(ix,iy,iz+1):0,w011=s0&&t1&&u1?arr.get(ix,iy+1,iz+1):0;return(1-fz)*((1-fy)*((1-fx)*w000+fx*w100)+fy*((1-fx)*w010+fx*w110))+fz*((1-fy)*((1-fx)*w001+fx*(s1&&t0&&u1?arr.get(ix+1,iy,iz+1):0))+fy*((1-fx)*w011+fx*(s1&&t1&&u1?arr.get(ix+1,iy+1,iz+1):0)))}module.exports=function interpolate(arr,x,y,z){switch(arr.shape.length){case 0:return 0;case 1:return interp1d(arr,x);case 2:return interp2d(arr,x,y);case 3:return interp3d(arr,x,y,z);default:return function interpNd(arr){var i,t,d=0|arr.shape.length,ix=new Array(d),fx=new Array(d),s0=new Array(d),s1=new Array(d);for(i=0;i<d;++i)t=+arguments[i+1],ix[i]=Math.floor(t),fx[i]=t-ix[i],s0[i]=0<=ix[i]&&ix[i]<arr.shape[i],s1[i]=0<=ix[i]+1&&ix[i]+1<arr.shape[i];var j,w,idx,r=0;i_loop:for(i=0;i<1<<d;++i){for(w=1,idx=arr.offset,j=0;j<d;++j)if(i&1<<j){if(!s1[j])continue i_loop;w*=fx[j],idx+=arr.stride[j]*(ix[j]+1)}else{if(!s0[j])continue i_loop;w*=1-fx[j],idx+=arr.stride[j]*ix[j]}r+=w*arr.data[idx]}return r}.apply(void 0,arguments)}},module.exports.d1=interp1d,module.exports.d2=interp2d,module.exports.d3=interp3d},{}],424:[function(_dereq_,module,exports){"use strict";var compile=_dereq_("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]};function fixup(x){if(!x)return EmptyProc;for(var i=0;i<x.args.length;++i){var a=x.args[i];x.args[i]=0===i?{name:a,lvalue:!0,rvalue:!!x.rvalue,count:x.count||1}:{name:a,lvalue:!1,rvalue:!0,count:1}}return x.thisVars||(x.thisVars=[]),x.localVars||(x.localVars=[]),x}function makeOp(user_args){for(var args=[],i=0;i<user_args.args.length;++i)args.push("a"+i);return new Function("P",["return function ",user_args.funcName,"_ndarrayops(",args.join(","),") {P(",args.join(","),");return a0}"].join(""))(function pcompile(user_args){return compile({args:user_args.args,pre:fixup(user_args.pre),body:fixup(user_args.body),post:fixup(user_args.proc),funcName:user_args.funcName})}(user_args))}var assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var id in assign_ops){var op=assign_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id}),exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+op+"=b"},rvalue:!0,funcName:id+"eq"}),exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"}),exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+op+"=s"},rvalue:!0,funcName:id+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var id in unary_ops){var op=unary_ops[id];exports[id]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+op+"b"},funcName:id}),exports[id+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+op+"a"},rvalue:!0,count:2,funcName:id+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var id in binary_ops){var op=binary_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id}),exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"}),exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+op+"b"},rvalue:!0,count:2,funcName:id+"eq"}),exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+op+"s"},rvalue:!0,count:2,funcName:id+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var i=0;i<math_unary.length;++i){var f=math_unary[i];exports[f]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:f}),exports[f+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:f+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var i=0;i<math_comm.length;++i){var f=math_comm[i];exports[f]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f}),exports[f+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f+"s"}),exports[f+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:f+"eq"}),exports[f+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:f+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var i=0;i<math_noncomm.length;++i){var f=math_noncomm[i];exports[f+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"op"}),exports[f+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"ops"}),exports[f+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:f+"opeq"}),exports[f+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:f+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":133}],425:[function(_dereq_,module,exports){"use strict";var ndarray=_dereq_("ndarray"),do_convert=_dereq_("./doConvert.js");module.exports=function convert(arr,result){for(var shape=[],c=arr,sz=1;Array.isArray(c);)shape.push(c.length),sz*=c.length,c=c[0];return 0===shape.length?ndarray():(result||(result=ndarray(new Float64Array(sz),shape)),do_convert(result,arr),result)}},{"./doConvert.js":426,ndarray:430}],426:[function(_dereq_,module,exports){module.exports=_dereq_("cwise-compiler")({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64})},{"cwise-compiler":133}],427:[function(_dereq_,module,exports){"use strict";var pool=_dereq_("typedarray-pool"),INSERTION_SORT_THRESHOLD=32;function getMallocFree(dtype){switch(dtype){case"uint8":return[pool.mallocUint8,pool.freeUint8];case"uint16":return[pool.mallocUint16,pool.freeUint16];case"uint32":return[pool.mallocUint32,pool.freeUint32];case"int8":return[pool.mallocInt8,pool.freeInt8];case"int16":return[pool.mallocInt16,pool.freeInt16];case"int32":return[pool.mallocInt32,pool.freeInt32];case"float32":return[pool.mallocFloat,pool.freeFloat];case"float64":return[pool.mallocDouble,pool.freeDouble];default:return null}}function shapeArgs(dimension){for(var args=[],i=0;i<dimension;++i)args.push("s"+i);for(i=0;i<dimension;++i)args.push("n"+i);for(i=1;i<dimension;++i)args.push("d"+i);for(i=1;i<dimension;++i)args.push("e"+i);for(i=1;i<dimension;++i)args.push("f"+i);return args}module.exports=function compileSort(order,dtype){var code=["'use strict'"],funcName=["ndarraySortWrapper",order.join("d"),dtype].join("");code.push(["function ",funcName,"(",["array"].join(","),"){"].join(""));for(var vars=["data=array.data,offset=array.offset|0,shape=array.shape,stride=array.stride"],i=0;i<order.length;++i)vars.push(["s",i,"=stride[",i,"]|0,n",i,"=shape[",i,"]|0"].join(""));var scratch_stride=new Array(order.length),nprod=[];for(i=0;i<order.length;++i)0!==(k=order[i])&&(0===nprod.length?scratch_stride[k]="1":scratch_stride[k]=nprod.join("*"),nprod.push("n"+k));var p=-1,q=-1;for(i=0;i<order.length;++i){var k,j=order[i];0!==j&&(p>0?vars.push(["d",j,"=s",j,"-d",p,"*n",p].join("")):vars.push(["d",j,"=s",j].join("")),p=j),0!=(k=order.length-1-i)&&(q>0?vars.push(["e",k,"=s",k,"-e",q,"*n",q,",f",k,"=",scratch_stride[k],"-f",q,"*n",q].join("")):vars.push(["e",k,"=s",k,",f",k,"=",scratch_stride[k]].join("")),q=k)}code.push("var "+vars.join(","));var sortArgs=["0","n0-1","data","offset"].concat(shapeArgs(order.length));code.push(["if(n0<=",INSERTION_SORT_THRESHOLD,"){","insertionSort(",sortArgs.join(","),")}else{","quickSort(",sortArgs.join(","),")}"].join("")),code.push("}return "+funcName);var result=new Function("insertionSort","quickSort",code.join("\n")),insertionSort=function createInsertionSort(order,dtype){var code=["'use strict'"],funcName=["ndarrayInsertionSort",order.join("d"),dtype].join(""),funcArgs=["left","right","data","offset"].concat(shapeArgs(order.length)),allocator=getMallocFree(dtype),vars=["i,j,cptr,ptr=left*s0+offset"];if(order.length>1){for(var scratch_shape=[],i=1;i<order.length;++i)vars.push("i"+i),scratch_shape.push("n"+i);allocator?vars.push("scratch=malloc("+scratch_shape.join("*")+")"):vars.push("scratch=new Array("+scratch_shape.join("*")+")"),vars.push("dptr","sptr","a","b")}else vars.push("scratch");function dataRead(ptr){return"generic"===dtype?["data.get(",ptr,")"].join(""):["data[",ptr,"]"].join("")}function dataWrite(ptr,v){return"generic"===dtype?["data.set(",ptr,",",v,")"].join(""):["data[",ptr,"]=",v].join("")}if(code.push(["function ",funcName,"(",funcArgs.join(","),"){var ",vars.join(",")].join(""),"for(i=left+1;i<=right;++i){","j=i;ptr+=s0","cptr=ptr"),order.length>1){for(code.push("dptr=0;sptr=ptr"),i=order.length-1;i>=0;--i)0!==(j=order[i])&&code.push(["for(i",j,"=0;i",j,"<n",j,";++i",j,"){"].join(""));for(code.push("scratch[dptr++]=",dataRead("sptr")),i=0;i<order.length;++i)0!==(j=order[i])&&code.push("sptr+=d"+j,"}");for(code.push("__g:while(j--\x3eleft){","dptr=0","sptr=cptr-s0"),i=1;i<order.length;++i)1===i&&code.push("__l:"),code.push(["for(i",i,"=0;i",i,"<n",i,";++i",i,"){"].join(""));for(code.push(["a=",dataRead("sptr"),"\nb=scratch[dptr]\nif(a<b){break __g}\nif(a>b){break __l}"].join("")),i=order.length-1;i>=1;--i)code.push("sptr+=e"+i,"dptr+=f"+i,"}");for(code.push("dptr=cptr;sptr=cptr-s0"),i=order.length-1;i>=0;--i)0!==(j=order[i])&&code.push(["for(i",j,"=0;i",j,"<n",j,";++i",j,"){"].join(""));for(code.push(dataWrite("dptr",dataRead("sptr"))),i=0;i<order.length;++i)0!==(j=order[i])&&code.push(["dptr+=d",j,";sptr+=d",j].join(""),"}");for(code.push("cptr-=s0\n}"),code.push("dptr=cptr;sptr=0"),i=order.length-1;i>=0;--i)0!==(j=order[i])&&code.push(["for(i",j,"=0;i",j,"<n",j,";++i",j,"){"].join(""));for(code.push(dataWrite("dptr","scratch[sptr++]")),i=0;i<order.length;++i){var j;0!==(j=order[i])&&code.push("dptr+=d"+j,"}")}}else code.push("scratch="+dataRead("ptr"),"while((j--\x3eleft)&&("+dataRead("cptr-s0")+">scratch)){",dataWrite("cptr",dataRead("cptr-s0")),"cptr-=s0","}",dataWrite("cptr","scratch"));return code.push("}"),order.length>1&&allocator&&code.push("free(scratch)"),code.push("} return "+funcName),allocator?new Function("malloc","free",code.join("\n"))(allocator[0],allocator[1]):new Function(code.join("\n"))()}(order,dtype);return result(insertionSort,function createQuickSort(order,dtype,insertionSort){var code=["'use strict'"],funcName=["ndarrayQuickSort",order.join("d"),dtype].join(""),funcArgs=["left","right","data","offset"].concat(shapeArgs(order.length)),allocator=getMallocFree(dtype),labelCounter=0;code.push(["function ",funcName,"(",funcArgs.join(","),"){"].join(""));var vars=["sixth=((right-left+1)/6)|0","index1=left+sixth","index5=right-sixth","index3=(left+right)>>1","index2=index3-sixth","index4=index3+sixth","el1=index1","el2=index2","el3=index3","el4=index4","el5=index5","less=left+1","great=right-1","pivots_are_equal=true","tmp","tmp0","x","y","z","k","ptr0","ptr1","ptr2","comp_pivot1=0","comp_pivot2=0","comp=0"];if(order.length>1){for(var ele_size=[],i=1;i<order.length;++i)ele_size.push("n"+i),vars.push("i"+i);for(i=0;i<8;++i)vars.push("b_ptr"+i);vars.push("ptr3","ptr4","ptr5","ptr6","ptr7","pivot_ptr","ptr_shift","elementSize="+ele_size.join("*")),allocator?vars.push("pivot1=malloc(elementSize)","pivot2=malloc(elementSize)"):vars.push("pivot1=new Array(elementSize),pivot2=new Array(elementSize)")}else vars.push("pivot1","pivot2");function toPointer(v){return["(offset+",v,"*s0)"].join("")}function dataRead(ptr){return"generic"===dtype?["data.get(",ptr,")"].join(""):["data[",ptr,"]"].join("")}function dataWrite(ptr,v){return"generic"===dtype?["data.set(",ptr,",",v,")"].join(""):["data[",ptr,"]=",v].join("")}function cacheLoop(ptrs,usePivot,body){if(1===ptrs.length)code.push("ptr0="+toPointer(ptrs[0]));else for(var i=0;i<ptrs.length;++i)code.push(["b_ptr",i,"=s0*",ptrs[i]].join(""));for(usePivot&&code.push("pivot_ptr=0"),code.push("ptr_shift=offset"),i=order.length-1;i>=0;--i)0!==(j=order[i])&&code.push(["for(i",j,"=0;i",j,"<n",j,";++i",j,"){"].join(""));if(ptrs.length>1)for(i=0;i<ptrs.length;++i)code.push(["ptr",i,"=b_ptr",i,"+ptr_shift"].join(""));for(code.push(body),usePivot&&code.push("++pivot_ptr"),i=0;i<order.length;++i){var j;0!==(j=order[i])&&(ptrs.length>1?code.push("ptr_shift+=d"+j):code.push("ptr0+=d"+j),code.push("}"))}}function lexicoLoop(label,ptrs,usePivot,body){if(1===ptrs.length)code.push("ptr0="+toPointer(ptrs[0]));else{for(var i=0;i<ptrs.length;++i)code.push(["b_ptr",i,"=s0*",ptrs[i]].join(""));code.push("ptr_shift=offset")}for(usePivot&&code.push("pivot_ptr=0"),label&&code.push(label+":"),i=1;i<order.length;++i)code.push(["for(i",i,"=0;i",i,"<n",i,";++i",i,"){"].join(""));if(ptrs.length>1)for(i=0;i<ptrs.length;++i)code.push(["ptr",i,"=b_ptr",i,"+ptr_shift"].join(""));for(code.push(body),i=order.length-1;i>=1;--i)usePivot&&code.push("pivot_ptr+=f"+i),ptrs.length>1?code.push("ptr_shift+=e"+i):code.push("ptr0+=e"+i),code.push("}")}function cleanUp(){order.length>1&&allocator&&code.push("free(pivot1)","free(pivot2)")}function compareSwap(a_id,b_id){var a="el"+a_id,b="el"+b_id;if(order.length>1){var lbl="__l"+ ++labelCounter;lexicoLoop(lbl,[a,b],!1,["comp=",dataRead("ptr0"),"-",dataRead("ptr1"),"\n","if(comp>0){tmp0=",a,";",a,"=",b,";",b,"=tmp0;break ",lbl,"}\n","if(comp<0){break ",lbl,"}"].join(""))}else code.push(["if(",dataRead(toPointer(a)),">",dataRead(toPointer(b)),"){tmp0=",a,";",a,"=",b,";",b,"=tmp0}"].join(""))}function moveElement(dst,src){order.length>1?cacheLoop([dst,src],!1,dataWrite("ptr0",dataRead("ptr1"))):code.push(dataWrite(toPointer(dst),dataRead(toPointer(src))))}function comparePivot(result,ptr,n){if(order.length>1){var lbl="__l"+ ++labelCounter;lexicoLoop(lbl,[ptr],!0,[result,"=",dataRead("ptr0"),"-pivot",n,"[pivot_ptr]\n","if(",result,"!==0){break ",lbl,"}"].join(""))}else code.push([result,"=",dataRead(toPointer(ptr)),"-pivot",n].join(""))}function swapElements(a,b){order.length>1?cacheLoop([a,b],!1,["tmp=",dataRead("ptr0"),"\n",dataWrite("ptr0",dataRead("ptr1")),"\n",dataWrite("ptr1","tmp")].join("")):code.push(["ptr0=",toPointer(a),"\n","ptr1=",toPointer(b),"\n","tmp=",dataRead("ptr0"),"\n",dataWrite("ptr0",dataRead("ptr1")),"\n",dataWrite("ptr1","tmp")].join(""))}function tripleSwap(k,less,great){order.length>1?(cacheLoop([k,less,great],!1,["tmp=",dataRead("ptr0"),"\n",dataWrite("ptr0",dataRead("ptr1")),"\n",dataWrite("ptr1",dataRead("ptr2")),"\n",dataWrite("ptr2","tmp")].join("")),code.push("++"+less,"--"+great)):code.push(["ptr0=",toPointer(k),"\n","ptr1=",toPointer(less),"\n","ptr2=",toPointer(great),"\n","++",less,"\n","--",great,"\n","tmp=",dataRead("ptr0"),"\n",dataWrite("ptr0",dataRead("ptr1")),"\n",dataWrite("ptr1",dataRead("ptr2")),"\n",dataWrite("ptr2","tmp")].join(""))}function swapAndDecrement(k,great){swapElements(k,great),code.push("--"+great)}function storePivot(mem_dest,pivot_dest,pivot){order.length>1?cacheLoop([mem_dest,pivot_dest],!0,[dataWrite("ptr0",dataRead("ptr1")),"\n",dataWrite("ptr1",["pivot",pivot,"[pivot_ptr]"].join(""))].join("")):code.push(dataWrite(toPointer(mem_dest),dataRead(toPointer(pivot_dest))),dataWrite(toPointer(pivot_dest),"pivot"+pivot))}function doSort(left,right){code.push(["if((",right,"-",left,")<=",INSERTION_SORT_THRESHOLD,"){\n","insertionSort(",left,",",right,",data,offset,",shapeArgs(order.length).join(","),")\n","}else{\n",funcName,"(",left,",",right,",data,offset,",shapeArgs(order.length).join(","),")\n","}"].join(""))}function walkPointer(ptr,pivot,body){order.length>1?(code.push(["__l",++labelCounter,":while(true){"].join("")),cacheLoop([ptr],!0,["if(",dataRead("ptr0"),"!==pivot",pivot,"[pivot_ptr]){break __l",labelCounter,"}"].join("")),code.push(body,"}")):code.push(["while(",dataRead(toPointer(ptr)),"===pivot",pivot,"){",body,"}"].join(""))}return code.push("var "+vars.join(",")),compareSwap(1,2),compareSwap(4,5),compareSwap(1,3),compareSwap(2,3),compareSwap(1,4),compareSwap(3,4),compareSwap(2,5),compareSwap(2,3),compareSwap(4,5),order.length>1?cacheLoop(["el1","el2","el3","el4","el5","index1","index3","index5"],!0,["pivot1[pivot_ptr]=",dataRead("ptr1"),"\n","pivot2[pivot_ptr]=",dataRead("ptr3"),"\n","pivots_are_equal=pivots_are_equal&&(pivot1[pivot_ptr]===pivot2[pivot_ptr])\n","x=",dataRead("ptr0"),"\n","y=",dataRead("ptr2"),"\n","z=",dataRead("ptr4"),"\n",dataWrite("ptr5","x"),"\n",dataWrite("ptr6","y"),"\n",dataWrite("ptr7","z")].join("")):code.push(["pivot1=",dataRead(toPointer("el2")),"\n","pivot2=",dataRead(toPointer("el4")),"\n","pivots_are_equal=pivot1===pivot2\n","x=",dataRead(toPointer("el1")),"\n","y=",dataRead(toPointer("el3")),"\n","z=",dataRead(toPointer("el5")),"\n",dataWrite(toPointer("index1"),"x"),"\n",dataWrite(toPointer("index3"),"y"),"\n",dataWrite(toPointer("index5"),"z")].join("")),moveElement("index2","left"),moveElement("index4","right"),code.push("if(pivots_are_equal){"),code.push("for(k=less;k<=great;++k){"),comparePivot("comp","k",1),code.push("if(comp===0){continue}"),code.push("if(comp<0){"),code.push("if(k!==less){"),swapElements("k","less"),code.push("}"),code.push("++less"),code.push("}else{"),code.push("while(true){"),comparePivot("comp","great",1),code.push("if(comp>0){"),code.push("great--"),code.push("}else if(comp<0){"),tripleSwap("k","less","great"),code.push("break"),code.push("}else{"),swapAndDecrement("k","great"),code.push("break"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),code.push("}else{"),code.push("for(k=less;k<=great;++k){"),comparePivot("comp_pivot1","k",1),code.push("if(comp_pivot1<0){"),code.push("if(k!==less){"),swapElements("k","less"),code.push("}"),code.push("++less"),code.push("}else{"),comparePivot("comp_pivot2","k",2),code.push("if(comp_pivot2>0){"),code.push("while(true){"),comparePivot("comp","great",2),code.push("if(comp>0){"),code.push("if(--great<k){break}"),code.push("continue"),code.push("}else{"),comparePivot("comp","great",1),code.push("if(comp<0){"),tripleSwap("k","less","great"),code.push("}else{"),swapAndDecrement("k","great"),code.push("}"),code.push("break"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),storePivot("left","(less-1)",1),storePivot("right","(great+1)",2),doSort("left","(less-2)"),doSort("(great+2)","right"),code.push("if(pivots_are_equal){"),cleanUp(),code.push("return"),code.push("}"),code.push("if(less<index1&&great>index5){"),walkPointer("less",1,"++less"),walkPointer("great",2,"--great"),code.push("for(k=less;k<=great;++k){"),comparePivot("comp_pivot1","k",1),code.push("if(comp_pivot1===0){"),code.push("if(k!==less){"),swapElements("k","less"),code.push("}"),code.push("++less"),code.push("}else{"),comparePivot("comp_pivot2","k",2),code.push("if(comp_pivot2===0){"),code.push("while(true){"),comparePivot("comp","great",2),code.push("if(comp===0){"),code.push("if(--great<k){break}"),code.push("continue"),code.push("}else{"),comparePivot("comp","great",1),code.push("if(comp<0){"),tripleSwap("k","less","great"),code.push("}else{"),swapAndDecrement("k","great"),code.push("}"),code.push("break"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),code.push("}"),cleanUp(),doSort("less","great"),code.push("}return "+funcName),order.length>1&&allocator?new Function("insertionSort","malloc","free",code.join("\n"))(insertionSort,allocator[0],allocator[1]):new Function("insertionSort",code.join("\n"))(insertionSort)}(order,dtype,insertionSort))}},{"typedarray-pool":519}],428:[function(_dereq_,module,exports){"use strict";var compile=_dereq_("./lib/compile_sort.js"),CACHE={};module.exports=function sort(array){var order=array.order,dtype=array.dtype,typeName=[order,dtype].join(":"),compiled=CACHE[typeName];return compiled||(CACHE[typeName]=compiled=compile(order,dtype)),compiled(array),array}},{"./lib/compile_sort.js":427}],429:[function(_dereq_,module,exports){"use strict";var interp=_dereq_("ndarray-linear-interpolate"),do_warp=_dereq_("cwise/lib/wrapper")({args:["index","array","scalar","scalar","scalar"],pre:{body:"{this_warped=new Array(_inline_3_arg4_)}",args:[{name:"_inline_3_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_3_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_3_arg2_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_3_arg3_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_3_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_warped"],localVars:[]},body:{body:"{_inline_4_arg2_(this_warped,_inline_4_arg0_),_inline_4_arg1_=_inline_4_arg3_.apply(void 0,this_warped)}",args:[{name:"_inline_4_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_4_arg1_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_4_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_4_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_4_arg4_",lvalue:!1,rvalue:!1,count:0}],thisVars:["this_warped"],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"warpND",blockSize:64}),do_warp_1=_dereq_("cwise/lib/wrapper")({args:["index","array","scalar","scalar","scalar"],pre:{body:"{this_warped=[0]}",args:[],thisVars:["this_warped"],localVars:[]},body:{body:"{_inline_7_arg2_(this_warped,_inline_7_arg0_),_inline_7_arg1_=_inline_7_arg3_(_inline_7_arg4_,this_warped[0])}",args:[{name:"_inline_7_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_7_arg1_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_7_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_7_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_7_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_warped"],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"warp1D",blockSize:64}),do_warp_2=_dereq_("cwise/lib/wrapper")({args:["index","array","scalar","scalar","scalar"],pre:{body:"{this_warped=[0,0]}",args:[],thisVars:["this_warped"],localVars:[]},body:{body:"{_inline_10_arg2_(this_warped,_inline_10_arg0_),_inline_10_arg1_=_inline_10_arg3_(_inline_10_arg4_,this_warped[0],this_warped[1])}",args:[{name:"_inline_10_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_10_arg1_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_10_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_10_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_10_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_warped"],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"warp2D",blockSize:64}),do_warp_3=_dereq_("cwise/lib/wrapper")({args:["index","array","scalar","scalar","scalar"],pre:{body:"{this_warped=[0,0,0]}",args:[],thisVars:["this_warped"],localVars:[]},body:{body:"{_inline_13_arg2_(this_warped,_inline_13_arg0_),_inline_13_arg1_=_inline_13_arg3_(_inline_13_arg4_,this_warped[0],this_warped[1],this_warped[2])}",args:[{name:"_inline_13_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_13_arg1_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_13_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_13_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_13_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_warped"],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"warp3D",blockSize:64});module.exports=function warp(dest,src,func){switch(src.shape.length){case 1:do_warp_1(dest,func,interp.d1,src);break;case 2:do_warp_2(dest,func,interp.d2,src);break;case 3:do_warp_3(dest,func,interp.d3,src);break;default:do_warp(dest,func,interp.bind(void 0,src),src.shape.length)}return dest}},{"cwise/lib/wrapper":136,"ndarray-linear-interpolate":423}],430:[function(_dereq_,module,exports){var iota=_dereq_("iota-array"),isBuffer=_dereq_("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array;function compare1st(a,b){return a[0]-b[0]}function order(){var i,stride=this.stride,terms=new Array(stride.length);for(i=0;i<terms.length;++i)terms[i]=[Math.abs(stride[i]),i];terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i)result[i]=terms[i][1];return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");dimension<0&&(className="View_Nil"+dtype);var useGetters="generic"===dtype;if(-1===dimension){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}";return new Function(code)()}if(0===dimension){code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}";return new Function("TrivialArray",code)(CACHED_CONSTRUCTORS[dtype][0])}code=["'use strict'"];var indices=iota(dimension),args=indices.map(function(i){return"i"+i}),index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+"),shapeArg=indices.map(function(i){return"b"+i}).join(","),strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension),code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})"),1===dimension?code.push("proto.order=[0]"):(code.push("Object.defineProperty(proto,'order',{get:"),dimension<4?(code.push("function "+className+"_order(){"),2===dimension?code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===dimension&&code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):code.push("ORDER})")),code.push("proto.set=function "+className+"_set("+args.join(",")+",v){"),useGetters?code.push("return this.data.set("+index_str+",v)}"):code.push("return this.data["+index_str+"]=v}"),code.push("proto.get=function "+className+"_get("+args.join(",")+"){"),useGetters?code.push("return this.data.get("+index_str+")}"):code.push("return this.data["+index_str+"]}"),code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}"),code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}),c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}"),code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");var tShape=new Array(dimension),tStride=new Array(dimension);for(i=0;i<dimension;++i)tShape[i]="a[i"+i+"]",tStride[i]="b[i"+i+"]";code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}"),code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(i=0;i<dimension;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");return code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",code.join("\n"))(CACHED_CONSTRUCTORS[dtype],order)}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=function wrappedNDArrayCtor(data,shape,stride,offset){if(void 0===data)return(0,CACHED_CONSTRUCTORS.array[0])([]);"number"==typeof data&&(data=[data]),void 0===shape&&(shape=[data.length]);var d=shape.length;if(void 0===stride){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i)stride[i]=sz,sz*=shape[i]}if(void 0===offset)for(offset=0,i=0;i<d;++i)stride[i]<0&&(offset-=(shape[i]-1)*stride[i]);for(var dtype=function arrayDType(data){if(isBuffer(data))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(data)?"array":"generic"}(data),ctor_list=CACHED_CONSTRUCTORS[dtype];ctor_list.length<=d+1;)ctor_list.push(compileConstructor(dtype,ctor_list.length-1));return(0,ctor_list[d+1])(data,shape,stride,offset)}},{"iota-array":397,"is-buffer":399}],431:[function(_dereq_,module,exports){"use strict";var doubleBits=_dereq_("double-bits"),SMALLEST_DENORM=Math.pow(2,-1074),UINT_MAX=-1>>>0;module.exports=function nextafter(x,y){if(isNaN(x)||isNaN(y))return NaN;if(x===y)return x;if(0===x)return y<0?-SMALLEST_DENORM:SMALLEST_DENORM;var hi=doubleBits.hi(x),lo=doubleBits.lo(x);y>x==x>0?lo===UINT_MAX?(hi+=1,lo=0):lo+=1:0===lo?(lo=UINT_MAX,hi-=1):lo-=1;return doubleBits.pack(lo,hi)}},{"double-bits":151}],432:[function(_dereq_,module,exports){var =Math.PI,_120=radians(120);function line(x1,y1,x2,y2){return["C",x1,y1,x2,y2,x2,y2]}function quadratic(x1,y1,cx,cy,x2,y2){return["C",x1/3+2/3*cx,y1/3+2/3*cy,x2/3+2/3*cx,y2/3+2/3*cy,x2,y2]}function arc(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{var xy=rotate(x1,y1,-angle);x1=xy.x,y1=xy.y;var x=(x1-(x2=(xy=rotate(x2,y2,-angle)).x))/2,y=(y1-(y2=xy.y))/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(rx*=h=Math.sqrt(h),ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*Math.sqrt(Math.abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x)));k==1/0&&(k=1);var cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=Math.asin(((y1-cy)/ry).toFixed(9)),f2=Math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?-f1:f1,f2=x2<cx?-f2:f2,f1<0&&(f1=2*+f1),f2<0&&(f2=2*+f2),sweep_flag&&f1>f2&&(f1-=2*),!sweep_flag&&f2>f1&&(f2-=2*)}if(Math.abs(f2-f1)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);var res=arc(x2=cx+rx*Math.cos(f2),y2=cy+ry*Math.sin(f2),rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}var t=Math.tan((f2-f1)/4),hx=4/3*rx*t,hy=4/3*ry*t,curve=[2*x1-(x1+hx*Math.sin(f1)),2*y1-(y1-hy*Math.cos(f1)),x2+hx*Math.sin(f2),y2-hy*Math.cos(f2),x2,y2];if(recursive)return curve;res&&(curve=curve.concat(res));for(var i=0;i<curve.length;){var rot=rotate(curve[i],curve[i+1],angle);curve[i++]=rot.x,curve[i++]=rot.y}return curve}function rotate(x,y,rad){return{x:x*Math.cos(rad)-y*Math.sin(rad),y:x*Math.sin(rad)+y*Math.cos(rad)}}function radians(degress){return degress*(/180)}module.exports=function normalize(path){for(var prev,result=[],bezierX=0,bezierY=0,startX=0,startY=0,quadX=null,quadY=null,x=0,y=0,i=0,len=path.length;i<len;i++){var seg=path[i],command=seg[0];switch(command){case"M":startX=seg[1],startY=seg[2];break;case"A":(seg=arc(x,y,seg[1],seg[2],radians(seg[3]),seg[4],seg[5],seg[6],seg[7])).unshift("C"),seg.length>7&&(result.push(seg.splice(0,7)),seg.unshift("C"));break;case"S":var cx=x,cy=y;"C"!=prev&&"S"!=prev||(cx+=cx-bezierX,cy+=cy-bezierY),seg=["C",cx,cy,seg[1],seg[2],seg[3],seg[4]];break;case"T":"Q"==prev||"T"==prev?(quadX=2*x-quadX,quadY=2*y-quadY):(quadX=x,quadY=y),seg=quadratic(x,y,quadX,quadY,seg[1],seg[2]);break;case"Q":quadX=seg[1],quadY=seg[2],seg=quadratic(x,y,seg[1],seg[2],seg[3],seg[4]);break;case"L":seg=line(x,y,seg[1],seg[2]);break;case"H":seg=line(x,y,seg[1],y);break;case"V":seg=line(x,y,x,seg[1]);break;case"Z":seg=line(x,y,startX,startY)}prev=command,x=seg[seg.length-2],y=seg[seg.length-1],seg.length>4?(bezierX=seg[seg.length-4],bezierY=seg[seg.length-3]):(bezierX=x,bezierY=y),result.push(seg)}return result}},{}],433:[function(_dereq_,module,exports){exports.vertexNormals=function(faces,positions,specifiedEpsilon){for(var N=positions.length,normals=new Array(N),epsilon=void 0===specifiedEpsilon?1e-6:specifiedEpsilon,i=0;i<N;++i)normals[i]=[0,0,0];for(i=0;i<faces.length;++i)for(var f=faces[i],p=0,c=f[f.length-1],n=f[0],j=0;j<f.length;++j){p=c,c=n,n=f[(j+1)%f.length];for(var v0=positions[p],v1=positions[c],v2=positions[n],d01=new Array(3),m01=0,d21=new Array(3),m21=0,k=0;k<3;++k)d01[k]=v0[k]-v1[k],m01+=d01[k]*d01[k],d21[k]=v2[k]-v1[k],m21+=d21[k]*d21[k];if(m01*m21>epsilon){var norm=normals[c],w=1/Math.sqrt(m01*m21);for(k=0;k<3;++k){var u=(k+1)%3,v=(k+2)%3;norm[k]+=w*(d21[u]*d01[v]-d21[v]*d01[u])}}}for(i=0;i<N;++i){norm=normals[i];var m=0;for(k=0;k<3;++k)m+=norm[k]*norm[k];if(m>epsilon)for(w=1/Math.sqrt(m),k=0;k<3;++k)norm[k]*=w;else for(k=0;k<3;++k)norm[k]=0}return normals},exports.faceNormals=function(faces,positions,specifiedEpsilon){for(var N=faces.length,normals=new Array(N),epsilon=void 0===specifiedEpsilon?1e-6:specifiedEpsilon,i=0;i<N;++i){for(var f=faces[i],pos=new Array(3),j=0;j<3;++j)pos[j]=positions[f[j]];var d01=new Array(3),d21=new Array(3);for(j=0;j<3;++j)d01[j]=pos[1][j]-pos[0][j],d21[j]=pos[2][j]-pos[0][j];var n=new Array(3),l=0;for(j=0;j<3;++j){var u=(j+1)%3,v=(j+2)%3;n[j]=d01[u]*d21[v]-d01[v]*d21[u],l+=n[j]*n[j]}l=l>epsilon?1/Math.sqrt(l):0;for(j=0;j<3;++j)n[j]*=l;normals[i]=n}return normals}},{}],434:[function(_dereq_,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map(function(n){return test2[n]}).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=function toObject(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],435:[function(_dereq_,module,exports){"use strict";module.exports=function quatFromFrame(out,rx,ry,rz,ux,uy,uz,fx,fy,fz){var tr=rx+uy+fz;if(l>0){var l=Math.sqrt(tr+1);out[0]=.5*(uz-fy)/l,out[1]=.5*(fx-rz)/l,out[2]=.5*(ry-uy)/l,out[3]=.5*l}else{var tf=Math.max(rx,uy,fz),l=Math.sqrt(2*tf-tr+1);rx>=tf?(out[0]=.5*l,out[1]=.5*(ux+ry)/l,out[2]=.5*(fx+rz)/l,out[3]=.5*(uz-fy)/l):uy>=tf?(out[0]=.5*(ry+ux)/l,out[1]=.5*l,out[2]=.5*(fy+uz)/l,out[3]=.5*(fx-rz)/l):(out[0]=.5*(rz+fx)/l,out[1]=.5*(uz+fy)/l,out[2]=.5*l,out[3]=.5*(ry-ux)/l)}return out}},{}],436:[function(_dereq_,module,exports){"use strict";module.exports=function createOrbitController(options){var center=(options=options||{}).center||[0,0,0],rotation=options.rotation||[0,0,0,1],radius=options.radius||1;center=[].slice.call(center,0,3),normalize4(rotation=[].slice.call(rotation,0,4),rotation);var result=new OrbitCameraController(rotation,center,Math.log(radius));result.setDistanceLimits(options.zoomMin,options.zoomMax),("eye"in options||"up"in options)&&result.lookAt(0,options.eye,options.center,options.up);return result};var filterVector=_dereq_("filtered-vector"),lookAt=_dereq_("gl-mat4/lookAt"),mat4FromQuat=_dereq_("gl-mat4/fromQuat"),invert44=_dereq_("gl-mat4/invert"),quatFromFrame=_dereq_("./lib/quatFromFrame");function len3(x,y,z){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2)+Math.pow(z,2))}function len4(w,x,y,z){return Math.sqrt(Math.pow(w,2)+Math.pow(x,2)+Math.pow(y,2)+Math.pow(z,2))}function normalize4(out,a){var ax=a[0],ay=a[1],az=a[2],aw=a[3],al=len4(ax,ay,az,aw);al>1e-6?(out[0]=ax/al,out[1]=ay/al,out[2]=az/al,out[3]=aw/al):(out[0]=out[1]=out[2]=0,out[3]=1)}function OrbitCameraController(initQuat,initCenter,initRadius){this.radius=filterVector([initRadius]),this.center=filterVector(initCenter),this.rotation=filterVector(initQuat),this.computedRadius=this.radius.curve(0),this.computedCenter=this.center.curve(0),this.computedRotation=this.rotation.curve(0),this.computedUp=[.1,0,0],this.computedEye=[.1,0,0],this.computedMatrix=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.recalcMatrix(0)}var proto=OrbitCameraController.prototype;proto.lastT=function(){return Math.max(this.radius.lastT(),this.center.lastT(),this.rotation.lastT())},proto.recalcMatrix=function(t){this.radius.curve(t),this.center.curve(t),this.rotation.curve(t);var quat=this.computedRotation;normalize4(quat,quat);var mat=this.computedMatrix;mat4FromQuat(mat,quat);var center=this.computedCenter,eye=this.computedEye,up=this.computedUp,radius=Math.exp(this.computedRadius[0]);eye[0]=center[0]+radius*mat[2],eye[1]=center[1]+radius*mat[6],eye[2]=center[2]+radius*mat[10],up[0]=mat[1],up[1]=mat[5],up[2]=mat[9];for(var i=0;i<3;++i){for(var rr=0,j=0;j<3;++j)rr+=mat[i+4*j]*eye[j];mat[12+i]=-rr}},proto.getMatrix=function(t,result){this.recalcMatrix(t);var m=this.computedMatrix;if(result){for(var i=0;i<16;++i)result[i]=m[i];return result}return m},proto.idle=function(t){this.center.idle(t),this.radius.idle(t),this.rotation.idle(t)},proto.flush=function(t){this.center.flush(t),this.radius.flush(t),this.rotation.flush(t)},proto.pan=function(t,dx,dy,dz){dx=dx||0,dy=dy||0,dz=dz||0,this.recalcMatrix(t);var mat=this.computedMatrix,ux=mat[1],uy=mat[5],uz=mat[9],ul=len3(ux,uy,uz);ux/=ul,uy/=ul,uz/=ul;var rx=mat[0],ry=mat[4],rz=mat[8],ru=rx*ux+ry*uy+rz*uz,rl=len3(rx-=ux*ru,ry-=uy*ru,rz-=uz*ru);rx/=rl,ry/=rl,rz/=rl;var fx=mat[2],fy=mat[6],fz=mat[10],fu=fx*ux+fy*uy+fz*uz,fr=fx*rx+fy*ry+fz*rz,fl=len3(fx-=fu*ux+fr*rx,fy-=fu*uy+fr*ry,fz-=fu*uz+fr*rz);fx/=fl,fy/=fl,fz/=fl;var vx=rx*dx+ux*dy,vy=ry*dx+uy*dy,vz=rz*dx+uz*dy;this.center.move(t,vx,vy,vz);var radius=Math.exp(this.computedRadius[0]);radius=Math.max(1e-4,radius+dz),this.radius.set(t,Math.log(radius))},proto.rotate=function(t,dx,dy,dz){this.recalcMatrix(t),dx=dx||0,dy=dy||0;var mat=this.computedMatrix,rx=mat[0],ry=mat[4],rz=mat[8],ux=mat[1],uy=mat[5],uz=mat[9],fx=mat[2],fy=mat[6],fz=mat[10],qx=dx*rx+dy*ux,qy=dx*ry+dy*uy,qz=dx*rz+dy*uz,bx=-(fy*qz-fz*qy),by=-(fz*qx-fx*qz),bz=-(fx*qy-fy*qx),bw=Math.sqrt(Math.max(0,1-Math.pow(bx,2)-Math.pow(by,2)-Math.pow(bz,2))),bl=len4(bx,by,bz,bw);bl>1e-6?(bx/=bl,by/=bl,bz/=bl,bw/=bl):(bx=by=bz=0,bw=1);var rotation=this.computedRotation,ax=rotation[0],ay=rotation[1],az=rotation[2],aw=rotation[3],cx=ax*bw+aw*bx+ay*bz-az*by,cy=ay*bw+aw*by+az*bx-ax*bz,cz=az*bw+aw*bz+ax*by-ay*bx,cw=aw*bw-ax*bx-ay*by-az*bz;if(dz){bx=fx,by=fy,bz=fz;var s=Math.sin(dz)/len3(bx,by,bz);bx*=s,by*=s,bz*=s,cw=cw*(bw=Math.cos(dx))-(cx=cx*bw+cw*bx+cy*bz-cz*by)*bx-(cy=cy*bw+cw*by+cz*bx-cx*bz)*by-(cz=cz*bw+cw*bz+cx*by-cy*bx)*bz}var cl=len4(cx,cy,cz,cw);cl>1e-6?(cx/=cl,cy/=cl,cz/=cl,cw/=cl):(cx=cy=cz=0,cw=1),this.rotation.set(t,cx,cy,cz,cw)},proto.lookAt=function(t,eye,center,up){this.recalcMatrix(t),center=center||this.computedCenter,eye=eye||this.computedEye,up=up||this.computedUp;var mat=this.computedMatrix;lookAt(mat,eye,center,up);var rotation=this.computedRotation;quatFromFrame(rotation,mat[0],mat[1],mat[2],mat[4],mat[5],mat[6],mat[8],mat[9],mat[10]),normalize4(rotation,rotation),this.rotation.set(t,rotation[0],rotation[1],rotation[2],rotation[3]);for(var fl=0,i=0;i<3;++i)fl+=Math.pow(center[i]-eye[i],2);this.radius.set(t,.5*Math.log(Math.max(fl,1e-6))),this.center.set(t,center[0],center[1],center[2])},proto.translate=function(t,dx,dy,dz){this.center.move(t,dx||0,dy||0,dz||0)},proto.setMatrix=function(t,matrix){var rotation=this.computedRotation;quatFromFrame(rotation,matrix[0],matrix[1],matrix[2],matrix[4],matrix[5],matrix[6],matrix[8],matrix[9],matrix[10]),normalize4(rotation,rotation),this.rotation.set(t,rotation[0],rotation[1],rotation[2],rotation[3]);var mat=this.computedMatrix;invert44(mat,matrix);var w=mat[15];if(Math.abs(w)>1e-6){var cx=mat[12]/w,cy=mat[13]/w,cz=mat[14]/w;this.recalcMatrix(t);var r=Math.exp(this.computedRadius[0]);this.center.set(t,cx-mat[2]*r,cy-mat[6]*r,cz-mat[10]*r),this.radius.idle(t)}else this.center.idle(t),this.radius.idle(t)},proto.setDistance=function(t,d){d>0&&this.radius.set(t,Math.log(d))},proto.setDistanceLimits=function(lo,hi){lo=lo>0?Math.log(lo):-1/0,hi=hi>0?Math.log(hi):1/0,hi=Math.max(hi,lo),this.radius.bounds[0][0]=lo,this.radius.bounds[1][0]=hi},proto.getDistanceLimits=function(out){var bounds=this.radius.bounds;return out?(out[0]=Math.exp(bounds[0][0]),out[1]=Math.exp(bounds[1][0]),out):[Math.exp(bounds[0][0]),Math.exp(bounds[1][0])]},proto.toJSON=function(){return this.recalcMatrix(this.lastT()),{center:this.computedCenter.slice(),rotation:this.computedRotation.slice(),distance:Math.log(this.computedRadius[0]),zoomMin:this.radius.bounds[0][0],zoomMax:this.radius.bounds[1][0]}},proto.fromJSON=function(options){var t=this.lastT(),c=options.center;c&&this.center.set(t,c[0],c[1],c[2]);var r=options.rotation;r&&this.rotation.set(t,r[0],r[1],r[2],r[3]);var d=options.distance;d&&d>0&&this.radius.set(t,Math.log(d)),this.setDistanceLimits(options.zoomMin,options.zoomMax)}},{"./lib/quatFromFrame":435,"filtered-vector":214,"gl-mat4/fromQuat":250,"gl-mat4/invert":253,"gl-mat4/lookAt":254}],437:[function(_dereq_,module,exports){"use strict";var repeat=_dereq_("repeat-string");module.exports=function padLeft(str,num,ch){return repeat(ch=void 0!==ch?ch+"":" ",num)+str}},{"repeat-string":476}],438:[function(_dereq_,module,exports){"use strict";function parse(str,opts){if("string"!=typeof str)return[str];var res=[str];"string"==typeof opts||Array.isArray(opts)?opts={brackets:opts}:opts||(opts={});var brackets=opts.brackets?Array.isArray(opts.brackets)?opts.brackets:[opts.brackets]:["{}","[]","()"],escape=opts.escape||"___",flat=!!opts.flat;brackets.forEach(function(bracket){var pRE=new RegExp(["\\",bracket[0],"[^\\",bracket[0],"\\",bracket[1],"]*\\",bracket[1]].join("")),ids=[];function replaceToken(token,idx,str){var refId=res.push(token.slice(bracket[0].length,-bracket[1].length))-1;return ids.push(refId),escape+refId}res.forEach(function(str,i){for(var prevStr,a=0;str!=prevStr;)if(prevStr=str,str=str.replace(pRE,replaceToken),a++>1e4)throw Error("References have circular dependency. Please, check them.");res[i]=str}),ids=ids.reverse(),res=res.map(function(str){return ids.forEach(function(id){str=str.replace(new RegExp("(\\"+escape+id+"(?![0-9]))","g"),bracket[0]+"$1"+bracket[1])}),str})});var re=new RegExp("\\"+escape+"([0-9]+)");return flat?res:function nest(str,refs,escape){for(var match,res=[],a=0;match=re.exec(str);){if(a++>1e4)throw Error("Circular references in parenthesis");res.push(str.slice(0,match.index)),res.push(nest(refs[match[1]],refs)),str=str.slice(match.index+match[0].length)}return res.push(str),res}(res[0],res)}function stringify(arg,opts){if(opts&&opts.flat){var prevStr,escape=opts&&opts.escape||"___",str=arg[0];if(!str)return"";for(var re=new RegExp("\\"+escape+"([0-9]+)"),a=0;str!=prevStr;){if(a++>1e4)throw Error("Circular references in "+arg);prevStr=str,str=str.replace(re,replaceRef)}return str}return arg.reduce(function f(prev,curr){return Array.isArray(curr)&&(curr=curr.reduce(f,"")),prev+curr},"");function replaceRef(match,idx){if(null==arg[idx])throw Error("Reference "+idx+"is undefined");return arg[idx]}}function parenthesis(arg,opts){return Array.isArray(arg)?stringify(arg,opts):parse(arg,opts)}parenthesis.parse=parse,parenthesis.stringify=stringify,module.exports=parenthesis},{}],439:[function(_dereq_,module,exports){"use strict";var pick=_dereq_("pick-by-alias");module.exports=function parseRect(arg){var rect;arguments.length>1&&(arg=arguments);"string"==typeof arg?arg=arg.split(/\s/).map(parseFloat):"number"==typeof arg&&(arg=[arg]);arg.length&&"number"==typeof arg[0]?rect=1===arg.length?{width:arg[0],height:arg[0],x:0,y:0}:2===arg.length?{width:arg[0],height:arg[1],x:0,y:0}:{x:arg[0],y:arg[1],width:arg[2]-arg[0]||0,height:arg[3]-arg[1]||0}:arg&&(arg=pick(arg,{left:"x l left Left",top:"y t top Top",width:"w width W Width",height:"h height W Width",bottom:"b bottom Bottom",right:"r right Right"}),rect={x:arg.left||0,y:arg.top||0},null==arg.width?arg.right?rect.width=arg.right-rect.x:rect.width=0:rect.width=arg.width,null==arg.height?arg.bottom?rect.height=arg.bottom-rect.y:rect.height=0:rect.height=arg.height);return rect}},{"pick-by-alias":445}],440:[function(_dereq_,module,exports){module.exports=function parse(path){var data=[];return path.replace(segment,function(_,command,args){var type=command.toLowerCase();for(args=function parseValues(args){var numbers=args.match(number);return numbers?numbers.map(Number):[]}(args),"m"==type&&args.length>2&&(data.push([command].concat(args.splice(0,2))),type="l",command="m"==command?"l":"L");;){if(args.length==length[type])return args.unshift(command),data.push(args);if(args.length<length[type])throw new Error("malformed path data");data.push([command].concat(args.splice(0,length[type])))}}),data};var length={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},segment=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var number=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},{}],441:[function(_dereq_,module,exports){module.exports=function parseUnit(str,out){out||(out=[0,""]),str=String(str);var num=parseFloat(str,10);return out[0]=num,out[1]=str.match(/[\d.\-\+]*\s*(.*)/)[1]||"",out}},{}],442:[function(_dereq_,module,exports){(function(process){(function(){var getNanoSeconds,hrtime,loadTime,moduleLoadTime,nodeLoadTime,upTime;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:void 0!==process&&null!==process&&process.hrtime?(module.exports=function(){return(getNanoSeconds()-nodeLoadTime)/1e6},hrtime=process.hrtime,moduleLoadTime=(getNanoSeconds=function(){var hr;return 1e9*(hr=hrtime())[0]+hr[1]})(),upTime=1e9*process.uptime(),nodeLoadTime=moduleLoadTime-upTime):Date.now?(module.exports=function(){return Date.now()-loadTime},loadTime=Date.now()):(module.exports=function(){return(new Date).getTime()-loadTime},loadTime=(new Date).getTime())}).call(this)}).call(this,_dereq_("_process"))},{_process:462}],443:[function(_dereq_,module,exports){"use strict";module.exports=function permutationSign(p){var n=p.length;if(n<BRUTE_FORCE_CUTOFF){for(var sgn=1,i=0;i<n;++i)for(var j=0;j<i;++j)if(p[i]<p[j])sgn=-sgn;else if(p[i]===p[j])return 0;return sgn}for(var visited=pool.mallocUint8(n),i=0;i<n;++i)visited[i]=0;for(var sgn=1,i=0;i<n;++i)if(!visited[i]){var count=1;visited[i]=1;for(var j=p[i];j!==i;j=p[j]){if(visited[j])return pool.freeUint8(visited),0;count+=1,visited[j]=1}1&count||(sgn=-sgn)}return pool.freeUint8(visited),sgn};var BRUTE_FORCE_CUTOFF=32,pool=_dereq_("typedarray-pool")},{"typedarray-pool":519}],444:[function(_dereq_,module,exports){"use strict";var pool=_dereq_("typedarray-pool"),inverse=_dereq_("invert-permutation");exports.rank=function rank(permutation){var n=permutation.length;switch(n){case 0:case 1:return 0;case 2:return permutation[1]}var s,t,i,p=pool.mallocUint32(n),pinv=pool.mallocUint32(n),r=0;for(inverse(permutation,pinv),i=0;i<n;++i)p[i]=permutation[i];for(i=n-1;i>0;--i)t=pinv[i],s=p[i],p[i]=p[t],p[t]=s,pinv[i]=pinv[s],pinv[s]=t,r=(r+s)*i;return pool.freeUint32(pinv),pool.freeUint32(p),r},exports.unrank=function unrank(n,r,p){switch(n){case 0:return p||[];case 1:return p?(p[0]=0,p):[0];case 2:return p?(r?(p[0]=0,p[1]=1):(p[0]=1,p[1]=0),p):r?[0,1]:[1,0]}var s,t,i,nf=1;for((p=p||new Array(n))[0]=0,i=1;i<n;++i)p[i]=i,nf=nf*i|0;for(i=n-1;i>0;--i)r=r-(s=r/nf|0)*nf|0,nf=nf/i|0,t=0|p[i],p[i]=0|p[s],p[s]=0|t;return p}},{"invert-permutation":396,"typedarray-pool":519}],445:[function(_dereq_,module,exports){"use strict";module.exports=function pick(src,props,keepRest){var prop,i,result={};if("string"==typeof props&&(props=toList(props)),Array.isArray(props)){var res={};for(i=0;i<props.length;i++)res[props[i]]=!0;props=res}for(prop in props)props[prop]=toList(props[prop]);var occupied={};for(prop in props){var aliases=props[prop];if(Array.isArray(aliases))for(i=0;i<aliases.length;i++){var alias=aliases[i];if(keepRest&&(occupied[alias]=!0),alias in src){if(result[prop]=src[alias],keepRest)for(var j=i;j<aliases.length;j++)occupied[aliases[j]]=!0;break}}else prop in src&&(props[prop]&&(result[prop]=src[prop]),keepRest&&(occupied[prop]=!0))}if(keepRest)for(prop in src)occupied[prop]||(result[prop]=src[prop]);return result};var CACHE={};function toList(arg){return CACHE[arg]?CACHE[arg]:("string"==typeof arg&&(arg=CACHE[arg]=arg.split(/\s*,\s*|\s+/)),arg)}},{}],446:[function(_dereq_,module,exports){"use strict";module.exports=function planarDual(cells,positions){for(var numVertices=0|positions.length,numEdges=cells.length,adj=[new Array(numVertices),new Array(numVertices)],i=0;i<numVertices;++i)adj[0][i]=[],adj[1][i]=[];for(var i=0;i<numEdges;++i){var c=cells[i];adj[0][c[0]].push(c),adj[1][c[1]].push(c)}for(var cycles=[],i=0;i<numVertices;++i)adj[0][i].length+adj[1][i].length===0&&cycles.push([i]);function cut(c,i){var a=adj[i][c[i]];a.splice(a.indexOf(c),1)}function next(a,b,noCut){for(var nextCell,nextVertex,nextDir,i=0;i<2;++i)if(adj[i][b].length>0){nextCell=adj[i][b][0],nextDir=i;break}nextVertex=nextCell[1^nextDir];for(var dir=0;dir<2;++dir)for(var nbhd=adj[dir][b],k=0;k<nbhd.length;++k){var e=nbhd[k],p=e[1^dir],cmp=compareAngle(positions[a],positions[b],positions[nextVertex],positions[p]);cmp>0&&(nextCell=e,nextVertex=p,nextDir=dir)}return noCut?nextVertex:(nextCell&&cut(nextCell,nextDir),nextVertex)}function extractCycle(v,dir){var e0=adj[dir][v][0],cycle=[v];cut(e0,dir);for(var u=e0[1^dir];;){for(;u!==v;)cycle.push(u),u=next(cycle[cycle.length-2],u,!1);if(adj[0][v].length+adj[1][v].length===0)break;var a=cycle[cycle.length-1],b=v,c=cycle[1],d=next(a,b,!0);if(compareAngle(positions[a],positions[b],positions[c],positions[d])<0)break;cycle.push(v),u=next(a,b)}return cycle}function shouldGlue(pcycle,ncycle){return ncycle[1]===ncycle[ncycle.length-1]}for(var i=0;i<numVertices;++i)for(var j=0;j<2;++j){for(var pcycle=[];adj[j][i].length>0;){adj[0][i].length;var ncycle=extractCycle(i,j);shouldGlue(pcycle,ncycle)?pcycle.push.apply(pcycle,ncycle):(pcycle.length>0&&cycles.push(pcycle),pcycle=ncycle)}pcycle.length>0&&cycles.push(pcycle)}return cycles};var compareAngle=_dereq_("compare-angle")},{"compare-angle":114}],447:[function(_dereq_,module,exports){"use strict";module.exports=function trimLeaves(edges,positions){for(var adj=e2a(edges,positions.length),live=new Array(positions.length),nbhd=new Array(positions.length),dead=[],i=0;i<positions.length;++i){var count=adj[i].length;nbhd[i]=count,live[i]=!0,count<=1&&dead.push(i)}for(;dead.length>0;){var v=dead.pop();live[v]=!1;for(var n=adj[v],i=0;i<n.length;++i){var u=n[i];0==--nbhd[u]&&dead.push(u)}}for(var newIndex=new Array(positions.length),npositions=[],i=0;i<positions.length;++i)if(live[i]){var v=npositions.length;newIndex[i]=v,npositions.push(positions[i])}else newIndex[i]=-1;for(var nedges=[],i=0;i<edges.length;++i){var e=edges[i];live[e[0]]&&live[e[1]]&&nedges.push([newIndex[e[0]],newIndex[e[1]]])}return[nedges,npositions]};var e2a=_dereq_("edges-to-adjacency-list")},{"edges-to-adjacency-list":156}],448:[function(_dereq_,module,exports){"use strict";module.exports=function planarGraphToPolyline(edges,positions){var result=trimLeaves(edges,positions);edges=result[0];for(var numVertices=(positions=result[1]).length,adj=(edges.length,e2a(edges,positions.length)),i=0;i<numVertices;++i)if(adj[i].length%2==1)throw new Error("planar-graph-to-polyline: graph must be manifold");var faces=planarDual(edges,positions);for(var numFaces=(faces=faces.filter(function ccw(c){for(var n=c.length,area=[0],j=0;j<n;++j){var a=positions[c[j]],b=positions[c[(j+1)%n]],t00=twoProduct(-a[0],a[1]),t01=twoProduct(-a[0],b[1]),t10=twoProduct(b[0],a[1]),t11=twoProduct(b[0],b[1]);area=robustSum(area,robustSum(robustSum(t00,t01),robustSum(t10,t11)))}return area[area.length-1]>0})).length,parent=new Array(numFaces),containment=new Array(numFaces),i=0;i<numFaces;++i){parent[i]=i;var row=new Array(numFaces),loopVertices=faces[i].map(function(v){return positions[v]}),pmc=preprocessPolygon([loopVertices]),count=0;outer:for(var j=0;j<numFaces;++j)if(row[j]=0,i!==j){for(var c=faces[j],n=c.length,k=0;k<n;++k){var d=pmc(positions[c[k]]);if(0!==d){d<0&&(row[j]=1,count+=1);continue outer}}row[j]=1,count+=1}containment[i]=[count,i,row]}containment.sort(function(a,b){return b[0]-a[0]});for(var i=0;i<numFaces;++i)for(var row=containment[i],idx=row[1],children=row[2],j=0;j<numFaces;++j)children[j]&&(parent[j]=idx);for(var fadj=function makeArrayOfArrays(length){for(var result=new Array(length),i=0;i<length;++i)result[i]=[];return result}(numFaces),i=0;i<numFaces;++i)fadj[i].push(parent[i]),fadj[parent[i]].push(i);for(var edgeAdjacency={},internalVertices=makeArray(numVertices,!1),i=0;i<numFaces;++i)for(var c=faces[i],n=c.length,j=0;j<n;++j){var a=c[j],b=c[(j+1)%n],key=Math.min(a,b)+":"+Math.max(a,b);if(key in edgeAdjacency){var neighbor=edgeAdjacency[key];fadj[neighbor].push(i),fadj[i].push(neighbor),internalVertices[a]=internalVertices[b]=!0}else edgeAdjacency[key]=i}function sharedBoundary(c){for(var n=c.length,i=0;i<n;++i)if(!internalVertices[c[i]])return!1;return!0}for(var toVisit=[],parity=makeArray(numFaces,-1),i=0;i<numFaces;++i)parent[i]!==i||sharedBoundary(faces[i])?parity[i]=-1:(toVisit.push(i),parity[i]=0);var result=[];for(;toVisit.length>0;){var top=toVisit.pop(),nbhd=fadj[top];uniq(nbhd,function(a,b){return a-b});var polyline,nnbhr=nbhd.length,p=parity[top];if(0===p){var c=faces[top];polyline=[c]}for(var i=0;i<nnbhr;++i){var f=nbhd[i];if(!(parity[f]>=0)&&(parity[f]=1^p,toVisit.push(f),0===p)){var c=faces[f];sharedBoundary(c)||(c.reverse(),polyline.push(c))}}0===p&&result.push(polyline)}return result};var e2a=_dereq_("edges-to-adjacency-list"),planarDual=_dereq_("planar-dual"),preprocessPolygon=_dereq_("point-in-big-polygon"),twoProduct=_dereq_("two-product"),robustSum=_dereq_("robust-sum"),uniq=_dereq_("uniq"),trimLeaves=_dereq_("./lib/trim-leaves");function makeArray(length,fill){for(var result=new Array(length),i=0;i<length;++i)result[i]=fill;return result}},{"./lib/trim-leaves":447,"edges-to-adjacency-list":156,"planar-dual":446,"point-in-big-polygon":452,"robust-sum":488,"two-product":517,uniq:521}],449:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./quad")},{"./quad":451}],450:[function(_dereq_,module,exports){arguments[4][98][0].apply(exports,arguments)},{dup:98}],451:[function(_dereq_,module,exports){"use strict";var search=_dereq_("binary-search-bounds"),clamp=_dereq_("clamp"),rect=_dereq_("parse-rect"),getBounds=_dereq_("array-bounds"),pick=_dereq_("pick-by-alias"),defined=_dereq_("defined"),flatten=_dereq_("flatten-vertex-data"),isObj=_dereq_("is-obj"),dtype=_dereq_("dtype"),log2=_dereq_("math-log2");function normalize(pts,bounds){for(var lox=bounds[0],loy=bounds[1],scaleX=1/(bounds[2]-lox),scaleY=1/(bounds[3]-loy),result=new Array(pts.length),i=0,n=pts.length/2;i<n;i++)result[2*i]=clamp((pts[2*i]-lox)*scaleX,0,1),result[2*i+1]=clamp((pts[2*i+1]-loy)*scaleY,0,1);return result}module.exports=function cluster(srcPoints,options){options||(options={}),srcPoints=flatten(srcPoints,"float64"),options=pick(options,{bounds:"range bounds dataBox databox",maxDepth:"depth maxDepth maxdepth level maxLevel maxlevel levels",dtype:"type dtype format out dst output destination"});var maxDepth=defined(options.maxDepth,255),bounds=defined(options.bounds,getBounds(srcPoints,2));bounds[0]===bounds[2]&&bounds[2]++,bounds[1]===bounds[3]&&bounds[3]++;var ids,points=normalize(srcPoints,bounds),n=srcPoints.length>>>1;options.dtype||(options.dtype="array"),"string"==typeof options.dtype?ids=new(dtype(options.dtype))(n):options.dtype&&(ids=options.dtype,Array.isArray(ids)&&(ids.length=n));for(var i=0;i<n;++i)ids[i]=i;var levels=[],sublevels=[],groups=[],offsets=[];!function sort(x,y,diam,ids,level,group){if(!ids.length)return null;var levelItems=levels[level]||(levels[level]=[]);var levelGroups=groups[level]||(groups[level]=[]);var sublevel=sublevels[level]||(sublevels[level]=[]);var offset=levelItems.length;level++;if(level>maxDepth){for(var i=0;i<ids.length;i++)levelItems.push(ids[i]),levelGroups.push(group),sublevel.push(null,null,null,null);return offset}levelItems.push(ids[0]);levelGroups.push(group);if(ids.length<=1)return sublevel.push(null,null,null,null),offset;var d2=.5*diam;var cx=x+d2,cy=y+d2;var lolo=[],lohi=[],hilo=[],hihi=[];for(var i$1=1,l=ids.length;i$1<l;i$1++){var idx=ids[i$1],x$1=points[2*idx],y$1=points[2*idx+1];x$1<cx?y$1<cy?lolo.push(idx):lohi.push(idx):y$1<cy?hilo.push(idx):hihi.push(idx)}group<<=2;sublevel.push(sort(x,y,d2,lolo,level,group),sort(x,cy,d2,lohi,level,group+1),sort(cx,y,d2,hilo,level,group+2),sort(cx,cy,d2,hihi,level,group+3));return offset}(0,0,1,ids,0,1);for(var offset=0,level=0;level<levels.length;level++){var levelItems=levels[level];if(ids.set)ids.set(levelItems,offset);else for(var i$1=0,l=levelItems.length;i$1<l;i$1++)ids[i$1+offset]=levelItems[i$1];var nextOffset=offset+levels[level].length;offsets[level]=[offset,nextOffset],offset=nextOffset}return ids.range=function range(){var options,args=[],len=arguments.length;for(;len--;)args[len]=arguments[len];if(isObj(args[args.length-1])){var arg=args.pop();args.length||null==arg.x&&null==arg.l&&null==arg.left||(args=[arg],options={}),options=pick(arg,{level:"level maxLevel",d:"d diam diameter r radius px pxSize pixel pixelSize maxD size minSize",lod:"lod details ranges offsets"})}else options={};args.length||(args=bounds);var box=rect.apply(void 0,args),ref=[Math.min(box.x,box.x+box.width),Math.min(box.y,box.y+box.height),Math.max(box.x,box.x+box.width),Math.max(box.y,box.y+box.height)],minX=ref[0],minY=ref[1],maxX=ref[2],maxY=ref[3],ref$1=normalize([minX,minY,maxX,maxY],bounds),nminX=ref$1[0],nminY=ref$1[1],nmaxX=ref$1[2],nmaxY=ref$1[3],maxLevel=defined(options.level,levels.length);if(null!=options.d){var d;"number"==typeof options.d?d=[options.d,options.d]:options.d.length&&(d=options.d),maxLevel=Math.min(Math.max(Math.ceil(-log2(Math.abs(d[0])/(bounds[2]-bounds[0]))),Math.ceil(-log2(Math.abs(d[1])/(bounds[3]-bounds[1])))),maxLevel)}if(maxLevel=Math.min(maxLevel,levels.length),options.lod)return function lod(lox,loy,hix,hiy,maxLevel){for(var ranges=[],level=0;level<maxLevel;level++){var levelGroups=groups[level],from=offsets[level][0],levelGroupStart=group(lox,loy,level),levelGroupEnd=group(hix,hiy,level),startOffset=search.ge(levelGroups,levelGroupStart),endOffset=search.gt(levelGroups,levelGroupEnd,startOffset,levelGroups.length-1);ranges[level]=[startOffset+from,endOffset+from]}return ranges}(nminX,nminY,nmaxX,nmaxY,maxLevel);var selection=[];return function select(lox,loy,d,level,from,to){if(null!==from&&null!==to){var hix=lox+d,hiy=loy+d;if(!(nminX>hix||nminY>hiy||nmaxX<lox||nmaxY<loy||level>=maxLevel||from===to)){var levelItems=levels[level];void 0===to&&(to=levelItems.length);for(var i=from;i<to;i++){var id=levelItems[i],px=srcPoints[2*id],py=srcPoints[2*id+1];px>=minX&&px<=maxX&&py>=minY&&py<=maxY&&selection.push(id)}var offsets=sublevels[level],off0=offsets[4*from+0],off1=offsets[4*from+1],off2=offsets[4*from+2],off3=offsets[4*from+3],end=function nextOffset(offsets,from){for(var offset=null,i=0;null===offset;)if(offset=offsets[4*from+i],++i>offsets.length)return null;return offset}(offsets,from+1),d2=.5*d,nextLevel=level+1;select(lox,loy,d2,nextLevel,off0,off1||off2||off3||end),select(lox,loy+d2,d2,nextLevel,off1,off2||off3||end),select(lox+d2,loy,d2,nextLevel,off2,off3||end),select(lox+d2,loy+d2,d2,nextLevel,off3,end)}}}(0,0,1,0,0,1),selection},ids;function group(x,y,level){for(var group=1,cx=.5,cy=.5,diam=.5,i=0;i<level;i++)group<<=2,group+=x<cx?y<cy?0:1:y<cy?2:3,diam*=.5,cx+=x<cx?-diam:diam,cy+=y<cy?-diam:diam;return group}}},{"array-bounds":52,"binary-search-bounds":450,clamp:102,defined:148,dtype:153,"flatten-vertex-data":215,"is-obj":402,"math-log2":412,"parse-rect":439,"pick-by-alias":445}],452:[function(_dereq_,module,exports){module.exports=function preprocessPolygon(loops){for(var numLoops=loops.length,segments=[],vsegments=[],i=0;i<numLoops;++i)for(var loop=loops[i],numVertices=loop.length,s=numVertices-1,t=0;t<numVertices;s=t++){var a=loop[s],b=loop[t];a[0]===b[0]?vsegments.push([a,b]):segments.push([a,b])}if(0===segments.length)return 0===vsegments.length?classifyEmpty:function createClassifyVertical(testVertical){return function classify(p){return testVertical(p[0],p[1])?0:1}}(buildVerticalIndex(vsegments));var slabs=makeSlabs(segments),testSlab=function buildSlabSearch(slabs,coordinates){return function(p){var bucket=bsearch.le(coordinates,p[0]);if(bucket<0)return 1;var root=slabs[bucket];if(!root){if(!(bucket>0&&coordinates[bucket]===p[0]))return 1;root=slabs[bucket-1]}for(var lastOrientation=1;root;){var s=root.key,o=orient(p,s[0],s[1]);if(s[0][0]<s[1][0])if(o<0)root=root.left;else{if(!(o>0))return 0;lastOrientation=-1,root=root.right}else if(o>0)root=root.left;else{if(!(o<0))return 0;lastOrientation=1,root=root.right}}return lastOrientation}}(slabs.slabs,slabs.coordinates);return 0===vsegments.length?testSlab:function createClassifyPointDegen(testVertical,testNormal){return function classify(p){return testVertical(p[0],p[1])?0:testNormal(p)}}(buildVerticalIndex(vsegments),testSlab)};var orient=_dereq_("robust-orientation")[3],makeSlabs=_dereq_("slab-decomposition"),makeIntervalTree=_dereq_("interval-tree-1d"),bsearch=_dereq_("binary-search-bounds");function visitInterval(){return!0}function buildVerticalIndex(segments){for(var table={},i=0;i<segments.length;++i){var s=segments[i],x=s[0][0],y0=s[0][1],y1=s[1][1],p=[Math.min(y0,y1),Math.max(y0,y1)];x in table?table[x].push(p):table[x]=[p]}var intervalTable={},keys=Object.keys(table);for(i=0;i<keys.length;++i){var segs=table[keys[i]];intervalTable[keys[i]]=makeIntervalTree(segs)}return function intervalSearch(table){return function(x,y){var tree=table[x];return!!tree&&!!tree.queryPoint(y,visitInterval)}}(intervalTable)}function classifyEmpty(p){return 1}},{"binary-search-bounds":78,"interval-tree-1d":395,"robust-orientation":483,"slab-decomposition":499}],453:[function(_dereq_,module,exports){var PolyBool,BuildLog=_dereq_("./lib/build-log"),Epsilon=_dereq_("./lib/epsilon"),Intersecter=_dereq_("./lib/intersecter"),SegmentChainer=_dereq_("./lib/segment-chainer"),SegmentSelector=_dereq_("./lib/segment-selector"),GeoJSON=_dereq_("./lib/geojson"),buildLog=!1,epsilon=Epsilon();function operate(poly1,poly2,selector){var seg1=PolyBool.segments(poly1),seg2=PolyBool.segments(poly2),seg3=selector(PolyBool.combine(seg1,seg2));return PolyBool.polygon(seg3)}PolyBool={buildLog:function(bl){return!0===bl?buildLog=BuildLog():!1===bl&&(buildLog=!1),!1!==buildLog&&buildLog.list},epsilon:function(v){return epsilon.epsilon(v)},segments:function(poly){var i=Intersecter(!0,epsilon,buildLog);return poly.regions.forEach(i.addRegion),{segments:i.calculate(poly.inverted),inverted:poly.inverted}},combine:function(segments1,segments2){return{combined:Intersecter(!1,epsilon,buildLog).calculate(segments1.segments,segments1.inverted,segments2.segments,segments2.inverted),inverted1:segments1.inverted,inverted2:segments2.inverted}},selectUnion:function(combined){return{segments:SegmentSelector.union(combined.combined,buildLog),inverted:combined.inverted1||combined.inverted2}},selectIntersect:function(combined){return{segments:SegmentSelector.intersect(combined.combined,buildLog),inverted:combined.inverted1&&combined.inverted2}},selectDifference:function(combined){return{segments:SegmentSelector.difference(combined.combined,buildLog),inverted:combined.inverted1&&!combined.inverted2}},selectDifferenceRev:function(combined){return{segments:SegmentSelector.differenceRev(combined.combined,buildLog),inverted:!combined.inverted1&&combined.inverted2}},selectXor:function(combined){return{segments:SegmentSelector.xor(combined.combined,buildLog),inverted:combined.inverted1!==combined.inverted2}},polygon:function(segments){return{regions:SegmentChainer(segments.segments,epsilon,buildLog),inverted:segments.inverted}},polygonFromGeoJSON:function(geojson){return GeoJSON.toPolygon(PolyBool,geojson)},polygonToGeoJSON:function(poly){return GeoJSON.fromPolygon(PolyBool,epsilon,poly)},union:function(poly1,poly2){return operate(poly1,poly2,PolyBool.selectUnion)},intersect:function(poly1,poly2){return operate(poly1,poly2,PolyBool.selectIntersect)},difference:function(poly1,poly2){return operate(poly1,poly2,PolyBool.selectDifference)},differenceRev:function(poly1,poly2){return operate(poly1,poly2,PolyBool.selectDifferenceRev)},xor:function(poly1,poly2){return operate(poly1,poly2,PolyBool.selectXor)}},"object"==typeof window&&(window.PolyBool=PolyBool),module.exports=PolyBool},{"./lib/build-log":454,"./lib/epsilon":455,"./lib/geojson":456,"./lib/intersecter":457,"./lib/segment-chainer":459,"./lib/segment-selector":460}],454:[function(_dereq_,module,exports){module.exports=function BuildLog(){var my,nextSegmentId=0,curVert=!1;function push(type,data){return my.list.push({type:type,data:data?JSON.parse(JSON.stringify(data)):void 0}),my}return my={list:[],segmentId:function(){return nextSegmentId++},checkIntersection:function(seg1,seg2){return push("check",{seg1:seg1,seg2:seg2})},segmentChop:function(seg,end){return push("div_seg",{seg:seg,pt:end}),push("chop",{seg:seg,pt:end})},statusRemove:function(seg){return push("pop_seg",{seg:seg})},segmentUpdate:function(seg){return push("seg_update",{seg:seg})},segmentNew:function(seg,primary){return push("new_seg",{seg:seg,primary:primary})},segmentRemove:function(seg){return push("rem_seg",{seg:seg})},tempStatus:function(seg,above,below){return push("temp_status",{seg:seg,above:above,below:below})},rewind:function(seg){return push("rewind",{seg:seg})},status:function(seg,above,below){return push("status",{seg:seg,above:above,below:below})},vert:function(x){return x===curVert?my:(curVert=x,push("vert",{x:x}))},log:function(data){return"string"!=typeof data&&(data=JSON.stringify(data,!1,"  ")),push("log",{txt:data})},reset:function(){return push("reset")},selected:function(segs){return push("selected",{segs:segs})},chainStart:function(seg){return push("chain_start",{seg:seg})},chainRemoveHead:function(index,pt){return push("chain_rem_head",{index:index,pt:pt})},chainRemoveTail:function(index,pt){return push("chain_rem_tail",{index:index,pt:pt})},chainNew:function(pt1,pt2){return push("chain_new",{pt1:pt1,pt2:pt2})},chainMatch:function(index){return push("chain_match",{index:index})},chainClose:function(index){return push("chain_close",{index:index})},chainAddHead:function(index,pt){return push("chain_add_head",{index:index,pt:pt})},chainAddTail:function(index,pt){return push("chain_add_tail",{index:index,pt:pt})},chainConnect:function(index1,index2){return push("chain_con",{index1:index1,index2:index2})},chainReverse:function(index){return push("chain_rev",{index:index})},chainJoin:function(index1,index2){return push("chain_join",{index1:index1,index2:index2})},done:function(){return push("done")}}}},{}],455:[function(_dereq_,module,exports){module.exports=function Epsilon(eps){"number"!=typeof eps&&(eps=1e-10);var my={epsilon:function(v){return"number"==typeof v&&(eps=v),eps},pointAboveOrOnLine:function(pt,left,right){var Ax=left[0],Ay=left[1],Bx=right[0],By=right[1],Cx=pt[0];return(Bx-Ax)*(pt[1]-Ay)-(By-Ay)*(Cx-Ax)>=-eps},pointBetween:function(p,left,right){var d_py_ly=p[1]-left[1],d_rx_lx=right[0]-left[0],d_px_lx=p[0]-left[0],d_ry_ly=right[1]-left[1],dot=d_px_lx*d_rx_lx+d_py_ly*d_ry_ly;return!(dot<eps||dot-(d_rx_lx*d_rx_lx+d_ry_ly*d_ry_ly)>-eps)},pointsSameX:function(p1,p2){return Math.abs(p1[0]-p2[0])<eps},pointsSameY:function(p1,p2){return Math.abs(p1[1]-p2[1])<eps},pointsSame:function(p1,p2){return my.pointsSameX(p1,p2)&&my.pointsSameY(p1,p2)},pointsCompare:function(p1,p2){return my.pointsSameX(p1,p2)?my.pointsSameY(p1,p2)?0:p1[1]<p2[1]?-1:1:p1[0]<p2[0]?-1:1},pointsCollinear:function(pt1,pt2,pt3){var dx1=pt1[0]-pt2[0],dy1=pt1[1]-pt2[1],dx2=pt2[0]-pt3[0],dy2=pt2[1]-pt3[1];return Math.abs(dx1*dy2-dx2*dy1)<eps},linesIntersect:function(a0,a1,b0,b1){var adx=a1[0]-a0[0],ady=a1[1]-a0[1],bdx=b1[0]-b0[0],bdy=b1[1]-b0[1],axb=adx*bdy-ady*bdx;if(Math.abs(axb)<eps)return!1;var dx=a0[0]-b0[0],dy=a0[1]-b0[1],A=(bdx*dy-bdy*dx)/axb,B=(adx*dy-ady*dx)/axb,ret={alongA:0,alongB:0,pt:[a0[0]+A*adx,a0[1]+A*ady]};return ret.alongA=A<=-eps?-2:A<eps?-1:A-1<=-eps?0:A-1<eps?1:2,ret.alongB=B<=-eps?-2:B<eps?-1:B-1<=-eps?0:B-1<eps?1:2,ret},pointInsideRegion:function(pt,region){for(var x=pt[0],y=pt[1],last_x=region[region.length-1][0],last_y=region[region.length-1][1],inside=!1,i=0;i<region.length;i++){var curr_x=region[i][0],curr_y=region[i][1];curr_y-y>eps!=last_y-y>eps&&(last_x-curr_x)*(y-curr_y)/(last_y-curr_y)+curr_x-x>eps&&(inside=!inside),last_x=curr_x,last_y=curr_y}return inside}};return my}},{}],456:[function(_dereq_,module,exports){var GeoJSON={toPolygon:function(PolyBool,geojson){function GeoPoly(coords){if(coords.length<=0)return PolyBool.segments({inverted:!1,regions:[]});function LineString(ls){var reg=ls.slice(0,ls.length-1);return PolyBool.segments({inverted:!1,regions:[reg]})}for(var out=LineString(coords[0]),i=1;i<coords.length;i++)out=PolyBool.selectDifference(PolyBool.combine(out,LineString(coords[i])));return out}if("Polygon"===geojson.type)return PolyBool.polygon(GeoPoly(geojson.coordinates));if("MultiPolygon"===geojson.type){for(var out=PolyBool.segments({inverted:!1,regions:[]}),i=0;i<geojson.coordinates.length;i++)out=PolyBool.selectUnion(PolyBool.combine(out,GeoPoly(geojson.coordinates[i])));return PolyBool.polygon(out)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(PolyBool,eps,poly){function regionInsideRegion(r1,r2){return eps.pointInsideRegion([.5*(r1[0][0]+r1[1][0]),.5*(r1[0][1]+r1[1][1])],r2)}function newNode(region){return{region:region,children:[]}}poly=PolyBool.polygon(PolyBool.segments(poly));var roots=newNode(null);function addChild(root,region){for(var i=0;i<root.children.length;i++){if(regionInsideRegion(region,(child=root.children[i]).region))return void addChild(child,region)}var node=newNode(region);for(i=0;i<root.children.length;i++){var child;regionInsideRegion((child=root.children[i]).region,region)&&(node.children.push(child),root.children.splice(i,1),i--)}root.children.push(node)}for(var i=0;i<poly.regions.length;i++){var region=poly.regions[i];region.length<3||addChild(roots,region)}function forceWinding(region,clockwise){for(var winding=0,last_x=region[region.length-1][0],last_y=region[region.length-1][1],copy=[],i=0;i<region.length;i++){var curr_x=region[i][0],curr_y=region[i][1];copy.push([curr_x,curr_y]),winding+=curr_y*last_x-curr_x*last_y,last_x=curr_x,last_y=curr_y}return winding<0!==clockwise&&copy.reverse(),copy.push([copy[0][0],copy[0][1]]),copy}var geopolys=[];function addExterior(node){var poly=[forceWinding(node.region,!1)];geopolys.push(poly);for(var i=0;i<node.children.length;i++)poly.push(getInterior(node.children[i]))}function getInterior(node){for(var i=0;i<node.children.length;i++)addExterior(node.children[i]);return forceWinding(node.region,!0)}for(i=0;i<roots.children.length;i++)addExterior(roots.children[i]);return geopolys.length<=0?{type:"Polygon",coordinates:[]}:1==geopolys.length?{type:"Polygon",coordinates:geopolys[0]}:{type:"MultiPolygon",coordinates:geopolys}}};module.exports=GeoJSON},{}],457:[function(_dereq_,module,exports){var LinkedList=_dereq_("./linked-list");module.exports=function Intersecter(selfIntersection,eps,buildLog){function segmentCopy(start,end,seg){return{id:buildLog?buildLog.segmentId():-1,start:start,end:end,myFill:{above:seg.myFill.above,below:seg.myFill.below},otherFill:null}}var event_root=LinkedList.create();function eventAdd(ev,other_pt){event_root.insertBefore(ev,function(here){return function eventCompare(p1_isStart,p1_1,p1_2,p2_isStart,p2_1,p2_2){var comp=eps.pointsCompare(p1_1,p2_1);return 0!==comp?comp:eps.pointsSame(p1_2,p2_2)?0:p1_isStart!==p2_isStart?p1_isStart?1:-1:eps.pointAboveOrOnLine(p1_2,p2_isStart?p2_1:p2_2,p2_isStart?p2_2:p2_1)?1:-1}(ev.isStart,ev.pt,other_pt,here.isStart,here.pt,here.other.pt)<0})}function eventAddSegment(seg,primary){var ev_start=function eventAddSegmentStart(seg,primary){var ev_start=LinkedList.node({isStart:!0,pt:seg.start,seg:seg,primary:primary,other:null,status:null});return eventAdd(ev_start,seg.end),ev_start}(seg,primary);return function eventAddSegmentEnd(ev_start,seg,primary){var ev_end=LinkedList.node({isStart:!1,pt:seg.end,seg:seg,primary:primary,other:ev_start,status:null});ev_start.other=ev_end,eventAdd(ev_end,ev_start.pt)}(ev_start,seg,primary),ev_start}function eventDivide(ev,pt){var ns=segmentCopy(pt,ev.seg.end,ev.seg);return function eventUpdateEnd(ev,end){buildLog&&buildLog.segmentChop(ev.seg,end),ev.other.remove(),ev.seg.end=end,ev.other.pt=end,eventAdd(ev.other,ev.pt)}(ev,pt),eventAddSegment(ns,ev.primary)}function calculate(primaryPolyInverted,secondaryPolyInverted){var status_root=LinkedList.create();function statusFindSurrounding(ev){return status_root.findTransition(function(here){return function statusCompare(ev1,ev2){var a1=ev1.seg.start,a2=ev1.seg.end,b1=ev2.seg.start,b2=ev2.seg.end;return eps.pointsCollinear(a1,b1,b2)?eps.pointsCollinear(a2,b1,b2)?1:eps.pointAboveOrOnLine(a2,b1,b2)?1:-1:eps.pointAboveOrOnLine(a1,b1,b2)?1:-1}(ev,here.ev)>0})}function checkIntersection(ev1,ev2){var seg1=ev1.seg,seg2=ev2.seg,a1=seg1.start,a2=seg1.end,b1=seg2.start,b2=seg2.end;buildLog&&buildLog.checkIntersection(seg1,seg2);var i=eps.linesIntersect(a1,a2,b1,b2);if(!1===i){if(!eps.pointsCollinear(a1,a2,b1))return!1;if(eps.pointsSame(a1,b2)||eps.pointsSame(a2,b1))return!1;var a1_equ_b1=eps.pointsSame(a1,b1),a2_equ_b2=eps.pointsSame(a2,b2);if(a1_equ_b1&&a2_equ_b2)return ev2;var a1_between=!a1_equ_b1&&eps.pointBetween(a1,b1,b2),a2_between=!a2_equ_b2&&eps.pointBetween(a2,b1,b2);if(a1_equ_b1)return a2_between?eventDivide(ev2,a2):eventDivide(ev1,b2),ev2;a1_between&&(a2_equ_b2||(a2_between?eventDivide(ev2,a2):eventDivide(ev1,b2)),eventDivide(ev2,a1))}else 0===i.alongA&&(-1===i.alongB?eventDivide(ev1,b1):0===i.alongB?eventDivide(ev1,i.pt):1===i.alongB&&eventDivide(ev1,b2)),0===i.alongB&&(-1===i.alongA?eventDivide(ev2,a1):0===i.alongA?eventDivide(ev2,i.pt):1===i.alongA&&eventDivide(ev2,a2));return!1}for(var segments=[];!event_root.isEmpty();){var ev=event_root.getHead();if(buildLog&&buildLog.vert(ev.pt[0]),ev.isStart){buildLog&&buildLog.segmentNew(ev.seg,ev.primary);var surrounding=statusFindSurrounding(ev),above=surrounding.before?surrounding.before.ev:null,below=surrounding.after?surrounding.after.ev:null;function checkBothIntersections(){if(above){var eve=checkIntersection(ev,above);if(eve)return eve}return!!below&&checkIntersection(ev,below)}buildLog&&buildLog.tempStatus(ev.seg,!!above&&above.seg,!!below&&below.seg);var inside,toggle,eve=checkBothIntersections();if(eve)selfIntersection?(toggle=null===ev.seg.myFill.below||ev.seg.myFill.above!==ev.seg.myFill.below)&&(eve.seg.myFill.above=!eve.seg.myFill.above):eve.seg.otherFill=ev.seg.myFill,buildLog&&buildLog.segmentUpdate(eve.seg),ev.other.remove(),ev.remove();if(event_root.getHead()!==ev){buildLog&&buildLog.rewind(ev.seg);continue}selfIntersection?(toggle=null===ev.seg.myFill.below||ev.seg.myFill.above!==ev.seg.myFill.below,ev.seg.myFill.below=below?below.seg.myFill.above:primaryPolyInverted,ev.seg.myFill.above=toggle?!ev.seg.myFill.below:ev.seg.myFill.below):null===ev.seg.otherFill&&(inside=below?ev.primary===below.primary?below.seg.otherFill.above:below.seg.myFill.above:ev.primary?secondaryPolyInverted:primaryPolyInverted,ev.seg.otherFill={above:inside,below:inside}),buildLog&&buildLog.status(ev.seg,!!above&&above.seg,!!below&&below.seg),ev.other.status=surrounding.insert(LinkedList.node({ev:ev}))}else{var st=ev.status;if(null===st)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(status_root.exists(st.prev)&&status_root.exists(st.next)&&checkIntersection(st.prev.ev,st.next.ev),buildLog&&buildLog.statusRemove(st.ev.seg),st.remove(),!ev.primary){var s=ev.seg.myFill;ev.seg.myFill=ev.seg.otherFill,ev.seg.otherFill=s}segments.push(ev.seg)}event_root.getHead().remove()}return buildLog&&buildLog.done(),segments}return selfIntersection?{addRegion:function(region){for(var pt1,start,end,pt2=region[region.length-1],i=0;i<region.length;i++){pt1=pt2,pt2=region[i];var forward=eps.pointsCompare(pt1,pt2);0!==forward&&eventAddSegment((start=forward<0?pt1:pt2,end=forward<0?pt2:pt1,{id:buildLog?buildLog.segmentId():-1,start:start,end:end,myFill:{above:null,below:null},otherFill:null}),!0)}},calculate:function(inverted){return calculate(inverted,!1)}}:{calculate:function(segments1,inverted1,segments2,inverted2){return segments1.forEach(function(seg){eventAddSegment(segmentCopy(seg.start,seg.end,seg),!0)}),segments2.forEach(function(seg){eventAddSegment(segmentCopy(seg.start,seg.end,seg),!1)}),calculate(inverted1,inverted2)}}}},{"./linked-list":458}],458:[function(_dereq_,module,exports){module.exports={create:function(){var my={root:{root:!0,next:null},exists:function(node){return null!==node&&node!==my.root},isEmpty:function(){return null===my.root.next},getHead:function(){return my.root.next},insertBefore:function(node,check){for(var last=my.root,here=my.root.next;null!==here;){if(check(here))return node.prev=here.prev,node.next=here,here.prev.next=node,void(here.prev=node);last=here,here=here.next}last.next=node,node.prev=last,node.next=null},findTransition:function(check){for(var prev=my.root,here=my.root.next;null!==here&&!check(here);)prev=here,here=here.next;return{before:prev===my.root?null:prev,after:here,insert:function(node){return node.prev=prev,node.next=here,prev.next=node,null!==here&&(here.prev=node),node}}}};return my},node:function(data){return data.prev=null,data.next=null,data.remove=function(){data.prev.next=data.next,data.next&&(data.next.prev=data.prev),data.prev=null,data.next=null},data}}},{}],459:[function(_dereq_,module,exports){module.exports=function SegmentChainer(segments,eps,buildLog){var chains=[],regions=[];return segments.forEach(function(seg){var pt1=seg.start,pt2=seg.end;if(eps.pointsSame(pt1,pt2))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{buildLog&&buildLog.chainStart(seg);for(var first_match={index:0,matches_head:!1,matches_pt1:!1},second_match={index:0,matches_head:!1,matches_pt1:!1},next_match=first_match,i=0;i<chains.length;i++){var head=(chain=chains[i])[0],tail=(chain[1],chain[chain.length-1]);if(chain[chain.length-2],eps.pointsSame(head,pt1)){if(setMatch(i,!0,!0))break}else if(eps.pointsSame(head,pt2)){if(setMatch(i,!0,!1))break}else if(eps.pointsSame(tail,pt1)){if(setMatch(i,!1,!0))break}else if(eps.pointsSame(tail,pt2)&&setMatch(i,!1,!1))break}if(next_match===first_match)return chains.push([pt1,pt2]),void(buildLog&&buildLog.chainNew(pt1,pt2));if(next_match===second_match){buildLog&&buildLog.chainMatch(first_match.index);var index=first_match.index,pt=first_match.matches_pt1?pt2:pt1,addToHead=first_match.matches_head,chain=chains[index],grow=addToHead?chain[0]:chain[chain.length-1],grow2=addToHead?chain[1]:chain[chain.length-2],oppo=addToHead?chain[chain.length-1]:chain[0],oppo2=addToHead?chain[chain.length-2]:chain[1];return eps.pointsCollinear(grow2,grow,pt)&&(addToHead?(buildLog&&buildLog.chainRemoveHead(first_match.index,pt),chain.shift()):(buildLog&&buildLog.chainRemoveTail(first_match.index,pt),chain.pop()),grow=grow2),eps.pointsSame(oppo,pt)?(chains.splice(index,1),eps.pointsCollinear(oppo2,oppo,grow)&&(addToHead?(buildLog&&buildLog.chainRemoveTail(first_match.index,grow),chain.pop()):(buildLog&&buildLog.chainRemoveHead(first_match.index,grow),chain.shift())),buildLog&&buildLog.chainClose(first_match.index),void regions.push(chain)):void(addToHead?(buildLog&&buildLog.chainAddHead(first_match.index,pt),chain.unshift(pt)):(buildLog&&buildLog.chainAddTail(first_match.index,pt),chain.push(pt)))}var F=first_match.index,S=second_match.index;buildLog&&buildLog.chainConnect(F,S);var reverseF=chains[F].length<chains[S].length;first_match.matches_head?second_match.matches_head?reverseF?(reverseChain(F),appendChain(F,S)):(reverseChain(S),appendChain(S,F)):appendChain(S,F):second_match.matches_head?appendChain(F,S):reverseF?(reverseChain(F),appendChain(S,F)):(reverseChain(S),appendChain(F,S))}function setMatch(index,matches_head,matches_pt1){return next_match.index=index,next_match.matches_head=matches_head,next_match.matches_pt1=matches_pt1,next_match===first_match?(next_match=second_match,!1):(next_match=null,!0)}function reverseChain(index){buildLog&&buildLog.chainReverse(index),chains[index].reverse()}function appendChain(index1,index2){var chain1=chains[index1],chain2=chains[index2],tail=chain1[chain1.length-1],tail2=chain1[chain1.length-2],head=chain2[0],head2=chain2[1];eps.pointsCollinear(tail2,tail,head)&&(buildLog&&buildLog.chainRemoveTail(index1,tail),chain1.pop(),tail=tail2),eps.pointsCollinear(tail,head,head2)&&(buildLog&&buildLog.chainRemoveHead(index2,head),chain2.shift()),buildLog&&buildLog.chainJoin(index1,index2),chains[index1]=chain1.concat(chain2),chains.splice(index2,1)}}),regions}},{}],460:[function(_dereq_,module,exports){function select(segments,selection,buildLog){var result=[];return segments.forEach(function(seg){var index=(seg.myFill.above?8:0)+(seg.myFill.below?4:0)+(seg.otherFill&&seg.otherFill.above?2:0)+(seg.otherFill&&seg.otherFill.below?1:0);0!==selection[index]&&result.push({id:buildLog?buildLog.segmentId():-1,start:seg.start,end:seg.end,myFill:{above:1===selection[index],below:2===selection[index]},otherFill:null})}),buildLog&&buildLog.selected(result),result}var SegmentSelector={union:function(segments,buildLog){return select(segments,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],buildLog)},intersect:function(segments,buildLog){return select(segments,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],buildLog)},difference:function(segments,buildLog){return select(segments,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],buildLog)},differenceRev:function(segments,buildLog){return select(segments,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],buildLog)},xor:function(segments,buildLog){return select(segments,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],buildLog)}};module.exports=SegmentSelector},{}],461:[function(_dereq_,module,exports){"use strict";var diff=new Float64Array(4),edge0=new Float64Array(4),edge1=new Float64Array(4);module.exports=function closestPoint2d(V0,V1,V2,point,result){diff.length<point.length&&(diff=new Float64Array(point.length),edge0=new Float64Array(point.length),edge1=new Float64Array(point.length));for(var i=0;i<point.length;++i)diff[i]=V0[i]-point[i],edge0[i]=V1[i]-V0[i],edge1[i]=V2[i]-V0[i];var a00=0,a01=0,a11=0,b0=0,b1=0,c=0;for(i=0;i<point.length;++i){var e0=edge0[i],e1=edge1[i],d=diff[i];a00+=e0*e0,a01+=e0*e1,a11+=e1*e1,b0+=d*e0,b1+=d*e1,c+=d*d}var sqrDistance,tmp0,tmp1,numer,denom,det=Math.abs(a00*a11-a01*a01),s=a01*b1-a11*b0,t=a01*b0-a00*b1;if(s+t<=det)if(s<0)t<0&&b0<0?(t=0,-b0>=a00?(s=1,sqrDistance=a00+2*b0+c):sqrDistance=b0*(s=-b0/a00)+c):(s=0,b1>=0?(t=0,sqrDistance=c):-b1>=a11?(t=1,sqrDistance=a11+2*b1+c):sqrDistance=b1*(t=-b1/a11)+c);else if(t<0)t=0,b0>=0?(s=0,sqrDistance=c):-b0>=a00?(s=1,sqrDistance=a00+2*b0+c):sqrDistance=b0*(s=-b0/a00)+c;else{var invDet=1/det;sqrDistance=(s*=invDet)*(a00*s+a01*(t*=invDet)+2*b0)+t*(a01*s+a11*t+2*b1)+c}else s<0?(tmp1=a11+b1)>(tmp0=a01+b0)?(numer=tmp1-tmp0)>=(denom=a00-2*a01+a11)?(s=1,t=0,sqrDistance=a00+2*b0+c):sqrDistance=(s=numer/denom)*(a00*s+a01*(t=1-s)+2*b0)+t*(a01*s+a11*t+2*b1)+c:(s=0,tmp1<=0?(t=1,sqrDistance=a11+2*b1+c):b1>=0?(t=0,sqrDistance=c):sqrDistance=b1*(t=-b1/a11)+c):t<0?(tmp1=a00+b0)>(tmp0=a01+b1)?(numer=tmp1-tmp0)>=(denom=a00-2*a01+a11)?(t=1,s=0,sqrDistance=a11+2*b1+c):sqrDistance=(s=1-(t=numer/denom))*(a00*s+a01*t+2*b0)+t*(a01*s+a11*t+2*b1)+c:(t=0,tmp1<=0?(s=1,sqrDistance=a00+2*b0+c):b0>=0?(s=0,sqrDistance=c):sqrDistance=b0*(s=-b0/a00)+c):(numer=a11+b1-a01-b0)<=0?(s=0,t=1,sqrDistance=a11+2*b1+c):numer>=(denom=a00-2*a01+a11)?(s=1,t=0,sqrDistance=a00+2*b0+c):sqrDistance=(s=numer/denom)*(a00*s+a01*(t=1-s)+2*b0)+t*(a01*s+a11*t+2*b1)+c;var u=1-s-t;for(i=0;i<point.length;++i)result[i]=u*V0[i]+s*V1[i]+t*V2[i];return sqrDistance<0?0:sqrDistance}},{}],462:[function(_dereq_,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],463:[function(_dereq_,module,exports){module.exports=_dereq_("gl-quat/slerp")},{"gl-quat/slerp":279}],464:[function(_dereq_,module,exports){(function(global){for(var now=_dereq_("performance-now"),root="undefined"==typeof window?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix],i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[];raf=function(callback){if(0===queue.length){var _now=now(),next=Math.max(0,1e3/60-(_now-last));last=next+_now,setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++)if(!cp[i].cancelled)try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}},Math.round(next))}return queue.push({handle:++id,callback:callback,cancelled:!1}),id},caf=function(handle){for(var i=0;i<queue.length;i++)queue[i].handle===handle&&(queue[i].cancelled=!0)}}module.exports=function(fn){return raf.call(root,fn)},module.exports.cancel=function(){caf.apply(root,arguments)},module.exports.polyfill=function(object){object||(object=root),object.requestAnimationFrame=raf,object.cancelAnimationFrame=caf}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":442}],465:[function(_dereq_,module,exports){"use strict";var bnadd=_dereq_("big-rat/add");module.exports=function add(a,b){for(var n=a.length,r=new Array(n),i=0;i<n;++i)r[i]=bnadd(a[i],b[i]);return r}},{"big-rat/add":62}],466:[function(_dereq_,module,exports){"use strict";module.exports=function float2rat(v){for(var result=new Array(v.length),i=0;i<v.length;++i)result[i]=rat(v[i]);return result};var rat=_dereq_("big-rat")},{"big-rat":65}],467:[function(_dereq_,module,exports){"use strict";var rat=_dereq_("big-rat"),mul=_dereq_("big-rat/mul");module.exports=function muls(a,x){for(var s=rat(x),n=a.length,r=new Array(n),i=0;i<n;++i)r[i]=mul(a[i],s);return r}},{"big-rat":65,"big-rat/mul":74}],468:[function(_dereq_,module,exports){"use strict";var bnsub=_dereq_("big-rat/sub");module.exports=function sub(a,b){for(var n=a.length,r=new Array(n),i=0;i<n;++i)r[i]=bnsub(a[i],b[i]);return r}},{"big-rat/sub":76}],469:[function(_dereq_,module,exports){"use strict";var compareCell=_dereq_("compare-cell"),compareOrientedCell=_dereq_("compare-oriented-cell"),orientation=_dereq_("cell-orientation");module.exports=function reduceCellComplex(cells){cells.sort(compareOrientedCell);for(var n=cells.length,ptr=0,i=0;i<n;++i){var c=cells[i],o=orientation(c);if(0!==o){if(ptr>0){var f=cells[ptr-1];if(0===compareCell(c,f)&&orientation(f)!==o){ptr-=1;continue}}cells[ptr++]=c}}return cells.length=ptr,cells}},{"cell-orientation":99,"compare-cell":115,"compare-oriented-cell":116}],470:[function(_dereq_,module,exports){"use strict";var getBounds=_dereq_("array-bounds"),rgba=_dereq_("color-normalize"),updateDiff=_dereq_("update-diff"),pick=_dereq_("pick-by-alias"),extend=_dereq_("object-assign"),flatten=_dereq_("flatten-vertex-data"),ref=_dereq_("to-float32"),float32=ref.float32,fract32=ref.fract32;module.exports=function Error2D(regl,options){"function"==typeof regl?(options||(options={}),options.regl=regl):options=regl;options.length&&(options.positions=options);if(!(regl=options.regl).hasExtension("ANGLE_instanced_arrays"))throw Error("regl-error2d: `ANGLE_instanced_arrays` extension should be enabled");var drawErrors,positionBuffer,positionFractBuffer,colorBuffer,errorBuffer,meshBuffer,gl=regl._gl,defaults={color:"black",capSize:5,lineWidth:1,opacity:1,viewport:null,range:null,offset:0,count:0,bounds:null,positions:[],errors:[]},groups=[];return colorBuffer=regl.buffer({usage:"dynamic",type:"uint8",data:new Uint8Array(0)}),positionBuffer=regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array(0)}),positionFractBuffer=regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array(0)}),errorBuffer=regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array(0)}),meshBuffer=regl.buffer({usage:"static",type:"float",data:WEIGHTS}),update(options),drawErrors=regl({vert:"\n\t\tprecision highp float;\n\n\t\tattribute vec2 position, positionFract;\n\t\tattribute vec4 error;\n\t\tattribute vec4 color;\n\n\t\tattribute vec2 direction, lineOffset, capOffset;\n\n\t\tuniform vec4 viewport;\n\t\tuniform float lineWidth, capSize;\n\t\tuniform vec2 scale, scaleFract, translate, translateFract;\n\n\t\tvarying vec4 fragColor;\n\n\t\tvoid main() {\n\t\t\tfragColor = color / 255.;\n\n\t\t\tvec2 pixelOffset = lineWidth * lineOffset + (capSize + lineWidth) * capOffset;\n\n\t\t\tvec2 dxy = -step(.5, direction.xy) * error.xz + step(direction.xy, vec2(-.5)) * error.yw;\n\n\t\t\tvec2 position = position + dxy;\n\n\t\t\tvec2 pos = (position + translate) * scale\n\t\t\t\t+ (positionFract + translateFract) * scale\n\t\t\t\t+ (position + translate) * scaleFract\n\t\t\t\t+ (positionFract + translateFract) * scaleFract;\n\n\t\t\tpos += pixelOffset / viewport.zw;\n\n\t\t\tgl_Position = vec4(pos * 2. - 1., 0, 1);\n\t\t}\n\t\t",frag:"\n\t\tprecision mediump float;\n\n\t\tvarying vec4 fragColor;\n\n\t\tuniform float opacity;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = fragColor;\n\t\t\tgl_FragColor.a *= opacity;\n\t\t}\n\t\t",uniforms:{range:regl.prop("range"),lineWidth:regl.prop("lineWidth"),capSize:regl.prop("capSize"),opacity:regl.prop("opacity"),scale:regl.prop("scale"),translate:regl.prop("translate"),scaleFract:regl.prop("scaleFract"),translateFract:regl.prop("translateFract"),viewport:function(ctx,prop){return[prop.viewport.x,prop.viewport.y,ctx.viewportWidth,ctx.viewportHeight]}},attributes:{color:{buffer:colorBuffer,offset:function(ctx,prop){return 4*prop.offset},divisor:1},position:{buffer:positionBuffer,offset:function(ctx,prop){return 8*prop.offset},divisor:1},positionFract:{buffer:positionFractBuffer,offset:function(ctx,prop){return 8*prop.offset},divisor:1},error:{buffer:errorBuffer,offset:function(ctx,prop){return 16*prop.offset},divisor:1},direction:{buffer:meshBuffer,stride:24,offset:0},lineOffset:{buffer:meshBuffer,stride:24,offset:8},capOffset:{buffer:meshBuffer,stride:24,offset:16}},primitive:"triangles",blend:{enable:!0,color:[0,0,0,0],equation:{rgb:"add",alpha:"add"},func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},depth:{enable:!1},scissor:{enable:!0,box:regl.prop("viewport")},viewport:regl.prop("viewport"),stencil:!1,instances:regl.prop("count"),count:WEIGHTS.length}),extend(error2d,{update:update,draw:draw,destroy:destroy,regl:regl,gl:gl,canvas:gl.canvas,groups:groups}),error2d;function error2d(opts){opts?update(opts):null===opts&&destroy(),draw()}function draw(options){if("number"==typeof options)return drawGroup(options);options&&!Array.isArray(options)&&(options=[options]),regl._refresh(),groups.forEach(function(s,i){s&&(options&&(options[i]?s.draw=!0:s.draw=!1),s.draw?drawGroup(i):s.draw=!0)})}function drawGroup(s){"number"==typeof s&&(s=groups[s]),null!=s&&s&&s.count&&s.color&&s.opacity&&s.positions&&s.positions.length>1&&(s.scaleRatio=[s.scale[0]*s.viewport.width,s.scale[1]*s.viewport.height],drawErrors(s),s.after&&s.after(s))}function update(options){if(options){null!=options.length?"number"==typeof options[0]&&(options=[{positions:options}]):Array.isArray(options)||(options=[options]);var pointCount=0,errorCount=0;if(error2d.groups=groups=options.map(function(options,i){var group=groups[i];return options?("function"==typeof options?options={after:options}:"number"==typeof options[0]&&(options={positions:options}),options=pick(options,{color:"color colors fill",capSize:"capSize cap capsize cap-size",lineWidth:"lineWidth line-width width line thickness",opacity:"opacity alpha",range:"range dataBox",viewport:"viewport viewBox",errors:"errors error",positions:"positions position data points"}),group||(groups[i]=group={id:i,scale:null,translate:null,scaleFract:null,translateFract:null,draw:!0},options=extend({},defaults,options)),updateDiff(group,options,[{lineWidth:function(v){return.5*+v},capSize:function(v){return.5*+v},opacity:parseFloat,errors:function(errors){return errors=flatten(errors),errorCount+=errors.length,errors},positions:function(positions,state){return positions=flatten(positions,"float64"),state.count=Math.floor(positions.length/2),state.bounds=getBounds(positions,2),state.offset=pointCount,pointCount+=state.count,positions}},{color:function(colors,state){var count=state.count;if(colors||(colors="transparent"),!Array.isArray(colors)||"number"==typeof colors[0]){var color=colors;colors=Array(count);for(var i=0;i<count;i++)colors[i]=color}if(colors.length<count)throw Error("Not enough colors");for(var colorData=new Uint8Array(4*count),i$1=0;i$1<count;i$1++){var c=rgba(colors[i$1],"uint8");colorData.set(c,4*i$1)}return colorData},range:function(range,state,options){var bounds=state.bounds;return range||(range=bounds),state.scale=[1/(range[2]-range[0]),1/(range[3]-range[1])],state.translate=[-range[0],-range[1]],state.scaleFract=fract32(state.scale),state.translateFract=fract32(state.translate),range},viewport:function(vp){var viewport;return Array.isArray(vp)?viewport={x:vp[0],y:vp[1],width:vp[2]-vp[0],height:vp[3]-vp[1]}:vp?(viewport={x:vp.x||vp.left||0,y:vp.y||vp.top||0},vp.right?viewport.width=vp.right-viewport.x:viewport.width=vp.w||vp.width||0,vp.bottom?viewport.height=vp.bottom-viewport.y:viewport.height=vp.h||vp.height||0):viewport={x:0,y:0,width:gl.drawingBufferWidth,height:gl.drawingBufferHeight},viewport}}]),group):group}),pointCount||errorCount){var len=groups.reduce(function(acc,group,i){return acc+(group?group.count:0)},0),positionData=new Float64Array(2*len),colorData=new Uint8Array(4*len),errorData=new Float32Array(4*len);groups.forEach(function(group,i){if(group){var positions=group.positions,count=group.count,offset=group.offset,color=group.color,errors=group.errors;count&&(colorData.set(color,4*offset),errorData.set(errors,4*offset),positionData.set(positions,2*offset))}}),positionBuffer(float32(positionData)),positionFractBuffer(fract32(positionData)),colorBuffer(colorData),errorBuffer(errorData)}}}function destroy(){positionBuffer.destroy(),positionFractBuffer.destroy(),colorBuffer.destroy(),errorBuffer.destroy(),meshBuffer.destroy()}};var WEIGHTS=[[1,0,0,1,0,0],[1,0,0,-1,0,0],[-1,0,0,-1,0,0],[-1,0,0,-1,0,0],[-1,0,0,1,0,0],[1,0,0,1,0,0],[1,0,-1,0,0,1],[1,0,-1,0,0,-1],[1,0,1,0,0,-1],[1,0,1,0,0,-1],[1,0,1,0,0,1],[1,0,-1,0,0,1],[-1,0,-1,0,0,1],[-1,0,-1,0,0,-1],[-1,0,1,0,0,-1],[-1,0,1,0,0,-1],[-1,0,1,0,0,1],[-1,0,-1,0,0,1],[0,1,1,0,0,0],[0,1,-1,0,0,0],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[0,1,1,0,0,0],[0,-1,1,0,0,0],[0,1,0,-1,1,0],[0,1,0,-1,-1,0],[0,1,0,1,-1,0],[0,1,0,1,1,0],[0,1,0,-1,1,0],[0,1,0,1,-1,0],[0,-1,0,-1,1,0],[0,-1,0,-1,-1,0],[0,-1,0,1,-1,0],[0,-1,0,1,1,0],[0,-1,0,-1,1,0],[0,-1,0,1,-1,0]]},{"array-bounds":52,"color-normalize":107,"flatten-vertex-data":215,"object-assign":434,"pick-by-alias":445,"to-float32":512,"update-diff":523}],471:[function(_dereq_,module,exports){"use strict";var rgba=_dereq_("color-normalize"),getBounds=_dereq_("array-bounds"),extend=_dereq_("object-assign"),glslify=_dereq_("glslify"),pick=_dereq_("pick-by-alias"),flatten=_dereq_("flatten-vertex-data"),triangulate=_dereq_("earcut"),normalize=_dereq_("array-normalize"),ref=_dereq_("to-float32"),float32=ref.float32,fract32=ref.fract32,WeakMap=_dereq_("es6-weak-map"),parseRect=_dereq_("parse-rect");function Line2D(regl,options){if(!(this instanceof Line2D))return new Line2D(regl,options);if("function"==typeof regl?(options||(options={}),options.regl=regl):options=regl,options.length&&(options.positions=options),!(regl=options.regl).hasExtension("ANGLE_instanced_arrays"))throw Error("regl-error2d: `ANGLE_instanced_arrays` extension should be enabled");this.gl=regl._gl,this.regl=regl,this.passes=[],this.shaders=Line2D.shaders.has(regl)?Line2D.shaders.get(regl):Line2D.shaders.set(regl,Line2D.createShaders(regl)).get(regl),this.update(options)}module.exports=Line2D,Line2D.dashMult=2,Line2D.maxPatternLength=256,Line2D.precisionThreshold=3e6,Line2D.maxPoints=1e4,Line2D.maxLines=2048,Line2D.shaders=new WeakMap,Line2D.createShaders=function(regl){var drawMiterLine,offsetBuffer=regl.buffer({usage:"static",type:"float",data:[0,1,0,0,1,1,1,0]}),shaderOptions={primitive:"triangle strip",instances:regl.prop("count"),count:4,offset:0,uniforms:{miterMode:function(ctx,prop){return"round"===prop.join?2:1},miterLimit:regl.prop("miterLimit"),scale:regl.prop("scale"),scaleFract:regl.prop("scaleFract"),translateFract:regl.prop("translateFract"),translate:regl.prop("translate"),thickness:regl.prop("thickness"),dashPattern:regl.prop("dashTexture"),opacity:regl.prop("opacity"),pixelRatio:regl.context("pixelRatio"),id:regl.prop("id"),dashSize:regl.prop("dashLength"),viewport:function(c,p){return[p.viewport.x,p.viewport.y,c.viewportWidth,c.viewportHeight]},depth:regl.prop("depth")},blend:{enable:!0,color:[0,0,0,0],equation:{rgb:"add",alpha:"add"},func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},depth:{enable:function(c,p){return!p.overlay}},stencil:{enable:!1},scissor:{enable:!0,box:regl.prop("viewport")},viewport:regl.prop("viewport")},drawRectLine=regl(extend({vert:glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec2 aCoord, bCoord, aCoordFract, bCoordFract;\nattribute vec4 color;\nattribute float lineEnd, lineTop;\n\nuniform vec2 scale, scaleFract, translate, translateFract;\nuniform float thickness, pixelRatio, id, depth;\nuniform vec4 viewport;\n\nvarying vec4 fragColor;\nvarying vec2 tangent;\n\nvec2 project(vec2 position, vec2 positionFract, vec2 scale, vec2 scaleFract, vec2 translate, vec2 translateFract) {\n\t// the order is important\n\treturn position * scale + translate\n       + positionFract * scale + translateFract\n       + position * scaleFract\n       + positionFract * scaleFract;\n}\n\nvoid main() {\n\tfloat lineStart = 1. - lineEnd;\n\tfloat lineOffset = lineTop * 2. - 1.;\n\n\tvec2 diff = (bCoord + bCoordFract - aCoord - aCoordFract);\n\ttangent = normalize(diff * scale * viewport.zw);\n\tvec2 normal = vec2(-tangent.y, tangent.x);\n\n\tvec2 position = project(aCoord, aCoordFract, scale, scaleFract, translate, translateFract) * lineStart\n\t\t+ project(bCoord, bCoordFract, scale, scaleFract, translate, translateFract) * lineEnd\n\n\t\t+ thickness * normal * .5 * lineOffset / viewport.zw;\n\n\tgl_Position = vec4(position * 2.0 - 1.0, depth, 1);\n\n\tfragColor = color / 255.;\n}\n"]),frag:glslify(["precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D dashPattern;\n\nuniform float dashSize, pixelRatio, thickness, opacity, id;\n\nvarying vec4 fragColor;\nvarying vec2 tangent;\n\nvoid main() {\n\tfloat alpha = 1.;\n\n\tfloat t = fract(dot(tangent, gl_FragCoord.xy) / dashSize) * .5 + .25;\n\tfloat dash = texture2D(dashPattern, vec2(t, .5)).r;\n\n\tgl_FragColor = fragColor;\n\tgl_FragColor.a *= alpha * opacity * dash;\n}\n"]),attributes:{lineEnd:{buffer:offsetBuffer,divisor:0,stride:8,offset:0},lineTop:{buffer:offsetBuffer,divisor:0,stride:8,offset:4},aCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:8,divisor:1},bCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:16,divisor:1},aCoordFract:{buffer:regl.prop("positionFractBuffer"),stride:8,offset:8,divisor:1},bCoordFract:{buffer:regl.prop("positionFractBuffer"),stride:8,offset:16,divisor:1},color:{buffer:regl.prop("colorBuffer"),stride:4,offset:0,divisor:1}}},shaderOptions));try{drawMiterLine=regl(extend({cull:{enable:!0,face:"back"},vert:glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec2 aCoord, bCoord, nextCoord, prevCoord;\nattribute vec4 aColor, bColor;\nattribute float lineEnd, lineTop;\n\nuniform vec2 scale, translate;\nuniform float thickness, pixelRatio, id, depth;\nuniform vec4 viewport;\nuniform float miterLimit, miterMode;\n\nvarying vec4 fragColor;\nvarying vec4 startCutoff, endCutoff;\nvarying vec2 tangent;\nvarying vec2 startCoord, endCoord;\nvarying float enableStartMiter, enableEndMiter;\n\nconst float REVERSE_THRESHOLD = -.875;\nconst float MIN_DIFF = 1e-6;\n\n// TODO: possible optimizations: avoid overcalculating all for vertices and calc just one instead\n// TODO: precalculate dot products, normalize things beforehead etc.\n// TODO: refactor to rectangular algorithm\n\nfloat distToLine(vec2 p, vec2 a, vec2 b) {\n\tvec2 diff = b - a;\n\tvec2 perp = normalize(vec2(-diff.y, diff.x));\n\treturn dot(p - a, perp);\n}\n\nbool isNaN( float val ){\n  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n}\n\nvoid main() {\n\tvec2 aCoord = aCoord, bCoord = bCoord, prevCoord = prevCoord, nextCoord = nextCoord;\n\n\t// adjust scale for horizontal bars\n\tvec2 scale = max(scale, MIN_DIFF);\n\tvec2 scaleRatio = scale * viewport.zw;\n\n\tvec2 normalWidth = thickness / scaleRatio;\n\n\tfloat lineStart = 1. - lineEnd;\n\tfloat lineBot = 1. - lineTop;\n\n\tfragColor = (lineStart * aColor + lineEnd * bColor) / 255.;\n\n\tif (isNaN(aCoord.x) || isNaN(aCoord.y) || isNaN(bCoord.x) || isNaN(bCoord.y)) return;\n\n\tif (aCoord == prevCoord) prevCoord = aCoord + normalize(bCoord - aCoord);\n\tif (bCoord == nextCoord) nextCoord = bCoord - normalize(bCoord - aCoord);\n\n\tvec2 prevDiff = aCoord - prevCoord;\n\tvec2 currDiff = bCoord - aCoord;\n\tvec2 nextDiff = nextCoord - bCoord;\n\n\tvec2 prevTangent = normalize(prevDiff * scaleRatio);\n\tvec2 currTangent = normalize(currDiff * scaleRatio);\n\tvec2 nextTangent = normalize(nextDiff * scaleRatio);\n\n\tvec2 prevNormal = vec2(-prevTangent.y, prevTangent.x);\n\tvec2 currNormal = vec2(-currTangent.y, currTangent.x);\n\tvec2 nextNormal = vec2(-nextTangent.y, nextTangent.x);\n\n\tvec2 startJoinDirection = normalize(prevTangent - currTangent);\n\tvec2 endJoinDirection = normalize(currTangent - nextTangent);\n\n\t// collapsed/unidirectional segment cases\n\t// FIXME: there should be more elegant solution\n\tvec2 prevTanDiff = abs(prevTangent - currTangent);\n\tvec2 nextTanDiff = abs(nextTangent - currTangent);\n\tif (max(prevTanDiff.x, prevTanDiff.y) < MIN_DIFF) {\n\t\tstartJoinDirection = currNormal;\n\t}\n\tif (max(nextTanDiff.x, nextTanDiff.y) < MIN_DIFF) {\n\t\tendJoinDirection = currNormal;\n\t}\n\tif (aCoord == bCoord) {\n\t\tendJoinDirection = startJoinDirection;\n\t\tcurrNormal = prevNormal;\n\t\tcurrTangent = prevTangent;\n\t}\n\n\ttangent = currTangent;\n\n\t//calculate join shifts relative to normals\n\tfloat startJoinShift = dot(currNormal, startJoinDirection);\n\tfloat endJoinShift = dot(currNormal, endJoinDirection);\n\n\tfloat startMiterRatio = abs(1. / startJoinShift);\n\tfloat endMiterRatio = abs(1. / endJoinShift);\n\n\tvec2 startJoin = startJoinDirection * startMiterRatio;\n\tvec2 endJoin = endJoinDirection * endMiterRatio;\n\n\tvec2 startTopJoin, startBotJoin, endTopJoin, endBotJoin;\n\tstartTopJoin = sign(startJoinShift) * startJoin * .5;\n\tstartBotJoin = -startTopJoin;\n\n\tendTopJoin = sign(endJoinShift) * endJoin * .5;\n\tendBotJoin = -endTopJoin;\n\n\tvec2 aTopCoord = aCoord + normalWidth * startTopJoin;\n\tvec2 bTopCoord = bCoord + normalWidth * endTopJoin;\n\tvec2 aBotCoord = aCoord + normalWidth * startBotJoin;\n\tvec2 bBotCoord = bCoord + normalWidth * endBotJoin;\n\n\t//miter anti-clipping\n\tfloat baClipping = distToLine(bCoord, aCoord, aBotCoord) / dot(normalize(normalWidth * endBotJoin), normalize(normalWidth.yx * vec2(-startBotJoin.y, startBotJoin.x)));\n\tfloat abClipping = distToLine(aCoord, bCoord, bTopCoord) / dot(normalize(normalWidth * startBotJoin), normalize(normalWidth.yx * vec2(-endBotJoin.y, endBotJoin.x)));\n\n\t//prevent close to reverse direction switch\n\tbool prevReverse = dot(currTangent, prevTangent) <= REVERSE_THRESHOLD && abs(dot(currTangent, prevNormal)) * min(length(prevDiff), length(currDiff)) <  length(normalWidth * currNormal);\n\tbool nextReverse = dot(currTangent, nextTangent) <= REVERSE_THRESHOLD && abs(dot(currTangent, nextNormal)) * min(length(nextDiff), length(currDiff)) <  length(normalWidth * currNormal);\n\n\tif (prevReverse) {\n\t\t//make join rectangular\n\t\tvec2 miterShift = normalWidth * startJoinDirection * miterLimit * .5;\n\t\tfloat normalAdjust = 1. - min(miterLimit / startMiterRatio, 1.);\n\t\taBotCoord = aCoord + miterShift - normalAdjust * normalWidth * currNormal * .5;\n\t\taTopCoord = aCoord + miterShift + normalAdjust * normalWidth * currNormal * .5;\n\t}\n\telse if (!nextReverse && baClipping > 0. && baClipping < length(normalWidth * endBotJoin)) {\n\t\t//handle miter clipping\n\t\tbTopCoord -= normalWidth * endTopJoin;\n\t\tbTopCoord += normalize(endTopJoin * normalWidth) * baClipping;\n\t}\n\n\tif (nextReverse) {\n\t\t//make join rectangular\n\t\tvec2 miterShift = normalWidth * endJoinDirection * miterLimit * .5;\n\t\tfloat normalAdjust = 1. - min(miterLimit / endMiterRatio, 1.);\n\t\tbBotCoord = bCoord + miterShift - normalAdjust * normalWidth * currNormal * .5;\n\t\tbTopCoord = bCoord + miterShift + normalAdjust * normalWidth * currNormal * .5;\n\t}\n\telse if (!prevReverse && abClipping > 0. && abClipping < length(normalWidth * startBotJoin)) {\n\t\t//handle miter clipping\n\t\taBotCoord -= normalWidth * startBotJoin;\n\t\taBotCoord += normalize(startBotJoin * normalWidth) * abClipping;\n\t}\n\n\tvec2 aTopPosition = (aTopCoord) * scale + translate;\n\tvec2 aBotPosition = (aBotCoord) * scale + translate;\n\n\tvec2 bTopPosition = (bTopCoord) * scale + translate;\n\tvec2 bBotPosition = (bBotCoord) * scale + translate;\n\n\t//position is normalized 0..1 coord on the screen\n\tvec2 position = (aTopPosition * lineTop + aBotPosition * lineBot) * lineStart + (bTopPosition * lineTop + bBotPosition * lineBot) * lineEnd;\n\n\tstartCoord = aCoord * scaleRatio + translate * viewport.zw + viewport.xy;\n\tendCoord = bCoord * scaleRatio + translate * viewport.zw + viewport.xy;\n\n\tgl_Position = vec4(position  * 2.0 - 1.0, depth, 1);\n\n\tenableStartMiter = step(dot(currTangent, prevTangent), .5);\n\tenableEndMiter = step(dot(currTangent, nextTangent), .5);\n\n\t//bevel miter cutoffs\n\tif (miterMode == 1.) {\n\t\tif (enableStartMiter == 1.) {\n\t\t\tvec2 startMiterWidth = vec2(startJoinDirection) * thickness * miterLimit * .5;\n\t\t\tstartCutoff = vec4(aCoord, aCoord);\n\t\t\tstartCutoff.zw += vec2(-startJoinDirection.y, startJoinDirection.x) / scaleRatio;\n\t\t\tstartCutoff = startCutoff * scaleRatio.xyxy + translate.xyxy * viewport.zwzw;\n\t\t\tstartCutoff += viewport.xyxy;\n\t\t\tstartCutoff += startMiterWidth.xyxy;\n\t\t}\n\n\t\tif (enableEndMiter == 1.) {\n\t\t\tvec2 endMiterWidth = vec2(endJoinDirection) * thickness * miterLimit * .5;\n\t\t\tendCutoff = vec4(bCoord, bCoord);\n\t\t\tendCutoff.zw += vec2(-endJoinDirection.y, endJoinDirection.x)  / scaleRatio;\n\t\t\tendCutoff = endCutoff * scaleRatio.xyxy + translate.xyxy * viewport.zwzw;\n\t\t\tendCutoff += viewport.xyxy;\n\t\t\tendCutoff += endMiterWidth.xyxy;\n\t\t}\n\t}\n\n\t//round miter cutoffs\n\telse if (miterMode == 2.) {\n\t\tif (enableStartMiter == 1.) {\n\t\t\tvec2 startMiterWidth = vec2(startJoinDirection) * thickness * abs(dot(startJoinDirection, currNormal)) * .5;\n\t\t\tstartCutoff = vec4(aCoord, aCoord);\n\t\t\tstartCutoff.zw += vec2(-startJoinDirection.y, startJoinDirection.x) / scaleRatio;\n\t\t\tstartCutoff = startCutoff * scaleRatio.xyxy + translate.xyxy * viewport.zwzw;\n\t\t\tstartCutoff += viewport.xyxy;\n\t\t\tstartCutoff += startMiterWidth.xyxy;\n\t\t}\n\n\t\tif (enableEndMiter == 1.) {\n\t\t\tvec2 endMiterWidth = vec2(endJoinDirection) * thickness * abs(dot(endJoinDirection, currNormal)) * .5;\n\t\t\tendCutoff = vec4(bCoord, bCoord);\n\t\t\tendCutoff.zw += vec2(-endJoinDirection.y, endJoinDirection.x)  / scaleRatio;\n\t\t\tendCutoff = endCutoff * scaleRatio.xyxy + translate.xyxy * viewport.zwzw;\n\t\t\tendCutoff += viewport.xyxy;\n\t\t\tendCutoff += endMiterWidth.xyxy;\n\t\t}\n\t}\n}\n"]),frag:glslify(["precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D dashPattern;\nuniform float dashSize, pixelRatio, thickness, opacity, id, miterMode;\n\nvarying vec4 fragColor;\nvarying vec2 tangent;\nvarying vec4 startCutoff, endCutoff;\nvarying vec2 startCoord, endCoord;\nvarying float enableStartMiter, enableEndMiter;\n\nfloat distToLine(vec2 p, vec2 a, vec2 b) {\n\tvec2 diff = b - a;\n\tvec2 perp = normalize(vec2(-diff.y, diff.x));\n\treturn dot(p - a, perp);\n}\n\nvoid main() {\n\tfloat alpha = 1., distToStart, distToEnd;\n\tfloat cutoff = thickness * .5;\n\n\t//bevel miter\n\tif (miterMode == 1.) {\n\t\tif (enableStartMiter == 1.) {\n\t\t\tdistToStart = distToLine(gl_FragCoord.xy, startCutoff.xy, startCutoff.zw);\n\t\t\tif (distToStart < -1.) {\n\t\t\t\tdiscard;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\talpha *= min(max(distToStart + 1., 0.), 1.);\n\t\t}\n\n\t\tif (enableEndMiter == 1.) {\n\t\t\tdistToEnd = distToLine(gl_FragCoord.xy, endCutoff.xy, endCutoff.zw);\n\t\t\tif (distToEnd < -1.) {\n\t\t\t\tdiscard;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\talpha *= min(max(distToEnd + 1., 0.), 1.);\n\t\t}\n\t}\n\n\t// round miter\n\telse if (miterMode == 2.) {\n\t\tif (enableStartMiter == 1.) {\n\t\t\tdistToStart = distToLine(gl_FragCoord.xy, startCutoff.xy, startCutoff.zw);\n\t\t\tif (distToStart < 0.) {\n\t\t\t\tfloat radius = length(gl_FragCoord.xy - startCoord);\n\n\t\t\t\tif(radius > cutoff + .5) {\n\t\t\t\t\tdiscard;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\talpha -= smoothstep(cutoff - .5, cutoff + .5, radius);\n\t\t\t}\n\t\t}\n\n\t\tif (enableEndMiter == 1.) {\n\t\t\tdistToEnd = distToLine(gl_FragCoord.xy, endCutoff.xy, endCutoff.zw);\n\t\t\tif (distToEnd < 0.) {\n\t\t\t\tfloat radius = length(gl_FragCoord.xy - endCoord);\n\n\t\t\t\tif(radius > cutoff + .5) {\n\t\t\t\t\tdiscard;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\talpha -= smoothstep(cutoff - .5, cutoff + .5, radius);\n\t\t\t}\n\t\t}\n\t}\n\n\tfloat t = fract(dot(tangent, gl_FragCoord.xy) / dashSize) * .5 + .25;\n\tfloat dash = texture2D(dashPattern, vec2(t, .5)).r;\n\n\tgl_FragColor = fragColor;\n\tgl_FragColor.a *= alpha * opacity * dash;\n}\n"]),attributes:{lineEnd:{buffer:offsetBuffer,divisor:0,stride:8,offset:0},lineTop:{buffer:offsetBuffer,divisor:0,stride:8,offset:4},aColor:{buffer:regl.prop("colorBuffer"),stride:4,offset:0,divisor:1},bColor:{buffer:regl.prop("colorBuffer"),stride:4,offset:4,divisor:1},prevCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:0,divisor:1},aCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:8,divisor:1},bCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:16,divisor:1},nextCoord:{buffer:regl.prop("positionBuffer"),stride:8,offset:24,divisor:1}}},shaderOptions))}catch(e){drawMiterLine=drawRectLine}return{fill:regl({primitive:"triangle",elements:function(ctx,prop){return prop.triangles},offset:0,vert:glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec2 position, positionFract;\n\nuniform vec4 color;\nuniform vec2 scale, scaleFract, translate, translateFract;\nuniform float pixelRatio, id;\nuniform vec4 viewport;\nuniform float opacity;\n\nvarying vec4 fragColor;\n\nconst float MAX_LINES = 256.;\n\nvoid main() {\n\tfloat depth = (MAX_LINES - 4. - id) / (MAX_LINES);\n\n\tvec2 position = position * scale + translate\n       + positionFract * scale + translateFract\n       + position * scaleFract\n       + positionFract * scaleFract;\n\n\tgl_Position = vec4(position * 2.0 - 1.0, depth, 1);\n\n\tfragColor = color / 255.;\n\tfragColor.a *= opacity;\n}\n"]),frag:glslify(["precision highp float;\n#define GLSLIFY 1\n\nvarying vec4 fragColor;\n\nvoid main() {\n\tgl_FragColor = fragColor;\n}\n"]),uniforms:{scale:regl.prop("scale"),color:regl.prop("fill"),scaleFract:regl.prop("scaleFract"),translateFract:regl.prop("translateFract"),translate:regl.prop("translate"),opacity:regl.prop("opacity"),pixelRatio:regl.context("pixelRatio"),id:regl.prop("id"),viewport:function(ctx,prop){return[prop.viewport.x,prop.viewport.y,ctx.viewportWidth,ctx.viewportHeight]}},attributes:{position:{buffer:regl.prop("positionBuffer"),stride:8,offset:8},positionFract:{buffer:regl.prop("positionFractBuffer"),stride:8,offset:8}},blend:shaderOptions.blend,depth:{enable:!1},scissor:shaderOptions.scissor,stencil:shaderOptions.stencil,viewport:shaderOptions.viewport}),rect:drawRectLine,miter:drawMiterLine}},Line2D.defaults={dashes:null,join:"miter",miterLimit:1,thickness:10,cap:"square",color:"black",opacity:1,overlay:!1,viewport:null,range:null,close:!1,fill:null},Line2D.prototype.render=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];args.length&&(ref=this).update.apply(ref,args),this.draw()},Line2D.prototype.draw=function(){for(var this$1=this,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(args.length?args:this.passes).forEach(function(s,i){var ref;if(s&&Array.isArray(s))return(ref=this$1).draw.apply(ref,s);"number"==typeof s&&(s=this$1.passes[s]),s&&s.count>1&&s.opacity&&(this$1.regl._refresh(),s.fill&&s.triangles&&s.triangles.length>2&&this$1.shaders.fill(s),s.thickness&&(s.scale[0]*s.viewport.width>Line2D.precisionThreshold||s.scale[1]*s.viewport.height>Line2D.precisionThreshold?this$1.shaders.rect(s):"rect"===s.join||!s.join&&(s.thickness<=2||s.count>=Line2D.maxPoints)?this$1.shaders.rect(s):this$1.shaders.miter(s)))}),this},Line2D.prototype.update=function(options){var this$1=this;if(options){null!=options.length?"number"==typeof options[0]&&(options=[{positions:options}]):Array.isArray(options)||(options=[options]);var regl=this.regl,gl=this.gl;if(options.forEach(function(o,i){var state=this$1.passes[i];if(void 0!==o)if(null!==o){if("number"==typeof o[0]&&(o={positions:o}),o=pick(o,{positions:"positions points data coords",thickness:"thickness lineWidth lineWidths line-width linewidth width stroke-width strokewidth strokeWidth",join:"lineJoin linejoin join type mode",miterLimit:"miterlimit miterLimit",dashes:"dash dashes dasharray dash-array dashArray",color:"color colour stroke colors colours stroke-color strokeColor",fill:"fill fill-color fillColor",opacity:"alpha opacity",overlay:"overlay crease overlap intersect",close:"closed close closed-path closePath",range:"range dataBox",viewport:"viewport viewBox",hole:"holes hole hollow"}),state||(this$1.passes[i]=state={id:i,scale:null,scaleFract:null,translate:null,translateFract:null,count:0,hole:[],depth:0,dashLength:1,dashTexture:regl.texture({channels:1,data:new Uint8Array([255]),width:1,height:1,mag:"linear",min:"linear"}),colorBuffer:regl.buffer({usage:"dynamic",type:"uint8",data:new Uint8Array}),positionBuffer:regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array}),positionFractBuffer:regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array})},o=extend({},Line2D.defaults,o)),null!=o.thickness&&(state.thickness=parseFloat(o.thickness)),null!=o.opacity&&(state.opacity=parseFloat(o.opacity)),null!=o.miterLimit&&(state.miterLimit=parseFloat(o.miterLimit)),null!=o.overlay&&(state.overlay=!!o.overlay,i<Line2D.maxLines&&(state.depth=2*(Line2D.maxLines-1-i%Line2D.maxLines)/Line2D.maxLines-1)),null!=o.join&&(state.join=o.join),null!=o.hole&&(state.hole=o.hole),null!=o.fill&&(state.fill=o.fill?rgba(o.fill,"uint8"):null),null!=o.viewport&&(state.viewport=parseRect(o.viewport)),state.viewport||(state.viewport=parseRect([gl.drawingBufferWidth,gl.drawingBufferHeight])),null!=o.close&&(state.close=o.close),null===o.positions&&(o.positions=[]),o.positions){var positions,count;if(o.positions.x&&o.positions.y){var xPos=o.positions.x,yPos=o.positions.y;count=state.count=Math.max(xPos.length,yPos.length),positions=new Float64Array(2*count);for(var i$1=0;i$1<count;i$1++)positions[2*i$1]=xPos[i$1],positions[2*i$1+1]=yPos[i$1]}else positions=flatten(o.positions,"float64"),count=state.count=Math.floor(positions.length/2);var bounds=state.bounds=getBounds(positions,2);if(state.fill){for(var pos=[],ids={},lastId=0,i$2=0,ptr=0,l=state.count;i$2<l;i$2++){var x=positions[2*i$2],y=positions[2*i$2+1];isNaN(x)||isNaN(y)||null==x||null==y?(x=positions[2*lastId],y=positions[2*lastId+1],ids[i$2]=lastId):lastId=i$2,pos[ptr++]=x,pos[ptr++]=y}for(var triangles=triangulate(pos,state.hole||[]),i$3=0,l$1=triangles.length;i$3<l$1;i$3++)null!=ids[triangles[i$3]]&&(triangles[i$3]=ids[triangles[i$3]]);state.triangles=triangles}var npos=new Float64Array(positions);normalize(npos,2,bounds);var positionData=new Float64Array(2*count+6);state.close?positions[0]===positions[2*count-2]&&positions[1]===positions[2*count-1]?(positionData[0]=npos[2*count-4],positionData[1]=npos[2*count-3]):(positionData[0]=npos[2*count-2],positionData[1]=npos[2*count-1]):(positionData[0]=npos[0],positionData[1]=npos[1]),positionData.set(npos,2),state.close?positions[0]===positions[2*count-2]&&positions[1]===positions[2*count-1]?(positionData[2*count+2]=npos[2],positionData[2*count+3]=npos[3],state.count-=1):(positionData[2*count+2]=npos[0],positionData[2*count+3]=npos[1],positionData[2*count+4]=npos[2],positionData[2*count+5]=npos[3]):(positionData[2*count+2]=npos[2*count-2],positionData[2*count+3]=npos[2*count-1],positionData[2*count+4]=npos[2*count-2],positionData[2*count+5]=npos[2*count-1]),state.positionBuffer(float32(positionData)),state.positionFractBuffer(fract32(positionData))}if(o.range?state.range=o.range:state.range||(state.range=state.bounds),(o.range||o.positions)&&state.count){var bounds$1=state.bounds,boundsW=bounds$1[2]-bounds$1[0],boundsH=bounds$1[3]-bounds$1[1],rangeW=state.range[2]-state.range[0],rangeH=state.range[3]-state.range[1];state.scale=[boundsW/rangeW,boundsH/rangeH],state.translate=[-state.range[0]/rangeW+bounds$1[0]/rangeW||0,-state.range[1]/rangeH+bounds$1[1]/rangeH||0],state.scaleFract=fract32(state.scale),state.translateFract=fract32(state.translate)}if(o.dashes){var dashData,dashLength=0;if(!o.dashes||o.dashes.length<2)dashLength=1,dashData=new Uint8Array([255,255,255,255,255,255,255,255]);else{dashLength=0;for(var i$4=0;i$4<o.dashes.length;++i$4)dashLength+=o.dashes[i$4];dashData=new Uint8Array(dashLength*Line2D.dashMult);for(var ptr$1=0,fillColor=255,k=0;k<2;k++)for(var i$5=0;i$5<o.dashes.length;++i$5){for(var j=0,l$2=o.dashes[i$5]*Line2D.dashMult*.5;j<l$2;++j)dashData[ptr$1++]=fillColor;fillColor^=255}}state.dashLength=dashLength,state.dashTexture({channels:1,data:dashData,width:dashData.length,height:1,mag:"linear",min:"linear"},0,0)}if(o.color){var count$1=state.count,colors=o.color;colors||(colors="transparent");var colorData=new Uint8Array(4*count$1+4);if(Array.isArray(colors)&&"number"!=typeof colors[0]){for(var i$7=0;i$7<count$1;i$7++){var c$1=rgba(colors[i$7],"uint8");colorData.set(c$1,4*i$7)}colorData.set(rgba(colors[0],"uint8"),4*count$1)}else for(var c=rgba(colors,"uint8"),i$6=0;i$6<count$1+1;i$6++)colorData.set(c,4*i$6);state.colorBuffer({usage:"dynamic",type:"uint8",data:colorData})}}else this$1.passes[i]=null}),options.length<this.passes.length){for(var i=options.length;i<this.passes.length;i++){var pass=this$1.passes[i];pass&&(pass.colorBuffer.destroy(),pass.positionBuffer.destroy(),pass.dashTexture.destroy())}this.passes.length=options.length}for(var passes=[],i$1=0;i$1<this.passes.length;i$1++)null!==this$1.passes[i$1]&&passes.push(this$1.passes[i$1]);return this.passes=passes,this}},Line2D.prototype.destroy=function(){return this.passes.forEach(function(pass){pass.colorBuffer.destroy(),pass.positionBuffer.destroy(),pass.dashTexture.destroy()}),this.passes.length=0,this}},{"array-bounds":52,"array-normalize":53,"color-normalize":107,earcut:155,"es6-weak-map":208,"flatten-vertex-data":215,glslify:390,"object-assign":434,"parse-rect":439,"pick-by-alias":445,"to-float32":512}],472:[function(_dereq_,module,exports){"use strict";var Scatter=_dereq_("./scatter"),extend=_dereq_("object-assign");module.exports=function(regl,options){var scatter=new Scatter(regl,options),render=scatter.render.bind(scatter);return extend(render,{render:render,update:scatter.update.bind(scatter),draw:scatter.draw.bind(scatter),destroy:scatter.destroy.bind(scatter),regl:scatter.regl,gl:scatter.gl,canvas:scatter.gl.canvas,groups:scatter.groups,markers:scatter.markerCache,palette:scatter.palette}),render}},{"./scatter":473,"object-assign":434}],473:[function(_dereq_,module,exports){"use strict";var rgba=_dereq_("color-normalize"),getBounds=_dereq_("array-bounds"),colorId=_dereq_("color-id"),cluster=_dereq_("point-cluster"),extend=_dereq_("object-assign"),glslify=_dereq_("glslify"),pick=_dereq_("pick-by-alias"),updateDiff=_dereq_("update-diff"),flatten=_dereq_("flatten-vertex-data"),ie=_dereq_("is-iexplorer"),f32=_dereq_("to-float32"),parseRect=_dereq_("parse-rect");function Scatter(regl,options){var this$1=this;if(!(this instanceof Scatter))return new Scatter(regl,options);"function"==typeof regl?(options||(options={}),options.regl=regl):(options=regl,regl=null),options&&options.length&&(options.positions=options);var paletteTexture,gl=(regl=options.regl)._gl,palette=[];this.tooManyColors=ie,paletteTexture=regl.texture({data:new Uint8Array(1020),width:255,height:1,type:"uint8",format:"rgba",wrapS:"clamp",wrapT:"clamp",mag:"nearest",min:"nearest"}),extend(this,{regl:regl,gl:gl,groups:[],markerCache:[null],markerTextures:[null],palette:palette,paletteIds:{},paletteTexture:paletteTexture,maxColors:255,maxSize:100,canvas:gl.canvas}),this.update(options);var shaderOptions={uniforms:{pixelRatio:regl.context("pixelRatio"),palette:paletteTexture,paletteSize:function(ctx,prop){return[this$1.tooManyColors?0:255,paletteTexture.height]},scale:regl.prop("scale"),scaleFract:regl.prop("scaleFract"),translate:regl.prop("translate"),translateFract:regl.prop("translateFract"),opacity:regl.prop("opacity"),marker:regl.prop("markerTexture")},attributes:{x:function(ctx,prop){return prop.xAttr||{buffer:prop.positionBuffer,stride:8,offset:0}},y:function(ctx,prop){return prop.yAttr||{buffer:prop.positionBuffer,stride:8,offset:4}},xFract:function(ctx,prop){return prop.xAttr?{constant:[0,0]}:{buffer:prop.positionFractBuffer,stride:8,offset:0}},yFract:function(ctx,prop){return prop.yAttr?{constant:[0,0]}:{buffer:prop.positionFractBuffer,stride:8,offset:4}},size:function(ctx,prop){return prop.size.length?{buffer:prop.sizeBuffer,stride:2,offset:0}:{constant:[Math.round(255*prop.size/this$1.maxSize)]}},borderSize:function(ctx,prop){return prop.borderSize.length?{buffer:prop.sizeBuffer,stride:2,offset:1}:{constant:[Math.round(255*prop.borderSize/this$1.maxSize)]}},colorId:function(ctx,prop){return prop.color.length?{buffer:prop.colorBuffer,stride:this$1.tooManyColors?8:4,offset:0}:{constant:this$1.tooManyColors?palette.slice(4*prop.color,4*prop.color+4):[prop.color]}},borderColorId:function(ctx,prop){return prop.borderColor.length?{buffer:prop.colorBuffer,stride:this$1.tooManyColors?8:4,offset:this$1.tooManyColors?4:2}:{constant:this$1.tooManyColors?palette.slice(4*prop.borderColor,4*prop.borderColor+4):[prop.borderColor]}},isActive:function(ctx,prop){return!0===prop.activation?{constant:[1]}:prop.activation?prop.activation:{constant:[0]}}},blend:{enable:!0,color:[0,0,0,1],func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},scissor:{enable:!0,box:regl.prop("viewport")},viewport:regl.prop("viewport"),stencil:{enable:!1},depth:{enable:!1},elements:regl.prop("elements"),count:regl.prop("count"),offset:regl.prop("offset"),primitive:"points"},markerOptions=extend({},shaderOptions);markerOptions.frag=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nvarying vec4 fragColor, fragBorderColor;\nvarying float fragWidth, fragBorderColorLevel, fragColorLevel;\n\nuniform sampler2D marker;\nuniform float pixelRatio, opacity;\n\nfloat smoothStep(float x, float y) {\n  return 1.0 / (1.0 + exp(50.0*(x - y)));\n}\n\nvoid main() {\n  float dist = texture2D(marker, gl_PointCoord).r, delta = fragWidth;\n\n  // max-distance alpha\n  if (dist < 0.003) discard;\n\n  // null-border case\n  if (fragBorderColorLevel == fragColorLevel || fragBorderColor.a == 0.) {\n    float colorAmt = smoothstep(.5 - delta, .5 + delta, dist);\n    gl_FragColor = vec4(fragColor.rgb, colorAmt * fragColor.a * opacity);\n  }\n  else {\n    float borderColorAmt = smoothstep(fragBorderColorLevel - delta, fragBorderColorLevel + delta, dist);\n    float colorAmt = smoothstep(fragColorLevel - delta, fragColorLevel + delta, dist);\n\n    vec4 color = fragBorderColor;\n    color.a *= borderColorAmt;\n    color = mix(color, fragColor, colorAmt);\n    color.a *= opacity;\n\n    gl_FragColor = color;\n  }\n\n}\n"]),markerOptions.vert=glslify(["precision mediump float;\n#define GLSLIFY 1\n\nattribute float x, y, xFract, yFract;\nattribute float size, borderSize;\nattribute vec4 colorId, borderColorId;\nattribute float isActive;\n\nuniform vec2 scale, scaleFract, translate, translateFract, paletteSize;\nuniform float pixelRatio;\nuniform sampler2D palette;\n\nconst float maxSize = 100.;\nconst float borderLevel = .5;\n\nvarying vec4 fragColor, fragBorderColor;\nvarying float fragPointSize, fragBorderRadius,\n    fragWidth, fragBorderColorLevel, fragColorLevel;\n\nvec2 paletteCoord(float id) {\n  return vec2(\n    (mod(id, paletteSize.x) + .5) / paletteSize.x,\n    (floor(id / paletteSize.x) + .5) / paletteSize.y\n  );\n}\nvec2 paletteCoord(vec2 id) {\n  return vec2(\n    (id.x + .5) / paletteSize.x,\n    (id.y + .5) / paletteSize.y\n  );\n}\nvec4 getColor(vec4 id) {\n  // zero-palette means we deal with direct buffer\n  if (paletteSize.x == 0.) return id / 255.;\n  return texture2D(palette, paletteCoord(id.xy));\n}\n\nvoid main() {\n  if (isActive == 0.) return;\n\n  vec2 position = vec2(x, y);\n  vec2 positionFract = vec2(xFract, yFract);\n\n  vec4 color = getColor(colorId);\n  vec4 borderColor = getColor(borderColorId);\n\n  float size = size * maxSize / 255.;\n  float borderSize = borderSize * maxSize / 255.;\n\n  gl_PointSize = 2. * size * pixelRatio;\n  fragPointSize = size * pixelRatio;\n\n  vec2 pos = (position + translate) * scale\n      + (positionFract + translateFract) * scale\n      + (position + translate) * scaleFract\n      + (positionFract + translateFract) * scaleFract;\n\n  gl_Position = vec4(pos * 2. - 1., 0, 1);\n\n  fragColor = color;\n  fragBorderColor = borderColor;\n  fragWidth = 1. / gl_PointSize;\n\n  fragBorderColorLevel = clamp(borderLevel - borderLevel * borderSize / size, 0., 1.);\n  fragColorLevel = clamp(borderLevel + (1. - borderLevel) * borderSize / size, 0., 1.);\n}\n"]),this.drawMarker=regl(markerOptions);var circleOptions=extend({},shaderOptions);circleOptions.frag=glslify(["precision highp float;\n#define GLSLIFY 1\n\nvarying vec4 fragColor, fragBorderColor;\n\nuniform float opacity;\nvarying float fragBorderRadius, fragWidth;\n\nfloat smoothStep(float edge0, float edge1, float x) {\n\tfloat t;\n\tt = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n\treturn t * t * (3.0 - 2.0 * t);\n}\n\nvoid main() {\n\tfloat radius, alpha = 1.0, delta = fragWidth;\n\n\tradius = length(2.0 * gl_PointCoord.xy - 1.0);\n\n\tif (radius > 1.0 + delta) {\n\t\tdiscard;\n\t}\n\n\talpha -= smoothstep(1.0 - delta, 1.0 + delta, radius);\n\n\tfloat borderRadius = fragBorderRadius;\n\tfloat ratio = smoothstep(borderRadius - delta, borderRadius + delta, radius);\n\tvec4 color = mix(fragColor, fragBorderColor, ratio);\n\tcolor.a *= alpha * opacity;\n\tgl_FragColor = color;\n}\n"]),circleOptions.vert=glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute float x, y, xFract, yFract;\nattribute float size, borderSize;\nattribute vec4 colorId, borderColorId;\nattribute float isActive;\n\nuniform vec2 scale, scaleFract, translate, translateFract;\nuniform float pixelRatio;\nuniform sampler2D palette;\nuniform vec2 paletteSize;\n\nconst float maxSize = 100.;\n\nvarying vec4 fragColor, fragBorderColor;\nvarying float fragBorderRadius, fragWidth;\n\nvec2 paletteCoord(float id) {\n  return vec2(\n    (mod(id, paletteSize.x) + .5) / paletteSize.x,\n    (floor(id / paletteSize.x) + .5) / paletteSize.y\n  );\n}\nvec2 paletteCoord(vec2 id) {\n  return vec2(\n    (id.x + .5) / paletteSize.x,\n    (id.y + .5) / paletteSize.y\n  );\n}\n\nvec4 getColor(vec4 id) {\n  // zero-palette means we deal with direct buffer\n  if (paletteSize.x == 0.) return id / 255.;\n  return texture2D(palette, paletteCoord(id.xy));\n}\n\nvoid main() {\n  // ignore inactive points\n  if (isActive == 0.) return;\n\n  vec2 position = vec2(x, y);\n  vec2 positionFract = vec2(xFract, yFract);\n\n  vec4 color = getColor(colorId);\n  vec4 borderColor = getColor(borderColorId);\n\n  float size = size * maxSize / 255.;\n  float borderSize = borderSize * maxSize / 255.;\n\n  gl_PointSize = (size + borderSize) * pixelRatio;\n\n  vec2 pos = (position + translate) * scale\n      + (positionFract + translateFract) * scale\n      + (position + translate) * scaleFract\n      + (positionFract + translateFract) * scaleFract;\n\n  gl_Position = vec4(pos * 2. - 1., 0, 1);\n\n  fragBorderRadius = 1. - 2. * borderSize / (size + borderSize);\n  fragColor = color;\n  fragBorderColor = borderColor.a == 0. || borderSize == 0. ? vec4(color.rgb, 0.) : borderColor;\n  fragWidth = 1. / gl_PointSize;\n}\n"]),ie&&(circleOptions.frag=circleOptions.frag.replace("smoothstep","smoothStep"),markerOptions.frag=markerOptions.frag.replace("smoothstep","smoothStep")),this.drawCircle=regl(circleOptions)}module.exports=Scatter,Scatter.defaults={color:"black",borderColor:"transparent",borderSize:0,size:12,opacity:1,marker:void 0,viewport:null,range:null,pixelSize:null,count:0,offset:0,bounds:null,positions:[],snap:1e4},Scatter.prototype.render=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return args.length&&(ref=this).update.apply(ref,args),this.draw(),this},Scatter.prototype.draw=function(){for(var this$1=this,args=[],len=arguments.length;len--;)args[len]=arguments[len];var groups=this.groups;if(1===args.length&&Array.isArray(args[0])&&(null===args[0][0]||Array.isArray(args[0][0]))&&(args=args[0]),this.regl._refresh(),args.length)for(var i=0;i<args.length;i++)this$1.drawItem(i,args[i]);else groups.forEach(function(group,i){this$1.drawItem(i)});return this},Scatter.prototype.drawItem=function(id,els){var groups=this.groups,group=groups[id];if("number"==typeof els&&(id=els,group=groups[els],els=null),group&&group.count&&group.opacity){group.activation[0]&&this.drawCircle(this.getMarkerDrawOptions(0,group,els));for(var batch=[],i=1;i<group.activation.length;i++)group.activation[i]&&(!0===group.activation[i]||group.activation[i].data.length)&&batch.push.apply(batch,this.getMarkerDrawOptions(i,group,els));batch.length&&this.drawMarker(batch)}},Scatter.prototype.getMarkerDrawOptions=function(markerId,group,elements){var range=group.range,tree=group.tree,viewport=group.viewport,activation=group.activation,selectionBuffer=group.selectionBuffer,count=group.count;this.regl;if(!tree)return elements?[extend({},group,{markerTexture:this.markerTextures[markerId],activation:activation[markerId],count:elements.length,elements:elements,offset:0})]:[extend({},group,{markerTexture:this.markerTextures[markerId],activation:activation[markerId],offset:0})];var batch=[],lod=tree.range(range,{lod:!0,px:[(range[2]-range[0])/viewport.width,(range[3]-range[1])/viewport.height]});if(elements){for(var mask=activation[markerId].data,data=new Uint8Array(count),i=0;i<elements.length;i++){var id=elements[i];data[id]=mask?mask[id]:1}selectionBuffer.subdata(data)}for(var l=lod.length;l--;){var ref$1=lod[l],from=ref$1[0],to=ref$1[1];batch.push(extend({},group,{markerTexture:this.markerTextures[markerId],activation:elements?selectionBuffer:activation[markerId],offset:from,count:to-from}))}return batch},Scatter.prototype.update=function(){for(var this$1=this,args=[],len=arguments.length;len--;)args[len]=arguments[len];if(args.length){1===args.length&&Array.isArray(args[0])&&(args=args[0]);var groups=this.groups,gl=this.gl,regl=this.regl,maxSize=this.maxSize,maxColors=this.maxColors,palette=this.palette;this.groups=groups=args.map(function(options,i){var group=groups[i];if(void 0===options)return group;null===options?options={positions:null}:"function"==typeof options?options={ondraw:options}:"number"==typeof options[0]&&(options={positions:options}),null===(options=pick(options,{positions:"positions data points",snap:"snap cluster lod tree",size:"sizes size radius",borderSize:"borderSizes borderSize border-size bordersize borderWidth borderWidths border-width borderwidth stroke-width strokeWidth strokewidth outline",color:"colors color fill fill-color fillColor",borderColor:"borderColors borderColor stroke stroke-color strokeColor",marker:"markers marker shape",range:"range dataBox databox",viewport:"viewport viewPort viewBox viewbox",opacity:"opacity alpha transparency",bounds:"bound bounds boundaries limits"})).positions&&(options.positions=[]),group||(groups[i]=group={id:i,scale:null,translate:null,scaleFract:null,translateFract:null,activation:[],selectionBuffer:regl.buffer({data:new Uint8Array(0),usage:"stream",type:"uint8"}),sizeBuffer:regl.buffer({data:new Uint8Array(0),usage:"dynamic",type:"uint8"}),colorBuffer:regl.buffer({data:new Uint8Array(0),usage:"dynamic",type:"uint8"}),positionBuffer:regl.buffer({data:new Uint8Array(0),usage:"dynamic",type:"float"}),positionFractBuffer:regl.buffer({data:new Uint8Array(0),usage:"dynamic",type:"float"})},options=extend({},Scatter.defaults,options)),!options.positions||"marker"in options||(options.marker=group.marker,delete group.marker),!options.marker||"positions"in options||(options.positions=group.positions,delete group.positions);var hasSize=0,hasColor=0;if(updateDiff(group,options,[{snap:!0,size:function(s,group){return null==s&&(s=Scatter.defaults.size),hasSize+=s&&s.length?1:0,s},borderSize:function(s,group){return null==s&&(s=Scatter.defaults.borderSize),hasSize+=s&&s.length?1:0,s},opacity:parseFloat,color:function(c,group){return null==c&&(c=Scatter.defaults.color),c=this$1.updateColor(c),hasColor++,c},borderColor:function(c,group){return null==c&&(c=Scatter.defaults.borderColor),c=this$1.updateColor(c),hasColor++,c},bounds:function(bounds,group,options){return"range"in options||(options.range=null),bounds},positions:function(positions,group,options){var snap=group.snap,positionBuffer=group.positionBuffer,positionFractBuffer=group.positionFractBuffer,selectionBuffer=group.selectionBuffer;if(positions.x||positions.y)return positions.x.length?group.xAttr={buffer:regl.buffer(positions.x),offset:0,stride:4,count:positions.x.length}:group.xAttr={buffer:positions.x.buffer,offset:4*positions.x.offset||0,stride:4*(positions.x.stride||1),count:positions.x.count},positions.y.length?group.yAttr={buffer:regl.buffer(positions.y),offset:0,stride:4,count:positions.y.length}:group.yAttr={buffer:positions.y.buffer,offset:4*positions.y.offset||0,stride:4*(positions.y.stride||1),count:positions.y.count},group.count=Math.max(group.xAttr.count,group.yAttr.count),positions;positions=flatten(positions,"float64");var count=group.count=Math.floor(positions.length/2),bounds=group.bounds=count?getBounds(positions,2):null;if(options.range||group.range||(delete group.range,options.range=bounds),options.marker||group.marker||(delete group.marker,options.marker=null),snap&&(!0===snap||count>snap)?group.tree=cluster(positions,{bounds:bounds}):snap&&snap.length&&(group.tree=snap),group.tree){var opts={primitive:"points",usage:"static",data:group.tree,type:"uint32"};group.elements?group.elements(opts):group.elements=regl.elements(opts)}return positionBuffer({data:f32.float(positions),usage:"dynamic"}),positionFractBuffer({data:f32.fract(positions),usage:"dynamic"}),selectionBuffer({data:new Uint8Array(count),type:"uint8",usage:"stream"}),positions}},{marker:function(markers,group,options){var activation=group.activation;if(activation.forEach(function(buffer){return buffer&&buffer.destroy&&buffer.destroy()}),activation.length=0,markers&&"number"!=typeof markers[0]){for(var markerMasks=[],i=0,l=Math.min(markers.length,group.count);i<l;i++){var id$1=this$1.addMarker(markers[i]);markerMasks[id$1]||(markerMasks[id$1]=new Uint8Array(group.count)),markerMasks[id$1][i]=1}for(var id$2=0;id$2<markerMasks.length;id$2++)if(markerMasks[id$2]){var opts={data:markerMasks[id$2],type:"uint8",usage:"static"};activation[id$2]?activation[id$2](opts):activation[id$2]=regl.buffer(opts),activation[id$2].data=markerMasks[id$2]}}else{activation[this$1.addMarker(markers)]=!0}return markers},range:function(range,group,options){var bounds=group.bounds;if(bounds)return range||(range=bounds),group.scale=[1/(range[2]-range[0]),1/(range[3]-range[1])],group.translate=[-range[0],-range[1]],group.scaleFract=f32.fract(group.scale),group.translateFract=f32.fract(group.translate),range},viewport:function(vp){return parseRect(vp||[gl.drawingBufferWidth,gl.drawingBufferHeight])}}]),hasSize){var count=group.count,size=group.size,borderSize=group.borderSize,sizeBuffer=group.sizeBuffer,sizes=new Uint8Array(2*count);if(size.length||borderSize.length)for(var i$1=0;i$1<count;i$1++)sizes[2*i$1]=Math.round(255*(null==size[i$1]?size:size[i$1])/maxSize),sizes[2*i$1+1]=Math.round(255*(null==borderSize[i$1]?borderSize:borderSize[i$1])/maxSize);sizeBuffer({data:sizes,usage:"dynamic"})}if(hasColor){var colors,count$1=group.count,color=group.color,borderColor=group.borderColor,colorBuffer=group.colorBuffer;if(this$1.tooManyColors){if(color.length||borderColor.length){colors=new Uint8Array(8*count$1);for(var i$2=0;i$2<count$1;i$2++){var colorId=color[i$2];colors[8*i$2]=palette[4*colorId],colors[8*i$2+1]=palette[4*colorId+1],colors[8*i$2+2]=palette[4*colorId+2],colors[8*i$2+3]=palette[4*colorId+3];var borderColorId=borderColor[i$2];colors[8*i$2+4]=palette[4*borderColorId],colors[8*i$2+5]=palette[4*borderColorId+1],colors[8*i$2+6]=palette[4*borderColorId+2],colors[8*i$2+7]=palette[4*borderColorId+3]}}}else if(color.length||borderColor.length){colors=new Uint8Array(4*count$1+2);for(var i$3=0;i$3<count$1;i$3++)null!=color[i$3]&&(colors[4*i$3]=color[i$3]%maxColors,colors[4*i$3+1]=Math.floor(color[i$3]/maxColors)),null!=borderColor[i$3]&&(colors[4*i$3+2]=borderColor[i$3]%maxColors,colors[4*i$3+3]=Math.floor(borderColor[i$3]/maxColors))}colorBuffer({data:colors||new Uint8Array(0),type:"uint8",usage:"dynamic"})}return group})}},Scatter.prototype.addMarker=function(sdf){var distArr,markerTextures=this.markerTextures,regl=this.regl,markerCache=this.markerCache,pos=null==sdf?0:markerCache.indexOf(sdf);if(pos>=0)return pos;if(sdf instanceof Uint8Array||sdf instanceof Uint8ClampedArray)distArr=sdf;else{distArr=new Uint8Array(sdf.length);for(var i=0,l=sdf.length;i<l;i++)distArr[i]=255*sdf[i]}var radius=Math.floor(Math.sqrt(distArr.length));return pos=markerTextures.length,markerCache.push(sdf),markerTextures.push(regl.texture({channels:1,data:distArr,radius:radius,mag:"linear",min:"linear"})),pos},Scatter.prototype.updateColor=function(colors){var paletteIds=this.paletteIds,palette=this.palette,maxColors=this.maxColors;Array.isArray(colors)||(colors=[colors]);var idx=[];if("number"==typeof colors[0]){var grouped=[];if(Array.isArray(colors))for(var i=0;i<colors.length;i+=4)grouped.push(colors.slice(i,i+4));else for(var i$1=0;i$1<colors.length;i$1+=4)grouped.push(colors.subarray(i$1,i$1+4));colors=grouped}for(var i$2=0;i$2<colors.length;i$2++){var color=colors[i$2];color=rgba(color,"uint8");var id=colorId(color,!1);if(null==paletteIds[id]){var pos=palette.length;paletteIds[id]=Math.floor(pos/4),palette[pos]=color[0],palette[pos+1]=color[1],palette[pos+2]=color[2],palette[pos+3]=color[3]}idx[i$2]=paletteIds[id]}return!this.tooManyColors&&palette.length>maxColors*maxColors*4&&(this.tooManyColors=!0),this.updatePalette(palette),1===idx.length?idx[0]:idx},Scatter.prototype.updatePalette=function(palette){if(!this.tooManyColors){var maxColors=this.maxColors,paletteTexture=this.paletteTexture,requiredHeight=Math.ceil(.25*palette.length/maxColors);if(requiredHeight>1)for(var i=.25*(palette=palette.slice()).length%maxColors;i<requiredHeight*maxColors;i++)palette.push(0,0,0,0);paletteTexture.height<requiredHeight&&paletteTexture.resize(maxColors,requiredHeight),paletteTexture.subimage({width:Math.min(.25*palette.length,maxColors),height:requiredHeight,data:palette},0,0)}},Scatter.prototype.destroy=function(){return this.groups.forEach(function(group){group.sizeBuffer.destroy(),group.positionBuffer.destroy(),group.positionFractBuffer.destroy(),group.colorBuffer.destroy(),group.activation.forEach(function(b){return b&&b.destroy&&b.destroy()}),group.selectionBuffer.destroy(),group.elements&&group.elements.destroy()}),this.groups.length=0,this.paletteTexture.destroy(),this.markerTextures.forEach(function(txt){return txt&&txt.destroy&&txt.destroy()}),this}},{"array-bounds":52,"color-id":105,"color-normalize":107,"flatten-vertex-data":215,glslify:390,"is-iexplorer":400,"object-assign":434,"parse-rect":439,"pick-by-alias":445,"point-cluster":449,"to-float32":512,"update-diff":523}],474:[function(_dereq_,module,exports){"use strict";var createScatter=_dereq_("regl-scatter2d/scatter"),pick=_dereq_("pick-by-alias"),getBounds=_dereq_("array-bounds"),raf=_dereq_("raf"),arrRange=_dereq_("array-range"),rect=_dereq_("parse-rect"),flatten=_dereq_("flatten-vertex-data");function SPLOM(regl,options){if(!(this instanceof SPLOM))return new SPLOM(regl,options);this.traces=[],this.passes={},this.regl=regl,this.scatter=createScatter(regl),this.canvas=this.scatter.canvas}function passId(trace,i,j){return(null!=trace.id?trace.id:trace)<<16|(255&i)<<8|255&j}function getBox(items,i,j){var iloy,ihiy,jlox,jhix,iitem=items[i],jitem=items[j];return iitem.length>2?(iitem[0],iitem[2],iloy=iitem[1],ihiy=iitem[3]):iitem.length?(iloy=iitem[0],ihiy=iitem[1]):(iitem.x,iloy=iitem.y,iitem.x+iitem.width,ihiy=iitem.y+iitem.height),jitem.length>2?(jlox=jitem[0],jhix=jitem[2],jitem[1],jitem[3]):jitem.length?(jlox=jitem[0],jhix=jitem[1]):(jlox=jitem.x,jitem.y,jhix=jitem.x+jitem.width,jitem.y+jitem.height),[jlox,iloy,jhix,ihiy]}function getPad(arg){if("number"==typeof arg)return[arg,arg,arg,arg];if(2===arg.length)return[arg[0],arg[1],arg[0],arg[1]];var box=rect(arg);return[box.x,box.y,box.x+box.width,box.y+box.height]}module.exports=SPLOM,SPLOM.prototype.render=function(){for(var ref,this$1=this,args=[],len=arguments.length;len--;)args[len]=arguments[len];return args.length&&(ref=this).update.apply(ref,args),this.regl.attributes.preserveDrawingBuffer?this.draw():(this.dirty?null==this.planned&&(this.planned=raf(function(){this$1.draw(),this$1.dirty=!0,this$1.planned=null})):(this.draw(),this.dirty=!0,raf(function(){this$1.dirty=!1})),this)},SPLOM.prototype.update=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];if(args.length){for(var i=0;i<args.length;i++)this.updateItem(i,args[i]);this.traces=this.traces.filter(Boolean);for(var passes=[],offset=0,i$1=0;i$1<this.traces.length;i$1++){for(var trace=this.traces[i$1],tracePasses=this.traces[i$1].passes,j=0;j<tracePasses.length;j++)passes.push(this.passes[tracePasses[j]]);trace.passOffset=offset,offset+=trace.passes.length}return(ref=this.scatter).update.apply(ref,passes),this}},SPLOM.prototype.updateItem=function(i,options){var regl=this.regl;if(null===options)return this.traces[i]=null,this;if(!options)return this;var multirange,o=pick(options,{data:"data items columns rows values dimensions samples x",snap:"snap cluster",size:"sizes size radius",color:"colors color fill fill-color fillColor",opacity:"opacity alpha transparency opaque",borderSize:"borderSizes borderSize border-size bordersize borderWidth borderWidths border-width borderwidth stroke-width strokeWidth strokewidth outline",borderColor:"borderColors borderColor bordercolor stroke stroke-color strokeColor",marker:"markers marker shape",range:"range ranges databox dataBox",viewport:"viewport viewBox viewbox",domain:"domain domains area areas",padding:"pad padding paddings pads margin margins",transpose:"transpose transposed",diagonal:"diagonal diag showDiagonal",upper:"upper up top upperhalf upperHalf showupperhalf showUpper showUpperHalf",lower:"lower low bottom lowerhalf lowerHalf showlowerhalf showLowerHalf showLower"}),trace=this.traces[i]||(this.traces[i]={id:i,buffer:regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array}),color:"black",marker:null,size:12,borderColor:"transparent",borderSize:1,viewport:rect([regl._gl.drawingBufferWidth,regl._gl.drawingBufferHeight]),padding:[0,0,0,0],opacity:1,diagonal:!0,upper:!0,lower:!0});if(null!=o.color&&(trace.color=o.color),null!=o.size&&(trace.size=o.size),null!=o.marker&&(trace.marker=o.marker),null!=o.borderColor&&(trace.borderColor=o.borderColor),null!=o.borderSize&&(trace.borderSize=o.borderSize),null!=o.opacity&&(trace.opacity=o.opacity),o.viewport&&(trace.viewport=rect(o.viewport)),null!=o.diagonal&&(trace.diagonal=o.diagonal),null!=o.upper&&(trace.upper=o.upper),null!=o.lower&&(trace.lower=o.lower),o.data){trace.buffer(flatten(o.data)),trace.columns=o.data.length,trace.count=o.data[0].length,trace.bounds=[];for(var i$1=0;i$1<trace.columns;i$1++)trace.bounds[i$1]=getBounds(o.data[i$1],1)}o.range&&(trace.range=o.range,multirange=trace.range&&"number"!=typeof trace.range[0]),o.domain&&(trace.domain=o.domain);var multipadding=!1;null!=o.padding&&(Array.isArray(o.padding)&&o.padding.length===trace.columns&&"number"==typeof o.padding[o.padding.length-1]?(trace.padding=o.padding.map(getPad),multipadding=!0):trace.padding=getPad(o.padding));var m=trace.columns,n=trace.count,w=trace.viewport.width,h=trace.viewport.height,left=trace.viewport.x,top=trace.viewport.y,iw=w/m,ih=h/m;trace.passes=[];for(var i$2=0;i$2<m;i$2++)for(var j=0;j<m;j++)if((trace.diagonal||j!==i$2)&&(trace.upper||!(i$2>j))&&(trace.lower||!(i$2<j))){var key=passId(trace.id,i$2,j),pass=this.passes[key]||(this.passes[key]={});if(o.data&&(o.transpose?pass.positions={x:{buffer:trace.buffer,offset:j,count:n,stride:m},y:{buffer:trace.buffer,offset:i$2,count:n,stride:m}}:pass.positions={x:{buffer:trace.buffer,offset:j*n,count:n},y:{buffer:trace.buffer,offset:i$2*n,count:n}},pass.bounds=getBox(trace.bounds,i$2,j)),o.domain||o.viewport||o.data){var pad=multipadding?getBox(trace.padding,i$2,j):trace.padding;if(trace.domain){var ref$1=getBox(trace.domain,i$2,j),lox=ref$1[0],loy=ref$1[1],hix=ref$1[2],hiy=ref$1[3];pass.viewport=[left+lox*w+pad[0],top+loy*h+pad[1],left+hix*w-pad[2],top+hiy*h-pad[3]]}else pass.viewport=[left+j*iw+iw*pad[0],top+i$2*ih+ih*pad[1],left+(j+1)*iw-iw*pad[2],top+(i$2+1)*ih-ih*pad[3]]}o.color&&(pass.color=trace.color),o.size&&(pass.size=trace.size),o.marker&&(pass.marker=trace.marker),o.borderSize&&(pass.borderSize=trace.borderSize),o.borderColor&&(pass.borderColor=trace.borderColor),o.opacity&&(pass.opacity=trace.opacity),o.range&&(pass.range=multirange?getBox(trace.range,i$2,j):trace.range||pass.bounds),trace.passes.push(key)}return this},SPLOM.prototype.draw=function(){for(var ref$2,args=[],len=arguments.length;len--;)args[len]=arguments[len];if(args.length){for(var idx=[],i=0;i<args.length;i++)if("number"==typeof args[i]){var ref=this.traces[args[i]],passes=ref.passes,passOffset=ref.passOffset;idx.push.apply(idx,arrRange(passOffset,passOffset+passes.length))}else if(args[i].length){var els=args[i],ref$1=this.traces[i],passes$1=ref$1.passes,passOffset$1=ref$1.passOffset;passes$1=passes$1.map(function(passId,i){idx[passOffset$1+i]=els})}(ref$2=this.scatter).draw.apply(ref$2,idx)}else this.scatter.draw();return this},SPLOM.prototype.destroy=function(){return this.traces.forEach(function(trace){trace.buffer&&trace.buffer.destroy&&trace.buffer.destroy()}),this.traces=null,this.passes=null,this.scatter.destroy(),this}},{"array-bounds":52,"array-range":54,"flatten-vertex-data":215,"parse-rect":439,"pick-by-alias":445,raf:464,"regl-scatter2d/scatter":473}],475:[function(_dereq_,module,exports){var pa,W;pa=this,W=function(){function pa(a,b){this.id=Ab++,this.type=a,this.data=b}function Za(a){return"["+function W(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return W(a.substr(0,b.index)).concat(W(b[1])).concat(W(a.substr(b.index+b[0].length)));if(1===(b=a.split(".")).length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(a=[],c=0;c<b.length;++c)a=a.concat(W(b[c]));return a}(a).join("][")+"]"}function $a(a){return"string"==typeof a?a.split():a}function ab(a){return"string"==typeof a?document.querySelector(a):a}function Eb(a){var c,e,f,d,b=a||{};a={};var n=[],k=[],r="undefined"==typeof window?1:window.devicePixelRatio,p=!1,u=function(a){},m=function(){};if("string"==typeof b?c=document.querySelector(b):"object"==typeof b&&("string"==typeof b.nodeName&&"function"==typeof b.appendChild&&"function"==typeof b.getBoundingClientRect?c=b:"function"==typeof b.drawArrays||"function"==typeof b.drawElements?f=(d=b).canvas:("gl"in b?d=b.gl:"canvas"in b?f=ab(b.canvas):"container"in b&&(e=ab(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(n=$a(b.extensions)),"optionalExtensions"in b&&(k=$a(b.optionalExtensions)),"onDone"in b&&(u=b.onDone),"profile"in b&&(p=!!b.profile),"pixelRatio"in b&&(r=+b.pixelRatio))),c&&("canvas"===c.nodeName.toLowerCase()?f=c:e=c),!d){if(!f){if(!(c=function Cb(a,b,c){function e(){var b=window.innerWidth,e=window.innerHeight;a!==document.body&&(b=(e=a.getBoundingClientRect()).right-e.left,e=e.bottom-e.top),f.width=c*b,f.height=c*e,D(f.style,{width:b+"px",height:e+"px"})}var f=document.createElement("canvas");return D(f.style,{border:0,margin:0,padding:0,top:0,left:0}),a.appendChild(f),a===document.body&&(f.style.position="absolute",D(a.style,{margin:0,padding:0})),window.addEventListener("resize",e,!1),e(),{canvas:f,onDestroy:function(){window.removeEventListener("resize",e),a.removeChild(f)}}}(e||document.body,0,r)))return null;f=c.canvas,m=c.onDestroy}d=function Db(a,b){function c(c){try{return a.getContext(c,b)}catch(f){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}(f,a)}return d?{gl:d,canvas:f,container:e,extensions:n,optionalExtensions:k,pixelRatio:r,profile:p,onDone:u,onDestroy:m}:(m(),u("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function O(a,b){for(var c=Array(a),e=0;e<a;++e)c[e]=b(e);return c}function bb(a){var b,c;return b=(65535<a)<<4,b|=c=(255<(a>>>=b))<<3,(b|=c=(15<(a>>>=c))<<2)|(c=(3<(a>>>=c))<<1)|a>>>c>>1}function cb(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}return 0<(b=c[bb(a)>>2]).length?b.pop():new ArrayBuffer(a)}function b(a){c[bb(a.byteLength)>>2].push(a)}var c=O(8,function(){return[]});return{alloc:a,free:b,allocType:function(b,c){var d=null;switch(b){case 5120:d=new Int8Array(a(c),0,c);break;case 5121:d=new Uint8Array(a(c),0,c);break;case 5122:d=new Int16Array(a(2*c),0,c);break;case 5123:d=new Uint16Array(a(2*c),0,c);break;case 5124:d=new Int32Array(a(4*c),0,c);break;case 5125:d=new Uint32Array(a(4*c),0,c);break;case 5126:d=new Float32Array(a(4*c),0,c);break;default:return null}return d.length!==c?d.subarray(0,c):d},freeType:function(a){b(a.buffer)}}}function ka(a){return!!a&&"object"==typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"==typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||P(a.data))}function db(a,b,c,e,f,d){for(var n=0;n<b;++n)for(var k=a[n],r=0;r<c;++r)for(var p=k[r],u=0;u<e;++u)f[d++]=p[u]}function Ha(a){return 0|Ia[Object.prototype.toString.call(a)]}function fb(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function gb(a,b,c,e,f,d,n){for(var k=0,r=0;r<c;++r)for(var p=0;p<e;++p)a[k++]=b[f*r+d*p+n]}function Gb(a,b,c,e){function f(b){this.id=r++,this.buffer=a.createBuffer(),this.type=b,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,c.profile&&(this.stats={size:0})}function d(b,c,l){b.byteLength=c.byteLength,a.bufferData(b.type,c,l)}function n(a,b,c,g,h,e){if(a.usage=c,Array.isArray(b)){if(a.dtype=g||5126,0<b.length)if(Array.isArray(b[0])){h=hb(b);for(var t=g=1;t<h.length;++t)g*=h[t];a.dimension=g,d(a,b=Qa(b,h,a.dtype),c),e?a.persistentData=b:z.freeType(b)}else"number"==typeof b[0]?(a.dimension=h,fb(h=z.allocType(a.dtype,b.length),b),d(a,h,c),e?a.persistentData=h:z.freeType(h)):P(b[0])&&(a.dimension=b[0].length,a.dtype=g||Ha(b[0])||5126,d(a,b=Qa(b,[b.length,b[0].length],a.dtype),c),e?a.persistentData=b:z.freeType(b))}else if(P(b))a.dtype=g||Ha(b),a.dimension=h,d(a,b,c),e&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(ka(b)){h=b.shape;var f=b.stride,p=(t=b.offset,0),k=0,r=0,n=0;1===h.length?(p=h[0],k=1,r=f[0],n=0):2===h.length&&(p=h[0],k=h[1],r=f[0],n=f[1]),a.dtype=g||Ha(b.data)||5126,a.dimension=k,gb(h=z.allocType(a.dtype,p*k),b.data,p,k,r,n,t),d(a,h,c),e?a.persistentData=h:z.freeType(h)}}function k(c){b.bufferCount--;for(var d=0;d<e.state.length;++d){var l=e.state[d];l.buffer===c&&(a.disableVertexAttribArray(d),l.buffer=null)}a.deleteBuffer(c.buffer),c.buffer=null,delete p[c.id]}var r=0,p={};f.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){k(this)};var u=[];return c.profile&&(b.getTotalBufferSize=function(){var a=0;return Object.keys(p).forEach(function(b){a+=p[b].stats.size}),a}),{create:function(m,e,l,g){function h(b){var m=35044,e=null,l=0,f=0,p=1;return Array.isArray(b)||P(b)||ka(b)?e=b:"number"==typeof b?l=0|b:b&&("data"in b&&(e=b.data),"usage"in b&&(m=jb[b.usage]),"type"in b&&(f=Ra[b.type]),"dimension"in b&&(p=0|b.dimension),"length"in b&&(l=0|b.length)),d.bind(),e?n(d,e,m,f,p,g):(l&&a.bufferData(d.type,l,m),d.dtype=f||5121,d.usage=m,d.dimension=p,d.byteLength=l),c.profile&&(d.stats.size=d.byteLength*la[d.dtype]),h}b.bufferCount++;var d=new f(e);return p[d.id]=d,l||h(m),h._reglType="buffer",h._buffer=d,h.subdata=function(b,c){var m,g=0|(c||0);if(d.bind(),P(b))a.bufferSubData(d.type,g,b);else if(Array.isArray(b)){if(0<b.length)if("number"==typeof b[0]){var e=z.allocType(d.dtype,b.length);fb(e,b),a.bufferSubData(d.type,g,e),z.freeType(e)}else(Array.isArray(b[0])||P(b[0]))&&(m=hb(b),e=Qa(b,m,d.dtype),a.bufferSubData(d.type,g,e),z.freeType(e))}else if(ka(b)){m=b.shape;var l=b.stride,f=e=0,p=0,E=0;1===m.length?(e=m[0],f=1,p=l[0],E=0):2===m.length&&(e=m[0],f=m[1],p=l[0],E=l[1]),m=Array.isArray(b.data)?d.dtype:Ha(b.data),gb(m=z.allocType(m,e*f),b.data,e,f,p,E,b.offset),a.bufferSubData(d.type,g,m),z.freeType(m)}return h},c.profile&&(h.stats=d.stats),h.destroy=function(){k(d)},h},createStream:function(a,b){var c=u.pop();return c||(c=new f(a)),c.bind(),n(c,b,35040,0,1,!1),c},destroyStream:function(a){u.push(a)},clear:function(){R(p).forEach(k),u.forEach(k)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null},restore:function(){R(p).forEach(function(b){b.buffer=a.createBuffer(),a.bindBuffer(b.type,b.buffer),a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:n}}function Hb(a,b,c,e){function f(a){this.id=r++,k[this.id]=this,this.buffer=a,this.primType=4,this.type=this.vertCount=0}function d(d,e,l,g,h,f,p){if(d.buffer.bind(),e){var k=p;p||P(e)&&(!ka(e)||P(e.data))||(k=b.oes_element_index_uint?5125:5123),c._initBuffer(d.buffer,e,l,k,3)}else a.bufferData(34963,f,l),d.buffer.dtype=k||5121,d.buffer.usage=l,d.buffer.dimension=3,d.buffer.byteLength=f;if(k=p,!p){switch(d.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;break;case 5125:case 5124:k=5125}d.buffer.dtype=k}d.type=k,0>(e=h)&&(e=d.buffer.byteLength,5123===k?e>>=1:5125===k&&(e>>=2)),d.vertCount=e,e=g,0>g&&(e=4,1===(g=d.buffer.dimension)&&(e=0),2===g&&(e=1),3===g&&(e=4)),d.primType=e}function n(a){e.elementsCount--,delete k[a.id],a.buffer.destroy(),a.buffer=null}var k={},r=0,p={uint8:5121,uint16:5123};b.oes_element_index_uint&&(p.uint32=5125),f.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(a,b){function l(a){if(a)if("number"==typeof a)g(a),h.primType=4,h.vertCount=0|a,h.type=5121;else{var b=null,c=35044,e=-1,f=-1,m=0,k=0;Array.isArray(a)||P(a)||ka(a)?b=a:("data"in a&&(b=a.data),"usage"in a&&(c=jb[a.usage]),"primitive"in a&&(e=Sa[a.primitive]),"count"in a&&(f=0|a.count),"type"in a&&(k=p[a.type]),"length"in a?m=0|a.length:(m=f,5123===k||5122===k?m*=2:5125!==k&&5124!==k||(m*=4))),d(h,b,c,e,f,m,k)}else g(),h.primType=4,h.vertCount=0,h.type=5121;return l}var g=c.create(null,34963,!0),h=new f(g._buffer);return e.elementsCount++,l(a),l._reglType="elements",l._elements=h,l.subdata=function(a,b){return g.subdata(a,b),l},l.destroy=function(){n(h)},l},createStream:function(a){var b=u.pop();return b||(b=new f(c.create(null,34963,!0,!1)._buffer)),d(b,a,35040,-1,-1,0,0),b},destroyStream:function(a){u.push(a)},getElements:function(a){return"function"==typeof a&&a._elements instanceof f?a._elements:null},clear:function(){R(k).forEach(n)}}}function kb(a){for(var b=z.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(1/0===a[c])b[c]=31744;else if(-1/0===a[c])b[c]=64512;else{lb[0]=a[c];var f=(e=Ib[0])>>>31<<15,d=(e<<1>>>24)-127,e=e>>13&1023;b[c]=-24>d?f:-14>d?f+(e+1024>>-14-d):15<d?f+31744:f+(d+15<<10)+e}return b}function ra(a){return Array.isArray(a)||P(a)}function Ea(a){return"[object "+a+"]"}function mb(a){return Array.isArray(a)&&(0===a.length||"number"==typeof a[0])}function nb(a){return!(!Array.isArray(a)||0===a.length||!ra(a[0]))}function ma(a){return Object.prototype.toString.call(a)}function Ta(a){if(!a)return!1;var b=ma(a);return 0<=Jb.indexOf(b)||(mb(a)||nb(a)||ka(a))}function ob(a,b){36193===a.type?(a.data=kb(b),z.freeType(b)):a.data=b}function Ja(a,b,c,e,f,d){if(a=void 0!==v[a]?v[a]:S[a]*ha[b],d&&(a*=6),f){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}function Kb(a,b,c,e,f,d,n){function k(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function r(a,b){a.internalformat=b.internalformat,a.format=b.format,a.type=b.type,a.compressed=b.compressed,a.premultiplyAlpha=b.premultiplyAlpha,a.flipY=b.flipY,a.unpackAlignment=b.unpackAlignment,a.colorSpace=b.colorSpace,a.width=b.width,a.height=b.height,a.channels=b.channels}function p(a,b){if("object"==typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha),"flipY"in b&&(a.flipY=b.flipY),"alignment"in b&&(a.unpackAlignment=b.alignment),"colorSpace"in b&&(a.colorSpace=ya[b.colorSpace]),"type"in b&&(a.type=F[b.type]);var c=a.width,e=a.height,d=a.channels,g=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(d=b.shape[2],g=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),"channels"in b&&(d=b.channels,g=!0)),a.width=0|c,a.height=0|e,a.channels=0|d,c=!1,"format"in b&&(c=b.format,e=a.internalformat=U[c],a.format=Lb[e],c in F&&!("type"in b)&&(a.type=F[c]),c in Y&&(a.compressed=!0),c=!0),!g&&c?a.channels=S[a.format]:g&&!c&&a.channels!==La[a.format]&&(a.format=a.internalformat=La[a.channels])}}function u(b){a.pixelStorei(37440,b.flipY),a.pixelStorei(37441,b.premultiplyAlpha),a.pixelStorei(37443,b.colorSpace),a.pixelStorei(3317,b.unpackAlignment)}function m(){k.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function C(a,b){var c=null;if(Ta(b)?c=b:b&&(p(a,b),"x"in b&&(a.xOffset=0|b.x),"y"in b&&(a.yOffset=0|b.y),Ta(b.data)&&(c=b.data)),b.copy){var e=f.viewportWidth,d=f.viewportHeight;a.width=a.width||e-a.xOffset,a.height=a.height||d-a.yOffset,a.needsCopy=!0}else if(c){if(P(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(c)]);else if(mb(c)){switch(a.channels=a.channels||4,d=(e=c).length,a.type){case 5121:case 5123:case 5125:case 5126:(d=z.allocType(a.type,d)).set(e),a.data=d;break;case 36193:a.data=kb(e)}a.alignment=1,a.needsFree=!0}else if(ka(c)){e=c.data,Array.isArray(e)||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(e)]);d=c.shape;var h,l,q,y,g=c.stride;3===d.length?(q=d[2],y=g[2]):y=q=1,h=d[0],l=d[1],d=g[0],g=g[1],a.alignment=1,a.width=h,a.height=l,a.channels=q,a.format=a.internalformat=La[q],a.needsFree=!0,h=y,c=c.offset,q=a.width,y=a.height,l=a.channels;for(var G=z.allocType(36193===a.type?5126:a.type,q*y*l),H=0,ea=0;ea<y;++ea)for(var fa=0;fa<q;++fa)for(var J=0;J<l;++J)G[H++]=e[d*fa+g*ea+h*J+c];ob(a,G)}else if(ma(c)===Ua||ma(c)===pb)ma(c)===Ua?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(ma(c)===qb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(ma(c)===rb)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(ma(c)===sb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(nb(c)){for(e=a.width||c[0].length,d=a.height||c.length,g=a.channels,g=ra(c[0][0])?g||c[0][0].length:g||1,h=Ma.shape(c),q=1,y=0;y<h.length;++y)q*=h[y];q=z.allocType(36193===a.type?5126:a.type,q),Ma.flatten(c,h,"",q),ob(a,q),a.alignment=1,a.width=e,a.height=d,a.channels=g,a.format=a.internalformat=La[g],a.needsFree=!0}}else a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4}function l(b,c,d,g,h){var l=b.element,f=b.data,k=b.internalformat,q=b.format,y=b.type,G=b.width,H=b.height;u(b),l?a.texSubImage2D(c,h,d,g,q,y,l):b.compressed?a.compressedTexSubImage2D(c,h,d,g,k,G,H,f):b.needsCopy?(e(),a.copyTexSubImage2D(c,h,d,g,b.xOffset,b.yOffset,G,H)):a.texSubImage2D(c,h,d,g,G,H,q,y,f)}function g(){return K.pop()||new m}function h(a){a.needsFree&&z.freeType(a.data),m.call(a),K.push(a)}function t(a,b,c){var e=a.images[0]=g();a.mipmask=1,e.width=a.width=b,e.height=a.height=c,e.channels=a.channels=4}function B(a,b){var c=null;if(Ta(b))r(c=a.images[0]=g(),a),C(c,b),a.mipmask=1;else if(p(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,d=0;d<e.length;++d)r(c=a.images[d]=g(),a),c.width>>=d,c.height>>=d,C(c,e[d]),a.mipmask|=1<<d;else r(c=a.images[0]=g(),a),C(c,b),a.mipmask=1;r(a,a.images[0])}function X(b,c){for(var d=b.images,g=0;g<d.length&&d[g];++g){var h=d[g],l=c,f=g,k=h.element,q=h.data,y=h.internalformat,G=h.format,H=h.type,ea=h.width,fa=h.height,J=h.channels;u(h),k?a.texImage2D(l,f,G,G,H,k):h.compressed?a.compressedTexImage2D(l,f,y,ea,fa,0,q):h.needsCopy?(e(),a.copyTexImage2D(l,f,G,h.xOffset,h.yOffset,ea,fa,0)):((h=!q)&&(q=z.zero.allocType(H,ea*fa*J)),a.texImage2D(l,f,G,ea,fa,0,G,H,q),h&&q&&z.zero.freeType(q))}}function x(){var a=tb.pop()||new function qa(){k.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)};k.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ib(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&h(b[c]),b[c]=null;tb.push(a)}function v(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function N(a,b){"min"in b&&(a.minFilter=Va[b.min],0<=Mb.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)),"mag"in b&&(a.magFilter=V[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"==typeof e?c=d=L[e]:Array.isArray(e)&&(c=L[e[0]],d=L[e[1]])}else"wrapS"in b&&(c=L[b.wrapS]),"wrapT"in b&&(d=L[b.wrapT]);if(a.wrapS=c,a.wrapT=d,"anisotropic"in b&&(a.anisotropic=b.anisotropic),"mipmap"in b){switch(c=!1,typeof b.mipmap){case"string":a.mipmapHint=A[b.mipmap],c=a.genMipmaps=!0;break;case"boolean":c=a.genMipmaps=b.mipmap;break;case"object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function Q(c,d){a.texParameteri(d,10241,c.minFilter),a.texParameteri(d,10240,c.magFilter),a.texParameteri(d,10242,c.wrapS),a.texParameteri(d,10243,c.wrapT),b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic),c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function E(b){k.call(this),this.mipmask=0,this.internalformat=6408,this.id=za++,this.refCount=1,this.target=b,this.texture=a.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new v,n.profile&&(this.stats={size:0})}function T(b){a.activeTexture(33984),a.bindTexture(b.target,b.texture)}function Ba(){var b=na[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function w(b){var c=b.texture,e=b.unit,g=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(g,null),na[e]=null),a.deleteTexture(c),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete Z[b.id],d.textureCount--}var A={"don't care":4352,"dont care":4352,nice:4354,fast:4353},L={repeat:10497,clamp:33071,mirror:33648},V={nearest:9728,linear:9729},Va=D({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},V),ya={none:0,browser:37444},F={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},U={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Y={};b.ext_srgb&&(U.srgb=35904,U.srgba=35906),b.oes_texture_float&&(F.float32=F.float=5126),b.oes_texture_half_float&&(F.float16=F["half float"]=36193),b.webgl_depth_texture&&(D(U,{depth:6402,"depth stencil":34041}),D(F,{uint16:5123,uint32:5125,"depth stencil":34042})),b.webgl_compressed_texture_s3tc&&D(Y,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),b.webgl_compressed_texture_atc&&D(Y,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),b.webgl_compressed_texture_pvrtc&&D(Y,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),b.webgl_compressed_texture_etc1&&(Y["rgb etc1"]=36196);var Nb=Array.prototype.slice.call(a.getParameter(34467));Object.keys(Y).forEach(function(a){var b=Y[a];0<=Nb.indexOf(b)&&(U[a]=b)});var ca=Object.keys(U);c.textureFormats=ca;var O=[];Object.keys(U).forEach(function(a){O[U[a]]=a});var ba=[];Object.keys(F).forEach(function(a){ba[F[a]]=a});var oa=[];Object.keys(V).forEach(function(a){oa[V[a]]=a});var Aa=[];Object.keys(Va).forEach(function(a){Aa[Va[a]]=a});var ia=[];Object.keys(L).forEach(function(a){ia[L[a]]=a});var Lb=ca.reduce(function(a,b){var c=U[b];return 6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407,a},{}),K=[],tb=[],za=0,Z={},ga=c.maxTextureUnits,na=Array(ga).map(function(){return null});return D(E.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<ga;++c){var e=na[c];if(e){if(0<e.bindCount)continue;e.unit=-1}na[c]=this,b=c;break}n.profile&&d.maxTextureUnits<b+1&&(d.maxTextureUnits=b+1),this.unit=b,a.activeTexture(33984+b),a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&w(this)}}),n.profile&&(d.getTotalTextureSize=function(){var a=0;return Object.keys(Z).forEach(function(b){a+=Z[b].stats.size}),a}),{create2D:function(b,c){function e(a,b){var c=f.texInfo;v.call(c);var d=x();return"number"==typeof a?t(d,0|a,"number"==typeof b?0|b:0|a):a?(N(c,a),B(d,a)):t(d,1,1),c.genMipmaps&&(d.mipmask=(d.width<<1)-1),f.mipmask=d.mipmask,r(f,d),f.internalformat=d.internalformat,e.width=d.width,e.height=d.height,T(f),X(d,3553),Q(c,3553),Ba(),ib(d),n.profile&&(f.stats.size=Ja(f.internalformat,f.type,d.width,d.height,c.genMipmaps,!1)),e.format=O[f.internalformat],e.type=ba[f.type],e.mag=oa[c.magFilter],e.min=Aa[c.minFilter],e.wrapS=ia[c.wrapS],e.wrapT=ia[c.wrapT],e}var f=new E(3553);return Z[f.id]=f,d.textureCount++,e(b,c),e.subimage=function(a,b,c,d){b|=0,c|=0,d|=0;var q=g();return r(q,f),q.width=0,q.height=0,C(q,a),q.width=q.width||(f.width>>d)-b,q.height=q.height||(f.height>>d)-c,T(f),l(q,3553,b,c,d),Ba(),h(q),e},e.resize=function(b,c){var d=0|b,g=0|c||d;if(d===f.width&&g===f.height)return e;e.width=f.width=d,e.height=f.height=g,T(f);for(var q,y=f.channels,G=f.type,H=0;f.mipmask>>H;++H){var ea=d>>H,fa=g>>H;if(!ea||!fa)break;q=z.zero.allocType(G,ea*fa*y),a.texImage2D(3553,H,f.format,ea,fa,0,f.format,f.type,q),q&&z.zero.freeType(q)}return Ba(),n.profile&&(f.stats.size=Ja(f.internalformat,f.type,d,g,!1,!1)),e},e._reglType="texture2d",e._texture=f,n.profile&&(e.stats=f.stats),e.destroy=function(){f.decRef()},e},createCube:function(b,c,e,f,k,m){function A(a,b,c,d,e,J){var I,da=w.texInfo;for(v.call(da),I=0;6>I;++I)q[I]=x();if("number"!=typeof a&&a){if("object"==typeof a)if(b)B(q[0],a),B(q[1],b),B(q[2],c),B(q[3],d),B(q[4],e),B(q[5],J);else if(N(da,a),p(w,a),"faces"in a)for(a=a.faces,I=0;6>I;++I)r(q[I],w),B(q[I],a[I]);else for(I=0;6>I;++I)B(q[I],a)}else for(a=0|a||1,I=0;6>I;++I)t(q[I],a,a);for(r(w,q[0]),w.mipmask=da.genMipmaps?(q[0].width<<1)-1:q[0].mipmask,w.internalformat=q[0].internalformat,A.width=q[0].width,A.height=q[0].height,T(w),I=0;6>I;++I)X(q[I],34069+I);for(Q(da,34067),Ba(),n.profile&&(w.stats.size=Ja(w.internalformat,w.type,A.width,A.height,da.genMipmaps,!0)),A.format=O[w.internalformat],A.type=ba[w.type],A.mag=oa[da.magFilter],A.min=Aa[da.minFilter],A.wrapS=ia[da.wrapS],A.wrapT=ia[da.wrapT],I=0;6>I;++I)ib(q[I]);return A}var w=new E(34067);Z[w.id]=w,d.cubeCount++;var q=Array(6);return A(b,c,e,f,k,m),A.subimage=function(a,b,c,q,d){c|=0,q|=0,d|=0;var e=g();return r(e,w),e.width=0,e.height=0,C(e,b),e.width=e.width||(w.width>>d)-c,e.height=e.height||(w.height>>d)-q,T(w),l(e,34069+a,c,q,d),Ba(),h(e),A},A.resize=function(b){if((b|=0)!==w.width){A.width=w.width=b,A.height=w.height=b,T(w);for(var c=0;6>c;++c)for(var q=0;w.mipmask>>q;++q)a.texImage2D(34069+c,q,w.format,b>>q,b>>q,0,w.format,w.type,null);return Ba(),n.profile&&(w.stats.size=Ja(w.internalformat,w.type,A.width,A.height,!1,!0)),A}},A._reglType="textureCube",A._texture=w,n.profile&&(A.stats=w.stats),A.destroy=function(){w.decRef()},A},clear:function(){for(var b=0;b<ga;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),na[b]=null;R(Z).forEach(w),d.cubeCount=0,d.textureCount=0},getTexture:function(a){return null},restore:function(){R(Z).forEach(function(b){b.texture=a.createTexture(),a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!=(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);Q(b.texInfo,b.target)})}}}function Ob(a,b,c,e,f,d){function n(a,b,c){this.target=a,this.texture=b,this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height),this.width=a,this.height=e}function k(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function r(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function p(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function u(a){var b=3553,c=null,e=null,d=a;return"object"==typeof a&&(d=a.data,"target"in a&&(b=0|a.target)),"texture2d"===(a=d._reglType)?c=d:"textureCube"===a?c=d:"renderbuffer"===a&&(e=d,b=36161),new n(b,c,e)}function m(a,b,c,d,g){return c?((a=e.create2D({width:a,height:b,format:d,type:g}))._texture.refCount=0,new n(3553,a,null)):((a=f.create({width:a,height:b,format:d}))._renderbuffer.refCount=0,new n(36161,null,a))}function C(a){return a&&(a.texture||a.renderbuffer)}function l(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function g(){this.id=N++,Q[this.id]=this,this.framebuffer=a.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function h(a){a.colorAttachments.forEach(k),k(a.depthAttachment),k(a.stencilAttachment),k(a.depthStencilAttachment)}function qa(b){a.deleteFramebuffer(b.framebuffer),b.framebuffer=null,d.framebufferCount--,delete Q[b.id]}function t(b){var e;a.bindFramebuffer(36160,b.framebuffer);var d=b.colorAttachments;for(e=0;e<d.length;++e)p(36064+e,d[e]);for(e=d.length;e<c.maxColorAttachments;++e)a.framebufferTexture2D(36160,36064+e,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0),a.framebufferTexture2D(36160,36096,3553,null,0),a.framebufferTexture2D(36160,36128,3553,null,0),p(36096,b.depthAttachment),p(36128,b.stencilAttachment),p(33306,b.depthStencilAttachment),a.checkFramebufferStatus(36160),a.bindFramebuffer(36160,X.next?X.next.framebuffer:null),X.cur=X.next,a.getError()}function B(a,b){function c(a,b){var d,g=0,f=0,l=!0,k=!0;d=null;var p=!0,n="rgba",B="uint8",qa=1,ba=null,oa=null,X=null,ia=!1;"number"==typeof a?(g=0|a,f=0|b||g):a?("shape"in a?(g=(f=a.shape)[0],f=f[1]):("radius"in a&&(g=f=a.radius),"width"in a&&(g=a.width),"height"in a&&(f=a.height)),("color"in a||"colors"in a)&&(d=a.color||a.colors,Array.isArray(d)),d||("colorCount"in a&&(qa=0|a.colorCount),"colorTexture"in a&&(p=!!a.colorTexture,n="rgba4"),"colorType"in a&&(B=a.colorType,!p)&&("half float"===B||"float16"===B?n="rgba16f":"float"!==B&&"float32"!==B||(n="rgba32f")),"colorFormat"in a&&(n=a.colorFormat,0<=z.indexOf(n)?p=!0:0<=x.indexOf(n)&&(p=!1))),("depthTexture"in a||"depthStencilTexture"in a)&&(ia=!(!a.depthTexture&&!a.depthStencilTexture)),"depth"in a&&("boolean"==typeof a.depth?l=a.depth:(ba=a.depth,k=!1)),"stencil"in a&&("boolean"==typeof a.stencil?k=a.stencil:(oa=a.stencil,l=!1)),"depthStencil"in a&&("boolean"==typeof a.depthStencil?l=k=a.depthStencil:(X=a.depthStencil,k=l=!1))):g=f=1;var E=null,v=null,D=null,T=null;if(Array.isArray(d))E=d.map(u);else if(d)E=[u(d)];else for(E=Array(qa),d=0;d<qa;++d)E[d]=m(g,f,p,n,B);for(g=g||E[0].width,f=f||E[0].height,ba?v=u(ba):l&&!k&&(v=m(g,f,ia,"depth","uint32")),oa?D=u(oa):k&&!l&&(D=m(g,f,!1,"stencil","uint8")),X?T=u(X):!ba&&!oa&&k&&l&&(T=m(g,f,ia,"depth stencil","depth stencil")),l=null,d=0;d<E.length;++d)r(E[d]),E[d]&&E[d].texture&&(k=Wa[E[d].texture._texture.format]*Na[E[d].texture._texture.type],null===l&&(l=k));return r(v),r(D),r(T),h(e),e.width=g,e.height=f,e.colorAttachments=E,e.depthAttachment=v,e.stencilAttachment=D,e.depthStencilAttachment=T,c.color=E.map(C),c.depth=C(v),c.stencil=C(D),c.depthStencil=C(T),c.width=e.width,c.height=e.height,t(e),c}var e=new g;return d.framebufferCount++,c(a,b),D(c,{resize:function(a,b){var d=0|a,g=0|b||d;if(d===e.width&&g===e.height)return c;for(var f=e.colorAttachments,h=0;h<f.length;++h)l(f[h],d,g);return l(e.depthAttachment,d,g),l(e.stencilAttachment,d,g),l(e.depthStencilAttachment,d,g),e.width=c.width=d,e.height=c.height=g,t(e),c},_reglType:"framebuffer",_framebuffer:e,destroy:function(){qa(e),h(e)},use:function(a){X.setFBO({framebuffer:c},a)}})}var X={cur:null,next:null,dirty:!1,setFBO:null},z=["rgba"],x=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&x.push("srgba"),b.ext_color_buffer_half_float&&x.push("rgba16f","rgb16f"),b.webgl_color_buffer_float&&x.push("rgba32f");var v=["uint8"];b.oes_texture_half_float&&v.push("half float","float16"),b.oes_texture_float&&v.push("float","float32");var N=0,Q={};return D(X,{getFramebuffer:function(a){return"function"==typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer)instanceof g?a:null},create:B,createCube:function(a){function b(a){var d,g={color:null},f=0,h=null;d="rgba";var l="uint8",k=1;if("number"==typeof a?f=0|a:a?("shape"in a?f=a.shape[0]:("radius"in a&&(f=0|a.radius),"width"in a?f=0|a.width:"height"in a&&(f=0|a.height)),("color"in a||"colors"in a)&&(h=a.color||a.colors,Array.isArray(h)),h||("colorCount"in a&&(k=0|a.colorCount),"colorType"in a&&(l=a.colorType),"colorFormat"in a&&(d=a.colorFormat)),"depth"in a&&(g.depth=a.depth),"stencil"in a&&(g.stencil=a.stencil),"depthStencil"in a&&(g.depthStencil=a.depthStencil)):f=1,h)if(Array.isArray(h))for(a=[],d=0;d<h.length;++d)a[d]=h[d];else a=[h];else for(a=Array(k),h={radius:f,format:d,type:l},d=0;d<k;++d)a[d]=e.createCube(h);for(g.color=Array(a.length),d=0;d<a.length;++d)k=a[d],f=f||k.width,g.color[d]={target:34069,data:a[d]};for(d=0;6>d;++d){for(k=0;k<a.length;++k)g.color[k].target=34069+d;0<d&&(g.depth=c[0].depth,g.stencil=c[0].stencil,g.depthStencil=c[0].depthStencil),c[d]?c[d](g):c[d]=B(g)}return D(b,{width:f,height:f,color:a})}var c=Array(6);return b(a),D(b,{faces:c,resize:function(a){var d=0|a;if(d===b.width)return b;var e=b.color;for(a=0;a<e.length;++a)e[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);return b.width=b.height=d,b},_reglType:"framebufferCube",destroy:function(){c.forEach(function(a){a.destroy()})}})},clear:function(){R(Q).forEach(qa)},restore:function(){R(Q).forEach(function(b){b.framebuffer=a.createFramebuffer(),t(b)})}})}function ub(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function Qb(a,b,c,e){function f(a,b,c,d){this.name=a,this.id=b,this.location=c,this.info=d}function d(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id)return void(a[c].location=b.location);a.push(b)}function n(c,d,e){if(!(f=(e=35632===c?p:u)[d])){var l=b.str(d),f=a.createShader(c);a.shaderSource(f,l),a.compileShader(f),e[d]=f}return f}function k(a,b){this.id=l++,this.fragId=a,this.vertId=b,this.program=null,this.uniforms=[],this.attributes=[],e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function r(c,h){var l,k;l=n(35632,c.fragId),k=n(35633,c.vertId);var p=c.program=a.createProgram();a.attachShader(p,l),a.attachShader(p,k),a.linkProgram(p);var m=a.getProgramParameter(p,35718);e.profile&&(c.stats.uniformsCount=m);var r=c.uniforms;for(l=0;l<m;++l)if(k=a.getActiveUniform(p,l))if(1<k.size)for(var u=0;u<k.size;++u){var C=k.name.replace("[0]","["+u+"]");d(r,new f(C,b.id(C),a.getUniformLocation(p,C),k))}else d(r,new f(k.name,b.id(k.name),a.getUniformLocation(p,k.name),k));for(m=a.getProgramParameter(p,35721),e.profile&&(c.stats.attributesCount=m),r=c.attributes,l=0;l<m;++l)(k=a.getActiveAttrib(p,l))&&d(r,new f(k.name,b.id(k.name),a.getAttribLocation(p,k.name),k))}var p={},u={},m={},C=[],l=0;return e.profile&&(c.getMaxUniformsCount=function(){var a=0;return C.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)}),a},c.getMaxAttributesCount=function(){var a=0;return C.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)}),a}),{clear:function(){var b=a.deleteShader.bind(a);R(p).forEach(b),p={},R(u).forEach(b),u={},C.forEach(function(b){a.deleteProgram(b.program)}),C.length=0,m={},c.shaderCount=0},program:function(a,b,d){var e=m[b];e||(e=m[b]={});var f=e[a];return f||(f=new k(b,a),c.shaderCount++,r(f),e[a]=f,C.push(f)),f},restore:function(){p={},u={};for(var a=0;a<C.length;++a)r(C[a])},shader:n,frag:-1,vert:-1}}function Rb(a,b,c,e,f,d,n){function k(d){var f;f=null===b.next?5121:b.next.colorAttachments[0].texture._texture.type;var k=0,r=0,l=e.framebufferWidth,g=e.framebufferHeight,h=null;return P(d)?h=d:d&&(k=0|d.x,r=0|d.y,l=0|(d.width||e.framebufferWidth-k),g=0|(d.height||e.framebufferHeight-r),h=d.data||null),c(),d=l*g*4,h||(5121===f?h=new Uint8Array(d):5126===f&&(h=h||new Float32Array(d))),a.pixelStorei(3333,4),a.readPixels(k,r,l,g,6408,f,h),h}return function(a){return a&&"framebuffer"in a?function r(a){var c;return b.setFBO({framebuffer:a.framebuffer},function(){c=k(a)}),c}(a):k(a)}}function va(a){return Array.prototype.slice.call(a)}function Ca(a){return va(a).join("")}function Sb(){function a(){var a=[],b=[];return D(function(){a.push.apply(a,va(arguments))},{def:function(){var d="v"+c++;return b.push(d),0<arguments.length&&(a.push(d,"="),a.push.apply(a,va(arguments)),a.push(";")),d},toString:function(){return Ca([0<b.length?"var "+b+";":"",Ca(a)])}})}function b(){function b(a,e){d(a,e,"=",c.def(a,e),";")}var c=a(),d=a(),e=c.toString,f=d.toString;return D(function(){c.apply(c,va(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(a,d,e){b(a,d),c(a,d,"=",e,";")},toString:function(){return e()+f()}})}var c=0,e=[],f=[],d=a(),n={};return{global:d,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return e[b];return b="g"+c++,e.push(b),f.push(a),b},block:a,proc:function(a,c){function d(){var a="a"+e.length;return e.push(a),a}var e=[];c=c||0;for(var f=0;f<c;++f)d();var C=(f=b()).toString;return n[a]=D(f,{arg:d,toString:function(){return Ca(["function(",e.join(),"){",C(),"}"])}})},scope:b,cond:function(){var a=Ca(arguments),c=b(),d=b(),e=c.toString,f=d.toString;return D(c,{then:function(){return c.apply(c,va(arguments)),this},else:function(){return d.apply(d,va(arguments)),this},toString:function(){var b=f();return b&&(b="else{"+b+"}"),Ca(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',d,"return {"];Object.keys(n).forEach(function(b){a.push('"',b,'":',n[b].toString(),",")}),a.push("}");var b=Ca(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,e.concat(b)).apply(null,f)}}}function Oa(a){return Array.isArray(a)||P(a)||ka(a)}function vb(a){return a.sort(function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1})}function aa(a,b,c,e){this.thisDep=a,this.contextDep=b,this.propDep=c,this.append=e}function wa(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function x(a){return new aa(!1,!1,!1,a)}function K(a,b){var c=a.type;return 0===c?new aa(!0,1<=(c=a.data.length),2<=c,b):4===c?new aa((c=a.data).thisDep,c.contextDep,c.propDep,b):new aa(3===c,2===c,1===c,b)}function Tb(a,b,c,e,f,d,n,k,r,p,u,m,C,l,g){function h(a){return a.replace(".","_")}function v(a,b,c){var d=h(a);Ka.push(a),Fa[d]=sa[d]=!!c,ta[d]=b}function t(a,b,c){var d=h(a);Ka.push(a),Array.isArray(c)?(sa[d]=c.slice(),Fa[d]=c.slice()):sa[d]=Fa[d]=c,ua[d]=b}function B(){var a=Sb(),c=a.link,d=a.global;a.id=va++,a.batchId="0";var e=c(pa),f=a.shared={props:"a0"};Object.keys(pa).forEach(function(a){f[a]=d.def(e,".",a)});var g=a.next={},J=a.current={};Object.keys(ua).forEach(function(a){Array.isArray(sa[a])&&(g[a]=d.def(f.next,".",a),J[a]=d.def(f.current,".",a))});var I=a.constants={};Object.keys(ha).forEach(function(a){I[a]=d.def(JSON.stringify(ha[a]))}),a.invoke=function(b,d){switch(d.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(c(d.data),".call(",e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(f.props,d.data);case 2:return b.def(f.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}},a.attribCache={};var da={};return a.scopeAttrib=function(a){if((a=b.id(a))in da)return da[a];var d=p.scope[a];return d||(d=p.scope[a]=new za),da[a]=c(d)},a}function z(a,b){var c=a.static,d=a.dynamic;if("framebuffer"in c){var e=c.framebuffer;return e?(e=k.getFramebuffer(e),x(function(a,b){var c=a.link(e),d=a.shared;return b.set(d.framebuffer,".next",c),d=d.context,b.set(d,".framebufferWidth",c+".width"),b.set(d,".framebufferHeight",c+".height"),c})):x(function(a,b){var c=a.shared;return b.set(c.framebuffer,".next","null"),c=c.context,b.set(c,".framebufferWidth",c+".drawingBufferWidth"),b.set(c,".framebufferHeight",c+".drawingBufferHeight"),"null"})}if("framebuffer"in d){var f=d.framebuffer;return K(f,function(a,b){var c=a.invoke(b,f),d=a.shared,e=d.framebuffer;c=b.def(e,".getFramebuffer(",c,")");return b.set(e,".next",c),d=d.context,b.set(d,".framebufferWidth",c+"?"+c+".width:"+d+".drawingBufferWidth"),b.set(d,".framebufferHeight",c+"?"+c+".height:"+d+".drawingBufferHeight"),c})}return null}function P(a){function c(a){if(a in d){var q=b.id(d[a]);return(a=x(function(){return q})).id=q,a}if(a in e){var f=e[a];return K(f,function(a,b){var c=a.invoke(b,f);return b.def(a.shared.strings,".id(",c,")")})}return null}var d=a.static,e=a.dynamic,f=c("frag"),g=c("vert"),J=null;return wa(f)&&wa(g)?(J=u.program(g.id,f.id),a=x(function(a,b){return a.link(J)})):a=new aa(f&&f.thisDep||g&&g.thisDep,f&&f.contextDep||g&&g.contextDep,f&&f.propDep||g&&g.propDep,function(a,b){var d,e,c=a.shared.shader;return d=f?f.append(a,b):b.def(c,".","frag"),e=g?g.append(a,b):b.def(c,".","vert"),b.def(c+".program("+e+","+d+")")}),{frag:f,vert:g,progVar:a,program:J}}function N(a,b){function c(a,b){if(a in e){var d=0|e[a];return x(function(a,c){return b&&(a.OFFSET=d),d})}if(a in f){var q=f[a];return K(q,function(a,c){var d=a.invoke(c,q);return b&&(a.OFFSET=d),d})}return b&&g?x(function(a,b){return a.OFFSET="0",0}):null}var e=a.static,f=a.dynamic,g=function(){if("elements"in e){var a=e.elements;Oa(a)?a=d.getElements(d.create(a,!0)):a&&(a=d.getElements(a));var b=x(function(b,c){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});return b.value=a,b}if("elements"in f){var c=f.elements;return K(c,function(a,b){var e=(d=a.shared).isBufferArgs,d=d.elements,q=a.invoke(b,c),f=b.def("null");e=b.def(e,"(",q,")"),q=a.cond(e).then(f,"=",d,".createStream(",q,");").else(f,"=",d,".getElements(",q,");");return b.entry(q),b.exit(a.cond(e).then(d,".destroyStream(",f,");")),a.ELEMENTS=f})}return null}(),J=c("offset",!0);return{elements:g,primitive:function(){if("primitive"in e){var a=e.primitive;return x(function(b,c){return Sa[a]})}if("primitive"in f){var b=f.primitive;return K(b,function(a,c){var d=a.constants.primTypes,e=a.invoke(c,b);return c.def(d,"[",e,"]")})}return g?wa(g)?g.value?x(function(a,b){return b.def(a.ELEMENTS,".primType")}):x(function(){return 4}):new aa(g.thisDep,g.contextDep,g.propDep,function(a,b){var c=a.ELEMENTS;return b.def(c,"?",c,".primType:",4)}):null}(),count:function(){if("count"in e){var a=0|e.count;return x(function(){return a})}if("count"in f){var b=f.count;return K(b,function(a,c){return a.invoke(c,b)})}return g?wa(g)?g?J?new aa(J.thisDep,J.contextDep,J.propDep,function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):x(function(a,b){return b.def(a.ELEMENTS,".vertCount")}):x(function(){return-1}):new aa(g.thisDep||J.thisDep,g.contextDep||J.contextDep,g.propDep||J.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")}):null}(),instances:c("instances",!1),offset:J}}function T(a,c){var d=a.static,e=a.dynamic,g={};return Object.keys(d).forEach(function(a){var c=d[a],e=b.id(a),q=new za;if(Oa(c))q.state=1,q.buffer=f.getBuffer(f.create(c,34962,!1,!0)),q.type=0;else if(y=f.getBuffer(c))q.state=1,q.buffer=y,q.type=0;else if("constant"in c){var l=c.constant;q.buffer="null",q.state=2,"number"==typeof l?q.x=l:Da.forEach(function(a,b){b<l.length&&(q[a]=l[b])})}else{var y=Oa(c.buffer)?f.getBuffer(f.create(c.buffer,34962,!1,!0)):f.getBuffer(c.buffer),h=0|c.offset,k=0|c.stride,H=0|c.size,m=!!c.normalized,n=0;"type"in c&&(n=Ra[c.type]),c=0|c.divisor,q.buffer=y,q.state=1,q.size=H,q.normalized=m,q.type=n||y.dtype,q.offset=h,q.stride=k,q.divisor=c}g[a]=x(function(a,b){var c=a.attribCache;if(e in c)return c[e];var d={isStream:!1};return Object.keys(q).forEach(function(a){d[a]=q[a]}),q.buffer&&(d.buffer=a.link(q.buffer),d.type=d.type||d.buffer+".dtype"),c[e]=d})}),Object.keys(e).forEach(function(a){var b=e[a];g[a]=K(b,function(a,c){function d(a){c(y[a],"=",e,".",a,"|0;")}var e=a.invoke(c,b),q=a.shared,f=q.isBufferArgs,g=q.buffer,y={isStream:c.def(!1)},l=new za;l.state=1,Object.keys(l).forEach(function(a){y[a]=c.def(""+l[a])});var h=y.buffer,k=y.type;return c("if(",f,"(",e,")){",y.isStream,"=true;",h,"=",g,".createStream(",34962,",",e,");",k,"=",h,".dtype;","}else{",h,"=",g,".getBuffer(",e,");","if(",h,"){",k,"=",h,".dtype;",'}else if("constant" in ',e,"){",y.state,"=",2,";","if(typeof "+e+'.constant === "number"){',y[Da[0]],"=",e,".constant;",Da.slice(1).map(function(a){return y[a]}).join("="),"=0;","}else{",Da.map(function(a,b){return y[a]+"="+e+".constant.length>"+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",f,"(",e,".buffer)){",h,"=",g,".createStream(",34962,",",e,".buffer);","}else{",h,"=",g,".getBuffer(",e,".buffer);","}",k,'="type" in ',e,"?",q.glTypes,"[",e,".type]:",h,".dtype;",y.normalized,"=!!",e,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),c("}}"),c.exit("if(",y.isStream,"){",g,".destroyStream(",h,");","}"),y})}),g}function w(a,b,c,d,e){var f=z(a),g=function D(a,b,c){function d(a){if(a in e){var c=e[a];a=!0;var g,J,q=0|c.x,xa=0|c.y;return"width"in c?g=0|c.width:a=!1,"height"in c?J=0|c.height:a=!1,new aa(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,function(a,b){var d=a.shared.context,e=g;"width"in c||(e=b.def(d,".","framebufferWidth","-",q));var f=J;return"height"in c||(f=b.def(d,".","framebufferHeight","-",xa)),[q,xa,e,f]})}if(a in f){var G=f[a];return a=K(G,function(a,b){var c=a.invoke(b,G),d=a.shared.context,e=b.def(c,".x|0"),q=b.def(c,".y|0");return[e,q,b.def('"width" in ',c,"?",c,".width|0:","(",d,".","framebufferWidth","-",e,")"),c=b.def('"height" in ',c,"?",c,".height|0:","(",d,".","framebufferHeight","-",q,")")]}),b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep),a}return b?new aa(b.thisDep,b.contextDep,b.propDep,function(a,b){var c=a.shared.context;return[0,0,b.def(c,".","framebufferWidth"),b.def(c,".","framebufferHeight")]}):null}var e=a.static,f=a.dynamic;if(a=d("viewport")){var g=a;a=new aa(a.thisDep,a.contextDep,a.propDep,function(a,b){var c=g.append(a,b),d=a.shared.context;return b.set(d,".viewportWidth",c[2]),b.set(d,".viewportHeight",c[3]),c})}return{viewport:a,scissor_box:d("scissor.box")}}(a,f),l=N(a),k=function Q(a,b){var c=a.static,d=a.dynamic,e={};return Ka.forEach(function(a){function b(q,g){if(a in c){var y=q(c[a]);e[f]=x(function(){return y})}else if(a in d){var l=d[a];e[f]=K(l,function(a,b){return g(a,b,a.invoke(b,l))})}}var f=h(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return b(function(a){return a},function(a,b,c){return c});case"depth.func":return b(function(a){return Xa[a]},function(a,b,c){return b.def(a.constants.compareFuncs,"[",c,"]")});case"depth.range":return b(function(a){return a},function(a,b,c){return[b.def("+",c,"[0]"),b=b.def("+",c,"[1]")]});case"blend.func":return b(function(a){return[Ga["srcRGB"in a?a.srcRGB:a.src],Ga["dstRGB"in a?a.dstRGB:a.dst],Ga["srcAlpha"in a?a.srcAlpha:a.src],Ga["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,b,c){function d(a,e){return b.def('"',a,e,'" in ',c,"?",c,".",a,e,":",c,".",a)}a=a.constants.blendFuncs;var e=d("src","RGB"),f=d("dst","RGB"),q=(e=b.def(a,"[",e,"]"),b.def(a,"[",d("src","Alpha"),"]"));return[e,f=b.def(a,"[",f,"]"),q,a=b.def(a,"[",d("dst","Alpha"),"]")]});case"blend.equation":return b(function(a){return"string"==typeof a?[Z[a],Z[a]]:"object"==typeof a?[Z[a.rgb],Z[a.alpha]]:void 0},function(a,b,c){var d=a.constants.blendEquations,e=b.def(),f=b.def();return(a=a.cond("typeof ",c,'==="string"')).then(e,"=",f,"=",d,"[",c,"];"),a.else(e,"=",d,"[",c,".rgb];",f,"=",d,"[",c,".alpha];"),b(a),[e,f]});case"blend.color":return b(function(a){return O(4,function(b){return+a[b]})},function(a,b,c){return O(4,function(a){return b.def("+",c,"[",a,"]")})});case"stencil.mask":return b(function(a){return 0|a},function(a,b,c){return b.def(c,"|0")});case"stencil.func":return b(function(a){return[Xa[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,b,c){return[a=b.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680),b.def(c,".ref|0"),b=b.def('"mask" in ',c,"?",c,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return b(function(b){return["stencil.opBack"===a?1029:1028,Pa[b.fail||"keep"],Pa[b.zfail||"keep"],Pa[b.zpass||"keep"]]},function(b,c,d){function e(a){return c.def('"',a,'" in ',d,"?",f,"[",d,".",a,"]:",7680)}var f=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case"polygonOffset.offset":return b(function(a){return[0|a.factor,0|a.units]},function(a,b,c){return[b.def(c,".factor|0"),b=b.def(c,".units|0")]});case"cull.face":return b(function(a){var b=0;return"front"===a?b=1028:"back"===a&&(b=1029),b},function(a,b,c){return b.def(c,'==="front"?',1028,":",1029)});case"lineWidth":return b(function(a){return a},function(a,b,c){return c});case"frontFace":return b(function(a){return wb[a]},function(a,b,c){return b.def(c+'==="cw"?2304:2305')});case"colorMask":return b(function(a){return a.map(function(a){return!!a})},function(a,b,c){return O(4,function(a){return"!!"+c+"["+a+"]"})});case"sample.coverage":return b(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,b,c){return[b.def('"value" in ',c,"?+",c,".value:1"),b=b.def("!!",c,".invert")]})}}),e}(a),m=P(a),xa=g.viewport;return xa&&(k.viewport=xa),(g=g[xa=h("scissor.box")])&&(k[xa]=g),(f={framebuffer:f,draw:l,shader:m,state:k,dirty:g=0<Object.keys(k).length}).profile=function X(a){var c,b=a.static;if(a=a.dynamic,"profile"in b){var d=!!b.profile;(c=x(function(a,b){return d})).enable=d}else if("profile"in a){var e=a.profile;c=K(e,function(a,b){return a.invoke(b,e)})}return c}(a),f.uniforms=function E(a,b){var c=a.static,d=a.dynamic,e={};return Object.keys(c).forEach(function(a){var d,b=c[a];if("number"==typeof b||"boolean"==typeof b)d=x(function(){return b});else if("function"==typeof b){var f=b._reglType;"texture2d"===f||"textureCube"===f?d=x(function(a){return a.link(b)}):"framebuffer"!==f&&"framebufferCube"!==f||(d=x(function(a){return a.link(b.color[0])}))}else ra(b)&&(d=x(function(a){return a.global.def("[",O(b.length,function(a){return b[a]}),"]")}));d.value=b,e[a]=d}),Object.keys(d).forEach(function(a){var b=d[a];e[a]=K(b,function(a,c){return a.invoke(c,b)})}),e}(c),f.attributes=T(b),f.context=function M(a){var b=a.static,c=a.dynamic,d={};return Object.keys(b).forEach(function(a){var c=b[a];d[a]=x(function(a,b){return"number"==typeof c||"boolean"==typeof c?""+c:a.link(c)})}),Object.keys(c).forEach(function(a){var b=c[a];d[a]=K(b,function(a,c){return a.invoke(c,b)})}),d}(d),f}function A(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach(function(f){b.save(d,"."+f),e(d,".",f,"=",c[f].append(a,b),";")}),b(e)}function L(a,b,c,d){var l,f=(e=a.shared).gl,g=e.framebuffer;na&&(l=b.def(e.extensions,".webgl_draw_buffers"));var e=(h=a.constants).drawBuffer,h=h.backBuffer;a=c?c.append(a,b):b.def(g,".next"),d||b("if(",a,"!==",g,".cur){"),b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);"),na&&b(l,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);"),b("}else{",f,".bindFramebuffer(",36160,",null);"),na&&b(l,".drawBuffersWEBGL(",h,");"),b("}",g,".cur=",a,";"),d||b("}")}function V(a,b,c){var d=a.shared,e=d.gl,f=a.current,g=a.next,l=d.current,k=d.next,m=a.cond(l,".dirty");Ka.forEach(function(b){var d,y;if(!((b=h(b))in c.state))if(b in g){d=g[b],y=f[b];var H=O(sa[b].length,function(a){return m.def(d,"[",a,"]")});m(a.cond(H.map(function(a,b){return a+"!=="+y+"["+b+"]"}).join("||")).then(e,".",ua[b],"(",H,");",H.map(function(a,b){return y+"["+b+"]="+a}).join(";"),";"))}else d=m.def(k,".",b),H=a.cond(d,"!==",l,".",b),m(H),b in ta?H(a.cond(d).then(e,".enable(",ta[b],");").else(e,".disable(",ta[b],");"),l,".",b,"=",d,";"):H(e,".",ua[b],"(",d,");",l,".",b,"=",d,";")}),0===Object.keys(c.state).length&&m(l,".dirty=false;"),b(m)}function R(a,b,c,d){var e=a.shared,f=a.current,g=e.current,l=e.gl;vb(Object.keys(c)).forEach(function(e){var h=c[e];if(!d||d(h)){var k=h.append(a,b);if(ta[e]){var m=ta[e];wa(h)?b(l,k?".enable(":".disable(",m,");"):b(a.cond(k).then(l,".enable(",m,");").else(l,".disable(",m,");")),b(g,".",e,"=",k,";")}else if(ra(k)){var n=f[e];b(l,".",ua[e],"(",k,");",k.map(function(a,b){return n+"["+b+"]="+a}).join(";"),";")}else b(l,".",ua[e],"(",k,");",g,".",e,"=",k,";")}})}function ya(a,b){ga&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function F(a,b,c,d,e){function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(a){a(t=b.def(),"=",f(),";"),"string"==typeof e?a(n,".count+=",e,";"):a(n,".count++;"),l&&(d?a(u=b.def(),"=",r,".getNumPendingQueries();"):a(r,".beginQuery(",n,");"))}function h(a){a(n,".cpuTime+=",f(),"-",t,";"),l&&(d?a(r,".pushScopeStats(",u,",",r,".getNumPendingQueries(),",n,");"):a(r,".endQuery();"))}function k(a){var c=b.def(p,".profile");b(p,".profile=",a,";"),b.exit(p,".profile=",c,";")}var t,u,m=a.shared,n=a.stats,p=m.current,r=m.timer;if(c=c.profile){if(wa(c))return void(c.enable?(g(b),h(b.exit),k("true")):k("false"));k(c=c.append(a,b))}else c=b.def(p,".profile");g(m=a.block()),b("if(",c,"){",m,"}"),h(a=a.block()),b.exit("if(",c,"){",a,"}")}function U(a,b,c,d,e){function g(c,d,e){function f(){b("if(!",G,".buffer){",h,".enableVertexAttribArray(",m,");}");var g,c=e.type;g=e.size?b.def(e.size,"||",d):d,b("if(",G,".type!==",c,"||",G,".size!==",g,"||",p.map(function(a){return G+"."+a+"!=="+e[a]}).join("||"),"){",h,".bindBuffer(",34962,",",n,".buffer);",h,".vertexAttribPointer(",[m,g,c,e.normalized,e.stride,e.offset],");",G,".type=",c,";",G,".size=",g,";",p.map(function(a){return G+"."+a+"="+e[a]+";"}).join(""),"}"),ga&&(c=e.divisor,b("if(",G,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,c],");",G,".divisor=",c,";}"))}function k(){b("if(",G,".buffer){",h,".disableVertexAttribArray(",m,");","}if(",Da.map(function(a,b){return G+"."+a+"!=="+H[b]}).join("||"),"){",h,".vertexAttrib4f(",m,",",H,");",Da.map(function(a,b){return G+"."+a+"="+H[b]+";"}).join(""),"}")}var h=l.gl,m=b.def(c,".location"),G=b.def(l.attributes,"[",m,"]");c=e.state;var n=e.buffer,H=[e.x,e.y,e.z,e.w],p=["buffer","normalized","offset","stride"];1===c?f():2===c?k():(b("if(",c,"===",1,"){"),f(),b("}else{"),k(),b("}"))}var l=a.shared;d.forEach(function(d){var k,l=d.name,h=c.attributes[l];if(h){if(!e(h))return;k=h.append(a,b)}else{if(!e(xb))return;var m=a.scopeAttrib(l);k={},Object.keys(new za).forEach(function(a){k[a]=b.def(m,".",a)})}g(a.link(d),function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(d.info.type),k)})}function Y(a,c,d,e,f){for(var h,g=a.shared,l=g.gl,k=0;k<e.length;++k){var t,n=(m=e[k]).name,p=m.info.type,r=d.uniforms[n],m=a.link(m)+".location";if(r){if(!f(r))continue;if(wa(r)){if(n=r.value,35678===p||35680===p)c(l,".uniform1i(",m,",",(p=a.link(n._texture||n.color[0]._texture))+".bind());"),c.exit(p,".unbind();");else if(35674===p||35675===p||35676===p)n=a.global.def("new Float32Array(["+Array.prototype.slice.call(n)+"])"),r=2,35675===p?r=3:35676===p&&(r=4),c(l,".uniformMatrix",r,"fv(",m,",false,",n,");");else{switch(p){case 5126:h="1f";break;case 35664:h="2f";break;case 35665:h="3f";break;case 35666:h="4f";break;case 35670:case 5124:h="1i";break;case 35671:case 35667:h="2i";break;case 35672:case 35668:h="3i";break;case 35673:h="4i";break;case 35669:h="4i"}c(l,".uniform",h,"(",m,",",ra(n)?Array.prototype.slice.call(n):n,");")}continue}t=r.append(a,c)}else{if(!f(xb))continue;t=c.def(g.uniforms,"[",b.id(n),"]")}switch(35678===p?c("if(",t,"&&",t,'._reglType==="framebuffer"){',t,"=",t,".color[0];","}"):35680===p&&c("if(",t,"&&",t,'._reglType==="framebufferCube"){',t,"=",t,".color[0];","}"),n=1,p){case 35678:case 35680:c(l,".uniform1i(",m,",",p=c.def(t,"._texture"),".bind());"),c.exit(p,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2i",n=2;break;case 35668:case 35672:h="3i",n=3;break;case 35669:case 35673:h="4i",n=4;break;case 5126:h="1f";break;case 35664:h="2f",n=2;break;case 35665:h="3f",n=3;break;case 35666:h="4f",n=4;break;case 35674:h="Matrix2fv";break;case 35675:h="Matrix3fv";break;case 35676:h="Matrix4fv"}if(c(l,".uniform",h,"(",m,","),"M"===h.charAt(0)){m=Math.pow(p-35674+2,2);var u=a.global.def("new Float32Array(",m,")");c("false,(Array.isArray(",t,")||",t," instanceof Float32Array)?",t,":(",O(m,function(a){return u+"["+a+"]="+t+"["+a+"]"}),",",u,")")}else c(1<n?O(n,function(a){return t+"["+a+"]"}):t);c(");")}}function S(a,b,c,d){function e(f){var g=m[f];return g?g.contextDep&&d.contextDynamic||g.propDep?g.append(a,c):g.append(a,b):b.def(k,".",f)}function f(){function a(){c(ba,".drawElementsInstancedANGLE(",[p,t,C,r+"<<(("+C+"-5121)>>1)",u],");")}function b(){c(ba,".drawArraysInstancedANGLE(",[p,r,t,u],");")}n?B?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(l+".drawElements("+[p,t,C,r+"<<(("+C+"-5121)>>1)"]+");")}function b(){c(l+".drawArrays("+[p,r,t]+");")}n?B?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}var u,ba,h=a.shared,l=h.gl,k=h.draw,m=d.draw,n=function(){var e=m.elements,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f)):e=f.def(k,".","elements"),e&&f("if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);"),e}(),p=e("primitive"),r=e("offset"),t=function(){var e=m.count,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f)):e=f.def(k,".","count"),e}();if("number"==typeof t){if(0===t)return}else c("if(",t,"){"),c.exit("}");ga&&(u=e("instances"),ba=a.instancing);var C=n+".type",B=m.elements&&wa(m.elements);ga&&("number"!=typeof u||0<=u)?"string"==typeof u?(c("if(",u,">0){"),f(),c("}else if(",u,"<0){"),g(),c("}")):f():g()}function ca(a,b,c,d,e){return e=(b=B()).proc("body",e),ga&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays")),a(b,e,c,d),b.compile().body}function W(a,b,c,d){ya(a,b),U(a,b,c,d.attributes,function(){return!0}),Y(a,b,c,d.uniforms,function(){return!0}),S(a,b,b,c)}function oa(a,b,c,d){function e(){return!0}a.batchId="a1",ya(a,b),U(a,b,c,d.attributes,e),Y(a,b,c,d.uniforms,e),S(a,b,b,c)}function Aa(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}ya(a,b);var g=c.contextDep,h=b.def(),l=b.def();a.shared.props=l,a.batchId=h;var k=a.scope(),m=a.scope();b(k.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",l,"=","a0","[",h,"];",m,"}",k.exit),c.needsContext&&A(a,m,c.context),c.needsFramebuffer&&L(a,m,c.framebuffer),R(a,m,c.state,e),c.profile&&e(c.profile)&&F(a,m,c,!1,!0),d?(U(a,k,c,d.attributes,f),U(a,m,c,d.attributes,e),Y(a,k,c,d.uniforms,f),Y(a,m,c,d.uniforms,e),S(a,k,m,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,m),l=m.def(d,".id"),k=m.def(b,"[",l,"]"),m(a.shared.gl,".useProgram(",d,".program);","if(!",k,"){",k,"=",b,"[",l,"]=",a.link(function(b){return ca(oa,a,c,b,2)}),"(",d,");}",k,".call(this,a0[",h,"],",h,");"))}function ka(a,c){function d(b){var g=c.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;A(a,e,c.context),c.framebuffer&&c.framebuffer.append(a,e),vb(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,e);ra(d)?d.forEach(function(c,d){e.set(a.next[b],"["+d+"]",c)}):e.set(f.next,"."+b,d)}),F(a,e,c,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))}),Object.keys(c.uniforms).forEach(function(d){e.set(f.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,e))}),Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new za).forEach(function(a){e.set(f,"."+a,d[a])})}),d("vert"),d("frag"),0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;")),e("a1(",a.shared.context,",a0,",a.batchId,");")}function ma(a,b,c){var e=b.static[c];if(e&&function la(a){if("object"==typeof a&&!ra(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(ja.isDynamic(a[b[c]]))return!0;return!1}}(e)){var f=a.global,g=Object.keys(e),h=!1,l=!1,k=!1,m=a.global.def("{}");g.forEach(function(b){var c=e[b];if(ja.isDynamic(c))"function"==typeof c&&(c=e[b]=ja.unbox(c)),b=K(c,null),h=h||b.thisDep,k=k||b.propDep,l=l||b.contextDep;else{switch(f(m,".",b,"="),typeof c){case"number":f(c);break;case"string":f('"',c,'"');break;case"object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}}),b.dynamic[c]=new ja.DynamicVariable(4,{thisDep:h,contextDep:l,propDep:k,ref:m,append:function d(a,b){g.forEach(function(c){var d=e[c];ja.isDynamic(d)&&(d=a.invoke(b,d),b(m,".",c,"=",d,";"))})}}),delete b.static[c]}}var za=p.Record,Z={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(Z.min=32775,Z.max=32776);var ga=c.angle_instanced_arrays,na=c.webgl_draw_buffers,sa={dirty:!0,profile:g.profile},Fa={},Ka=[],ta={},ua={};v("dither",3024),v("blend.enable",3042),t("blend.color","blendColor",[0,0,0,0]),t("blend.equation","blendEquationSeparate",[32774,32774]),t("blend.func","blendFuncSeparate",[1,0,1,0]),v("depth.enable",2929,!0),t("depth.func","depthFunc",513),t("depth.range","depthRange",[0,1]),t("depth.mask","depthMask",!0),t("colorMask","colorMask",[!0,!0,!0,!0]),v("cull.enable",2884),t("cull.face","cullFace",1029),t("frontFace","frontFace",2305),t("lineWidth","lineWidth",1),v("polygonOffset.enable",32823),t("polygonOffset.offset","polygonOffset",[0,0]),v("sample.alpha",32926),v("sample.enable",32928),t("sample.coverage","sampleCoverage",[1,!1]),v("stencil.enable",2960),t("stencil.mask","stencilMask",-1),t("stencil.func","stencilFunc",[519,0,-1]),t("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),t("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),v("scissor.enable",3089),t("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]),t("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var pa={gl:a,context:C,strings:b,next:Fa,current:sa,draw:m,elements:d,buffer:f,shader:u,attributes:p.state,uniforms:r,framebuffer:k,extensions:c,timer:l,isBufferArgs:Oa},ha={primTypes:Sa,compareFuncs:Xa,blendFuncs:Ga,blendEquations:Z,stencilOps:Pa,glTypes:Ra,orientationType:wb};na&&(ha.backBuffer=[1029],ha.drawBuffer=O(e.maxDrawbuffers,function(a){return 0===a?[0]:O(a,function(a){return 36064+a})}));var va=0;return{next:Fa,current:sa,procs:function(){var a=B(),b=a.proc("poll"),c=a.proc("refresh"),d=a.block();b(d),c(d);var k,f=a.shared,g=f.gl,h=f.next,l=f.current;d(l,".dirty=false;"),L(a,b),L(a,c,null,!0),ga&&(k=a.link(ga));for(var m=0;m<e.maxAttributes;++m){var n=c.def(f.attributes,"[",m,"]"),p=a.cond(n,".buffer");p.then(g,".enableVertexAttribArray(",m,");",g,".bindBuffer(",34962,",",n,".buffer.buffer);",g,".vertexAttribPointer(",m,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(g,".disableVertexAttribArray(",m,");",g,".vertexAttrib4f(",m,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;"),c(p),ga&&c(k,".vertexAttribDivisorANGLE(",m,",",n,".divisor);")}return Object.keys(ta).forEach(function(e){var f=ta[e],k=d.def(h,".",e),m=a.block();m("if(",k,"){",g,".enable(",f,")}else{",g,".disable(",f,")}",l,".",e,"=",k,";"),c(m),b("if(",k,"!==",l,".",e,"){",m,"}")}),Object.keys(ua).forEach(function(e){var m,n,f=ua[e],k=sa[e],p=a.block();p(g,".",f,"("),ra(k)?(f=k.length,m=a.global.def(h,".",e),n=a.global.def(l,".",e),p(O(f,function(a){return m+"["+a+"]"}),");",O(f,function(a){return n+"["+a+"]="+m+"["+a+"];"}).join("")),b("if(",O(f,function(a){return m+"["+a+"]!=="+n+"["+a+"]"}).join("||"),"){",p,"}")):(m=d.def(h,".",e),n=d.def(l,".",e),p(m,");",l,".",e,"=",m,";"),b("if(",m,"!==",n,"){",p,"}")),c(p)}),a.compile()}(),compile:function(a,b,c,d,e){var f=B();return f.stats=f.link(e),Object.keys(b.static).forEach(function(a){ma(f,b,a)}),Ub.forEach(function(b){ma(f,a,b)}),c=w(a,b,c,d),function ba(a,b){var c=a.proc("draw",1);ya(a,c),A(a,c,b.context),L(a,c,b.framebuffer),V(a,c,b),R(a,c,b.state),F(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)W(a,c,b,b.shader.program);else{var e=a.global.def("{}"),f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);").else(g,"=",e,"[",f,"]=",a.link(function(c){return ca(W,a,b,c,1)}),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}(f,c),ka(f,c),function ia(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0",ya(a,d);var e=!1,f=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep}),e||(A(a,d,b.context),f=!1);var h=!1;if((g=b.framebuffer)?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||L(a,d,g)):L(a,d,null),b.state.viewport&&b.state.viewport.propDep&&(e=!0),V(a,d,b),R(a,d,b.state,function(a){return!c(a)}),b.profile&&c(b.profile)||F(a,d,b,!1,"a1"),b.contextDep=e,b.needsContext=f,b.needsFramebuffer=h,(f=b.shader.progVar).contextDep&&e||f.propDep)Aa(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)Aa(a,d,b,b.shader.program);else{var g=a.global.def("{}"),l=(h=d.def(f,".id"),d.def(g,"[",h,"]"));d(a.cond(l).then(l,".call(this,a0,a1);").else(l,"=",g,"[",h,"]=",a.link(function(c){return ca(Aa,a,b,c,2)}),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}(f,c),f.compile()}}}function yb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var D=function(a,b){for(var c=Object.keys(b),e=0;e<c.length;++e)a[c[e]]=b[c[e]];return a},Ab=0,ja={DynamicVariable:pa,define:function(a,b){return new pa(a,Za(b+""))},isDynamic:function(a){return"function"==typeof a&&!a._reglType||a instanceof pa},unbox:function(a,b){return"function"==typeof a?new pa(0,a):a},accessor:Za},Ya={next:"function"==typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"==typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},zb="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},z=cb();z.zero=cb();var Vb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var e=1,f=1;b.webgl_draw_buffers&&(e=a.getParameter(34852),f=a.getParameter(36063));var d=!!b.oes_texture_float;if(d){d=a.createTexture(),a.bindTexture(3553,d),a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var n=a.createFramebuffer();if(a.bindFramebuffer(36160,n),a.framebufferTexture2D(36160,36064,3553,d,0),a.bindTexture(3553,null),36053!==a.checkFramebufferStatus(36160))d=!1;else{a.viewport(0,0,1,1),a.clearColor(1,0,0,1),a.clear(16384);var k=z.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,k),a.getError()?d=!1:(a.deleteFramebuffer(n),a.deleteTexture(d),d=1===k[0]),z.freeType(k)}}return k=!0,k=a.createTexture(),n=z.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,k),a.texImage2D(34069,0,6408,3,3,0,6408,5121,n),z.freeType(n),a.bindTexture(34067,null),a.deleteTexture(k),k=!a.getError(),{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:e,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:d,npotTextureCube:k}},P=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},R=function(a){return Object.keys(a).map(function(b){return a[b]})},Ma={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,e){var f=1;if(b.length)for(var d=0;d<b.length;++d)f*=b[d];else f=0;switch(c=e||z.allocType(c,f),b.length){case 0:break;case 1:for(e=b[0],b=0;b<e;++b)c[b]=a[b];break;case 2:for(e=b[0],b=b[1],d=f=0;d<e;++d)for(var n=a[d],k=0;k<b;++k)c[f++]=n[k];break;case 3:db(a,b[0],b[1],b[2],c,0);break;default:!function eb(a,b,c,e,f){for(var d=1,n=c+1;n<b.length;++n)d*=b[n];var k=b[c];if(4==b.length-c){var r=b[c+1],p=b[c+2];for(b=b[c+3],n=0;n<k;++n)db(a[n],r,p,b,e,f),f+=d}else for(n=0;n<k;++n)eb(a[n],b,c+1,e,f),f+=d}(a,b,0,c,0)}return c}},Ia={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ra={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},jb={dynamic:35048,stream:35040,static:35044},Qa=Ma.flatten,hb=Ma.shape,la=[];la[5120]=1,la[5122]=2,la[5124]=4,la[5121]=1,la[5123]=2,la[5125]=4,la[5126]=4;var Sa={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lb=new Float32Array(1),Ib=new Uint32Array(lb.buffer),Mb=[9984,9986,9985,9987],La=[0,6409,6410,6407,6408],S={};S[6409]=S[6406]=S[6402]=1,S[34041]=S[6410]=2,S[6407]=S[35904]=3,S[6408]=S[35906]=4;var Ua=Ea("HTMLCanvasElement"),pb=Ea("CanvasRenderingContext2D"),qb=Ea("ImageBitmap"),rb=Ea("HTMLImageElement"),sb=Ea("HTMLVideoElement"),Jb=Object.keys(Ia).concat([Ua,pb,qb,rb,sb]),ha=[];ha[5121]=1,ha[5126]=4,ha[36193]=2,ha[5123]=2,ha[5125]=4;var v=[];v[32854]=2,v[32855]=2,v[36194]=2,v[34041]=4,v[33776]=.5,v[33777]=.5,v[33778]=1,v[33779]=1,v[35986]=.5,v[35987]=1,v[34798]=1,v[35840]=.5,v[35841]=.25,v[35842]=.5,v[35843]=.25,v[36196]=.5;var M=[];M[32854]=2,M[32855]=2,M[36194]=2,M[33189]=2,M[36168]=1,M[34041]=4,M[35907]=4,M[34836]=16,M[34842]=8,M[34843]=6;var Wb=function(a,b,c,e,f){function d(a){this.id=p++,this.refCount=1,this.renderbuffer=a,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function n(b){var c=b.renderbuffer;a.bindRenderbuffer(36161,null),a.deleteRenderbuffer(c),b.renderbuffer=null,b.refCount=0,delete u[b.id],e.renderbufferCount--}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(k.srgba=35907),b.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843),b.webgl_color_buffer_float&&(k.rgba32f=34836);var r=[];Object.keys(k).forEach(function(a){r[k[a]]=a});var p=0,u={};return d.prototype.decRef=function(){0>=--this.refCount&&n(this)},f.profile&&(e.getTotalRenderbufferSize=function(){var a=0;return Object.keys(u).forEach(function(b){a+=u[b].stats.size}),a}),{create:function(b,c){function l(b,c){var d=0,e=0,m=32854;if("object"==typeof b&&b?("shape"in b?(d=0|(e=b.shape)[0],e=0|e[1]):("radius"in b&&(d=e=0|b.radius),"width"in b&&(d=0|b.width),"height"in b&&(e=0|b.height)),"format"in b&&(m=k[b.format])):"number"==typeof b?(d=0|b,e="number"==typeof c?0|c:d):b||(d=e=1),d!==g.width||e!==g.height||m!==g.format)return l.width=g.width=d,l.height=g.height=e,g.format=m,a.bindRenderbuffer(36161,g.renderbuffer),a.renderbufferStorage(36161,m,d,e),f.profile&&(g.stats.size=M[g.format]*g.width*g.height),l.format=r[g.format],l}var g=new d(a.createRenderbuffer());return u[g.id]=g,e.renderbufferCount++,l(b,c),l.resize=function(b,c){var d=0|b,e=0|c||d;return d===g.width&&e===g.height?l:(l.width=g.width=d,l.height=g.height=e,a.bindRenderbuffer(36161,g.renderbuffer),a.renderbufferStorage(36161,g.format,d,e),f.profile&&(g.stats.size=M[g.format]*g.width*g.height),l)},l._reglType="renderbuffer",l._renderbuffer=g,f.profile&&(l.stats=g.stats),l.destroy=function(){g.decRef()},l},clear:function(){R(u).forEach(n)},restore:function(){R(u).forEach(function(b){b.renderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,b.renderbuffer),a.renderbufferStorage(36161,b.format,b.width,b.height)}),a.bindRenderbuffer(36161,null)}}},Wa=[];Wa[6408]=4,Wa[6407]=3;var Na=[];Na[5121]=1,Na[5126]=4,Na[36193]=2;var Da=["x","y","z","w"],Ub="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ga={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Pa={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},wb={cw:2304,ccw:2305},xb=new aa(!1,!1,!1,function(){});return function(a){function b(){if(0===F.length)x&&x.update(),ca=null;else{ca=Ya.next(b),u();for(var a=F.length-1;0<=a;--a){var c=F[a];c&&c(N,null,0)}l.flush(),x&&x.update()}}function c(){!ca&&0<F.length&&(ca=Ya.next(b))}function e(){ca&&(Ya.cancel(b),ca=null)}function f(a){a.preventDefault(),e(),U.forEach(function(a){a()})}function d(a){l.getError(),h.restore(),R.restore(),E.restore(),w.restore(),A.restore(),L.restore(),x&&x.restore(),V.procs.refresh(),c(),Y.forEach(function(a){a()})}function n(a){function b(a){var c={},d={};return Object.keys(a).forEach(function(b){var e=a[b];ja.isDynamic(e)?d[b]=ja.unbox(e,b):c[b]=e}),{dynamic:d,static:c}}var d=b(a.context||{}),e=b(a.uniforms||{}),f=b(a.attributes||{}),g=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a],Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=D({},a);return delete c.uniforms,delete c.attributes,delete c.context,"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op),b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),c}(a));a={gpuTime:0,cpuTime:0,count:0};var h=(d=V.compile(g,f,e,d,a)).draw,k=d.batch,l=d.scope,m=[];return D(function(a,b){var d;if("function"==typeof a)return l.call(this,null,a,0);if("function"==typeof b)if("number"==typeof a)for(d=0;d<a;++d)l.call(this,null,b,d);else{if(!Array.isArray(a))return l.call(this,a,b,0);for(d=0;d<a.length;++d)l.call(this,a[d],b,d)}else if("number"==typeof a){if(0<a)return k.call(this,function c(a){for(;m.length<a;)m.push(null);return m}(0|a),0|a)}else{if(!Array.isArray(a))return h.call(this,a);if(a.length)return k.call(this,a,a.length)}},{stats:a})}function k(a,b){var c=0;V.procs.poll();var d=b.color;d&&(l.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384),"depth"in b&&(l.clearDepth(+b.depth),c|=256),"stencil"in b&&(l.clearStencil(0|b.stencil),c|=1024),l.clear(c)}function r(a){return F.push(a),c(),{cancel:function(){var c=yb(F,a);F[c]=function b(){var a=yb(F,b);F[a]=F[F.length-1],--F.length,0>=F.length&&e()}}}}function p(){var a=S.viewport,b=S.scissor_box;a[0]=a[1]=b[0]=b[1]=0,N.viewportWidth=N.framebufferWidth=N.drawingBufferWidth=a[2]=b[2]=l.drawingBufferWidth,N.viewportHeight=N.framebufferHeight=N.drawingBufferHeight=a[3]=b[3]=l.drawingBufferHeight}function u(){N.tick+=1,N.time=v(),p(),V.procs.poll()}function m(){p(),V.procs.refresh(),x&&x.update()}function v(){return(zb()-O)/1e3}if(!(a=Eb(a)))return null;var l=a.gl,g=l.getContextAttributes();l.isContextLost();var h=function Fb(a,b){function c(b){var c;b=b.toLowerCase();try{c=e[b]=a.getExtension(b)}catch(f){}return!!c}for(var e={},f=0;f<b.extensions.length;++f){var d=b.extensions[f];if(!c(d))return b.onDestroy(),b.onDone('"'+d+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return b.optionalExtensions.forEach(c),{extensions:e,restore:function(){Object.keys(e).forEach(function(a){if(!c(a))throw Error("(regl): error restoring extension "+a)})}}}(l,a);if(!h)return null;var z=function Bb(){var a={"":0},b=[""];return{id:function(c){var e=a[c];return e||(e=a[c]=b.length,b.push(c),e)},str:function(a){return b[a]}}}(),t={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},B=h.extensions,x=function(a,b){function e(a,b,d){var e=k.pop()||new function c(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null};e.startQueryIndex=a,e.endQueryIndex=b,e.sum=0,e.stats=d,r.push(e)}var f=b.ext_disjoint_timer_query;if(!f)return null;var d=[],n=[],k=[],r=[],p=[],u=[];return{beginQuery:function(a){var b=d.pop()||f.createQueryEXT();f.beginQueryEXT(35007,b),n.push(b),e(n.length-1,n.length,a)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:e,update:function(){var a,b;if(0!==(a=n.length)){u.length=Math.max(u.length,a+1),p.length=Math.max(p.length,a+1),p[0]=0;var c=u[0]=0;for(b=a=0;b<n.length;++b){var e=n[b];f.getQueryObjectEXT(e,34919)?(c+=f.getQueryObjectEXT(e,34918),d.push(e)):n[a++]=e,p[b+1]=c,u[b+1]=a}for(n.length=a,b=a=0;b<r.length;++b){var h=(c=r[b]).startQueryIndex;e=c.endQueryIndex,c.sum+=p[e]-p[h],h=u[h],(e=u[e])===h?(c.stats.gpuTime+=c.sum/1e6,k.push(c)):(c.startQueryIndex=h,c.endQueryIndex=e,r[a++]=c)}r.length=a}},getNumPendingQueries:function(){return n.length},clear:function(){d.push.apply(d,n);for(var a=0;a<d.length;a++)f.deleteQueryEXT(d[a]);n.length=0,d.length=0},restore:function(){n.length=0,d.length=0}}}(0,B),O=zb(),K=l.drawingBufferWidth,P=l.drawingBufferHeight,N={tick:0,time:0,viewportWidth:K,viewportHeight:P,framebufferWidth:K,framebufferHeight:P,drawingBufferWidth:K,drawingBufferHeight:P,pixelRatio:a.pixelRatio},Q=Vb(l,B),E=(K=function Pb(a,b,c,e){for(a=c.maxAttributes,b=Array(a),c=0;c<a;++c)b[c]=new ub;return{Record:ub,scope:{},state:b}}(l,B,Q),Gb(l,t,a,K)),T=Hb(l,B,E,t),R=Qb(l,z,t,a),w=Kb(l,B,Q,function(){V.procs.poll()},N,t,a),A=Wb(l,B,0,t,a),L=Ob(l,B,Q,w,A,t),V=Tb(l,z,B,Q,E,T,0,L,{},K,R,{elements:null,primitive:4,count:-1,offset:0,instances:-1},N,x,a),S=(z=Rb(l,L,V.procs.poll,N),V.next),M=l.canvas,F=[],U=[],Y=[],W=[a.onDestroy],ca=null;M&&(M.addEventListener("webglcontextlost",f,!1),M.addEventListener("webglcontextrestored",d,!1));var aa=L.setFBO=n({framebuffer:ja.define.call(null,1,"framebuffer")});return m(),g=D(n,{clear:function(a){if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)aa(D({framebuffer:a.framebuffer.faces[b]},a),k);else aa(a,k);else k(0,a)},prop:ja.define.bind(null,1),context:ja.define.bind(null,2),this:ja.define.bind(null,3),draw:n({}),buffer:function(a){return E.create(a,34962,!1,!1)},elements:function(a){return T.create(a,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:A.create,framebuffer:L.create,framebufferCube:L.createCube,attributes:g,frame:r,on:function(a,b){var c;switch(a){case"frame":return r(b);case"lost":c=U;break;case"restore":c=Y;break;case"destroy":c=W}return c.push(b),{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1],c.pop();break}}}},limits:Q,hasExtension:function(a){return 0<=Q.extensions.indexOf(a.toLowerCase())},read:z,destroy:function(){F.length=0,e(),M&&(M.removeEventListener("webglcontextlost",f),M.removeEventListener("webglcontextrestored",d)),R.clear(),L.clear(),A.clear(),w.clear(),T.clear(),E.clear(),x&&x.clear(),W.forEach(function(a){a()})},_gl:l,_refresh:m,poll:function(){u(),x&&x.update()},now:v,stats:t}),a.onDone(null,g),g}},"object"==typeof exports&&void 0!==module?module.exports=W():pa.createREGL=W()},{}],476:[function(_dereq_,module,exports){"use strict";var cache,res="";module.exports=function repeat(str,num){if("string"!=typeof str)throw new TypeError("expected a string");if(1===num)return str;if(2===num)return str+str;var max=str.length*num;if(cache!==str||void 0===cache)cache=str,res="";else if(res.length>=max)return res.substr(0,max);for(;max>res.length&&num>1;)1&num&&(res+=str),num>>=1,str+=str;return res=(res+=str).substr(0,max)}},{}],477:[function(_dereq_,module,exports){(function(global){module.exports=global.performance&&global.performance.now?function now(){return performance.now()}:Date.now||function now(){return+new Date}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],478:[function(_dereq_,module,exports){"use strict";module.exports=function compressExpansion(e){for(var m=e.length,Q=e[e.length-1],bottom=m,i=m-2;i>=0;--i){var a=Q,b=e[i],bv=(Q=a+b)-a,q=b-bv;q&&(e[--bottom]=Q,Q=q)}for(var top=0,i=bottom;i<m;++i){var a=e[i],b=Q,bv=(Q=a+b)-a,q=b-bv;q&&(e[top++]=q)}return e[top++]=Q,e.length=top,e}},{}],479:[function(_dereq_,module,exports){"use strict";var twoProduct=_dereq_("two-product"),robustSum=_dereq_("robust-sum"),robustScale=_dereq_("robust-scale"),compress=_dereq_("robust-compress"),NUM_EXPANDED=6;function cofactor(m,c){for(var result=new Array(m.length-1),i=1;i<m.length;++i)for(var r=result[i-1]=new Array(m.length-1),j=0,k=0;j<m.length;++j)j!==c&&(r[k++]=m[i][j]);return result}function determinant(m){if(2===m.length)return["sum(prod(",m[0][0],",",m[1][1],"),prod(-",m[0][1],",",m[1][0],"))"].join("");for(var expr=[],i=0;i<m.length;++i)expr.push(["scale(",determinant(cofactor(m,i)),",",(n=i,1&n?"-":""),m[0][i],")"].join(""));return function generateSum(expr){if(1===expr.length)return expr[0];if(2===expr.length)return["sum(",expr[0],",",expr[1],")"].join("");var m=expr.length>>1;return["sum(",generateSum(expr.slice(0,m)),",",generateSum(expr.slice(m)),")"].join("")}(expr);var n}function compileDeterminant(n){return new Function("sum","scale","prod","compress",["function robustDeterminant",n,"(m){return compress(",determinant(function matrix(n){for(var result=new Array(n),i=0;i<n;++i){result[i]=new Array(n);for(var j=0;j<n;++j)result[i][j]=["m[",i,"][",j,"]"].join("")}return result}(n)),")};return robustDeterminant",n].join(""))(robustSum,robustScale,twoProduct,compress)}var CACHE=[function robustDeterminant0(){return[0]},function robustDeterminant1(m){return[m[0][0]]}];!function generateDispatch(){for(;CACHE.length<NUM_EXPANDED;)CACHE.push(compileDeterminant(CACHE.length));for(var procArgs=[],code=["function robustDeterminant(m){switch(m.length){"],i=0;i<NUM_EXPANDED;++i)procArgs.push("det"+i),code.push("case ",i,":return det",i,"(m);");code.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),procArgs.push("CACHE","gen",code.join(""));var proc=Function.apply(void 0,procArgs);for(module.exports=proc.apply(void 0,CACHE.concat([CACHE,compileDeterminant])),i=0;i<CACHE.length;++i)module.exports[i]=CACHE[i]}()},{"robust-compress":478,"robust-scale":485,"robust-sum":488,"two-product":517}],480:[function(_dereq_,module,exports){"use strict";var twoProduct=_dereq_("two-product"),robustSum=_dereq_("robust-sum");module.exports=function robustDotProduct(a,b){for(var r=twoProduct(a[0],b[0]),i=1;i<a.length;++i)r=robustSum(r,twoProduct(a[i],b[i]));return r}},{"robust-sum":488,"two-product":517}],481:[function(_dereq_,module,exports){"use strict";var twoProduct=_dereq_("two-product"),robustSum=_dereq_("robust-sum"),robustDiff=_dereq_("robust-subtract"),robustScale=_dereq_("robust-scale"),NUM_EXPAND=6;function cofactor(m,c){for(var result=new Array(m.length-1),i=1;i<m.length;++i)for(var r=result[i-1]=new Array(m.length-1),j=0,k=0;j<m.length;++j)j!==c&&(r[k++]=m[i][j]);return result}function generateSum(expr){if(1===expr.length)return expr[0];if(2===expr.length)return["sum(",expr[0],",",expr[1],")"].join("");var m=expr.length>>1;return["sum(",generateSum(expr.slice(0,m)),",",generateSum(expr.slice(m)),")"].join("")}function makeProduct(a,b){if("m"===a.charAt(0)){if("w"===b.charAt(0)){var toks=a.split("[");return["w",b.substr(1),"m",toks[0].substr(1)].join("")}return["prod(",a,",",b,")"].join("")}return makeProduct(b,a)}function determinant(m){if(2===m.length)return[["diff(",makeProduct(m[0][0],m[1][1]),",",makeProduct(m[1][0],m[0][1]),")"].join("")];for(var expr=[],i=0;i<m.length;++i)expr.push(["scale(",generateSum(determinant(cofactor(m,i))),",",(s=i,!0&s?"-":""),m[0][i],")"].join(""));return expr;var s}function makeSquare(d,n){for(var terms=[],i=0;i<n-2;++i)terms.push(["prod(m",d,"[",i,"],m",d,"[",i,"])"].join(""));return generateSum(terms)}function orientation(n){for(var pos=[],neg=[],m=function matrix(n){for(var result=new Array(n),i=0;i<n;++i){result[i]=new Array(n);for(var j=0;j<n;++j)result[i][j]=["m",j,"[",n-i-2,"]"].join("")}return result}(n),i=0;i<n;++i)m[0][i]="1",m[n-1][i]="w"+i;for(i=0;i<n;++i)0==(1&i)?pos.push.apply(pos,determinant(cofactor(m,i))):neg.push.apply(neg,determinant(cofactor(m,i)));var posExpr=generateSum(pos),negExpr=generateSum(neg),funcName="exactInSphere"+n,funcArgs=[];for(i=0;i<n;++i)funcArgs.push("m"+i);var code=["function ",funcName,"(",funcArgs.join(),"){"];for(i=0;i<n;++i){code.push("var w",i,"=",makeSquare(i,n),";");for(var j=0;j<n;++j)j!==i&&code.push("var w",i,"m",j,"=scale(w",i,",m",j,"[0]);")}return code.push("var p=",posExpr,",n=",negExpr,",d=diff(p,n);return d[d.length-1];}return ",funcName),new Function("sum","diff","prod","scale",code.join(""))(robustSum,robustDiff,twoProduct,robustScale)}var CACHED=[function inSphere0(){return 0},function inSphere1(){return 0},function inSphere2(){return 0}];!function generateInSphereTest(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation(CACHED.length));for(var args=[],procArgs=["slow"],i=0;i<=NUM_EXPAND;++i)args.push("a"+i),procArgs.push("o"+i);var code=["function testInSphere(",args.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(i=2;i<=NUM_EXPAND;++i)code.push("case ",i,":return o",i,"(",args.slice(0,i).join(),");");code.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere"),procArgs.push(code.join(""));var proc=Function.apply(void 0,procArgs);for(module.exports=proc.apply(void 0,[function slowInSphere(args){var proc=CACHED[args.length];return proc||(proc=CACHED[args.length]=orientation(args.length)),proc.apply(void 0,args)}].concat(CACHED)),i=0;i<=NUM_EXPAND;++i)module.exports[i]=CACHED[i]}()},{"robust-scale":485,"robust-subtract":487,"robust-sum":488,"two-product":517}],482:[function(_dereq_,module,exports){"use strict";var determinant=_dereq_("robust-determinant"),NUM_EXPAND=6;function generateSolver(n){for(var funcName="robustLinearSolve"+n+"d",code=["function ",funcName,"(A,b){return ["],i=0;i<n;++i){code.push("det([");for(var j=0;j<n;++j){j>0&&code.push(","),code.push("[");for(var k=0;k<n;++k)k>0&&code.push(","),k===i?code.push("+b[",j,"]"):code.push("+A[",j,"][",k,"]");code.push("]")}code.push("]),")}code.push("det(A)]}return ",funcName);var proc=new Function("det",code.join(""));return proc(n<6?determinant[n]:determinant)}var CACHE=[function robustLinearSolve0d(){return[0]},function robustLinearSolve1d(A,b){return[[b[0]],[A[0][0]]]}];!function generateDispatch(){for(;CACHE.length<NUM_EXPAND;)CACHE.push(generateSolver(CACHE.length));for(var procArgs=[],code=["function dispatchLinearSolve(A,b){switch(A.length){"],i=0;i<NUM_EXPAND;++i)procArgs.push("s"+i),code.push("case ",i,":return s",i,"(A,b);");code.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),procArgs.push("CACHE","g",code.join(""));var proc=Function.apply(void 0,procArgs);for(module.exports=proc.apply(void 0,CACHE.concat([CACHE,generateSolver])),i=0;i<NUM_EXPAND;++i)module.exports[i]=CACHE[i]}()},{"robust-determinant":479}],483:[function(_dereq_,module,exports){"use strict";var twoProduct=_dereq_("two-product"),robustSum=_dereq_("robust-sum"),robustScale=_dereq_("robust-scale"),robustSubtract=_dereq_("robust-subtract"),NUM_EXPAND=5;function cofactor(m,c){for(var result=new Array(m.length-1),i=1;i<m.length;++i)for(var r=result[i-1]=new Array(m.length-1),j=0,k=0;j<m.length;++j)j!==c&&(r[k++]=m[i][j]);return result}function generateSum(expr){if(1===expr.length)return expr[0];if(2===expr.length)return["sum(",expr[0],",",expr[1],")"].join("");var m=expr.length>>1;return["sum(",generateSum(expr.slice(0,m)),",",generateSum(expr.slice(m)),")"].join("")}function determinant(m){if(2===m.length)return[["sum(prod(",m[0][0],",",m[1][1],"),prod(-",m[0][1],",",m[1][0],"))"].join("")];for(var expr=[],i=0;i<m.length;++i)expr.push(["scale(",generateSum(determinant(cofactor(m,i))),",",(n=i,1&n?"-":""),m[0][i],")"].join(""));return expr;var n}function orientation(n){for(var pos=[],neg=[],m=function matrix(n){for(var result=new Array(n),i=0;i<n;++i){result[i]=new Array(n);for(var j=0;j<n;++j)result[i][j]=["m",j,"[",n-i-1,"]"].join("")}return result}(n),args=[],i=0;i<n;++i)0==(1&i)?pos.push.apply(pos,determinant(cofactor(m,i))):neg.push.apply(neg,determinant(cofactor(m,i))),args.push("m"+i);var posExpr=generateSum(pos),negExpr=generateSum(neg),funcName="orientation"+n+"Exact",code=["function ",funcName,"(",args.join(),"){var p=",posExpr,",n=",negExpr,",d=sub(p,n);return d[d.length-1];};return ",funcName].join("");return new Function("sum","prod","scale","sub",code)(robustSum,twoProduct,robustScale,robustSubtract)}var orientation3Exact=orientation(3),orientation4Exact=orientation(4),CACHED=[function orientation0(){return 0},function orientation1(){return 0},function orientation2(a,b){return b[0]-a[0]},function orientation3(a,b,c){var s,l=(a[1]-c[1])*(b[0]-c[0]),r=(a[0]-c[0])*(b[1]-c[1]),det=l-r;if(l>0){if(r<=0)return det;s=l+r}else{if(!(l<0))return det;if(r>=0)return det;s=-(l+r)}var tol=3.3306690738754716e-16*s;return det>=tol||det<=-tol?det:orientation3Exact(a,b,c)},function orientation4(a,b,c,d){var adx=a[0]-d[0],bdx=b[0]-d[0],cdx=c[0]-d[0],ady=a[1]-d[1],bdy=b[1]-d[1],cdy=c[1]-d[1],adz=a[2]-d[2],bdz=b[2]-d[2],cdz=c[2]-d[2],bdxcdy=bdx*cdy,cdxbdy=cdx*bdy,cdxady=cdx*ady,adxcdy=adx*cdy,adxbdy=adx*bdy,bdxady=bdx*ady,det=adz*(bdxcdy-cdxbdy)+bdz*(cdxady-adxcdy)+cdz*(adxbdy-bdxady),tol=7.771561172376103e-16*((Math.abs(bdxcdy)+Math.abs(cdxbdy))*Math.abs(adz)+(Math.abs(cdxady)+Math.abs(adxcdy))*Math.abs(bdz)+(Math.abs(adxbdy)+Math.abs(bdxady))*Math.abs(cdz));return det>tol||-det>tol?det:orientation4Exact(a,b,c,d)}];!function generateOrientationProc(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation(CACHED.length));for(var args=[],procArgs=["slow"],i=0;i<=NUM_EXPAND;++i)args.push("a"+i),procArgs.push("o"+i);var code=["function getOrientation(",args.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(i=2;i<=NUM_EXPAND;++i)code.push("case ",i,":return o",i,"(",args.slice(0,i).join(),");");code.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),procArgs.push(code.join(""));var proc=Function.apply(void 0,procArgs);for(module.exports=proc.apply(void 0,[function slowOrient(args){var proc=CACHED[args.length];return proc||(proc=CACHED[args.length]=orientation(args.length)),proc.apply(void 0,args)}].concat(CACHED)),i=0;i<=NUM_EXPAND;++i)module.exports[i]=CACHED[i]}()},{"robust-scale":485,"robust-subtract":487,"robust-sum":488,"two-product":517}],484:[function(_dereq_,module,exports){"use strict";var robustSum=_dereq_("robust-sum"),robustScale=_dereq_("robust-scale");module.exports=function robustProduct(a,b){if(1===a.length)return robustScale(b,a[0]);if(1===b.length)return robustScale(a,b[0]);if(0===a.length||0===b.length)return[0];var r=[0];if(a.length<b.length)for(var i=0;i<a.length;++i)r=robustSum(r,robustScale(b,a[i]));else for(var i=0;i<b.length;++i)r=robustSum(r,robustScale(a,b[i]));return r}},{"robust-scale":485,"robust-sum":488}],485:[function(_dereq_,module,exports){"use strict";var twoProduct=_dereq_("two-product"),twoSum=_dereq_("two-sum");module.exports=function scaleLinearExpansion(e,scale){var n=e.length;if(1===n){var ts=twoProduct(e[0],scale);return ts[0]?ts:[ts[1]]}var g=new Array(2*n),q=[.1,.1],t=[.1,.1],count=0;twoProduct(e[0],scale,q),q[0]&&(g[count++]=q[0]);for(var i=1;i<n;++i){twoProduct(e[i],scale,t);var pq=q[1];twoSum(pq,t[0],q),q[0]&&(g[count++]=q[0]);var a=t[1],b=q[1],x=a+b,bv=x-a,y=b-bv;q[1]=x,y&&(g[count++]=y)}q[1]&&(g[count++]=q[1]);0===count&&(g[count++]=0);return g.length=count,g}},{"two-product":517,"two-sum":518}],486:[function(_dereq_,module,exports){"use strict";module.exports=function segmentsIntersect(a0,a1,b0,b1){var x0=orient(a0,b0,b1),y0=orient(a1,b0,b1);if(x0>0&&y0>0||x0<0&&y0<0)return!1;var x1=orient(b0,a0,a1),y1=orient(b1,a0,a1);if(x1>0&&y1>0||x1<0&&y1<0)return!1;if(0===x0&&0===y0&&0===x1&&0===y1)return function checkCollinear(a0,a1,b0,b1){for(var d=0;d<2;++d){var x0=a0[d],y0=a1[d],l0=Math.min(x0,y0),h0=Math.max(x0,y0),x1=b0[d],y1=b1[d],l1=Math.min(x1,y1),h1=Math.max(x1,y1);if(h1<l0||h0<l1)return!1}return!0}(a0,a1,b0,b1);return!0};var orient=_dereq_("robust-orientation")[3]},{"robust-orientation":483}],487:[function(_dereq_,module,exports){"use strict";module.exports=function robustSubtract(e,f){var ne=0|e.length,nf=0|f.length;if(1===ne&&1===nf)return function scalarScalar(a,b){var x=a+b,bv=x-a,y=a-(x-bv)+(b-bv);if(y)return[y,x];return[x]}(e[0],-f[0]);var a,b,g=new Array(ne+nf),count=0,eptr=0,fptr=0,abs=Math.abs,ei=e[eptr],ea=abs(ei),fi=-f[fptr],fa=abs(fi);ea<fa?(b=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(b=fi,(fptr+=1)<nf&&(fi=-f[fptr],fa=abs(fi)));eptr<ne&&ea<fa||fptr>=nf?(a=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(a=fi,(fptr+=1)<nf&&(fi=-f[fptr],fa=abs(fi)));var _x,_bv,x=a+b,bv=x-a,y=b-bv,q0=y,q1=x;for(;eptr<ne&&fptr<nf;)ea<fa?(a=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(a=fi,(fptr+=1)<nf&&(fi=-f[fptr],fa=abs(fi))),(y=(b=q0)-(bv=(x=a+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x;for(;eptr<ne;)(y=(b=q0)-(bv=(x=(a=ei)+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x,(eptr+=1)<ne&&(ei=e[eptr]);for(;fptr<nf;)(y=(b=q0)-(bv=(x=(a=fi)+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x,(fptr+=1)<nf&&(fi=-f[fptr]);q0&&(g[count++]=q0);q1&&(g[count++]=q1);count||(g[count++]=0);return g.length=count,g}},{}],488:[function(_dereq_,module,exports){"use strict";module.exports=function linearExpansionSum(e,f){var ne=0|e.length,nf=0|f.length;if(1===ne&&1===nf)return function scalarScalar(a,b){var x=a+b,bv=x-a,y=a-(x-bv)+(b-bv);if(y)return[y,x];return[x]}(e[0],f[0]);var a,b,g=new Array(ne+nf),count=0,eptr=0,fptr=0,abs=Math.abs,ei=e[eptr],ea=abs(ei),fi=f[fptr],fa=abs(fi);ea<fa?(b=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(b=fi,(fptr+=1)<nf&&(fi=f[fptr],fa=abs(fi)));eptr<ne&&ea<fa||fptr>=nf?(a=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(a=fi,(fptr+=1)<nf&&(fi=f[fptr],fa=abs(fi)));var _x,_bv,x=a+b,bv=x-a,y=b-bv,q0=y,q1=x;for(;eptr<ne&&fptr<nf;)ea<fa?(a=ei,(eptr+=1)<ne&&(ei=e[eptr],ea=abs(ei))):(a=fi,(fptr+=1)<nf&&(fi=f[fptr],fa=abs(fi))),(y=(b=q0)-(bv=(x=a+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x;for(;eptr<ne;)(y=(b=q0)-(bv=(x=(a=ei)+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x,(eptr+=1)<ne&&(ei=e[eptr]);for(;fptr<nf;)(y=(b=q0)-(bv=(x=(a=fi)+b)-a))&&(g[count++]=y),q0=q1-((_x=q1+x)-(_bv=_x-q1))+(x-_bv),q1=_x,(fptr+=1)<nf&&(fi=f[fptr]);q0&&(g[count++]=q0);q1&&(g[count++]=q1);count||(g[count++]=0);return g.length=count,g}},{}],489:[function(_dereq_,module,exports){"use strict";module.exports=function signum(x){return x<0?-1:x>0?1:0}},{}],490:[function(_dereq_,module,exports){"use strict";module.exports=function boundary(cells){return reduce(bnd(cells))};var bnd=_dereq_("boundary-cells"),reduce=_dereq_("reduce-simplicial-complex")},{"boundary-cells":82,"reduce-simplicial-complex":469}],491:[function(_dereq_,module,exports){"use strict";module.exports=function extractContour(cells,values,level,d){level=level||0,void 0===d&&(d=function getDimension(cells){for(var numCells=cells.length,d=0,i=0;i<numCells;++i)d=0|Math.max(d,cells[i].length);return d-1}(cells));if(0===cells.length||d<1)return{cells:[],vertexIds:[],vertexWeights:[]};var vertexSigns=function getSigns(values,level){for(var numVerts=values.length,vertexSigns=pool.mallocUint8(numVerts),i=0;i<numVerts;++i)vertexSigns[i]=values[i]<level|0;return vertexSigns}(values,+level),edges=function getEdges(cells,d){for(var numCells=cells.length,maxEdges=d*(d+1)/2*numCells|0,edges=pool.mallocUint32(2*maxEdges),ePtr=0,i=0;i<numCells;++i)for(var c=cells[i],d=c.length,j=0;j<d;++j)for(var k=0;k<j;++k){var a=c[k],b=c[j];edges[ePtr++]=0|Math.min(a,b),edges[ePtr++]=0|Math.max(a,b)}ndsort(ndarray(edges,[ePtr/2|0,2]));for(var ptr=2,i=2;i<ePtr;i+=2)edges[i-2]===edges[i]&&edges[i-1]===edges[i+1]||(edges[ptr++]=edges[i],edges[ptr++]=edges[i+1]);return ndarray(edges,[ptr/2|0,2])}(cells,d),weights=function getCrossingWeights(edges,values,signs,level){for(var edata=edges.data,numEdges=edges.shape[0],weights=pool.mallocDouble(numEdges),ptr=0,i=0;i<numEdges;++i){var a=edata[2*i],b=edata[2*i+1];if(signs[a]!==signs[b]){var va=values[a],vb=values[b];edata[2*ptr]=a,edata[2*ptr+1]=b,weights[ptr++]=(vb-level)/(vb-va)}}return edges.shape[0]=ptr,ndarray(weights,[ptr])}(edges,values,vertexSigns,+level),vcascade=function getCascade(edges,numVerts){var result=pool.mallocInt32(2*numVerts),numEdges=edges.shape[0],edata=edges.data;result[0]=0;for(var lastV=0,i=0;i<numEdges;++i){var a=edata[2*i];if(a!==lastV){for(result[2*lastV+1]=i;++lastV<a;)result[2*lastV]=i,result[2*lastV+1]=i;result[2*lastV]=i}}result[2*lastV+1]=numEdges;for(;++lastV<numVerts;)result[2*lastV]=result[2*lastV+1]=numEdges;return result}(edges,0|values.length),faces=contourAlgorithm(d)(cells,edges.data,vcascade,vertexSigns),uedges=function unpackEdges(edges){for(var ne=0|edges.shape[0],edata=edges.data,result=new Array(ne),i=0;i<ne;++i)result[i]=[edata[2*i],edata[2*i+1]];return result}(edges),uweights=[].slice.call(weights.data,0,weights.shape[0]);return pool.free(vertexSigns),pool.free(edges.data),pool.free(weights.data),pool.free(vcascade),{cells:faces,vertexIds:uedges,vertexWeights:uweights}};var ndarray=_dereq_("ndarray"),pool=_dereq_("typedarray-pool"),ndsort=_dereq_("ndarray-sort"),contourAlgorithm=_dereq_("./lib/codegen")},{"./lib/codegen":492,ndarray:430,"ndarray-sort":428,"typedarray-pool":519}],492:[function(_dereq_,module,exports){"use strict";module.exports=function getPolygonizer(d){var alg=CACHE[d];alg||(alg=CACHE[d]=function createCellPolygonizer(d){var maxCellSize=0,tables=new Array(d+1);tables[0]=[[]];for(var i=1;i<=d;++i)for(var tab=tables[i]=createMSTable(i),j=0;j<tab.length;++j)maxCellSize=Math.max(maxCellSize,tab[i].length);var code=["function B(C,E,i,j){","var a=Math.min(i,j)|0,b=Math.max(i,j)|0,l=C[2*a],h=C[2*a+1];","while(l<h){","var m=(l+h)>>1,v=E[2*m+1];","if(v===b){return m}","if(b<v){h=m}else{l=m+1}","}","return l;","};","function getContour",d,"d(F,E,C,S){","var n=F.length,R=[];","for(var i=0;i<n;++i){var c=F[i],l=c.length;"];function generateCase(facets){if(!(facets.length<=0)){code.push("R.push(");for(var i=0;i<facets.length;++i){var facet=facets[i];i>0&&code.push(","),code.push("[");for(var j=0;j<facet.length;++j){var f=facet[j];j>0&&code.push(","),code.push("B(C,E,c[",f[0],"],c[",f[1],"])")}code.push("]")}code.push(");")}}for(var i=d+1;i>1;--i){i<d+1&&code.push("else "),code.push("if(l===",i,"){");for(var maskStr=[],j=0;j<i;++j)maskStr.push("(S[c["+j+"]]<<"+j+")");code.push("var M=",maskStr.join("+"),";if(M===0||M===",(1<<i)-1,"){continue}switch(M){");for(var tab=tables[i-1],j=0;j<tab.length;++j)code.push("case ",j,":"),generateCase(tab[j]),code.push("break;");code.push("}}")}return code.push("}return R;};return getContour",d,"d"),new Function("pool",code.join(""))(pool)}(d));return alg};var pool=_dereq_("typedarray-pool"),createMSTable=_dereq_("marching-simplex-table"),CACHE={}},{"marching-simplex-table":407,"typedarray-pool":519}],493:[function(_dereq_,module,exports){"use strict";"use restrict";var bits=_dereq_("bit-twiddle"),UnionFind=_dereq_("union-find");function compareCells(a,b){var n=a.length,t=a.length-b.length,min=Math.min;if(t)return t;switch(n){case 0:return 0;case 1:return a[0]-b[0];case 2:return(d=a[0]+a[1]-b[0]-b[1])||min(a[0],a[1])-min(b[0],b[1]);case 3:var l1=a[0]+a[1],m1=b[0]+b[1];if(d=l1+a[2]-(m1+b[2]))return d;var d,l0=min(a[0],a[1]),m0=min(b[0],b[1]);return(d=min(l0,a[2])-min(m0,b[2]))||min(l0+a[2],l1)-min(m0+b[2],m1);default:var as=a.slice(0);as.sort();var bs=b.slice(0);bs.sort();for(var i=0;i<n;++i)if(t=as[i]-bs[i])return t;return 0}}function compareZipped(a,b){return compareCells(a[0],b[0])}function normalize(cells,attr){if(attr){for(var len=cells.length,zipped=new Array(len),i=0;i<len;++i)zipped[i]=[cells[i],attr[i]];zipped.sort(compareZipped);for(i=0;i<len;++i)cells[i]=zipped[i][0],attr[i]=zipped[i][1];return cells}return cells.sort(compareCells),cells}function unique(cells){if(0===cells.length)return[];for(var ptr=1,len=cells.length,i=1;i<len;++i){var a=cells[i];if(compareCells(a,cells[i-1])){if(i===ptr){ptr++;continue}cells[ptr++]=a}}return cells.length=ptr,cells}function findCell(cells,c){for(var lo=0,hi=cells.length-1,r=-1;lo<=hi;){var mid=lo+hi>>1,s=compareCells(cells[mid],c);s<=0?(0===s&&(r=mid),lo=mid+1):s>0&&(hi=mid-1)}return r}function incidence(from_cells,to_cells){for(var index=new Array(from_cells.length),i=0,il=index.length;i<il;++i)index[i]=[];for(var b=[],n=(i=0,to_cells.length);i<n;++i)for(var c=to_cells[i],cl=c.length,k=1,kn=1<<cl;k<kn;++k){b.length=bits.popCount(k);for(var l=0,j=0;j<cl;++j)k&1<<j&&(b[l++]=c[j]);var idx=findCell(from_cells,b);if(!(idx<0))for(;index[idx++].push(i),!(idx>=from_cells.length||0!==compareCells(from_cells[idx],b)););}return index}function skeleton(cells,n){if(n<0)return[];for(var result=[],k0=(1<<n+1)-1,i=0;i<cells.length;++i)for(var c=cells[i],k=k0;k<1<<c.length;k=bits.nextCombination(k)){for(var b=new Array(n+1),l=0,j=0;j<c.length;++j)k&1<<j&&(b[l++]=c[j]);result.push(b)}return normalize(result)}exports.dimension=function dimension(cells){for(var d=0,max=Math.max,i=0,il=cells.length;i<il;++i)d=max(d,cells[i].length);return d-1},exports.countVertices=function countVertices(cells){for(var vc=-1,max=Math.max,i=0,il=cells.length;i<il;++i)for(var c=cells[i],j=0,jl=c.length;j<jl;++j)vc=max(vc,c[j]);return vc+1},exports.cloneCells=function cloneCells(cells){for(var ncells=new Array(cells.length),i=0,il=cells.length;i<il;++i)ncells[i]=cells[i].slice(0);return ncells},exports.compareCells=compareCells,exports.normalize=normalize,exports.unique=unique,exports.findCell=findCell,exports.incidence=incidence,exports.dual=function dual(cells,vertex_count){if(!vertex_count)return incidence(unique(skeleton(cells,0)),cells);for(var res=new Array(vertex_count),i=0;i<vertex_count;++i)res[i]=[];i=0;for(var len=cells.length;i<len;++i)for(var c=cells[i],j=0,cl=c.length;j<cl;++j)res[c[j]].push(i);return res},exports.explode=function explode(cells){for(var result=[],i=0,il=cells.length;i<il;++i)for(var c=cells[i],cl=0|c.length,j=1,jl=1<<cl;j<jl;++j){for(var b=[],k=0;k<cl;++k)j>>>k&1&&b.push(c[k]);result.push(b)}return normalize(result)},exports.skeleton=skeleton,exports.boundary=function boundary(cells){for(var res=[],i=0,il=cells.length;i<il;++i)for(var c=cells[i],j=0,cl=c.length;j<cl;++j){for(var b=new Array(c.length-1),k=0,l=0;k<cl;++k)k!==j&&(b[l++]=c[k]);res.push(b)}return normalize(res)},exports.connectedComponents=function connectedComponents(cells,vertex_count){return vertex_count?function connectedComponents_dense(cells,vertex_count){for(var labels=new UnionFind(vertex_count),i=0;i<cells.length;++i)for(var c=cells[i],j=0;j<c.length;++j)for(var k=j+1;k<c.length;++k)labels.link(c[j],c[k]);var components=[],component_labels=labels.ranks;for(i=0;i<component_labels.length;++i)component_labels[i]=-1;for(i=0;i<cells.length;++i){var l=labels.find(cells[i][0]);component_labels[l]<0?(component_labels[l]=components.length,components.push([cells[i].slice(0)])):components[component_labels[l]].push(cells[i].slice(0))}return components}(cells,vertex_count):function connectedComponents_sparse(cells){for(var vertices=unique(normalize(skeleton(cells,0))),labels=new UnionFind(vertices.length),i=0;i<cells.length;++i)for(var c=cells[i],j=0;j<c.length;++j)for(var vj=findCell(vertices,[c[j]]),k=j+1;k<c.length;++k)labels.link(vj,findCell(vertices,[c[k]]));var components=[],component_labels=labels.ranks;for(i=0;i<component_labels.length;++i)component_labels[i]=-1;for(i=0;i<cells.length;++i){var l=labels.find(findCell(vertices,[cells[i][0]]));component_labels[l]<0?(component_labels[l]=components.length,components.push([cells[i].slice(0)])):components[component_labels[l]].push(cells[i].slice(0))}return components}(cells)}},{"bit-twiddle":79,"union-find":520}],494:[function(_dereq_,module,exports){arguments[4][79][0].apply(exports,arguments)},{dup:79}],495:[function(_dereq_,module,exports){arguments[4][493][0].apply(exports,arguments)},{"bit-twiddle":494,dup:493,"union-find":496}],496:[function(_dereq_,module,exports){"use strict";"use restrict";function UnionFind(count){this.roots=new Array(count),this.ranks=new Array(count);for(var i=0;i<count;++i)this.roots[i]=i,this.ranks[i]=0}module.exports=UnionFind,UnionFind.prototype.length=function(){return this.roots.length},UnionFind.prototype.makeSet=function(){var n=this.roots.length;return this.roots.push(n),this.ranks.push(0),n},UnionFind.prototype.find=function(x){for(var roots=this.roots;roots[x]!==x;){var y=roots[x];roots[x]=roots[y],x=y}return x},UnionFind.prototype.link=function(x,y){var xr=this.find(x),yr=this.find(y);if(xr!==yr){var ranks=this.ranks,roots=this.roots,xd=ranks[xr],yd=ranks[yr];xd<yd?roots[xr]=yr:yd<xd?roots[yr]=xr:(roots[yr]=xr,++ranks[xr])}}},{}],497:[function(_dereq_,module,exports){"use strict";module.exports=function simplifyPolygon(cells,positions,minArea){for(var n=positions.length,nc=cells.length,inv=new Array(n),outv=new Array(n),weights=new Array(n),dead=new Array(n),i=0;i<n;++i)inv[i]=outv[i]=-1,weights[i]=1/0,dead[i]=!1;for(var i=0;i<nc;++i){var c=cells[i];if(2!==c.length)throw new Error("Input must be a graph");var s=c[1],t=c[0];-1!==outv[t]?outv[t]=-2:outv[t]=s,-1!==inv[s]?inv[s]=-2:inv[s]=t}function computeWeight(i){if(dead[i])return 1/0;var s=inv[i],t=outv[i];return s<0||t<0?1/0:function errorWeight(base,a,b){var area=Math.abs(orient(base,a,b)),perim=Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2));return area/perim}(positions[i],positions[s],positions[t])}function heapSwap(i,j){var a=heap[i],b=heap[j];heap[i]=b,heap[j]=a,index[a]=j,index[b]=i}function heapWeight(i){return weights[heap[i]]}function heapParent(i){return 1&i?i-1>>1:(i>>1)-1}function heapDown(i){for(var w=heapWeight(i);;){var tw=w,left=2*i+1,right=2*(i+1),next=i;if(left<heapCount){var lw=heapWeight(left);lw<tw&&(next=left,tw=lw)}if(right<heapCount){var rw=heapWeight(right);rw<tw&&(next=right)}if(next===i)return i;heapSwap(i,next),i=next}}function heapUp(i){for(var w=heapWeight(i);i>0;){var parent=heapParent(i);if(parent>=0){var pw=heapWeight(parent);if(w<pw){heapSwap(i,parent),i=parent;continue}}return i}}function heapPop(){if(heapCount>0){var head=heap[0];return heapSwap(0,heapCount-1),heapCount-=1,heapDown(0),head}return-1}function heapUpdate(i,w){var a=heap[i];return weights[a]===w?i:(weights[a]=-1/0,heapUp(i),heapPop(),weights[a]=w,heapUp((heapCount+=1)-1))}function kill(i){if(!dead[i]){dead[i]=!0;var s=inv[i],t=outv[i];inv[t]>=0&&(inv[t]=s),outv[s]>=0&&(outv[s]=t),index[s]>=0&&heapUpdate(index[s],computeWeight(s)),index[t]>=0&&heapUpdate(index[t],computeWeight(t))}}for(var heap=[],index=new Array(n),i=0;i<n;++i){var w=weights[i]=computeWeight(i);w<1/0?(index[i]=heap.length,heap.push(i)):index[i]=-1}for(var heapCount=heap.length,i=heapCount>>1;i>=0;--i)heapDown(i);for(;;){var hmin=heapPop();if(hmin<0||weights[hmin]>minArea)break;kill(hmin)}for(var npositions=[],i=0;i<n;++i)dead[i]||(index[i]=npositions.length,npositions.push(positions[i].slice()));npositions.length;function tortoiseHare(seq,start){if(seq[start]<0)return start;var t=start,h=start;do{var nh=seq[h];if(!dead[h]||nh<0||nh===h)break;if(nh=seq[h=nh],!dead[h]||nh<0||nh===h)break;h=nh,t=seq[t]}while(t!==h);for(var v=start;v!==h;v=seq[v])seq[v]=h;return h}var ncells=[];return cells.forEach(function(c){var tin=tortoiseHare(inv,c[0]),tout=tortoiseHare(outv,c[1]);if(tin>=0&&tout>=0&&tin!==tout){var cin=index[tin],cout=index[tout];cin!==cout&&ncells.push([cin,cout])}}),sc.unique(sc.normalize(ncells)),{positions:npositions,edges:ncells}};var orient=_dereq_("robust-orientation"),sc=_dereq_("simplicial-complex")},{"robust-orientation":483,"simplicial-complex":495}],498:[function(_dereq_,module,exports){"use strict";module.exports=function orderSegments(b,a){var al,ar,bl,br;if(a[0][0]<a[1][0])al=a[0],ar=a[1];else{if(!(a[0][0]>a[1][0]))return horizontalOrder(a,b);al=a[1],ar=a[0]}if(b[0][0]<b[1][0])bl=b[0],br=b[1];else{if(!(b[0][0]>b[1][0]))return-horizontalOrder(b,a);bl=b[1],br=b[0]}var d1=orient(al,ar,br),d2=orient(al,ar,bl);if(d1<0){if(d2<=0)return d1}else if(d1>0){if(d2>=0)return d1}else if(d2)return d2;if(d1=orient(br,bl,ar),d2=orient(br,bl,al),d1<0){if(d2<=0)return d1}else if(d1>0){if(d2>=0)return d1}else if(d2)return d2;return ar[0]-br[0]};var orient=_dereq_("robust-orientation");function horizontalOrder(a,b){var bl,br,al,ar;if(b[0][0]<b[1][0])bl=b[0],br=b[1];else{if(!(b[0][0]>b[1][0])){var alo=Math.min(a[0][1],a[1][1]),ahi=Math.max(a[0][1],a[1][1]),blo=Math.min(b[0][1],b[1][1]),bhi=Math.max(b[0][1],b[1][1]);return ahi<blo?ahi-blo:alo>bhi?alo-bhi:ahi-bhi}bl=b[1],br=b[0]}a[0][1]<a[1][1]?(al=a[0],ar=a[1]):(al=a[1],ar=a[0]);var d=orient(br,bl,al);return d||((d=orient(br,bl,ar))||ar-br)}},{"robust-orientation":483}],499:[function(_dereq_,module,exports){"use strict";module.exports=function createSlabDecomposition(segments){for(var numSegments=segments.length,numEvents=2*numSegments,events=new Array(numEvents),i=0;i<numSegments;++i){var s=segments[i],f=s[0][0]<s[1][0];events[2*i]=new Event(s[0][0],s,f,i),events[2*i+1]=new Event(s[1][0],s,!f,i)}events.sort(function(a,b){var d=a.x-b.x;return d||((d=a.create-b.create)||Math.min(a.segment[0][1],a.segment[1][1])-Math.min(b.segment[0][1],b.segment[1][1]))});for(var tree=createRBTree(orderSegments),slabs=[],lines=[],horizontal=[],i=0;i<numEvents;){for(var x=events[i].x,horiz=[];i<numEvents;){var e=events[i];if(e.x!==x)break;i+=1,e.segment[0][0]===e.x&&e.segment[1][0]===e.x?e.create&&(e.segment[0][1]<e.segment[1][1]?(horiz.push(new IntervalSegment(e.segment[0][1],e.index,!0,!0)),horiz.push(new IntervalSegment(e.segment[1][1],e.index,!1,!1))):(horiz.push(new IntervalSegment(e.segment[1][1],e.index,!0,!1)),horiz.push(new IntervalSegment(e.segment[0][1],e.index,!1,!0)))):tree=e.create?tree.insert(e.segment,e.index):tree.remove(e.segment)}slabs.push(tree.root),lines.push(x),horizontal.push(horiz)}return new SlabDecomposition(slabs,lines,horizontal)};var bounds=_dereq_("binary-search-bounds"),createRBTree=_dereq_("functional-red-black-tree"),orient=_dereq_("robust-orientation"),orderSegments=_dereq_("./lib/order-segments");function SlabDecomposition(slabs,coordinates,horizontal){this.slabs=slabs,this.coordinates=coordinates,this.horizontal=horizontal}function compareHorizontal(e,y){return e.y-y}function searchBucket(root,p){for(var lastNode=null;root;){var l,r,seg=root.key;seg[0][0]<seg[1][0]?(l=seg[0],r=seg[1]):(l=seg[1],r=seg[0]);var o=orient(l,r,p);if(o<0)root=root.left;else if(o>0)if(p[0]!==seg[1][0])lastNode=root,root=root.right;else{if(val=searchBucket(root.right,p))return val;root=root.left}else{if(p[0]!==seg[1][0])return root;var val;if(val=searchBucket(root.right,p))return val;root=root.left}}return lastNode}function IntervalSegment(y,index,start,closed){this.y=y,this.index=index,this.start=start,this.closed=closed}function Event(x,segment,create,index){this.x=x,this.segment=segment,this.create=create,this.index=index}SlabDecomposition.prototype.castUp=function(p){var bucket=bounds.le(this.coordinates,p[0]);if(bucket<0)return-1;this.slabs[bucket];var hitNode=searchBucket(this.slabs[bucket],p),lastHit=-1;if(hitNode&&(lastHit=hitNode.value),this.coordinates[bucket]===p[0]){var lastSegment=null;if(hitNode&&(lastSegment=hitNode.key),bucket>0){var otherHitNode=searchBucket(this.slabs[bucket-1],p);otherHitNode&&(lastSegment?orderSegments(otherHitNode.key,lastSegment)>0&&(lastSegment=otherHitNode.key,lastHit=otherHitNode.value):(lastHit=otherHitNode.value,lastSegment=otherHitNode.key))}var horiz=this.horizontal[bucket];if(horiz.length>0){var hbucket=bounds.ge(horiz,p[1],compareHorizontal);if(hbucket<horiz.length){var e=horiz[hbucket];if(p[1]===e.y){if(e.closed)return e.index;for(;hbucket<horiz.length-1&&horiz[hbucket+1].y===p[1];)if((e=horiz[hbucket+=1]).closed)return e.index;if(e.y===p[1]&&!e.start){if((hbucket+=1)>=horiz.length)return lastHit;e=horiz[hbucket]}}if(e.start)if(lastSegment){var o=orient(lastSegment[0],lastSegment[1],[p[0],e.y]);lastSegment[0][0]>lastSegment[1][0]&&(o=-o),o>0&&(lastHit=e.index)}else lastHit=e.index;else e.y!==p[1]&&(lastHit=e.index)}}}return lastHit}},{"./lib/order-segments":498,"binary-search-bounds":78,"functional-red-black-tree":218,"robust-orientation":483}],500:[function(_dereq_,module,exports){"use strict";var robustDot=_dereq_("robust-dot-product"),robustSum=_dereq_("robust-sum");function planeT(p,plane){var r=robustSum(robustDot(p,plane),[plane[plane.length-1]]);return r[r.length-1]}function lerpW(a,wa,b,wb){var t=-wa/(wb-wa);t<0?t=0:t>1&&(t=1);for(var ti=1-t,n=a.length,r=new Array(n),i=0;i<n;++i)r[i]=t*a[i]+ti*b[i];return r}module.exports=function splitPolygon(points,plane){for(var pos=[],neg=[],a=planeT(points[points.length-1],plane),s=points[points.length-1],t=points[0],i=0;i<points.length;++i,s=t){var b=planeT(t=points[i],plane);if(a<0&&b>0||a>0&&b<0){var p=lerpW(s,b,t,a);pos.push(p),neg.push(p.slice())}b<0?neg.push(t.slice()):b>0?pos.push(t.slice()):(pos.push(t.slice()),neg.push(t.slice())),a=b}return{positive:pos,negative:neg}},module.exports.positive=function positive(points,plane){for(var pos=[],a=planeT(points[points.length-1],plane),s=points[points.length-1],t=points[0],i=0;i<points.length;++i,s=t){var b=planeT(t=points[i],plane);(a<0&&b>0||a>0&&b<0)&&pos.push(lerpW(s,b,t,a)),b>=0&&pos.push(t.slice()),a=b}return pos},module.exports.negative=function negative(points,plane){for(var neg=[],a=planeT(points[points.length-1],plane),s=points[points.length-1],t=points[0],i=0;i<points.length;++i,s=t){var b=planeT(t=points[i],plane);(a<0&&b>0||a>0&&b<0)&&neg.push(lerpW(s,b,t,a)),b<=0&&neg.push(t.slice()),a=b}return neg}},{"robust-dot-product":480,"robust-sum":488}],501:[function(_dereq_,module,exports){!function(){"use strict";var re={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};function sprintf(key){return function sprintf_format(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,is_positive,sign,cursor=1,tree_length=parse_tree.length,output="";for(i=0;i<tree_length;i++)if("string"==typeof parse_tree[i])output+=parse_tree[i];else if(Array.isArray(parse_tree[i])){if((match=parse_tree[i])[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw new Error(sprintf('[sprintf] property "%s" does not exist',match[2][k]));arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if(re.not_type.test(match[8])&&re.not_primitive.test(match[8])&&arg instanceof Function&&(arg=arg()),re.numeric_arg.test(match[8])&&"number"!=typeof arg&&isNaN(arg))throw new TypeError(sprintf("[sprintf] expecting number but found %T",arg));switch(re.number.test(match[8])&&(is_positive=arg>=0),match[8]){case"b":arg=parseInt(arg,10).toString(2);break;case"c":arg=String.fromCharCode(parseInt(arg,10));break;case"d":case"i":arg=parseInt(arg,10);break;case"j":arg=JSON.stringify(arg,null,match[6]?parseInt(match[6]):0);break;case"e":arg=match[7]?parseFloat(arg).toExponential(match[7]):parseFloat(arg).toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"g":arg=match[7]?String(Number(arg.toPrecision(match[7]))):parseFloat(arg);break;case"o":arg=(parseInt(arg,10)>>>0).toString(8);break;case"s":arg=String(arg),arg=match[7]?arg.substring(0,match[7]):arg;break;case"t":arg=String(!!arg),arg=match[7]?arg.substring(0,match[7]):arg;break;case"T":arg=Object.prototype.toString.call(arg).slice(8,-1).toLowerCase(),arg=match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=parseInt(arg,10)>>>0;break;case"v":arg=arg.valueOf(),arg=match[7]?arg.substring(0,match[7]):arg;break;case"x":arg=(parseInt(arg,10)>>>0).toString(16);break;case"X":arg=(parseInt(arg,10)>>>0).toString(16).toUpperCase()}re.json.test(match[8])?output+=arg:(!re.number.test(match[8])||is_positive&&!match[3]?sign="":(sign=is_positive?"+":"-",arg=arg.toString().replace(re.sign,"")),pad_character=match[4]?"0"===match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-(sign+arg).length,pad=match[6]&&pad_length>0?pad_character.repeat(pad_length):"",output+=match[5]?sign+arg+pad:"0"===pad_character?sign+pad+arg:pad+sign+arg)}return output}(function sprintf_parse(fmt){if(sprintf_cache[fmt])return sprintf_cache[fmt];var match,_fmt=fmt,parse_tree=[],arg_names=0;for(;_fmt;){if(null!==(match=re.text.exec(_fmt)))parse_tree.push(match[0]);else if(null!==(match=re.modulo.exec(_fmt)))parse_tree.push("%");else{if(null===(match=re.placeholder.exec(_fmt)))throw new SyntaxError("[sprintf] unexpected placeholder");if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=re.key.exec(replacement_field)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(field_list.push(field_match[1]);""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=re.key_access.exec(replacement_field)))field_list.push(field_match[1]);else{if(null===(field_match=re.index_access.exec(replacement_field)))throw new SyntaxError("[sprintf] failed to parse named argument key");field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return sprintf_cache[fmt]=parse_tree}(key),arguments)}function vsprintf(fmt,argv){return sprintf.apply(null,[fmt].concat(argv||[]))}var sprintf_cache=Object.create(null);void 0!==exports&&(exports.sprintf=sprintf,exports.vsprintf=vsprintf),"undefined"!=typeof window&&(window.sprintf=sprintf,window.vsprintf=vsprintf)}()},{}],502:[function(_dereq_,module,exports){"use strict";var paren=_dereq_("parenthesis");module.exports=function splitBy(string,separator,o){if(null==string)throw Error("First argument should be a string");if(null==separator)throw Error("Separator should be a string or a RegExp");o?("string"==typeof o||Array.isArray(o))&&(o={ignore:o}):o={},null==o.escape&&(o.escape=!0),null==o.ignore?o.ignore=["[]","()","{}","<>",'""',"''","``","",""]:("string"==typeof o.ignore&&(o.ignore=[o.ignore]),o.ignore=o.ignore.map(function(pair){return 1===pair.length&&(pair+=pair),pair}));var tokens=paren.parse(string,{flat:!0,brackets:o.ignore}),parts=tokens[0].split(separator);if(o.escape){for(var cleanParts=[],i=0;i<parts.length;i++){var prev=parts[i],part=parts[i+1];"\\"===prev[prev.length-1]&&"\\"!==prev[prev.length-2]?(cleanParts.push(prev+separator+part),i++):cleanParts.push(prev)}parts=cleanParts}for(i=0;i<parts.length;i++)tokens[0]=parts[i],parts[i]=paren.stringify(tokens,{flat:!0});return parts}},{parenthesis:438}],503:[function(_dereq_,module,exports){"use strict";module.exports=function stronglyConnectedComponents(adjList){for(var numVertices=adjList.length,index=new Array(numVertices),lowValue=new Array(numVertices),active=new Array(numVertices),child=new Array(numVertices),scc=new Array(numVertices),sccLinks=new Array(numVertices),i=0;i<numVertices;++i)index[i]=-1,lowValue[i]=0,active[i]=!1,child[i]=0,scc[i]=-1,sccLinks[i]=[];var newE,count=0,components=[],sccAdjList=[];function strongConnect(v){var S=[v],T=[v];for(index[v]=lowValue[v]=count,active[v]=!0,count+=1;T.length>0;){v=T[T.length-1];var e=adjList[v];if(child[v]<e.length){for(var i=child[v];i<e.length;++i){var u=e[i];if(index[u]<0){index[u]=lowValue[u]=count,active[u]=!0,count+=1,S.push(u),T.push(u);break}active[u]&&(lowValue[v]=0|Math.min(lowValue[v],lowValue[u])),scc[u]>=0&&sccLinks[v].push(scc[u])}child[v]=i}else{if(lowValue[v]===index[v]){for(var component=[],links=[],linkCount=0,i=S.length-1;i>=0;--i){var w=S[i];if(active[w]=!1,component.push(w),links.push(sccLinks[w]),linkCount+=sccLinks[w].length,scc[w]=components.length,w===v){S.length=i;break}}components.push(component);for(var allLinks=new Array(linkCount),i=0;i<links.length;i++)for(var j=0;j<links[i].length;j++)allLinks[--linkCount]=links[i][j];sccAdjList.push(allLinks)}T.pop()}}}for(var i=0;i<numVertices;++i)index[i]<0&&strongConnect(i);for(var i=0;i<sccAdjList.length;i++){var e=sccAdjList[i];if(0!==e.length){e.sort(function(a,b){return a-b}),newE=[e[0]];for(var j=1;j<e.length;j++)e[j]!==e[j-1]&&newE.push(e[j]);sccAdjList[i]=newE}}return{components:components,adjacencyList:sccAdjList}}},{}],504:[function(_dereq_,module,exports){"use strict";module.exports=function toSuperScript(x){return x.split("").map(function(c){return c in SUPERSCRIPTS?SUPERSCRIPTS[c]:""}).join("")};var SUPERSCRIPTS={" ":" ",0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"","+":"","-":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""}},{}],505:[function(_dereq_,module,exports){"use strict";module.exports=function surfaceNets(array,level){if(array.dimension<=0)return{positions:[],cells:[]};if(1===array.dimension)return function mesh1D(array,level){for(var zc=zeroCrossings(array,level),n=zc.length,npos=new Array(n),ncel=new Array(n),i=0;i<n;++i)npos[i]=[zc[i]],ncel[i]=[i];return{positions:npos,cells:ncel}}(array,level);var typesig=array.order.join()+"-"+array.dtype,proc=CACHE[typesig],level=+level||0;proc||(proc=CACHE[typesig]=function buildSurfaceNets(order,dtype){var dimension=order.length,code=["'use strict';"],funcName="surfaceNets"+order.join("_")+"d"+dtype;code.push("var contour=genContour({","order:[",order.join(),"],","scalarArguments: 3,","phase:function phaseFunc(p,a,b,c) { return (p > c)|0 },"),"generic"===dtype&&code.push("getters:[0],");for(var cubeArgs=[],extraArgs=[],i=0;i<dimension;++i)cubeArgs.push("d"+i),extraArgs.push("d"+i);for(var i=0;i<1<<dimension;++i)cubeArgs.push("v"+i),extraArgs.push("v"+i);for(var i=0;i<1<<dimension;++i)cubeArgs.push("p"+i),extraArgs.push("p"+i);cubeArgs.push("a","b","c"),extraArgs.push("a","c"),code.push("vertex:function vertexFunc(",cubeArgs.join(),"){");for(var maskStr=[],i=0;i<1<<dimension;++i)maskStr.push("(p"+i+"<<"+i+")");code.push("var m=(",maskStr.join("+"),")|0;if(m===0||m===",(1<<(1<<dimension))-1,"){return}");var extraFuncs=[],currentFunc=[];1<<(1<<dimension)<=128?(code.push("switch(m){"),currentFunc=code):code.push("switch(m>>>7){");for(var i=0;i<1<<(1<<dimension);++i){if(1<<(1<<dimension)>128&&i%128==0){extraFuncs.length>0&&currentFunc.push("}}");var efName="vExtra"+extraFuncs.length;code.push("case ",i>>>7,":",efName,"(m&0x7f,",extraArgs.join(),");break;"),currentFunc=["function ",efName,"(m,",extraArgs.join(),"){switch(m){"],extraFuncs.push(currentFunc)}currentFunc.push("case ",127&i,":");for(var crossings=new Array(dimension),denoms=new Array(dimension),crossingCount=new Array(dimension),bias=new Array(dimension),totalCrossings=0,j=0;j<dimension;++j)crossings[j]=[],denoms[j]=[],crossingCount[j]=0,bias[j]=0;for(var j=0;j<1<<dimension;++j)for(var k=0;k<dimension;++k){var u=j^1<<k;if(!(u>j)&&!(i&1<<u)!=!(i&1<<j)){var sign=1;i&1<<u?denoms[k].push("v"+u+"-v"+j):(denoms[k].push("v"+j+"-v"+u),sign=-sign),sign<0?(crossings[k].push("-v"+j+"-v"+u),crossingCount[k]+=2):(crossings[k].push("v"+j+"+v"+u),crossingCount[k]-=2),totalCrossings+=1;for(var l=0;l<dimension;++l)l!==k&&(u&1<<l?bias[l]+=1:bias[l]-=1)}}for(var vertexStr=[],k=0;k<dimension;++k)if(0===crossings[k].length)vertexStr.push("d"+k+"-0.5");else{var cStr="";crossingCount[k]<0?cStr=crossingCount[k]+"*c":crossingCount[k]>0&&(cStr="+"+crossingCount[k]+"*c");var weight=crossings[k].length/totalCrossings*.5,shift=.5+bias[k]/totalCrossings*.5;vertexStr.push("d"+k+"-"+shift+"-"+weight+"*("+crossings[k].join("+")+cStr+")/("+denoms[k].join("+")+")")}currentFunc.push("a.push([",vertexStr.join(),"]);","break;")}code.push("}},"),extraFuncs.length>0&&currentFunc.push("}}");for(var faceArgs=[],i=0;i<1<<dimension-1;++i)faceArgs.push("v"+i);faceArgs.push("c0","c1","p0","p1","a","b","c"),code.push("cell:function cellFunc(",faceArgs.join(),"){");var facets=triangulateCube(dimension-1);code.push("if(p0){b.push(",facets.map(function(f){return"["+f.map(function(v){return"v"+v})+"]"}).join(),")}else{b.push(",facets.map(function(f){var e=f.slice();return e.reverse(),"["+e.map(function(v){return"v"+v})+"]"}).join(),")}}});function ",funcName,"(array,level){var verts=[],cells=[];contour(array,verts,cells,level);return {positions:verts,cells:cells};} return ",funcName,";");for(var i=0;i<extraFuncs.length;++i)code.push(extraFuncs[i].join(""));return new Function("genContour",code.join(""))(generateContourExtractor)}(array.order,array.dtype));return proc(array,level)};var generateContourExtractor=_dereq_("ndarray-extract-contour"),triangulateCube=_dereq_("triangulate-hypercube"),zeroCrossings=_dereq_("zero-crossings");var CACHE={}},{"ndarray-extract-contour":419,"triangulate-hypercube":515,"zero-crossings":548}],506:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),TAU=2*Math.PI,mapToEllipse=function mapToEllipse(_ref,rx,ry,cosphi,sinphi,centerx,centery){var x=_ref.x,y=_ref.y;return{x:cosphi*(x*=rx)-sinphi*(y*=ry)+centerx,y:sinphi*x+cosphi*y+centery}},approxUnitArc=function approxUnitArc(ang1,ang2){var c=.551915024494,x1=Math.cos(ang1),y1=Math.sin(ang1),x2=Math.cos(ang1+ang2),y2=Math.sin(ang1+ang2);return[{x:x1-y1*c,y:y1+x1*c},{x:x2+y2*c,y:y2-x2*c},{x:x2,y:y2}]},vectorAngle=function vectorAngle(ux,uy,vx,vy){var sign=ux*vy-uy*vx<0?-1:1,div=(ux*vx+uy*vy)/(Math.sqrt(ux*ux+uy*uy)*Math.sqrt(ux*ux+uy*uy));return div>1&&(div=1),div<-1&&(div=-1),sign*Math.acos(div)};exports.default=function arcToBezier(_ref2){var px=_ref2.px,py=_ref2.py,cx=_ref2.cx,cy=_ref2.cy,rx=_ref2.rx,ry=_ref2.ry,_ref2$xAxisRotation=_ref2.xAxisRotation,xAxisRotation=void 0===_ref2$xAxisRotation?0:_ref2$xAxisRotation,_ref2$largeArcFlag=_ref2.largeArcFlag,largeArcFlag=void 0===_ref2$largeArcFlag?0:_ref2$largeArcFlag,_ref2$sweepFlag=_ref2.sweepFlag,sweepFlag=void 0===_ref2$sweepFlag?0:_ref2$sweepFlag,curves=[];if(0===rx||0===ry)return[];var sinphi=Math.sin(xAxisRotation*TAU/360),cosphi=Math.cos(xAxisRotation*TAU/360),pxp=cosphi*(px-cx)/2+sinphi*(py-cy)/2,pyp=-sinphi*(px-cx)/2+cosphi*(py-cy)/2;if(0===pxp&&0===pyp)return[];rx=Math.abs(rx),ry=Math.abs(ry);var lambda=Math.pow(pxp,2)/Math.pow(rx,2)+Math.pow(pyp,2)/Math.pow(ry,2);lambda>1&&(rx*=Math.sqrt(lambda),ry*=Math.sqrt(lambda));var _getArcCenter=function getArcCenter(px,py,cx,cy,rx,ry,largeArcFlag,sweepFlag,sinphi,cosphi,pxp,pyp){var rxsq=Math.pow(rx,2),rysq=Math.pow(ry,2),pxpsq=Math.pow(pxp,2),pypsq=Math.pow(pyp,2),radicant=rxsq*rysq-rxsq*pypsq-rysq*pxpsq;radicant<0&&(radicant=0),radicant/=rxsq*pypsq+rysq*pxpsq;var centerxp=(radicant=Math.sqrt(radicant)*(largeArcFlag===sweepFlag?-1:1))*rx/ry*pyp,centeryp=radicant*-ry/rx*pxp,centerx=cosphi*centerxp-sinphi*centeryp+(px+cx)/2,centery=sinphi*centerxp+cosphi*centeryp+(py+cy)/2,vx1=(pxp-centerxp)/rx,vy1=(pyp-centeryp)/ry,vx2=(-pxp-centerxp)/rx,vy2=(-pyp-centeryp)/ry,ang1=vectorAngle(1,0,vx1,vy1),ang2=vectorAngle(vx1,vy1,vx2,vy2);return 0===sweepFlag&&ang2>0&&(ang2-=TAU),1===sweepFlag&&ang2<0&&(ang2+=TAU),[centerx,centery,ang1,ang2]}(px,py,cx,cy,rx,ry,largeArcFlag,sweepFlag,sinphi,cosphi,pxp,pyp),_getArcCenter2=_slicedToArray(_getArcCenter,4),centerx=_getArcCenter2[0],centery=_getArcCenter2[1],ang1=_getArcCenter2[2],ang2=_getArcCenter2[3],segments=Math.max(Math.ceil(Math.abs(ang2)/(TAU/4)),1);ang2/=segments;for(var i=0;i<segments;i++)curves.push(approxUnitArc(ang1,ang2)),ang1+=ang2;return curves.map(function(curve){var _mapToEllipse=mapToEllipse(curve[0],rx,ry,cosphi,sinphi,centerx,centery),x1=_mapToEllipse.x,y1=_mapToEllipse.y,_mapToEllipse2=mapToEllipse(curve[1],rx,ry,cosphi,sinphi,centerx,centery),x2=_mapToEllipse2.x,y2=_mapToEllipse2.y,_mapToEllipse3=mapToEllipse(curve[2],rx,ry,cosphi,sinphi,centerx,centery);return{x1:x1,y1:y1,x2:x2,y2:y2,x:_mapToEllipse3.x,y:_mapToEllipse3.y}})},module.exports=exports.default},{}],507:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("parse-svg-path"),abs=_dereq_("abs-svg-path"),normalize=_dereq_("normalize-svg-path"),isSvgPath=_dereq_("is-svg-path"),assert=_dereq_("assert");module.exports=function pathBounds(path){Array.isArray(path)&&1===path.length&&"string"==typeof path[0]&&(path=path[0]);"string"==typeof path&&(assert(isSvgPath(path),"String is not an SVG path."),path=parse(path));if(assert(Array.isArray(path),"Argument should be a string or an array of path segments."),path=abs(path),!(path=normalize(path)).length)return[0,0,0,0];for(var bounds=[1/0,1/0,-1/0,-1/0],i=0,l=path.length;i<l;i++)for(var points=path[i].slice(1),j=0;j<points.length;j+=2)points[j+0]<bounds[0]&&(bounds[0]=points[j+0]),points[j+1]<bounds[1]&&(bounds[1]=points[j+1]),points[j+0]>bounds[2]&&(bounds[2]=points[j+0]),points[j+1]>bounds[3]&&(bounds[3]=points[j+1]);return bounds}},{"abs-svg-path":47,assert:55,"is-svg-path":404,"normalize-svg-path":508,"parse-svg-path":440}],508:[function(_dereq_,module,exports){"use strict";module.exports=function normalize(path){for(var prev,result=[],bezierX=0,bezierY=0,startX=0,startY=0,quadX=null,quadY=null,x=0,y=0,i=0,len=path.length;i<len;i++){var seg=path[i],command=seg[0];switch(command){case"M":startX=seg[1],startY=seg[2];break;case"A":var curves=arcToCurve({px:x,py:y,cx:seg[6],cy:seg[7],rx:seg[1],ry:seg[2],xAxisRotation:seg[3],largeArcFlag:seg[4],sweepFlag:seg[5]});if(!curves.length)continue;for(var c,j=0;j<curves.length;j++)c=curves[j],seg=["C",c.x1,c.y1,c.x2,c.y2,c.x,c.y],j<curves.length-1&&result.push(seg);break;case"S":var cx=x,cy=y;"C"!=prev&&"S"!=prev||(cx+=cx-bezierX,cy+=cy-bezierY),seg=["C",cx,cy,seg[1],seg[2],seg[3],seg[4]];break;case"T":"Q"==prev||"T"==prev?(quadX=2*x-quadX,quadY=2*y-quadY):(quadX=x,quadY=y),seg=quadratic(x,y,quadX,quadY,seg[1],seg[2]);break;case"Q":quadX=seg[1],quadY=seg[2],seg=quadratic(x,y,seg[1],seg[2],seg[3],seg[4]);break;case"L":seg=line(x,y,seg[1],seg[2]);break;case"H":seg=line(x,y,seg[1],y);break;case"V":seg=line(x,y,x,seg[1]);break;case"Z":seg=line(x,y,startX,startY)}prev=command,x=seg[seg.length-2],y=seg[seg.length-1],seg.length>4?(bezierX=seg[seg.length-4],bezierY=seg[seg.length-3]):(bezierX=x,bezierY=y),result.push(seg)}return result};var arcToCurve=_dereq_("svg-arc-to-cubic-bezier");function line(x1,y1,x2,y2){return["C",x1,y1,x2,y2,x2,y2]}function quadratic(x1,y1,cx,cy,x2,y2){return["C",x1/3+2/3*cx,y1/3+2/3*cy,x2/3+2/3*cx,y2/3+2/3*cy,x2,y2]}},{"svg-arc-to-cubic-bezier":506}],509:[function(_dereq_,module,exports){(function(global){"use strict";var pathBounds=_dereq_("svg-path-bounds"),parsePath=_dereq_("parse-svg-path"),drawPath=_dereq_("draw-svg-path"),isSvgPath=_dereq_("is-svg-path"),bitmapSdf=_dereq_("bitmap-sdf"),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");module.exports=function pathSdf(path,options){if(!isSvgPath(path))throw Error("Argument should be valid svg path string");options||(options={});var w,h;options.shape?(w=options.shape[0],h=options.shape[1]):(w=canvas.width=options.w||options.width||200,h=canvas.height=options.h||options.height||200);var size=Math.min(w,h),stroke=options.stroke||0,viewbox=options.viewbox||options.viewBox||pathBounds(path),scale=[w/(viewbox[2]-viewbox[0]),h/(viewbox[3]-viewbox[1])],maxScale=Math.min(scale[0]||0,scale[1]||0)/2;ctx.fillStyle="black",ctx.fillRect(0,0,w,h),ctx.fillStyle="white",stroke&&("number"!=typeof stroke&&(stroke=1),ctx.strokeStyle=stroke>0?"white":"black",ctx.lineWidth=Math.abs(stroke));if(ctx.translate(.5*w,.5*h),ctx.scale(maxScale,maxScale),global.Path2D){var path2d=new Path2D(path);ctx.fill(path2d),stroke&&ctx.stroke(path2d)}else{var segments=parsePath(path);drawPath(ctx,segments),ctx.fill(),stroke&&ctx.stroke()}return ctx.setTransform(1,0,0,1,0,0),bitmapSdf(ctx,{cutoff:null!=options.cutoff?options.cutoff:.5,radius:null!=options.radius?options.radius:.5*size})}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"bitmap-sdf":80,"draw-svg-path":152,"is-svg-path":404,"parse-svg-path":440,"svg-path-bounds":507}],510:[function(_dereq_,module,exports){(function(process){"use strict";module.exports=function textGet(font,text,opts){var opts=opts||{};var fontcache=__TEXT_CACHE[font];fontcache||(fontcache=__TEXT_CACHE[font]={" ":{data:new Float32Array(0),shape:.2}});var mesh=fontcache[text];if(!mesh)if(text.length<=1||!/\d/.test(text))mesh=fontcache[text]=function unwrap(mesh){for(var cells=mesh.cells,positions=mesh.positions,data=new Float32Array(6*cells.length),ptr=0,shapeX=0,i=0;i<cells.length;++i)for(var tri=cells[i],j=0;j<3;++j){var point=positions[tri[j]];data[ptr++]=point[0],data[ptr++]=point[1]+1.4,shapeX=Math.max(point[0],shapeX)}return{data:data,shape:shapeX}}(vectorizeText(text,{triangles:!0,font:font,textAlign:opts.textAlign||"left",textBaseline:"alphabetic"}));else{for(var parts=text.split(/(\d|\s)/),buffer=new Array(parts.length),bufferSize=0,shapeX=0,i=0;i<parts.length;++i)buffer[i]=textGet(font,parts[i]),bufferSize+=buffer[i].data.length,shapeX+=buffer[i].shape,i>0&&(shapeX+=.02);for(var data=new Float32Array(bufferSize),ptr=0,xOffset=-.5*shapeX,i=0;i<buffer.length;++i){for(var bdata=buffer[i].data,j=0;j<bdata.length;j+=2)data[ptr++]=bdata[j]+xOffset,data[ptr++]=bdata[j+1];xOffset+=buffer[i].shape+.02}mesh=fontcache[text]={data:data,shape:shapeX}}return mesh};var vectorizeText=_dereq_("vectorize-text"),globals=window||process.global||{},__TEXT_CACHE=globals.__TEXT_CACHE||{};globals.__TEXT_CACHE={}}).call(this,_dereq_("_process"))},{_process:462,"vectorize-text":524}],511:[function(_dereq_,module,exports){!function(Math){var trimLeft=/^\s+/,trimRight=/\s+$/,tinyCounter=0,mathRound=Math.round,mathMin=Math.min,mathMax=Math.max,mathRandom=Math.random;function tinycolor(color,opts){if(color=color||"",opts=opts||{},color instanceof tinycolor)return color;if(!(this instanceof tinycolor))return new tinycolor(color,opts);var rgb=function inputToRGB(color){var rgb={r:0,g:0,b:0},a=1,s=null,v=null,l=null,ok=!1,format=!1;"string"==typeof color&&(color=function stringInputToObject(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var match,named=!1;if(names[color])color=names[color],named=!0;else if("transparent"==color)return{r:0,g:0,b:0,a:0,format:"name"};if(match=matchers.rgb.exec(color))return{r:match[1],g:match[2],b:match[3]};if(match=matchers.rgba.exec(color))return{r:match[1],g:match[2],b:match[3],a:match[4]};if(match=matchers.hsl.exec(color))return{h:match[1],s:match[2],l:match[3]};if(match=matchers.hsla.exec(color))return{h:match[1],s:match[2],l:match[3],a:match[4]};if(match=matchers.hsv.exec(color))return{h:match[1],s:match[2],v:match[3]};if(match=matchers.hsva.exec(color))return{h:match[1],s:match[2],v:match[3],a:match[4]};if(match=matchers.hex8.exec(color))return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),a:convertHexToDecimal(match[4]),format:named?"name":"hex8"};if(match=matchers.hex6.exec(color))return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"};if(match=matchers.hex4.exec(color))return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),a:convertHexToDecimal(match[4]+""+match[4]),format:named?"name":"hex8"};if(match=matchers.hex3.exec(color))return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"};return!1}(color));"object"==typeof color&&(isValidCSSUnit(color.r)&&isValidCSSUnit(color.g)&&isValidCSSUnit(color.b)?(rgb=function rgbToRgb(r,g,b){return{r:255*bound01(r,255),g:255*bound01(g,255),b:255*bound01(b,255)}}(color.r,color.g,color.b),ok=!0,format="%"===String(color.r).substr(-1)?"prgb":"rgb"):isValidCSSUnit(color.h)&&isValidCSSUnit(color.s)&&isValidCSSUnit(color.v)?(s=convertToPercentage(color.s),v=convertToPercentage(color.v),rgb=function hsvToRgb(h,s,v){h=6*bound01(h,360),s=bound01(s,100),v=bound01(v,100);var i=Math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6;return{r:255*[v,q,p,p,t,v][mod],g:255*[t,v,v,q,p,p][mod],b:255*[p,p,t,v,v,q][mod]}}(color.h,s,v),ok=!0,format="hsv"):isValidCSSUnit(color.h)&&isValidCSSUnit(color.s)&&isValidCSSUnit(color.l)&&(s=convertToPercentage(color.s),l=convertToPercentage(color.l),rgb=function hslToRgb(h,s,l){var r,g,b;function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}if(h=bound01(h,360),s=bound01(s,100),l=bound01(l,100),0===s)r=g=b=l;else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return{r:255*r,g:255*g,b:255*b}}(color.h,s,l),ok=!0,format="hsl"),color.hasOwnProperty("a")&&(a=color.a));return a=boundAlpha(a),{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(100*this._a)/100,this._format=opts.format||rgb.format,this._gradientType=opts.gradientType,this._r<1&&(this._r=mathRound(this._r)),this._g<1&&(this._g=mathRound(this._g)),this._b<1&&(this._b=mathRound(this._b)),this._ok=rgb.ok,this._tc_id=tinyCounter++}function rgbToHsl(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),l=(max+min)/2;if(max==min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}}function rgbToHsv(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),v=max,d=max-min;if(s=0===max?0:d/max,max==min)h=0;else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,v:v}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)?hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0):hex.join("")}function rgbaToArgbHex(r,g,b,a){return[pad2(convertDecimalToHex(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))].join("")}function desaturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s-=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function saturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s+=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l+=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function brighten(color,amount){amount=0===amount?0:amount||10;var rgb=tinycolor(color).toRgb();return rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(-amount/100*255))),rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(-amount/100*255))),rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(-amount/100*255))),tinycolor(rgb)}function darken(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l-=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function spin(color,amount){var hsl=tinycolor(color).toHsl(),hue=(hsl.h+amount)%360;return hsl.h=hue<0?360+hue:hue,tinycolor(hsl)}function complement(color){var hsl=tinycolor(color).toHsl();return hsl.h=(hsl.h+180)%360,tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6,slices=slices||30;var hsl=tinycolor(color).toHsl(),part=360/slices,ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;)hsl.h=(hsl.h+part)%360,ret.push(tinycolor(hsl));return ret}function monochromatic(color,results){results=results||6;for(var hsv=tinycolor(color).toHsv(),h=hsv.h,s=hsv.s,v=hsv.v,ret=[],modification=1/results;results--;)ret.push(tinycolor({h:h,s:s,v:v})),v=(v+modification)%1;return ret}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(299*rgb.r+587*rgb.g+114*rgb.b)/1e3},getLuminance:function(){var RsRGB,GsRGB,BsRGB,rgb=this.toRgb();return RsRGB=rgb.r/255,GsRGB=rgb.g/255,BsRGB=rgb.b/255,.2126*(RsRGB<=.03928?RsRGB/12.92:Math.pow((RsRGB+.055)/1.055,2.4))+.7152*(GsRGB<=.03928?GsRGB/12.92:Math.pow((GsRGB+.055)/1.055,2.4))+.0722*(BsRGB<=.03928?BsRGB/12.92:Math.pow((BsRGB+.055)/1.055,2.4))},setAlpha:function(value){return this._a=boundAlpha(value),this._roundA=mathRound(100*this._a)/100,this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:360*hsv.h,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var hsv=rgbToHsv(this._r,this._g,this._b),h=mathRound(360*hsv.h),s=mathRound(100*hsv.s),v=mathRound(100*hsv.v);return 1==this._a?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:360*hsl.h,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var hsl=rgbToHsl(this._r,this._g,this._b),h=mathRound(360*hsl.h),s=mathRound(100*hsl.s),l=mathRound(100*hsl.l);return 1==this._a?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(allow4Char){return function rgbaToHex(r,g,b,a,allow4Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16)),pad2(convertDecimalToHex(a))];if(allow4Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)&&hex[3].charAt(0)==hex[3].charAt(1))return hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0)+hex[3].charAt(0);return hex.join("")}(this._r,this._g,this._b,this._a,allow4Char)},toHex8String:function(allow4Char){return"#"+this.toHex8(allow4Char)},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(100*bound01(this._r,255))+"%",g:mathRound(100*bound01(this._g,255))+"%",b:mathRound(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%)":"rgba("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(secondColor){var hex8String="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),secondHex8String=hex8String,gradientType=this._gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);secondHex8String="#"+rgbaToArgbHex(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=!1,hasAlpha=this._a<1&&this._a>=0;return formatSet||!hasAlpha||"hex"!==format&&"hex6"!==format&&"hex3"!==format&&"hex4"!==format&&"hex8"!==format&&"name"!==format?("rgb"===format&&(formattedString=this.toRgbString()),"prgb"===format&&(formattedString=this.toPercentageRgbString()),"hex"!==format&&"hex6"!==format||(formattedString=this.toHexString()),"hex3"===format&&(formattedString=this.toHexString(!0)),"hex4"===format&&(formattedString=this.toHex8String(!0)),"hex8"===format&&(formattedString=this.toHex8String()),"name"===format&&(formattedString=this.toName()),"hsl"===format&&(formattedString=this.toHslString()),"hsv"===format&&(formattedString=this.toHsvString()),formattedString||this.toHexString()):"name"===format&&0===this._a?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(fn,args){var color=fn.apply(null,[this].concat([].slice.call(args)));return this._r=color._r,this._g=color._g,this._b=color._b,this.setAlpha(color._a),this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}},tinycolor.fromRatio=function(color,opts){if("object"==typeof color){var newColor={};for(var i in color)color.hasOwnProperty(i)&&(newColor[i]="a"===i?color[i]:convertToPercentage(color[i]));color=newColor}return tinycolor(color,opts)},tinycolor.equals=function(color1,color2){return!(!color1||!color2)&&tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})},tinycolor.mix=function(color1,color2,amount){amount=0===amount?0:amount||50;var rgb1=tinycolor(color1).toRgb(),rgb2=tinycolor(color2).toRgb(),p=amount/100;return tinycolor({r:(rgb2.r-rgb1.r)*p+rgb1.r,g:(rgb2.g-rgb1.g)*p+rgb1.g,b:(rgb2.b-rgb1.b)*p+rgb1.b,a:(rgb2.a-rgb1.a)*p+rgb1.a})},tinycolor.readability=function(color1,color2){var c1=tinycolor(color1),c2=tinycolor(color2);return(Math.max(c1.getLuminance(),c2.getLuminance())+.05)/(Math.min(c1.getLuminance(),c2.getLuminance())+.05)},tinycolor.isReadable=function(color1,color2,wcag2){var wcag2Parms,out,readability=tinycolor.readability(color1,color2);switch(out=!1,(wcag2Parms=function validateWCAG2Parms(parms){var level,size;level=((parms=parms||{level:"AA",size:"small"}).level||"AA").toUpperCase(),size=(parms.size||"small").toLowerCase(),"AA"!==level&&"AAA"!==level&&(level="AA");"small"!==size&&"large"!==size&&(size="small");return{level:level,size:size}}(wcag2)).level+wcag2Parms.size){case"AAsmall":case"AAAlarge":out=readability>=4.5;break;case"AAlarge":out=readability>=3;break;case"AAAsmall":out=readability>=7}return out},tinycolor.mostReadable=function(baseColor,colorList,args){var readability,includeFallbackColors,level,size,bestColor=null,bestScore=0;includeFallbackColors=(args=args||{}).includeFallbackColors,level=args.level,size=args.size;for(var i=0;i<colorList.length;i++)(readability=tinycolor.readability(baseColor,colorList[i]))>bestScore&&(bestScore=readability,bestColor=tinycolor(colorList[i]));return tinycolor.isReadable(baseColor,bestColor,{level:level,size:size})||!includeFallbackColors?bestColor:(args.includeFallbackColors=!1,tinycolor.mostReadable(baseColor,["#fff","#000"],args))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=function flip(o){var flipped={};for(var i in o)o.hasOwnProperty(i)&&(flipped[o[i]]=i);return flipped}(names);function boundAlpha(a){return a=parseFloat(a),(isNaN(a)||a<0||a>1)&&(a=1),a}function bound01(n,max){(function isOnePointZero(n){return"string"==typeof n&&-1!=n.indexOf(".")&&1===parseFloat(n)})(n)&&(n="100%");var processPercent=function isPercentage(n){return"string"==typeof n&&-1!=n.indexOf("%")}(n);return n=mathMin(max,mathMax(0,parseFloat(n))),processPercent&&(n=parseInt(n*max,10)/100),Math.abs(n-max)<1e-6?1:n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function pad2(c){return 1==c.length?"0"+c:""+c}function convertToPercentage(n){return n<=1&&(n=100*n+"%"),n}function convertDecimalToHex(d){return Math.round(255*parseFloat(d)).toString(16)}function convertHexToDecimal(h){return parseIntFromHex(h)/255}var CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4,matchers=(PERMISSIVE_MATCH3="[\\s|\\(]+("+(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function isValidCSSUnit(color){return!!matchers.CSS_UNIT.exec(color)}void 0!==module&&module.exports?module.exports=tinycolor:window.tinycolor=tinycolor}(Math)},{}],512:[function(_dereq_,module,exports){"use strict";function float32(arr){if(arr instanceof Float32Array)return arr;if("number"==typeof arr)return new Float32Array([arr])[0];var float=new Float32Array(arr);return float.set(arr),float}module.exports=float32,module.exports.float32=module.exports.float=float32,module.exports.fract32=module.exports.fract=function fract32(arr){if("number"==typeof arr)return float32(arr-float32(arr));for(var fract=float32(arr),i=0,l=fract.length;i<l;i++)fract[i]=arr[i]-fract[i];return fract}},{}],513:[function(_dereq_,module,exports){"use strict";var parseUnit=_dereq_("parse-unit");module.exports=toPX;var PIXELS_PER_INCH=96;function getPropertyInPX(element,prop){var parts=parseUnit(getComputedStyle(element).getPropertyValue(prop));return parts[0]*toPX(parts[1],element)}function toPX(str,element){switch(element=element||document.body,str=(str||"px").trim().toLowerCase(),element!==window&&element!==document||(element=document.body),str){case"%":return element.clientHeight/100;case"ch":case"ex":return function getSizeBrutal(unit,element){var testDIV=document.createElement("div");testDIV.style["font-size"]="128"+unit,element.appendChild(testDIV);var size=getPropertyInPX(testDIV,"font-size")/128;return element.removeChild(testDIV),size}(str,element);case"em":return getPropertyInPX(element,"font-size");case"rem":return getPropertyInPX(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return PIXELS_PER_INCH;case"cm":return PIXELS_PER_INCH/2.54;case"mm":return PIXELS_PER_INCH/25.4;case"pt":return PIXELS_PER_INCH/72;case"pc":return PIXELS_PER_INCH/6}return 1}},{"parse-unit":441}],514:[function(_dereq_,module,exports){var global;global=this,function(exports){"use strict";var identity=function(x){return x},transform=function(topology){if(null==(transform=topology.transform))return identity;var transform,x0,y0,kx=transform.scale[0],ky=transform.scale[1],dx=transform.translate[0],dy=transform.translate[1];return function(point,i){return i||(x0=y0=0),point[0]=(x0+=point[0])*kx+dx,point[1]=(y0+=point[1])*ky+dy,point}},bbox=function(topology){var bbox=topology.bbox;function bboxPoint(p0){p1[0]=p0[0],p1[1]=p0[1],t(p1),p1[0]<x0&&(x0=p1[0]),p1[0]>x1&&(x1=p1[0]),p1[1]<y0&&(y0=p1[1]),p1[1]>y1&&(y1=p1[1])}function bboxGeometry(o){switch(o.type){case"GeometryCollection":o.geometries.forEach(bboxGeometry);break;case"Point":bboxPoint(o.coordinates);break;case"MultiPoint":o.coordinates.forEach(bboxPoint)}}if(!bbox){var p0,name,t=transform(topology),p1=new Array(2),x0=1/0,y0=x0,x1=-x0,y1=-x0;for(name in topology.arcs.forEach(function(arc){for(var i=-1,n=arc.length;++i<n;)p0=arc[i],p1[0]=p0[0],p1[1]=p0[1],t(p1,i),p1[0]<x0&&(x0=p1[0]),p1[0]>x1&&(x1=p1[0]),p1[1]<y0&&(y0=p1[1]),p1[1]>y1&&(y1=p1[1])}),topology.objects)bboxGeometry(topology.objects[name]);bbox=topology.bbox=[x0,y0,x1,y1]}return bbox},reverse=function(array,n){for(var t,j=array.length,i=j-n;i<--j;)t=array[i],array[i++]=array[j],array[j]=t};function feature$1(topology,o){var id=o.id,bbox=o.bbox,properties=null==o.properties?{}:o.properties,geometry=object(topology,o);return null==id&&null==bbox?{type:"Feature",properties:properties,geometry:geometry}:null==bbox?{type:"Feature",id:id,properties:properties,geometry:geometry}:{type:"Feature",id:id,bbox:bbox,properties:properties,geometry:geometry}}function object(topology,o){var transformPoint=transform(topology),arcs=topology.arcs;function arc(i,points){points.length&&points.pop();for(var a=arcs[i<0?~i:i],k=0,n=a.length;k<n;++k)points.push(transformPoint(a[k].slice(),k));i<0&&reverse(points,n)}function point(p){return transformPoint(p.slice())}function line(arcs){for(var points=[],i=0,n=arcs.length;i<n;++i)arc(arcs[i],points);return points.length<2&&points.push(points[0].slice()),points}function ring(arcs){for(var points=line(arcs);points.length<4;)points.push(points[0].slice());return points}function polygon(arcs){return arcs.map(ring)}return function geometry(o){var coordinates,type=o.type;switch(type){case"GeometryCollection":return{type:type,geometries:o.geometries.map(geometry)};case"Point":coordinates=point(o.coordinates);break;case"MultiPoint":coordinates=o.coordinates.map(point);break;case"LineString":coordinates=line(o.arcs);break;case"MultiLineString":coordinates=o.arcs.map(line);break;case"Polygon":coordinates=polygon(o.arcs);break;case"MultiPolygon":coordinates=o.arcs.map(polygon);break;default:return null}return{type:type,coordinates:coordinates}}(o)}var stitch=function(topology,arcs){var stitchedArcs={},fragmentByStart={},fragmentByEnd={},fragments=[],emptyIndex=-1;function flush(fragmentByEnd,fragmentByStart){for(var k in fragmentByEnd){var f=fragmentByEnd[k];delete fragmentByStart[f.start],delete f.start,delete f.end,f.forEach(function(i){stitchedArcs[i<0?~i:i]=1}),fragments.push(f)}}return arcs.forEach(function(i,j){var t,arc=topology.arcs[i<0?~i:i];arc.length<3&&!arc[1][0]&&!arc[1][1]&&(t=arcs[++emptyIndex],arcs[emptyIndex]=i,arcs[j]=t)}),arcs.forEach(function(i){var f,g,e=function ends(i){var p1,arc=topology.arcs[i<0?~i:i],p0=arc[0];topology.transform?(p1=[0,0],arc.forEach(function(dp){p1[0]+=dp[0],p1[1]+=dp[1]})):p1=arc[arc.length-1];return i<0?[p1,p0]:[p0,p1]}(i),start=e[0],end=e[1];if(f=fragmentByEnd[start])if(delete fragmentByEnd[f.end],f.push(i),f.end=end,g=fragmentByStart[end]){delete fragmentByStart[g.start];var fg=g===f?f:f.concat(g);fragmentByStart[fg.start=f.start]=fragmentByEnd[fg.end=g.end]=fg}else fragmentByStart[f.start]=fragmentByEnd[f.end]=f;else if(f=fragmentByStart[end])if(delete fragmentByStart[f.start],f.unshift(i),f.start=start,g=fragmentByEnd[start]){delete fragmentByEnd[g.end];var gf=g===f?f:g.concat(f);fragmentByStart[gf.start=g.start]=fragmentByEnd[gf.end=f.end]=gf}else fragmentByStart[f.start]=fragmentByEnd[f.end]=f;else fragmentByStart[(f=[i]).start=start]=fragmentByEnd[f.end=end]=f}),flush(fragmentByEnd,fragmentByStart),flush(fragmentByStart,fragmentByEnd),arcs.forEach(function(i){stitchedArcs[i<0?~i:i]||fragments.push([i])}),fragments};function meshArcs(topology,object$$1,filter){var arcs,i,n;if(arguments.length>1)arcs=function extractArcs(topology,object$$1,filter){var geom,arcs=[],geomsByArc=[];function extract0(i){var j=i<0?~i:i;(geomsByArc[j]||(geomsByArc[j]=[])).push({i:i,g:geom})}function extract1(arcs){arcs.forEach(extract0)}function extract2(arcs){arcs.forEach(extract1)}return function geometry(o){switch(geom=o,o.type){case"GeometryCollection":o.geometries.forEach(geometry);break;case"LineString":extract1(o.arcs);break;case"MultiLineString":case"Polygon":extract2(o.arcs);break;case"MultiPolygon":!function extract3(arcs){arcs.forEach(extract2)}(o.arcs)}}(object$$1),geomsByArc.forEach(null==filter?function(geoms){arcs.push(geoms[0].i)}:function(geoms){filter(geoms[0].g,geoms[geoms.length-1].g)&&arcs.push(geoms[0].i)}),arcs}(0,object$$1,filter);else for(i=0,arcs=new Array(n=topology.arcs.length);i<n;++i)arcs[i]=i;return{type:"MultiLineString",arcs:stitch(topology,arcs)}}function mergeArcs(topology,objects){var polygonsByArc={},polygons=[],groups=[];function extract(polygon){polygon.forEach(function(ring){ring.forEach(function(arc){(polygonsByArc[arc=arc<0?~arc:arc]||(polygonsByArc[arc]=[])).push(polygon)})}),polygons.push(polygon)}function area(ring){return function planarRingArea(ring){for(var a,i=-1,n=ring.length,b=ring[n-1],area=0;++i<n;)a=b,b=ring[i],area+=a[0]*b[1]-a[1]*b[0];return Math.abs(area)}(object(topology,{type:"Polygon",arcs:[ring]}).coordinates[0])}return objects.forEach(function geometry(o){switch(o.type){case"GeometryCollection":o.geometries.forEach(geometry);break;case"Polygon":extract(o.arcs);break;case"MultiPolygon":o.arcs.forEach(extract)}}),polygons.forEach(function(polygon){if(!polygon._){var group=[],neighbors=[polygon];for(polygon._=1,groups.push(group);polygon=neighbors.pop();)group.push(polygon),polygon.forEach(function(ring){ring.forEach(function(arc){polygonsByArc[arc<0?~arc:arc].forEach(function(polygon){polygon._||(polygon._=1,neighbors.push(polygon))})})})}}),polygons.forEach(function(polygon){delete polygon._}),{type:"MultiPolygon",arcs:groups.map(function(polygons){var n,arcs=[];if(polygons.forEach(function(polygon){polygon.forEach(function(ring){ring.forEach(function(arc){polygonsByArc[arc<0?~arc:arc].length<2&&arcs.push(arc)})})}),(n=(arcs=stitch(topology,arcs)).length)>1)for(var ki,t,i=1,k=area(arcs[0]);i<n;++i)(ki=area(arcs[i]))>k&&(t=arcs[0],arcs[0]=arcs[i],arcs[i]=t,k=ki);return arcs})}}var bisect=function(a,x){for(var lo=0,hi=a.length;lo<hi;){var mid=lo+hi>>>1;a[mid]<x?lo=mid+1:hi=mid}return lo};exports.bbox=bbox,exports.feature=function(topology,o){return"GeometryCollection"===o.type?{type:"FeatureCollection",features:o.geometries.map(function(o){return feature$1(topology,o)})}:feature$1(topology,o)},exports.mesh=function(topology){return object(topology,meshArcs.apply(this,arguments))},exports.meshArcs=meshArcs,exports.merge=function(topology){return object(topology,mergeArcs.apply(this,arguments))},exports.mergeArcs=mergeArcs,exports.neighbors=function(objects){var indexesByArc={},neighbors=objects.map(function(){return[]});function line(arcs,i){arcs.forEach(function(a){a<0&&(a=~a);var o=indexesByArc[a];o?o.push(i):indexesByArc[a]=[i]})}function polygon(arcs,i){arcs.forEach(function(arc){line(arc,i)})}var geometryType={LineString:line,MultiLineString:polygon,Polygon:polygon,MultiPolygon:function(arcs,i){arcs.forEach(function(arc){polygon(arc,i)})}};for(var i in objects.forEach(function geometry(o,i){"GeometryCollection"===o.type?o.geometries.forEach(function(o){geometry(o,i)}):o.type in geometryType&&geometryType[o.type](o.arcs,i)}),indexesByArc)for(var indexes=indexesByArc[i],m=indexes.length,j=0;j<m;++j)for(var k=j+1;k<m;++k){var n,ij=indexes[j],ik=indexes[k];(n=neighbors[ij])[i=bisect(n,ik)]!==ik&&n.splice(i,0,ik),(n=neighbors[ik])[i=bisect(n,ij)]!==ij&&n.splice(i,0,ij)}return neighbors},exports.quantize=function(topology,n){if(!((n=Math.floor(n))>=2))throw new Error("n must be 2");if(topology.transform)throw new Error("already quantized");var name,bb=bbox(topology),dx=bb[0],kx=(bb[2]-dx)/(n-1)||1,dy=bb[1],ky=(bb[3]-dy)/(n-1)||1;function quantizePoint(p){p[0]=Math.round((p[0]-dx)/kx),p[1]=Math.round((p[1]-dy)/ky)}function quantizeGeometry(o){switch(o.type){case"GeometryCollection":o.geometries.forEach(quantizeGeometry);break;case"Point":quantizePoint(o.coordinates);break;case"MultiPoint":o.coordinates.forEach(quantizePoint)}}for(name in topology.arcs.forEach(function(arc){for(var pj,x1,y1,i=1,j=1,n=arc.length,pi=arc[0],x0=pi[0]=Math.round((pi[0]-dx)/kx),y0=pi[1]=Math.round((pi[1]-dy)/ky);i<n;++i)pi=arc[i],x1=Math.round((pi[0]-dx)/kx),y1=Math.round((pi[1]-dy)/ky),x1===x0&&y1===y0||((pj=arc[j++])[0]=x1-x0,x0=x1,pj[1]=y1-y0,y0=y1);j<2&&((pj=arc[j++])[0]=0,pj[1]=0),arc.length=j}),topology.objects)quantizeGeometry(topology.objects[name]);return topology.transform={scale:[kx,ky],translate:[dx,dy]},topology},exports.transform=transform,exports.untransform=function(topology){if(null==(transform=topology.transform))return identity;var transform,x0,y0,kx=transform.scale[0],ky=transform.scale[1],dx=transform.translate[0],dy=transform.translate[1];return function(point,i){i||(x0=y0=0);var x1=Math.round((point[0]-dx)/kx),y1=Math.round((point[1]-dy)/ky);return point[0]=x1-x0,x0=x1,point[1]=y1-y0,y0=y1,point}},Object.defineProperty(exports,"__esModule",{value:!0})}("object"==typeof exports&&void 0!==module?exports:global.topojson=global.topojson||{})},{}],515:[function(_dereq_,module,exports){"use strict";module.exports=function triangulateCube(dimension){if(dimension<0)return[];if(0===dimension)return[[0]];for(var dfactorial=0|Math.round(gamma(dimension+1)),result=[],i=0;i<dfactorial;++i){for(var p=perm.unrank(dimension,i),cell=[0],v=0,j=0;j<p.length;++j)v+=1<<p[j],cell.push(v);sgn(p)<1&&(cell[0]=v,cell[dimension]=0),result.push(cell)}return result};var perm=_dereq_("permutation-rank"),sgn=_dereq_("permutation-parity"),gamma=_dereq_("gamma")},{gamma:219,"permutation-parity":443,"permutation-rank":444}],516:[function(_dereq_,module,exports){"use strict";module.exports=function createTurntableController(options){var center=(options=options||{}).center||[0,0,0],up=options.up||[0,1,0],right=options.right||findOrthoPair(up),radius=options.radius||1,theta=options.theta||0,phi=options.phi||0;if(center=[].slice.call(center,0,3),up=[].slice.call(up,0,3),normalize3(up,up),right=[].slice.call(right,0,3),normalize3(right,right),"eye"in options){var eye=options.eye,toward=[eye[0]-center[0],eye[1]-center[1],eye[2]-center[2]];cross(right,toward,up),len3(right[0],right[1],right[2])<1e-6?right=findOrthoPair(up):normalize3(right,right),radius=len3(toward[0],toward[1],toward[2]);var ut=dot3(up,toward)/radius,rt=dot3(right,toward)/radius;phi=Math.acos(ut),theta=Math.acos(rt)}return radius=Math.log(radius),new TurntableController(options.zoomMin,options.zoomMax,center,up,right,radius,theta,phi)};var filterVector=_dereq_("filtered-vector"),invert44=_dereq_("gl-mat4/invert"),rotateM=_dereq_("gl-mat4/rotate"),cross=_dereq_("gl-vec3/cross"),normalize3=_dereq_("gl-vec3/normalize"),dot3=_dereq_("gl-vec3/dot");function len3(x,y,z){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2)+Math.pow(z,2))}function clamp1(x){return Math.min(1,Math.max(-1,x))}function findOrthoPair(v){var vx=Math.abs(v[0]),vy=Math.abs(v[1]),vz=Math.abs(v[2]),u=[0,0,0];vx>Math.max(vy,vz)?u[2]=1:vy>Math.max(vx,vz)?u[0]=1:u[1]=1;for(var vv=0,uv=0,i=0;i<3;++i)vv+=v[i]*v[i],uv+=u[i]*v[i];for(i=0;i<3;++i)u[i]-=uv/vv*v[i];return normalize3(u,u),u}function TurntableController(zoomMin,zoomMax,center,up,right,radius,theta,phi){this.center=filterVector(center),this.up=filterVector(up),this.right=filterVector(right),this.radius=filterVector([radius]),this.angle=filterVector([theta,phi]),this.angle.bounds=[[-1/0,-Math.PI/2],[1/0,Math.PI/2]],this.setDistanceLimits(zoomMin,zoomMax),this.computedCenter=this.center.curve(0),this.computedUp=this.up.curve(0),this.computedRight=this.right.curve(0),this.computedRadius=this.radius.curve(0),this.computedAngle=this.angle.curve(0),this.computedToward=[0,0,0],this.computedEye=[0,0,0],this.computedMatrix=new Array(16);for(var i=0;i<16;++i)this.computedMatrix[i]=.5;this.recalcMatrix(0)}var proto=TurntableController.prototype;proto.setDistanceLimits=function(minDist,maxDist){minDist=minDist>0?Math.log(minDist):-1/0,maxDist=maxDist>0?Math.log(maxDist):1/0,maxDist=Math.max(maxDist,minDist),this.radius.bounds[0][0]=minDist,this.radius.bounds[1][0]=maxDist},proto.getDistanceLimits=function(out){var bounds=this.radius.bounds[0];return out?(out[0]=Math.exp(bounds[0][0]),out[1]=Math.exp(bounds[1][0]),out):[Math.exp(bounds[0][0]),Math.exp(bounds[1][0])]},proto.recalcMatrix=function(t){this.center.curve(t),this.up.curve(t),this.right.curve(t),this.radius.curve(t),this.angle.curve(t);for(var up=this.computedUp,right=this.computedRight,uu=0,ur=0,i=0;i<3;++i)ur+=up[i]*right[i],uu+=up[i]*up[i];var ul=Math.sqrt(uu),rr=0;for(i=0;i<3;++i)right[i]-=up[i]*ur/uu,rr+=right[i]*right[i],up[i]/=ul;var rl=Math.sqrt(rr);for(i=0;i<3;++i)right[i]/=rl;var toward=this.computedToward;cross(toward,up,right),normalize3(toward,toward);var radius=Math.exp(this.computedRadius[0]),theta=this.computedAngle[0],phi=this.computedAngle[1],ctheta=Math.cos(theta),stheta=Math.sin(theta),cphi=Math.cos(phi),sphi=Math.sin(phi),center=this.computedCenter,wx=ctheta*cphi,wy=stheta*cphi,wz=sphi,sx=-ctheta*sphi,sy=-stheta*sphi,sz=cphi,eye=this.computedEye,mat=this.computedMatrix;for(i=0;i<3;++i){var x=wx*right[i]+wy*toward[i]+wz*up[i];mat[4*i+1]=sx*right[i]+sy*toward[i]+sz*up[i],mat[4*i+2]=x,mat[4*i+3]=0}var ax=mat[1],ay=mat[5],az=mat[9],bx=mat[2],by=mat[6],bz=mat[10],cx=ay*bz-az*by,cy=az*bx-ax*bz,cz=ax*by-ay*bx,cl=len3(cx,cy,cz);cx/=cl,cy/=cl,cz/=cl,mat[0]=cx,mat[4]=cy,mat[8]=cz;for(i=0;i<3;++i)eye[i]=center[i]+mat[2+4*i]*radius;for(i=0;i<3;++i){rr=0;for(var j=0;j<3;++j)rr+=mat[i+4*j]*eye[j];mat[12+i]=-rr}mat[15]=1},proto.getMatrix=function(t,result){this.recalcMatrix(t);var mat=this.computedMatrix;if(result){for(var i=0;i<16;++i)result[i]=mat[i];return result}return mat};var zAxis=[0,0,0];proto.rotate=function(t,dtheta,dphi,droll){if(this.angle.move(t,dtheta,dphi),droll){this.recalcMatrix(t);var mat=this.computedMatrix;zAxis[0]=mat[2],zAxis[1]=mat[6],zAxis[2]=mat[10];for(var up=this.computedUp,right=this.computedRight,toward=this.computedToward,i=0;i<3;++i)mat[4*i]=up[i],mat[4*i+1]=right[i],mat[4*i+2]=toward[i];rotateM(mat,mat,droll,zAxis);for(i=0;i<3;++i)up[i]=mat[4*i],right[i]=mat[4*i+1];this.up.set(t,up[0],up[1],up[2]),this.right.set(t,right[0],right[1],right[2])}},proto.pan=function(t,dx,dy,dz){dx=dx||0,dy=dy||0,dz=dz||0,this.recalcMatrix(t);var mat=this.computedMatrix,ux=(Math.exp(this.computedRadius[0]),mat[1]),uy=mat[5],uz=mat[9],ul=len3(ux,uy,uz);ux/=ul,uy/=ul,uz/=ul;var rx=mat[0],ry=mat[4],rz=mat[8],ru=rx*ux+ry*uy+rz*uz,rl=len3(rx-=ux*ru,ry-=uy*ru,rz-=uz*ru),vx=(rx/=rl)*dx+ux*dy,vy=(ry/=rl)*dx+uy*dy,vz=(rz/=rl)*dx+uz*dy;this.center.move(t,vx,vy,vz);var radius=Math.exp(this.computedRadius[0]);radius=Math.max(1e-4,radius+dz),this.radius.set(t,Math.log(radius))},proto.translate=function(t,dx,dy,dz){this.center.move(t,dx||0,dy||0,dz||0)},proto.setMatrix=function(t,mat,axes,noSnap){var ushift=1;"number"==typeof axes&&(ushift=0|axes),(ushift<0||ushift>3)&&(ushift=1);var vshift=(ushift+2)%3;mat||(this.recalcMatrix(t),mat=this.computedMatrix);var ux=mat[ushift],uy=mat[ushift+4],uz=mat[ushift+8];if(noSnap){var ax=Math.abs(ux),ay=Math.abs(uy),az=Math.abs(uz),am=Math.max(ax,ay,az);ax===am?(ux=ux<0?-1:1,uy=uz=0):az===am?(uz=uz<0?-1:1,ux=uy=0):(uy=uy<0?-1:1,ux=uz=0)}else{var ul=len3(ux,uy,uz);ux/=ul,uy/=ul,uz/=ul}var phi,theta,rx=mat[vshift],ry=mat[vshift+4],rz=mat[vshift+8],ru=rx*ux+ry*uy+rz*uz,rl=len3(rx-=ux*ru,ry-=uy*ru,rz-=uz*ru),fx=uy*(rz/=rl)-uz*(ry/=rl),fy=uz*(rx/=rl)-ux*rz,fz=ux*ry-uy*rx,fl=len3(fx,fy,fz);if(fx/=fl,fy/=fl,fz/=fl,this.center.jump(t,ex,ey,ez),this.radius.idle(t),this.up.jump(t,ux,uy,uz),this.right.jump(t,rx,ry,rz),2===ushift){var cx=mat[1],cy=mat[5],cz=mat[9],cr=cx*rx+cy*ry+cz*rz,cf=cx*fx+cy*fy+cz*fz;phi=tu<0?-Math.PI/2:Math.PI/2,theta=Math.atan2(cf,cr)}else{var tx=mat[2],ty=mat[6],tz=mat[10],tu=tx*ux+ty*uy+tz*uz,tr=tx*rx+ty*ry+tz*rz,tf=tx*fx+ty*fy+tz*fz;phi=Math.asin(clamp1(tu)),theta=Math.atan2(tf,tr)}this.angle.jump(t,theta,phi),this.recalcMatrix(t);var dx=mat[2],dy=mat[6],dz=mat[10],imat=this.computedMatrix;invert44(imat,mat);var w=imat[15],ex=imat[12]/w,ey=imat[13]/w,ez=imat[14]/w,gs=Math.exp(this.computedRadius[0]);this.center.jump(t,ex-dx*gs,ey-dy*gs,ez-dz*gs)},proto.lastT=function(){return Math.max(this.center.lastT(),this.up.lastT(),this.right.lastT(),this.radius.lastT(),this.angle.lastT())},proto.idle=function(t){this.center.idle(t),this.up.idle(t),this.right.idle(t),this.radius.idle(t),this.angle.idle(t)},proto.flush=function(t){this.center.flush(t),this.up.flush(t),this.right.flush(t),this.radius.flush(t),this.angle.flush(t)},proto.setDistance=function(t,d){d>0&&this.radius.set(t,Math.log(d))},proto.lookAt=function(t,eye,center,up){this.recalcMatrix(t),eye=eye||this.computedEye,center=center||this.computedCenter;var ux=(up=up||this.computedUp)[0],uy=up[1],uz=up[2],ul=len3(ux,uy,uz);if(!(ul<1e-6)){ux/=ul,uy/=ul,uz/=ul;var tx=eye[0]-center[0],ty=eye[1]-center[1],tz=eye[2]-center[2],tl=len3(tx,ty,tz);if(!(tl<1e-6)){tx/=tl,ty/=tl,tz/=tl;var right=this.computedRight,rx=right[0],ry=right[1],rz=right[2],ru=ux*rx+uy*ry+uz*rz,rl=len3(rx-=ru*ux,ry-=ru*uy,rz-=ru*uz);if(!(rl<.01&&(rl=len3(rx=uy*tz-uz*ty,ry=uz*tx-ux*tz,rz=ux*ty-uy*tx))<1e-6)){rx/=rl,ry/=rl,rz/=rl,this.up.set(t,ux,uy,uz),this.right.set(t,rx,ry,rz),this.center.set(t,center[0],center[1],center[2]),this.radius.set(t,Math.log(tl));var fx=uy*rz-uz*ry,fy=uz*rx-ux*rz,fz=ux*ry-uy*rx,fl=len3(fx,fy,fz),tu=ux*tx+uy*ty+uz*tz,tr=rx*tx+ry*ty+rz*tz,tf=(fx/=fl)*tx+(fy/=fl)*ty+(fz/=fl)*tz,phi=Math.asin(clamp1(tu)),theta=Math.atan2(tf,tr),angleState=this.angle._state,lastTheta=angleState[angleState.length-1],lastPhi=angleState[angleState.length-2];lastTheta%=2*Math.PI;var dp=Math.abs(lastTheta+2*Math.PI-theta),d0=Math.abs(lastTheta-theta),dn=Math.abs(lastTheta-2*Math.PI-theta);dp<d0&&(lastTheta+=2*Math.PI),dn<d0&&(lastTheta-=2*Math.PI),this.angle.jump(this.angle.lastT(),lastTheta,lastPhi),this.angle.set(t,theta,phi)}}}}},{"filtered-vector":214,"gl-mat4/invert":253,"gl-mat4/rotate":257,"gl-vec3/cross":315,"gl-vec3/dot":320,"gl-vec3/normalize":337}],517:[function(_dereq_,module,exports){"use strict";module.exports=function twoProduct(a,b,result){var x=a*b,c=SPLITTER*a,ahi=c-(c-a),alo=a-ahi,d=SPLITTER*b,bhi=d-(d-b),blo=b-bhi,y=alo*blo-(x-ahi*bhi-alo*bhi-ahi*blo);if(result)return result[0]=y,result[1]=x,result;return[y,x]};var SPLITTER=+(Math.pow(2,27)+1)},{}],518:[function(_dereq_,module,exports){"use strict";module.exports=function fastTwoSum(a,b,result){var x=a+b,bv=x-a,br=b-bv,ar=a-(x-bv);if(result)return result[0]=ar+br,result[1]=x,result;return[ar+br,x]}},{}],519:[function(_dereq_,module,exports){(function(global,Buffer){"use strict";var bits=_dereq_("bit-twiddle"),dup=_dereq_("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;function freeArrayBuffer(buffer){if(buffer){var n=buffer.length||buffer.byteLength,log_n=bits.log2(n);DATA[log_n].push(buffer)}}function mallocArrayBuffer(n){n=bits.nextPow2(n);var log_n=bits.log2(n),d=DATA[log_n];return d.length>0?d.pop():new ArrayBuffer(n)}function mallocUint8(n){return new Uint8Array(mallocArrayBuffer(n),0,n)}function mallocUint16(n){return new Uint16Array(mallocArrayBuffer(2*n),0,n)}function mallocUint32(n){return new Uint32Array(mallocArrayBuffer(4*n),0,n)}function mallocInt8(n){return new Int8Array(mallocArrayBuffer(n),0,n)}function mallocInt16(n){return new Int16Array(mallocArrayBuffer(2*n),0,n)}function mallocInt32(n){return new Int32Array(mallocArrayBuffer(4*n),0,n)}function mallocFloat(n){return new Float32Array(mallocArrayBuffer(4*n),0,n)}function mallocDouble(n){return new Float64Array(mallocArrayBuffer(8*n),0,n)}function mallocUint8Clamped(n){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(n),0,n):mallocUint8(n)}function mallocDataView(n){return new DataView(mallocArrayBuffer(n),0,n)}function mallocBuffer(n){n=bits.nextPow2(n);var log_n=bits.log2(n),cache=BUFFER[log_n];return cache.length>0?cache.pop():new Buffer(n)}exports.free=function free(array){if(Buffer.isBuffer(array))BUFFER[bits.log2(array.length)].push(array);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(array)&&(array=array.buffer),!array)return;var n=array.length||array.byteLength,log_n=0|bits.log2(n);DATA[log_n].push(array)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=function freeTypedArray(array){freeArrayBuffer(array.buffer)},exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function freeBuffer(array){BUFFER[bits.log2(array.length)].push(array)},exports.malloc=function malloc(n,dtype){if(void 0===dtype||"arraybuffer"===dtype)return mallocArrayBuffer(n);switch(dtype){case"uint8":return mallocUint8(n);case"uint16":return mallocUint16(n);case"uint32":return mallocUint32(n);case"int8":return mallocInt8(n);case"int16":return mallocInt16(n);case"int32":return mallocInt32(n);case"float":case"float32":return mallocFloat(n);case"double":case"float64":return mallocDouble(n);case"uint8_clamped":return mallocUint8Clamped(n);case"buffer":return mallocBuffer(n);case"data":case"dataview":return mallocDataView(n);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function clearCache(){for(var i=0;i<32;++i)POOL.UINT8[i].length=0,POOL.UINT16[i].length=0,POOL.UINT32[i].length=0,POOL.INT8[i].length=0,POOL.INT16[i].length=0,POOL.INT32[i].length=0,POOL.FLOAT[i].length=0,POOL.DOUBLE[i].length=0,POOL.UINT8C[i].length=0,DATA[i].length=0,BUFFER[i].length=0}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer)},{"bit-twiddle":79,buffer:92,dup:154}],520:[function(_dereq_,module,exports){"use strict";"use restrict";function UnionFind(count){this.roots=new Array(count),this.ranks=new Array(count);for(var i=0;i<count;++i)this.roots[i]=i,this.ranks[i]=0}module.exports=UnionFind;var proto=UnionFind.prototype;Object.defineProperty(proto,"length",{get:function(){return this.roots.length}}),proto.makeSet=function(){var n=this.roots.length;return this.roots.push(n),this.ranks.push(0),n},proto.find=function(x){for(var x0=x,roots=this.roots;roots[x]!==x;)x=roots[x];for(;roots[x0]!==x;){var y=roots[x0];roots[x0]=x,x0=y}return x},proto.link=function(x,y){var xr=this.find(x),yr=this.find(y);if(xr!==yr){var ranks=this.ranks,roots=this.roots,xd=ranks[xr],yd=ranks[yr];xd<yd?roots[xr]=yr:yd<xd?roots[yr]=xr:(roots[yr]=xr,++ranks[xr])}}},{}],521:[function(_dereq_,module,exports){"use strict";module.exports=function unique(list,compare,sorted){return 0===list.length?list:compare?(sorted||list.sort(compare),function unique_pred(list,compare){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;i<len;++i)if(b=a,compare(a=list[i],b)){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list}(list,compare)):(sorted||list.sort(),function unique_eq(list){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;i<len;++i,b=a)if(b=a,(a=list[i])!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list}(list))}},{}],522:[function(_dereq_,module,exports){var reg=/[\'\"]/;module.exports=function unquote(str){return str?(reg.test(str.charAt(0))&&(str=str.substr(1)),reg.test(str.charAt(str.length-1))&&(str=str.substr(0,str.length-1)),str):""}},{}],523:[function(_dereq_,module,exports){"use strict";module.exports=function updateDiff(obj,diff,mappers){Array.isArray(mappers)||(mappers=[].slice.call(arguments,2));for(var i=0,l=mappers.length;i<l;i++){var dict=mappers[i];for(var prop in dict)if((void 0===diff[prop]||Array.isArray(diff[prop])||obj[prop]!==diff[prop])&&prop in diff){var result;if(!0===dict[prop])result=diff[prop];else{if(!1===dict[prop])continue;if("function"==typeof dict[prop]&&void 0===(result=dict[prop](diff[prop],obj,diff)))continue}obj[prop]=result}}return obj}},{}],524:[function(_dereq_,module,exports){"use strict";module.exports=function createText(str,options){"object"==typeof options&&null!==options||(options={});return vectorizeText(str,options.canvas||defaultCanvas,options.context||defaultContext,options)};var vectorizeText=_dereq_("./lib/vtext"),defaultCanvas=null,defaultContext=null;"undefined"!=typeof document&&((defaultCanvas=document.createElement("canvas")).width=8192,defaultCanvas.height=1024,defaultContext=defaultCanvas.getContext("2d"))},{"./lib/vtext":525}],525:[function(_dereq_,module,exports){"use strict";module.exports=function vectorizeText(str,canvas,context,options){var size=options.size||64,family=options.font||"normal";return context.font=size+"px "+family,context.textAlign="start",context.textBaseline="alphabetic",context.direction="ltr",processPixels(function getPixels(canvas,context,str,size){var width=0|Math.ceil(context.measureText(str).width+2*size);if(width>8192)throw new Error("vectorize-text: String too long (sorry, this will get fixed later)");var height=3*size;canvas.height<height&&(canvas.height=height),context.fillStyle="#000",context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle="#fff",context.fillText(str,size,2*size);var pixelData=context.getImageData(0,0,width,height);return ndarray(pixelData.data,[height,width,4]).pick(-1,-1,0).transpose(1,0)}(canvas,context,str,size),options,size)},module.exports.processPixels=processPixels;var surfaceNets=_dereq_("surface-nets"),ndarray=_dereq_("ndarray"),simplify=_dereq_("simplify-planar-graph"),cleanPSLG=_dereq_("clean-pslg"),cdt2d=_dereq_("cdt2d"),toPolygonCrappy=_dereq_("planar-graph-to-polyline");function getContour(pixels,doSimplify){var contour=surfaceNets(pixels,128);return doSimplify?simplify(contour.cells,contour.positions,.25):{edges:contour.cells,positions:contour.positions}}function processPixelsImpl(pixels,options,size,simplify){var contour=getContour(pixels,simplify),positions=function transformPositions(positions,options,size){for(var align=options.textAlign||"start",baseline=options.textBaseline||"alphabetic",lo=[1<<30,1<<30],hi=[0,0],n=positions.length,i=0;i<n;++i)for(var p=positions[i],j=0;j<2;++j)lo[j]=0|Math.min(lo[j],p[j]),hi[j]=0|Math.max(hi[j],p[j]);var xShift=0;switch(align){case"center":xShift=-.5*(lo[0]+hi[0]);break;case"right":case"end":xShift=-hi[0];break;case"left":case"start":xShift=-lo[0];break;default:throw new Error("vectorize-text: Unrecognized textAlign: '"+align+"'")}var yShift=0;switch(baseline){case"hanging":case"top":yShift=-lo[1];break;case"middle":yShift=-.5*(lo[1]+hi[1]);break;case"alphabetic":case"ideographic":yShift=-3*size;break;case"bottom":yShift=-hi[1];break;default:throw new Error("vectorize-text: Unrecoginized textBaseline: '"+baseline+"'")}var scale=1/size;return"lineHeight"in options?scale*=+options.lineHeight:"width"in options?scale=options.width/(hi[0]-lo[0]):"height"in options&&(scale=options.height/(hi[1]-lo[1])),positions.map(function(p){return[scale*(p[0]+xShift),scale*(p[1]+yShift)]})}(contour.positions,options,size),edges=contour.edges,flip="ccw"===options.orientation;if(cleanPSLG(positions,edges),options.polygons||options.polygon||options.polyline){for(var result=toPolygonCrappy(edges,positions),nresult=new Array(result.length),i=0;i<result.length;++i){for(var loops=result[i],nloops=new Array(loops.length),j=0;j<loops.length;++j){for(var loop=loops[j],nloop=new Array(loop.length),k=0;k<loop.length;++k)nloop[k]=positions[loop[k]].slice();flip&&nloop.reverse(),nloops[j]=nloop}nresult[i]=nloops}return nresult}return options.triangles||options.triangulate||options.triangle?{cells:cdt2d(positions,edges,{delaunay:!1,exterior:!1,interior:!0}),positions:positions}:{edges:edges,positions:positions}}function processPixels(pixels,options,size){try{return processPixelsImpl(pixels,options,size,!0)}catch(e){}try{return processPixelsImpl(pixels,options,size,!1)}catch(e){}return options.polygons||options.polyline||options.polygon?[]:options.triangles||options.triangulate||options.triangle?{cells:[],positions:[]}:{edges:[],positions:[]}}},{cdt2d:93,"clean-pslg":103,ndarray:430,"planar-graph-to-polyline":448,"simplify-planar-graph":497,"surface-nets":505}],526:[function(_dereq_,module,exports){!function WeakMapModule(){"use strict";if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=weakMapPermitHostObjects);var doubleWeakMapCheckSilentFailure=!1;if("function"==typeof WeakMap){var HostWeakMap=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var testMap=new HostWeakMap,testObject=Object.freeze({});if(testMap.set(testObject,1),1===testMap.get(testObject))return void(module.exports=WeakMap);doubleWeakMapCheckSilentFailure=!0}}Object.prototype.hasOwnProperty;var gopn=Object.getOwnPropertyNames,defProp=Object.defineProperty,isExtensible=Object.isExtensible,HIDDEN_NAME_PREFIX="weakmap:",HIDDEN_NAME=HIDDEN_NAME_PREFIX+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var ab=new ArrayBuffer(25),u8s=new Uint8Array(ab);crypto.getRandomValues(u8s),HIDDEN_NAME=HIDDEN_NAME_PREFIX+"rand:"+Array.prototype.map.call(u8s,function(u8){return(u8%36).toString(36)}).join("")+"___"}if(defProp(Object,"getOwnPropertyNames",{value:function fakeGetOwnPropertyNames(obj){return gopn(obj).filter(isNotHiddenName)}}),"getPropertyNames"in Object){var originalGetPropertyNames=Object.getPropertyNames;defProp(Object,"getPropertyNames",{value:function fakeGetPropertyNames(obj){return originalGetPropertyNames(obj).filter(isNotHiddenName)}})}!function(){var oldFreeze=Object.freeze;defProp(Object,"freeze",{value:function identifyingFreeze(obj){return getHiddenRecord(obj),oldFreeze(obj)}});var oldSeal=Object.seal;defProp(Object,"seal",{value:function identifyingSeal(obj){return getHiddenRecord(obj),oldSeal(obj)}});var oldPreventExtensions=Object.preventExtensions;defProp(Object,"preventExtensions",{value:function identifyingPreventExtensions(obj){return getHiddenRecord(obj),oldPreventExtensions(obj)}})}();var calledAsFunctionWarningDone=!1,nextId=0,OurWeakMap=function(){this instanceof OurWeakMap||calledAsFunctionWarning();var keys=[],values=[],id=nextId++;return Object.create(OurWeakMap.prototype,{get___:{value:constFunc(function get___(key,opt_default){var index,hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord?hiddenRecord[id]:opt_default:(index=keys.indexOf(key))>=0?values[index]:opt_default})},has___:{value:constFunc(function has___(key){var hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord:keys.indexOf(key)>=0})},set___:{value:constFunc(function set___(key,value){var index,hiddenRecord=getHiddenRecord(key);return hiddenRecord?hiddenRecord[id]=value:(index=keys.indexOf(key))>=0?values[index]=value:(index=keys.length,values[index]=value,keys[index]=key),this})},delete___:{value:constFunc(function delete___(key){var index,lastIndex,hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord&&delete hiddenRecord[id]:!((index=keys.indexOf(key))<0||(lastIndex=keys.length-1,keys[index]=void 0,values[index]=values[lastIndex],keys[index]=keys[lastIndex],keys.length=lastIndex,values.length=lastIndex,0))})}})};OurWeakMap.prototype=Object.create(Object.prototype,{get:{value:function get(key,opt_default){return this.get___(key,opt_default)},writable:!0,configurable:!0},has:{value:function has(key){return this.has___(key)},writable:!0,configurable:!0},set:{value:function set(key,value){return this.set___(key,value)},writable:!0,configurable:!0},delete:{value:function remove(key){return this.delete___(key)},writable:!0,configurable:!0}}),"function"==typeof HostWeakMap?function(){function DoubleWeakMap(){this instanceof OurWeakMap||calledAsFunctionWarning();var dset,hmap=new HostWeakMap,omap=void 0,enableSwitching=!1;return dset=doubleWeakMapCheckSilentFailure?function(key,value){return hmap.set(key,value),hmap.has(key)||(omap||(omap=new OurWeakMap),omap.set(key,value)),this}:function(key,value){if(enableSwitching)try{hmap.set(key,value)}catch(e){omap||(omap=new OurWeakMap),omap.set___(key,value)}else hmap.set(key,value);return this},Object.create(OurWeakMap.prototype,{get___:{value:constFunc(function dget(key,opt_default){return omap?hmap.has(key)?hmap.get(key):omap.get___(key,opt_default):hmap.get(key,opt_default)})},has___:{value:constFunc(function dhas(key){return hmap.has(key)||!!omap&&omap.has___(key)})},set___:{value:constFunc(dset)},delete___:{value:constFunc(function ddelete(key){var result=!!hmap.delete(key);return omap&&omap.delete___(key)||result})},permitHostObjects___:{value:constFunc(function(token){if(token!==weakMapPermitHostObjects)throw new Error("bogus call to permitHostObjects___");enableSwitching=!0})}})}doubleWeakMapCheckSilentFailure&&"undefined"!=typeof Proxy&&(Proxy=void 0),DoubleWeakMap.prototype=OurWeakMap.prototype,module.exports=DoubleWeakMap,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),module.exports=OurWeakMap)}function weakMapPermitHostObjects(map){map.permitHostObjects___&&map.permitHostObjects___(weakMapPermitHostObjects)}function isNotHiddenName(name){return!(name.substr(0,HIDDEN_NAME_PREFIX.length)==HIDDEN_NAME_PREFIX&&"___"===name.substr(name.length-3))}function getHiddenRecord(key){if(key!==Object(key))throw new TypeError("Not an object: "+key);var hiddenRecord=key[HIDDEN_NAME];if(hiddenRecord&&hiddenRecord.key===key)return hiddenRecord;if(isExtensible(key)){hiddenRecord={key:key};try{return defProp(key,HIDDEN_NAME,{value:hiddenRecord,writable:!1,enumerable:!1,configurable:!1}),hiddenRecord}catch(error){return}}}function constFunc(func){return func.prototype=null,Object.freeze(func)}function calledAsFunctionWarning(){calledAsFunctionWarningDone||"undefined"==typeof console||(calledAsFunctionWarningDone=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()},{}],527:[function(_dereq_,module,exports){var hiddenStore=_dereq_("./hidden-store.js");module.exports=function createStore(){var key={};return function(obj){if(("object"!=typeof obj||null===obj)&&"function"!=typeof obj)throw new Error("Weakmap-shim: Key must be object");var store=obj.valueOf(key);return store&&store.identity===key?store:hiddenStore(obj,key)}}},{"./hidden-store.js":528}],528:[function(_dereq_,module,exports){module.exports=function hiddenStore(obj,key){var store={identity:key},valueOf=obj.valueOf;return Object.defineProperty(obj,"valueOf",{value:function(value){return value!==key?valueOf.apply(this,arguments):store},writable:!0}),store}},{}],529:[function(_dereq_,module,exports){var createStore=_dereq_("./create-store.js");module.exports=function weakMap(){var privates=createStore();return{get:function(key,fallback){var store=privates(key);return store.hasOwnProperty("value")?store.value:fallback},set:function(key,value){return privates(key).value=value,this},has:function(key){return"value"in privates(key)},delete:function(key){return delete privates(key).value}}}},{"./create-store.js":527}],530:[function(_dereq_,module,exports){var getContext=_dereq_("get-canvas-context");module.exports=function getWebGLContext(opt){return getContext("webgl",opt)}},{"get-canvas-context":220}],531:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign"),gregorianCalendar=main.instance();function ChineseCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}ChineseCalendar.prototype=new main.baseCalendar,assign(ChineseCalendar.prototype,{name:"Chinese",jdEpoch:1721425.5,hasYearZero:!1,minMonth:0,firstMonth:0,minDay:1,regionalOptions:{"":{name:"Chinese",epochs:["BEC","EC"],monthNumbers:function(date,padded){if("string"==typeof date){var match=date.match(MONTH_NUMBER_REGEXP);return match?match[0]:""}var year=this._validateYear(date),monthIndex=date.month(),month=""+this.toChineseMonth(year,monthIndex);return padded&&month.length<2&&(month="0"+month),this.isIntercalaryMonth(year,monthIndex)&&(month+="i"),month},monthNames:function(date){if("string"==typeof date){var match=date.match(MONTH_NAME_REGEXP);return match?match[0]:""}var year=this._validateYear(date),monthIndex=date.month(),monthName=["","","","","","","","","","","",""][this.toChineseMonth(year,monthIndex)-1];return this.isIntercalaryMonth(year,monthIndex)&&(monthName=""+monthName),monthName},monthNamesShort:function(date){if("string"==typeof date){var match=date.match(MONTH_SHORT_NAME_REGEXP);return match?match[0]:""}var year=this._validateYear(date),monthIndex=date.month(),monthName=["","","","","","","","","","","",""][this.toChineseMonth(year,monthIndex)-1];return this.isIntercalaryMonth(year,monthIndex)&&(monthName=""+monthName),monthName},parseMonth:function(year,monthString){year=this._validateYear(year);var isIntercalary,month=parseInt(monthString);if(isNaN(month))""===monthString[0]&&(isIntercalary=!0,monthString=monthString.substring(1)),""===monthString[monthString.length-1]&&(monthString=monthString.substring(0,monthString.length-1)),month=1+["","","","","","","","","","","",""].indexOf(monthString);else{var i=monthString[monthString.length-1];isIntercalary="i"===i||"I"===i}return this.toMonthIndex(year,month,isIntercalary)},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:1,isRTL:!1}},_validateYear:function(year,error){if(year.year&&(year=year.year()),"number"!=typeof year||year<1888||year>2111)throw error.replace(/\{0\}/,this.local.name);return year},toMonthIndex:function(year,month,isIntercalary){var intercalaryMonth=this.intercalaryMonth(year);if(isIntercalary&&month!==intercalaryMonth||month<1||month>12)throw main.local.invalidMonth.replace(/\{0\}/,this.local.name);return intercalaryMonth?!isIntercalary&&month<=intercalaryMonth?month-1:month:month-1},toChineseMonth:function(year,monthIndex){year.year&&(monthIndex=(year=year.year()).month());var intercalaryMonth=this.intercalaryMonth(year);if(monthIndex<0||monthIndex>(intercalaryMonth?12:11))throw main.local.invalidMonth.replace(/\{0\}/,this.local.name);return intercalaryMonth?monthIndex<intercalaryMonth?monthIndex+1:monthIndex:monthIndex+1},intercalaryMonth:function(year){return year=this._validateYear(year),LUNAR_MONTH_DAYS[year-LUNAR_MONTH_DAYS[0]]>>13},isIntercalaryMonth:function(year,monthIndex){year.year&&(monthIndex=(year=year.year()).month());var intercalaryMonth=this.intercalaryMonth(year);return!!intercalaryMonth&&intercalaryMonth===monthIndex},leapYear:function(year){return 0!==this.intercalaryMonth(year)},weekOfYear:function(year,monthIndex,day){var firstThursday,validatedYear=this._validateYear(year,main.local.invalidyear),packedDate=CHINESE_NEW_YEAR[validatedYear-CHINESE_NEW_YEAR[0]],y=packedDate>>9&4095,m=packedDate>>5&15,d=31&packedDate;(firstThursday=gregorianCalendar.newDate(y,m,d)).add(4-(firstThursday.dayOfWeek()||7),"d");var offset=this.toJD(year,monthIndex,day)-firstThursday.toJD();return 1+Math.floor(offset/7)},monthsInYear:function(year){return this.leapYear(year)?13:12},daysInMonth:function(year,monthIndex){year.year&&(monthIndex=year.month(),year=year.year()),year=this._validateYear(year);var monthDaysTable=LUNAR_MONTH_DAYS[year-LUNAR_MONTH_DAYS[0]];if(monthIndex>(monthDaysTable>>13?12:11))throw main.local.invalidMonth.replace(/\{0\}/,this.local.name);return monthDaysTable&1<<12-monthIndex?30:29},weekDay:function(year,monthIndex,day){return(this.dayOfWeek(year,monthIndex,day)||7)<6},toJD:function(year,monthIndex,day){var date=this._validate(year,month,day,main.local.invalidDate);year=this._validateYear(date.year()),monthIndex=date.month(),day=date.day();var isIntercalary=this.isIntercalaryMonth(year,monthIndex),month=this.toChineseMonth(year,monthIndex),solar=function toSolar(yearOrDate,monthOrResult,day,isIntercalaryOrResult,result){var solarDate,lunarDate,daysFromNewYear;if("object"==typeof yearOrDate)lunarDate=yearOrDate,solarDate=monthOrResult||{};else{var isValidYear="number"==typeof yearOrDate&&yearOrDate>=1888&&yearOrDate<=2111;if(!isValidYear)throw new Error("Lunar year outside range 1888-2111");var isValidMonth="number"==typeof monthOrResult&&monthOrResult>=1&&monthOrResult<=12;if(!isValidMonth)throw new Error("Lunar month outside range 1 - 12");var isIntercalary,isValidDay="number"==typeof day&&day>=1&&day<=30;if(!isValidDay)throw new Error("Lunar day outside range 1 - 30");"object"==typeof isIntercalaryOrResult?(isIntercalary=!1,solarDate=isIntercalaryOrResult):(isIntercalary=!!isIntercalaryOrResult,solarDate=result||{}),lunarDate={year:yearOrDate,month:monthOrResult,day:day,isIntercalary:isIntercalary}}daysFromNewYear=lunarDate.day-1;var monthsFromNewYear,monthDaysTable=LUNAR_MONTH_DAYS[lunarDate.year-LUNAR_MONTH_DAYS[0]],intercalaryMonth=monthDaysTable>>13;monthsFromNewYear=intercalaryMonth?lunarDate.month>intercalaryMonth?lunarDate.month:lunarDate.isIntercalary?lunarDate.month:lunarDate.month-1:lunarDate.month-1;for(var i=0;i<monthsFromNewYear;i++){var daysInMonth=monthDaysTable&1<<12-i?30:29;daysFromNewYear+=daysInMonth}var packedDate=CHINESE_NEW_YEAR[lunarDate.year-CHINESE_NEW_YEAR[0]],jsDate=new Date(packedDate>>9&4095,(packedDate>>5&15)-1,(31&packedDate)+daysFromNewYear);return solarDate.year=jsDate.getFullYear(),solarDate.month=1+jsDate.getMonth(),solarDate.day=jsDate.getDate(),solarDate}(year,month,day,isIntercalary);return gregorianCalendar.toJD(solar.year,solar.month,solar.day)},fromJD:function(jd){var date=gregorianCalendar.fromJD(jd),lunar=function toLunar(yearOrDate,monthOrResult,day,result){var solarDate,lunarDate;if("object"==typeof yearOrDate)solarDate=yearOrDate,lunarDate=monthOrResult||{};else{var isValidYear="number"==typeof yearOrDate&&yearOrDate>=1888&&yearOrDate<=2111;if(!isValidYear)throw new Error("Solar year outside range 1888-2111");var isValidMonth="number"==typeof monthOrResult&&monthOrResult>=1&&monthOrResult<=12;if(!isValidMonth)throw new Error("Solar month outside range 1 - 12");var isValidDay="number"==typeof day&&day>=1&&day<=31;if(!isValidDay)throw new Error("Solar day outside range 1 - 31");solarDate={year:yearOrDate,month:monthOrResult,day:day},lunarDate=result||{}}var chineseNewYearPackedDate=CHINESE_NEW_YEAR[solarDate.year-CHINESE_NEW_YEAR[0]],packedDate=solarDate.year<<9|solarDate.month<<5|solarDate.day;lunarDate.year=packedDate>=chineseNewYearPackedDate?solarDate.year:solarDate.year-1,chineseNewYearPackedDate=CHINESE_NEW_YEAR[lunarDate.year-CHINESE_NEW_YEAR[0]];var daysFromNewYear,chineseNewYearJSDate=new Date(chineseNewYearPackedDate>>9&4095,(chineseNewYearPackedDate>>5&15)-1,31&chineseNewYearPackedDate),jsDate=new Date(solarDate.year,solarDate.month-1,solarDate.day);daysFromNewYear=Math.round((jsDate-chineseNewYearJSDate)/864e5);var i,monthDaysTable=LUNAR_MONTH_DAYS[lunarDate.year-LUNAR_MONTH_DAYS[0]];for(i=0;i<13;i++){var daysInMonth=monthDaysTable&1<<12-i?30:29;if(daysFromNewYear<daysInMonth)break;daysFromNewYear-=daysInMonth}var intercalaryMonth=monthDaysTable>>13;!intercalaryMonth||i<intercalaryMonth?(lunarDate.isIntercalary=!1,lunarDate.month=1+i):i===intercalaryMonth?(lunarDate.isIntercalary=!0,lunarDate.month=i):(lunarDate.isIntercalary=!1,lunarDate.month=i);return lunarDate.day=1+daysFromNewYear,lunarDate}(date.year(),date.month(),date.day()),monthIndex=this.toMonthIndex(lunar.year,lunar.month,lunar.isIntercalary);return this.newDate(lunar.year,monthIndex,lunar.day)},fromString:function(dateString){var match=dateString.match(DATE_REGEXP),year=this._validateYear(+match[1]),month=+match[2],isIntercalary=!!match[3],monthIndex=this.toMonthIndex(year,month,isIntercalary),day=+match[4];return this.newDate(year,monthIndex,day)},add:function(date,offset,period){var year=date.year(),monthIndex=date.month(),isIntercalary=this.isIntercalaryMonth(year,monthIndex),month=this.toChineseMonth(year,monthIndex),cdate=Object.getPrototypeOf(ChineseCalendar.prototype).add.call(this,date,offset,period);if("y"===period){var resultYear=cdate.year(),resultMonthIndex=cdate.month(),resultCanBeIntercalaryMonth=this.isIntercalaryMonth(resultYear,month),correctedMonthIndex=isIntercalary&&resultCanBeIntercalaryMonth?this.toMonthIndex(resultYear,month,!0):this.toMonthIndex(resultYear,month,!1);correctedMonthIndex!==resultMonthIndex&&cdate.month(correctedMonthIndex)}return cdate}});var DATE_REGEXP=/^\s*(-?\d\d\d\d|\d\d)[-/](\d?\d)([iI]?)[-/](\d?\d)/m,MONTH_NUMBER_REGEXP=/^\d?\d[iI]?/m,MONTH_NAME_REGEXP=/^??[]?/m,MONTH_SHORT_NAME_REGEXP=/^??[]?/m;main.calendars.chinese=ChineseCalendar;var LUNAR_MONTH_DAYS=[1887,5780,5802,19157,2742,50359,1198,2646,46378,7466,3412,30122,5482,67949,2396,5294,43597,6732,6954,36181,2772,4954,18781,2396,54427,5274,6730,47781,5800,6868,21210,4790,59703,2350,5270,46667,3402,3496,38325,1388,4782,18735,2350,52374,6804,7498,44457,2906,1388,29294,4700,63789,6442,6804,56138,5802,2772,38235,1210,4698,22827,5418,63125,3476,5802,43701,2484,5302,27223,2646,70954,7466,3412,54698,5482,2412,38062,5294,2636,32038,6954,60245,2772,4826,43357,2394,5274,39501,6730,72357,5800,5844,53978,4790,2358,38039,5270,87627,3402,3496,54708,5484,4782,43311,2350,3222,27978,7498,68965,2904,5484,45677,4700,6444,39573,6804,6986,19285,2772,62811,1210,4698,47403,5418,5780,38570,5546,76469,2420,5302,51799,2646,5414,36501,3412,5546,18869,2412,54446,5276,6732,48422,6822,2900,28010,4826,92509,2394,5274,55883,6730,6820,47956,5812,2778,18779,2358,62615,5270,5450,46757,3492,5556,27318,4718,67887,2350,3222,52554,7498,3428,38252,5468,4700,31022,6444,64149,6804,6986,43861,2772,5338,35421,2650,70955,5418,5780,54954,5546,2740,38074,5302,2646,29991,3366,61011,3412,5546,43445,2412,5294,35406,6732,72998,6820,6996,52586,2778,2396,38045,5274,6698,23333,6820,64338,5812,2746,43355,2358,5270,39499,5450,79525,3492,5548],CHINESE_NEW_YEAR=[1887,966732,967231,967733,968265,968766,969297,969798,970298,970829,971330,971830,972362,972863,973395,973896,974397,974928,975428,975929,976461,976962,977462,977994,978494,979026,979526,980026,980558,981059,981559,982091,982593,983124,983624,984124,984656,985157,985656,986189,986690,987191,987722,988222,988753,989254,989754,990286,990788,991288,991819,992319,992851,993352,993851,994383,994885,995385,995917,996418,996918,997450,997949,998481,998982,999483,1000014,1000515,1001016,1001548,1002047,1002578,1003080,1003580,1004111,1004613,1005113,1005645,1006146,1006645,1007177,1007678,1008209,1008710,1009211,1009743,1010243,1010743,1011275,1011775,1012306,1012807,1013308,1013840,1014341,1014841,1015373,1015874,1016404,1016905,1017405,1017937,1018438,1018939,1019471,1019972,1020471,1021002,1021503,1022035,1022535,1023036,1023568,1024069,1024568,1025100,1025601,1026102,1026633,1027133,1027666,1028167,1028666,1029198,1029699,1030199,1030730,1031231,1031763,1032264,1032764,1033296,1033797,1034297,1034828,1035329,1035830,1036362,1036861,1037393,1037894,1038394,1038925,1039427,1039927,1040459,1040959,1041491,1041992,1042492,1043023,1043524,1044024,1044556,1045057,1045558,1046090,1046590,1047121,1047622,1048122,1048654,1049154,1049655,1050187,1050689,1051219,1051720,1052220,1052751,1053252,1053752,1054284,1054786,1055285,1055817,1056317,1056849,1057349,1057850,1058382,1058883,1059383,1059915,1060415,1060947,1061447,1061947,1062479,1062981,1063480,1064012,1064514,1065014,1065545,1066045,1066577,1067078,1067578,1068110,1068611,1069112,1069642,1070142,1070674,1071175,1071675,1072207,1072709,1073209,1073740,1074241,1074741,1075273,1075773,1076305,1076807,1077308,1077839,1078340,1078840,1079372,1079871,1080403,1080904]},{"../main":545,"object-assign":434}],532:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function CopticCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}CopticCalendar.prototype=new main.baseCalendar,assign(CopticCalendar.prototype,{name:"Coptic",jdEpoch:1825029.5,daysPerMonth:[30,30,30,30,30,30,30,30,30,30,30,30,5],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Coptic",epochs:["BAM","AM"],monthNames:["Thout","Paopi","Hathor","Koiak","Tobi","Meshir","Paremhat","Paremoude","Pashons","Paoni","Epip","Mesori","Pi Kogi Enavot"],monthNamesShort:["Tho","Pao","Hath","Koi","Tob","Mesh","Pat","Pad","Pash","Pao","Epi","Meso","PiK"],dayNames:["Tkyriaka","Pesnau","Pshoment","Peftoou","Ptiou","Psoou","Psabbaton"],dayNamesShort:["Tky","Pes","Psh","Pef","Pti","Pso","Psa"],dayNamesMin:["Tk","Pes","Psh","Pef","Pt","Pso","Psa"],digits:null,dateFormat:"dd/mm/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return(year=date.year()+(date.year()<0?1:0))%4==3||year%4==-1},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear||main.regionalOptions[""].invalidYear),13},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(13===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return(year=date.year())<0&&year++,date.day()+30*(date.month()-1)+365*(year-1)+Math.floor(year/4)+this.jdEpoch-1},fromJD:function(jd){var c=Math.floor(jd)+.5-this.jdEpoch,year=Math.floor((c-Math.floor((c+366)/1461))/365)+1;year<=0&&year--,c=Math.floor(jd)+.5-this.newDate(year,1,1).toJD();var month=Math.floor(c/30)+1,day=c-30*(month-1)+1;return this.newDate(year,month,day)}}),main.calendars.coptic=CopticCalendar},{"../main":545,"object-assign":434}],533:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function DiscworldCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}DiscworldCalendar.prototype=new main.baseCalendar,assign(DiscworldCalendar.prototype,{name:"Discworld",jdEpoch:1721425.5,daysPerMonth:[16,32,32,32,32,32,32,32,32,32,32,32,32],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Discworld",epochs:["BUC","UC"],monthNames:["Ick","Offle","February","March","April","May","June","Grune","August","Spune","Sektober","Ember","December"],monthNamesShort:["Ick","Off","Feb","Mar","Apr","May","Jun","Gru","Aug","Spu","Sek","Emb","Dec"],dayNames:["Sunday","Octeday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Oct","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Oc","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:2,isRTL:!1}},leapYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),!1},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),13},daysInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),400},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/8)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]},daysInWeek:function(){return 8},dayOfWeek:function(year,month,day){return(this._validate(year,month,day,main.local.invalidDate).day()+1)%8},weekDay:function(year,month,day){var dow=this.dayOfWeek(year,month,day);return dow>=2&&dow<=6},extraInfo:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return{century:centuries[Math.floor((date.year()-1)/100)+1]||""}},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return year=date.year()+(date.year()<0?1:0),month=date.month(),(day=date.day())+(month>1?16:0)+(month>2?32*(month-2):0)+400*(year-1)+this.jdEpoch-1},fromJD:function(jd){jd=Math.floor(jd+.5)-Math.floor(this.jdEpoch)-1;var year=Math.floor(jd/400)+1;jd-=400*(year-1),jd+=jd>15?16:0;var month=Math.floor(jd/32)+1,day=jd-32*(month-1)+1;return this.newDate(year<=0?year-1:year,month,day)}});var centuries={20:"Fruitbat",21:"Anchovy"};main.calendars.discworld=DiscworldCalendar},{"../main":545,"object-assign":434}],534:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function EthiopianCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}EthiopianCalendar.prototype=new main.baseCalendar,assign(EthiopianCalendar.prototype,{name:"Ethiopian",jdEpoch:1724220.5,daysPerMonth:[30,30,30,30,30,30,30,30,30,30,30,30,5],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Ethiopian",epochs:["BEE","EE"],monthNames:["Meskerem","Tikemet","Hidar","Tahesas","Tir","Yekatit","Megabit","Miazia","Genbot","Sene","Hamle","Nehase","Pagume"],monthNamesShort:["Mes","Tik","Hid","Tah","Tir","Yek","Meg","Mia","Gen","Sen","Ham","Neh","Pag"],dayNames:["Ehud","Segno","Maksegno","Irob","Hamus","Arb","Kidame"],dayNamesShort:["Ehu","Seg","Mak","Iro","Ham","Arb","Kid"],dayNamesMin:["Eh","Se","Ma","Ir","Ha","Ar","Ki"],digits:null,dateFormat:"dd/mm/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return(year=date.year()+(date.year()<0?1:0))%4==3||year%4==-1},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear||main.regionalOptions[""].invalidYear),13},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(13===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return(year=date.year())<0&&year++,date.day()+30*(date.month()-1)+365*(year-1)+Math.floor(year/4)+this.jdEpoch-1},fromJD:function(jd){var c=Math.floor(jd)+.5-this.jdEpoch,year=Math.floor((c-Math.floor((c+366)/1461))/365)+1;year<=0&&year--,c=Math.floor(jd)+.5-this.newDate(year,1,1).toJD();var month=Math.floor(c/30)+1,day=c-30*(month-1)+1;return this.newDate(year,month,day)}}),main.calendars.ethiopian=EthiopianCalendar},{"../main":545,"object-assign":434}],535:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function HebrewCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}function mod(a,b){return a-b*Math.floor(a/b)}HebrewCalendar.prototype=new main.baseCalendar,assign(HebrewCalendar.prototype,{name:"Hebrew",jdEpoch:347995.5,daysPerMonth:[30,29,30,29,30,29,30,29,30,29,30,29,29],hasYearZero:!1,minMonth:1,firstMonth:7,minDay:1,regionalOptions:{"":{name:"Hebrew",epochs:["BAM","AM"],monthNames:["Nisan","Iyar","Sivan","Tammuz","Av","Elul","Tishrei","Cheshvan","Kislev","Tevet","Shevat","Adar","Adar II"],monthNamesShort:["Nis","Iya","Siv","Tam","Av","Elu","Tis","Che","Kis","Tev","She","Ada","Ad2"],dayNames:["Yom Rishon","Yom Sheni","Yom Shlishi","Yom Revi'i","Yom Chamishi","Yom Shishi","Yom Shabbat"],dayNamesShort:["Ris","She","Shl","Rev","Cha","Shi","Sha"],dayNamesMin:["Ri","She","Shl","Re","Ch","Shi","Sha"],digits:null,dateFormat:"dd/mm/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return this._leapYear(date.year())},_leapYear:function(year){return mod(7*(year=year<0?year+1:year)+1,19)<7},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),this._leapYear(year.year?year.year():year)?13:12},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInYear:function(year){return year=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear).year(),this.toJD(-1===year?1:year+1,7,1)-this.toJD(year,7,1)},daysInMonth:function(year,month){return year.year&&(month=year.month(),year=year.year()),this._validate(year,month,this.minDay,main.local.invalidMonth),12===month&&this.leapYear(year)?30:8===month&&5===mod(this.daysInYear(year),10)?30:9===month&&3===mod(this.daysInYear(year),10)?29:this.daysPerMonth[month-1]},weekDay:function(year,month,day){return 6!==this.dayOfWeek(year,month,day)},extraInfo:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return{yearType:(this.leapYear(date)?"embolismic":"common")+" "+["deficient","regular","complete"][this.daysInYear(date)%10-3]}},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);year=date.year(),month=date.month(),day=date.day();var adjYear=year<=0?year+1:year,jd=this.jdEpoch+this._delay1(adjYear)+this._delay2(adjYear)+day+1;if(month<7){for(var m=7;m<=this.monthsInYear(year);m++)jd+=this.daysInMonth(year,m);for(m=1;m<month;m++)jd+=this.daysInMonth(year,m)}else for(m=7;m<month;m++)jd+=this.daysInMonth(year,m);return jd},_delay1:function(year){var months=Math.floor((235*year-234)/19),parts=12084+13753*months,day=29*months+Math.floor(parts/25920);return mod(3*(day+1),7)<3&&day++,day},_delay2:function(year){var last=this._delay1(year-1),present=this._delay1(year);return this._delay1(year+1)-present==356?2:present-last==382?1:0},fromJD:function(jd){jd=Math.floor(jd)+.5;for(var year=Math.floor(98496*(jd-this.jdEpoch)/35975351)-1;jd>=this.toJD(-1===year?1:year+1,7,1);)year++;for(var month=jd<this.toJD(year,1,1)?7:1;jd>this.toJD(year,month,this.daysInMonth(year,month));)month++;var day=jd-this.toJD(year,month,1)+1;return this.newDate(year,month,day)}}),main.calendars.hebrew=HebrewCalendar},{"../main":545,"object-assign":434}],536:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function IslamicCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}IslamicCalendar.prototype=new main.baseCalendar,assign(IslamicCalendar.prototype,{name:"Islamic",jdEpoch:1948439.5,daysPerMonth:[30,29,30,29,30,29,30,29,30,29,30,29],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Islamic",epochs:["BH","AH"],monthNames:["Muharram","Safar","Rabi' al-awwal","Rabi' al-thani","Jumada al-awwal","Jumada al-thani","Rajab","Sha'aban","Ramadan","Shawwal","Dhu al-Qi'dah","Dhu al-Hijjah"],monthNamesShort:["Muh","Saf","Rab1","Rab2","Jum1","Jum2","Raj","Sha'","Ram","Shaw","DhuQ","DhuH"],dayNames:["Yawm al-ahad","Yawm al-ithnayn","Yawm ath-thulaathaa'","Yawm al-arbi'aa'","Yawm al-khams","Yawm al-jum'a","Yawm as-sabt"],dayNamesShort:["Aha","Ith","Thu","Arb","Kha","Jum","Sab"],dayNamesMin:["Ah","It","Th","Ar","Kh","Ju","Sa"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:6,isRTL:!1}},leapYear:function(year){return(11*this._validate(year,this.minMonth,this.minDay,main.local.invalidYear).year()+14)%30<11},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInYear:function(year){return this.leapYear(year)?355:354},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(12===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return 5!==this.dayOfWeek(year,month,day)},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return year=date.year(),month=date.month(),day=date.day(),year=year<=0?year+1:year,day+Math.ceil(29.5*(month-1))+354*(year-1)+Math.floor((3+11*year)/30)+this.jdEpoch-1},fromJD:function(jd){jd=Math.floor(jd)+.5;var year=Math.floor((30*(jd-this.jdEpoch)+10646)/10631);year=year<=0?year-1:year;var month=Math.min(12,Math.ceil((jd-29-this.toJD(year,1,1))/29.5)+1),day=jd-this.toJD(year,month,1)+1;return this.newDate(year,month,day)}}),main.calendars.islamic=IslamicCalendar},{"../main":545,"object-assign":434}],537:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function JulianCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}JulianCalendar.prototype=new main.baseCalendar,assign(JulianCalendar.prototype,{name:"Julian",jdEpoch:1721423.5,daysPerMonth:[31,28,31,30,31,30,31,31,30,31,30,31],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Julian",epochs:["BC","AD"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"mm/dd/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return(year=date.year()<0?date.year()+1:date.year())%4==0},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(4-(checkDate.dayOfWeek()||7),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(2===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return year=date.year(),month=date.month(),day=date.day(),year<0&&year++,month<=2&&(year--,month+=12),Math.floor(365.25*(year+4716))+Math.floor(30.6001*(month+1))+day-1524.5},fromJD:function(jd){var b=Math.floor(jd+.5)+1524,c=Math.floor((b-122.1)/365.25),d=Math.floor(365.25*c),e=Math.floor((b-d)/30.6001),month=e-Math.floor(e<14?1:13),year=c-Math.floor(month>2?4716:4715),day=b-d-Math.floor(30.6001*e);return year<=0&&year--,this.newDate(year,month,day)}}),main.calendars.julian=JulianCalendar},{"../main":545,"object-assign":434}],538:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function MayanCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}function mod(a,b){return a-b*Math.floor(a/b)}function amod(a,b){return mod(a-1,b)+1}MayanCalendar.prototype=new main.baseCalendar,assign(MayanCalendar.prototype,{name:"Mayan",jdEpoch:584282.5,hasYearZero:!0,minMonth:0,firstMonth:0,minDay:0,regionalOptions:{"":{name:"Mayan",epochs:["",""],monthNames:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"],monthNamesShort:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"],dayNames:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],dayNamesShort:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],dayNamesMin:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],digits:null,dateFormat:"YYYY.m.d",firstDay:0,isRTL:!1,haabMonths:["Pop","Uo","Zip","Zotz","Tzec","Xul","Yaxkin","Mol","Chen","Yax","Zac","Ceh","Mac","Kankin","Muan","Pax","Kayab","Cumku","Uayeb"],tzolkinMonths:["Imix","Ik","Akbal","Kan","Chicchan","Cimi","Manik","Lamat","Muluc","Oc","Chuen","Eb","Ben","Ix","Men","Cib","Caban","Etznab","Cauac","Ahau"]}},leapYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),!1},formatYear:function(year){year=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear).year();var baktun=Math.floor(year/400);return year%=400,year+=year<0?400:0,baktun+"."+Math.floor(year/20)+"."+year%20},forYear:function(years){if((years=years.split(".")).length<3)throw"Invalid Mayan year";for(var year=0,i=0;i<years.length;i++){var y=parseInt(years[i],10);if(Math.abs(y)>19||i>0&&y<0)throw"Invalid Mayan year";year=20*year+y}return year},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),18},weekOfYear:function(year,month,day){return this._validate(year,month,day,main.local.invalidDate),0},daysInYear:function(year){return this._validate(year,this.minMonth,this.minDay,main.local.invalidYear),360},daysInMonth:function(year,month){return this._validate(year,month,this.minDay,main.local.invalidMonth),20},daysInWeek:function(){return 5},dayOfWeek:function(year,month,day){return this._validate(year,month,day,main.local.invalidDate).day()},weekDay:function(year,month,day){return this._validate(year,month,day,main.local.invalidDate),!0},extraInfo:function(year,month,day){var jd=this._validate(year,month,day,main.local.invalidDate).toJD(),haab=this._toHaab(jd),tzolkin=this._toTzolkin(jd);return{haabMonthName:this.local.haabMonths[haab[0]-1],haabMonth:haab[0],haabDay:haab[1],tzolkinDayName:this.local.tzolkinMonths[tzolkin[0]-1],tzolkinDay:tzolkin[0],tzolkinTrecena:tzolkin[1]}},_toHaab:function(jd){var day=mod((jd-=this.jdEpoch)+8+340,365);return[Math.floor(day/20)+1,mod(day,20)]},_toTzolkin:function(jd){return[amod((jd-=this.jdEpoch)+20,20),amod(jd+4,13)]},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);return date.day()+20*date.month()+360*date.year()+this.jdEpoch},fromJD:function(jd){jd=Math.floor(jd)+.5-this.jdEpoch;var year=Math.floor(jd/360);jd%=360,jd+=jd<0?360:0;var month=Math.floor(jd/20),day=jd%20;return this.newDate(year,month,day)}}),main.calendars.mayan=MayanCalendar},{"../main":545,"object-assign":434}],539:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function NanakshahiCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}NanakshahiCalendar.prototype=new main.baseCalendar;var gregorian=main.instance("gregorian");assign(NanakshahiCalendar.prototype,{name:"Nanakshahi",jdEpoch:2257673.5,daysPerMonth:[31,31,31,31,31,30,30,30,30,30,30,30],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Nanakshahi",epochs:["BN","AN"],monthNames:["Chet","Vaisakh","Jeth","Harh","Sawan","Bhadon","Assu","Katak","Maghar","Poh","Magh","Phagun"],monthNamesShort:["Che","Vai","Jet","Har","Saw","Bha","Ass","Kat","Mgr","Poh","Mgh","Pha"],dayNames:["Somvaar","Mangalvar","Budhvaar","Veervaar","Shukarvaar","Sanicharvaar","Etvaar"],dayNamesShort:["Som","Mangal","Budh","Veer","Shukar","Sanichar","Et"],dayNamesMin:["So","Ma","Bu","Ve","Sh","Sa","Et"],digits:null,dateFormat:"dd-mm-yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear||main.regionalOptions[""].invalidYear);return gregorian.leapYear(date.year()+(date.year()<1?1:0)+1469)},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(1-(checkDate.dayOfWeek()||7),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(12===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidMonth);(year=date.year())<0&&year++;for(var doy=date.day(),m=1;m<date.month();m++)doy+=this.daysPerMonth[m-1];return doy+gregorian.toJD(year+1468,3,13)},fromJD:function(jd){jd=Math.floor(jd+.5);for(var year=Math.floor((jd-(this.jdEpoch-1))/366);jd>=this.toJD(year+1,1,1);)year++;for(var day=jd-Math.floor(this.toJD(year,1,1)+.5)+1,month=1;day>this.daysInMonth(year,month);)day-=this.daysInMonth(year,month),month++;return this.newDate(year,month,day)}}),main.calendars.nanakshahi=NanakshahiCalendar},{"../main":545,"object-assign":434}],540:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function NepaliCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}NepaliCalendar.prototype=new main.baseCalendar,assign(NepaliCalendar.prototype,{name:"Nepali",jdEpoch:1700709.5,daysPerMonth:[31,31,32,32,31,30,30,29,30,29,30,30],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,daysPerYear:365,regionalOptions:{"":{name:"Nepali",epochs:["BBS","ABS"],monthNames:["Baisakh","Jestha","Ashadh","Shrawan","Bhadra","Ashwin","Kartik","Mangsir","Paush","Mangh","Falgun","Chaitra"],monthNamesShort:["Bai","Je","As","Shra","Bha","Ash","Kar","Mang","Pau","Ma","Fal","Chai"],dayNames:["Aaitabaar","Sombaar","Manglbaar","Budhabaar","Bihibaar","Shukrabaar","Shanibaar"],dayNamesShort:["Aaita","Som","Mangl","Budha","Bihi","Shukra","Shani"],dayNamesMin:["Aai","So","Man","Bu","Bi","Shu","Sha"],digits:null,dateFormat:"dd/mm/yyyy",firstDay:1,isRTL:!1}},leapYear:function(year){return this.daysInYear(year)!==this.daysPerYear},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInYear:function(year){if(year=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear).year(),void 0===this.NEPALI_CALENDAR_DATA[year])return this.daysPerYear;for(var daysPerYear=0,month_number=this.minMonth;month_number<=12;month_number++)daysPerYear+=this.NEPALI_CALENDAR_DATA[year][month_number];return daysPerYear},daysInMonth:function(year,month){return year.year&&(month=year.month(),year=year.year()),this._validate(year,month,this.minDay,main.local.invalidMonth),void 0===this.NEPALI_CALENDAR_DATA[year]?this.daysPerMonth[month-1]:this.NEPALI_CALENDAR_DATA[year][month]},weekDay:function(year,month,day){return 6!==this.dayOfWeek(year,month,day)},toJD:function(nepaliYear,nepaliMonth,nepaliDay){var date=this._validate(nepaliYear,nepaliMonth,nepaliDay,main.local.invalidDate);nepaliYear=date.year(),nepaliMonth=date.month(),nepaliDay=date.day();var gregorianCalendar=main.instance(),gregorianDayOfYear=0,nepaliMonthToCheck=nepaliMonth,nepaliYearToCheck=nepaliYear;this._createMissingCalendarData(nepaliYear);var gregorianYear=nepaliYear-(nepaliMonthToCheck>9||9===nepaliMonthToCheck&&nepaliDay>=this.NEPALI_CALENDAR_DATA[nepaliYearToCheck][0]?56:57);for(9!==nepaliMonth&&(gregorianDayOfYear=nepaliDay,nepaliMonthToCheck--);9!==nepaliMonthToCheck;)nepaliMonthToCheck<=0&&(nepaliMonthToCheck=12,nepaliYearToCheck--),gregorianDayOfYear+=this.NEPALI_CALENDAR_DATA[nepaliYearToCheck][nepaliMonthToCheck],nepaliMonthToCheck--;return 9===nepaliMonth?(gregorianDayOfYear+=nepaliDay-this.NEPALI_CALENDAR_DATA[nepaliYearToCheck][0])<0&&(gregorianDayOfYear+=gregorianCalendar.daysInYear(gregorianYear)):gregorianDayOfYear+=this.NEPALI_CALENDAR_DATA[nepaliYearToCheck][9]-this.NEPALI_CALENDAR_DATA[nepaliYearToCheck][0],gregorianCalendar.newDate(gregorianYear,1,1).add(gregorianDayOfYear,"d").toJD()},fromJD:function(jd){var gregorianDate=main.instance().fromJD(jd),gregorianYear=gregorianDate.year(),gregorianDayOfYear=gregorianDate.dayOfYear(),nepaliYear=gregorianYear+56;this._createMissingCalendarData(nepaliYear);for(var nepaliMonth=9,dayOfFirstJanInPaush=this.NEPALI_CALENDAR_DATA[nepaliYear][0],daysSinceJanFirstToEndOfNepaliMonth=this.NEPALI_CALENDAR_DATA[nepaliYear][nepaliMonth]-dayOfFirstJanInPaush+1;gregorianDayOfYear>daysSinceJanFirstToEndOfNepaliMonth;)++nepaliMonth>12&&(nepaliMonth=1,nepaliYear++),daysSinceJanFirstToEndOfNepaliMonth+=this.NEPALI_CALENDAR_DATA[nepaliYear][nepaliMonth];var nepaliDayOfMonth=this.NEPALI_CALENDAR_DATA[nepaliYear][nepaliMonth]-(daysSinceJanFirstToEndOfNepaliMonth-gregorianDayOfYear);return this.newDate(nepaliYear,nepaliMonth,nepaliDayOfMonth)},_createMissingCalendarData:function(nepaliYear){var tmp_calendar_data=this.daysPerMonth.slice(0);tmp_calendar_data.unshift(17);for(var nepaliYearToCreate=nepaliYear-1;nepaliYearToCreate<nepaliYear+2;nepaliYearToCreate++)void 0===this.NEPALI_CALENDAR_DATA[nepaliYearToCreate]&&(this.NEPALI_CALENDAR_DATA[nepaliYearToCreate]=tmp_calendar_data)},NEPALI_CALENDAR_DATA:{1970:[18,31,31,32,31,31,31,30,29,30,29,30,30],1971:[18,31,31,32,31,32,30,30,29,30,29,30,30],1972:[17,31,32,31,32,31,30,30,30,29,29,30,30],1973:[19,30,32,31,32,31,30,30,30,29,30,29,31],1974:[19,31,31,32,30,31,31,30,29,30,29,30,30],1975:[18,31,31,32,32,30,31,30,29,30,29,30,30],1976:[17,31,32,31,32,31,30,30,30,29,29,30,31],1977:[18,31,32,31,32,31,31,29,30,29,30,29,31],1978:[18,31,31,32,31,31,31,30,29,30,29,30,30],1979:[18,31,31,32,32,31,30,30,29,30,29,30,30],1980:[17,31,32,31,32,31,30,30,30,29,29,30,31],1981:[18,31,31,31,32,31,31,29,30,30,29,30,30],1982:[18,31,31,32,31,31,31,30,29,30,29,30,30],1983:[18,31,31,32,32,31,30,30,29,30,29,30,30],1984:[17,31,32,31,32,31,30,30,30,29,29,30,31],1985:[18,31,31,31,32,31,31,29,30,30,29,30,30],1986:[18,31,31,32,31,31,31,30,29,30,29,30,30],1987:[18,31,32,31,32,31,30,30,29,30,29,30,30],1988:[17,31,32,31,32,31,30,30,30,29,29,30,31],1989:[18,31,31,31,32,31,31,30,29,30,29,30,30],1990:[18,31,31,32,31,31,31,30,29,30,29,30,30],1991:[18,31,32,31,32,31,30,30,29,30,29,30,30],1992:[17,31,32,31,32,31,30,30,30,29,30,29,31],1993:[18,31,31,31,32,31,31,30,29,30,29,30,30],1994:[18,31,31,32,31,31,31,30,29,30,29,30,30],1995:[17,31,32,31,32,31,30,30,30,29,29,30,30],1996:[17,31,32,31,32,31,30,30,30,29,30,29,31],1997:[18,31,31,32,31,31,31,30,29,30,29,30,30],1998:[18,31,31,32,31,31,31,30,29,30,29,30,30],1999:[17,31,32,31,32,31,30,30,30,29,29,30,31],2000:[17,30,32,31,32,31,30,30,30,29,30,29,31],2001:[18,31,31,32,31,31,31,30,29,30,29,30,30],2002:[18,31,31,32,32,31,30,30,29,30,29,30,30],2003:[17,31,32,31,32,31,30,30,30,29,29,30,31],2004:[17,30,32,31,32,31,30,30,30,29,30,29,31],2005:[18,31,31,32,31,31,31,30,29,30,29,30,30],2006:[18,31,31,32,32,31,30,30,29,30,29,30,30],2007:[17,31,32,31,32,31,30,30,30,29,29,30,31],2008:[17,31,31,31,32,31,31,29,30,30,29,29,31],2009:[18,31,31,32,31,31,31,30,29,30,29,30,30],2010:[18,31,31,32,32,31,30,30,29,30,29,30,30],2011:[17,31,32,31,32,31,30,30,30,29,29,30,31],2012:[17,31,31,31,32,31,31,29,30,30,29,30,30],2013:[18,31,31,32,31,31,31,30,29,30,29,30,30],2014:[18,31,31,32,32,31,30,30,29,30,29,30,30],2015:[17,31,32,31,32,31,30,30,30,29,29,30,31],2016:[17,31,31,31,32,31,31,29,30,30,29,30,30],2017:[18,31,31,32,31,31,31,30,29,30,29,30,30],2018:[18,31,32,31,32,31,30,30,29,30,29,30,30],2019:[17,31,32,31,32,31,30,30,30,29,30,29,31],2020:[17,31,31,31,32,31,31,30,29,30,29,30,30],2021:[18,31,31,32,31,31,31,30,29,30,29,30,30],2022:[17,31,32,31,32,31,30,30,30,29,29,30,30],2023:[17,31,32,31,32,31,30,30,30,29,30,29,31],2024:[17,31,31,31,32,31,31,30,29,30,29,30,30],2025:[18,31,31,32,31,31,31,30,29,30,29,30,30],2026:[17,31,32,31,32,31,30,30,30,29,29,30,31],2027:[17,30,32,31,32,31,30,30,30,29,30,29,31],2028:[17,31,31,32,31,31,31,30,29,30,29,30,30],2029:[18,31,31,32,31,32,30,30,29,30,29,30,30],2030:[17,31,32,31,32,31,30,30,30,30,30,30,31],2031:[17,31,32,31,32,31,31,31,31,31,31,31,31],2032:[17,32,32,32,32,32,32,32,32,32,32,32,32],2033:[18,31,31,32,32,31,30,30,29,30,29,30,30],2034:[17,31,32,31,32,31,30,30,30,29,29,30,31],2035:[17,30,32,31,32,31,31,29,30,30,29,29,31],2036:[17,31,31,32,31,31,31,30,29,30,29,30,30],2037:[18,31,31,32,32,31,30,30,29,30,29,30,30],2038:[17,31,32,31,32,31,30,30,30,29,29,30,31],2039:[17,31,31,31,32,31,31,29,30,30,29,30,30],2040:[17,31,31,32,31,31,31,30,29,30,29,30,30],2041:[18,31,31,32,32,31,30,30,29,30,29,30,30],2042:[17,31,32,31,32,31,30,30,30,29,29,30,31],2043:[17,31,31,31,32,31,31,29,30,30,29,30,30],2044:[17,31,31,32,31,31,31,30,29,30,29,30,30],2045:[18,31,32,31,32,31,30,30,29,30,29,30,30],2046:[17,31,32,31,32,31,30,30,30,29,29,30,31],2047:[17,31,31,31,32,31,31,30,29,30,29,30,30],2048:[17,31,31,32,31,31,31,30,29,30,29,30,30],2049:[17,31,32,31,32,31,30,30,30,29,29,30,30],2050:[17,31,32,31,32,31,30,30,30,29,30,29,31],2051:[17,31,31,31,32,31,31,30,29,30,29,30,30],2052:[17,31,31,32,31,31,31,30,29,30,29,30,30],2053:[17,31,32,31,32,31,30,30,30,29,29,30,30],2054:[17,31,32,31,32,31,30,30,30,29,30,29,31],2055:[17,31,31,32,31,31,31,30,29,30,30,29,30],2056:[17,31,31,32,31,32,30,30,29,30,29,30,30],2057:[17,31,32,31,32,31,30,30,30,29,29,30,31],2058:[17,30,32,31,32,31,30,30,30,29,30,29,31],2059:[17,31,31,32,31,31,31,30,29,30,29,30,30],2060:[17,31,31,32,32,31,30,30,29,30,29,30,30],2061:[17,31,32,31,32,31,30,30,30,29,29,30,31],2062:[17,30,32,31,32,31,31,29,30,29,30,29,31],2063:[17,31,31,32,31,31,31,30,29,30,29,30,30],2064:[17,31,31,32,32,31,30,30,29,30,29,30,30],2065:[17,31,32,31,32,31,30,30,30,29,29,30,31],2066:[17,31,31,31,32,31,31,29,30,30,29,29,31],2067:[17,31,31,32,31,31,31,30,29,30,29,30,30],2068:[17,31,31,32,32,31,30,30,29,30,29,30,30],2069:[17,31,32,31,32,31,30,30,30,29,29,30,31],2070:[17,31,31,31,32,31,31,29,30,30,29,30,30],2071:[17,31,31,32,31,31,31,30,29,30,29,30,30],2072:[17,31,32,31,32,31,30,30,29,30,29,30,30],2073:[17,31,32,31,32,31,30,30,30,29,29,30,31],2074:[17,31,31,31,32,31,31,30,29,30,29,30,30],2075:[17,31,31,32,31,31,31,30,29,30,29,30,30],2076:[16,31,32,31,32,31,30,30,30,29,29,30,30],2077:[17,31,32,31,32,31,30,30,30,29,30,29,31],2078:[17,31,31,31,32,31,31,30,29,30,29,30,30],2079:[17,31,31,32,31,31,31,30,29,30,29,30,30],2080:[16,31,32,31,32,31,30,30,30,29,29,30,30],2081:[17,31,31,32,32,31,30,30,30,29,30,30,30],2082:[17,31,32,31,32,31,30,30,30,29,30,30,30],2083:[17,31,31,32,31,31,30,30,30,29,30,30,30],2084:[17,31,31,32,31,31,30,30,30,29,30,30,30],2085:[17,31,32,31,32,31,31,30,30,29,30,30,30],2086:[17,31,32,31,32,31,30,30,30,29,30,30,30],2087:[16,31,31,32,31,31,31,30,30,29,30,30,30],2088:[16,30,31,32,32,30,31,30,30,29,30,30,30],2089:[17,31,32,31,32,31,30,30,30,29,30,30,30],2090:[17,31,32,31,32,31,30,30,30,29,30,30,30],2091:[16,31,31,32,31,31,31,30,30,29,30,30,30],2092:[16,31,31,32,32,31,30,30,30,29,30,30,30],2093:[17,31,32,31,32,31,30,30,30,29,30,30,30],2094:[17,31,31,32,31,31,30,30,30,29,30,30,30],2095:[17,31,31,32,31,31,31,30,29,30,30,30,30],2096:[17,30,31,32,32,31,30,30,29,30,29,30,30],2097:[17,31,32,31,32,31,30,30,30,29,30,30,30],2098:[17,31,31,32,31,31,31,29,30,29,30,30,31],2099:[17,31,31,32,31,31,31,30,29,29,30,30,30],2100:[17,31,32,31,32,30,31,30,29,30,29,30,30]}}),main.calendars.nepali=NepaliCalendar},{"../main":545,"object-assign":434}],541:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function PersianCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}function mod(a,b){return a-b*Math.floor(a/b)}PersianCalendar.prototype=new main.baseCalendar,assign(PersianCalendar.prototype,{name:"Persian",jdEpoch:1948320.5,daysPerMonth:[31,31,31,31,31,31,30,30,30,30,30,29],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Persian",epochs:["BP","AP"],monthNames:["Farvardin","Ordibehesht","Khordad","Tir","Mordad","Shahrivar","Mehr","Aban","Azar","Day","Bahman","Esfand"],monthNamesShort:["Far","Ord","Kho","Tir","Mor","Sha","Meh","Aba","Aza","Day","Bah","Esf"],dayNames:["Yekshambe","Doshambe","Seshambe","Chharshambe","Panjshambe","Jom'e","Shambe"],dayNamesShort:["Yek","Do","Se","Ch","Panj","Jom","Sha"],dayNamesMin:["Ye","Do","Se","Ch","Pa","Jo","Sh"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:6,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return 682*((date.year()-(date.year()>0?474:473))%2820+474+38)%2816<682},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-(checkDate.dayOfWeek()+1)%7,"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(12===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return 5!==this.dayOfWeek(year,month,day)},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);year=date.year(),month=date.month(),day=date.day();var epBase=year-(year>=0?474:473),epYear=474+mod(epBase,2820);return day+(month<=7?31*(month-1):30*(month-1)+6)+Math.floor((682*epYear-110)/2816)+365*(epYear-1)+1029983*Math.floor(epBase/2820)+this.jdEpoch-1},fromJD:function(jd){var depoch=(jd=Math.floor(jd)+.5)-this.toJD(475,1,1),cycle=Math.floor(depoch/1029983),cyear=mod(depoch,1029983),ycycle=2820;if(1029982!==cyear){var aux1=Math.floor(cyear/366),aux2=mod(cyear,366);ycycle=Math.floor((2134*aux1+2816*aux2+2815)/1028522)+aux1+1}var year=ycycle+2820*cycle+474;year=year<=0?year-1:year;var yday=jd-this.toJD(year,1,1)+1,month=yday<=186?Math.ceil(yday/31):Math.ceil((yday-6)/30),day=jd-this.toJD(year,month,1)+1;return this.newDate(year,month,day)}}),main.calendars.persian=PersianCalendar,main.calendars.jalali=PersianCalendar},{"../main":545,"object-assign":434}],542:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign"),gregorianCalendar=main.instance();function TaiwanCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}TaiwanCalendar.prototype=new main.baseCalendar,assign(TaiwanCalendar.prototype,{name:"Taiwan",jdEpoch:2419402.5,yearsOffset:1911,daysPerMonth:[31,28,31,30,31,30,31,31,30,31,30,31],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Taiwan",epochs:["BROC","ROC"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:1,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);year=this._t2gYear(date.year());return gregorianCalendar.leapYear(year)},weekOfYear:function(year,month,day){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);year=this._t2gYear(date.year());return gregorianCalendar.weekOfYear(year,date.month(),date.day())},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(2===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);year=this._t2gYear(date.year());return gregorianCalendar.toJD(year,date.month(),date.day())},fromJD:function(jd){var date=gregorianCalendar.fromJD(jd),year=this._g2tYear(date.year());return this.newDate(year,date.month(),date.day())},_t2gYear:function(year){return year+this.yearsOffset+(year>=-this.yearsOffset&&year<=-1?1:0)},_g2tYear:function(year){return year-this.yearsOffset-(year>=1&&year<=this.yearsOffset?1:0)}}),main.calendars.taiwan=TaiwanCalendar},{"../main":545,"object-assign":434}],543:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign"),gregorianCalendar=main.instance();function ThaiCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}ThaiCalendar.prototype=new main.baseCalendar,assign(ThaiCalendar.prototype,{name:"Thai",jdEpoch:1523098.5,yearsOffset:543,daysPerMonth:[31,28,31,30,31,30,31,31,30,31,30,31],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Thai",epochs:["BBE","BE"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"dd/mm/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);year=this._t2gYear(date.year());return gregorianCalendar.leapYear(year)},weekOfYear:function(year,month,day){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);year=this._t2gYear(date.year());return gregorianCalendar.weekOfYear(year,date.month(),date.day())},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,main.local.invalidMonth);return this.daysPerMonth[date.month()-1]+(2===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate);year=this._t2gYear(date.year());return gregorianCalendar.toJD(year,date.month(),date.day())},fromJD:function(jd){var date=gregorianCalendar.fromJD(jd),year=this._g2tYear(date.year());return this.newDate(year,date.month(),date.day())},_t2gYear:function(year){return year-this.yearsOffset-(year>=1&&year<=this.yearsOffset?1:0)},_g2tYear:function(year){return year+this.yearsOffset+(year>=-this.yearsOffset&&year<=-1?1:0)}}),main.calendars.thai=ThaiCalendar},{"../main":545,"object-assign":434}],544:[function(_dereq_,module,exports){var main=_dereq_("../main"),assign=_dereq_("object-assign");function UmmAlQuraCalendar(language){this.local=this.regionalOptions[language||""]||this.regionalOptions[""]}UmmAlQuraCalendar.prototype=new main.baseCalendar,assign(UmmAlQuraCalendar.prototype,{name:"UmmAlQura",hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Umm al-Qura",epochs:["BH","AH"],monthNames:["Al-Muharram","Safar","Rabi' al-awwal","Rabi' Al-Thani","Jumada Al-Awwal","Jumada Al-Thani","Rajab","Sha'aban","Ramadan","Shawwal","Dhu al-Qi'dah","Dhu al-Hijjah"],monthNamesShort:["Muh","Saf","Rab1","Rab2","Jum1","Jum2","Raj","Sha'","Ram","Shaw","DhuQ","DhuH"],dayNames:["Yawm al-Ahad","Yawm al-Ithnain","Yawm al-Thalth","Yawm al-Arba","Yawm al-Khams","Yawm al-Juma","Yawm al-Sabt"],dayNamesMin:["Ah","Ith","Th","Ar","Kh","Ju","Sa"],digits:null,dateFormat:"yyyy/mm/dd",firstDay:6,isRTL:!0}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,main.local.invalidYear);return 355===this.daysInYear(date.year())},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(-checkDate.dayOfWeek(),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInYear:function(year){for(var daysCount=0,i=1;i<=12;i++)daysCount+=this.daysInMonth(year,i);return daysCount},daysInMonth:function(year,month){for(var mcjdn=this._validate(year,month,this.minDay,main.local.invalidMonth).toJD()-24e5+.5,index=0,i=0;i<ummalqura_dat.length;i++){if(ummalqura_dat[i]>mcjdn)return ummalqura_dat[index]-ummalqura_dat[index-1];index++}return 30},weekDay:function(year,month,day){return 5!==this.dayOfWeek(year,month,day)},toJD:function(year,month,day){var date=this._validate(year,month,day,main.local.invalidDate),index=12*(date.year()-1)+date.month()-15292;return date.day()+ummalqura_dat[index-1]-1+24e5-.5},fromJD:function(jd){for(var mcjdn=jd-24e5+.5,index=0,i=0;i<ummalqura_dat.length&&!(ummalqura_dat[i]>mcjdn);i++)index++;var lunation=index+15292,ii=Math.floor((lunation-1)/12),year=ii+1,month=lunation-12*ii,day=mcjdn-ummalqura_dat[index-1]+1;return this.newDate(year,month,day)},isValid:function(year,month,day){var valid=main.baseCalendar.prototype.isValid.apply(this,arguments);return valid&&(valid=(year=null!=year.year?year.year:year)>=1276&&year<=1500),valid},_validate:function(year,month,day,error){var date=main.baseCalendar.prototype._validate.apply(this,arguments);if(date.year<1276||date.year>1500)throw error.replace(/\{0\}/,this.local.name);return date}}),main.calendars.ummalqura=UmmAlQuraCalendar;var ummalqura_dat=[20,50,79,109,138,168,197,227,256,286,315,345,374,404,433,463,492,522,551,581,611,641,670,700,729,759,788,818,847,877,906,936,965,995,1024,1054,1083,1113,1142,1172,1201,1231,1260,1290,1320,1350,1379,1409,1438,1468,1497,1527,1556,1586,1615,1645,1674,1704,1733,1763,1792,1822,1851,1881,1910,1940,1969,1999,2028,2058,2087,2117,2146,2176,2205,2235,2264,2294,2323,2353,2383,2413,2442,2472,2501,2531,2560,2590,2619,2649,2678,2708,2737,2767,2796,2826,2855,2885,2914,2944,2973,3003,3032,3062,3091,3121,3150,3180,3209,3239,3268,3298,3327,3357,3386,3416,3446,3476,3505,3535,3564,3594,3623,3653,3682,3712,3741,3771,3800,3830,3859,3889,3918,3948,3977,4007,4036,4066,4095,4125,4155,4185,4214,4244,4273,4303,4332,4362,4391,4421,4450,4480,4509,4539,4568,4598,4627,4657,4686,4716,4745,4775,4804,4834,4863,4893,4922,4952,4981,5011,5040,5070,5099,5129,5158,5188,5218,5248,5277,5307,5336,5366,5395,5425,5454,5484,5513,5543,5572,5602,5631,5661,5690,5720,5749,5779,5808,5838,5867,5897,5926,5956,5985,6015,6044,6074,6103,6133,6162,6192,6221,6251,6281,6311,6340,6370,6399,6429,6458,6488,6517,6547,6576,6606,6635,6665,6694,6724,6753,6783,6812,6842,6871,6901,6930,6960,6989,7019,7048,7078,7107,7137,7166,7196,7225,7255,7284,7314,7344,7374,7403,7433,7462,7492,7521,7551,7580,7610,7639,7669,7698,7728,7757,7787,7816,7846,7875,7905,7934,7964,7993,8023,8053,8083,8112,8142,8171,8201,8230,8260,8289,8319,8348,8378,8407,8437,8466,8496,8525,8555,8584,8614,8643,8673,8702,8732,8761,8791,8821,8850,8880,8909,8938,8968,8997,9027,9056,9086,9115,9145,9175,9205,9234,9264,9293,9322,9352,9381,9410,9440,9470,9499,9529,9559,9589,9618,9648,9677,9706,9736,9765,9794,9824,9853,9883,9913,9943,9972,10002,10032,10061,10090,10120,10149,10178,10208,10237,10267,10297,10326,10356,10386,10415,10445,10474,10504,10533,10562,10592,10621,10651,10680,10710,10740,10770,10799,10829,10858,10888,10917,10947,10976,11005,11035,11064,11094,11124,11153,11183,11213,11242,11272,11301,11331,11360,11389,11419,11448,11478,11507,11537,11567,11596,11626,11655,11685,11715,11744,11774,11803,11832,11862,11891,11921,11950,11980,12010,12039,12069,12099,12128,12158,12187,12216,12246,12275,12304,12334,12364,12393,12423,12453,12483,12512,12542,12571,12600,12630,12659,12688,12718,12747,12777,12807,12837,12866,12896,12926,12955,12984,13014,13043,13072,13102,13131,13161,13191,13220,13250,13280,13310,13339,13368,13398,13427,13456,13486,13515,13545,13574,13604,13634,13664,13693,13723,13752,13782,13811,13840,13870,13899,13929,13958,13988,14018,14047,14077,14107,14136,14166,14195,14224,14254,14283,14313,14342,14372,14401,14431,14461,14490,14520,14550,14579,14609,14638,14667,14697,14726,14756,14785,14815,14844,14874,14904,14933,14963,14993,15021,15051,15081,15110,15140,15169,15199,15228,15258,15287,15317,15347,15377,15406,15436,15465,15494,15524,15553,15582,15612,15641,15671,15701,15731,15760,15790,15820,15849,15878,15908,15937,15966,15996,16025,16055,16085,16114,16144,16174,16204,16233,16262,16292,16321,16350,16380,16409,16439,16468,16498,16528,16558,16587,16617,16646,16676,16705,16734,16764,16793,16823,16852,16882,16912,16941,16971,17001,17030,17060,17089,17118,17148,17177,17207,17236,17266,17295,17325,17355,17384,17414,17444,17473,17502,17532,17561,17591,17620,17650,17679,17709,17738,17768,17798,17827,17857,17886,17916,17945,17975,18004,18034,18063,18093,18122,18152,18181,18211,18241,18270,18300,18330,18359,18388,18418,18447,18476,18506,18535,18565,18595,18625,18654,18684,18714,18743,18772,18802,18831,18860,18890,18919,18949,18979,19008,19038,19068,19098,19127,19156,19186,19215,19244,19274,19303,19333,19362,19392,19422,19452,19481,19511,19540,19570,19599,19628,19658,19687,19717,19746,19776,19806,19836,19865,19895,19924,19954,19983,20012,20042,20071,20101,20130,20160,20190,20219,20249,20279,20308,20338,20367,20396,20426,20455,20485,20514,20544,20573,20603,20633,20662,20692,20721,20751,20780,20810,20839,20869,20898,20928,20957,20987,21016,21046,21076,21105,21135,21164,21194,21223,21253,21282,21312,21341,21371,21400,21430,21459,21489,21519,21548,21578,21607,21637,21666,21696,21725,21754,21784,21813,21843,21873,21902,21932,21962,21991,22021,22050,22080,22109,22138,22168,22197,22227,22256,22286,22316,22346,22375,22405,22434,22464,22493,22522,22552,22581,22611,22640,22670,22700,22730,22759,22789,22818,22848,22877,22906,22936,22965,22994,23024,23054,23083,23113,23143,23173,23202,23232,23261,23290,23320,23349,23379,23408,23438,23467,23497,23527,23556,23586,23616,23645,23674,23704,23733,23763,23792,23822,23851,23881,23910,23940,23970,23999,24029,24058,24088,24117,24147,24176,24206,24235,24265,24294,24324,24353,24383,24413,24442,24472,24501,24531,24560,24590,24619,24648,24678,24707,24737,24767,24796,24826,24856,24885,24915,24944,24974,25003,25032,25062,25091,25121,25150,25180,25210,25240,25269,25299,25328,25358,25387,25416,25446,25475,25505,25534,25564,25594,25624,25653,25683,25712,25742,25771,25800,25830,25859,25888,25918,25948,25977,26007,26037,26067,26096,26126,26155,26184,26214,26243,26272,26302,26332,26361,26391,26421,26451,26480,26510,26539,26568,26598,26627,26656,26686,26715,26745,26775,26805,26834,26864,26893,26923,26952,26982,27011,27041,27070,27099,27129,27159,27188,27218,27248,27277,27307,27336,27366,27395,27425,27454,27484,27513,27542,27572,27602,27631,27661,27691,27720,27750,27779,27809,27838,27868,27897,27926,27956,27985,28015,28045,28074,28104,28134,28163,28193,28222,28252,28281,28310,28340,28369,28399,28428,28458,28488,28517,28547,28577,28607,28636,28665,28695,28724,28754,28783,28813,28843,28872,28901,28931,28960,28990,29019,29049,29078,29108,29137,29167,29196,29226,29255,29285,29315,29345,29375,29404,29434,29463,29492,29522,29551,29580,29610,29640,29669,29699,29729,29759,29788,29818,29847,29876,29906,29935,29964,29994,30023,30053,30082,30112,30141,30171,30200,30230,30259,30289,30318,30348,30378,30408,30437,30467,30496,30526,30555,30585,30614,30644,30673,30703,30732,30762,30791,30821,30850,30880,30909,30939,30968,30998,31027,31057,31086,31116,31145,31175,31204,31234,31263,31293,31322,31352,31381,31411,31441,31471,31500,31530,31559,31589,31618,31648,31676,31706,31736,31766,31795,31825,31854,31884,31913,31943,31972,32002,32031,32061,32090,32120,32150,32180,32209,32239,32268,32298,32327,32357,32386,32416,32445,32475,32504,32534,32563,32593,32622,32652,32681,32711,32740,32770,32799,32829,32858,32888,32917,32947,32976,33006,33035,33065,33094,33124,33153,33183,33213,33243,33272,33302,33331,33361,33390,33420,33450,33479,33509,33539,33568,33598,33627,33657,33686,33716,33745,33775,33804,33834,33863,33893,33922,33952,33981,34011,34040,34069,34099,34128,34158,34187,34217,34247,34277,34306,34336,34365,34395,34424,34454,34483,34512,34542,34571,34601,34631,34660,34690,34719,34749,34778,34808,34837,34867,34896,34926,34955,34985,35015,35044,35074,35103,35133,35162,35192,35222,35251,35280,35310,35340,35370,35399,35429,35458,35488,35517,35547,35576,35605,35635,35665,35694,35723,35753,35782,35811,35841,35871,35901,35930,35960,35989,36019,36048,36078,36107,36136,36166,36195,36225,36254,36284,36314,36343,36373,36403,36433,36462,36492,36521,36551,36580,36610,36639,36669,36698,36728,36757,36786,36816,36845,36875,36904,36934,36963,36993,37022,37052,37081,37111,37141,37170,37200,37229,37259,37288,37318,37347,37377,37406,37436,37465,37495,37524,37554,37584,37613,37643,37672,37701,37731,37760,37790,37819,37849,37878,37908,37938,37967,37997,38027,38056,38085,38115,38144,38174,38203,38233,38262,38292,38322,38351,38381,38410,38440,38469,38499,38528,38558,38587,38617,38646,38676,38705,38735,38764,38794,38823,38853,38882,38912,38941,38971,39001,39030,39059,39089,39118,39148,39178,39208,39237,39267,39297,39326,39355,39385,39414,39444,39473,39503,39532,39562,39592,39621,39650,39680,39709,39739,39768,39798,39827,39857,39886,39916,39946,39975,40005,40035,40064,40094,40123,40153,40182,40212,40241,40271,40300,40330,40359,40389,40418,40448,40477,40507,40536,40566,40595,40625,40655,40685,40714,40744,40773,40803,40832,40862,40892,40921,40951,40980,41009,41039,41068,41098,41127,41157,41186,41216,41245,41275,41304,41334,41364,41393,41422,41452,41481,41511,41540,41570,41599,41629,41658,41688,41718,41748,41777,41807,41836,41865,41894,41924,41953,41983,42012,42042,42072,42102,42131,42161,42190,42220,42249,42279,42308,42337,42367,42397,42426,42456,42485,42515,42545,42574,42604,42633,42662,42692,42721,42751,42780,42810,42839,42869,42899,42929,42958,42988,43017,43046,43076,43105,43135,43164,43194,43223,43253,43283,43312,43342,43371,43401,43430,43460,43489,43519,43548,43578,43607,43637,43666,43696,43726,43755,43785,43814,43844,43873,43903,43932,43962,43991,44021,44050,44080,44109,44139,44169,44198,44228,44258,44287,44317,44346,44375,44405,44434,44464,44493,44523,44553,44582,44612,44641,44671,44700,44730,44759,44788,44818,44847,44877,44906,44936,44966,44996,45025,45055,45084,45114,45143,45172,45202,45231,45261,45290,45320,45350,45380,45409,45439,45468,45498,45527,45556,45586,45615,45644,45674,45704,45733,45763,45793,45823,45852,45882,45911,45940,45970,45999,46028,46058,46088,46117,46147,46177,46206,46236,46265,46295,46324,46354,46383,46413,46442,46472,46501,46531,46560,46590,46620,46649,46679,46708,46738,46767,46797,46826,46856,46885,46915,46944,46974,47003,47033,47063,47092,47122,47151,47181,47210,47240,47269,47298,47328,47357,47387,47417,47446,47476,47506,47535,47565,47594,47624,47653,47682,47712,47741,47771,47800,47830,47860,47890,47919,47949,47978,48008,48037,48066,48096,48125,48155,48184,48214,48244,48273,48303,48333,48362,48392,48421,48450,48480,48509,48538,48568,48598,48627,48657,48687,48717,48746,48776,48805,48834,48864,48893,48922,48952,48982,49011,49041,49071,49100,49130,49160,49189,49218,49248,49277,49306,49336,49365,49395,49425,49455,49484,49514,49543,49573,49602,49632,49661,49690,49720,49749,49779,49809,49838,49868,49898,49927,49957,49986,50016,50045,50075,50104,50133,50163,50192,50222,50252,50281,50311,50340,50370,50400,50429,50459,50488,50518,50547,50576,50606,50635,50665,50694,50724,50754,50784,50813,50843,50872,50902,50931,50960,50990,51019,51049,51078,51108,51138,51167,51197,51227,51256,51286,51315,51345,51374,51403,51433,51462,51492,51522,51552,51582,51611,51641,51670,51699,51729,51758,51787,51816,51846,51876,51906,51936,51965,51995,52025,52054,52083,52113,52142,52171,52200,52230,52260,52290,52319,52349,52379,52408,52438,52467,52497,52526,52555,52585,52614,52644,52673,52703,52733,52762,52792,52822,52851,52881,52910,52939,52969,52998,53028,53057,53087,53116,53146,53176,53205,53235,53264,53294,53324,53353,53383,53412,53441,53471,53500,53530,53559,53589,53619,53648,53678,53708,53737,53767,53796,53825,53855,53884,53913,53943,53973,54003,54032,54062,54092,54121,54151,54180,54209,54239,54268,54297,54327,54357,54387,54416,54446,54476,54505,54535,54564,54593,54623,54652,54681,54711,54741,54770,54800,54830,54859,54889,54919,54948,54977,55007,55036,55066,55095,55125,55154,55184,55213,55243,55273,55302,55332,55361,55391,55420,55450,55479,55508,55538,55567,55597,55627,55657,55686,55716,55745,55775,55804,55834,55863,55892,55922,55951,55981,56011,56040,56070,56100,56129,56159,56188,56218,56247,56276,56306,56335,56365,56394,56424,56454,56483,56513,56543,56572,56601,56631,56660,56690,56719,56749,56778,56808,56837,56867,56897,56926,56956,56985,57015,57044,57074,57103,57133,57162,57192,57221,57251,57280,57310,57340,57369,57399,57429,57458,57487,57517,57546,57576,57605,57634,57664,57694,57723,57753,57783,57813,57842,57871,57901,57930,57959,57989,58018,58048,58077,58107,58137,58167,58196,58226,58255,58285,58314,58343,58373,58402,58432,58461,58491,58521,58551,58580,58610,58639,58669,58698,58727,58757,58786,58816,58845,58875,58905,58934,58964,58994,59023,59053,59082,59111,59141,59170,59200,59229,59259,59288,59318,59348,59377,59407,59436,59466,59495,59525,59554,59584,59613,59643,59672,59702,59731,59761,59791,59820,59850,59879,59909,59939,59968,59997,60027,60056,60086,60115,60145,60174,60204,60234,60264,60293,60323,60352,60381,60411,60440,60469,60499,60528,60558,60588,60618,60648,60677,60707,60736,60765,60795,60824,60853,60883,60912,60942,60972,61002,61031,61061,61090,61120,61149,61179,61208,61237,61267,61296,61326,61356,61385,61415,61445,61474,61504,61533,61563,61592,61621,61651,61680,61710,61739,61769,61799,61828,61858,61888,61917,61947,61976,62006,62035,62064,62094,62123,62153,62182,62212,62242,62271,62301,62331,62360,62390,62419,62448,62478,62507,62537,62566,62596,62625,62655,62685,62715,62744,62774,62803,62832,62862,62891,62921,62950,62980,63009,63039,63069,63099,63128,63157,63187,63216,63246,63275,63305,63334,63363,63393,63423,63453,63482,63512,63541,63571,63600,63630,63659,63689,63718,63747,63777,63807,63836,63866,63895,63925,63955,63984,64014,64043,64073,64102,64131,64161,64190,64220,64249,64279,64309,64339,64368,64398,64427,64457,64486,64515,64545,64574,64603,64633,64663,64692,64722,64752,64782,64811,64841,64870,64899,64929,64958,64987,65017,65047,65076,65106,65136,65166,65195,65225,65254,65283,65313,65342,65371,65401,65431,65460,65490,65520,65549,65579,65608,65638,65667,65697,65726,65755,65785,65815,65844,65874,65903,65933,65963,65992,66022,66051,66081,66110,66140,66169,66199,66228,66258,66287,66317,66346,66376,66405,66435,66465,66494,66524,66553,66583,66612,66641,66671,66700,66730,66760,66789,66819,66849,66878,66908,66937,66967,66996,67025,67055,67084,67114,67143,67173,67203,67233,67262,67292,67321,67351,67380,67409,67439,67468,67497,67527,67557,67587,67617,67646,67676,67705,67735,67764,67793,67823,67852,67882,67911,67941,67971,68e3,68030,68060,68089,68119,68148,68177,68207,68236,68266,68295,68325,68354,68384,68414,68443,68473,68502,68532,68561,68591,68620,68650,68679,68708,68738,68768,68797,68827,68857,68886,68916,68946,68975,69004,69034,69063,69092,69122,69152,69181,69211,69240,69270,69300,69330,69359,69388,69418,69447,69476,69506,69535,69565,69595,69624,69654,69684,69713,69743,69772,69802,69831,69861,69890,69919,69949,69978,70008,70038,70067,70097,70126,70156,70186,70215,70245,70274,70303,70333,70362,70392,70421,70451,70481,70510,70540,70570,70599,70629,70658,70687,70717,70746,70776,70805,70835,70864,70894,70924,70954,70983,71013,71042,71071,71101,71130,71159,71189,71218,71248,71278,71308,71337,71367,71397,71426,71455,71485,71514,71543,71573,71602,71632,71662,71691,71721,71751,71781,71810,71839,71869,71898,71927,71957,71986,72016,72046,72075,72105,72135,72164,72194,72223,72253,72282,72311,72341,72370,72400,72429,72459,72489,72518,72548,72577,72607,72637,72666,72695,72725,72754,72784,72813,72843,72872,72902,72931,72961,72991,73020,73050,73080,73109,73139,73168,73197,73227,73256,73286,73315,73345,73375,73404,73434,73464,73493,73523,73552,73581,73611,73640,73669,73699,73729,73758,73788,73818,73848,73877,73907,73936,73965,73995,74024,74053,74083,74113,74142,74172,74202,74231,74261,74291,74320,74349,74379,74408,74437,74467,74497,74526,74556,74586,74615,74645,74675,74704,74733,74763,74792,74822,74851,74881,74910,74940,74969,74999,75029,75058,75088,75117,75147,75176,75206,75235,75264,75294,75323,75353,75383,75412,75442,75472,75501,75531,75560,75590,75619,75648,75678,75707,75737,75766,75796,75826,75856,75885,75915,75944,75974,76003,76032,76062,76091,76121,76150,76180,76210,76239,76269,76299,76328,76358,76387,76416,76446,76475,76505,76534,76564,76593,76623,76653,76682,76712,76741,76771,76801,76830,76859,76889,76918,76948,76977,77007,77036,77066,77096,77125,77155,77185,77214,77243,77273,77302,77332,77361,77390,77420,77450,77479,77509,77539,77569,77598,77627,77657,77686,77715,77745,77774,77804,77833,77863,77893,77923,77952,77982,78011,78041,78070,78099,78129,78158,78188,78217,78247,78277,78307,78336,78366,78395,78425,78454,78483,78513,78542,78572,78601,78631,78661,78690,78720,78750,78779,78808,78838,78867,78897,78926,78956,78985,79015,79044,79074,79104,79133,79163,79192,79222,79251,79281,79310,79340,79369,79399,79428,79458,79487,79517,79546,79576,79606,79635,79665,79695,79724,79753,79783,79812,79841,79871,79900,79930,79960,79990]},{"../main":545,"object-assign":434}],545:[function(_dereq_,module,exports){var assign=_dereq_("object-assign");function Calendars(){this.regionalOptions=[],this.regionalOptions[""]={invalidCalendar:"Calendar {0} not found",invalidDate:"Invalid {0} date",invalidMonth:"Invalid {0} month",invalidYear:"Invalid {0} year",differentCalendars:"Cannot mix {0} and {1} dates"},this.local=this.regionalOptions[""],this.calendars={},this._localCals={}}function CDate(calendar,year,month,day){if(this._calendar=calendar,this._year=year,this._month=month,this._day=day,0===this._calendar._validateLevel&&!this._calendar.isValid(this._year,this._month,this._day))throw(_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate).replace(/\{0\}/,this._calendar.local.name)}function pad(value,length){return"000000".substring(0,length-(value=""+value).length)+value}function BaseCalendar(){this.shortYearCutoff="+10"}function GregorianCalendar(language){this.local=this.regionalOptions[language]||this.regionalOptions[""]}assign(Calendars.prototype,{instance:function(name,language){name=(name||"gregorian").toLowerCase(),language=language||"";var cal=this._localCals[name+"-"+language];if(!cal&&this.calendars[name]&&(cal=new this.calendars[name](language),this._localCals[name+"-"+language]=cal),!cal)throw(this.local.invalidCalendar||this.regionalOptions[""].invalidCalendar).replace(/\{0\}/,name);return cal},newDate:function(year,month,day,calendar,language){return(calendar=(null!=year&&year.year?year.calendar():"string"==typeof calendar?this.instance(calendar,language):calendar)||this.instance()).newDate(year,month,day)},substituteDigits:function(digits){return function(value){return(value+"").replace(/[0-9]/g,function(digit){return digits[digit]})}},substituteChineseDigits:function(digits,powers){return function(value){for(var localNumber="",power=0;value>0;){var units=value%10;localNumber=(0===units?"":digits[units]+powers[power])+localNumber,power++,value=Math.floor(value/10)}return 0===localNumber.indexOf(digits[1]+powers[1])&&(localNumber=localNumber.substr(1)),localNumber||digits[0]}}}),assign(CDate.prototype,{newDate:function(year,month,day){return this._calendar.newDate(null==year?this:year,month,day)},year:function(year){return 0===arguments.length?this._year:this.set(year,"y")},month:function(month){return 0===arguments.length?this._month:this.set(month,"m")},day:function(day){return 0===arguments.length?this._day:this.set(day,"d")},date:function(year,month,day){if(!this._calendar.isValid(year,month,day))throw(_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate).replace(/\{0\}/,this._calendar.local.name);return this._year=year,this._month=month,this._day=day,this},leapYear:function(){return this._calendar.leapYear(this)},epoch:function(){return this._calendar.epoch(this)},formatYear:function(){return this._calendar.formatYear(this)},monthOfYear:function(){return this._calendar.monthOfYear(this)},weekOfYear:function(){return this._calendar.weekOfYear(this)},daysInYear:function(){return this._calendar.daysInYear(this)},dayOfYear:function(){return this._calendar.dayOfYear(this)},daysInMonth:function(){return this._calendar.daysInMonth(this)},dayOfWeek:function(){return this._calendar.dayOfWeek(this)},weekDay:function(){return this._calendar.weekDay(this)},extraInfo:function(){return this._calendar.extraInfo(this)},add:function(offset,period){return this._calendar.add(this,offset,period)},set:function(value,period){return this._calendar.set(this,value,period)},compareTo:function(date){if(this._calendar.name!==date._calendar.name)throw(_exports.local.differentCalendars||_exports.regionalOptions[""].differentCalendars).replace(/\{0\}/,this._calendar.local.name).replace(/\{1\}/,date._calendar.local.name);var c=this._year!==date._year?this._year-date._year:this._month!==date._month?this.monthOfYear()-date.monthOfYear():this._day-date._day;return 0===c?0:c<0?-1:1},calendar:function(){return this._calendar},toJD:function(){return this._calendar.toJD(this)},fromJD:function(jd){return this._calendar.fromJD(jd)},toJSDate:function(){return this._calendar.toJSDate(this)},fromJSDate:function(jsd){return this._calendar.fromJSDate(jsd)},toString:function(){return(this.year()<0?"-":"")+pad(Math.abs(this.year()),4)+"-"+pad(this.month(),2)+"-"+pad(this.day(),2)}}),assign(BaseCalendar.prototype,{_validateLevel:0,newDate:function(year,month,day){return null==year?this.today():(year.year&&(this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate),day=year.day(),month=year.month(),year=year.year()),new CDate(this,year,month,day))},today:function(){return this.fromJSDate(new Date)},epoch:function(year){return this._validate(year,this.minMonth,this.minDay,_exports.local.invalidYear||_exports.regionalOptions[""].invalidYear).year()<0?this.local.epochs[0]:this.local.epochs[1]},formatYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,_exports.local.invalidYear||_exports.regionalOptions[""].invalidYear);return(date.year()<0?"-":"")+pad(Math.abs(date.year()),4)},monthsInYear:function(year){return this._validate(year,this.minMonth,this.minDay,_exports.local.invalidYear||_exports.regionalOptions[""].invalidYear),12},monthOfYear:function(year,month){var date=this._validate(year,month,this.minDay,_exports.local.invalidMonth||_exports.regionalOptions[""].invalidMonth);return(date.month()+this.monthsInYear(date)-this.firstMonth)%this.monthsInYear(date)+this.minMonth},fromMonthOfYear:function(year,ord){var m=(ord+this.firstMonth-2*this.minMonth)%this.monthsInYear(year)+this.minMonth;return this._validate(year,m,this.minDay,_exports.local.invalidMonth||_exports.regionalOptions[""].invalidMonth),m},daysInYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,_exports.local.invalidYear||_exports.regionalOptions[""].invalidYear);return this.leapYear(date)?366:365},dayOfYear:function(year,month,day){var date=this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate);return date.toJD()-this.newDate(date.year(),this.fromMonthOfYear(date.year(),this.minMonth),this.minDay).toJD()+1},daysInWeek:function(){return 7},dayOfWeek:function(year,month,day){var date=this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate);return(Math.floor(this.toJD(date))+2)%this.daysInWeek()},extraInfo:function(year,month,day){return this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate),{}},add:function(date,offset,period){return this._validate(date,this.minMonth,this.minDay,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate),this._correctAdd(date,this._add(date,offset,period),offset,period)},_add:function(date,offset,period){if(this._validateLevel++,"d"===period||"w"===period){var jd=date.toJD()+offset*("w"===period?this.daysInWeek():1),d=date.calendar().fromJD(jd);return this._validateLevel--,[d.year(),d.month(),d.day()]}try{var y=date.year()+("y"===period?offset:0),m=date.monthOfYear()+("m"===period?offset:0);d=date.day();"y"===period?(date.month()!==this.fromMonthOfYear(y,m)&&(m=this.newDate(y,date.month(),this.minDay).monthOfYear()),m=Math.min(m,this.monthsInYear(y)),d=Math.min(d,this.daysInMonth(y,this.fromMonthOfYear(y,m)))):"m"===period&&(!function(calendar){for(;m<calendar.minMonth;)y--,m+=calendar.monthsInYear(y);for(var yearMonths=calendar.monthsInYear(y);m>yearMonths-1+calendar.minMonth;)y++,m-=yearMonths,yearMonths=calendar.monthsInYear(y)}(this),d=Math.min(d,this.daysInMonth(y,this.fromMonthOfYear(y,m))));var ymd=[y,this.fromMonthOfYear(y,m),d];return this._validateLevel--,ymd}catch(e){throw this._validateLevel--,e}},_correctAdd:function(date,ymd,offset,period){if(!(this.hasYearZero||"y"!==period&&"m"!==period||0!==ymd[0]&&date.year()>0==ymd[0]>0)){var adj={y:[1,1,"y"],m:[1,this.monthsInYear(-1),"m"],w:[this.daysInWeek(),this.daysInYear(-1),"d"],d:[1,this.daysInYear(-1),"d"]}[period],dir=offset<0?-1:1;ymd=this._add(date,offset*adj[0]+dir*adj[1],adj[2])}return date.date(ymd[0],ymd[1],ymd[2])},set:function(date,value,period){this._validate(date,this.minMonth,this.minDay,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate);var y="y"===period?value:date.year(),m="m"===period?value:date.month(),d="d"===period?value:date.day();return"y"!==period&&"m"!==period||(d=Math.min(d,this.daysInMonth(y,m))),date.date(y,m,d)},isValid:function(year,month,day){this._validateLevel++;var valid=this.hasYearZero||0!==year;if(valid){var date=this.newDate(year,month,this.minDay);valid=month>=this.minMonth&&month-this.minMonth<this.monthsInYear(date)&&day>=this.minDay&&day-this.minDay<this.daysInMonth(date)}return this._validateLevel--,valid},toJSDate:function(year,month,day){var date=this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate);return _exports.instance().fromJD(this.toJD(date)).toJSDate()},fromJSDate:function(jsd){return this.fromJD(_exports.instance().fromJSDate(jsd).toJD())},_validate:function(year,month,day,error){if(year.year){if(0===this._validateLevel&&this.name!==year.calendar().name)throw(_exports.local.differentCalendars||_exports.regionalOptions[""].differentCalendars).replace(/\{0\}/,this.local.name).replace(/\{1\}/,year.calendar().local.name);return year}try{if(this._validateLevel++,1===this._validateLevel&&!this.isValid(year,month,day))throw error.replace(/\{0\}/,this.local.name);var date=this.newDate(year,month,day);return this._validateLevel--,date}catch(e){throw this._validateLevel--,e}}}),GregorianCalendar.prototype=new BaseCalendar,assign(GregorianCalendar.prototype,{name:"Gregorian",jdEpoch:1721425.5,daysPerMonth:[31,28,31,30,31,30,31,31,30,31,30,31],hasYearZero:!1,minMonth:1,firstMonth:1,minDay:1,regionalOptions:{"":{name:"Gregorian",epochs:["BCE","CE"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],digits:null,dateFormat:"mm/dd/yyyy",firstDay:0,isRTL:!1}},leapYear:function(year){var date=this._validate(year,this.minMonth,this.minDay,_exports.local.invalidYear||_exports.regionalOptions[""].invalidYear);return(year=date.year()+(date.year()<0?1:0))%4==0&&(year%100!=0||year%400==0)},weekOfYear:function(year,month,day){var checkDate=this.newDate(year,month,day);return checkDate.add(4-(checkDate.dayOfWeek()||7),"d"),Math.floor((checkDate.dayOfYear()-1)/7)+1},daysInMonth:function(year,month){var date=this._validate(year,month,this.minDay,_exports.local.invalidMonth||_exports.regionalOptions[""].invalidMonth);return this.daysPerMonth[date.month()-1]+(2===date.month()&&this.leapYear(date.year())?1:0)},weekDay:function(year,month,day){return(this.dayOfWeek(year,month,day)||7)<6},toJD:function(year,month,day){var date=this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate);year=date.year(),month=date.month(),day=date.day(),year<0&&year++,month<3&&(month+=12,year--);var a=Math.floor(year/100),b=2-a+Math.floor(a/4);return Math.floor(365.25*(year+4716))+Math.floor(30.6001*(month+1))+day+b-1524.5},fromJD:function(jd){var z=Math.floor(jd+.5),a=Math.floor((z-1867216.25)/36524.25),b=(a=z+1+a-Math.floor(a/4))+1524,c=Math.floor((b-122.1)/365.25),d=Math.floor(365.25*c),e=Math.floor((b-d)/30.6001),day=b-d-Math.floor(30.6001*e),month=e-(e>13.5?13:1),year=c-(month>2.5?4716:4715);return year<=0&&year--,this.newDate(year,month,day)},toJSDate:function(year,month,day){var date=this._validate(year,month,day,_exports.local.invalidDate||_exports.regionalOptions[""].invalidDate),jsd=new Date(date.year(),date.month()-1,date.day());return jsd.setHours(0),jsd.setMinutes(0),jsd.setSeconds(0),jsd.setMilliseconds(0),jsd.setHours(jsd.getHours()>12?jsd.getHours()+2:0),jsd},fromJSDate:function(jsd){return this.newDate(jsd.getFullYear(),jsd.getMonth()+1,jsd.getDate())}});var _exports=module.exports=new Calendars;_exports.cdate=CDate,_exports.baseCalendar=BaseCalendar,_exports.calendars.gregorian=GregorianCalendar},{"object-assign":434}],546:[function(_dereq_,module,exports){var assign=_dereq_("object-assign"),main=_dereq_("./main");assign(main.regionalOptions[""],{invalidArguments:"Invalid arguments",invalidFormat:"Cannot format a date from another calendar",missingNumberAt:"Missing number at position {0}",unknownNameAt:"Unknown name at position {0}",unexpectedLiteralAt:"Unexpected literal at position {0}",unexpectedText:"Additional text found at end"}),main.local=main.regionalOptions[""],assign(main.cdate.prototype,{formatDate:function(format,settings){return"string"!=typeof format&&(settings=format,format=""),this._calendar.formatDate(format||"",this,settings)}}),assign(main.baseCalendar.prototype,{UNIX_EPOCH:main.instance().newDate(1970,1,1).toJD(),SECS_PER_DAY:86400,TICKS_EPOCH:main.instance().jdEpoch,TICKS_PER_DAY:864e9,ATOM:"yyyy-mm-dd",COOKIE:"D, dd M yyyy",FULL:"DD, MM d, yyyy",ISO_8601:"yyyy-mm-dd",JULIAN:"J",RFC_822:"D, d M yy",RFC_850:"DD, dd-M-yy",RFC_1036:"D, d M yy",RFC_1123:"D, d M yyyy",RFC_2822:"D, d M yyyy",RSS:"D, d M yy",TICKS:"!",TIMESTAMP:"@",W3C:"yyyy-mm-dd",formatDate:function(format,date,settings){if("string"!=typeof format&&(settings=date,date=format,format=""),!date)return"";if(date.calendar()!==this)throw main.local.invalidFormat||main.regionalOptions[""].invalidFormat;format=format||this.local.dateFormat;for(var match,value,shortNames,longNames,dayNamesShort=(settings=settings||{}).dayNamesShort||this.local.dayNamesShort,dayNames=settings.dayNames||this.local.dayNames,monthNumbers=settings.monthNumbers||this.local.monthNumbers,monthNamesShort=settings.monthNamesShort||this.local.monthNamesShort,monthNames=settings.monthNames||this.local.monthNames,doubled=(settings.calculateWeek||this.local.calculateWeek,function(match,step){for(var matches=1;iFormat+matches<format.length&&format.charAt(iFormat+matches)===match;)matches++;return iFormat+=matches-1,Math.floor(matches/(step||1))>1}),formatNumber=function(match,value,len,step){var num=""+value;if(doubled(match,step))for(;num.length<len;)num="0"+num;return num},calendar=this,formatMonth=function(date){return"function"==typeof monthNumbers?monthNumbers.call(calendar,date,doubled("m")):localiseNumbers(formatNumber("m",date.month(),2))},formatMonthName=function(date,useLongName){return useLongName?"function"==typeof monthNames?monthNames.call(calendar,date):monthNames[date.month()-calendar.minMonth]:"function"==typeof monthNamesShort?monthNamesShort.call(calendar,date):monthNamesShort[date.month()-calendar.minMonth]},digits=this.local.digits,localiseNumbers=function(value){return settings.localNumbers&&digits?digits(value):value},output="",literal=!1,iFormat=0;iFormat<format.length;iFormat++)if(literal)"'"!==format.charAt(iFormat)||doubled("'")?output+=format.charAt(iFormat):literal=!1;else switch(format.charAt(iFormat)){case"d":output+=localiseNumbers(formatNumber("d",date.day(),2));break;case"D":output+=(match="D",value=date.dayOfWeek(),shortNames=dayNamesShort,longNames=dayNames,doubled(match)?longNames[value]:shortNames[value]);break;case"o":output+=formatNumber("o",date.dayOfYear(),3);break;case"w":output+=formatNumber("w",date.weekOfYear(),2);break;case"m":output+=formatMonth(date);break;case"M":output+=formatMonthName(date,doubled("M"));break;case"y":output+=doubled("y",2)?date.year():(date.year()%100<10?"0":"")+date.year()%100;break;case"Y":doubled("Y",2),output+=date.formatYear();break;case"J":output+=date.toJD();break;case"@":output+=(date.toJD()-this.UNIX_EPOCH)*this.SECS_PER_DAY;break;case"!":output+=(date.toJD()-this.TICKS_EPOCH)*this.TICKS_PER_DAY;break;case"'":doubled("'")?output+="'":literal=!0;break;default:output+=format.charAt(iFormat)}return output},parseDate:function(format,value,settings){if(null==value)throw main.local.invalidArguments||main.regionalOptions[""].invalidArguments;if(""===(value="object"==typeof value?value.toString():value+""))return null;format=format||this.local.dateFormat;var shortYearCutoff=(settings=settings||{}).shortYearCutoff||this.shortYearCutoff;shortYearCutoff="string"!=typeof shortYearCutoff?shortYearCutoff:this.today().year()%100+parseInt(shortYearCutoff,10);for(var dayNamesShort=settings.dayNamesShort||this.local.dayNamesShort,dayNames=settings.dayNames||this.local.dayNames,parseMonth=settings.parseMonth||this.local.parseMonth,monthNumbers=settings.monthNumbers||this.local.monthNumbers,monthNamesShort=settings.monthNamesShort||this.local.monthNamesShort,monthNames=settings.monthNames||this.local.monthNames,jd=-1,year=-1,month=-1,day=-1,doy=-1,shortYear=!1,literal=!1,doubled=function(match,step){for(var matches=1;iFormat+matches<format.length&&format.charAt(iFormat+matches)===match;)matches++;return iFormat+=matches-1,Math.floor(matches/(step||1))>1},getNumber=function(match,step){var isDoubled=doubled(match,step),size=[2,3,isDoubled?4:2,isDoubled?4:2,10,11,20]["oyYJ@!".indexOf(match)+1],digits=new RegExp("^-?\\d{1,"+size+"}"),num=value.substring(iValue).match(digits);if(!num)throw(main.local.missingNumberAt||main.regionalOptions[""].missingNumberAt).replace(/\{0\}/,iValue);return iValue+=num[0].length,parseInt(num[0],10)},calendar=this,getMonthNumber=function(){if("function"==typeof monthNumbers){doubled("m");var month=monthNumbers.call(calendar,value.substring(iValue));return iValue+=month.length,month}return getNumber("m")},getName=function(match,shortNames,longNames,step){for(var names=doubled(match,step)?longNames:shortNames,i=0;i<names.length;i++)if(value.substr(iValue,names[i].length).toLowerCase()===names[i].toLowerCase())return iValue+=names[i].length,i+calendar.minMonth;throw(main.local.unknownNameAt||main.regionalOptions[""].unknownNameAt).replace(/\{0\}/,iValue)},getMonthName=function(){if("function"==typeof monthNames){var month=doubled("M")?monthNames.call(calendar,value.substring(iValue)):monthNamesShort.call(calendar,value.substring(iValue));return iValue+=month.length,month}return getName("M",monthNamesShort,monthNames)},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat))throw(main.local.unexpectedLiteralAt||main.regionalOptions[""].unexpectedLiteralAt).replace(/\{0\}/,iValue);iValue++},iValue=0,iFormat=0;iFormat<format.length;iFormat++)if(literal)"'"!==format.charAt(iFormat)||doubled("'")?checkLiteral():literal=!1;else switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"w":getNumber("w");break;case"m":month=getMonthNumber();break;case"M":month=getMonthName();break;case"y":var iSave=iFormat;shortYear=!doubled("y",2),iFormat=iSave,year=getNumber("y",2);break;case"Y":year=getNumber("Y",2);break;case"J":jd=getNumber("J")+.5,"."===value.charAt(iValue)&&(iValue++,getNumber("J"));break;case"@":jd=getNumber("@")/this.SECS_PER_DAY+this.UNIX_EPOCH;break;case"!":jd=getNumber("!")/this.TICKS_PER_DAY+this.TICKS_EPOCH;break;case"*":iValue=value.length;break;case"'":doubled("'")?checkLiteral():literal=!0;break;default:checkLiteral()}if(iValue<value.length)throw main.local.unexpectedText||main.regionalOptions[""].unexpectedText;if(-1===year?year=this.today().year():year<100&&shortYear&&(year+=-1===shortYearCutoff?1900:this.today().year()-this.today().year()%100-(year<=shortYearCutoff?0:100)),"string"==typeof month&&(month=parseMonth.call(this,year,month)),doy>-1){month=1,day=doy;for(var dim=this.daysInMonth(year,month);day>dim;dim=this.daysInMonth(year,month))month++,day-=dim}return jd>-1?this.fromJD(jd):this.newDate(year,month,day)},determineDate:function(dateSpec,defaultDate,currentDate,dateFormat,settings){currentDate&&"object"!=typeof currentDate&&(settings=dateFormat,dateFormat=currentDate,currentDate=null),"string"!=typeof dateFormat&&(settings=dateFormat,dateFormat="");var calendar=this;return defaultDate=defaultDate?defaultDate.newDate():null,dateSpec=null==dateSpec?defaultDate:"string"==typeof dateSpec?function(offset){try{return calendar.parseDate(dateFormat,offset,settings)}catch(e){}for(var date=((offset=offset.toLowerCase()).match(/^c/)&&currentDate?currentDate.newDate():null)||calendar.today(),pattern=/([+-]?[0-9]+)\s*(d|w|m|y)?/g,matches=pattern.exec(offset);matches;)date.add(parseInt(matches[1],10),matches[2]||"d"),matches=pattern.exec(offset);return date}(dateSpec):"number"==typeof dateSpec?isNaN(dateSpec)||dateSpec===1/0||dateSpec===-1/0?defaultDate:calendar.today().add(dateSpec,"d"):calendar.newDate(dateSpec)}})},{"./main":545,"object-assign":434}],547:[function(_dereq_,module,exports){module.exports=_dereq_("cwise-compiler")({args:["array",{offset:[1],array:0},"scalar","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\n        var _inline_1_da = _inline_1_arg0_ - _inline_1_arg3_\n        var _inline_1_db = _inline_1_arg1_ - _inline_1_arg3_\n        if((_inline_1_da >= 0) !== (_inline_1_db >= 0)) {\n          _inline_1_arg2_.push(_inline_1_arg4_[0] + 0.5 + 0.5 * (_inline_1_da + _inline_1_db) / (_inline_1_da - _inline_1_db))\n        }\n      }",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg3_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:[],localVars:["_inline_1_da","_inline_1_db"]},funcName:"zeroCrossings"})},{"cwise-compiler":133}],548:[function(_dereq_,module,exports){"use strict";module.exports=function findZeroCrossings(array,level){var cross=[];return level=+level||0,core(array.hi(array.shape[0]-1),cross,level),cross};var core=_dereq_("./lib/zc-core")},{"./lib/zc-core":547}],549:[function(_dereq_,module,exports){"use strict";module.exports=[{path:"",backoff:0},{path:"M-2.4,-3V3L0.6,0Z",backoff:.6},{path:"M-3.7,-2.5V2.5L1.3,0Z",backoff:1.3},{path:"M-4.45,-3L-1.65,-0.2V0.2L-4.45,3L1.55,0Z",backoff:1.55},{path:"M-2.2,-2.2L-0.2,-0.2V0.2L-2.2,2.2L-1.4,3L1.6,0L-1.4,-3Z",backoff:1.6},{path:"M-4.4,-2.1L-0.6,-0.2V0.2L-4.4,2.1L-4,3L2,0L-4,-3Z",backoff:2},{path:"M2,0A2,2 0 1,1 0,-2A2,2 0 0,1 2,0Z",backoff:0,noRotate:!0},{path:"M2,2V-2H-2V2Z",backoff:0,noRotate:!0}]},{}],550:[function(_dereq_,module,exports){"use strict";var ARROWPATHS=_dereq_("./arrow_paths"),fontAttrs=_dereq_("../../plots/font_attributes"),cartesianConstants=_dereq_("../../plots/cartesian/constants"),templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;module.exports=templatedArray("annotation",{visible:{valType:"boolean",dflt:!0,editType:"calc+arraydraw"},text:{valType:"string",editType:"calc+arraydraw"},textangle:{valType:"angle",dflt:0,editType:"calc+arraydraw"},font:fontAttrs({editType:"calc+arraydraw",colorEditType:"arraydraw"}),width:{valType:"number",min:1,dflt:null,editType:"calc+arraydraw"},height:{valType:"number",min:1,dflt:null,editType:"calc+arraydraw"},opacity:{valType:"number",min:0,max:1,dflt:1,editType:"arraydraw"},align:{valType:"enumerated",values:["left","center","right"],dflt:"center",editType:"arraydraw"},valign:{valType:"enumerated",values:["top","middle","bottom"],dflt:"middle",editType:"arraydraw"},bgcolor:{valType:"color",dflt:"rgba(0,0,0,0)",editType:"arraydraw"},bordercolor:{valType:"color",dflt:"rgba(0,0,0,0)",editType:"arraydraw"},borderpad:{valType:"number",min:0,dflt:1,editType:"calc+arraydraw"},borderwidth:{valType:"number",min:0,dflt:1,editType:"calc+arraydraw"},showarrow:{valType:"boolean",dflt:!0,editType:"calc+arraydraw"},arrowcolor:{valType:"color",editType:"arraydraw"},arrowhead:{valType:"integer",min:0,max:ARROWPATHS.length,dflt:1,editType:"arraydraw"},startarrowhead:{valType:"integer",min:0,max:ARROWPATHS.length,dflt:1,editType:"arraydraw"},arrowside:{valType:"flaglist",flags:["end","start"],extras:["none"],dflt:"end",editType:"arraydraw"},arrowsize:{valType:"number",min:.3,dflt:1,editType:"calc+arraydraw"},startarrowsize:{valType:"number",min:.3,dflt:1,editType:"calc+arraydraw"},arrowwidth:{valType:"number",min:.1,editType:"calc+arraydraw"},standoff:{valType:"number",min:0,dflt:0,editType:"calc+arraydraw"},startstandoff:{valType:"number",min:0,dflt:0,editType:"calc+arraydraw"},ax:{valType:"any",editType:"calc+arraydraw"},ay:{valType:"any",editType:"calc+arraydraw"},axref:{valType:"enumerated",dflt:"pixel",values:["pixel",cartesianConstants.idRegex.x.toString()],editType:"calc"},ayref:{valType:"enumerated",dflt:"pixel",values:["pixel",cartesianConstants.idRegex.y.toString()],editType:"calc"},xref:{valType:"enumerated",values:["paper",cartesianConstants.idRegex.x.toString()],editType:"calc"},x:{valType:"any",editType:"calc+arraydraw"},xanchor:{valType:"enumerated",values:["auto","left","center","right"],dflt:"auto",editType:"calc+arraydraw"},xshift:{valType:"number",dflt:0,editType:"calc+arraydraw"},yref:{valType:"enumerated",values:["paper",cartesianConstants.idRegex.y.toString()],editType:"calc"},y:{valType:"any",editType:"calc+arraydraw"},yanchor:{valType:"enumerated",values:["auto","top","middle","bottom"],dflt:"auto",editType:"calc+arraydraw"},yshift:{valType:"number",dflt:0,editType:"calc+arraydraw"},clicktoshow:{valType:"enumerated",values:[!1,"onoff","onout"],dflt:!1,editType:"arraydraw"},xclick:{valType:"any",editType:"arraydraw"},yclick:{valType:"any",editType:"arraydraw"},hovertext:{valType:"string",editType:"arraydraw"},hoverlabel:{bgcolor:{valType:"color",editType:"arraydraw"},bordercolor:{valType:"color",editType:"arraydraw"},font:fontAttrs({editType:"arraydraw"}),editType:"arraydraw"},captureevents:{valType:"boolean",editType:"arraydraw"},editType:"calc",_deprecated:{ref:{valType:"string",editType:"calc"}}})},{"../../plot_api/plot_template":732,"../../plots/cartesian/constants":747,"../../plots/font_attributes":768,"./arrow_paths":549}],551:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),draw=_dereq_("./draw").draw;function annAutorange(gd){var fullLayout=gd._fullLayout;Lib.filterVisible(fullLayout.annotations).forEach(function(ann){var xa=Axes.getFromId(gd,ann.xref),ya=Axes.getFromId(gd,ann.yref);ann._extremes={},xa&&calcAxisExpansion(ann,xa),ya&&calcAxisExpansion(ann,ya)})}function calcAxisExpansion(ann,ax){var extremes,axId=ax._id,letter=axId.charAt(0),pos=ann[letter],apos=ann["a"+letter],ref=ann[letter+"ref"],aref=ann["a"+letter+"ref"],padplus=ann["_"+letter+"padplus"],padminus=ann["_"+letter+"padminus"],shift={x:1,y:-1}[letter]*ann[letter+"shift"],headSize=3*ann.arrowsize*ann.arrowwidth||0,headPlus=headSize+shift,headMinus=headSize-shift,startHeadSize=3*ann.startarrowsize*ann.arrowwidth||0,startHeadPlus=startHeadSize+shift,startHeadMinus=startHeadSize-shift;if(aref===ref){var extremeArrowHead=Axes.findExtremes(ax,[ax.r2c(pos)],{ppadplus:headPlus,ppadminus:headMinus}),extremeText=Axes.findExtremes(ax,[ax.r2c(apos)],{ppadplus:Math.max(padplus,startHeadPlus),ppadminus:Math.max(padminus,startHeadMinus)});extremes={min:[extremeArrowHead.min[0],extremeText.min[0]],max:[extremeArrowHead.max[0],extremeText.max[0]]}}else startHeadPlus=apos?startHeadPlus+apos:startHeadPlus,startHeadMinus=apos?startHeadMinus-apos:startHeadMinus,extremes=Axes.findExtremes(ax,[ax.r2c(pos)],{ppadplus:Math.max(padplus,headPlus,startHeadPlus),ppadminus:Math.max(padminus,headMinus,startHeadMinus)});ann._extremes[axId]=extremes}module.exports=function calcAutorange(gd){var fullLayout=gd._fullLayout;if(Lib.filterVisible(fullLayout.annotations).length&&gd._fullData.length)return Lib.syncOrAsync([draw,annAutorange],gd)}},{"../../lib":693,"../../plots/cartesian/axes":742,"./draw":556}],552:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry"),arrayEditor=_dereq_("../../plot_api/plot_template").arrayEditor;function getToggleSets(gd,hoverData){var i,j,anni,showMode,pointj,xa,ya,annotations=gd._fullLayout.annotations,onSet=[],offSet=[],explicitOffSet=[],hoverLen=(hoverData||[]).length;for(i=0;i<annotations.length;i++)if(showMode=(anni=annotations[i]).clicktoshow){for(j=0;j<hoverLen;j++)if(xa=(pointj=hoverData[j]).xaxis,ya=pointj.yaxis,xa._id===anni.xref&&ya._id===anni.yref&&xa.d2r(pointj.x)===clickData2r(anni._xclick,xa)&&ya.d2r(pointj.y)===clickData2r(anni._yclick,ya)){(anni.visible?"onout"===showMode?offSet:explicitOffSet:onSet).push(i);break}j===hoverLen&&anni.visible&&"onout"===showMode&&offSet.push(i)}return{on:onSet,off:offSet,explicitOff:explicitOffSet}}function clickData2r(d,ax){return"log"===ax.type?ax.l2r(d):ax.d2r(d)}module.exports={hasClickToShow:function hasClickToShow(gd,hoverData){var sets=getToggleSets(gd,hoverData);return sets.on.length>0||sets.explicitOff.length>0},onClick:function onClick(gd,hoverData){var i,editHelpers,toggleSets=getToggleSets(gd,hoverData),onSet=toggleSets.on,offSet=toggleSets.off.concat(toggleSets.explicitOff),update={},annotationsOut=gd._fullLayout.annotations;if(!onSet.length&&!offSet.length)return;for(i=0;i<onSet.length;i++)(editHelpers=arrayEditor(gd.layout,"annotations",annotationsOut[onSet[i]])).modifyItem("visible",!0),Lib.extendFlat(update,editHelpers.getUpdateObj());for(i=0;i<offSet.length;i++)(editHelpers=arrayEditor(gd.layout,"annotations",annotationsOut[offSet[i]])).modifyItem("visible",!1),Lib.extendFlat(update,editHelpers.getUpdateObj());return Registry.call("update",gd,{},update)}}},{"../../lib":693,"../../plot_api/plot_template":732,"../../registry":825}],553:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../color");module.exports=function handleAnnotationCommonDefaults(annIn,annOut,fullLayout,coerce){coerce("opacity");var bgColor=coerce("bgcolor"),borderColor=coerce("bordercolor"),borderOpacity=Color.opacity(borderColor);coerce("borderpad");var borderWidth=coerce("borderwidth"),showArrow=coerce("showarrow");if(coerce("text",showArrow?" ":fullLayout._dfltTitle.annotation),coerce("textangle"),Lib.coerceFont(coerce,"font",fullLayout.font),coerce("width"),coerce("align"),coerce("height")&&coerce("valign"),showArrow){var arrowhead,arrowsize,arrowside=coerce("arrowside");-1!==arrowside.indexOf("end")&&(arrowhead=coerce("arrowhead"),arrowsize=coerce("arrowsize")),-1!==arrowside.indexOf("start")&&(coerce("startarrowhead",arrowhead),coerce("startarrowsize",arrowsize)),coerce("arrowcolor",borderOpacity?annOut.bordercolor:Color.defaultLine),coerce("arrowwidth",2*(borderOpacity&&borderWidth||1)),coerce("standoff"),coerce("startstandoff")}var hoverText=coerce("hovertext"),globalHoverLabel=fullLayout.hoverlabel||{};if(hoverText){var hoverBG=coerce("hoverlabel.bgcolor",globalHoverLabel.bgcolor||(Color.opacity(bgColor)?Color.rgb(bgColor):Color.defaultLine)),hoverBorder=coerce("hoverlabel.bordercolor",globalHoverLabel.bordercolor||Color.contrast(hoverBG));Lib.coerceFont(coerce,"hoverlabel.font",{family:globalHoverLabel.font.family,size:globalHoverLabel.font.size,color:globalHoverLabel.font.color||hoverBorder})}coerce("captureevents",!!hoverText)}},{"../../lib":693,"../color":567}],554:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),toLogRange=_dereq_("../../lib/to_log_range");module.exports=function convertCoords(gd,ax,newType,doExtra){ax=ax||{};var toLog="log"===newType&&"linear"===ax.type,fromLog="linear"===newType&&"log"===ax.type;if(toLog||fromLog)for(var ann,attrPrefix,annotations=gd._fullLayout.annotations,axLetter=ax._id.charAt(0),i=0;i<annotations.length;i++)ann=annotations[i],attrPrefix="annotations["+i+"].",ann[axLetter+"ref"]===ax._id&&convert(axLetter),ann["a"+axLetter+"ref"]===ax._id&&convert("a"+axLetter);function convert(attr){var currentVal=ann[attr],newVal=null;newVal=toLog?toLogRange(currentVal,ax.range):Math.pow(10,currentVal),isNumeric(newVal)||(newVal=null),doExtra(attrPrefix+attr,newVal)}}},{"../../lib/to_log_range":720,"fast-isnumeric":213}],555:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),handleAnnotationCommonDefaults=_dereq_("./common_defaults"),attributes=_dereq_("./attributes");function handleAnnotationDefaults(annIn,annOut,fullLayout){function coerce(attr,dflt){return Lib.coerce(annIn,annOut,attributes,attr,dflt)}var visible=coerce("visible"),clickToShow=coerce("clicktoshow");if(visible||clickToShow){handleAnnotationCommonDefaults(annIn,annOut,fullLayout,coerce);for(var showArrow=annOut.showarrow,axLetters=["x","y"],arrowPosDflt=[-10,-30],gdMock={_fullLayout:fullLayout},i=0;i<2;i++){var axLetter=axLetters[i],axRef=Axes.coerceRef(annIn,annOut,gdMock,axLetter,"","paper");if("paper"!==axRef)Axes.getFromId(gdMock,axRef)._annIndices.push(annOut._index);if(Axes.coercePosition(annOut,gdMock,coerce,axRef,axLetter,.5),showArrow){var arrowPosAttr="a"+axLetter,aaxRef=Axes.coerceRef(annIn,annOut,gdMock,arrowPosAttr,"pixel");"pixel"!==aaxRef&&aaxRef!==axRef&&(aaxRef=annOut[arrowPosAttr]="pixel");var aDflt="pixel"===aaxRef?arrowPosDflt[i]:.4;Axes.coercePosition(annOut,gdMock,coerce,aaxRef,arrowPosAttr,aDflt)}coerce(axLetter+"anchor"),coerce(axLetter+"shift")}if(Lib.noneOrAll(annIn,annOut,["x","y"]),showArrow&&Lib.noneOrAll(annIn,annOut,["ax","ay"]),clickToShow){var xClick=coerce("xclick"),yClick=coerce("yclick");annOut._xclick=void 0===xClick?annOut.x:Axes.cleanPosition(xClick,gdMock,annOut.xref),annOut._yclick=void 0===yClick?annOut.y:Axes.cleanPosition(yClick,gdMock,annOut.yref)}}}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut){handleArrayContainerDefaults(layoutIn,layoutOut,{name:"annotations",handleItemDefaults:handleAnnotationDefaults})}},{"../../lib":693,"../../plots/array_container_defaults":738,"../../plots/cartesian/axes":742,"./attributes":550,"./common_defaults":553}],556:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Plots=_dereq_("../../plots/plots"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),Fx=_dereq_("../fx"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),setCursor=_dereq_("../../lib/setcursor"),dragElement=_dereq_("../dragelement"),arrayEditor=_dereq_("../../plot_api/plot_template").arrayEditor,drawArrowHead=_dereq_("./draw_arrow_head");function drawOne(gd,index){var options=gd._fullLayout.annotations[index]||{};drawRaw(gd,options,index,!1,Axes.getFromId(gd,options.xref),Axes.getFromId(gd,options.yref))}function drawRaw(gd,options,index,subplotId,xa,ya){var className,containerStr,fullLayout=gd._fullLayout,gs=gd._fullLayout._size,edits=gd._context.edits;subplotId?(className="annotation-"+subplotId,containerStr=subplotId+".annotations"):(className="annotation",containerStr="annotations");var editHelpers=arrayEditor(gd.layout,containerStr,options),modifyBase=editHelpers.modifyBase,modifyItem=editHelpers.modifyItem,getUpdateObj=editHelpers.getUpdateObj;fullLayout._infolayer.selectAll("."+className+'[data-index="'+index+'"]').remove();var annClipID="clip"+fullLayout._uid+"_ann"+index;if(options._input&&!1!==options.visible){var annPosPx={x:{},y:{}},textangle=+options.textangle||0,annGroup=fullLayout._infolayer.append("g").classed(className,!0).attr("data-index",String(index)).style("opacity",options.opacity),annTextGroup=annGroup.append("g").classed("annotation-text-g",!0),editTextPosition=edits[options.showarrow?"annotationTail":"annotationPosition"],textEvents=options.captureevents||edits.annotationText||editTextPosition,annTextGroupInner=annTextGroup.append("g").style("pointer-events",textEvents?"all":null).call(setCursor,"pointer").on("click",function(){gd._dragging=!1;var eventData={index:index,annotation:options._input,fullAnnotation:options,event:d3.event};subplotId&&(eventData.subplotId=subplotId),gd.emit("plotly_clickannotation",eventData)});options.hovertext&&annTextGroupInner.on("mouseover",function(){var hoverOptions=options.hoverlabel,hoverFont=hoverOptions.font,bBox=this.getBoundingClientRect(),bBoxRef=gd.getBoundingClientRect();Fx.loneHover({x0:bBox.left-bBoxRef.left,x1:bBox.right-bBoxRef.left,y:(bBox.top+bBox.bottom)/2-bBoxRef.top,text:options.hovertext,color:hoverOptions.bgcolor,borderColor:hoverOptions.bordercolor,fontFamily:hoverFont.family,fontSize:hoverFont.size,fontColor:hoverFont.color},{container:fullLayout._hoverlayer.node(),outerContainer:fullLayout._paper.node(),gd:gd})}).on("mouseout",function(){Fx.loneUnhover(fullLayout._hoverlayer.node())});var borderwidth=options.borderwidth,borderpad=options.borderpad,borderfull=borderwidth+borderpad,annTextBG=annTextGroupInner.append("rect").attr("class","bg").style("stroke-width",borderwidth+"px").call(Color.stroke,options.bordercolor).call(Color.fill,options.bgcolor),isSizeConstrained=options.width||options.height,annTextClip=fullLayout._topclips.selectAll("#"+annClipID).data(isSizeConstrained?[0]:[]);annTextClip.enter().append("clipPath").classed("annclip",!0).attr("id",annClipID).append("rect"),annTextClip.exit().remove();var font=options.font,annText=annTextGroupInner.append("text").classed("annotation-text",!0).text(options.text);edits.annotationText?annText.call(svgTextUtils.makeEditable,{delegate:annTextGroupInner,gd:gd}).call(textLayout).on("edit",function(_text){options.text=_text,this.call(textLayout),modifyItem("text",_text),xa&&xa.autorange&&modifyBase(xa._name+".autorange",!0),ya&&ya.autorange&&modifyBase(ya._name+".autorange",!0),Registry.call("relayout",gd,getUpdateObj())}):annText.call(textLayout)}else d3.selectAll("#"+annClipID).remove();function textLayout(s){return s.call(Drawing.font,font).attr({"text-anchor":{left:"start",right:"end"}[options.align]||"middle"}),svgTextUtils.convertToTspans(s,gd,drawGraphicalElements),s}function drawGraphicalElements(){var anchor3=annText.selectAll("a");1===anchor3.size()&&anchor3.text()===annText.text()&&annTextGroupInner.insert("a",":first-child").attr({"xlink:xlink:href":anchor3.attr("xlink:href"),"xlink:xlink:show":anchor3.attr("xlink:show")}).style({cursor:"pointer"}).node().appendChild(annTextBG.node());var mathjaxGroup=annTextGroupInner.select(".annotation-text-math-group"),hasMathjax=!mathjaxGroup.empty(),anntextBB=Drawing.bBox((hasMathjax?mathjaxGroup:annText).node()),textWidth=anntextBB.width,textHeight=anntextBB.height,annWidth=options.width||textWidth,annHeight=options.height||textHeight,outerWidth=Math.round(annWidth+2*borderfull),outerHeight=Math.round(annHeight+2*borderfull);function shiftFraction(v,anchor){return"auto"===anchor&&(anchor=v<1/3?"left":v>2/3?"right":"center"),{center:0,middle:0,left:.5,bottom:-.5,right:-.5,top:.5}[anchor]}for(var annotationIsOffscreen=!1,letters=["x","y"],i=0;i<letters.length;i++){var basePx,textPadShift,alignPosition,autoAlignFraction,textShift,axLetter=letters[i],axRef=options[axLetter+"ref"]||axLetter,tailRef=options["a"+axLetter+"ref"],ax={x:xa,y:ya}[axLetter],dimAngle=(textangle+("x"===axLetter?0:-90))*Math.PI/180,annSizeFromWidth=outerWidth*Math.cos(dimAngle),annSizeFromHeight=outerHeight*Math.sin(dimAngle),annSize=Math.abs(annSizeFromWidth)+Math.abs(annSizeFromHeight),anchor=options[axLetter+"anchor"],overallShift=options[axLetter+"shift"]*("x"===axLetter?1:-1),posPx=annPosPx[axLetter];if(ax){var posFraction=ax.r2fraction(options[axLetter]);(posFraction<0||posFraction>1)&&(tailRef===axRef?((posFraction=ax.r2fraction(options["a"+axLetter]))<0||posFraction>1)&&(annotationIsOffscreen=!0):annotationIsOffscreen=!0),basePx=ax._offset+ax.r2p(options[axLetter]),autoAlignFraction=.5}else"x"===axLetter?(alignPosition=options[axLetter],basePx=gs.l+gs.w*alignPosition):(alignPosition=1-options[axLetter],basePx=gs.t+gs.h*alignPosition),autoAlignFraction=options.showarrow?.5:alignPosition;if(options.showarrow){posPx.head=basePx;var arrowLength=options["a"+axLetter];textShift=annSizeFromWidth*shiftFraction(.5,options.xanchor)-annSizeFromHeight*shiftFraction(.5,options.yanchor),tailRef===axRef?(posPx.tail=ax._offset+ax.r2p(arrowLength),textPadShift=textShift):(posPx.tail=basePx+arrowLength,textPadShift=textShift+arrowLength),posPx.text=posPx.tail+textShift;var maxPx=fullLayout["x"===axLetter?"width":"height"];if("paper"===axRef&&(posPx.head=Lib.constrain(posPx.head,1,maxPx-1)),"pixel"===tailRef){var shiftPlus=-Math.max(posPx.tail-3,posPx.text),shiftMinus=Math.min(posPx.tail+3,posPx.text)-maxPx;shiftPlus>0?(posPx.tail+=shiftPlus,posPx.text+=shiftPlus):shiftMinus>0&&(posPx.tail-=shiftMinus,posPx.text-=shiftMinus)}posPx.tail+=overallShift,posPx.head+=overallShift}else textPadShift=textShift=annSize*shiftFraction(autoAlignFraction,anchor),posPx.text=basePx+textShift;posPx.text+=overallShift,textShift+=overallShift,textPadShift+=overallShift,options["_"+axLetter+"padplus"]=annSize/2+textPadShift,options["_"+axLetter+"padminus"]=annSize/2-textPadShift,options["_"+axLetter+"size"]=annSize,options["_"+axLetter+"shift"]=textShift}if(gd._dragging||!annotationIsOffscreen){var xShift=0,yShift=0;if("left"!==options.align&&(xShift=(annWidth-textWidth)*("center"===options.align?.5:1)),"top"!==options.valign&&(yShift=(annHeight-textHeight)*("middle"===options.valign?.5:1)),hasMathjax)mathjaxGroup.select("svg").attr({x:borderfull+xShift-1,y:borderfull+yShift}).call(Drawing.setClipUrl,isSizeConstrained?annClipID:null);else{var texty=borderfull+yShift-anntextBB.top,textx=borderfull+xShift-anntextBB.left;annText.call(svgTextUtils.positionText,textx,texty).call(Drawing.setClipUrl,isSizeConstrained?annClipID:null)}annTextClip.select("rect").call(Drawing.setRect,borderfull,borderfull,annWidth,annHeight),annTextBG.call(Drawing.setRect,borderwidth/2,borderwidth/2,outerWidth-borderwidth,outerHeight-borderwidth),annTextGroupInner.call(Drawing.setTranslate,Math.round(annPosPx.x.text-outerWidth/2),Math.round(annPosPx.y.text-outerHeight/2)),annTextGroup.attr({transform:"rotate("+textangle+","+annPosPx.x.text+","+annPosPx.y.text+")"});var baseTextTransform,drawArrow=function(dx,dy){annGroup.selectAll(".annotation-arrow-g").remove();var headX=annPosPx.x.head,headY=annPosPx.y.head,tailX=annPosPx.x.tail+dx,tailY=annPosPx.y.tail+dy,textX=annPosPx.x.text+dx,textY=annPosPx.y.text+dy,transform=Lib.rotationXYMatrix(textangle,textX,textY),applyTransform=Lib.apply2DTransform(transform),applyTransform2=Lib.apply2DTransform2(transform),width=+annTextBG.attr("width"),height=+annTextBG.attr("height"),xLeft=textX-.5*width,xRight=xLeft+width,yTop=textY-.5*height,yBottom=yTop+height,edges=[[xLeft,yTop,xLeft,yBottom],[xLeft,yBottom,xRight,yBottom],[xRight,yBottom,xRight,yTop],[xRight,yTop,xLeft,yTop]].map(applyTransform2);if(!edges.reduce(function(a,x){return a^!!Lib.segmentsIntersect(headX,headY,headX+1e6,headY+1e6,x[0],x[1],x[2],x[3])},!1)){edges.forEach(function(x){var p=Lib.segmentsIntersect(tailX,tailY,headX,headY,x[0],x[1],x[2],x[3]);p&&(tailX=p.x,tailY=p.y)});var strokewidth=options.arrowwidth,arrowColor=options.arrowcolor,arrowSide=options.arrowside,arrowGroup=annGroup.append("g").style({opacity:Color.opacity(arrowColor)}).classed("annotation-arrow-g",!0),arrow=arrowGroup.append("path").attr("d","M"+tailX+","+tailY+"L"+headX+","+headY).style("stroke-width",strokewidth+"px").call(Color.stroke,Color.rgb(arrowColor));if(drawArrowHead(arrow,arrowSide,options),edits.annotationPosition&&arrow.node().parentNode&&!subplotId){var arrowDragHeadX=headX,arrowDragHeadY=headY;if(options.standoff){var arrowLength=Math.sqrt(Math.pow(headX-tailX,2)+Math.pow(headY-tailY,2));arrowDragHeadX+=options.standoff*(tailX-headX)/arrowLength,arrowDragHeadY+=options.standoff*(tailY-headY)/arrowLength}var annx0,anny0,arrowDrag=arrowGroup.append("path").classed("annotation-arrow",!0).classed("anndrag",!0).classed("cursor-move",!0).attr({d:"M3,3H-3V-3H3ZM0,0L"+(tailX-arrowDragHeadX)+","+(tailY-arrowDragHeadY),transform:"translate("+arrowDragHeadX+","+arrowDragHeadY+")"}).style("stroke-width",strokewidth+6+"px").call(Color.stroke,"rgba(0,0,0,0)").call(Color.fill,"rgba(0,0,0,0)");dragElement.init({element:arrowDrag.node(),gd:gd,prepFn:function(){var pos=Drawing.getTranslate(annTextGroupInner);annx0=pos.x,anny0=pos.y,xa&&xa.autorange&&modifyBase(xa._name+".autorange",!0),ya&&ya.autorange&&modifyBase(ya._name+".autorange",!0)},moveFn:function(dx,dy){var annxy0=applyTransform(annx0,anny0),xcenter=annxy0[0]+dx,ycenter=annxy0[1]+dy;annTextGroupInner.call(Drawing.setTranslate,xcenter,ycenter),modifyItem("x",xa?xa.p2r(xa.r2p(options.x)+dx):options.x+dx/gs.w),modifyItem("y",ya?ya.p2r(ya.r2p(options.y)+dy):options.y-dy/gs.h),options.axref===options.xref&&modifyItem("ax",xa.p2r(xa.r2p(options.ax)+dx)),options.ayref===options.yref&&modifyItem("ay",ya.p2r(ya.r2p(options.ay)+dy)),arrowGroup.attr("transform","translate("+dx+","+dy+")"),annTextGroup.attr({transform:"rotate("+textangle+","+xcenter+","+ycenter+")"})},doneFn:function(){Registry.call("relayout",gd,getUpdateObj());var notesBox=document.querySelector(".js-notes-box-panel");notesBox&&notesBox.redraw(notesBox.selectedObj)}})}}};if(options.showarrow&&drawArrow(0,0),editTextPosition)dragElement.init({element:annTextGroupInner.node(),gd:gd,prepFn:function(){baseTextTransform=annTextGroup.attr("transform")},moveFn:function(dx,dy){var csr="pointer";if(options.showarrow)options.axref===options.xref?modifyItem("ax",xa.p2r(xa.r2p(options.ax)+dx)):modifyItem("ax",options.ax+dx),options.ayref===options.yref?modifyItem("ay",ya.p2r(ya.r2p(options.ay)+dy)):modifyItem("ay",options.ay+dy),drawArrow(dx,dy);else{if(subplotId)return;var xUpdate,yUpdate;if(xa)xUpdate=xa.p2r(xa.r2p(options.x)+dx);else{var widthFraction=options._xsize/gs.w,xLeft=options.x+(options._xshift-options.xshift)/gs.w-widthFraction/2;xUpdate=dragElement.align(xLeft+dx/gs.w,widthFraction,0,1,options.xanchor)}if(ya)yUpdate=ya.p2r(ya.r2p(options.y)+dy);else{var heightFraction=options._ysize/gs.h,yBottom=options.y-(options._yshift+options.yshift)/gs.h-heightFraction/2;yUpdate=dragElement.align(yBottom-dy/gs.h,heightFraction,0,1,options.yanchor)}modifyItem("x",xUpdate),modifyItem("y",yUpdate),xa&&ya||(csr=dragElement.getCursor(xa?.5:xUpdate,ya?.5:yUpdate,options.xanchor,options.yanchor))}annTextGroup.attr({transform:"translate("+dx+","+dy+")"+baseTextTransform}),setCursor(annTextGroupInner,csr)},doneFn:function(){setCursor(annTextGroupInner),Registry.call("relayout",gd,getUpdateObj());var notesBox=document.querySelector(".js-notes-box-panel");notesBox&&notesBox.redraw(notesBox.selectedObj)}})}else annTextGroupInner.remove()}}module.exports={draw:function draw(gd){var fullLayout=gd._fullLayout;fullLayout._infolayer.selectAll(".annotation").remove();for(var i=0;i<fullLayout.annotations.length;i++)fullLayout.annotations[i].visible&&drawOne(gd,i);return Plots.previousPromises(gd)},drawOne:drawOne,drawRaw:drawRaw}},{"../../lib":693,"../../lib/setcursor":714,"../../lib/svg_text_utils":718,"../../plot_api/plot_template":732,"../../plots/cartesian/axes":742,"../../plots/plots":805,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"../fx":609,"./draw_arrow_head":557,d3:147}],557:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Color=_dereq_("../color"),ARROWPATHS=_dereq_("./arrow_paths");module.exports=function drawArrowHead(el3,ends,options){var start,end,startRot,endRot,el=el3.node(),headStyle=ARROWPATHS[options.arrowhead||0],startHeadStyle=ARROWPATHS[options.startarrowhead||0],scale=(options.arrowwidth||1)*(options.arrowsize||1),startScale=(options.arrowwidth||1)*(options.startarrowsize||1),doStart=ends.indexOf("start")>=0,doEnd=ends.indexOf("end")>=0,backOff=headStyle.backoff*scale+options.standoff,startBackOff=startHeadStyle.backoff*startScale+options.startstandoff;if("line"===el.nodeName){start={x:+el3.attr("x1"),y:+el3.attr("y1")},end={x:+el3.attr("x2"),y:+el3.attr("y2")};var dx=start.x-end.x,dy=start.y-end.y;if(endRot=(startRot=Math.atan2(dy,dx))+Math.PI,backOff&&startBackOff&&backOff+startBackOff>Math.sqrt(dx*dx+dy*dy))return void hideLine();if(backOff){if(backOff*backOff>dx*dx+dy*dy)return void hideLine();var backOffX=backOff*Math.cos(startRot),backOffY=backOff*Math.sin(startRot);end.x+=backOffX,end.y+=backOffY,el3.attr({x2:end.x,y2:end.y})}if(startBackOff){if(startBackOff*startBackOff>dx*dx+dy*dy)return void hideLine();var startBackOffX=startBackOff*Math.cos(startRot),startbackOffY=startBackOff*Math.sin(startRot);start.x-=startBackOffX,start.y-=startbackOffY,el3.attr({x1:start.x,y1:start.y})}}else if("path"===el.nodeName){var pathlen=el.getTotalLength(),dashArray="";if(pathlen<backOff+startBackOff)return void hideLine();var start0=el.getPointAtLength(0),dstart=el.getPointAtLength(.1);startRot=Math.atan2(start0.y-dstart.y,start0.x-dstart.x),start=el.getPointAtLength(Math.min(startBackOff,pathlen)),dashArray="0px,"+startBackOff+"px,";var end0=el.getPointAtLength(pathlen),dend=el.getPointAtLength(pathlen-.1);endRot=Math.atan2(end0.y-dend.y,end0.x-dend.x),end=el.getPointAtLength(Math.max(0,pathlen-backOff)),dashArray+=pathlen-(dashArray?startBackOff+backOff:backOff)+"px,"+pathlen+"px",el3.style("stroke-dasharray",dashArray)}function hideLine(){el3.style("stroke-dasharray","0px,100px")}function drawhead(arrowHeadStyle,p,rot,arrowScale){arrowHeadStyle.path&&(arrowHeadStyle.noRotate&&(rot=0),d3.select(el.parentNode).append("path").attr({class:el3.attr("class"),d:arrowHeadStyle.path,transform:"translate("+p.x+","+p.y+")"+(rot?"rotate("+180*rot/Math.PI+")":"")+"scale("+arrowScale+")"}).style({fill:Color.rgb(options.arrowcolor),"stroke-width":0}))}doStart&&drawhead(startHeadStyle,start,startRot,startScale),doEnd&&drawhead(headStyle,end,endRot,scale)}},{"../color":567,"./arrow_paths":549,d3:147}],558:[function(_dereq_,module,exports){"use strict";var drawModule=_dereq_("./draw"),clickModule=_dereq_("./click");module.exports={moduleType:"component",name:"annotations",layoutAttributes:_dereq_("./attributes"),supplyLayoutDefaults:_dereq_("./defaults"),includeBasePlot:_dereq_("../../plots/cartesian/include_components")("annotations"),calcAutorange:_dereq_("./calc_autorange"),draw:drawModule.draw,drawOne:drawModule.drawOne,drawRaw:drawModule.drawRaw,hasClickToShow:clickModule.hasClickToShow,onClick:clickModule.onClick,convertCoords:_dereq_("./convert_coords")}},{"../../plots/cartesian/include_components":752,"./attributes":550,"./calc_autorange":551,"./click":552,"./convert_coords":554,"./defaults":555,"./draw":556}],559:[function(_dereq_,module,exports){"use strict";var annAtts=_dereq_("../annotations/attributes"),overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;module.exports=overrideAll(templatedArray("annotation",{visible:annAtts.visible,x:{valType:"any"},y:{valType:"any"},z:{valType:"any"},ax:{valType:"number"},ay:{valType:"number"},xanchor:annAtts.xanchor,xshift:annAtts.xshift,yanchor:annAtts.yanchor,yshift:annAtts.yshift,text:annAtts.text,textangle:annAtts.textangle,font:annAtts.font,width:annAtts.width,height:annAtts.height,opacity:annAtts.opacity,align:annAtts.align,valign:annAtts.valign,bgcolor:annAtts.bgcolor,bordercolor:annAtts.bordercolor,borderpad:annAtts.borderpad,borderwidth:annAtts.borderwidth,showarrow:annAtts.showarrow,arrowcolor:annAtts.arrowcolor,arrowhead:annAtts.arrowhead,startarrowhead:annAtts.startarrowhead,arrowside:annAtts.arrowside,arrowsize:annAtts.arrowsize,startarrowsize:annAtts.startarrowsize,arrowwidth:annAtts.arrowwidth,standoff:annAtts.standoff,startstandoff:annAtts.startstandoff,hovertext:annAtts.hovertext,hoverlabel:annAtts.hoverlabel,captureevents:annAtts.captureevents}),"calc","from-root")},{"../../plot_api/edit_types":725,"../../plot_api/plot_template":732,"../annotations/attributes":550}],560:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes");function mockAnnAxes(ann,scene){var domain=scene.fullSceneLayout.domain,size=scene.fullLayout._size,base={pdata:null,type:"linear",autorange:!1,range:[-1/0,1/0]};ann._xa={},Lib.extendFlat(ann._xa,base),Axes.setConvert(ann._xa),ann._xa._offset=size.l+domain.x[0]*size.w,ann._xa.l2p=function(){return.5*(1+ann._pdata[0]/ann._pdata[3])*size.w*(domain.x[1]-domain.x[0])},ann._ya={},Lib.extendFlat(ann._ya,base),Axes.setConvert(ann._ya),ann._ya._offset=size.t+(1-domain.y[1])*size.h,ann._ya.l2p=function(){return.5*(1-ann._pdata[1]/ann._pdata[3])*size.h*(domain.y[1]-domain.y[0])}}module.exports=function convert(scene){for(var anns=scene.fullSceneLayout.annotations,i=0;i<anns.length;i++)mockAnnAxes(anns[i],scene);scene.fullLayout._infolayer.selectAll(".annotation-"+scene.id).remove()}},{"../../lib":693,"../../plots/cartesian/axes":742}],561:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),handleAnnotationCommonDefaults=_dereq_("../annotations/common_defaults"),attributes=_dereq_("./attributes");function handleAnnotationDefaults(annIn,annOut,sceneLayout,opts){function coerce(attr,dflt){return Lib.coerce(annIn,annOut,attributes,attr,dflt)}function coercePosition(axLetter){var axName=axLetter+"axis",gdMock={_fullLayout:{}};return gdMock._fullLayout[axName]=sceneLayout[axName],Axes.coercePosition(annOut,gdMock,coerce,axLetter,axLetter,.5)}coerce("visible")&&(handleAnnotationCommonDefaults(annIn,annOut,opts.fullLayout,coerce),coercePosition("x"),coercePosition("y"),coercePosition("z"),Lib.noneOrAll(annIn,annOut,["x","y","z"]),annOut.xref="x",annOut.yref="y",annOut.zref="z",coerce("xanchor"),coerce("yanchor"),coerce("xshift"),coerce("yshift"),annOut.showarrow&&(annOut.axref="pixel",annOut.ayref="pixel",coerce("ax",-10),coerce("ay",-30),Lib.noneOrAll(annIn,annOut,["ax","ay"])))}module.exports=function handleDefaults(sceneLayoutIn,sceneLayoutOut,opts){handleArrayContainerDefaults(sceneLayoutIn,sceneLayoutOut,{name:"annotations",handleItemDefaults:handleAnnotationDefaults,fullLayout:opts.fullLayout})}},{"../../lib":693,"../../plots/array_container_defaults":738,"../../plots/cartesian/axes":742,"../annotations/common_defaults":553,"./attributes":559}],562:[function(_dereq_,module,exports){"use strict";var drawRaw=_dereq_("../annotations/draw").drawRaw,project=_dereq_("../../plots/gl3d/project"),axLetters=["x","y","z"];module.exports=function draw(scene){for(var fullSceneLayout=scene.fullSceneLayout,dataScale=scene.dataScale,anns=fullSceneLayout.annotations,i=0;i<anns.length;i++){for(var ann=anns[i],annotationIsOffscreen=!1,j=0;j<3;j++){var axLetter=axLetters[j],pos=ann[axLetter],posFraction=fullSceneLayout[axLetter+"axis"].r2fraction(pos);if(posFraction<0||posFraction>1){annotationIsOffscreen=!0;break}}annotationIsOffscreen?scene.fullLayout._infolayer.select(".annotation-"+scene.id+'[data-index="'+i+'"]').remove():(ann._pdata=project(scene.glplot.cameraParams,[fullSceneLayout.xaxis.r2l(ann.x)*dataScale[0],fullSceneLayout.yaxis.r2l(ann.y)*dataScale[1],fullSceneLayout.zaxis.r2l(ann.z)*dataScale[2]]),drawRaw(scene.graphDiv,ann,i,scene.id,ann._xa,ann._ya))}}},{"../../plots/gl3d/project":793,"../annotations/draw":556}],563:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib");module.exports={moduleType:"component",name:"annotations3d",schema:{subplots:{scene:{annotations:_dereq_("./attributes")}}},layoutAttributes:_dereq_("./attributes"),handleDefaults:_dereq_("./defaults"),includeBasePlot:function includeGL3D(layoutIn,layoutOut){var GL3D=Registry.subplotsRegistry.gl3d;if(!GL3D)return;for(var attrRegex=GL3D.attrRegex,keys=Object.keys(layoutIn),i=0;i<keys.length;i++){var k=keys[i];attrRegex.test(k)&&(layoutIn[k].annotations||[]).length&&(Lib.pushUnique(layoutOut._basePlotModules,GL3D),Lib.pushUnique(layoutOut._subplots.gl3d,k))}},convert:_dereq_("./convert"),draw:_dereq_("./draw")}},{"../../lib":693,"../../registry":825,"./attributes":559,"./convert":560,"./defaults":561,"./draw":562}],564:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("world-calendars/dist/main"),_dereq_("world-calendars/dist/plus"),_dereq_("world-calendars/dist/calendars/chinese"),_dereq_("world-calendars/dist/calendars/coptic"),_dereq_("world-calendars/dist/calendars/discworld"),_dereq_("world-calendars/dist/calendars/ethiopian"),_dereq_("world-calendars/dist/calendars/hebrew"),_dereq_("world-calendars/dist/calendars/islamic"),_dereq_("world-calendars/dist/calendars/julian"),_dereq_("world-calendars/dist/calendars/mayan"),_dereq_("world-calendars/dist/calendars/nanakshahi"),_dereq_("world-calendars/dist/calendars/nepali"),_dereq_("world-calendars/dist/calendars/persian"),_dereq_("world-calendars/dist/calendars/taiwan"),_dereq_("world-calendars/dist/calendars/thai"),_dereq_("world-calendars/dist/calendars/ummalqura")},{"world-calendars/dist/calendars/chinese":531,"world-calendars/dist/calendars/coptic":532,"world-calendars/dist/calendars/discworld":533,"world-calendars/dist/calendars/ethiopian":534,"world-calendars/dist/calendars/hebrew":535,"world-calendars/dist/calendars/islamic":536,"world-calendars/dist/calendars/julian":537,"world-calendars/dist/calendars/mayan":538,"world-calendars/dist/calendars/nanakshahi":539,"world-calendars/dist/calendars/nepali":540,"world-calendars/dist/calendars/persian":541,"world-calendars/dist/calendars/taiwan":542,"world-calendars/dist/calendars/thai":543,"world-calendars/dist/calendars/ummalqura":544,"world-calendars/dist/main":545,"world-calendars/dist/plus":546}],565:[function(_dereq_,module,exports){"use strict";var calendars=_dereq_("./calendars"),Lib=_dereq_("../../lib"),constants=_dereq_("../../constants/numerical"),EPOCHJD=constants.EPOCHJD,ONEDAY=constants.ONEDAY,attributes={valType:"enumerated",values:Object.keys(calendars.calendars),editType:"calc",dflt:"gregorian"},handleDefaults=function(contIn,contOut,attr,dflt){var attrs={};return attrs[attr]=attributes,Lib.coerce(contIn,contOut,attrs,attr,dflt)},UNKNOWN="##",d3ToWorldCalendars={d:{0:"dd","-":"d"},e:{0:"d","-":"d"},a:{0:"D","-":"D"},A:{0:"DD","-":"DD"},j:{0:"oo","-":"o"},W:{0:"ww","-":"w"},m:{0:"mm","-":"m"},b:{0:"M","-":"M"},B:{0:"MM","-":"MM"},y:{0:"yy","-":"yy"},Y:{0:"yyyy","-":"yyyy"},U:UNKNOWN,w:UNKNOWN,c:{0:"D M d %X yyyy","-":"D M d %X yyyy"},x:{0:"mm/dd/yyyy","-":"mm/dd/yyyy"}};var allCals={};function getCal(calendar){var calendarObj=allCals[calendar];return calendarObj||(calendarObj=allCals[calendar]=calendars.instance(calendar))}function makeAttrs(description){return Lib.extendFlat({},attributes,{description:description})}function makeTraceAttrsDescription(coord){return"Sets the calendar system to use with `"+coord+"` date data."}var xAttrs={xcalendar:makeAttrs(makeTraceAttrsDescription("x"))},xyAttrs=Lib.extendFlat({},xAttrs,{ycalendar:makeAttrs(makeTraceAttrsDescription("y"))}),xyzAttrs=Lib.extendFlat({},xyAttrs,{zcalendar:makeAttrs(makeTraceAttrsDescription("z"))}),axisAttrs=makeAttrs(["Sets the calendar system to use for `range` and `tick0`","if this is a date axis. This does not set the calendar for","interpreting data on this axis, that's specified in the trace","or via the global `layout.calendar`"].join(" "));module.exports={moduleType:"component",name:"calendars",schema:{traces:{scatter:xyAttrs,bar:xyAttrs,box:xyAttrs,heatmap:xyAttrs,contour:xyAttrs,histogram:xyAttrs,histogram2d:xyAttrs,histogram2dcontour:xyAttrs,scatter3d:xyzAttrs,surface:xyzAttrs,mesh3d:xyzAttrs,scattergl:xyAttrs,ohlc:xAttrs,candlestick:xAttrs},layout:{calendar:makeAttrs(["Sets the default calendar system to use for interpreting and","displaying dates throughout the plot."].join(" "))},subplots:{xaxis:{calendar:axisAttrs},yaxis:{calendar:axisAttrs},scene:{xaxis:{calendar:axisAttrs},yaxis:{calendar:axisAttrs},zaxis:{calendar:axisAttrs}},polar:{radialaxis:{calendar:axisAttrs}}},transforms:{filter:{valuecalendar:makeAttrs(["Sets the calendar system to use for `value`, if it is a date."].join(" ")),targetcalendar:makeAttrs(["Sets the calendar system to use for `target`, if it is an","array of dates. If `target` is a string (eg *x*) we use the","corresponding trace attribute (eg `xcalendar`) if it exists,","even if `targetcalendar` is provided."].join(" "))}}},layoutAttributes:attributes,handleDefaults:handleDefaults,handleTraceDefaults:function(traceIn,traceOut,coords,layout){for(var i=0;i<coords.length;i++)handleDefaults(traceIn,traceOut,coords[i]+"calendar",layout.calendar)},CANONICAL_SUNDAY:{chinese:"2000-01-02",coptic:"2000-01-03",discworld:"2000-01-03",ethiopian:"2000-01-05",hebrew:"5000-01-01",islamic:"1000-01-02",julian:"2000-01-03",mayan:"5000-01-01",nanakshahi:"1000-01-05",nepali:"2000-01-05",persian:"1000-01-01",jalali:"1000-01-01",taiwan:"1000-01-04",thai:"2000-01-04",ummalqura:"1400-01-06"},CANONICAL_TICK:{chinese:"2000-01-01",coptic:"2000-01-01",discworld:"2000-01-01",ethiopian:"2000-01-01",hebrew:"5000-01-01",islamic:"1000-01-01",julian:"2000-01-01",mayan:"5000-01-01",nanakshahi:"1000-01-01",nepali:"2000-01-01",persian:"1000-01-01",jalali:"1000-01-01",taiwan:"1000-01-01",thai:"2000-01-01",ummalqura:"1400-01-01"},DFLTRANGE:{chinese:["2000-01-01","2001-01-01"],coptic:["1700-01-01","1701-01-01"],discworld:["1800-01-01","1801-01-01"],ethiopian:["2000-01-01","2001-01-01"],hebrew:["5700-01-01","5701-01-01"],islamic:["1400-01-01","1401-01-01"],julian:["2000-01-01","2001-01-01"],mayan:["5200-01-01","5201-01-01"],nanakshahi:["0500-01-01","0501-01-01"],nepali:["2000-01-01","2001-01-01"],persian:["1400-01-01","1401-01-01"],jalali:["1400-01-01","1401-01-01"],taiwan:["0100-01-01","0101-01-01"],thai:["2500-01-01","2501-01-01"],ummalqura:["1400-01-01","1401-01-01"]},getCal:getCal,worldCalFmt:function worldCalFmt(fmt,x,calendar){for(var modifier,directive,directiveLen,directiveObj,replacementPart,dateJD=Math.floor((x+.05)/ONEDAY)+EPOCHJD,cDate=getCal(calendar).fromJD(dateJD),i=0;-1!==(i=fmt.indexOf("%",i));)"0"===(modifier=fmt.charAt(i+1))||"-"===modifier||"_"===modifier?(directiveLen=3,directive=fmt.charAt(i+2),"_"===modifier&&(modifier="-")):(directive=modifier,modifier="0",directiveLen=2),(directiveObj=d3ToWorldCalendars[directive])?(replacementPart=directiveObj===UNKNOWN?UNKNOWN:cDate.formatDate(directiveObj[modifier]),fmt=fmt.substr(0,i)+replacementPart+fmt.substr(i+directiveLen),i+=replacementPart.length):i+=directiveLen;return fmt}}},{"../../constants/numerical":670,"../../lib":693,"./calendars":564}],566:[function(_dereq_,module,exports){"use strict";exports.defaults=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],exports.defaultLine="#444",exports.lightLine="#eee",exports.background="#fff",exports.borderLine="#BEC8D9",exports.lightFraction=1e3/11},{}],567:[function(_dereq_,module,exports){"use strict";var tinycolor=_dereq_("tinycolor2"),isNumeric=_dereq_("fast-isnumeric"),color=module.exports={},colorAttrs=_dereq_("./attributes");color.defaults=colorAttrs.defaults;var defaultLine=color.defaultLine=colorAttrs.defaultLine;color.lightLine=colorAttrs.lightLine;var background=color.background=colorAttrs.background;function cleanOne(val){if(isNumeric(val)||"string"!=typeof val)return val;var valTrim=val.trim();if("rgb"!==valTrim.substr(0,3))return val;var match=valTrim.match(/^rgba?\s*\(([^()]*)\)$/);if(!match)return val;var parts=match[1].trim().split(/\s*[\s,]\s*/),rgba="a"===valTrim.charAt(3)&&4===parts.length;if(!rgba&&3!==parts.length)return val;for(var i=0;i<parts.length;i++){if(!parts[i].length)return val;if(parts[i]=Number(parts[i]),!(parts[i]>=0))return val;if(3===i)parts[i]>1&&(parts[i]=1);else if(parts[i]>=1)return val}var rgbStr=Math.round(255*parts[0])+", "+Math.round(255*parts[1])+", "+Math.round(255*parts[2]);return rgba?"rgba("+rgbStr+", "+parts[3]+")":"rgb("+rgbStr+")"}color.tinyRGB=function(tc){var c=tc.toRgb();return"rgb("+Math.round(c.r)+", "+Math.round(c.g)+", "+Math.round(c.b)+")"},color.rgb=function(cstr){return color.tinyRGB(tinycolor(cstr))},color.opacity=function(cstr){return cstr?tinycolor(cstr).getAlpha():0},color.addOpacity=function(cstr,op){var c=tinycolor(cstr).toRgb();return"rgba("+Math.round(c.r)+", "+Math.round(c.g)+", "+Math.round(c.b)+", "+op+")"},color.combine=function(front,back){var fc=tinycolor(front).toRgb();if(1===fc.a)return tinycolor(front).toRgbString();var bc=tinycolor(back||background).toRgb(),bcflat=1===bc.a?bc:{r:255*(1-bc.a)+bc.r*bc.a,g:255*(1-bc.a)+bc.g*bc.a,b:255*(1-bc.a)+bc.b*bc.a},fcflat={r:bcflat.r*(1-fc.a)+fc.r*fc.a,g:bcflat.g*(1-fc.a)+fc.g*fc.a,b:bcflat.b*(1-fc.a)+fc.b*fc.a};return tinycolor(fcflat).toRgbString()},color.contrast=function(cstr,lightAmount,darkAmount){var tc=tinycolor(cstr);return 1!==tc.getAlpha()&&(tc=tinycolor(color.combine(cstr,background))),(tc.isDark()?lightAmount?tc.lighten(lightAmount):background:darkAmount?tc.darken(darkAmount):defaultLine).toString()},color.stroke=function(s,c){var tc=tinycolor(c);s.style({stroke:color.tinyRGB(tc),"stroke-opacity":tc.getAlpha()})},color.fill=function(s,c){var tc=tinycolor(c);s.style({fill:color.tinyRGB(tc),"fill-opacity":tc.getAlpha()})},color.clean=function(container){if(container&&"object"==typeof container){var i,j,key,val,keys=Object.keys(container);for(i=0;i<keys.length;i++)if(val=container[key=keys[i]],"color"===key.substr(key.length-5))if(Array.isArray(val))for(j=0;j<val.length;j++)val[j]=cleanOne(val[j]);else container[key]=cleanOne(val);else if("colorscale"===key.substr(key.length-10)&&Array.isArray(val))for(j=0;j<val.length;j++)Array.isArray(val[j])&&(val[j][1]=cleanOne(val[j][1]));else if(Array.isArray(val)){var el0=val[0];if(!Array.isArray(el0)&&el0&&"object"==typeof el0)for(j=0;j<val.length;j++)color.clean(val[j])}else val&&"object"==typeof val&&color.clean(val)}}},{"./attributes":566,"fast-isnumeric":213,tinycolor2:511}],568:[function(_dereq_,module,exports){"use strict";var axesAttrs=_dereq_("../../plots/cartesian/layout_attributes"),fontAttrs=_dereq_("../../plots/font_attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll;module.exports=overrideAll({thicknessmode:{valType:"enumerated",values:["fraction","pixels"],dflt:"pixels"},thickness:{valType:"number",min:0,dflt:30},lenmode:{valType:"enumerated",values:["fraction","pixels"],dflt:"fraction"},len:{valType:"number",min:0,dflt:1},x:{valType:"number",dflt:1.02,min:-2,max:3},xanchor:{valType:"enumerated",values:["left","center","right"],dflt:"left"},xpad:{valType:"number",min:0,dflt:10},y:{valType:"number",dflt:.5,min:-2,max:3},yanchor:{valType:"enumerated",values:["top","middle","bottom"],dflt:"middle"},ypad:{valType:"number",min:0,dflt:10},outlinecolor:axesAttrs.linecolor,outlinewidth:axesAttrs.linewidth,bordercolor:axesAttrs.linecolor,borderwidth:{valType:"number",min:0,dflt:0},bgcolor:{valType:"color",dflt:"rgba(0,0,0,0)"},tickmode:axesAttrs.tickmode,nticks:axesAttrs.nticks,tick0:axesAttrs.tick0,dtick:axesAttrs.dtick,tickvals:axesAttrs.tickvals,ticktext:axesAttrs.ticktext,ticks:extendFlat({},axesAttrs.ticks,{dflt:""}),ticklen:axesAttrs.ticklen,tickwidth:axesAttrs.tickwidth,tickcolor:axesAttrs.tickcolor,showticklabels:axesAttrs.showticklabels,tickfont:fontAttrs({}),tickangle:axesAttrs.tickangle,tickformat:axesAttrs.tickformat,tickformatstops:axesAttrs.tickformatstops,tickprefix:axesAttrs.tickprefix,showtickprefix:axesAttrs.showtickprefix,ticksuffix:axesAttrs.ticksuffix,showticksuffix:axesAttrs.showticksuffix,separatethousands:axesAttrs.separatethousands,exponentformat:axesAttrs.exponentformat,showexponent:axesAttrs.showexponent,title:{valType:"string"},titlefont:fontAttrs({}),titleside:{valType:"enumerated",values:["right","top","bottom"],dflt:"top"}},"colorbars","from-root")},{"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/cartesian/layout_attributes":754,"../../plots/font_attributes":768}],569:[function(_dereq_,module,exports){"use strict";var drawColorbar=_dereq_("./draw");module.exports=function connectColorbar(gd,cd,moduleOpts){if("function"==typeof moduleOpts)return moduleOpts(gd,cd);var trace=cd[0].trace,cbId="cb"+trace.uid,containerName=moduleOpts.container,container=containerName?trace[containerName]:trace;(gd._fullLayout._infolayer.selectAll("."+cbId).remove(),container&&container.showscale)&&(cd[0].t.cb=drawColorbar(gd,cbId)).fillgradient(container.colorscale).zrange([container[moduleOpts.min],container[moduleOpts.max]]).options(container.colorbar)()}},{"./draw":572}],570:[function(_dereq_,module,exports){"use strict";module.exports={cn:{colorbar:"colorbar",cbbg:"cbbg",cbfill:"cbfill",cbfills:"cbfills",cbline:"cbline",cblines:"cblines",cbaxis:"cbaxis",cbtitleunshift:"cbtitleunshift",cbtitle:"cbtitle",cboutline:"cboutline",crisp:"crisp",jsPlaceholder:"js-placeholder"}}},{}],571:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Template=_dereq_("../../plot_api/plot_template"),handleTickValueDefaults=_dereq_("../../plots/cartesian/tick_value_defaults"),handleTickMarkDefaults=_dereq_("../../plots/cartesian/tick_mark_defaults"),handleTickLabelDefaults=_dereq_("../../plots/cartesian/tick_label_defaults"),attributes=_dereq_("./attributes");module.exports=function colorbarDefaults(containerIn,containerOut,layout){var colorbarOut=Template.newContainer(containerOut,"colorbar"),colorbarIn=containerIn.colorbar||{};function coerce(attr,dflt){return Lib.coerce(colorbarIn,colorbarOut,attributes,attr,dflt)}coerce("thickness","fraction"===coerce("thicknessmode")?30/(layout.width-layout.margin.l-layout.margin.r):30),coerce("len","fraction"===coerce("lenmode")?1:layout.height-layout.margin.t-layout.margin.b),coerce("x"),coerce("xanchor"),coerce("xpad"),coerce("y"),coerce("yanchor"),coerce("ypad"),Lib.noneOrAll(colorbarIn,colorbarOut,["x","y"]),coerce("outlinecolor"),coerce("outlinewidth"),coerce("bordercolor"),coerce("borderwidth"),coerce("bgcolor"),handleTickValueDefaults(colorbarIn,colorbarOut,coerce,"linear");var opts={outerTicks:!1,font:layout.font};handleTickLabelDefaults(colorbarIn,colorbarOut,coerce,"linear",opts),handleTickMarkDefaults(colorbarIn,colorbarOut,coerce,"linear",opts),coerce("title",layout._dfltTitle.colorbar),Lib.coerceFont(coerce,"titlefont",layout.font),coerce("titleside")}},{"../../lib":693,"../../plot_api/plot_template":732,"../../plots/cartesian/tick_label_defaults":761,"../../plots/cartesian/tick_mark_defaults":762,"../../plots/cartesian/tick_value_defaults":763,"./attributes":568}],572:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),Plots=_dereq_("../../plots/plots"),Registry=_dereq_("../../registry"),Axes=_dereq_("../../plots/cartesian/axes"),dragElement=_dereq_("../dragelement"),Lib=_dereq_("../../lib"),extendFlat=_dereq_("../../lib/extend").extendFlat,setCursor=_dereq_("../../lib/setcursor"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),Titles=_dereq_("../titles"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),alignmentConstants=_dereq_("../../constants/alignment"),LINE_SPACING=alignmentConstants.LINE_SPACING,FROM_TL=alignmentConstants.FROM_TL,FROM_BR=alignmentConstants.FROM_BR,handleAxisDefaults=_dereq_("../../plots/cartesian/axis_defaults"),handleAxisPositionDefaults=_dereq_("../../plots/cartesian/position_defaults"),axisLayoutAttrs=_dereq_("../../plots/cartesian/layout_attributes"),attributes=_dereq_("./attributes"),cn=_dereq_("./constants").cn;module.exports=function draw(gd,id){var opts={};for(var k in attributes)opts[k]=null;function component(){var fullLayout=gd._fullLayout,gs=fullLayout._size;if("function"==typeof opts.fillcolor||"function"==typeof opts.line.color||opts.fillgradient){var l,i,zrange=opts.zrange||d3.extent(("function"==typeof opts.fillcolor?opts.fillcolor:opts.line.color).domain()),linelevels=[],filllevels=[],linecolormap="function"==typeof opts.line.color?opts.line.color:function(){return opts.line.color},fillcolormap="function"==typeof opts.fillcolor?opts.fillcolor:function(){return opts.fillcolor},l0=opts.levels.end+opts.levels.size/100,ls=opts.levels.size,zr0=1.001*zrange[0]-.001*zrange[1],zr1=1.001*zrange[1]-.001*zrange[0];for(i=0;i<1e5&&(l=opts.levels.start+i*ls,!(ls>0?l>=l0:l<=l0));i++)l>zr0&&l<zr1&&linelevels.push(l);if(opts.fillgradient)filllevels=[0];else if("function"==typeof opts.fillcolor)if(opts.filllevels)for(l0=opts.filllevels.end+opts.filllevels.size/100,ls=opts.filllevels.size,i=0;i<1e5&&(l=opts.filllevels.start+i*ls,!(ls>0?l>=l0:l<=l0));i++)l>zrange[0]&&l<zrange[1]&&filllevels.push(l);else(filllevels=linelevels.map(function(v){return v-opts.levels.size/2})).push(filllevels[filllevels.length-1]+opts.levels.size);else opts.fillcolor&&"string"==typeof opts.fillcolor&&(filllevels=[0]);opts.levels.size<0&&(linelevels.reverse(),filllevels.reverse());var titleEl,plotHeight=gs.h,plotWidth=gs.w,thickPx=Math.round(opts.thickness*("fraction"===opts.thicknessmode?plotWidth:1)),thickFrac=thickPx/gs.w,lenPx=Math.round(opts.len*("fraction"===opts.lenmode?plotHeight:1)),lenFrac=lenPx/gs.h,xpadFrac=opts.xpad/gs.w,yExtraPx=(opts.borderwidth+opts.outlinewidth)/2,ypadFrac=opts.ypad/gs.h,xLeft=Math.round(opts.x*gs.w+opts.xpad),xLeftFrac=opts.x-thickFrac*({middle:.5,right:1}[opts.xanchor]||0),yBottomFrac=opts.y+lenFrac*(({top:-.5,bottom:.5}[opts.yanchor]||0)-.5),yBottomPx=Math.round(gs.h*(1-yBottomFrac)),yTopPx=yBottomPx-lenPx,cbAxisIn={type:"linear",range:zrange,tickmode:opts.tickmode,nticks:opts.nticks,tick0:opts.tick0,dtick:opts.dtick,tickvals:opts.tickvals,ticktext:opts.ticktext,ticks:opts.ticks,ticklen:opts.ticklen,tickwidth:opts.tickwidth,tickcolor:opts.tickcolor,showticklabels:opts.showticklabels,tickfont:opts.tickfont,tickangle:opts.tickangle,tickformat:opts.tickformat,exponentformat:opts.exponentformat,separatethousands:opts.separatethousands,showexponent:opts.showexponent,showtickprefix:opts.showtickprefix,tickprefix:opts.tickprefix,showticksuffix:opts.showticksuffix,ticksuffix:opts.ticksuffix,title:opts.title,titlefont:opts.titlefont,showline:!0,anchor:"free",position:1},cbAxisOut={type:"linear",_id:"y"+id},axisOptions={letter:"y",font:fullLayout.font,noHover:!0,calendar:fullLayout.calendar};if(handleAxisDefaults(cbAxisIn,cbAxisOut,coerce,axisOptions,fullLayout),handleAxisPositionDefaults(cbAxisIn,cbAxisOut,coerce,axisOptions),cbAxisOut.position=opts.x+xpadFrac+thickFrac,component.axis=cbAxisOut,-1!==["top","bottom"].indexOf(opts.titleside)&&(cbAxisOut.titleside=opts.titleside,cbAxisOut.titlex=opts.x+xpadFrac,cbAxisOut.titley=yBottomFrac+("top"===opts.titleside?lenFrac-ypadFrac:ypadFrac)),opts.line.color&&"auto"===opts.tickmode){cbAxisOut.tickmode="linear",cbAxisOut.tick0=opts.levels.start;var dtick=opts.levels.size,autoNtick=Lib.constrain((yBottomPx-yTopPx)/50,4,15)+1,dtFactor=(zrange[1]-zrange[0])/((opts.nticks||autoNtick)*dtick);if(dtFactor>1){var dtexp=Math.pow(10,Math.floor(Math.log(dtFactor)/Math.LN10));dtick*=dtexp*Lib.roundUp(dtFactor/dtexp,[2,5,10]),(Math.abs(opts.levels.start)/opts.levels.size+1e-6)%1<2e-6&&(cbAxisOut.tick0=0)}cbAxisOut.dtick=dtick}cbAxisOut.domain=[yBottomFrac+ypadFrac,yBottomFrac+lenFrac-ypadFrac],cbAxisOut.setScale();var container=Lib.ensureSingle(fullLayout._infolayer,"g",id,function(s){s.classed(cn.colorbar,!0).each(function(){var s=d3.select(this);s.append("rect").classed(cn.cbbg,!0),s.append("g").classed(cn.cbfills,!0),s.append("g").classed(cn.cblines,!0),s.append("g").classed(cn.cbaxis,!0).classed(cn.crisp,!0),s.append("g").classed(cn.cbtitleunshift,!0).append("g").classed(cn.cbtitle,!0),s.append("rect").classed(cn.cboutline,!0),s.select(".cbtitle").datum(0)})});container.attr("transform","translate("+Math.round(gs.l)+","+Math.round(gs.t)+")");var titleCont=container.select(".cbtitleunshift").attr("transform","translate(-"+Math.round(gs.l)+",-"+Math.round(gs.t)+")");cbAxisOut._axislayer=container.select(".cbaxis");var titleHeight=0;if(-1!==["top","bottom"].indexOf(opts.titleside)){var y,x=gs.l+(opts.x+xpadFrac)*gs.w,fontSize=cbAxisOut.titlefont.size;y="top"===opts.titleside?(1-(yBottomFrac+lenFrac-ypadFrac))*gs.h+gs.t+3+.75*fontSize:(1-(yBottomFrac+ypadFrac))*gs.h+gs.t-3-.25*fontSize,drawTitle(cbAxisOut._id+"title",{attributes:{x:x,y:y,"text-anchor":"start"}})}var t0,xf,yf,cbDone=Lib.syncOrAsync([Plots.previousPromises,function drawAxis(){if(-1!==["top","bottom"].indexOf(opts.titleside)){var titleGroup=container.select(".cbtitle"),titleText=titleGroup.select("text"),titleTrans=[-opts.outlinewidth/2,opts.outlinewidth/2],mathJaxNode=titleGroup.select(".h"+cbAxisOut._id+"title-math-group").node(),lineSize=15.6;if(titleText.node()&&(lineSize=parseInt(titleText.node().style.fontSize,10)*LINE_SPACING),mathJaxNode?(titleHeight=Drawing.bBox(mathJaxNode).height)>lineSize&&(titleTrans[1]-=(titleHeight-lineSize)/2):titleText.node()&&!titleText.classed(cn.jsPlaceholder)&&(titleHeight=Drawing.bBox(titleText.node()).height),titleHeight){if(titleHeight+=5,"top"===opts.titleside)cbAxisOut.domain[1]-=titleHeight/gs.h,titleTrans[1]*=-1;else{cbAxisOut.domain[0]+=titleHeight/gs.h;var nlines=svgTextUtils.lineCount(titleText);titleTrans[1]+=(1-nlines)*lineSize}titleGroup.attr("transform","translate("+titleTrans+")"),cbAxisOut.setScale()}}container.selectAll(".cbfills,.cblines").attr("transform","translate(0,"+Math.round(gs.h*(1-cbAxisOut.domain[1]))+")"),cbAxisOut._axislayer.attr("transform","translate(0,"+Math.round(-gs.t)+")");var fills=container.select(".cbfills").selectAll("rect.cbfill").data(filllevels);fills.enter().append("rect").classed(cn.cbfill,!0).style("stroke","none"),fills.exit().remove();var zBounds=zrange.map(cbAxisOut.c2p).map(Math.round).sort(function(a,b){return a-b});fills.each(function(d,i){var z=[0===i?zrange[0]:(filllevels[i]+filllevels[i-1])/2,i===filllevels.length-1?zrange[1]:(filllevels[i]+filllevels[i+1])/2].map(cbAxisOut.c2p).map(Math.round);z[1]=Lib.constrain(z[1]+(z[1]>z[0])?1:-1,zBounds[0],zBounds[1]);var fillEl=d3.select(this).attr({x:xLeft,width:Math.max(thickPx,2),y:d3.min(z),height:Math.max(d3.max(z)-d3.min(z),2)});if(opts.fillgradient)Drawing.gradient(fillEl,gd,id,"vertical",opts.fillgradient,"fill");else{var colorString=fillcolormap(d).replace("e-","");fillEl.attr("fill",tinycolor(colorString).toHexString())}});var lines=container.select(".cblines").selectAll("path.cbline").data(opts.line.color&&opts.line.width?linelevels:[]);return lines.enter().append("path").classed(cn.cbline,!0),lines.exit().remove(),lines.each(function(d){d3.select(this).attr("d","M"+xLeft+","+(Math.round(cbAxisOut.c2p(d))+opts.line.width/2%1)+"h"+thickPx).call(Drawing.lineGroupStyle,opts.line.width,linecolormap(d),opts.line.dash)}),cbAxisOut._axislayer.selectAll("g."+cbAxisOut._id+"tick,path").remove(),cbAxisOut._pos=xLeft+thickPx+(opts.outlinewidth||0)/2-("outside"===opts.ticks?1:0),cbAxisOut.side="right",Lib.syncOrAsync([function(){return Axes.doTicksSingle(gd,cbAxisOut,!0)},function(){if(-1===["top","bottom"].indexOf(opts.titleside)){var fontSize=cbAxisOut.titlefont.size,y=cbAxisOut._offset+cbAxisOut._length/2,x=gs.l+(cbAxisOut.position||0)*gs.w+("right"===cbAxisOut.side?10+fontSize*(cbAxisOut.showticklabels?1:.5):-10-fontSize*(cbAxisOut.showticklabels?.5:0));drawTitle("h"+cbAxisOut._id+"title",{avoid:{selection:d3.select(gd).selectAll("g."+cbAxisOut._id+"tick"),side:opts.titleside,offsetLeft:gs.l,offsetTop:0,maxShift:fullLayout.width},attributes:{x:x,y:y,"text-anchor":"middle"},transform:{rotate:"-90",offset:0}})}}])},Plots.previousPromises,function positionCB(){var innerWidth=thickPx+opts.outlinewidth/2+Drawing.bBox(cbAxisOut._axislayer.node()).width;if((titleEl=titleCont.select("text")).node()&&!titleEl.classed(cn.jsPlaceholder)){var titleWidth,mathJaxNode=titleCont.select(".h"+cbAxisOut._id+"title-math-group").node();titleWidth=mathJaxNode&&-1!==["top","bottom"].indexOf(opts.titleside)?Drawing.bBox(mathJaxNode).width:Drawing.bBox(titleCont.node()).right-xLeft-gs.l,innerWidth=Math.max(innerWidth,titleWidth)}var outerwidth=2*opts.xpad+innerWidth+opts.borderwidth+opts.outlinewidth/2,outerheight=yBottomPx-yTopPx;container.select(".cbbg").attr({x:xLeft-opts.xpad-(opts.borderwidth+opts.outlinewidth)/2,y:yTopPx-yExtraPx,width:Math.max(outerwidth,2),height:Math.max(outerheight+2*yExtraPx,2)}).call(Color.fill,opts.bgcolor).call(Color.stroke,opts.bordercolor).style({"stroke-width":opts.borderwidth}),container.selectAll(".cboutline").attr({x:xLeft,y:yTopPx+opts.ypad+("top"===opts.titleside?titleHeight:0),width:Math.max(thickPx,2),height:Math.max(outerheight-2*opts.ypad-titleHeight,2)}).call(Color.stroke,opts.outlinecolor).style({fill:"None","stroke-width":opts.outlinewidth});var xoffset=({center:.5,right:1}[opts.xanchor]||0)*outerwidth;container.attr("transform","translate("+(gs.l-xoffset)+","+gs.t+")");var marginOpts={},tFrac=FROM_TL[opts.yanchor],bFrac=FROM_BR[opts.yanchor];"pixels"===opts.lenmode?(marginOpts.y=opts.y,marginOpts.t=outerheight*tFrac,marginOpts.b=outerheight*bFrac):(marginOpts.t=marginOpts.b=0,marginOpts.yt=opts.y+opts.len*tFrac,marginOpts.yb=opts.y-opts.len*bFrac);var lFrac=FROM_TL[opts.xanchor],rFrac=FROM_BR[opts.xanchor];if("pixels"===opts.thicknessmode)marginOpts.x=opts.x,marginOpts.l=outerwidth*lFrac,marginOpts.r=outerwidth*rFrac;else{var extraThickness=outerwidth-thickPx;marginOpts.l=extraThickness*lFrac,marginOpts.r=extraThickness*rFrac,marginOpts.xl=opts.x-opts.thickness*lFrac,marginOpts.xr=opts.x+opts.thickness*rFrac}Plots.autoMargin(gd,id,marginOpts)}],gd);if(cbDone&&cbDone.then&&(gd._promises||[]).push(cbDone),gd._context.edits.colorbarPosition)dragElement.init({element:container.node(),gd:gd,prepFn:function(){t0=container.attr("transform"),setCursor(container)},moveFn:function(dx,dy){container.attr("transform",t0+" translate("+dx+","+dy+")"),xf=dragElement.align(xLeftFrac+dx/gs.w,thickFrac,0,1,opts.xanchor),yf=dragElement.align(yBottomFrac-dy/gs.h,lenFrac,0,1,opts.yanchor);var csr=dragElement.getCursor(xf,yf,opts.xanchor,opts.yanchor);setCursor(container,csr)},doneFn:function(){setCursor(container),void 0!==xf&&void 0!==yf&&Registry.call("restyle",gd,{"colorbar.x":xf,"colorbar.y":yf},getTrace().index)}});return cbDone}function coerce(attr,dflt){return Lib.coerce(cbAxisIn,cbAxisOut,axisLayoutAttrs,attr,dflt)}function drawTitle(titleClass,titleOpts){var trace=getTrace(),propName="colorbar.title",containerName=trace._module.colorbar.container;containerName&&(propName=containerName+"."+propName);var dfltTitleOpts={propContainer:cbAxisOut,propName:propName,traceIndex:trace.index,placeholder:fullLayout._dfltTitle.colorbar,containerGroup:container.select(".cbtitle")},otherClass="h"===titleClass.charAt(0)?titleClass.substr(1):"h"+titleClass;container.selectAll("."+otherClass+",."+otherClass+"-math-group").remove(),Titles.draw(gd,titleClass,extendFlat(dfltTitleOpts,titleOpts||{}))}fullLayout._infolayer.selectAll("g."+id).remove()}function getTrace(){var i,trace,idNum=id.substr(2);for(i=0;i<gd._fullData.length;i++)if((trace=gd._fullData[i]).uid===idNum)return trace}return opts.fillcolor=null,opts.line={color:null,width:null,dash:null},opts.levels={start:null,end:null,size:null},opts.filllevels=null,opts.fillgradient=null,opts.zrange=null,Object.keys(opts).forEach(function(name){component[name]=function(v){return arguments.length?(opts[name]=Lib.isPlainObject(opts[name])?Lib.extendFlat(opts[name],v):v,component):opts[name]}}),component.options=function(o){for(var name in o)"function"==typeof component[name]&&component[name](o[name]);return component},component._opts=opts,component}},{"../../constants/alignment":665,"../../lib":693,"../../lib/extend":682,"../../lib/setcursor":714,"../../lib/svg_text_utils":718,"../../plots/cartesian/axes":742,"../../plots/cartesian/axis_defaults":744,"../../plots/cartesian/layout_attributes":754,"../../plots/cartesian/position_defaults":757,"../../plots/plots":805,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"../titles":658,"./attributes":568,"./constants":570,d3:147,tinycolor2:511}],573:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function hasColorbar(container){return Lib.isPlainObject(container.colorbar)}},{"../../lib":693}],574:[function(_dereq_,module,exports){"use strict";var palettes=_dereq_("./scales.js");Object.keys(palettes);function code(s){return"`"+s+"`"}module.exports=function colorScaleAttrs(context,opts){context=context||"";var colorAttr,cLetter=(opts=opts||{}).cLetter||"c",noScale=("onlyIfNumerical"in opts?opts.onlyIfNumerical:Boolean(context),"noScale"in opts?opts.noScale:"marker.line"===context),showScaleDflt="showScaleDflt"in opts?opts.showScaleDflt:"z"===cLetter,colorscaleDflt="string"==typeof opts.colorscaleDflt?palettes[opts.colorscaleDflt]:null,editTypeOverride=opts.editTypeOverride||"",contextHead=context?context+".":"";"colorAttr"in opts?(colorAttr=opts.colorAttr,opts.colorAttr):code(contextHead+(colorAttr={z:"z",c:"color"}[cLetter]));var auto=cLetter+"auto",min=cLetter+"min",max=cLetter+"max",autoImpliedEdits=(code(contextHead+min),code(contextHead+max),{});autoImpliedEdits[min]=autoImpliedEdits[max]=void 0;var minmaxImpliedEdits={};minmaxImpliedEdits[auto]=!1;var attrs={};return"color"===colorAttr&&(attrs.color={valType:"color",arrayOk:!0,editType:editTypeOverride||"style"}),attrs[auto]={valType:"boolean",dflt:!0,editType:"calc",impliedEdits:autoImpliedEdits},attrs[min]={valType:"number",dflt:null,editType:editTypeOverride||"plot",impliedEdits:minmaxImpliedEdits},attrs[max]={valType:"number",dflt:null,editType:editTypeOverride||"plot",impliedEdits:minmaxImpliedEdits},attrs.colorscale={valType:"colorscale",editType:"calc",dflt:colorscaleDflt,impliedEdits:{autocolorscale:!1}},attrs.autocolorscale={valType:"boolean",dflt:!1!==opts.autoColorDflt,editType:"calc",impliedEdits:{colorscale:void 0}},attrs.reversescale={valType:"boolean",dflt:!1,editType:"calc"},noScale||(attrs.showscale={valType:"boolean",dflt:showScaleDflt,editType:"calc"}),attrs}},{"./scales.js":586}],575:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),scales=_dereq_("./scales"),flipScale=_dereq_("./flip_scale");module.exports=function calc(trace,vals,containerStr,cLetter){var container=trace,inputContainer=trace._input,fullInputContainer=trace._fullInput,updateStyle=trace.updateStyle;function doUpdate(attr,inputVal,fullVal){void 0===fullVal&&(fullVal=inputVal),updateStyle?updateStyle(trace._input,containerStr?containerStr+"."+attr:attr,inputVal):inputContainer[attr]=inputVal,container[attr]=fullVal,fullInputContainer&&trace!==trace._fullInput&&(updateStyle?updateStyle(trace._fullInput,containerStr?containerStr+"."+attr:attr,fullVal):fullInputContainer[attr]=fullVal)}containerStr&&(container=Lib.nestedProperty(container,containerStr).get(),inputContainer=Lib.nestedProperty(inputContainer,containerStr).get(),fullInputContainer=Lib.nestedProperty(fullInputContainer,containerStr).get()||{});var autoAttr=cLetter+"auto",minAttr=cLetter+"min",maxAttr=cLetter+"max",auto=container[autoAttr],min=container[minAttr],max=container[maxAttr],scl=container.colorscale;!1===auto&&void 0!==min||(min=Lib.aggNums(Math.min,null,vals)),!1===auto&&void 0!==max||(max=Lib.aggNums(Math.max,null,vals)),min===max&&(min-=.5,max+=.5),doUpdate(minAttr,min),doUpdate(maxAttr,max),doUpdate(autoAttr,!1!==auto||void 0===min&&void 0===max),container.autocolorscale&&(doUpdate("colorscale",scl=min*max<0?scales.RdBu:min>=0?scales.Reds:scales.Blues,container.reversescale?flipScale(scl):scl),inputContainer.autocolorscale||doUpdate("autocolorscale",!1))}},{"../../lib":693,"./flip_scale":579,"./scales":586}],576:[function(_dereq_,module,exports){"use strict";var scales=_dereq_("./scales");module.exports=scales.RdBu},{"./scales":586}],577:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),hasColorbar=_dereq_("../colorbar/has_colorbar"),colorbarDefaults=_dereq_("../colorbar/defaults"),isValidScale=_dereq_("./is_valid_scale"),flipScale=_dereq_("./flip_scale");module.exports=function colorScaleDefaults(traceIn,traceOut,layout,coerce,opts){var autoColorscaleDflt,prefix=opts.prefix,cLetter=opts.cLetter,containerStr=prefix.slice(0,prefix.length-1),containerIn=prefix?Lib.nestedProperty(traceIn,containerStr).get()||{}:traceIn,containerOut=prefix?Lib.nestedProperty(traceOut,containerStr).get()||{}:traceOut,minIn=containerIn[cLetter+"min"],maxIn=containerIn[cLetter+"max"],sclIn=containerIn.colorscale;coerce(prefix+cLetter+"auto",!(isNumeric(minIn)&&isNumeric(maxIn)&&minIn<maxIn)),coerce(prefix+cLetter+"min"),coerce(prefix+cLetter+"max"),void 0!==sclIn&&(autoColorscaleDflt=!isValidScale(sclIn)),coerce(prefix+"autocolorscale",autoColorscaleDflt);var showScaleDflt,sclOut=coerce(prefix+"colorscale");(coerce(prefix+"reversescale")&&(containerOut.colorscale=flipScale(sclOut)),"marker.line."!==prefix)&&(opts.noScale||(prefix&&(showScaleDflt=hasColorbar(containerIn)),coerce(prefix+"showscale",showScaleDflt)&&colorbarDefaults(containerIn,containerOut,layout)))}},{"../../lib":693,"../colorbar/defaults":571,"../colorbar/has_colorbar":573,"./flip_scale":579,"./is_valid_scale":583,"fast-isnumeric":213}],578:[function(_dereq_,module,exports){"use strict";module.exports=function extractScale(scl,cmin,cmax){for(var N=scl.length,domain=new Array(N),range=new Array(N),i=0;i<N;i++){var si=scl[i];domain[i]=cmin+si[0]*(cmax-cmin),range[i]=si[1]}return{domain:domain,range:range}}},{}],579:[function(_dereq_,module,exports){"use strict";module.exports=function flipScale(scl){for(var si,N=scl.length,sclNew=new Array(N),i=N-1,j=0;i>=0;i--,j++)si=scl[i],sclNew[j]=[1-si[0],si[1]];return sclNew}},{}],580:[function(_dereq_,module,exports){"use strict";var scales=_dereq_("./scales"),defaultScale=_dereq_("./default_scale"),isValidScaleArray=_dereq_("./is_valid_scale_array");module.exports=function getScale(scl,dflt){if(dflt||(dflt=defaultScale),!scl)return dflt;function parseScale(){try{scl=scales[scl]||JSON.parse(scl)}catch(e){scl=dflt}}return"string"==typeof scl&&(parseScale(),"string"==typeof scl&&parseScale()),isValidScaleArray(scl)?scl:dflt}},{"./default_scale":576,"./is_valid_scale_array":584,"./scales":586}],581:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),isValidScale=_dereq_("./is_valid_scale");module.exports=function hasColorscale(trace,containerStr){var container=containerStr?Lib.nestedProperty(trace,containerStr).get()||{}:trace,color=container.color,isArrayWithOneNumber=!1;if(Lib.isArrayOrTypedArray(color))for(var i=0;i<color.length;i++)if(isNumeric(color[i])){isArrayWithOneNumber=!0;break}return Lib.isPlainObject(container)&&(isArrayWithOneNumber||!0===container.showscale||isNumeric(container.cmin)&&isNumeric(container.cmax)||isValidScale(container.colorscale)||Lib.isPlainObject(container.colorbar))}},{"../../lib":693,"./is_valid_scale":583,"fast-isnumeric":213}],582:[function(_dereq_,module,exports){"use strict";exports.scales=_dereq_("./scales"),exports.defaultScale=_dereq_("./default_scale"),exports.attributes=_dereq_("./attributes"),exports.handleDefaults=_dereq_("./defaults"),exports.calc=_dereq_("./calc"),exports.hasColorscale=_dereq_("./has_colorscale"),exports.isValidScale=_dereq_("./is_valid_scale"),exports.getScale=_dereq_("./get_scale"),exports.flipScale=_dereq_("./flip_scale"),exports.extractScale=_dereq_("./extract_scale"),exports.makeColorScaleFunc=_dereq_("./make_color_scale_func")},{"./attributes":574,"./calc":575,"./default_scale":576,"./defaults":577,"./extract_scale":578,"./flip_scale":579,"./get_scale":580,"./has_colorscale":581,"./is_valid_scale":583,"./make_color_scale_func":585,"./scales":586}],583:[function(_dereq_,module,exports){"use strict";var scales=_dereq_("./scales"),isValidScaleArray=_dereq_("./is_valid_scale_array");module.exports=function isValidScale(scl){return void 0!==scales[scl]||isValidScaleArray(scl)}},{"./is_valid_scale_array":584,"./scales":586}],584:[function(_dereq_,module,exports){"use strict";var tinycolor=_dereq_("tinycolor2");module.exports=function isValidScaleArray(scl){var highestVal=0;if(!Array.isArray(scl)||scl.length<2)return!1;if(!scl[0]||!scl[scl.length-1])return!1;if(0!=+scl[0][0]||1!=+scl[scl.length-1][0])return!1;for(var i=0;i<scl.length;i++){var si=scl[i];if(2!==si.length||+si[0]<highestVal||!tinycolor(si[1]).isValid())return!1;highestVal=+si[0]}return!0}},{tinycolor2:511}],585:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),isNumeric=_dereq_("fast-isnumeric"),Color=_dereq_("../color");function colorArray2rbga(colorArray){var colorObj={r:colorArray[0],g:colorArray[1],b:colorArray[2],a:colorArray[3]};return tinycolor(colorObj).toRgbString()}module.exports=function makeColorScaleFunc(specs,opts){opts=opts||{};for(var domain=specs.domain,range=specs.range,N=range.length,_range=new Array(N),i=0;i<N;i++){var rgba=tinycolor(range[i]).toRgb();_range[i]=[rgba.r,rgba.g,rgba.b,rgba.a]}var sclFunc,_sclFunc=d3.scale.linear().domain(domain).range(_range).clamp(!0),noNumericCheck=opts.noNumericCheck,returnArray=opts.returnArray;return(sclFunc=noNumericCheck&&returnArray?_sclFunc:noNumericCheck?function(v){return colorArray2rbga(_sclFunc(v))}:returnArray?function(v){return isNumeric(v)?_sclFunc(v):tinycolor(v).isValid()?v:Color.defaultLine}:function(v){return isNumeric(v)?colorArray2rbga(_sclFunc(v)):tinycolor(v).isValid()?v:Color.defaultLine}).domain=_sclFunc.domain,sclFunc.range=function(){return range},sclFunc}},{"../color":567,d3:147,"fast-isnumeric":213,tinycolor2:511}],586:[function(_dereq_,module,exports){"use strict";module.exports={Greys:[[0,"rgb(0,0,0)"],[1,"rgb(255,255,255)"]],YlGnBu:[[0,"rgb(8,29,88)"],[.125,"rgb(37,52,148)"],[.25,"rgb(34,94,168)"],[.375,"rgb(29,145,192)"],[.5,"rgb(65,182,196)"],[.625,"rgb(127,205,187)"],[.75,"rgb(199,233,180)"],[.875,"rgb(237,248,217)"],[1,"rgb(255,255,217)"]],Greens:[[0,"rgb(0,68,27)"],[.125,"rgb(0,109,44)"],[.25,"rgb(35,139,69)"],[.375,"rgb(65,171,93)"],[.5,"rgb(116,196,118)"],[.625,"rgb(161,217,155)"],[.75,"rgb(199,233,192)"],[.875,"rgb(229,245,224)"],[1,"rgb(247,252,245)"]],YlOrRd:[[0,"rgb(128,0,38)"],[.125,"rgb(189,0,38)"],[.25,"rgb(227,26,28)"],[.375,"rgb(252,78,42)"],[.5,"rgb(253,141,60)"],[.625,"rgb(254,178,76)"],[.75,"rgb(254,217,118)"],[.875,"rgb(255,237,160)"],[1,"rgb(255,255,204)"]],Bluered:[[0,"rgb(0,0,255)"],[1,"rgb(255,0,0)"]],RdBu:[[0,"rgb(5,10,172)"],[.35,"rgb(106,137,247)"],[.5,"rgb(190,190,190)"],[.6,"rgb(220,170,132)"],[.7,"rgb(230,145,90)"],[1,"rgb(178,10,28)"]],Reds:[[0,"rgb(220,220,220)"],[.2,"rgb(245,195,157)"],[.4,"rgb(245,160,105)"],[1,"rgb(178,10,28)"]],Blues:[[0,"rgb(5,10,172)"],[.35,"rgb(40,60,190)"],[.5,"rgb(70,100,245)"],[.6,"rgb(90,120,245)"],[.7,"rgb(106,137,247)"],[1,"rgb(220,220,220)"]],Picnic:[[0,"rgb(0,0,255)"],[.1,"rgb(51,153,255)"],[.2,"rgb(102,204,255)"],[.3,"rgb(153,204,255)"],[.4,"rgb(204,204,255)"],[.5,"rgb(255,255,255)"],[.6,"rgb(255,204,255)"],[.7,"rgb(255,153,255)"],[.8,"rgb(255,102,204)"],[.9,"rgb(255,102,102)"],[1,"rgb(255,0,0)"]],Rainbow:[[0,"rgb(150,0,90)"],[.125,"rgb(0,0,200)"],[.25,"rgb(0,25,255)"],[.375,"rgb(0,152,255)"],[.5,"rgb(44,255,150)"],[.625,"rgb(151,255,0)"],[.75,"rgb(255,234,0)"],[.875,"rgb(255,111,0)"],[1,"rgb(255,0,0)"]],Portland:[[0,"rgb(12,51,131)"],[.25,"rgb(10,136,186)"],[.5,"rgb(242,211,56)"],[.75,"rgb(242,143,56)"],[1,"rgb(217,30,30)"]],Jet:[[0,"rgb(0,0,131)"],[.125,"rgb(0,60,170)"],[.375,"rgb(5,255,255)"],[.625,"rgb(255,255,0)"],[.875,"rgb(250,0,0)"],[1,"rgb(128,0,0)"]],Hot:[[0,"rgb(0,0,0)"],[.3,"rgb(230,0,0)"],[.6,"rgb(255,210,0)"],[1,"rgb(255,255,255)"]],Blackbody:[[0,"rgb(0,0,0)"],[.2,"rgb(230,0,0)"],[.4,"rgb(230,210,0)"],[.7,"rgb(255,255,255)"],[1,"rgb(160,200,255)"]],Earth:[[0,"rgb(0,0,130)"],[.1,"rgb(0,180,180)"],[.2,"rgb(40,210,40)"],[.4,"rgb(230,230,50)"],[.6,"rgb(120,70,20)"],[1,"rgb(255,255,255)"]],Electric:[[0,"rgb(0,0,0)"],[.15,"rgb(30,0,100)"],[.4,"rgb(120,0,100)"],[.6,"rgb(160,90,0)"],[.8,"rgb(230,200,0)"],[1,"rgb(255,250,220)"]],Viridis:[[0,"#440154"],[.06274509803921569,"#48186a"],[.12549019607843137,"#472d7b"],[.18823529411764706,"#424086"],[.25098039215686274,"#3b528b"],[.3137254901960784,"#33638d"],[.3764705882352941,"#2c728e"],[.4392156862745098,"#26828e"],[.5019607843137255,"#21918c"],[.5647058823529412,"#1fa088"],[.6274509803921569,"#28ae80"],[.6901960784313725,"#3fbc73"],[.7529411764705882,"#5ec962"],[.8156862745098039,"#84d44b"],[.8784313725490196,"#addc30"],[.9411764705882353,"#d8e219"],[1,"#fde725"]],Cividis:[[0,"rgb(0,32,76)"],[.058824,"rgb(0,42,102)"],[.117647,"rgb(0,52,110)"],[.176471,"rgb(39,63,108)"],[.235294,"rgb(60,74,107)"],[.294118,"rgb(76,85,107)"],[.352941,"rgb(91,95,109)"],[.411765,"rgb(104,106,112)"],[.470588,"rgb(117,117,117)"],[.529412,"rgb(131,129,120)"],[.588235,"rgb(146,140,120)"],[.647059,"rgb(161,152,118)"],[.705882,"rgb(176,165,114)"],[.764706,"rgb(192,177,109)"],[.823529,"rgb(209,191,102)"],[.882353,"rgb(225,204,92)"],[.941176,"rgb(243,219,79)"],[1,"rgb(255,233,69)"]]}},{}],587:[function(_dereq_,module,exports){"use strict";module.exports=function align(v,dv,v0,v1,anchor){var vmin=(v-v0)/(v1-v0),vmax=vmin+dv/(v1-v0),vc=(vmin+vmax)/2;return"left"===anchor||"bottom"===anchor?vmin:"center"===anchor||"middle"===anchor?vc:"right"===anchor||"top"===anchor?vmax:vmin<2/3-vc?vmin:vmax>4/3-vc?vmax:vc}},{}],588:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),cursorset=[["sw-resize","s-resize","se-resize"],["w-resize","move","e-resize"],["nw-resize","n-resize","ne-resize"]];module.exports=function getCursor(x,y,xanchor,yanchor){return x="left"===xanchor?0:"center"===xanchor?1:"right"===xanchor?2:Lib.constrain(Math.floor(3*x),0,2),y="bottom"===yanchor?0:"middle"===yanchor?1:"top"===yanchor?2:Lib.constrain(Math.floor(3*y),0,2),cursorset[y][x]}},{"../../lib":693}],589:[function(_dereq_,module,exports){"use strict";var mouseOffset=_dereq_("mouse-event-offset"),hasHover=_dereq_("has-hover"),supportsPassive=_dereq_("has-passive-events"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),constants=_dereq_("../../plots/cartesian/constants"),interactConstants=_dereq_("../../constants/interactions"),dragElement=module.exports={};dragElement.align=_dereq_("./align"),dragElement.getCursor=_dereq_("./cursor");var unhover=_dereq_("./unhover");function coverSlip(){var cover=document.createElement("div");cover.className="dragcover";var cStyle=cover.style;return cStyle.position="fixed",cStyle.left=0,cStyle.right=0,cStyle.top=0,cStyle.bottom=0,cStyle.zIndex=999999999,cStyle.background="none",document.body.appendChild(cover),cover}function pointerOffset(e){return mouseOffset(e.changedTouches?e.changedTouches[0]:e,document.body)}dragElement.unhover=unhover.wrapped,dragElement.unhoverRaw=unhover.raw,dragElement.init=function init(options){var startX,startY,newMouseDownTime,cursor,dragCover,initialEvent,initialTarget,rightClick,gd=options.gd,numClicks=1,DBLCLICKDELAY=interactConstants.DBLCLICKDELAY,element=options.element;gd._mouseDownTime||(gd._mouseDownTime=0),element.style.pointerEvents="all",element.onmousedown=onStart,supportsPassive?(element._ontouchstart&&element.removeEventListener("touchstart",element._ontouchstart),element._ontouchstart=onStart,element.addEventListener("touchstart",onStart,{passive:!1})):element.ontouchstart=onStart;var clampFn=options.clampFn||function _clampFn(dx,dy,minDrag){return Math.abs(dx)<minDrag&&(dx=0),Math.abs(dy)<minDrag&&(dy=0),[dx,dy]};function onStart(e){e.preventDefault(),gd._dragged=!1,gd._dragging=!0;var offset=pointerOffset(e);startX=offset[0],startY=offset[1],initialTarget=e.target,initialEvent=e,rightClick=2===e.buttons||e.ctrlKey,void 0===e.clientX&&void 0===e.clientY&&(e.clientX=startX,e.clientY=startY),(newMouseDownTime=(new Date).getTime())-gd._mouseDownTime<DBLCLICKDELAY?numClicks+=1:(numClicks=1,gd._mouseDownTime=newMouseDownTime),options.prepFn&&options.prepFn(e,startX,startY),hasHover&&!rightClick?(dragCover=coverSlip()).style.cursor=window.getComputedStyle(element).cursor:hasHover||(dragCover=document,cursor=window.getComputedStyle(document.documentElement).cursor,document.documentElement.style.cursor=window.getComputedStyle(element).cursor),document.addEventListener("mousemove",onMove),document.addEventListener("mouseup",onDone),document.addEventListener("touchmove",onMove),document.addEventListener("touchend",onDone)}function onMove(e){e.preventDefault();var offset=pointerOffset(e),minDrag=options.minDrag||constants.MINDRAG,dxdy=clampFn(offset[0]-startX,offset[1]-startY,minDrag),dx=dxdy[0],dy=dxdy[1];(dx||dy)&&(gd._dragged=!0,dragElement.unhover(gd)),gd._dragged&&options.moveFn&&!rightClick&&options.moveFn(dx,dy)}function onDone(e){if(document.removeEventListener("mousemove",onMove),document.removeEventListener("mouseup",onDone),document.removeEventListener("touchmove",onMove),document.removeEventListener("touchend",onDone),e.preventDefault(),hasHover?Lib.removeElement(dragCover):cursor&&(dragCover.documentElement.style.cursor=cursor,cursor=null),gd._dragging){if(gd._dragging=!1,(new Date).getTime()-gd._mouseDownTime>DBLCLICKDELAY&&(numClicks=Math.max(numClicks-1,1)),gd._dragged)options.doneFn&&options.doneFn();else if(options.clickFn&&options.clickFn(numClicks,initialEvent),!rightClick){var e2;try{e2=new MouseEvent("click",e)}catch(err){var offset=pointerOffset(e);(e2=document.createEvent("MouseEvents")).initMouseEvent("click",e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,offset[0],offset[1],e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget)}initialTarget.dispatchEvent(e2)}!function finishDrag(gd){gd._dragging=!1,gd._replotPending&&Registry.call("plot",gd)}(gd),gd._dragged=!1}else gd._dragged=!1}},dragElement.coverSlip=coverSlip},{"../../constants/interactions":669,"../../lib":693,"../../plots/cartesian/constants":747,"../../registry":825,"./align":587,"./cursor":588,"./unhover":590,"has-hover":391,"has-passive-events":392,"mouse-event-offset":416}],590:[function(_dereq_,module,exports){"use strict";var Events=_dereq_("../../lib/events"),throttle=_dereq_("../../lib/throttle"),getGraphDiv=_dereq_("../../lib/get_graph_div"),hoverConstants=_dereq_("../fx/constants"),unhover=module.exports={};unhover.wrapped=function(gd,evt,subplot){(gd=getGraphDiv(gd))._fullLayout&&throttle.clear(gd._fullLayout._uid+hoverConstants.HOVERID),unhover.raw(gd,evt,subplot)},unhover.raw=function unhoverRaw(gd,evt){var fullLayout=gd._fullLayout,oldhoverdata=gd._hoverdata;evt||(evt={}),evt.target&&!1===Events.triggerHandler(gd,"plotly_beforehover",evt)||(fullLayout._hoverlayer.selectAll("g").remove(),fullLayout._hoverlayer.selectAll("line").remove(),fullLayout._hoverlayer.selectAll("circle").remove(),gd._hoverdata=void 0,evt.target&&oldhoverdata&&gd.emit("plotly_unhover",{event:evt,points:oldhoverdata}))}},{"../../lib/events":681,"../../lib/get_graph_div":688,"../../lib/throttle":719,"../fx/constants":604}],591:[function(_dereq_,module,exports){"use strict";exports.dash={valType:"string",values:["solid","dot","dash","longdash","dashdot","longdashdot"],dflt:"solid",editType:"style"}},{}],592:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),tinycolor=_dereq_("tinycolor2"),Registry=_dereq_("../../registry"),Color=_dereq_("../color"),Colorscale=_dereq_("../colorscale"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces"),LINE_SPACING=_dereq_("../../constants/alignment").LINE_SPACING,DESELECTDIM=_dereq_("../../constants/interactions").DESELECTDIM,subTypes=_dereq_("../../traces/scatter/subtypes"),makeBubbleSizeFn=_dereq_("../../traces/scatter/make_bubble_size_func"),drawing=module.exports={};drawing.font=function(s,family,size,color){Lib.isPlainObject(family)&&(color=family.color,size=family.size,family=family.family),family&&s.style("font-family",family),size+1&&s.style("font-size",size+"px"),color&&s.call(Color.fill,color)},drawing.setPosition=function(s,x,y){s.attr("x",x).attr("y",y)},drawing.setSize=function(s,w,h){s.attr("width",w).attr("height",h)},drawing.setRect=function(s,x,y,w,h){s.call(drawing.setPosition,x,y).call(drawing.setSize,w,h)},drawing.translatePoint=function(d,sel,xa,ya){var x=xa.c2p(d.x),y=ya.c2p(d.y);return!!(isNumeric(x)&&isNumeric(y)&&sel.node())&&("text"===sel.node().nodeName?sel.attr("x",x).attr("y",y):sel.attr("transform","translate("+x+","+y+")"),!0)},drawing.translatePoints=function(s,xa,ya){s.each(function(d){var sel=d3.select(this);drawing.translatePoint(d,sel,xa,ya)})},drawing.hideOutsideRangePoint=function(d,sel,xa,ya,xcalendar,ycalendar){sel.attr("display",xa.isPtWithinRange(d,xcalendar)&&ya.isPtWithinRange(d,ycalendar)?null:"none")},drawing.hideOutsideRangePoints=function(traceGroups,subplot){if(subplot._hasClipOnAxisFalse){var xa=subplot.xaxis,ya=subplot.yaxis;traceGroups.each(function(d){var trace=d[0].trace,xcalendar=trace.xcalendar,ycalendar=trace.ycalendar,selector="bar"===trace.type?".bartext":".point,.textpoint";traceGroups.selectAll(selector).each(function(d){drawing.hideOutsideRangePoint(d,d3.select(this),xa,ya,xcalendar,ycalendar)})})}},drawing.crispRound=function(gd,lineWidth,dflt){return lineWidth&&isNumeric(lineWidth)?gd._context.staticPlot?lineWidth:lineWidth<1?1:Math.round(lineWidth):dflt||0},drawing.singleLineStyle=function(d,s,lw,lc,ld){s.style("fill","none");var line=(((d||[])[0]||{}).trace||{}).line||{},lw1=lw||line.width||0,dash=ld||line.dash||"";Color.stroke(s,lc||line.color),drawing.dashLine(s,dash,lw1)},drawing.lineGroupStyle=function(s,lw,lc,ld){s.style("fill","none").each(function(d){var line=(((d||[])[0]||{}).trace||{}).line||{},lw1=lw||line.width||0,dash=ld||line.dash||"";d3.select(this).call(Color.stroke,lc||line.color).call(drawing.dashLine,dash,lw1)})},drawing.dashLine=function(s,dash,lineWidth){lineWidth=+lineWidth||0,dash=drawing.dashStyle(dash,lineWidth),s.style({"stroke-dasharray":dash,"stroke-width":lineWidth+"px"})},drawing.dashStyle=function(dash,lineWidth){lineWidth=+lineWidth||1;var dlw=Math.max(lineWidth,3);return"solid"===dash?dash="":"dot"===dash?dash=dlw+"px,"+dlw+"px":"dash"===dash?dash=3*dlw+"px,"+3*dlw+"px":"longdash"===dash?dash=5*dlw+"px,"+5*dlw+"px":"dashdot"===dash?dash=3*dlw+"px,"+dlw+"px,"+dlw+"px,"+dlw+"px":"longdashdot"===dash&&(dash=5*dlw+"px,"+2*dlw+"px,"+dlw+"px,"+2*dlw+"px"),dash},drawing.singleFillStyle=function(sel){var fillcolor=(((d3.select(sel.node()).data()[0]||[])[0]||{}).trace||{}).fillcolor;fillcolor&&sel.call(Color.fill,fillcolor)},drawing.fillGroupStyle=function(s){s.style("stroke-width",0).each(function(d){var shape=d3.select(this);try{shape.call(Color.fill,d[0].trace.fillcolor)}catch(e){Lib.error(e,s),shape.remove()}})};var SYMBOLDEFS=_dereq_("./symbol_defs");drawing.symbolNames=[],drawing.symbolFuncs=[],drawing.symbolNeedLines={},drawing.symbolNoDot={},drawing.symbolNoFill={},drawing.symbolList=[],Object.keys(SYMBOLDEFS).forEach(function(k){var symDef=SYMBOLDEFS[k];drawing.symbolList=drawing.symbolList.concat([symDef.n,k,symDef.n+100,k+"-open"]),drawing.symbolNames[symDef.n]=k,drawing.symbolFuncs[symDef.n]=symDef.f,symDef.needLine&&(drawing.symbolNeedLines[symDef.n]=!0),symDef.noDot?drawing.symbolNoDot[symDef.n]=!0:drawing.symbolList=drawing.symbolList.concat([symDef.n+200,k+"-dot",symDef.n+300,k+"-open-dot"]),symDef.noFill&&(drawing.symbolNoFill[symDef.n]=!0)});var MAXSYMBOL=drawing.symbolNames.length,DOTPATH="M0,0.5L0.5,0L0,-0.5L-0.5,0Z";function makePointPath(symbolNumber,r){var base=symbolNumber%100;return drawing.symbolFuncs[base](r)+(symbolNumber>=200?DOTPATH:"")}drawing.symbolNumber=function(v){if("string"==typeof v){var vbase=0;v.indexOf("-open")>0&&(vbase=100,v=v.replace("-open","")),v.indexOf("-dot")>0&&(vbase+=200,v=v.replace("-dot","")),(v=drawing.symbolNames.indexOf(v))>=0&&(v+=vbase)}return v%100>=MAXSYMBOL||v>=400?0:Math.floor(Math.max(v,0))};var HORZGRADIENT={x1:1,x2:0,y1:0,y2:0},VERTGRADIENT={x1:0,x2:0,y1:1,y2:0},stopFormatter=d3.format("~.1f"),gradientInfo={radial:{node:"radialGradient"},radialreversed:{node:"radialGradient",reversed:!0},horizontal:{node:"linearGradient",attrs:HORZGRADIENT},horizontalreversed:{node:"linearGradient",attrs:HORZGRADIENT,reversed:!0},vertical:{node:"linearGradient",attrs:VERTGRADIENT},verticalreversed:{node:"linearGradient",attrs:VERTGRADIENT,reversed:!0}};drawing.gradient=function(sel,gd,gradientID,type,colorscale,prop){for(var len=colorscale.length,info=gradientInfo[type],colorStops=new Array(len),i=0;i<len;i++)info.reversed?colorStops[len-1-i]=[stopFormatter(100*(1-colorscale[i][0])),colorscale[i][1]]:colorStops[i]=[stopFormatter(100*colorscale[i][0]),colorscale[i][1]];var fullID="g"+gd._fullLayout._uid+"-"+gradientID,gradient=gd._fullLayout._defs.select(".gradients").selectAll("#"+fullID).data([type+colorStops.join(";")],Lib.identity);gradient.exit().remove(),gradient.enter().append(info.node).each(function(){var el=d3.select(this);info.attrs&&el.attr(info.attrs),el.attr("id",fullID);var stops=el.selectAll("stop").data(colorStops);stops.exit().remove(),stops.enter().append("stop"),stops.each(function(d){var tc=tinycolor(d[1]);d3.select(this).attr({offset:d[0]+"%","stop-color":Color.tinyRGB(tc),"stop-opacity":tc.getAlpha()})})}),sel.style(prop,"url(#"+fullID+")").style(prop+"-opacity",null)},drawing.initGradients=function(gd){Lib.ensureSingle(gd._fullLayout._defs,"g","gradients").selectAll("linearGradient,radialGradient").remove()},drawing.pointStyle=function(s,trace,gd){if(s.size()){var fns=drawing.makePointStyleFns(trace);s.each(function(d){drawing.singlePointStyle(d,d3.select(this),trace,fns,gd)})}},drawing.singlePointStyle=function(d,sel,trace,fns,gd){var marker=trace.marker,markerLine=marker.line;if(sel.style("opacity",fns.selectedOpacityFn?fns.selectedOpacityFn(d):void 0===d.mo?marker.opacity:d.mo),fns.ms2mrc){var r;r="various"===d.ms||"various"===marker.size?3:fns.ms2mrc(d.ms),d.mrc=r,fns.selectedSizeFn&&(r=d.mrc=fns.selectedSizeFn(d));var x=drawing.symbolNumber(d.mx||marker.symbol)||0;d.om=x%200>=100,sel.attr("d",makePointPath(x,r))}var fillColor,lineColor,lineWidth,perPointGradient=!1;if(d.so)lineWidth=markerLine.outlierwidth,lineColor=markerLine.outliercolor,fillColor=marker.outliercolor;else{var markerLineWidth=(markerLine||{}).width;lineWidth=(d.mlw+1||markerLineWidth+1||(d.trace?(d.trace.marker.line||{}).width:0)+1)-1||0,lineColor="mlc"in d?d.mlcc=fns.lineScale(d.mlc):Lib.isArrayOrTypedArray(markerLine.color)?Color.defaultLine:markerLine.color,Lib.isArrayOrTypedArray(marker.color)&&(fillColor=Color.defaultLine,perPointGradient=!0),fillColor="mc"in d?d.mcc=fns.markerScale(d.mc):marker.color||"rgba(0,0,0,0)",fns.selectedColorFn&&(fillColor=fns.selectedColorFn(d))}if(d.om)sel.call(Color.stroke,fillColor).style({"stroke-width":(lineWidth||1)+"px",fill:"none"});else{sel.style("stroke-width",lineWidth+"px");var markerGradient=marker.gradient,gradientType=d.mgt;if(gradientType?perPointGradient=!0:gradientType=markerGradient&&markerGradient.type,Array.isArray(gradientType)&&(gradientType=gradientType[0],gradientInfo[gradientType]||(gradientType=0)),gradientType&&"none"!==gradientType){var gradientColor=d.mgc;gradientColor?perPointGradient=!0:gradientColor=markerGradient.color;var gradientID=trace.uid;perPointGradient&&(gradientID+="-"+d.i),drawing.gradient(sel,gd,gradientID,gradientType,[[0,gradientColor],[1,fillColor]],"fill")}else Color.fill(sel,fillColor);lineWidth&&Color.stroke(sel,lineColor)}},drawing.makePointStyleFns=function(trace){var out={},marker=trace.marker;return out.markerScale=drawing.tryColorscale(marker,""),out.lineScale=drawing.tryColorscale(marker,"line"),Registry.traceIs(trace,"symbols")&&(out.ms2mrc=subTypes.isBubble(trace)?makeBubbleSizeFn(trace):function(){return(marker.size||6)/2}),trace.selectedpoints&&Lib.extendFlat(out,drawing.makeSelectedPointStyleFns(trace)),out},drawing.makeSelectedPointStyleFns=function(trace){var out={},selectedAttrs=trace.selected||{},unselectedAttrs=trace.unselected||{},marker=trace.marker||{},selectedMarker=selectedAttrs.marker||{},unselectedMarker=unselectedAttrs.marker||{},mo=marker.opacity,smo=selectedMarker.opacity,usmo=unselectedMarker.opacity,smoIsDefined=void 0!==smo,usmoIsDefined=void 0!==usmo;(Lib.isArrayOrTypedArray(mo)||smoIsDefined||usmoIsDefined)&&(out.selectedOpacityFn=function(d){var base=void 0===d.mo?marker.opacity:d.mo;return d.selected?smoIsDefined?smo:base:usmoIsDefined?usmo:DESELECTDIM*base});var mc=marker.color,smc=selectedMarker.color,usmc=unselectedMarker.color;(smc||usmc)&&(out.selectedColorFn=function(d){var base=d.mcc||mc;return d.selected?smc||base:usmc||base});var ms=marker.size,sms=selectedMarker.size,usms=unselectedMarker.size,smsIsDefined=void 0!==sms,usmsIsDefined=void 0!==usms;return Registry.traceIs(trace,"symbols")&&(smsIsDefined||usmsIsDefined)&&(out.selectedSizeFn=function(d){var base=d.mrc||ms/2;return d.selected?smsIsDefined?sms/2:base:usmsIsDefined?usms/2:base}),out},drawing.makeSelectedTextStyleFns=function(trace){var out={},selectedAttrs=trace.selected||{},unselectedAttrs=trace.unselected||{},textFont=trace.textfont||{},selectedTextFont=selectedAttrs.textfont||{},unselectedTextFont=unselectedAttrs.textfont||{},tc=textFont.color,stc=selectedTextFont.color,utc=unselectedTextFont.color;return out.selectedTextColorFn=function(d){var base=d.tc||tc;return d.selected?stc||base:utc||(stc?base:Color.addOpacity(base,DESELECTDIM))},out},drawing.selectedPointStyle=function(s,trace){if(s.size()&&trace.selectedpoints){var fns=drawing.makeSelectedPointStyleFns(trace),marker=trace.marker||{},seq=[];fns.selectedOpacityFn&&seq.push(function(pt,d){pt.style("opacity",fns.selectedOpacityFn(d))}),fns.selectedColorFn&&seq.push(function(pt,d){Color.fill(pt,fns.selectedColorFn(d))}),fns.selectedSizeFn&&seq.push(function(pt,d){var mx=d.mx||marker.symbol||0,mrc2=fns.selectedSizeFn(d);pt.attr("d",makePointPath(drawing.symbolNumber(mx),mrc2)),d.mrc2=mrc2}),seq.length&&s.each(function(d){for(var pt=d3.select(this),i=0;i<seq.length;i++)seq[i](pt,d)})}},drawing.tryColorscale=function(marker,prefix){var cont=prefix?Lib.nestedProperty(marker,prefix).get():marker;if(cont){var scl=cont.colorscale,colorArray=cont.color;if(scl&&Lib.isArrayOrTypedArray(colorArray))return Colorscale.makeColorScaleFunc(Colorscale.extractScale(scl,cont.cmin,cont.cmax))}return Lib.identity};var TEXTOFFSETSIGN={start:1,end:-1,middle:0,bottom:1,top:-1};function textPointPosition(s,textPosition,fontSize,markerRadius){var group=d3.select(s.node().parentNode),v=-1!==textPosition.indexOf("top")?"top":-1!==textPosition.indexOf("bottom")?"bottom":"middle",h=-1!==textPosition.indexOf("left")?"end":-1!==textPosition.indexOf("right")?"start":"middle",r=markerRadius?markerRadius/.8+1:0,numLines=(svgTextUtils.lineCount(s)-1)*LINE_SPACING+1,dx=TEXTOFFSETSIGN[h]*r,dy=.75*fontSize+TEXTOFFSETSIGN[v]*r+(TEXTOFFSETSIGN[v]-1)*numLines*fontSize/2;s.attr("text-anchor",h),group.attr("transform","translate("+dx+","+dy+")")}function extracTextFontSize(d,trace){var fontSize=d.ts||trace.textfont.size;return isNumeric(fontSize)&&fontSize>0?fontSize:0}drawing.textPointStyle=function(s,trace,gd){if(s.size()){var selectedTextColorFn;if(trace.selectedpoints){var fns=drawing.makeSelectedTextStyleFns(trace);selectedTextColorFn=fns.selectedTextColorFn}s.each(function(d){var p=d3.select(this),text=Lib.extractOption(d,trace,"tx","text");if(text||0===text){var pos=d.tp||trace.textposition,fontSize=extracTextFontSize(d,trace),fontColor=selectedTextColorFn?selectedTextColorFn(d):d.tc||trace.textfont.color;p.call(drawing.font,d.tf||trace.textfont.family,fontSize,fontColor).text(text).call(svgTextUtils.convertToTspans,gd).call(textPointPosition,pos,fontSize,d.mrc)}else p.remove()})}},drawing.selectedTextStyle=function(s,trace){if(s.size()&&trace.selectedpoints){var fns=drawing.makeSelectedTextStyleFns(trace);s.each(function(d){var tx=d3.select(this),tc=fns.selectedTextColorFn(d),tp=d.tp||trace.textposition,fontSize=extracTextFontSize(d,trace);Color.fill(tx,tc),textPointPosition(tx,tp,fontSize,d.mrc2||d.mrc)})}};var CatmullRomExp=.5;function makeTangent(prevpt,thispt,nextpt,smoothness){var d1x=prevpt[0]-thispt[0],d1y=prevpt[1]-thispt[1],d2x=nextpt[0]-thispt[0],d2y=nextpt[1]-thispt[1],d1a=Math.pow(d1x*d1x+d1y*d1y,CatmullRomExp/2),d2a=Math.pow(d2x*d2x+d2y*d2y,CatmullRomExp/2),numx=(d2a*d2a*d1x-d1a*d1a*d2x)*smoothness,numy=(d2a*d2a*d1y-d1a*d1a*d2y)*smoothness,denom1=3*d2a*(d1a+d2a),denom2=3*d1a*(d1a+d2a);return[[d3.round(thispt[0]+(denom1&&numx/denom1),2),d3.round(thispt[1]+(denom1&&numy/denom1),2)],[d3.round(thispt[0]-(denom2&&numx/denom2),2),d3.round(thispt[1]-(denom2&&numy/denom2),2)]]}drawing.smoothopen=function(pts,smoothness){if(pts.length<3)return"M"+pts.join("L");var i,path="M"+pts[0],tangents=[];for(i=1;i<pts.length-1;i++)tangents.push(makeTangent(pts[i-1],pts[i],pts[i+1],smoothness));for(path+="Q"+tangents[0][0]+" "+pts[1],i=2;i<pts.length-1;i++)path+="C"+tangents[i-2][1]+" "+tangents[i-1][0]+" "+pts[i];return path+="Q"+tangents[pts.length-3][1]+" "+pts[pts.length-1]},drawing.smoothclosed=function(pts,smoothness){if(pts.length<3)return"M"+pts.join("L")+"Z";var i,path="M"+pts[0],pLast=pts.length-1,tangents=[makeTangent(pts[pLast],pts[0],pts[1],smoothness)];for(i=1;i<pLast;i++)tangents.push(makeTangent(pts[i-1],pts[i],pts[i+1],smoothness));for(tangents.push(makeTangent(pts[pLast-1],pts[pLast],pts[0],smoothness)),i=1;i<=pLast;i++)path+="C"+tangents[i-1][1]+" "+tangents[i][0]+" "+pts[i];return path+="C"+tangents[pLast][1]+" "+tangents[0][0]+" "+pts[0]+"Z"};var STEPPATH={hv:function(p0,p1){return"H"+d3.round(p1[0],2)+"V"+d3.round(p1[1],2)},vh:function(p0,p1){return"V"+d3.round(p1[1],2)+"H"+d3.round(p1[0],2)},hvh:function(p0,p1){return"H"+d3.round((p0[0]+p1[0])/2,2)+"V"+d3.round(p1[1],2)+"H"+d3.round(p1[0],2)},vhv:function(p0,p1){return"V"+d3.round((p0[1]+p1[1])/2,2)+"H"+d3.round(p1[0],2)+"V"+d3.round(p1[1],2)}},STEPLINEAR=function(p0,p1){return"L"+d3.round(p1[0],2)+","+d3.round(p1[1],2)};drawing.steps=function(shape){var onestep=STEPPATH[shape]||STEPLINEAR;return function(pts){for(var path="M"+d3.round(pts[0][0],2)+","+d3.round(pts[0][1],2),i=1;i<pts.length;i++)path+=onestep(pts[i-1],pts[i]);return path}},drawing.makeTester=function(){var tester=Lib.ensureSingleById(d3.select("body"),"svg","js-plotly-tester",function(s){s.attr(xmlnsNamespaces.svgAttrs).style({position:"absolute",left:"-10000px",top:"-10000px",width:"9000px",height:"9000px","z-index":"1"})}),testref=Lib.ensureSingle(tester,"path","js-reference-point",function(s){s.attr("d","M0,0H1V1H0Z").style({"stroke-width":0,fill:"black"})});drawing.tester=tester,drawing.testref=testref},drawing.savedBBoxes={};var savedBBoxesCount=0;function nodeHash(node){var inputText=node.getAttribute("data-unformatted");if(null!==inputText)return inputText+node.getAttribute("data-math")+node.getAttribute("text-anchor")+node.getAttribute("style")}drawing.bBox=function(node,inTester,hash){var out,testNode,tester;if(hash||(hash=nodeHash(node)),hash){if(out=drawing.savedBBoxes[hash])return Lib.extendFlat({},out)}else if(1===node.childNodes.length){var innerNode=node.childNodes[0];if(hash=nodeHash(innerNode)){var x=+innerNode.getAttribute("x")||0,y=+innerNode.getAttribute("y")||0,transform=innerNode.getAttribute("transform");if(!transform){var innerBB=drawing.bBox(innerNode,!1,hash);return x&&(innerBB.left+=x,innerBB.right+=x),y&&(innerBB.top+=y,innerBB.bottom+=y),innerBB}if(hash+="~"+x+"~"+y+"~"+transform,out=drawing.savedBBoxes[hash])return Lib.extendFlat({},out)}}inTester?testNode=node:(tester=drawing.tester.node(),testNode=node.cloneNode(!0),tester.appendChild(testNode)),d3.select(testNode).attr("transform",null).call(svgTextUtils.positionText,0,0);var testRect=testNode.getBoundingClientRect(),refRect=drawing.testref.node().getBoundingClientRect();inTester||tester.removeChild(testNode);var bb={height:testRect.height,width:testRect.width,left:testRect.left-refRect.left,top:testRect.top-refRect.top,right:testRect.right-refRect.left,bottom:testRect.bottom-refRect.top};return savedBBoxesCount>=1e4&&(drawing.savedBBoxes={},savedBBoxesCount=0),hash&&(drawing.savedBBoxes[hash]=bb),savedBBoxesCount++,Lib.extendFlat({},bb)},drawing.setClipUrl=function(s,localId){if(localId){if(void 0===drawing.baseUrl){var base=d3.select("base");base.size()&&base.attr("href")?drawing.baseUrl=window.location.href.split("#")[0]:drawing.baseUrl=""}s.attr("clip-path","url("+drawing.baseUrl+"#"+localId+")")}else s.attr("clip-path",null)},drawing.getTranslate=function(element){var translate=(element[element.attr?"attr":"getAttribute"]("transform")||"").replace(/.*\btranslate\((-?\d*\.?\d*)[^-\d]*(-?\d*\.?\d*)[^\d].*/,function(match,p1,p2){return[p1,p2].join(" ")}).split(" ");return{x:+translate[0]||0,y:+translate[1]||0}},drawing.setTranslate=function(element,x,y){var getter=element.attr?"attr":"getAttribute",setter=element.attr?"attr":"setAttribute",transform=element[getter]("transform")||"";return x=x||0,y=y||0,transform=transform.replace(/(\btranslate\(.*?\);?)/,"").trim(),transform=(transform+=" translate("+x+", "+y+")").trim(),element[setter]("transform",transform),transform},drawing.getScale=function(element){var translate=(element[element.attr?"attr":"getAttribute"]("transform")||"").replace(/.*\bscale\((\d*\.?\d*)[^\d]*(\d*\.?\d*)[^\d].*/,function(match,p1,p2){return[p1,p2].join(" ")}).split(" ");return{x:+translate[0]||1,y:+translate[1]||1}},drawing.setScale=function(element,x,y){var getter=element.attr?"attr":"getAttribute",setter=element.attr?"attr":"setAttribute",transform=element[getter]("transform")||"";return x=x||1,y=y||1,transform=transform.replace(/(\bscale\(.*?\);?)/,"").trim(),transform=(transform+=" scale("+x+", "+y+")").trim(),element[setter]("transform",transform),transform};var SCALE_RE=/\s*sc.*/;drawing.setPointGroupScale=function(selection,xScale,yScale){if(xScale=xScale||1,yScale=yScale||1,selection){var scale=1===xScale&&1===yScale?"":" scale("+xScale+","+yScale+")";selection.each(function(){var t=(this.getAttribute("transform")||"").replace(SCALE_RE,"");t=(t+=scale).trim(),this.setAttribute("transform",t)})}};var TEXT_POINT_LAST_TRANSLATION_RE=/translate\([^)]*\)\s*$/;drawing.setTextPointsScale=function(selection,xScale,yScale){selection&&selection.each(function(){var transforms,el=d3.select(this),text=el.select("text");if(text.node()){var x=parseFloat(text.attr("x")||0),y=parseFloat(text.attr("y")||0),existingTransform=(el.attr("transform")||"").match(TEXT_POINT_LAST_TRANSLATION_RE);transforms=1===xScale&&1===yScale?[]:["translate("+x+","+y+")","scale("+xScale+","+yScale+")","translate("+-x+","+-y+")"],existingTransform&&transforms.push(existingTransform),el.attr("transform",transforms.join(" "))}})}},{"../../constants/alignment":665,"../../constants/interactions":669,"../../constants/xmlns_namespaces":671,"../../lib":693,"../../lib/svg_text_utils":718,"../../registry":825,"../../traces/scatter/make_bubble_size_func":1049,"../../traces/scatter/subtypes":1056,"../color":567,"../colorscale":582,"./symbol_defs":593,d3:147,"fast-isnumeric":213,tinycolor2:511}],593:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3");module.exports={circle:{n:0,f:function(r){var rs=d3.round(r,2);return"M"+rs+",0A"+rs+","+rs+" 0 1,1 0,-"+rs+"A"+rs+","+rs+" 0 0,1 "+rs+",0Z"}},square:{n:1,f:function(r){var rs=d3.round(r,2);return"M"+rs+","+rs+"H-"+rs+"V-"+rs+"H"+rs+"Z"}},diamond:{n:2,f:function(r){var rd=d3.round(1.3*r,2);return"M"+rd+",0L0,"+rd+"L-"+rd+",0L0,-"+rd+"Z"}},cross:{n:3,f:function(r){var rc=d3.round(.4*r,2),rc2=d3.round(1.2*r,2);return"M"+rc2+","+rc+"H"+rc+"V"+rc2+"H-"+rc+"V"+rc+"H-"+rc2+"V-"+rc+"H-"+rc+"V-"+rc2+"H"+rc+"V-"+rc+"H"+rc2+"Z"}},x:{n:4,f:function(r){var rx=d3.round(.8*r/Math.sqrt(2),2),ne="l"+rx+","+rx,se="l"+rx+",-"+rx,sw="l-"+rx+",-"+rx,nw="l-"+rx+","+rx;return"M0,"+rx+ne+se+sw+se+sw+nw+sw+nw+ne+nw+ne+"Z"}},"triangle-up":{n:5,f:function(r){var rt=d3.round(2*r/Math.sqrt(3),2);return"M-"+rt+","+d3.round(r/2,2)+"H"+rt+"L0,-"+d3.round(r,2)+"Z"}},"triangle-down":{n:6,f:function(r){var rt=d3.round(2*r/Math.sqrt(3),2);return"M-"+rt+",-"+d3.round(r/2,2)+"H"+rt+"L0,"+d3.round(r,2)+"Z"}},"triangle-left":{n:7,f:function(r){var rt=d3.round(2*r/Math.sqrt(3),2);return"M"+d3.round(r/2,2)+",-"+rt+"V"+rt+"L-"+d3.round(r,2)+",0Z"}},"triangle-right":{n:8,f:function(r){var rt=d3.round(2*r/Math.sqrt(3),2);return"M-"+d3.round(r/2,2)+",-"+rt+"V"+rt+"L"+d3.round(r,2)+",0Z"}},"triangle-ne":{n:9,f:function(r){var r1=d3.round(.6*r,2),r2=d3.round(1.2*r,2);return"M-"+r2+",-"+r1+"H"+r1+"V"+r2+"Z"}},"triangle-se":{n:10,f:function(r){var r1=d3.round(.6*r,2),r2=d3.round(1.2*r,2);return"M"+r1+",-"+r2+"V"+r1+"H-"+r2+"Z"}},"triangle-sw":{n:11,f:function(r){var r1=d3.round(.6*r,2),r2=d3.round(1.2*r,2);return"M"+r2+","+r1+"H-"+r1+"V-"+r2+"Z"}},"triangle-nw":{n:12,f:function(r){var r1=d3.round(.6*r,2),r2=d3.round(1.2*r,2);return"M-"+r1+","+r2+"V-"+r1+"H"+r2+"Z"}},pentagon:{n:13,f:function(r){var x1=d3.round(.951*r,2),x2=d3.round(.588*r,2),y0=d3.round(-r,2),y1=d3.round(-.309*r,2);return"M"+x1+","+y1+"L"+x2+","+d3.round(.809*r,2)+"H-"+x2+"L-"+x1+","+y1+"L0,"+y0+"Z"}},hexagon:{n:14,f:function(r){var y0=d3.round(r,2),y1=d3.round(r/2,2),x=d3.round(r*Math.sqrt(3)/2,2);return"M"+x+",-"+y1+"V"+y1+"L0,"+y0+"L-"+x+","+y1+"V-"+y1+"L0,-"+y0+"Z"}},hexagon2:{n:15,f:function(r){var x0=d3.round(r,2),x1=d3.round(r/2,2),y=d3.round(r*Math.sqrt(3)/2,2);return"M-"+x1+","+y+"H"+x1+"L"+x0+",0L"+x1+",-"+y+"H-"+x1+"L-"+x0+",0Z"}},octagon:{n:16,f:function(r){var a=d3.round(.924*r,2),b=d3.round(.383*r,2);return"M-"+b+",-"+a+"H"+b+"L"+a+",-"+b+"V"+b+"L"+b+","+a+"H-"+b+"L-"+a+","+b+"V-"+b+"Z"}},star:{n:17,f:function(r){var rs=1.4*r,x1=d3.round(.225*rs,2),x2=d3.round(.951*rs,2),x3=d3.round(.363*rs,2),x4=d3.round(.588*rs,2),y0=d3.round(-rs,2),y1=d3.round(-.309*rs,2),y3=d3.round(.118*rs,2),y4=d3.round(.809*rs,2);return"M"+x1+","+y1+"H"+x2+"L"+x3+","+y3+"L"+x4+","+y4+"L0,"+d3.round(.382*rs,2)+"L-"+x4+","+y4+"L-"+x3+","+y3+"L-"+x2+","+y1+"H-"+x1+"L0,"+y0+"Z"}},hexagram:{n:18,f:function(r){var y=d3.round(.66*r,2),x1=d3.round(.38*r,2),x2=d3.round(.76*r,2);return"M-"+x2+",0l-"+x1+",-"+y+"h"+x2+"l"+x1+",-"+y+"l"+x1+","+y+"h"+x2+"l-"+x1+","+y+"l"+x1+","+y+"h-"+x2+"l-"+x1+","+y+"l-"+x1+",-"+y+"h-"+x2+"Z"}},"star-triangle-up":{n:19,f:function(r){var x=d3.round(r*Math.sqrt(3)*.8,2),y1=d3.round(.8*r,2),y2=d3.round(1.6*r,2),rc=d3.round(4*r,2),aPart="A "+rc+","+rc+" 0 0 1 ";return"M-"+x+","+y1+aPart+x+","+y1+aPart+"0,-"+y2+aPart+"-"+x+","+y1+"Z"}},"star-triangle-down":{n:20,f:function(r){var x=d3.round(r*Math.sqrt(3)*.8,2),y1=d3.round(.8*r,2),y2=d3.round(1.6*r,2),rc=d3.round(4*r,2),aPart="A "+rc+","+rc+" 0 0 1 ";return"M"+x+",-"+y1+aPart+"-"+x+",-"+y1+aPart+"0,"+y2+aPart+x+",-"+y1+"Z"}},"star-square":{n:21,f:function(r){var rp=d3.round(1.1*r,2),rc=d3.round(2*r,2),aPart="A "+rc+","+rc+" 0 0 1 ";return"M-"+rp+",-"+rp+aPart+"-"+rp+","+rp+aPart+rp+","+rp+aPart+rp+",-"+rp+aPart+"-"+rp+",-"+rp+"Z"}},"star-diamond":{n:22,f:function(r){var rp=d3.round(1.4*r,2),rc=d3.round(1.9*r,2),aPart="A "+rc+","+rc+" 0 0 1 ";return"M-"+rp+",0"+aPart+"0,"+rp+aPart+rp+",0"+aPart+"0,-"+rp+aPart+"-"+rp+",0Z"}},"diamond-tall":{n:23,f:function(r){var x=d3.round(.7*r,2),y=d3.round(1.4*r,2);return"M0,"+y+"L"+x+",0L0,-"+y+"L-"+x+",0Z"}},"diamond-wide":{n:24,f:function(r){var x=d3.round(1.4*r,2),y=d3.round(.7*r,2);return"M0,"+y+"L"+x+",0L0,-"+y+"L-"+x+",0Z"}},hourglass:{n:25,f:function(r){var rs=d3.round(r,2);return"M"+rs+","+rs+"H-"+rs+"L"+rs+",-"+rs+"H-"+rs+"Z"},noDot:!0},bowtie:{n:26,f:function(r){var rs=d3.round(r,2);return"M"+rs+","+rs+"V-"+rs+"L-"+rs+","+rs+"V-"+rs+"Z"},noDot:!0},"circle-cross":{n:27,f:function(r){var rs=d3.round(r,2);return"M0,"+rs+"V-"+rs+"M"+rs+",0H-"+rs+"M"+rs+",0A"+rs+","+rs+" 0 1,1 0,-"+rs+"A"+rs+","+rs+" 0 0,1 "+rs+",0Z"},needLine:!0,noDot:!0},"circle-x":{n:28,f:function(r){var rs=d3.round(r,2),rc=d3.round(r/Math.sqrt(2),2);return"M"+rc+","+rc+"L-"+rc+",-"+rc+"M"+rc+",-"+rc+"L-"+rc+","+rc+"M"+rs+",0A"+rs+","+rs+" 0 1,1 0,-"+rs+"A"+rs+","+rs+" 0 0,1 "+rs+",0Z"},needLine:!0,noDot:!0},"square-cross":{n:29,f:function(r){var rs=d3.round(r,2);return"M0,"+rs+"V-"+rs+"M"+rs+",0H-"+rs+"M"+rs+","+rs+"H-"+rs+"V-"+rs+"H"+rs+"Z"},needLine:!0,noDot:!0},"square-x":{n:30,f:function(r){var rs=d3.round(r,2);return"M"+rs+","+rs+"L-"+rs+",-"+rs+"M"+rs+",-"+rs+"L-"+rs+","+rs+"M"+rs+","+rs+"H-"+rs+"V-"+rs+"H"+rs+"Z"},needLine:!0,noDot:!0},"diamond-cross":{n:31,f:function(r){var rd=d3.round(1.3*r,2);return"M"+rd+",0L0,"+rd+"L-"+rd+",0L0,-"+rd+"ZM0,-"+rd+"V"+rd+"M-"+rd+",0H"+rd},needLine:!0,noDot:!0},"diamond-x":{n:32,f:function(r){var rd=d3.round(1.3*r,2),r2=d3.round(.65*r,2);return"M"+rd+",0L0,"+rd+"L-"+rd+",0L0,-"+rd+"ZM-"+r2+",-"+r2+"L"+r2+","+r2+"M-"+r2+","+r2+"L"+r2+",-"+r2},needLine:!0,noDot:!0},"cross-thin":{n:33,f:function(r){var rc=d3.round(1.4*r,2);return"M0,"+rc+"V-"+rc+"M"+rc+",0H-"+rc},needLine:!0,noDot:!0,noFill:!0},"x-thin":{n:34,f:function(r){var rx=d3.round(r,2);return"M"+rx+","+rx+"L-"+rx+",-"+rx+"M"+rx+",-"+rx+"L-"+rx+","+rx},needLine:!0,noDot:!0,noFill:!0},asterisk:{n:35,f:function(r){var rc=d3.round(1.2*r,2),rs=d3.round(.85*r,2);return"M0,"+rc+"V-"+rc+"M"+rc+",0H-"+rc+"M"+rs+","+rs+"L-"+rs+",-"+rs+"M"+rs+",-"+rs+"L-"+rs+","+rs},needLine:!0,noDot:!0,noFill:!0},hash:{n:36,f:function(r){var r1=d3.round(r/2,2),r2=d3.round(r,2);return"M"+r1+","+r2+"V-"+r2+"m-"+r2+",0V"+r2+"M"+r2+","+r1+"H-"+r2+"m0,-"+r2+"H"+r2},needLine:!0,noFill:!0},"y-up":{n:37,f:function(r){var x=d3.round(1.2*r,2),y0=d3.round(1.6*r,2),y1=d3.round(.8*r,2);return"M-"+x+","+y1+"L0,0M"+x+","+y1+"L0,0M0,-"+y0+"L0,0"},needLine:!0,noDot:!0,noFill:!0},"y-down":{n:38,f:function(r){var x=d3.round(1.2*r,2),y0=d3.round(1.6*r,2),y1=d3.round(.8*r,2);return"M-"+x+",-"+y1+"L0,0M"+x+",-"+y1+"L0,0M0,"+y0+"L0,0"},needLine:!0,noDot:!0,noFill:!0},"y-left":{n:39,f:function(r){var y=d3.round(1.2*r,2),x0=d3.round(1.6*r,2),x1=d3.round(.8*r,2);return"M"+x1+","+y+"L0,0M"+x1+",-"+y+"L0,0M-"+x0+",0L0,0"},needLine:!0,noDot:!0,noFill:!0},"y-right":{n:40,f:function(r){var y=d3.round(1.2*r,2),x0=d3.round(1.6*r,2),x1=d3.round(.8*r,2);return"M-"+x1+","+y+"L0,0M-"+x1+",-"+y+"L0,0M"+x0+",0L0,0"},needLine:!0,noDot:!0,noFill:!0},"line-ew":{n:41,f:function(r){var rc=d3.round(1.4*r,2);return"M"+rc+",0H-"+rc},needLine:!0,noDot:!0,noFill:!0},"line-ns":{n:42,f:function(r){var rc=d3.round(1.4*r,2);return"M0,"+rc+"V-"+rc},needLine:!0,noDot:!0,noFill:!0},"line-ne":{n:43,f:function(r){var rx=d3.round(r,2);return"M"+rx+",-"+rx+"L-"+rx+","+rx},needLine:!0,noDot:!0,noFill:!0},"line-nw":{n:44,f:function(r){var rx=d3.round(r,2);return"M"+rx+","+rx+"L-"+rx+",-"+rx},needLine:!0,noDot:!0,noFill:!0}}},{d3:147}],594:[function(_dereq_,module,exports){"use strict";module.exports={visible:{valType:"boolean",editType:"calc"},type:{valType:"enumerated",values:["percent","constant","sqrt","data"],editType:"calc"},symmetric:{valType:"boolean",editType:"calc"},array:{valType:"data_array",editType:"calc"},arrayminus:{valType:"data_array",editType:"calc"},value:{valType:"number",min:0,dflt:10,editType:"calc"},valueminus:{valType:"number",min:0,dflt:10,editType:"calc"},traceref:{valType:"integer",min:0,dflt:0,editType:"style"},tracerefminus:{valType:"integer",min:0,dflt:0,editType:"style"},copy_ystyle:{valType:"boolean",editType:"plot"},copy_zstyle:{valType:"boolean",editType:"style"},color:{valType:"color",editType:"style"},thickness:{valType:"number",min:0,dflt:2,editType:"style"},width:{valType:"number",min:0,editType:"plot"},editType:"calc",_deprecated:{opacity:{valType:"number",editType:"style"}}}},{}],595:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Registry=_dereq_("../../registry"),Axes=_dereq_("../../plots/cartesian/axes"),makeComputeError=_dereq_("./compute_error");function calcOneAxis(calcTrace,trace,axis,coord){var opts=trace["error_"+coord]||{},vals=[];if(opts.visible&&-1!==["linear","log"].indexOf(axis.type)){for(var computeError=makeComputeError(opts),i=0;i<calcTrace.length;i++){var calcPt=calcTrace[i],iIn=calcPt.i;if(void 0===iIn)iIn=i;else if(null===iIn)continue;var calcCoord=calcPt[coord];if(isNumeric(axis.c2l(calcCoord))){var errors=computeError(calcCoord,iIn);if(isNumeric(errors[0])&&isNumeric(errors[1])){var shoe=calcPt[coord+"s"]=calcCoord-errors[0],hat=calcPt[coord+"h"]=calcCoord+errors[1];vals.push(shoe,hat)}}}var extremes=Axes.findExtremes(axis,vals,{padded:!0}),axId=axis._id;trace._extremes[axId].min=trace._extremes[axId].min.concat(extremes.min),trace._extremes[axId].max=trace._extremes[axId].max.concat(extremes.max)}}module.exports=function calc(gd){for(var calcdata=gd.calcdata,i=0;i<calcdata.length;i++){var calcTrace=calcdata[i],trace=calcTrace[0].trace;if(!0===trace.visible&&Registry.traceIs(trace,"errorBarsOK")){var xa=Axes.getFromId(gd,trace.xaxis),ya=Axes.getFromId(gd,trace.yaxis);calcOneAxis(calcTrace,trace,xa,"x"),calcOneAxis(calcTrace,trace,ya,"y")}}}},{"../../plots/cartesian/axes":742,"../../registry":825,"./compute_error":596,"fast-isnumeric":213}],596:[function(_dereq_,module,exports){"use strict";function makeComputeErrorValue(type,value){return"percent"===type?function(dataPt){return Math.abs(dataPt*value/100)}:"constant"===type?function(){return Math.abs(value)}:"sqrt"===type?function(dataPt){return Math.sqrt(Math.abs(dataPt))}:void 0}module.exports=function makeComputeError(opts){var type=opts.type,symmetric=opts.symmetric;if("data"===type){var array=opts.array||[];if(symmetric)return function computeError(dataPt,index){var val=+array[index];return[val,val]};var arrayminus=opts.arrayminus||[];return function computeError(dataPt,index){var val=+array[index],valMinus=+arrayminus[index];return isNaN(val)&&isNaN(valMinus)?[NaN,NaN]:[valMinus||0,val||0]}}var computeErrorValue=makeComputeErrorValue(type,opts.value),computeErrorValueMinus=makeComputeErrorValue(type,opts.valueminus);return symmetric||void 0===opts.valueminus?function computeError(dataPt){var val=computeErrorValue(dataPt);return[val,val]}:function computeError(dataPt){return[computeErrorValueMinus(dataPt),computeErrorValue(dataPt)]}}},{}],597:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Template=_dereq_("../../plot_api/plot_template"),attributes=_dereq_("./attributes");module.exports=function(traceIn,traceOut,defaultColor,opts){var objName="error_"+opts.axis,containerOut=Template.newContainer(traceOut,objName),containerIn=traceIn[objName]||{};function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,attributes,attr,dflt)}if(!1!==coerce("visible",void 0!==containerIn.array||void 0!==containerIn.value||"sqrt"===containerIn.type)){var type=coerce("type","array"in containerIn?"data":"percent"),symmetric=!0;"sqrt"!==type&&(symmetric=coerce("symmetric",!(("data"===type?"arrayminus":"valueminus")in containerIn))),"data"===type?(coerce("array"),coerce("traceref"),symmetric||(coerce("arrayminus"),coerce("tracerefminus"))):"percent"!==type&&"constant"!==type||(coerce("value"),symmetric||coerce("valueminus"));var copyAttr="copy_"+opts.inherit+"style";if(opts.inherit)(traceOut["error_"+opts.inherit]||{}).visible&&coerce(copyAttr,!(containerIn.color||isNumeric(containerIn.thickness)||isNumeric(containerIn.width)));opts.inherit&&containerOut[copyAttr]||(coerce("color",defaultColor),coerce("thickness"),coerce("width",Registry.traceIs(traceOut,"gl3d")?0:4))}}},{"../../lib":693,"../../plot_api/plot_template":732,"../../registry":825,"./attributes":594,"fast-isnumeric":213}],598:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,attributes=_dereq_("./attributes"),xyAttrs={error_x:Lib.extendFlat({},attributes),error_y:Lib.extendFlat({},attributes)};delete xyAttrs.error_x.copy_zstyle,delete xyAttrs.error_y.copy_zstyle,delete xyAttrs.error_y.copy_ystyle;var xyzAttrs={error_x:Lib.extendFlat({},attributes),error_y:Lib.extendFlat({},attributes),error_z:Lib.extendFlat({},attributes)};delete xyzAttrs.error_x.copy_ystyle,delete xyzAttrs.error_y.copy_ystyle,delete xyzAttrs.error_z.copy_ystyle,delete xyzAttrs.error_z.copy_zstyle,module.exports={moduleType:"component",name:"errorbars",schema:{traces:{scatter:xyAttrs,bar:xyAttrs,histogram:xyAttrs,scatter3d:overrideAll(xyzAttrs,"calc","nested"),scattergl:overrideAll(xyAttrs,"calc","nested")}},supplyDefaults:_dereq_("./defaults"),calc:_dereq_("./calc"),makeComputeError:_dereq_("./compute_error"),plot:_dereq_("./plot"),style:_dereq_("./style"),hoverInfo:function hoverInfo(calcPoint,trace,hoverPoint){(trace.error_y||{}).visible&&(hoverPoint.yerr=calcPoint.yh-calcPoint.y,trace.error_y.symmetric||(hoverPoint.yerrneg=calcPoint.y-calcPoint.ys));(trace.error_x||{}).visible&&(hoverPoint.xerr=calcPoint.xh-calcPoint.x,trace.error_x.symmetric||(hoverPoint.xerrneg=calcPoint.x-calcPoint.xs))}}},{"../../lib":693,"../../plot_api/edit_types":725,"./attributes":594,"./calc":595,"./compute_error":596,"./defaults":597,"./plot":599,"./style":600}],599:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Drawing=_dereq_("../drawing"),subTypes=_dereq_("../../traces/scatter/subtypes");module.exports=function plot(traces,plotinfo,transitionOpts){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,hasAnimation=transitionOpts&&transitionOpts.duration>0;traces.each(function(d){var keyFunc,trace=d[0].trace,xObj=trace.error_x||{},yObj=trace.error_y||{};trace.ids&&(keyFunc=function(d){return d.id});var sparse=subTypes.hasMarkers(trace)&&trace.marker.maxdisplayed>0;yObj.visible||xObj.visible||(d=[]);var errorbars=d3.select(this).selectAll("g.errorbar").data(d,keyFunc);if(errorbars.exit().remove(),d.length){xObj.visible||errorbars.selectAll("path.xerror").remove(),yObj.visible||errorbars.selectAll("path.yerror").remove(),errorbars.style("opacity",1);var enter=errorbars.enter().append("g").classed("errorbar",!0);hasAnimation&&enter.style("opacity",0).transition().duration(transitionOpts.duration).style("opacity",1),Drawing.setClipUrl(errorbars,plotinfo.layerClipId),errorbars.each(function(d){var errorbar=d3.select(this),coords=function errorCoords(d,xa,ya){var out={x:xa.c2p(d.x),y:ya.c2p(d.y)};void 0!==d.yh&&(out.yh=ya.c2p(d.yh),out.ys=ya.c2p(d.ys),isNumeric(out.ys)||(out.noYS=!0,out.ys=ya.c2p(d.ys,!0)));void 0!==d.xh&&(out.xh=xa.c2p(d.xh),out.xs=xa.c2p(d.xs),isNumeric(out.xs)||(out.noXS=!0,out.xs=xa.c2p(d.xs,!0)));return out}(d,xa,ya);if(!sparse||d.vis){var path,yerror=errorbar.select("path.yerror");if(yObj.visible&&isNumeric(coords.x)&&isNumeric(coords.yh)&&isNumeric(coords.ys)){var yw=yObj.width;path="M"+(coords.x-yw)+","+coords.yh+"h"+2*yw+"m-"+yw+",0V"+coords.ys,coords.noYS||(path+="m-"+yw+",0h"+2*yw),!yerror.size()?yerror=errorbar.append("path").style("vector-effect","non-scaling-stroke").classed("yerror",!0):hasAnimation&&(yerror=yerror.transition().duration(transitionOpts.duration).ease(transitionOpts.easing)),yerror.attr("d",path)}else yerror.remove();var xerror=errorbar.select("path.xerror");if(xObj.visible&&isNumeric(coords.y)&&isNumeric(coords.xh)&&isNumeric(coords.xs)){var xw=(xObj.copy_ystyle?yObj:xObj).width;path="M"+coords.xh+","+(coords.y-xw)+"v"+2*xw+"m0,-"+xw+"H"+coords.xs,coords.noXS||(path+="m0,-"+xw+"v"+2*xw),!xerror.size()?xerror=errorbar.append("path").style("vector-effect","non-scaling-stroke").classed("xerror",!0):hasAnimation&&(xerror=xerror.transition().duration(transitionOpts.duration).ease(transitionOpts.easing)),xerror.attr("d",path)}else xerror.remove()}})}})}},{"../../traces/scatter/subtypes":1056,"../drawing":592,d3:147,"fast-isnumeric":213}],600:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Color=_dereq_("../color");module.exports=function style(traces){traces.each(function(d){var trace=d[0].trace,yObj=trace.error_y||{},xObj=trace.error_x||{},s=d3.select(this);s.selectAll("path.yerror").style("stroke-width",yObj.thickness+"px").call(Color.stroke,yObj.color),xObj.copy_ystyle&&(xObj=yObj),s.selectAll("path.xerror").style("stroke-width",xObj.thickness+"px").call(Color.stroke,xObj.color)})}},{"../color":567,d3:147}],601:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes");module.exports={hoverlabel:{bgcolor:{valType:"color",arrayOk:!0,editType:"none"},bordercolor:{valType:"color",arrayOk:!0,editType:"none"},font:fontAttrs({arrayOk:!0,editType:"none"}),namelength:{valType:"integer",min:-1,arrayOk:!0,editType:"none"},editType:"calc"}}},{"../../plots/font_attributes":768}],602:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry");function paste(traceAttr,cd,cdAttr,fn){fn=fn||Lib.identity,Array.isArray(traceAttr)&&(cd[0][cdAttr]=fn(traceAttr))}module.exports=function calc(gd){var calcdata=gd.calcdata,fullLayout=gd._fullLayout;function makeCoerceHoverInfo(trace){return function(val){return Lib.coerceHoverinfo({hoverinfo:val},{_module:trace._module},fullLayout)}}for(var i=0;i<calcdata.length;i++){var cd=calcdata[i],trace=cd[0].trace;if(!Registry.traceIs(trace,"pie")){var fillFn=Registry.traceIs(trace,"2dMap")?paste:Lib.fillArray;fillFn(trace.hoverinfo,cd,"hi",makeCoerceHoverInfo(trace)),trace.hoverlabel&&(fillFn(trace.hoverlabel.bgcolor,cd,"hbg"),fillFn(trace.hoverlabel.bordercolor,cd,"hbc"),fillFn(trace.hoverlabel.font.size,cd,"hts"),fillFn(trace.hoverlabel.font.color,cd,"htc"),fillFn(trace.hoverlabel.font.family,cd,"htf"),fillFn(trace.hoverlabel.namelength,cd,"hnl"))}}}},{"../../lib":693,"../../registry":825}],603:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),hover=_dereq_("./hover").hover;module.exports=function click(gd,evt,subplot){var annotationsDone=Registry.getComponentMethod("annotations","onClick")(gd,gd._hoverdata);function emitClick(){gd.emit("plotly_click",{points:gd._hoverdata,event:evt})}void 0!==subplot&&hover(gd,evt,subplot,!0),gd._hoverdata&&evt&&evt.target&&(annotationsDone&&annotationsDone.then?annotationsDone.then(emitClick):emitClick(),evt.stopImmediatePropagation&&evt.stopImmediatePropagation())}},{"../../registry":825,"./hover":607}],604:[function(_dereq_,module,exports){"use strict";module.exports={YANGLE:60,HOVERARROWSIZE:6,HOVERTEXTPAD:3,HOVERFONTSIZE:13,HOVERFONT:"Arial, sans-serif",HOVERMINTIME:50,HOVERID:"-hover"}},{}],605:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attributes=_dereq_("./attributes"),handleHoverLabelDefaults=_dereq_("./hoverlabel_defaults");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){handleHoverLabelDefaults(traceIn,traceOut,function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)},layout.hoverlabel)}},{"../../lib":693,"./attributes":601,"./hoverlabel_defaults":608}],606:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");exports.getSubplot=function getSubplot(trace){return trace.subplot||trace.xaxis+trace.yaxis||trace.geo},exports.isTraceInSubplots=function isTraceInSubplot(trace,subplots){if("splom"===trace.type){for(var xaxes=trace.xaxes||[],yaxes=trace.yaxes||[],i=0;i<xaxes.length;i++)for(var j=0;j<yaxes.length;j++)if(-1!==subplots.indexOf(xaxes[i]+yaxes[j]))return!0;return!1}return-1!==subplots.indexOf(exports.getSubplot(trace))},exports.flat=function flat(subplots,v){for(var out=new Array(subplots.length),i=0;i<subplots.length;i++)out[i]=v;return out},exports.p2c=function p2c(axArray,v){for(var out=new Array(axArray.length),i=0;i<axArray.length;i++)out[i]=axArray[i].p2c(v);return out},exports.getDistanceFunction=function getDistanceFunction(mode,dx,dy,dxy){return"closest"===mode?dxy||exports.quadrature(dx,dy):"x"===mode?dx:dy},exports.getClosest=function getClosest(cd,distfn,pointData){if(!1!==pointData.index)pointData.index>=0&&pointData.index<cd.length?pointData.distance=0:pointData.index=!1;else for(var i=0;i<cd.length;i++){var newDistance=distfn(cd[i]);newDistance<=pointData.distance&&(pointData.index=i,pointData.distance=newDistance)}return pointData},exports.inbox=function inbox(v0,v1,passVal){return v0*v1<0||0===v0?passVal:1/0},exports.quadrature=function quadrature(dx,dy){return function(di){var x=dx(di),y=dy(di);return Math.sqrt(x*x+y*y)}},exports.makeEventData=function makeEventData(pt,trace,cd){var pointNumber="index"in pt?pt.index:pt.pointNumber,out={data:trace._input,fullData:trace,curveNumber:trace.index,pointNumber:pointNumber};if(trace._indexToPoints){var pointIndices=trace._indexToPoints[pointNumber];1===pointIndices.length?out.pointIndex=pointIndices[0]:out.pointIndices=pointIndices}else out.pointIndex=pointNumber;return trace._module.eventData?out=trace._module.eventData(out,pt,trace,cd,pointNumber):("xVal"in pt?out.x=pt.xVal:"x"in pt&&(out.x=pt.x),"yVal"in pt?out.y=pt.yVal:"y"in pt&&(out.y=pt.y),pt.xa&&(out.xaxis=pt.xa),pt.ya&&(out.yaxis=pt.ya),void 0!==pt.zLabelVal&&(out.z=pt.zLabelVal)),exports.appendArrayPointValue(out,trace,pointNumber),out},exports.appendArrayPointValue=function(pointData,trace,pointNumber){var arrayAttrs=trace._arrayAttrs;if(arrayAttrs)for(var i=0;i<arrayAttrs.length;i++){var astr=arrayAttrs[i],key=getPointKey(astr);if(void 0===pointData[key]){var pointVal=getPointData(Lib.nestedProperty(trace,astr).get(),pointNumber);void 0!==pointVal&&(pointData[key]=pointVal)}}},exports.appendArrayMultiPointValues=function(pointData,trace,pointNumbers){var arrayAttrs=trace._arrayAttrs;if(arrayAttrs)for(var i=0;i<arrayAttrs.length;i++){var astr=arrayAttrs[i],key=getPointKey(astr);if(void 0===pointData[key]){for(var val=Lib.nestedProperty(trace,astr).get(),keyVal=new Array(pointNumbers.length),j=0;j<pointNumbers.length;j++)keyVal[j]=getPointData(val,pointNumbers[j]);pointData[key]=keyVal}}};var pointKeyMap={ids:"id",locations:"location",labels:"label",values:"value","marker.colors":"color"};function getPointKey(astr){return pointKeyMap[astr]||astr}function getPointData(val,pointNumber){return Array.isArray(pointNumber)?Array.isArray(val)&&Array.isArray(val[pointNumber[0]])?val[pointNumber[0]][pointNumber[1]]:void 0:val[pointNumber]}},{"../../lib":693}],607:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),tinycolor=_dereq_("tinycolor2"),Lib=_dereq_("../../lib"),Events=_dereq_("../../lib/events"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),overrideCursor=_dereq_("../../lib/override_cursor"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),dragElement=_dereq_("../dragelement"),Axes=_dereq_("../../plots/cartesian/axes"),Registry=_dereq_("../../registry"),helpers=_dereq_("./helpers"),constants=_dereq_("./constants"),YANGLE=constants.YANGLE,YA_RADIANS=Math.PI*YANGLE/180,YFACTOR=1/Math.sin(YA_RADIANS),YSHIFTX=Math.cos(YA_RADIANS),YSHIFTY=Math.sin(YA_RADIANS),HOVERARROWSIZE=constants.HOVERARROWSIZE,HOVERTEXTPAD=constants.HOVERTEXTPAD;function createHoverText(hoverData,opts,gd){var hovermode=opts.hovermode,rotateLabels=opts.rotateLabels,bgColor=opts.bgColor,container=opts.container,outerContainer=opts.outerContainer,commonLabelOpts=opts.commonLabelOpts||{},fontFamily=opts.fontFamily||constants.HOVERFONT,fontSize=opts.fontSize||constants.HOVERFONTSIZE,c0=hoverData[0],xa=c0.xa,ya=c0.ya,commonAttr="y"===hovermode?"yLabel":"xLabel",t0=c0[commonAttr],t00=(String(t0)||"").split(" ")[0],outerContainerBB=outerContainer.node().getBoundingClientRect(),outerTop=outerContainerBB.top,outerWidth=outerContainerBB.width,outerHeight=outerContainerBB.height,showCommonLabel=void 0!==t0&&c0.distance<=opts.hoverdistance&&("x"===hovermode||"y"===hovermode);if(showCommonLabel){var i,traceHoverinfo,allHaveZ=!0;for(i=0;i<hoverData.length;i++){allHaveZ&&void 0===hoverData[i].zLabel&&(allHaveZ=!1),traceHoverinfo=hoverData[i].hoverinfo||hoverData[i].trace.hoverinfo;var parts=Array.isArray(traceHoverinfo)?traceHoverinfo:traceHoverinfo.split("+");if(-1===parts.indexOf("all")&&-1===parts.indexOf(hovermode)){showCommonLabel=!1;break}}allHaveZ&&(showCommonLabel=!1)}var commonLabel=container.selectAll("g.axistext").data(showCommonLabel?[0]:[]);commonLabel.enter().append("g").classed("axistext",!0),commonLabel.exit().remove(),commonLabel.each(function(){var label=d3.select(this),lpath=Lib.ensureSingle(label,"path","",function(s){s.style({"stroke-width":"1px"})}),ltext=Lib.ensureSingle(label,"text","",function(s){s.attr("data-notex",1)}),commonBgColor=commonLabelOpts.bgcolor||Color.defaultLine,commonStroke=commonLabelOpts.bordercolor||Color.contrast(commonBgColor),contrastColor=Color.contrast(commonBgColor);lpath.style({fill:commonBgColor,stroke:commonStroke}),ltext.text(t0).call(Drawing.font,commonLabelOpts.font.family||fontFamily,commonLabelOpts.font.size||fontSize,commonLabelOpts.font.color||contrastColor).call(svgTextUtils.positionText,0,0).call(svgTextUtils.convertToTspans,gd),label.attr("transform","");var tbb=ltext.node().getBoundingClientRect();if("x"===hovermode){ltext.attr("text-anchor","middle").call(svgTextUtils.positionText,0,"top"===xa.side?outerTop-tbb.bottom-HOVERARROWSIZE-HOVERTEXTPAD:outerTop-tbb.top+HOVERARROWSIZE+HOVERTEXTPAD);var topsign="top"===xa.side?"-":"";lpath.attr("d","M0,0L"+HOVERARROWSIZE+","+topsign+HOVERARROWSIZE+"H"+(HOVERTEXTPAD+tbb.width/2)+"v"+topsign+(2*HOVERTEXTPAD+tbb.height)+"H-"+(HOVERTEXTPAD+tbb.width/2)+"V"+topsign+HOVERARROWSIZE+"H-"+HOVERARROWSIZE+"Z"),label.attr("transform","translate("+(xa._offset+(c0.x0+c0.x1)/2)+","+(ya._offset+("top"===xa.side?0:ya._length))+")")}else{ltext.attr("text-anchor","right"===ya.side?"start":"end").call(svgTextUtils.positionText,("right"===ya.side?1:-1)*(HOVERTEXTPAD+HOVERARROWSIZE),outerTop-tbb.top-tbb.height/2);var leftsign="right"===ya.side?"":"-";lpath.attr("d","M0,0L"+leftsign+HOVERARROWSIZE+","+HOVERARROWSIZE+"V"+(HOVERTEXTPAD+tbb.height/2)+"h"+leftsign+(2*HOVERTEXTPAD+tbb.width)+"V-"+(HOVERTEXTPAD+tbb.height/2)+"H"+leftsign+HOVERARROWSIZE+"V-"+HOVERARROWSIZE+"Z"),label.attr("transform","translate("+(xa._offset+("right"===ya.side?xa._length:0))+","+(ya._offset+(c0.y0+c0.y1)/2)+")")}hoverData=hoverData.filter(function(d){return void 0!==d.zLabelVal||(d[commonAttr]||"").split(" ")[0]===t00})});var hoverLabels=container.selectAll("g.hovertext").data(hoverData,function(d){return[d.trace.index,d.index,d.x0,d.y0,d.name,d.attr,d.xa,d.ya||""].join(",")});return hoverLabels.enter().append("g").classed("hovertext",!0).each(function(){var g=d3.select(this);g.append("rect").call(Color.fill,Color.addOpacity(bgColor,.8)),g.append("text").classed("name",!0),g.append("path").style("stroke-width","1px"),g.append("text").classed("nums",!0).call(Drawing.font,fontFamily,fontSize)}),hoverLabels.exit().remove(),hoverLabels.each(function(d){var g=d3.select(this).attr("transform",""),name="",text="",color0=d.bgcolor||d.color,numsColor=Color.combine(Color.opacity(color0)?color0:Color.defaultLine,bgColor),nameColor=Color.combine(Color.opacity(d.color)?d.color:Color.defaultLine,bgColor),contrastColor=d.borderColor||Color.contrast(numsColor);if(void 0!==d.nameOverride&&(d.name=d.nameOverride),d.name){name=svgTextUtils.plainText(d.name||"");var nameLength=Math.round(d.nameLength);nameLength>-1&&name.length>nameLength&&(name=nameLength>3?name.substr(0,nameLength-3)+"...":name.substr(0,nameLength))}void 0!==d.zLabel?(void 0!==d.xLabel&&(text+="x: "+d.xLabel+"<br>"),void 0!==d.yLabel&&(text+="y: "+d.yLabel+"<br>"),text+=(text?"z: ":"")+d.zLabel):showCommonLabel&&d[hovermode+"Label"]===t0?text=d[("x"===hovermode?"y":"x")+"Label"]||"":void 0===d.xLabel?void 0!==d.yLabel&&(text=d.yLabel):text=void 0===d.yLabel?d.xLabel:"("+d.xLabel+", "+d.yLabel+")",!d.text&&0!==d.text||Array.isArray(d.text)||(text+=(text?"<br>":"")+d.text),void 0!==d.extraText&&(text+=(text?"<br>":"")+d.extraText),""===text&&(""===name&&g.remove(),text=name);var tx=g.select("text.nums").call(Drawing.font,d.fontFamily||fontFamily,d.fontSize||fontSize,d.fontColor||contrastColor).text(text).attr("data-notex",1).call(svgTextUtils.positionText,0,0).call(svgTextUtils.convertToTspans,gd),tx2=g.select("text.name"),tx2width=0;name&&name!==text?(tx2.call(Drawing.font,d.fontFamily||fontFamily,d.fontSize||fontSize,nameColor).text(name).attr("data-notex",1).call(svgTextUtils.positionText,0,0).call(svgTextUtils.convertToTspans,gd),tx2width=tx2.node().getBoundingClientRect().width+2*HOVERTEXTPAD):(tx2.remove(),g.select("rect").remove()),g.select("path").style({fill:numsColor,stroke:contrastColor});var anchorStartOK,anchorEndOK,tbb=tx.node().getBoundingClientRect(),htx=d.xa._offset+(d.x0+d.x1)/2,hty=d.ya._offset+(d.y0+d.y1)/2,dx=Math.abs(d.x1-d.x0),dy=Math.abs(d.y1-d.y0),txTotalWidth=tbb.width+HOVERARROWSIZE+HOVERTEXTPAD+tx2width;d.ty0=outerTop-tbb.top,d.bx=tbb.width+2*HOVERTEXTPAD,d.by=tbb.height+2*HOVERTEXTPAD,d.anchor="start",d.txwidth=tbb.width,d.tx2width=tx2width,d.offset=0,rotateLabels?(d.pos=htx,anchorStartOK=hty+dy/2+txTotalWidth<=outerHeight,anchorEndOK=hty-dy/2-txTotalWidth>=0,"top"!==d.idealAlign&&anchorStartOK||!anchorEndOK?anchorStartOK?(hty+=dy/2,d.anchor="start"):d.anchor="middle":(hty-=dy/2,d.anchor="end")):(d.pos=hty,anchorStartOK=htx+dx/2+txTotalWidth<=outerWidth,anchorEndOK=htx-dx/2-txTotalWidth>=0,"left"!==d.idealAlign&&anchorStartOK||!anchorEndOK?anchorStartOK?(htx+=dx/2,d.anchor="start"):d.anchor="middle":(htx-=dx/2,d.anchor="end")),tx.attr("text-anchor",d.anchor),tx2width&&tx2.attr("text-anchor",d.anchor),g.attr("transform","translate("+htx+","+hty+")"+(rotateLabels?"rotate("+YANGLE+")":""))}),hoverLabels}function alignHoverText(hoverLabels,rotateLabels){hoverLabels.each(function(d){var g=d3.select(this);if(d.del)g.remove();else{var horzSign="end"===d.anchor?-1:1,tx=g.select("text.nums"),alignShift={start:1,end:-1,middle:0}[d.anchor],txx=alignShift*(HOVERARROWSIZE+HOVERTEXTPAD),tx2x=txx+alignShift*(d.txwidth+HOVERTEXTPAD),offsetX=0,offsetY=d.offset;"middle"===d.anchor&&(txx-=d.tx2width/2,tx2x+=d.txwidth/2+HOVERTEXTPAD),rotateLabels&&(offsetY*=-YSHIFTY,offsetX=d.offset*YSHIFTX),g.select("path").attr("d","middle"===d.anchor?"M-"+(d.bx/2+d.tx2width/2)+","+(offsetY-d.by/2)+"h"+d.bx+"v"+d.by+"h-"+d.bx+"Z":"M0,0L"+(horzSign*HOVERARROWSIZE+offsetX)+","+(HOVERARROWSIZE+offsetY)+"v"+(d.by/2-HOVERARROWSIZE)+"h"+horzSign*d.bx+"v-"+d.by+"H"+(horzSign*HOVERARROWSIZE+offsetX)+"V"+(offsetY-HOVERARROWSIZE)+"Z"),tx.call(svgTextUtils.positionText,txx+offsetX,offsetY+d.ty0-d.by/2+HOVERTEXTPAD),d.tx2width&&(g.select("text.name").call(svgTextUtils.positionText,tx2x+alignShift*HOVERTEXTPAD+offsetX,offsetY+d.ty0-d.by/2+HOVERTEXTPAD),g.select("rect").call(Drawing.setRect,tx2x+(alignShift-1)*d.tx2width/2+offsetX,offsetY-d.by/2-1,d.tx2width,d.by+2))}})}function cleanPoint(d,hovermode){var index=d.index,trace=d.trace||{},cd0=d.cd[0],cd=d.cd[index]||{},getVal=Array.isArray(index)?function(calcKey,traceKey){return Lib.castOption(cd0,index,calcKey)||Lib.extractOption({},trace,"",traceKey)}:function(calcKey,traceKey){return Lib.extractOption(cd,trace,calcKey,traceKey)};function fill(key,calcKey,traceKey){var val=getVal(calcKey,traceKey);val&&(d[key]=val)}if(fill("hoverinfo","hi","hoverinfo"),fill("bgcolor","hbg","hoverlabel.bgcolor"),fill("borderColor","hbc","hoverlabel.bordercolor"),fill("fontFamily","htf","hoverlabel.font.family"),fill("fontSize","hts","hoverlabel.font.size"),fill("fontColor","htc","hoverlabel.font.color"),fill("nameLength","hnl","hoverlabel.namelength"),d.posref="y"===hovermode?d.xa._offset+(d.x0+d.x1)/2:d.ya._offset+(d.y0+d.y1)/2,d.x0=Lib.constrain(d.x0,0,d.xa._length),d.x1=Lib.constrain(d.x1,0,d.xa._length),d.y0=Lib.constrain(d.y0,0,d.ya._length),d.y1=Lib.constrain(d.y1,0,d.ya._length),void 0!==d.xLabelVal&&(d.xLabel="xLabel"in d?d.xLabel:Axes.hoverLabelText(d.xa,d.xLabelVal),d.xVal=d.xa.c2d(d.xLabelVal)),void 0!==d.yLabelVal&&(d.yLabel="yLabel"in d?d.yLabel:Axes.hoverLabelText(d.ya,d.yLabelVal),d.yVal=d.ya.c2d(d.yLabelVal)),void 0!==d.zLabelVal&&void 0===d.zLabel&&(d.zLabel=String(d.zLabelVal)),!(isNaN(d.xerr)||"log"===d.xa.type&&d.xerr<=0)){var xeText=Axes.tickText(d.xa,d.xa.c2l(d.xerr),"hover").text;void 0!==d.xerrneg?d.xLabel+=" +"+xeText+" / -"+Axes.tickText(d.xa,d.xa.c2l(d.xerrneg),"hover").text:d.xLabel+="  "+xeText,"x"===hovermode&&(d.distance+=1)}if(!(isNaN(d.yerr)||"log"===d.ya.type&&d.yerr<=0)){var yeText=Axes.tickText(d.ya,d.ya.c2l(d.yerr),"hover").text;void 0!==d.yerrneg?d.yLabel+=" +"+yeText+" / -"+Axes.tickText(d.ya,d.ya.c2l(d.yerrneg),"hover").text:d.yLabel+="  "+yeText,"y"===hovermode&&(d.distance+=1)}var infomode=d.hoverinfo||d.trace.hoverinfo;return"all"!==infomode&&(-1===(infomode=Array.isArray(infomode)?infomode:infomode.split("+")).indexOf("x")&&(d.xLabel=void 0),-1===infomode.indexOf("y")&&(d.yLabel=void 0),-1===infomode.indexOf("z")&&(d.zLabel=void 0),-1===infomode.indexOf("text")&&(d.text=void 0),-1===infomode.indexOf("name")&&(d.name=void 0)),d}function createSpikelines(closestPoints,opts){var xa,ya,container=opts.container,fullLayout=opts.fullLayout,evt=opts.event,showY=!!closestPoints.hLinePoint,showX=!!closestPoints.vLinePoint;if(container.selectAll(".spikeline").remove(),showX||showY){var contrastColor=Color.combine(fullLayout.plot_bgcolor,fullLayout.paper_bgcolor);if(showY){var hLinePointX,hLinePointY,hLinePoint=closestPoints.hLinePoint;xa=hLinePoint&&hLinePoint.xa,"cursor"===(ya=hLinePoint&&hLinePoint.ya).spikesnap?(hLinePointX=evt.pointerX,hLinePointY=evt.pointerY):(hLinePointX=xa._offset+hLinePoint.x,hLinePointY=ya._offset+hLinePoint.y);var xBase,xEndSpike,dfltHLineColor=tinycolor.readability(hLinePoint.color,contrastColor)<1.5?Color.contrast(contrastColor):hLinePoint.color,yMode=ya.spikemode,yThickness=ya.spikethickness,yColor=ya.spikecolor||dfltHLineColor,yBB=ya._boundingBox,xEdge=(yBB.left+yBB.right)/2<hLinePointX?yBB.right:yBB.left;-1===yMode.indexOf("toaxis")&&-1===yMode.indexOf("across")||(-1!==yMode.indexOf("toaxis")&&(xBase=xEdge,xEndSpike=hLinePointX),-1!==yMode.indexOf("across")&&(xBase=ya._counterSpan[0],xEndSpike=ya._counterSpan[1]),container.insert("line",":first-child").attr({x1:xBase,x2:xEndSpike,y1:hLinePointY,y2:hLinePointY,"stroke-width":yThickness,stroke:yColor,"stroke-dasharray":Drawing.dashStyle(ya.spikedash,yThickness)}).classed("spikeline",!0).classed("crisp",!0),container.insert("line",":first-child").attr({x1:xBase,x2:xEndSpike,y1:hLinePointY,y2:hLinePointY,"stroke-width":yThickness+2,stroke:contrastColor}).classed("spikeline",!0).classed("crisp",!0)),-1!==yMode.indexOf("marker")&&container.insert("circle",":first-child").attr({cx:xEdge+("right"!==ya.side?yThickness:-yThickness),cy:hLinePointY,r:yThickness,fill:yColor}).classed("spikeline",!0)}if(showX){var vLinePointX,vLinePointY,vLinePoint=closestPoints.vLinePoint;xa=vLinePoint&&vLinePoint.xa,ya=vLinePoint&&vLinePoint.ya,"cursor"===xa.spikesnap?(vLinePointX=evt.pointerX,vLinePointY=evt.pointerY):(vLinePointX=xa._offset+vLinePoint.x,vLinePointY=ya._offset+vLinePoint.y);var yBase,yEndSpike,dfltVLineColor=tinycolor.readability(vLinePoint.color,contrastColor)<1.5?Color.contrast(contrastColor):vLinePoint.color,xMode=xa.spikemode,xThickness=xa.spikethickness,xColor=xa.spikecolor||dfltVLineColor,xBB=xa._boundingBox,yEdge=(xBB.top+xBB.bottom)/2<vLinePointY?xBB.bottom:xBB.top;-1===xMode.indexOf("toaxis")&&-1===xMode.indexOf("across")||(-1!==xMode.indexOf("toaxis")&&(yBase=yEdge,yEndSpike=vLinePointY),-1!==xMode.indexOf("across")&&(yBase=xa._counterSpan[0],yEndSpike=xa._counterSpan[1]),container.insert("line",":first-child").attr({x1:vLinePointX,x2:vLinePointX,y1:yBase,y2:yEndSpike,"stroke-width":xThickness,stroke:xColor,"stroke-dasharray":Drawing.dashStyle(xa.spikedash,xThickness)}).classed("spikeline",!0).classed("crisp",!0),container.insert("line",":first-child").attr({x1:vLinePointX,x2:vLinePointX,y1:yBase,y2:yEndSpike,"stroke-width":xThickness+2,stroke:contrastColor}).classed("spikeline",!0).classed("crisp",!0)),-1!==xMode.indexOf("marker")&&container.insert("circle",":first-child").attr({cx:vLinePointX,cy:yEdge-("top"!==xa.side?xThickness:-xThickness),r:xThickness,fill:xColor}).classed("spikeline",!0)}}}function spikesChanged(gd,oldspikepoints){return!oldspikepoints||(oldspikepoints.vLinePoint!==gd._spikepoints.vLinePoint||oldspikepoints.hLinePoint!==gd._spikepoints.hLinePoint)}exports.hover=function hover(gd,evt,subplot,noHoverEvent){gd=Lib.getGraphDiv(gd),Lib.throttle(gd._fullLayout._uid+constants.HOVERID,constants.HOVERMINTIME,function(){!function _hover(gd,evt,subplot,noHoverEvent){subplot||(subplot="xy");var subplots=Array.isArray(subplot)?subplot:[subplot],fullLayout=gd._fullLayout,plots=fullLayout._plots||[],plotinfo=plots[subplot],hasCartesian=fullLayout._has("cartesian");if(plotinfo){var overlayedSubplots=plotinfo.overlays.map(function(pi){return pi.id});subplots=subplots.concat(overlayedSubplots)}for(var len=subplots.length,xaArray=new Array(len),yaArray=new Array(len),supportsCompare=!1,i=0;i<len;i++){var spId=subplots[i],plotObj=plots[spId];if(plotObj)supportsCompare=!0,xaArray[i]=Axes.getFromId(gd,plotObj.xaxis._id),yaArray[i]=Axes.getFromId(gd,plotObj.yaxis._id);else{var _subplot=fullLayout[spId]._subplot;xaArray[i]=_subplot.xaxis,yaArray[i]=_subplot.yaxis}}var hovermode=evt.hovermode||fullLayout.hovermode;hovermode&&!supportsCompare&&(hovermode="closest");if(-1===["x","y","closest"].indexOf(hovermode)||!gd.calcdata||gd.querySelector(".zoombox")||gd._dragging)return dragElement.unhoverRaw(gd,evt);var xvalArray,yvalArray,itemnum,curvenum,cd,trace,subplotId,subploti,mode,xval,yval,pointData,closedataPreviousLength,hoverdistance=-1===fullLayout.hoverdistance?1/0:fullLayout.hoverdistance,spikedistance=-1===fullLayout.spikedistance?1/0:fullLayout.spikedistance,hoverData=[],searchData=[],spikePoints={hLinePoint:null,vLinePoint:null},hasOneHorizontalTrace=!1;if(Array.isArray(evt))for(hovermode="array",itemnum=0;itemnum<evt.length;itemnum++)cd=gd.calcdata[evt[itemnum].curveNumber||0],trace=cd[0].trace,"skip"!==cd[0].trace.hoverinfo&&(searchData.push(cd),"h"===trace.orientation&&(hasOneHorizontalTrace=!0));else{for(curvenum=0;curvenum<gd.calcdata.length;curvenum++)cd=gd.calcdata[curvenum],"skip"!==(trace=cd[0].trace).hoverinfo&&helpers.isTraceInSubplots(trace,subplots)&&(searchData.push(cd),"h"===trace.orientation&&(hasOneHorizontalTrace=!0));var xpx,ypx,hasUserCalledHover=!evt.target;if(hasUserCalledHover)xpx="xpx"in evt?evt.xpx:xaArray[0]._length/2,ypx="ypx"in evt?evt.ypx:yaArray[0]._length/2;else{if(!1===Events.triggerHandler(gd,"plotly_beforehover",evt))return;var dbb=evt.target.getBoundingClientRect();if(xpx=evt.clientX-dbb.left,ypx=evt.clientY-dbb.top,xpx<0||xpx>xaArray[0]._length||ypx<0||ypx>yaArray[0]._length)return dragElement.unhoverRaw(gd,evt)}if(evt.pointerX=xpx+xaArray[0]._offset,evt.pointerY=ypx+yaArray[0]._offset,xvalArray="xval"in evt?helpers.flat(subplots,evt.xval):helpers.p2c(xaArray,xpx),yvalArray="yval"in evt?helpers.flat(subplots,evt.yval):helpers.p2c(yaArray,ypx),!isNumeric(xvalArray[0])||!isNumeric(yvalArray[0]))return Lib.warn("Fx.hover failed",evt,gd),dragElement.unhoverRaw(gd,evt)}var distance=1/0;for(curvenum=0;curvenum<searchData.length;curvenum++)if((cd=searchData[curvenum])&&cd[0]&&cd[0].trace&&!0===cd[0].trace.visible&&(trace=cd[0].trace,-1===["carpet","contourcarpet"].indexOf(trace._module.name))){if("splom"===trace.type?subplotId=subplots[subploti=0]:(subplotId=helpers.getSubplot(trace),subploti=subplots.indexOf(subplotId)),mode=hovermode,pointData={cd:cd,trace:trace,xa:xaArray[subploti],ya:yaArray[subploti],maxHoverDistance:hoverdistance,maxSpikeDistance:spikedistance,index:!1,distance:Math.min(distance,hoverdistance),spikeDistance:1/0,xSpike:void 0,ySpike:void 0,color:Color.defaultLine,name:trace.name,x0:void 0,x1:void 0,y0:void 0,y1:void 0,xLabelVal:void 0,yLabelVal:void 0,zLabelVal:void 0,text:void 0},fullLayout[subplotId]&&(pointData.subplot=fullLayout[subplotId]._subplot),closedataPreviousLength=hoverData.length,"array"===mode){var selection=evt[curvenum];"pointNumber"in selection?(pointData.index=selection.pointNumber,mode="closest"):(mode="","xval"in selection&&(xval=selection.xval,mode="x"),"yval"in selection&&(yval=selection.yval,mode=mode?"closest":"y"))}else xval=xvalArray[subploti],yval=yvalArray[subploti];if(0!==hoverdistance)if(trace._module&&trace._module.hoverPoints){var newPoints=trace._module.hoverPoints(pointData,xval,yval,mode,fullLayout._hoverlayer);if(newPoints)for(var newPoint,newPointNum=0;newPointNum<newPoints.length;newPointNum++)newPoint=newPoints[newPointNum],isNumeric(newPoint.x0)&&isNumeric(newPoint.y0)&&hoverData.push(cleanPoint(newPoint,hovermode))}else Lib.log("Unrecognized trace type in hover:",trace);if("closest"===hovermode&&hoverData.length>closedataPreviousLength&&(hoverData.splice(0,closedataPreviousLength),distance=hoverData[0].distance),hasCartesian&&0!==spikedistance&&0===hoverData.length){pointData.distance=spikedistance,pointData.index=!1;var closestPoints=trace._module.hoverPoints(pointData,xval,yval,"closest",fullLayout._hoverlayer);if(closestPoints&&(closestPoints=closestPoints.filter(function(point){return point.spikeDistance<=spikedistance})),closestPoints&&closestPoints.length){var tmpPoint,closestVPoints=closestPoints.filter(function(point){return point.xa.showspikes});if(closestVPoints.length){var closestVPt=closestVPoints[0];isNumeric(closestVPt.x0)&&isNumeric(closestVPt.y0)&&(tmpPoint=fillSpikePoint(closestVPt),(!spikePoints.vLinePoint||spikePoints.vLinePoint.spikeDistance>tmpPoint.spikeDistance)&&(spikePoints.vLinePoint=tmpPoint))}var closestHPoints=closestPoints.filter(function(point){return point.ya.showspikes});if(closestHPoints.length){var closestHPt=closestHPoints[0];isNumeric(closestHPt.x0)&&isNumeric(closestHPt.y0)&&(tmpPoint=fillSpikePoint(closestHPt),(!spikePoints.hLinePoint||spikePoints.hLinePoint.spikeDistance>tmpPoint.spikeDistance)&&(spikePoints.hLinePoint=tmpPoint))}}}}function selectClosestPoint(pointsData,spikedistance){for(var thisSpikeDistance,resultPoint=null,minDistance=1/0,i=0;i<pointsData.length;i++)(thisSpikeDistance=pointsData[i].spikeDistance)<minDistance&&thisSpikeDistance<=spikedistance&&(resultPoint=pointsData[i],minDistance=thisSpikeDistance);return resultPoint}function fillSpikePoint(point){return point?{xa:point.xa,ya:point.ya,x:void 0!==point.xSpike?point.xSpike:(point.x0+point.x1)/2,y:void 0!==point.ySpike?point.ySpike:(point.y0+point.y1)/2,distance:point.distance,spikeDistance:point.spikeDistance,curveNumber:point.trace.index,color:point.color,pointNumber:point.index}:null}var spikelineOpts={fullLayout:fullLayout,container:fullLayout._hoverlayer,outerContainer:fullLayout._paperdiv,event:evt},oldspikepoints=gd._spikepoints,newspikepoints={vLinePoint:spikePoints.vLinePoint,hLinePoint:spikePoints.hLinePoint};if(gd._spikepoints=newspikepoints,hasCartesian&&0!==spikedistance&&0!==hoverData.length){var tmpHPointData=hoverData.filter(function(point){return point.ya.showspikes}),tmpHPoint=selectClosestPoint(tmpHPointData,spikedistance);spikePoints.hLinePoint=fillSpikePoint(tmpHPoint);var tmpVPointData=hoverData.filter(function(point){return point.xa.showspikes}),tmpVPoint=selectClosestPoint(tmpVPointData,spikedistance);spikePoints.vLinePoint=fillSpikePoint(tmpVPoint)}if(0===hoverData.length){var result=dragElement.unhoverRaw(gd,evt);return!hasCartesian||null===spikePoints.hLinePoint&&null===spikePoints.vLinePoint||spikesChanged(oldspikepoints)&&createSpikelines(spikePoints,spikelineOpts),result}hasCartesian&&spikesChanged(oldspikepoints)&&createSpikelines(spikePoints,spikelineOpts);hoverData.sort(function(d1,d2){return d1.distance-d2.distance});var oldhoverdata=gd._hoverdata,newhoverdata=[];for(itemnum=0;itemnum<hoverData.length;itemnum++){var pt=hoverData[itemnum];newhoverdata.push(helpers.makeEventData(pt,pt.trace,pt.cd))}gd._hoverdata=newhoverdata;var rotateLabels="y"===hovermode&&(searchData.length>1||hoverData.length>1)||"closest"===hovermode&&hasOneHorizontalTrace&&hoverData.length>1,bgColor=Color.combine(fullLayout.plot_bgcolor||Color.background,fullLayout.paper_bgcolor),labelOpts={hovermode:hovermode,rotateLabels:rotateLabels,bgColor:bgColor,container:fullLayout._hoverlayer,outerContainer:fullLayout._paperdiv,commonLabelOpts:fullLayout.hoverlabel,hoverdistance:fullLayout.hoverdistance},hoverLabels=createHoverText(hoverData,labelOpts,gd);if(function hoverAvoidOverlaps(hoverData,ax,fullLayout){var donepositioning,topOverlap,bottomOverlap,i,j,pti,sumdp,nummoves=0,axSign=1,pointgroups=hoverData.map(function(d,i){var axis=d[ax],axIsX="x"===axis._id.charAt(0),rng=axis.range;return!i&&rng&&rng[0]>rng[1]!==axIsX&&(axSign=-1),[{i:i,traceIndex:d.trace.index,dp:0,pos:d.pos,posref:d.posref,size:d.by*(axIsX?YFACTOR:1)/2,pmin:0,pmax:axIsX?fullLayout.width:fullLayout.height}]}).sort(function(a,b){return a[0].posref-b[0].posref||axSign*(b[0].traceIndex-a[0].traceIndex)});function constrainGroup(grp){var minPt=grp[0],maxPt=grp[grp.length-1];if(topOverlap=minPt.pmin-minPt.pos-minPt.dp+minPt.size,bottomOverlap=maxPt.pos+maxPt.dp+maxPt.size-minPt.pmax,topOverlap>.01){for(j=grp.length-1;j>=0;j--)grp[j].dp+=topOverlap;donepositioning=!1}if(!(bottomOverlap<.01)){if(topOverlap<-.01){for(j=grp.length-1;j>=0;j--)grp[j].dp-=bottomOverlap;donepositioning=!1}if(donepositioning){var deleteCount=0;for(i=0;i<grp.length;i++)(pti=grp[i]).pos+pti.dp+pti.size>minPt.pmax&&deleteCount++;for(i=grp.length-1;i>=0&&!(deleteCount<=0);i--)(pti=grp[i]).pos>minPt.pmax-1&&(pti.del=!0,deleteCount--);for(i=0;i<grp.length&&!(deleteCount<=0);i++)if((pti=grp[i]).pos<minPt.pmin+1)for(pti.del=!0,deleteCount--,bottomOverlap=2*pti.size,j=grp.length-1;j>=0;j--)grp[j].dp-=bottomOverlap;for(i=grp.length-1;i>=0&&!(deleteCount<=0);i--)(pti=grp[i]).pos+pti.dp+pti.size>minPt.pmax&&(pti.del=!0,deleteCount--)}}}for(;!donepositioning&&nummoves<=hoverData.length;){for(nummoves++,donepositioning=!0,i=0;i<pointgroups.length-1;){var g0=pointgroups[i],g1=pointgroups[i+1],p0=g0[g0.length-1],p1=g1[0];if((topOverlap=p0.pos+p0.dp+p0.size-p1.pos-p1.dp+p1.size)>.01&&p0.pmin===p1.pmin&&p0.pmax===p1.pmax){for(j=g1.length-1;j>=0;j--)g1[j].dp+=topOverlap;for(g0.push.apply(g0,g1),pointgroups.splice(i+1,1),sumdp=0,j=g0.length-1;j>=0;j--)sumdp+=g0[j].dp;for(bottomOverlap=sumdp/g0.length,j=g0.length-1;j>=0;j--)g0[j].dp-=bottomOverlap;donepositioning=!1}else i++}pointgroups.forEach(constrainGroup)}for(i=pointgroups.length-1;i>=0;i--){var grp=pointgroups[i];for(j=grp.length-1;j>=0;j--){var pt=grp[j],hoverPt=hoverData[pt.i];hoverPt.offset=pt.dp,hoverPt.del=pt.del}}}(hoverData,rotateLabels?"xa":"ya",fullLayout),alignHoverText(hoverLabels,rotateLabels),evt.target&&evt.target.tagName){var hasClickToShow=Registry.getComponentMethod("annotations","hasClickToShow")(gd,newhoverdata);overrideCursor(d3.select(evt.target),hasClickToShow?"pointer":"")}if(!evt.target||noHoverEvent||!function hoverChanged(gd,evt,oldhoverdata){if(!oldhoverdata||oldhoverdata.length!==gd._hoverdata.length)return!0;for(var i=oldhoverdata.length-1;i>=0;i--){var oldPt=oldhoverdata[i],newPt=gd._hoverdata[i];if(oldPt.curveNumber!==newPt.curveNumber||String(oldPt.pointNumber)!==String(newPt.pointNumber))return!0}return!1}(gd,0,oldhoverdata))return;oldhoverdata&&gd.emit("plotly_unhover",{event:evt,points:oldhoverdata});gd.emit("plotly_hover",{event:evt,points:gd._hoverdata,xaxes:xaArray,yaxes:yaArray,xvals:xvalArray,yvals:yvalArray})}(gd,evt,subplot,noHoverEvent)})},exports.loneHover=function loneHover(hoverItem,opts){var pointData={color:hoverItem.color||Color.defaultLine,x0:hoverItem.x0||hoverItem.x||0,x1:hoverItem.x1||hoverItem.x||0,y0:hoverItem.y0||hoverItem.y||0,y1:hoverItem.y1||hoverItem.y||0,xLabel:hoverItem.xLabel,yLabel:hoverItem.yLabel,zLabel:hoverItem.zLabel,text:hoverItem.text,name:hoverItem.name,idealAlign:hoverItem.idealAlign,borderColor:hoverItem.borderColor,fontFamily:hoverItem.fontFamily,fontSize:hoverItem.fontSize,fontColor:hoverItem.fontColor,trace:{index:0,hoverinfo:""},xa:{_offset:0},ya:{_offset:0},index:0},container3=d3.select(opts.container),outerContainer3=opts.outerContainer?d3.select(opts.outerContainer):container3,fullOpts={hovermode:"closest",rotateLabels:!1,bgColor:opts.bgColor||Color.background,container:container3,outerContainer:outerContainer3},hoverLabel=createHoverText([pointData],fullOpts,opts.gd);return alignHoverText(hoverLabel,fullOpts.rotateLabels),hoverLabel.node()}},{"../../lib":693,"../../lib/events":681,"../../lib/override_cursor":705,"../../lib/svg_text_utils":718,"../../plots/cartesian/axes":742,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"./constants":604,"./helpers":606,d3:147,"fast-isnumeric":213,tinycolor2:511}],608:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function handleHoverLabelDefaults(contIn,contOut,coerce,opts){coerce("hoverlabel.bgcolor",(opts=opts||{}).bgcolor),coerce("hoverlabel.bordercolor",opts.bordercolor),coerce("hoverlabel.namelength",opts.namelength),Lib.coerceFont(coerce,"hoverlabel.font",opts.font)}},{"../../lib":693}],609:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),dragElement=_dereq_("../dragelement"),helpers=_dereq_("./helpers"),layoutAttributes=_dereq_("./layout_attributes");module.exports={moduleType:"component",name:"fx",constants:_dereq_("./constants"),schema:{layout:layoutAttributes},attributes:_dereq_("./attributes"),layoutAttributes:layoutAttributes,supplyLayoutGlobalDefaults:_dereq_("./layout_global_defaults"),supplyDefaults:_dereq_("./defaults"),supplyLayoutDefaults:_dereq_("./layout_defaults"),calc:_dereq_("./calc"),getDistanceFunction:helpers.getDistanceFunction,getClosest:helpers.getClosest,inbox:helpers.inbox,quadrature:helpers.quadrature,appendArrayPointValue:helpers.appendArrayPointValue,castHoverOption:function castHoverOption(trace,ptNumber,attr){return Lib.castOption(trace,ptNumber,"hoverlabel."+attr)},castHoverinfo:function castHoverinfo(trace,fullLayout,ptNumber){return Lib.castOption(trace,ptNumber,"hoverinfo",function _coerce(val){return Lib.coerceHoverinfo({hoverinfo:val},{_module:trace._module},fullLayout)})},hover:_dereq_("./hover").hover,unhover:dragElement.unhover,loneHover:_dereq_("./hover").loneHover,loneUnhover:function loneUnhover(containerOrSelection){var selection=Lib.isD3Selection(containerOrSelection)?containerOrSelection:d3.select(containerOrSelection);selection.selectAll("g.hovertext").remove(),selection.selectAll(".spikeline").remove()},click:_dereq_("./click")}},{"../../lib":693,"../dragelement":589,"./attributes":601,"./calc":602,"./click":603,"./constants":604,"./defaults":605,"./helpers":606,"./hover":607,"./layout_attributes":610,"./layout_defaults":611,"./layout_global_defaults":612,d3:147}],610:[function(_dereq_,module,exports){"use strict";var constants=_dereq_("./constants"),fontAttrs=_dereq_("../../plots/font_attributes")({editType:"none"});fontAttrs.family.dflt=constants.HOVERFONT,fontAttrs.size.dflt=constants.HOVERFONTSIZE,module.exports={clickmode:{valType:"flaglist",flags:["event","select"],dflt:"event",editType:"plot",extras:["none"]},dragmode:{valType:"enumerated",values:["zoom","pan","select","lasso","orbit","turntable"],dflt:"zoom",editType:"modebar"},hovermode:{valType:"enumerated",values:["x","y","closest",!1],editType:"modebar"},hoverdistance:{valType:"integer",min:-1,dflt:20,editType:"none"},spikedistance:{valType:"integer",min:-1,dflt:20,editType:"none"},hoverlabel:{bgcolor:{valType:"color",editType:"none"},bordercolor:{valType:"color",editType:"none"},font:fontAttrs,namelength:{valType:"integer",min:-1,dflt:15,editType:"none"},editType:"none"},selectdirection:{valType:"enumerated",values:["h","v","d","any"],dflt:"any",editType:"none"}}},{"../../plots/font_attributes":768,"./constants":604}],611:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes");module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)}var hovermodeDflt,clickmode=coerce("clickmode");"select"===coerce("dragmode")&&coerce("selectdirection"),layoutOut._has("cartesian")?clickmode.indexOf("select")>-1?hovermodeDflt="closest":(layoutOut._isHoriz=function isHoriz(fullData){for(var out=!0,i=0;i<fullData.length;i++){var trace=fullData[i];if("h"!==trace.orientation){out=!1;break}}return out}(fullData),hovermodeDflt=layoutOut._isHoriz?"y":"x"):hovermodeDflt="closest",coerce("hovermode",hovermodeDflt)&&(coerce("hoverdistance"),coerce("spikedistance"));var hasMapbox=layoutOut._has("mapbox"),hasGeo=layoutOut._has("geo"),len=layoutOut._basePlotModules.length;"zoom"===layoutOut.dragmode&&((hasMapbox||hasGeo)&&1===len||hasMapbox&&hasGeo&&2===len)&&(layoutOut.dragmode="pan")}},{"../../lib":693,"./layout_attributes":610}],612:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleHoverLabelDefaults=_dereq_("./hoverlabel_defaults"),layoutAttributes=_dereq_("./layout_attributes");module.exports=function supplyLayoutGlobalDefaults(layoutIn,layoutOut){handleHoverLabelDefaults(layoutIn,layoutOut,function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)})}},{"../../lib":693,"./hoverlabel_defaults":608,"./layout_attributes":610}],613:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),counterRegex=_dereq_("../../lib/regex").counter,domainAttrs=_dereq_("../../plots/domain").attributes,cartesianIdRegex=_dereq_("../../plots/cartesian/constants").idRegex,Template=_dereq_("../../plot_api/plot_template"),gridAttrs={rows:{valType:"integer",min:1,editType:"plot"},roworder:{valType:"enumerated",values:["top to bottom","bottom to top"],dflt:"top to bottom",editType:"plot"},columns:{valType:"integer",min:1,editType:"plot"},subplots:{valType:"info_array",freeLength:!0,dimensions:2,items:{valType:"enumerated",values:[counterRegex("xy").toString(),""],editType:"plot"},editType:"plot"},xaxes:{valType:"info_array",freeLength:!0,items:{valType:"enumerated",values:[cartesianIdRegex.x.toString(),""],editType:"plot"},editType:"plot"},yaxes:{valType:"info_array",freeLength:!0,items:{valType:"enumerated",values:[cartesianIdRegex.y.toString(),""],editType:"plot"},editType:"plot"},pattern:{valType:"enumerated",values:["independent","coupled"],dflt:"coupled",editType:"plot"},xgap:{valType:"number",min:0,max:1,editType:"plot"},ygap:{valType:"number",min:0,max:1,editType:"plot"},domain:domainAttrs({name:"grid",editType:"plot",noGridCell:!0},{}),xside:{valType:"enumerated",values:["bottom","bottom plot","top plot","top"],dflt:"bottom plot",editType:"plot"},yside:{valType:"enumerated",values:["left","left plot","right plot","right"],dflt:"left plot",editType:"plot"},editType:"plot"};function getAxes(layout,grid,axLetter){var gridVal=grid[axLetter+"axes"],splomVal=Object.keys((layout._splomAxes||{})[axLetter]||{});return Array.isArray(gridVal)?gridVal:splomVal.length?splomVal:void 0}function fillGridPositions(axLetter,coerce,dfltGap,dfltSide,len,reversed){var dirGap=coerce(axLetter+"gap",dfltGap),domain=coerce("domain."+axLetter);coerce(axLetter+"side",dfltSide);for(var out=new Array(len),start=domain[0],step=(domain[1]-start)/(len-dirGap),cellDomain=step*(1-dirGap),i=0;i<len;i++){var cellStart=start+step*i;out[reversed?len-1-i:i]=[cellStart,cellStart+cellDomain]}return out}function fillGridAxes(axesIn,axesAllowed,len,axisMap,axLetter){var i,out=new Array(len);function fillOneAxis(i,axisId){-1!==axesAllowed.indexOf(axisId)&&void 0===axisMap[axisId]?(out[i]=axisId,axisMap[axisId]=i):out[i]=""}if(Array.isArray(axesIn))for(i=0;i<len;i++)fillOneAxis(i,axesIn[i]);else for(fillOneAxis(0,axLetter),i=1;i<len;i++)fillOneAxis(i,axLetter+(i+1));return out}module.exports={moduleType:"component",name:"grid",schema:{layout:{grid:gridAttrs}},layoutAttributes:gridAttrs,sizeDefaults:function sizeDefaults(layoutIn,layoutOut){var gridIn=layoutIn.grid||{},xAxes=getAxes(layoutOut,gridIn,"x"),yAxes=getAxes(layoutOut,gridIn,"y");if(layoutIn.grid||xAxes||yAxes){var dfltRows,dfltColumns,hasSubplotGrid=Array.isArray(gridIn.subplots)&&Array.isArray(gridIn.subplots[0]),hasXaxes=Array.isArray(xAxes),hasYaxes=Array.isArray(yAxes),isSplomGenerated=hasXaxes&&xAxes!==gridIn.xaxes&&hasYaxes&&yAxes!==gridIn.yaxes;hasSubplotGrid?(dfltRows=gridIn.subplots.length,dfltColumns=gridIn.subplots[0].length):(hasYaxes&&(dfltRows=yAxes.length),hasXaxes&&(dfltColumns=xAxes.length));var gridOut=Template.newContainer(layoutOut,"grid"),rows=coerce("rows",dfltRows),columns=coerce("columns",dfltColumns);if(rows*columns>1){hasSubplotGrid||hasXaxes||hasYaxes||"independent"===coerce("pattern")&&(hasSubplotGrid=!0),gridOut._hasSubplotGrid=hasSubplotGrid;var dfltSideX,dfltSideY,reversed="top to bottom"===coerce("roworder"),dfltGapX=hasSubplotGrid?.2:.1,dfltGapY=hasSubplotGrid?.3:.1;isSplomGenerated&&layoutOut._splomGridDflt&&(dfltSideX=layoutOut._splomGridDflt.xside,dfltSideY=layoutOut._splomGridDflt.yside),gridOut._domains={x:fillGridPositions("x",coerce,dfltGapX,dfltSideX,columns),y:fillGridPositions("y",coerce,dfltGapY,dfltSideY,rows,reversed)}}else delete layoutOut.grid}function coerce(attr,dflt){return Lib.coerce(gridIn,gridOut,gridAttrs,attr,dflt)}},contentDefaults:function contentDefaults(layoutIn,layoutOut){var gridOut=layoutOut.grid;if(gridOut&&gridOut._domains){var i,j,xId,yId,subplotId,subplotsOut,yPos,gridIn=layoutIn.grid||{},subplots=layoutOut._subplots,hasSubplotGrid=gridOut._hasSubplotGrid,rows=gridOut.rows,columns=gridOut.columns,useDefaultSubplots="independent"===gridOut.pattern,axisMap=gridOut._axisMap={};if(hasSubplotGrid){var subplotsIn=gridIn.subplots||[];subplotsOut=gridOut.subplots=new Array(rows);var index=1;for(i=0;i<rows;i++){var rowOut=subplotsOut[i]=new Array(columns),rowIn=subplotsIn[i]||[];for(j=0;j<columns;j++)if(useDefaultSubplots?(subplotId=1===index?"xy":"x"+index+"y"+index,index++):subplotId=rowIn[j],rowOut[j]="",-1!==subplots.cartesian.indexOf(subplotId)){if(yPos=subplotId.indexOf("y"),xId=subplotId.slice(0,yPos),yId=subplotId.slice(yPos),void 0!==axisMap[xId]&&axisMap[xId]!==j||void 0!==axisMap[yId]&&axisMap[yId]!==i)continue;rowOut[j]=subplotId,axisMap[xId]=j,axisMap[yId]=i}}}else{var xAxes=getAxes(layoutOut,gridIn,"x"),yAxes=getAxes(layoutOut,gridIn,"y");gridOut.xaxes=fillGridAxes(xAxes,subplots.xaxis,columns,axisMap,"x"),gridOut.yaxes=fillGridAxes(yAxes,subplots.yaxis,rows,axisMap,"y")}var anchors=gridOut._anchors={},reversed="top to bottom"===gridOut.roworder;for(var axisId in axisMap){var i0,inc,iFinal,axLetter=axisId.charAt(0),side=gridOut[axLetter+"side"];if(side.length<8)anchors[axisId]="free";else if("x"===axLetter){if("t"===side.charAt(0)===reversed?(i0=0,inc=1,iFinal=rows):(i0=rows-1,inc=-1,iFinal=-1),hasSubplotGrid){var column=axisMap[axisId];for(i=i0;i!==iFinal;i+=inc)if((subplotId=subplotsOut[i][column])&&(yPos=subplotId.indexOf("y"),subplotId.slice(0,yPos)===axisId)){anchors[axisId]=subplotId.slice(yPos);break}}else for(i=i0;i!==iFinal;i+=inc)if(yId=gridOut.yaxes[i],-1!==subplots.cartesian.indexOf(axisId+yId)){anchors[axisId]=yId;break}}else if("l"===side.charAt(0)?(i0=0,inc=1,iFinal=columns):(i0=columns-1,inc=-1,iFinal=-1),hasSubplotGrid){var row=axisMap[axisId];for(i=i0;i!==iFinal;i+=inc)if((subplotId=subplotsOut[row][i])&&(yPos=subplotId.indexOf("y"),subplotId.slice(yPos)===axisId)){anchors[axisId]=subplotId.slice(0,yPos);break}}else for(i=i0;i!==iFinal;i+=inc)if(xId=gridOut.xaxes[i],-1!==subplots.cartesian.indexOf(xId+axisId)){anchors[axisId]=xId;break}}}}}},{"../../lib":693,"../../lib/regex":710,"../../plot_api/plot_template":732,"../../plots/cartesian/constants":747,"../../plots/domain":767}],614:[function(_dereq_,module,exports){"use strict";var cartesianConstants=_dereq_("../../plots/cartesian/constants"),templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;module.exports=templatedArray("image",{visible:{valType:"boolean",dflt:!0,editType:"arraydraw"},source:{valType:"string",editType:"arraydraw"},layer:{valType:"enumerated",values:["below","above"],dflt:"above",editType:"arraydraw"},sizex:{valType:"number",dflt:0,editType:"arraydraw"},sizey:{valType:"number",dflt:0,editType:"arraydraw"},sizing:{valType:"enumerated",values:["fill","contain","stretch"],dflt:"contain",editType:"arraydraw"},opacity:{valType:"number",min:0,max:1,dflt:1,editType:"arraydraw"},x:{valType:"any",dflt:0,editType:"arraydraw"},y:{valType:"any",dflt:0,editType:"arraydraw"},xanchor:{valType:"enumerated",values:["left","center","right"],dflt:"left",editType:"arraydraw"},yanchor:{valType:"enumerated",values:["top","middle","bottom"],dflt:"top",editType:"arraydraw"},xref:{valType:"enumerated",values:["paper",cartesianConstants.idRegex.x.toString()],dflt:"paper",editType:"arraydraw"},yref:{valType:"enumerated",values:["paper",cartesianConstants.idRegex.y.toString()],dflt:"paper",editType:"arraydraw"},editType:"arraydraw"})},{"../../plot_api/plot_template":732,"../../plots/cartesian/constants":747}],615:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),toLogRange=_dereq_("../../lib/to_log_range");module.exports=function convertCoords(gd,ax,newType,doExtra){ax=ax||{};var toLog="log"===newType&&"linear"===ax.type,fromLog="linear"===newType&&"log"===ax.type;if(toLog||fromLog)for(var image,attrPrefix,images=gd._fullLayout.images,axLetter=ax._id.charAt(0),i=0;i<images.length;i++)if(attrPrefix="images["+i+"].",(image=images[i])[axLetter+"ref"]===ax._id){var currentPos=image[axLetter],currentSize=image["size"+axLetter],newPos=null,newSize=null;if(toLog){newPos=toLogRange(currentPos,ax.range);var dx=currentSize/Math.pow(10,newPos)/2;newSize=2*Math.log(dx+Math.sqrt(1+dx*dx))/Math.LN10}else newSize=(newPos=Math.pow(10,currentPos))*(Math.pow(10,currentSize/2)-Math.pow(10,-currentSize/2));isNumeric(newPos)?isNumeric(newSize)||(newSize=null):(newPos=null,newSize=null),doExtra(attrPrefix+axLetter,newPos),doExtra(attrPrefix+"size"+axLetter,newSize)}}},{"../../lib/to_log_range":720,"fast-isnumeric":213}],616:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes");function imageDefaults(imageIn,imageOut,fullLayout){function coerce(attr,dflt){return Lib.coerce(imageIn,imageOut,attributes,attr,dflt)}if(!coerce("visible",!!coerce("source")))return imageOut;coerce("layer"),coerce("xanchor"),coerce("yanchor"),coerce("sizex"),coerce("sizey"),coerce("sizing"),coerce("opacity");for(var gdMock={_fullLayout:fullLayout},axLetters=["x","y"],i=0;i<2;i++){var axLetter=axLetters[i],axRef=Axes.coerceRef(imageIn,imageOut,gdMock,axLetter,"paper");Axes.coercePosition(imageOut,gdMock,coerce,axRef,axLetter,0)}return imageOut}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut){handleArrayContainerDefaults(layoutIn,layoutOut,{name:"images",handleItemDefaults:imageDefaults})}},{"../../lib":693,"../../plots/array_container_defaults":738,"../../plots/cartesian/axes":742,"./attributes":614}],617:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../drawing"),Axes=_dereq_("../../plots/cartesian/axes"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces");module.exports=function draw(gd){var subplot,i,fullLayout=gd._fullLayout,imageDataAbove=[],imageDataSubplot={},imageDataBelow=[];for(i=0;i<fullLayout.images.length;i++){var img=fullLayout.images[i];if(img.visible)if("below"===img.layer&&"paper"!==img.xref&&"paper"!==img.yref){subplot=img.xref+img.yref;var plotinfo=fullLayout._plots[subplot];if(!plotinfo){imageDataBelow.push(img);continue}plotinfo.mainplot&&(subplot=plotinfo.mainplot.id),imageDataSubplot[subplot]||(imageDataSubplot[subplot]=[]),imageDataSubplot[subplot].push(img)}else"above"===img.layer?imageDataAbove.push(img):imageDataBelow.push(img)}var anchors={x:{left:{sizing:"xMin",offset:0},center:{sizing:"xMid",offset:-.5},right:{sizing:"xMax",offset:-1}},y:{top:{sizing:"YMin",offset:0},middle:{sizing:"YMid",offset:-.5},bottom:{sizing:"YMax",offset:-1}}};function setImage(d){var thisImage=d3.select(this);if(!this.img||this.img.src!==d.source){thisImage.attr("xmlns",xmlnsNamespaces.svg);var imagePromise=new Promise(function(resolve){var img=new Image;function errorHandler(){thisImage.remove(),resolve()}this.img=img,img.setAttribute("crossOrigin","anonymous"),img.onerror=errorHandler,img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height,canvas.getContext("2d").drawImage(this,0,0);var dataURL=canvas.toDataURL("image/png");thisImage.attr("xlink:href",dataURL),resolve()},thisImage.on("error",errorHandler),img.src=d.source}.bind(this));gd._promises.push(imagePromise)}}function applyAttributes(d){var thisImage=d3.select(this),xa=Axes.getFromId(gd,d.xref),ya=Axes.getFromId(gd,d.yref),size=fullLayout._size,width=xa?Math.abs(xa.l2p(d.sizex)-xa.l2p(0)):d.sizex*size.w,height=ya?Math.abs(ya.l2p(d.sizey)-ya.l2p(0)):d.sizey*size.h,xOffset=width*anchors.x[d.xanchor].offset,yOffset=height*anchors.y[d.yanchor].offset,sizing=anchors.x[d.xanchor].sizing+anchors.y[d.yanchor].sizing,xPos=(xa?xa.r2p(d.x)+xa._offset:d.x*size.w+size.l)+xOffset,yPos=(ya?ya.r2p(d.y)+ya._offset:size.h-d.y*size.h+size.t)+yOffset;switch(d.sizing){case"fill":sizing+=" slice";break;case"stretch":sizing="none"}thisImage.attr({x:xPos,y:yPos,width:width,height:height,preserveAspectRatio:sizing,opacity:d.opacity});var clipAxes=(xa?xa._id:"")+(ya?ya._id:"");thisImage.call(Drawing.setClipUrl,clipAxes?"clip"+fullLayout._uid+clipAxes:null)}var imagesBelow=fullLayout._imageLowerLayer.selectAll("image").data(imageDataBelow),imagesAbove=fullLayout._imageUpperLayer.selectAll("image").data(imageDataAbove);imagesBelow.enter().append("image"),imagesAbove.enter().append("image"),imagesBelow.exit().remove(),imagesAbove.exit().remove(),imagesBelow.each(function(d){setImage.bind(this)(d),applyAttributes.bind(this)(d)}),imagesAbove.each(function(d){setImage.bind(this)(d),applyAttributes.bind(this)(d)});var allSubplots=Object.keys(fullLayout._plots);for(i=0;i<allSubplots.length;i++){subplot=allSubplots[i];var subplotObj=fullLayout._plots[subplot];if(subplotObj.imagelayer){var imagesOnSubplot=subplotObj.imagelayer.selectAll("image").data(imageDataSubplot[subplot]||[]);imagesOnSubplot.enter().append("image"),imagesOnSubplot.exit().remove(),imagesOnSubplot.each(function(d){setImage.bind(this)(d),applyAttributes.bind(this)(d)})}}}},{"../../constants/xmlns_namespaces":671,"../../plots/cartesian/axes":742,"../drawing":592,d3:147}],618:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"component",name:"images",layoutAttributes:_dereq_("./attributes"),supplyLayoutDefaults:_dereq_("./defaults"),includeBasePlot:_dereq_("../../plots/cartesian/include_components")("images"),draw:_dereq_("./draw"),convertCoords:_dereq_("./convert_coords")}},{"../../plots/cartesian/include_components":752,"./attributes":614,"./convert_coords":615,"./defaults":616,"./draw":617}],619:[function(_dereq_,module,exports){"use strict";exports.isRightAnchor=function isRightAnchor(opts){return"right"===opts.xanchor||"auto"===opts.xanchor&&opts.x>=2/3},exports.isCenterAnchor=function isCenterAnchor(opts){return"center"===opts.xanchor||"auto"===opts.xanchor&&opts.x>1/3&&opts.x<2/3},exports.isBottomAnchor=function isBottomAnchor(opts){return"bottom"===opts.yanchor||"auto"===opts.yanchor&&opts.y<=1/3},exports.isMiddleAnchor=function isMiddleAnchor(opts){return"middle"===opts.yanchor||"auto"===opts.yanchor&&opts.y>1/3&&opts.y<2/3}},{}],620:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),colorAttrs=_dereq_("../color/attributes");module.exports={bgcolor:{valType:"color",editType:"legend"},bordercolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"legend"},borderwidth:{valType:"number",min:0,dflt:0,editType:"legend"},font:fontAttrs({editType:"legend"}),orientation:{valType:"enumerated",values:["v","h"],dflt:"v",editType:"legend"},traceorder:{valType:"flaglist",flags:["reversed","grouped"],extras:["normal"],editType:"legend"},tracegroupgap:{valType:"number",min:0,dflt:10,editType:"legend"},x:{valType:"number",min:-2,max:3,dflt:1.02,editType:"legend"},xanchor:{valType:"enumerated",values:["auto","left","center","right"],dflt:"left",editType:"legend"},y:{valType:"number",min:-2,max:3,dflt:1,editType:"legend"},yanchor:{valType:"enumerated",values:["auto","top","middle","bottom"],dflt:"auto",editType:"legend"},editType:"legend"}},{"../../plots/font_attributes":768,"../color/attributes":566}],621:[function(_dereq_,module,exports){"use strict";module.exports={scrollBarWidth:6,scrollBarMinHeight:20,scrollBarColor:"#808BA4",scrollBarMargin:4,textOffsetX:40}},{}],622:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Template=_dereq_("../../plot_api/plot_template"),attributes=_dereq_("./attributes"),basePlotLayoutAttributes=_dereq_("../../plots/layout_attributes"),helpers=_dereq_("./helpers");module.exports=function legendDefaults(layoutIn,layoutOut,fullData){for(var defaultX,defaultY,defaultXAnchor,defaultYAnchor,containerIn=layoutIn.legend||{},legendTraceCount=0,legendReallyHasATrace=!1,defaultOrder="normal",i=0;i<fullData.length;i++){var trace=fullData[i];trace.visible&&((trace.showlegend||trace._dfltShowLegend)&&(legendTraceCount++,trace.showlegend&&(legendReallyHasATrace=!0,(Registry.traceIs(trace,"pie")||!0===trace._input.showlegend)&&legendTraceCount++)),(Registry.traceIs(trace,"bar")&&"stack"===layoutOut.barmode||-1!==["tonextx","tonexty"].indexOf(trace.fill))&&(defaultOrder=helpers.isGrouped({traceorder:defaultOrder})?"grouped+reversed":"reversed"),void 0!==trace.legendgroup&&""!==trace.legendgroup&&(defaultOrder=helpers.isReversed({traceorder:defaultOrder})?"reversed+grouped":"grouped"))}if(!1!==Lib.coerce(layoutIn,layoutOut,basePlotLayoutAttributes,"showlegend",legendReallyHasATrace&&legendTraceCount>1)){var containerOut=Template.newContainer(layoutOut,"legend");if(coerce("bgcolor",layoutOut.paper_bgcolor),coerce("bordercolor"),coerce("borderwidth"),Lib.coerceFont(coerce,"font",layoutOut.font),coerce("orientation"),"h"===containerOut.orientation){var xaxis=layoutIn.xaxis;xaxis&&xaxis.rangeslider&&xaxis.rangeslider.visible?(defaultX=0,defaultXAnchor="left",defaultY=1.1,defaultYAnchor="bottom"):(defaultX=0,defaultXAnchor="left",defaultY=-.1,defaultYAnchor="top")}coerce("traceorder",defaultOrder),helpers.isGrouped(layoutOut.legend)&&coerce("tracegroupgap"),coerce("x",defaultX),coerce("xanchor",defaultXAnchor),coerce("y",defaultY),coerce("yanchor",defaultYAnchor),Lib.noneOrAll(containerIn,containerOut,["x","y"])}function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,attributes,attr,dflt)}}},{"../../lib":693,"../../plot_api/plot_template":732,"../../plots/layout_attributes":796,"../../registry":825,"./attributes":620,"./helpers":626}],623:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),Plots=_dereq_("../../plots/plots"),Registry=_dereq_("../../registry"),Events=_dereq_("../../lib/events"),dragElement=_dereq_("../dragelement"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),handleClick=_dereq_("./handle_click"),constants=_dereq_("./constants"),interactConstants=_dereq_("../../constants/interactions"),alignmentConstants=_dereq_("../../constants/alignment"),LINE_SPACING=alignmentConstants.LINE_SPACING,FROM_TL=alignmentConstants.FROM_TL,FROM_BR=alignmentConstants.FROM_BR,getLegendData=_dereq_("./get_legend_data"),style=_dereq_("./style"),helpers=_dereq_("./helpers"),anchorUtils=_dereq_("./anchor_utils"),DBLCLICKDELAY=interactConstants.DBLCLICKDELAY;function clickOrDoubleClick(gd,legend,legendItem,numClicks,evt){var trace=legendItem.data()[0][0].trace,evtData={event:evt,node:legendItem.node(),curveNumber:trace.index,expandedIndex:trace._expandedIndex,data:gd.data,layout:gd.layout,frames:gd._transitionData._frames,config:gd._context,fullData:gd._fullData,fullLayout:gd._fullLayout};if(trace._group&&(evtData.group=trace._group),"pie"===trace.type&&(evtData.label=legendItem.datum()[0].label),!1!==Events.triggerHandler(gd,"plotly_legendclick",evtData))if(1===numClicks)legend._clickTimeout=setTimeout(function(){handleClick(legendItem,gd,numClicks)},DBLCLICKDELAY);else if(2===numClicks){legend._clickTimeout&&clearTimeout(legend._clickTimeout),gd._legendMouseDownTime=0,!1!==Events.triggerHandler(gd,"plotly_legenddoubleclick",evtData)&&handleClick(legendItem,gd,numClicks)}}function drawTexts(g,gd,maxLength){var legendItem=g.data()[0][0],fullLayout=gd._fullLayout,trace=legendItem.trace,isPie=Registry.traceIs(trace,"pie"),traceIndex=trace.index,name=isPie?legendItem.label:trace.name,isEditable=gd._context.edits.legendText&&!isPie,textEl=Lib.ensureSingle(g,"text","legendtext");function textLayout(s){svgTextUtils.convertToTspans(s,gd,function(){!function computeTextDimensions(g,gd){var legendItem=g.data()[0][0];if(!legendItem.trace.showlegend)return void g.remove();var height,width,mathjaxGroup=g.select("g[class*=math-group]"),mathjaxNode=mathjaxGroup.node(),lineHeight=gd._fullLayout.legend.font.size*LINE_SPACING;if(mathjaxNode){var mathjaxBB=Drawing.bBox(mathjaxNode);height=mathjaxBB.height,width=mathjaxBB.width,Drawing.setTranslate(mathjaxGroup,0,height/4)}else{var text=g.select(".legendtext"),textLines=svgTextUtils.lineCount(text),textNode=text.node();height=lineHeight*textLines,width=textNode?Drawing.bBox(textNode).width:0;var textY=lineHeight*(.3+(1-textLines)/2);svgTextUtils.positionText(text,constants.textOffsetX,textY)}height=Math.max(height,16)+3,legendItem.height=height,legendItem.width=width}(g,gd)})}textEl.attr("text-anchor","start").classed("user-select-none",!0).call(Drawing.font,fullLayout.legend.font).text(isEditable?ensureLength(name,maxLength):name),svgTextUtils.positionText(textEl,constants.textOffsetX,0),isEditable?textEl.call(svgTextUtils.makeEditable,{gd:gd,text:name}).call(textLayout).on("edit",function(newName){this.text(ensureLength(newName,maxLength)).call(textLayout);var fullInput=legendItem.trace._fullInput||{},update={};if(Registry.hasTransform(fullInput,"groupby")){var groupbyIndices=Registry.getTransformIndices(fullInput,"groupby"),index=groupbyIndices[groupbyIndices.length-1],kcont=Lib.keyedContainer(fullInput,"transforms["+index+"].styles","target","value.name");kcont.set(legendItem.trace._group,newName),update=kcont.constructUpdate()}else update.name=newName;return Registry.call("restyle",gd,update,traceIndex)}):textLayout(textEl)}function ensureLength(str,maxLength){var targetLength=Math.max(4,maxLength);if(str&&str.trim().length>=targetLength/2)return str;for(var i=targetLength-(str=str||"").length;i>0;i--)str+=" ";return str}function setupTraceToggle(g,gd){var newMouseDownTime,numClicks=1,traceToggle=Lib.ensureSingle(g,"rect","legendtoggle",function(s){s.style("cursor","pointer").attr("pointer-events","all").call(Color.fill,"rgba(0,0,0,0)")});traceToggle.on("mousedown",function(){(newMouseDownTime=(new Date).getTime())-gd._legendMouseDownTime<DBLCLICKDELAY?numClicks+=1:(numClicks=1,gd._legendMouseDownTime=newMouseDownTime)}),traceToggle.on("mouseup",function(){if(!gd._dragged&&!gd._editing){var legend=gd._fullLayout.legend;(new Date).getTime()-gd._legendMouseDownTime>DBLCLICKDELAY&&(numClicks=Math.max(numClicks-1,1)),clickOrDoubleClick(gd,legend,g,numClicks,d3.event)}})}function computeLegendDimensions(gd,groups,traces){var fullLayout=gd._fullLayout,opts=fullLayout.legend,borderwidth=opts.borderwidth,isGrouped=helpers.isGrouped(opts),extraWidth=0;if(opts._width=0,opts._height=0,helpers.isVertical(opts))isGrouped&&groups.each(function(d,i){Drawing.setTranslate(this,0,i*opts.tracegroupgap)}),traces.each(function(d){var legendItem=d[0],textHeight=legendItem.height,textWidth=legendItem.width;Drawing.setTranslate(this,borderwidth,5+borderwidth+opts._height+textHeight/2),opts._height+=textHeight,opts._width=Math.max(opts._width,textWidth)}),opts._width+=45+2*borderwidth,opts._height+=10+2*borderwidth,isGrouped&&(opts._height+=(opts._lgroupsLength-1)*opts.tracegroupgap),extraWidth=40;else if(isGrouped){for(var groupXOffsets=[opts._width],groupData=groups.data(),i=0,n=groupData.length;i<n;i++){var textWidths=groupData[i].map(function(legendItemArray){return legendItemArray[0].width}),groupWidth=40+Math.max.apply(null,textWidths);opts._width+=opts.tracegroupgap+groupWidth,groupXOffsets.push(opts._width)}groups.each(function(d,i){Drawing.setTranslate(this,groupXOffsets[i],0)}),groups.each(function(){var groupHeight=0;d3.select(this).selectAll("g.traces").each(function(d){var textHeight=d[0].height;Drawing.setTranslate(this,0,5+borderwidth+groupHeight+textHeight/2),groupHeight+=textHeight}),opts._height=Math.max(opts._height,groupHeight)}),opts._height+=10+2*borderwidth,opts._width+=2*borderwidth}else{var oneRowLegend,rowHeight=0,maxTraceHeight=0,maxTraceWidth=0,offsetX=0,fullTracesWidth=0,traceGap=opts.tracegroupgap||5;traces.each(function(d){maxTraceWidth=Math.max(40+d[0].width,maxTraceWidth),fullTracesWidth+=40+d[0].width+traceGap}),oneRowLegend=fullLayout._size.w>borderwidth+fullTracesWidth-traceGap,traces.each(function(d){var legendItem=d[0],traceWidth=oneRowLegend?40+d[0].width:maxTraceWidth;borderwidth+offsetX+traceGap+traceWidth>fullLayout._size.w&&(offsetX=0,rowHeight+=maxTraceHeight,opts._height=opts._height+maxTraceHeight,maxTraceHeight=0),Drawing.setTranslate(this,borderwidth+offsetX,5+borderwidth+legendItem.height/2+rowHeight),opts._width+=traceGap+traceWidth,opts._height=Math.max(opts._height,legendItem.height),offsetX+=traceGap+traceWidth,maxTraceHeight=Math.max(legendItem.height,maxTraceHeight)}),opts._width+=2*borderwidth,opts._height+=10+2*borderwidth}opts._width=Math.ceil(opts._width),opts._height=Math.ceil(opts._height);var isEditable=gd._context.edits.legendText||gd._context.edits.legendPosition;traces.each(function(d){var legendItem=d[0],bg=d3.select(this).select(".legendtoggle");Drawing.setRect(bg,0,-legendItem.height/2,(isEditable?0:opts._width)+extraWidth,legendItem.height)})}function expandMargin(gd){var opts=gd._fullLayout.legend,xanchor="left";anchorUtils.isRightAnchor(opts)?xanchor="right":anchorUtils.isCenterAnchor(opts)&&(xanchor="center");var yanchor="top";anchorUtils.isBottomAnchor(opts)?yanchor="bottom":anchorUtils.isMiddleAnchor(opts)&&(yanchor="middle"),Plots.autoMargin(gd,"legend",{x:opts.x,y:opts.y,l:opts._width*FROM_TL[xanchor],r:opts._width*FROM_BR[xanchor],b:opts._height*FROM_BR[yanchor],t:opts._height*FROM_TL[yanchor]})}module.exports=function draw(gd){var fullLayout=gd._fullLayout,clipId="legend"+fullLayout._uid;if(fullLayout._infolayer&&gd.calcdata){gd._legendMouseDownTime||(gd._legendMouseDownTime=0);var opts=fullLayout.legend,legendData=fullLayout.showlegend&&getLegendData(gd.calcdata,opts),hiddenSlices=fullLayout.hiddenlabels||[];if(!fullLayout.showlegend||!legendData.length)return fullLayout._infolayer.selectAll(".legend").remove(),fullLayout._topdefs.select("#"+clipId).remove(),void Plots.autoMargin(gd,"legend");for(var maxLength=0,i=0;i<legendData.length;i++)for(var j=0;j<legendData[i].length;j++){var item=legendData[i][j][0],trace=item.trace,name=Registry.traceIs(trace,"pie")?item.label:trace.name;maxLength=Math.max(maxLength,name&&name.length||0)}var firstRender=!1,legend=Lib.ensureSingle(fullLayout._infolayer,"g","legend",function(s){s.attr("pointer-events","all"),firstRender=!0}),clipPath=Lib.ensureSingleById(fullLayout._topdefs,"clipPath",clipId,function(s){s.append("rect")}),bg=Lib.ensureSingle(legend,"rect","bg",function(s){s.attr("shape-rendering","crispEdges")});bg.call(Color.stroke,opts.bordercolor).call(Color.fill,opts.bgcolor).style("stroke-width",opts.borderwidth+"px");var scrollBox=Lib.ensureSingle(legend,"g","scrollbox"),scrollBar=Lib.ensureSingle(legend,"rect","scrollbar",function(s){s.attr({rx:20,ry:3,width:0,height:0}).call(Color.fill,"#808BA4")}),groups=scrollBox.selectAll("g.groups").data(legendData);groups.enter().append("g").attr("class","groups"),groups.exit().remove();var traces=groups.selectAll("g.traces").data(Lib.identity);traces.enter().append("g").attr("class","traces"),traces.exit().remove(),traces.call(style,gd).style("opacity",function(d){var trace=d[0].trace;return Registry.traceIs(trace,"pie")?-1!==hiddenSlices.indexOf(d[0].label)?.5:1:"legendonly"===trace.visible?.5:1}).each(function(){d3.select(this).call(drawTexts,gd,maxLength).call(setupTraceToggle,gd)}),Lib.syncOrAsync([Plots.previousPromises,function(){firstRender&&(computeLegendDimensions(gd,groups,traces),expandMargin(gd));var lxMax=fullLayout.width,lyMax=fullLayout.height;computeLegendDimensions(gd,groups,traces),opts._height>lyMax?function expandHorizontalMargin(gd){var opts=gd._fullLayout.legend,xanchor="left";anchorUtils.isRightAnchor(opts)?xanchor="right":anchorUtils.isCenterAnchor(opts)&&(xanchor="center");Plots.autoMargin(gd,"legend",{x:opts.x,y:.5,l:opts._width*FROM_TL[xanchor],r:opts._width*FROM_BR[xanchor],b:0,t:0})}(gd):expandMargin(gd);var gs=fullLayout._size,lx=gs.l+gs.w*opts.x,ly=gs.t+gs.h*(1-opts.y);anchorUtils.isRightAnchor(opts)?lx-=opts._width:anchorUtils.isCenterAnchor(opts)&&(lx-=opts._width/2),anchorUtils.isBottomAnchor(opts)?ly-=opts._height:anchorUtils.isMiddleAnchor(opts)&&(ly-=opts._height/2);var legendWidth=opts._width,legendWidthMax=gs.w;legendWidth>legendWidthMax?(lx=gs.l,legendWidth=legendWidthMax):(lx+legendWidth>lxMax&&(lx=lxMax-legendWidth),lx<0&&(lx=0),legendWidth=Math.min(lxMax-lx,opts._width));var xf,yf,x0,y0,legendHeight=opts._height,legendHeightMax=gs.h;if(legendHeight>legendHeightMax?(ly=gs.t,legendHeight=legendHeightMax):(ly+legendHeight>lyMax&&(ly=lyMax-legendHeight),ly<0&&(ly=0),legendHeight=Math.min(lyMax-ly,opts._height)),Drawing.setTranslate(legend,lx,ly),scrollBar.on(".drag",null),legend.on("wheel",null),opts._height<=legendHeight||gd._context.staticPlot)bg.attr({width:legendWidth-opts.borderwidth,height:legendHeight-opts.borderwidth,x:opts.borderwidth/2,y:opts.borderwidth/2}),Drawing.setTranslate(scrollBox,0,0),clipPath.select("rect").attr({width:legendWidth-2*opts.borderwidth,height:legendHeight-2*opts.borderwidth,x:opts.borderwidth,y:opts.borderwidth}),Drawing.setClipUrl(scrollBox,clipId),Drawing.setRect(scrollBar,0,0,0,0),delete opts._scrollY;else{var eventY0,scrollBoxY0,scrollBarHeight=Math.max(constants.scrollBarMinHeight,legendHeight*legendHeight/opts._height),scrollBarYMax=legendHeight-scrollBarHeight-2*constants.scrollBarMargin,scrollBoxYMax=opts._height-legendHeight,scrollRatio=scrollBarYMax/scrollBoxYMax,scrollBoxY=Math.min(opts._scrollY||0,scrollBoxYMax);bg.attr({width:legendWidth-2*opts.borderwidth+constants.scrollBarWidth+constants.scrollBarMargin,height:legendHeight-opts.borderwidth,x:opts.borderwidth/2,y:opts.borderwidth/2}),clipPath.select("rect").attr({width:legendWidth-2*opts.borderwidth+constants.scrollBarWidth+constants.scrollBarMargin,height:legendHeight-2*opts.borderwidth,x:opts.borderwidth,y:opts.borderwidth+scrollBoxY}),Drawing.setClipUrl(scrollBox,clipId),scrollHandler(scrollBoxY,scrollBarHeight,scrollRatio),legend.on("wheel",function(){scrollHandler(scrollBoxY=Lib.constrain(opts._scrollY+d3.event.deltaY/scrollBarYMax*scrollBoxYMax,0,scrollBoxYMax),scrollBarHeight,scrollRatio),0!==scrollBoxY&&scrollBoxY!==scrollBoxYMax&&d3.event.preventDefault()});var drag=d3.behavior.drag().on("dragstart",function(){eventY0=d3.event.sourceEvent.clientY,scrollBoxY0=scrollBoxY}).on("drag",function(){var e=d3.event.sourceEvent;2===e.buttons||e.ctrlKey||scrollHandler(scrollBoxY=Lib.constrain((e.clientY-eventY0)/scrollRatio+scrollBoxY0,0,scrollBoxYMax),scrollBarHeight,scrollRatio)});scrollBar.call(drag)}function scrollHandler(scrollBoxY,scrollBarHeight,scrollRatio){opts._scrollY=gd._fullLayout.legend._scrollY=scrollBoxY,Drawing.setTranslate(scrollBox,0,-scrollBoxY),Drawing.setRect(scrollBar,legendWidth,constants.scrollBarMargin+scrollBoxY*scrollRatio,constants.scrollBarWidth,scrollBarHeight),clipPath.select("rect").attr({y:opts.borderwidth+scrollBoxY})}gd._context.edits.legendPosition&&(legend.classed("cursor-move",!0),dragElement.init({element:legend.node(),gd:gd,prepFn:function(){var transform=Drawing.getTranslate(legend);x0=transform.x,y0=transform.y},moveFn:function(dx,dy){var newX=x0+dx,newY=y0+dy;Drawing.setTranslate(legend,newX,newY),xf=dragElement.align(newX,0,gs.l,gs.l+gs.w,opts.xanchor),yf=dragElement.align(newY,0,gs.t+gs.h,gs.t,opts.yanchor)},doneFn:function(){void 0!==xf&&void 0!==yf&&Registry.call("relayout",gd,{"legend.x":xf,"legend.y":yf})},clickFn:function(numClicks,e){var clickedTrace=fullLayout._infolayer.selectAll("g.traces").filter(function(){var bbox=this.getBoundingClientRect();return e.clientX>=bbox.left&&e.clientX<=bbox.right&&e.clientY>=bbox.top&&e.clientY<=bbox.bottom});clickedTrace.size()>0&&clickOrDoubleClick(gd,legend,clickedTrace,numClicks,e)}}))}],gd)}}},{"../../constants/alignment":665,"../../constants/interactions":669,"../../lib":693,"../../lib/events":681,"../../lib/svg_text_utils":718,"../../plots/plots":805,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"./anchor_utils":619,"./constants":621,"./get_legend_data":624,"./handle_click":625,"./helpers":626,"./style":628,d3:147}],624:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),helpers=_dereq_("./helpers");module.exports=function getLegendData(calcdata,opts){var i,j,lgroupToTraces={},lgroups=[],hasOneNonBlankGroup=!1,slicesShown={},lgroupi=0;function addOneItem(legendGroup,legendItem){if(""!==legendGroup&&helpers.isGrouped(opts))-1===lgroups.indexOf(legendGroup)?(lgroups.push(legendGroup),hasOneNonBlankGroup=!0,lgroupToTraces[legendGroup]=[[legendItem]]):lgroupToTraces[legendGroup].push([legendItem]);else{var uniqueGroup="~~i"+lgroupi;lgroups.push(uniqueGroup),lgroupToTraces[uniqueGroup]=[[legendItem]],lgroupi++}}for(i=0;i<calcdata.length;i++){var cd=calcdata[i],cd0=cd[0],trace=cd0.trace,lgroup=trace.legendgroup;if(trace.visible&&trace.showlegend)if(Registry.traceIs(trace,"pie"))for(slicesShown[lgroup]||(slicesShown[lgroup]={}),j=0;j<cd.length;j++){var labelj=cd[j].label;slicesShown[lgroup][labelj]||(addOneItem(lgroup,{label:labelj,color:cd[j].color,i:cd[j].i,trace:trace,pts:cd[j].pts}),slicesShown[lgroup][labelj]=!0)}else addOneItem(lgroup,cd0)}if(!lgroups.length)return[];var ltraces,legendData,lgroupsLength=lgroups.length;if(hasOneNonBlankGroup&&helpers.isGrouped(opts))for(legendData=new Array(lgroupsLength),i=0;i<lgroupsLength;i++)ltraces=lgroupToTraces[lgroups[i]],legendData[i]=helpers.isReversed(opts)?ltraces.reverse():ltraces;else{for(legendData=[new Array(lgroupsLength)],i=0;i<lgroupsLength;i++)ltraces=lgroupToTraces[lgroups[i]][0],legendData[0][helpers.isReversed(opts)?lgroupsLength-i-1:i]=ltraces;lgroupsLength=1}return opts._lgroupsLength=lgroupsLength,legendData}},{"../../registry":825,"./helpers":626}],625:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry"),SHOWISOLATETIP=!0;module.exports=function handleClick(g,gd,numClicks){if(!gd._dragged&&!gd._editing){var i,j,kcont,key,keys,hiddenSlices=gd._fullLayout.hiddenlabels?gd._fullLayout.hiddenlabels.slice():[],legendItem=g.data()[0][0],fullData=gd._fullData,fullTrace=legendItem.trace,legendgroup=fullTrace.legendgroup,attrUpdate={},attrIndices=[],carrs=[],carrIdx=[];if(1===numClicks&&SHOWISOLATETIP&&gd.data&&gd._context.showTips?(Lib.notifier(Lib._(gd,"Double-click on legend to isolate one trace"),"long"),SHOWISOLATETIP=!1):SHOWISOLATETIP=!1,Registry.traceIs(fullTrace,"pie")){var thisLabel=legendItem.label,thisLabelIndex=hiddenSlices.indexOf(thisLabel);1===numClicks?-1===thisLabelIndex?hiddenSlices.push(thisLabel):hiddenSlices.splice(thisLabelIndex,1):2===numClicks&&(hiddenSlices=[],gd.calcdata[0].forEach(function(d){thisLabel!==d.label&&hiddenSlices.push(d.label)}),gd._fullLayout.hiddenlabels&&gd._fullLayout.hiddenlabels.length===hiddenSlices.length&&-1===thisLabelIndex&&(hiddenSlices=[])),Registry.call("relayout",gd,"hiddenlabels",hiddenSlices)}else{var tracei,hasLegendgroup=legendgroup&&legendgroup.length,traceIndicesInGroup=[];if(hasLegendgroup)for(i=0;i<fullData.length;i++)(tracei=fullData[i]).visible&&tracei.legendgroup===legendgroup&&traceIndicesInGroup.push(i);if(1===numClicks){var nextVisibility;switch(fullTrace.visible){case!0:nextVisibility="legendonly";break;case!1:nextVisibility=!1;break;case"legendonly":nextVisibility=!0}if(hasLegendgroup)for(i=0;i<fullData.length;i++)!1!==fullData[i].visible&&fullData[i].legendgroup===legendgroup&&setVisibility(fullData[i],nextVisibility);else setVisibility(fullTrace,nextVisibility)}else if(2===numClicks){var isInGroup,otherState,isIsolated=!0;for(i=0;i<fullData.length;i++)if(!(fullData[i]===fullTrace)&&!(isInGroup=hasLegendgroup&&fullData[i].legendgroup===legendgroup)&&!0===fullData[i].visible&&!Registry.traceIs(fullData[i],"notLegendIsolatable")){isIsolated=!1;break}for(i=0;i<fullData.length;i++)if(!1!==fullData[i].visible&&!Registry.traceIs(fullData[i],"notLegendIsolatable"))switch(fullTrace.visible){case"legendonly":setVisibility(fullData[i],!0);break;case!0:otherState=!!isIsolated||"legendonly",isInGroup=fullData[i]===fullTrace||hasLegendgroup&&fullData[i].legendgroup===legendgroup,setVisibility(fullData[i],!!isInGroup||otherState)}}for(i=0;i<carrs.length;i++)if(kcont=carrs[i]){var update=kcont.constructUpdate(),updateKeys=Object.keys(update);for(j=0;j<updateKeys.length;j++)key=updateKeys[j],(attrUpdate[key]=attrUpdate[key]||[])[carrIdx[i]]=update[key]}for(keys=Object.keys(attrUpdate),i=0;i<keys.length;i++)for(key=keys[i],j=0;j<attrIndices.length;j++)attrUpdate[key].hasOwnProperty(j)||(attrUpdate[key][j]=void 0);Registry.call("restyle",gd,attrUpdate,attrIndices)}}function insertUpdate(traceIndex,key,value){var attrIndex=attrIndices.indexOf(traceIndex),valueArray=attrUpdate[key];return valueArray||(valueArray=attrUpdate[key]=[]),-1===attrIndices.indexOf(traceIndex)&&(attrIndices.push(traceIndex),attrIndex=attrIndices.length-1),valueArray[attrIndex]=value,attrIndex}function setVisibility(fullTrace,visibility){var fullInput=fullTrace._fullInput;if(Registry.hasTransform(fullInput,"groupby")){var kcont=carrs[fullInput.index];if(!kcont){var groupbyIndices=Registry.getTransformIndices(fullInput,"groupby"),lastGroupbyIndex=groupbyIndices[groupbyIndices.length-1];kcont=Lib.keyedContainer(fullInput,"transforms["+lastGroupbyIndex+"].styles","target","value.visible"),carrs[fullInput.index]=kcont}var curState=kcont.get(fullTrace._group);void 0===curState&&(curState=!0),!1!==curState&&kcont.set(fullTrace._group,visibility),carrIdx[fullInput.index]=insertUpdate(fullInput.index,"visible",!1!==fullInput.visible)}else{var nextVisibility=!1!==fullInput.visible&&visibility;insertUpdate(fullInput.index,"visible",nextVisibility)}}}},{"../../lib":693,"../../registry":825}],626:[function(_dereq_,module,exports){"use strict";exports.isGrouped=function isGrouped(legendLayout){return-1!==(legendLayout.traceorder||"").indexOf("grouped")},exports.isVertical=function isVertical(legendLayout){return"h"!==legendLayout.orientation},exports.isReversed=function isReversed(legendLayout){return-1!==(legendLayout.traceorder||"").indexOf("reversed")}},{}],627:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"component",name:"legend",layoutAttributes:_dereq_("./attributes"),supplyLayoutDefaults:_dereq_("./defaults"),draw:_dereq_("./draw"),style:_dereq_("./style")}},{"./attributes":620,"./defaults":622,"./draw":623,"./style":628}],628:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),subTypes=_dereq_("../../traces/scatter/subtypes"),stylePie=_dereq_("../../traces/pie/style_one");module.exports=function style(s,gd){s.each(function(d){var traceGroup=d3.select(this),layers=Lib.ensureSingle(traceGroup,"g","layers");layers.style("opacity",d[0].trace.opacity),layers.selectAll("g.legendfill").data([d]).enter().append("g").classed("legendfill",!0),layers.selectAll("g.legendlines").data([d]).enter().append("g").classed("legendlines",!0);var symbol=layers.selectAll("g.legendsymbols").data([d]);symbol.enter().append("g").classed("legendsymbols",!0),symbol.selectAll("g.legendpoints").data([d]).enter().append("g").classed("legendpoints",!0)}).each(function styleBars(d){var trace=d[0].trace,marker=trace.marker||{},markerLine=marker.line||{},barpath=d3.select(this).select("g.legendpoints").selectAll("path.legendbar").data(Registry.traceIs(trace,"bar")?[d]:[]);barpath.enter().append("path").classed("legendbar",!0).attr("d","M6,6H-6V-6H6Z").attr("transform","translate(20,0)"),barpath.exit().remove(),barpath.each(function(d){var p=d3.select(this),d0=d[0],w=(d0.mlw+1||markerLine.width+1)-1;p.style("stroke-width",w+"px").call(Color.fill,d0.mc||marker.color),w&&p.call(Color.stroke,d0.mlc||markerLine.color)})}).each(function styleBoxes(d){var trace=d[0].trace,pts=d3.select(this).select("g.legendpoints").selectAll("path.legendbox").data(Registry.traceIs(trace,"box-violin")&&trace.visible?[d]:[]);pts.enter().append("path").classed("legendbox",!0).attr("d","M6,6H-6V-6H6Z").attr("transform","translate(20,0)"),pts.exit().remove(),pts.each(function(){var w=trace.line.width,p=d3.select(this);p.style("stroke-width",w+"px").call(Color.fill,trace.fillcolor),w&&Color.stroke(p,trace.line.color)})}).each(function stylePies(d){var trace=d[0].trace,pts=d3.select(this).select("g.legendpoints").selectAll("path.legendpie").data(Registry.traceIs(trace,"pie")&&trace.visible?[d]:[]);pts.enter().append("path").classed("legendpie",!0).attr("d","M6,6H-6V-6H6Z").attr("transform","translate(20,0)"),pts.exit().remove(),pts.size()&&pts.call(stylePie,d[0],trace)}).each(function styleLines(d){var trace=d[0].trace,showFill=trace.visible&&trace.fill&&"none"!==trace.fill,showLine=subTypes.hasLines(trace),contours=trace.contours,showGradientLine=!1,showGradientFill=!1;if(contours){var coloring=contours.coloring;"lines"===coloring?showGradientLine=!0:showLine="none"===coloring||"heatmap"===coloring||contours.showlines,"constraint"===contours.type?showFill="="!==contours._operation:"fill"!==coloring&&"heatmap"!==coloring||(showGradientFill=!0)}var pathStart=subTypes.hasMarkers(trace)||subTypes.hasText(trace)||!showFill&&!showGradientFill?"M5,0":showLine||showGradientLine?"M5,-2":"M5,-3",this3=d3.select(this),fill=this3.select(".legendfill").selectAll("path").data(showFill||showGradientFill?[d]:[]);fill.enter().append("path").classed("js-fill",!0),fill.exit().remove(),fill.attr("d",pathStart+"h30v6h-30z").call(showFill?Drawing.fillGroupStyle:function fillGradient(s){if(s.size()){var gradientID="legendfill-"+trace.uid;Drawing.gradient(s,gd,gradientID,"horizontalreversed",trace.colorscale,"fill")}});var line=this3.select(".legendlines").selectAll("path").data(showLine||showGradientLine?[d]:[]);line.enter().append("path").classed("js-line",!0),line.exit().remove(),line.attr("d",pathStart+(showGradientLine?"l30,0.0001":"h30")).call(showLine?Drawing.lineGroupStyle:function lineGradient(s){if(s.size()){var gradientID="legendline-"+trace.uid;Drawing.lineGroupStyle(s),Drawing.gradient(s,gd,gradientID,"horizontalreversed",trace.colorscale,"stroke")}})}).each(function stylePoints(d){var dMod,tMod,d0=d[0],trace=d0.trace,showMarkers=subTypes.hasMarkers(trace),showText=subTypes.hasText(trace),showLines=subTypes.hasLines(trace);function boundVal(attrIn,arrayToValFn,bounds){var valIn=Lib.nestedProperty(trace,attrIn).get(),valToBound=Array.isArray(valIn)&&arrayToValFn?arrayToValFn(valIn):valIn;if(bounds){if(valToBound<bounds[0])return bounds[0];if(valToBound>bounds[1])return bounds[1]}return valToBound}function pickFirst(array){return array[0]}if(showMarkers||showText||showLines){var dEdit={},tEdit={};if(showMarkers){dEdit.mc=boundVal("marker.color",pickFirst),dEdit.mx=boundVal("marker.symbol",pickFirst),dEdit.mo=boundVal("marker.opacity",Lib.mean,[.2,1]),dEdit.mlc=boundVal("marker.line.color",pickFirst),dEdit.mlw=boundVal("marker.line.width",Lib.mean,[0,5]),tEdit.marker={sizeref:1,sizemin:1,sizemode:"diameter"};var ms=boundVal("marker.size",Lib.mean,[2,16]);dEdit.ms=ms,tEdit.marker.size=ms}showLines&&(tEdit.line={width:boundVal("line.width",pickFirst,[0,10])}),showText&&(dEdit.tx="Aa",dEdit.tp=boundVal("textposition",pickFirst),dEdit.ts=10,dEdit.tc=boundVal("textfont.color",pickFirst),dEdit.tf=boundVal("textfont.family",pickFirst)),dMod=[Lib.minExtend(d0,dEdit)],(tMod=Lib.minExtend(trace,tEdit)).selectedpoints=null}var ptgroup=d3.select(this).select("g.legendpoints"),pts=ptgroup.selectAll("path.scatterpts").data(showMarkers?dMod:[]);pts.enter().insert("path",":first-child").classed("scatterpts",!0).attr("transform","translate(20,0)"),pts.exit().remove(),pts.call(Drawing.pointStyle,tMod,gd),showMarkers&&(dMod[0].mrc=3);var txt=ptgroup.selectAll("g.pointtext").data(showText?dMod:[]);txt.enter().append("g").classed("pointtext",!0).append("text").attr("transform","translate(20,0)"),txt.exit().remove(),txt.selectAll("text").call(Drawing.textPointStyle,tMod,gd)}).each(function styleCandles(d){var trace=d[0].trace,pts=d3.select(this).select("g.legendpoints").selectAll("path.legendcandle").data("candlestick"===trace.type&&trace.visible?[d,d]:[]);pts.enter().append("path").classed("legendcandle",!0).attr("d",function(_,i){return i?"M-15,0H-8M-8,6V-6H8Z":"M15,0H8M8,-6V6H-8Z"}).attr("transform","translate(20,0)").style("stroke-miterlimit",1),pts.exit().remove(),pts.each(function(_,i){var container=trace[i?"increasing":"decreasing"],w=container.line.width,p=d3.select(this);p.style("stroke-width",w+"px").call(Color.fill,container.fillcolor),w&&Color.stroke(p,container.line.color)})}).each(function styleOHLC(d){var trace=d[0].trace,pts=d3.select(this).select("g.legendpoints").selectAll("path.legendohlc").data("ohlc"===trace.type&&trace.visible?[d,d]:[]);pts.enter().append("path").classed("legendohlc",!0).attr("d",function(_,i){return i?"M-15,0H0M-8,-6V0":"M15,0H0M8,6V0"}).attr("transform","translate(20,0)").style("stroke-miterlimit",1),pts.exit().remove(),pts.each(function(_,i){var container=trace[i?"increasing":"decreasing"],w=container.line.width,p=d3.select(this);p.style("fill","none").call(Drawing.dashLine,container.line.dash,w),w&&Color.stroke(p,container.line.color)})})}},{"../../lib":693,"../../registry":825,"../../traces/pie/style_one":1018,"../../traces/scatter/subtypes":1056,"../color":567,"../drawing":592,d3:147}],629:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Plots=_dereq_("../../plots/plots"),axisIds=_dereq_("../../plots/cartesian/axis_ids"),Lib=_dereq_("../../lib"),Icons=_dereq_("../../../build/ploticon"),_=Lib._,modeBarButtons=module.exports={};function handleCartesian(gd,ev){var ax,i,button=ev.currentTarget,astr=button.getAttribute("data-attr"),val=button.getAttribute("data-val")||!0,fullLayout=gd._fullLayout,aobj={},axList=axisIds.list(gd,null,!0),allSpikesEnabled="on";if("zoom"===astr){var axName,mag="in"===val?.5:2,r0=(1+mag)/2,r1=(1-mag)/2;for(i=0;i<axList.length;i++)if(!(ax=axList[i]).fixedrange)if(axName=ax._name,"auto"===val)aobj[axName+".autorange"]=!0;else if("reset"===val){if(void 0===ax._rangeInitial)aobj[axName+".autorange"]=!0;else{var rangeInitial=ax._rangeInitial.slice();aobj[axName+".range[0]"]=rangeInitial[0],aobj[axName+".range[1]"]=rangeInitial[1]}void 0!==ax._showSpikeInitial&&(aobj[axName+".showspikes"]=ax._showSpikeInitial,"on"!==allSpikesEnabled||ax._showSpikeInitial||(allSpikesEnabled="off"))}else{var rangeNow=[ax.r2l(ax.range[0]),ax.r2l(ax.range[1])],rangeNew=[r0*rangeNow[0]+r1*rangeNow[1],r0*rangeNow[1]+r1*rangeNow[0]];aobj[axName+".range[0]"]=ax.l2r(rangeNew[0]),aobj[axName+".range[1]"]=ax.l2r(rangeNew[1])}fullLayout._cartesianSpikesEnabled=allSpikesEnabled}else{if("hovermode"!==astr||"x"!==val&&"y"!==val){if("hovermode"===astr&&"closest"===val){for(i=0;i<axList.length;i++)ax=axList[i],"on"!==allSpikesEnabled||ax.showspikes||(allSpikesEnabled="off");fullLayout._cartesianSpikesEnabled=allSpikesEnabled}}else val=fullLayout._isHoriz?"y":"x",button.setAttribute("data-val",val);aobj[astr]=val}Registry.call("relayout",gd,aobj)}function handleDrag3d(gd,ev){for(var button=ev.currentTarget,attr=button.getAttribute("data-attr"),val=button.getAttribute("data-val")||!0,sceneIds=gd._fullLayout._subplots.gl3d,layoutUpdate={},parts=attr.split("."),i=0;i<sceneIds.length;i++)layoutUpdate[sceneIds[i]+"."+parts[1]]=val;var val2d="pan"===val?val:"zoom";layoutUpdate.dragmode=val2d,Registry.call("relayout",gd,layoutUpdate)}function handleCamera3d(gd,ev){for(var attr=ev.currentTarget.getAttribute("data-attr"),fullLayout=gd._fullLayout,sceneIds=fullLayout._subplots.gl3d,aobj={},i=0;i<sceneIds.length;i++){var sceneId=sceneIds[i],key=sceneId+".camera",scene=fullLayout[sceneId]._scene;"resetDefault"===attr?aobj[key]=null:"resetLastSave"===attr&&(aobj[key]=Lib.extendDeep({},scene.cameraInitial))}Registry.call("relayout",gd,aobj)}function handleHover3d(gd,ev){var button=ev.currentTarget,val=button._previousVal||!1,layout=gd.layout,fullLayout=gd._fullLayout,sceneIds=fullLayout._subplots.gl3d,axes=["xaxis","yaxis","zaxis"],spikeAttrs=["showspikes","spikesides","spikethickness","spikecolor"],currentSpikes={},axisSpikes={},layoutUpdate={};if(val)layoutUpdate=Lib.extendDeep(layout,val),button._previousVal=null;else{layoutUpdate={"allaxes.showspikes":!1};for(var i=0;i<sceneIds.length;i++){var sceneId=sceneIds[i],sceneLayout=fullLayout[sceneId],sceneSpikes=currentSpikes[sceneId]={};sceneSpikes.hovermode=sceneLayout.hovermode,layoutUpdate[sceneId+".hovermode"]=!1;for(var j=0;j<3;j++){var axis=axes[j];axisSpikes=sceneSpikes[axis]={};for(var k=0;k<spikeAttrs.length;k++){var spikeAttr=spikeAttrs[k];axisSpikes[spikeAttr]=sceneLayout[axis][spikeAttr]}}}button._previousVal=Lib.extendDeep({},currentSpikes)}Registry.call("relayout",gd,layoutUpdate)}function handleGeo(gd,ev){for(var button=ev.currentTarget,attr=button.getAttribute("data-attr"),val=button.getAttribute("data-val")||!0,fullLayout=gd._fullLayout,geoIds=fullLayout._subplots.geo,i=0;i<geoIds.length;i++){var id=geoIds[i],geoLayout=fullLayout[id];if("zoom"===attr){var scale=geoLayout.projection.scale,newScale="in"===val?2*scale:.5*scale;Registry.call("relayout",gd,id+".projection.scale",newScale)}else"reset"===attr&&resetView(gd,"geo")}}function toggleHover(gd){var onHoverVal,fullLayout=gd._fullLayout;onHoverVal=fullLayout._has("cartesian")?fullLayout._isHoriz?"y":"x":"closest";var newHover=!gd._fullLayout.hovermode&&onHoverVal;Registry.call("relayout",gd,"hovermode",newHover)}function resetView(gd,subplotType){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots[subplotType],aObj={},i=0;i<subplotIds.length;i++)for(var id=subplotIds[i],viewInitial=fullLayout[id]._subplot.viewInitial,viewKeys=Object.keys(viewInitial),j=0;j<viewKeys.length;j++){var key=viewKeys[j];aObj[id+"."+key]=viewInitial[key]}Registry.call("relayout",gd,aObj)}modeBarButtons.toImage={name:"toImage",title:function(gd){var format=(gd._context.toImageButtonOptions||{}).format||"png";return _(gd,"png"===format?"Download plot as a png":"Download plot")},icon:Icons.camera,click:function(gd){var toImageButtonOptions=gd._context.toImageButtonOptions,opts={format:toImageButtonOptions.format||"png"};Lib.notifier(_(gd,"Taking snapshot - this may take a few seconds"),"long"),"svg"!==opts.format&&Lib.isIE()&&(Lib.notifier(_(gd,"IE only supports svg.  Changing format to svg."),"long"),opts.format="svg"),["filename","width","height","scale"].forEach(function(key){toImageButtonOptions[key]&&(opts[key]=toImageButtonOptions[key])}),Registry.call("downloadImage",gd,opts).then(function(filename){Lib.notifier(_(gd,"Snapshot succeeded")+" - "+filename,"long")}).catch(function(){Lib.notifier(_(gd,"Sorry, there was a problem downloading your snapshot!"),"long")})}},modeBarButtons.sendDataToCloud={name:"sendDataToCloud",title:function(gd){return _(gd,"Edit in Chart Studio")},icon:Icons.disk,click:function(gd){Plots.sendDataToCloud(gd)}},modeBarButtons.zoom2d={name:"zoom2d",title:function(gd){return _(gd,"Zoom")},attr:"dragmode",val:"zoom",icon:Icons.zoombox,click:handleCartesian},modeBarButtons.pan2d={name:"pan2d",title:function(gd){return _(gd,"Pan")},attr:"dragmode",val:"pan",icon:Icons.pan,click:handleCartesian},modeBarButtons.select2d={name:"select2d",title:function(gd){return _(gd,"Box Select")},attr:"dragmode",val:"select",icon:Icons.selectbox,click:handleCartesian},modeBarButtons.lasso2d={name:"lasso2d",title:function(gd){return _(gd,"Lasso Select")},attr:"dragmode",val:"lasso",icon:Icons.lasso,click:handleCartesian},modeBarButtons.zoomIn2d={name:"zoomIn2d",title:function(gd){return _(gd,"Zoom in")},attr:"zoom",val:"in",icon:Icons.zoom_plus,click:handleCartesian},modeBarButtons.zoomOut2d={name:"zoomOut2d",title:function(gd){return _(gd,"Zoom out")},attr:"zoom",val:"out",icon:Icons.zoom_minus,click:handleCartesian},modeBarButtons.autoScale2d={name:"autoScale2d",title:function(gd){return _(gd,"Autoscale")},attr:"zoom",val:"auto",icon:Icons.autoscale,click:handleCartesian},modeBarButtons.resetScale2d={name:"resetScale2d",title:function(gd){return _(gd,"Reset axes")},attr:"zoom",val:"reset",icon:Icons.home,click:handleCartesian},modeBarButtons.hoverClosestCartesian={name:"hoverClosestCartesian",title:function(gd){return _(gd,"Show closest data on hover")},attr:"hovermode",val:"closest",icon:Icons.tooltip_basic,gravity:"ne",click:handleCartesian},modeBarButtons.hoverCompareCartesian={name:"hoverCompareCartesian",title:function(gd){return _(gd,"Compare data on hover")},attr:"hovermode",val:function(gd){return gd._fullLayout._isHoriz?"y":"x"},icon:Icons.tooltip_compare,gravity:"ne",click:handleCartesian},modeBarButtons.zoom3d={name:"zoom3d",title:function(gd){return _(gd,"Zoom")},attr:"scene.dragmode",val:"zoom",icon:Icons.zoombox,click:handleDrag3d},modeBarButtons.pan3d={name:"pan3d",title:function(gd){return _(gd,"Pan")},attr:"scene.dragmode",val:"pan",icon:Icons.pan,click:handleDrag3d},modeBarButtons.orbitRotation={name:"orbitRotation",title:function(gd){return _(gd,"Orbital rotation")},attr:"scene.dragmode",val:"orbit",icon:Icons["3d_rotate"],click:handleDrag3d},modeBarButtons.tableRotation={name:"tableRotation",title:function(gd){return _(gd,"Turntable rotation")},attr:"scene.dragmode",val:"turntable",icon:Icons["z-axis"],click:handleDrag3d},modeBarButtons.resetCameraDefault3d={name:"resetCameraDefault3d",title:function(gd){return _(gd,"Reset camera to default")},attr:"resetDefault",icon:Icons.home,click:handleCamera3d},modeBarButtons.resetCameraLastSave3d={name:"resetCameraLastSave3d",title:function(gd){return _(gd,"Reset camera to last save")},attr:"resetLastSave",icon:Icons.movie,click:handleCamera3d},modeBarButtons.hoverClosest3d={name:"hoverClosest3d",title:function(gd){return _(gd,"Toggle show closest data on hover")},attr:"hovermode",val:null,toggle:!0,icon:Icons.tooltip_basic,gravity:"ne",click:handleHover3d},modeBarButtons.zoomInGeo={name:"zoomInGeo",title:function(gd){return _(gd,"Zoom in")},attr:"zoom",val:"in",icon:Icons.zoom_plus,click:handleGeo},modeBarButtons.zoomOutGeo={name:"zoomOutGeo",title:function(gd){return _(gd,"Zoom out")},attr:"zoom",val:"out",icon:Icons.zoom_minus,click:handleGeo},modeBarButtons.resetGeo={name:"resetGeo",title:function(gd){return _(gd,"Reset")},attr:"reset",val:null,icon:Icons.autoscale,click:handleGeo},modeBarButtons.hoverClosestGeo={name:"hoverClosestGeo",title:function(gd){return _(gd,"Toggle show closest data on hover")},attr:"hovermode",val:null,toggle:!0,icon:Icons.tooltip_basic,gravity:"ne",click:toggleHover},modeBarButtons.hoverClosestGl2d={name:"hoverClosestGl2d",title:function(gd){return _(gd,"Toggle show closest data on hover")},attr:"hovermode",val:null,toggle:!0,icon:Icons.tooltip_basic,gravity:"ne",click:toggleHover},modeBarButtons.hoverClosestPie={name:"hoverClosestPie",title:function(gd){return _(gd,"Toggle show closest data on hover")},attr:"hovermode",val:"closest",icon:Icons.tooltip_basic,gravity:"ne",click:toggleHover},modeBarButtons.toggleHover={name:"toggleHover",title:function(gd){return _(gd,"Toggle show closest data on hover")},attr:"hovermode",val:null,toggle:!0,icon:Icons.tooltip_basic,gravity:"ne",click:function(gd,ev){toggleHover(gd),handleHover3d(gd,ev)}},modeBarButtons.resetViews={name:"resetViews",title:function(gd){return _(gd,"Reset views")},icon:Icons.home,click:function(gd,ev){var button=ev.currentTarget;button.setAttribute("data-attr","zoom"),button.setAttribute("data-val","reset"),handleCartesian(gd,ev),button.setAttribute("data-attr","resetLastSave"),handleCamera3d(gd,ev),resetView(gd,"geo"),resetView(gd,"mapbox")}},modeBarButtons.toggleSpikelines={name:"toggleSpikelines",title:function(gd){return _(gd,"Toggle Spike Lines")},icon:Icons.spikeline,attr:"_cartesianSpikesEnabled",val:"on",click:function(gd){var fullLayout=gd._fullLayout;fullLayout._cartesianSpikesEnabled="on"===fullLayout._cartesianSpikesEnabled?"off":"on";var aobj=function setSpikelineVisibility(gd){for(var ax,axName,fullLayout=gd._fullLayout,axList=axisIds.list(gd,null,!0),aobj={},i=0;i<axList.length;i++)ax=axList[i],axName=ax._name,aobj[axName+".showspikes"]="on"===fullLayout._cartesianSpikesEnabled||ax._showSpikeInitial;return aobj}(gd);Registry.call("relayout",gd,aobj)}},modeBarButtons.resetViewMapbox={name:"resetViewMapbox",title:function(gd){return _(gd,"Reset view")},attr:"reset",icon:Icons.home,click:function(gd){resetView(gd,"mapbox")}}},{"../../../build/ploticon":2,"../../lib":693,"../../plots/cartesian/axis_ids":745,"../../plots/plots":805,"../../registry":825}],630:[function(_dereq_,module,exports){"use strict";exports.manage=_dereq_("./manage")},{"./manage":631}],631:[function(_dereq_,module,exports){"use strict";var axisIds=_dereq_("../../plots/cartesian/axis_ids"),scatterSubTypes=_dereq_("../../traces/scatter/subtypes"),Registry=_dereq_("../../registry"),createModeBar=_dereq_("./modebar"),modeBarButtons=_dereq_("./buttons");module.exports=function manageModeBar(gd){var fullLayout=gd._fullLayout,context=gd._context,modeBar=fullLayout._modeBar;if(context.displayModeBar){if(!Array.isArray(context.modeBarButtonsToRemove))throw new Error(["*modeBarButtonsToRemove* configuration options","must be an array."].join(" "));if(!Array.isArray(context.modeBarButtonsToAdd))throw new Error(["*modeBarButtonsToAdd* configuration options","must be an array."].join(" "));var buttonGroups,customButtons=context.modeBarButtons;buttonGroups=Array.isArray(customButtons)&&customButtons.length?function fillCustomButton(customButtons){for(var i=0;i<customButtons.length;i++)for(var buttonGroup=customButtons[i],j=0;j<buttonGroup.length;j++){var button=buttonGroup[j];if("string"==typeof button){if(void 0===modeBarButtons[button])throw new Error(["*modeBarButtons* configuration options","invalid button name"].join(" "));customButtons[i][j]=modeBarButtons[button]}}return customButtons}(customButtons):function getButtonGroups(gd,buttonsToRemove,buttonsToAdd){var fullLayout=gd._fullLayout,fullData=gd._fullData,hasCartesian=fullLayout._has("cartesian"),hasGL3D=fullLayout._has("gl3d"),hasGeo=fullLayout._has("geo"),hasPie=fullLayout._has("pie"),hasGL2D=fullLayout._has("gl2d"),hasTernary=fullLayout._has("ternary"),hasMapbox=fullLayout._has("mapbox"),hasPolar=fullLayout._has("polar"),allAxesFixed=function areAllAxesFixed(fullLayout){for(var axList=axisIds.list({_fullLayout:fullLayout},null,!0),i=0;i<axList.length;i++)if(!axList[i].fixedrange)return!1;return!0}(fullLayout),groups=[];function addGroup(newGroup){if(newGroup.length){for(var out=[],i=0;i<newGroup.length;i++){var button=newGroup[i];-1===buttonsToRemove.indexOf(button)&&out.push(modeBarButtons[button])}groups.push(out)}}addGroup(["toImage","sendDataToCloud"]);var zoomGroup=[],hoverGroup=[],resetGroup=[],dragModeGroup=[];(hasCartesian||hasGL2D||hasPie||hasTernary)+hasGeo+hasGL3D+hasMapbox+hasPolar>1?(hoverGroup=["toggleHover"],resetGroup=["resetViews"]):hasGeo?(zoomGroup=["zoomInGeo","zoomOutGeo"],hoverGroup=["hoverClosestGeo"],resetGroup=["resetGeo"]):hasGL3D?(hoverGroup=["hoverClosest3d"],resetGroup=["resetCameraDefault3d","resetCameraLastSave3d"]):hasMapbox?(hoverGroup=["toggleHover"],resetGroup=["resetViewMapbox"]):hoverGroup=hasGL2D?["hoverClosestGl2d"]:hasPie?["hoverClosestPie"]:["toggleHover"];hasCartesian&&(hoverGroup=["toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian"]);!hasCartesian&&!hasGL2D||allAxesFixed||(zoomGroup=["zoomIn2d","zoomOut2d","autoScale2d"],"resetViews"!==resetGroup[0]&&(resetGroup=["resetScale2d"]));hasGL3D?dragModeGroup=["zoom3d","pan3d","orbitRotation","tableRotation"]:(hasCartesian||hasGL2D)&&!allAxesFixed||hasTernary?dragModeGroup=["zoom2d","pan2d"]:hasMapbox||hasGeo?dragModeGroup=["pan2d"]:hasPolar&&(dragModeGroup=["zoom2d"]);(function isSelectable(fullData){for(var selectable=!1,i=0;i<fullData.length&&!selectable;i++){var trace=fullData[i];trace._module&&trace._module.selectPoints&&(Registry.traceIs(trace,"scatter-like")?(scatterSubTypes.hasMarkers(trace)||scatterSubTypes.hasText(trace))&&(selectable=!0):Registry.traceIs(trace,"box-violin")&&"all"!==trace.boxpoints&&"all"!==trace.points||(selectable=!0))}return selectable})(fullData)&&dragModeGroup.push("select2d","lasso2d");return addGroup(dragModeGroup),addGroup(zoomGroup.concat(resetGroup)),addGroup(hoverGroup),function appendButtonsToGroups(groups,buttons){if(buttons.length)if(Array.isArray(buttons[0]))for(var i=0;i<buttons.length;i++)groups.push(buttons[i]);else groups.push(buttons);return groups}(groups,buttonsToAdd)}(gd,context.modeBarButtonsToRemove,context.modeBarButtonsToAdd),modeBar?modeBar.update(gd,buttonGroups):fullLayout._modeBar=createModeBar(gd,buttonGroups)}else modeBar&&(modeBar.destroy(),delete fullLayout._modeBar)}},{"../../plots/cartesian/axis_ids":745,"../../registry":825,"../../traces/scatter/subtypes":1056,"./buttons":629,"./modebar":632}],632:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),Icons=_dereq_("../../../build/ploticon");function ModeBar(opts){this.container=opts.container,this.element=document.createElement("div"),this.update(opts.graphInfo,opts.buttons),this.container.appendChild(this.element)}var proto=ModeBar.prototype;proto.update=function(graphInfo,buttons){this.graphInfo=graphInfo;var context=this.graphInfo._context;"hover"===context.displayModeBar?this.element.className="modebar modebar--hover":this.element.className="modebar";var needsNewButtons=!this.hasButtons(buttons),needsNewLogo=this.hasLogo!==context.displaylogo,needsNewLocale=this.locale!==context.locale;this.locale=context.locale,(needsNewButtons||needsNewLogo||needsNewLocale)&&(this.removeAllButtons(),this.updateButtons(buttons),context.displaylogo&&(this.element.appendChild(this.getLogo()),this.hasLogo=!0)),this.updateActiveButton()},proto.updateButtons=function(buttons){var _this=this;this.buttons=buttons,this.buttonElements=[],this.buttonsNames=[],this.buttons.forEach(function(buttonGroup){var group=_this.createGroup();buttonGroup.forEach(function(buttonConfig){var buttonName=buttonConfig.name;if(!buttonName)throw new Error("must provide button 'name' in button config");if(-1!==_this.buttonsNames.indexOf(buttonName))throw new Error("button name '"+buttonName+"' is taken");_this.buttonsNames.push(buttonName);var button=_this.createButton(buttonConfig);_this.buttonElements.push(button),group.appendChild(button)}),_this.element.appendChild(group)})},proto.createGroup=function(){var group=document.createElement("div");return group.className="modebar-group",group},proto.createButton=function(config){var _this=this,button=document.createElement("a");button.setAttribute("rel","tooltip"),button.className="modebar-btn";var title=config.title;void 0===title?title=config.name:"function"==typeof title&&(title=title(this.graphInfo)),(title||0===title)&&button.setAttribute("data-title",title),void 0!==config.attr&&button.setAttribute("data-attr",config.attr);var val=config.val;if(void 0!==val&&("function"==typeof val&&(val=val(this.graphInfo)),button.setAttribute("data-val",val)),"function"!=typeof config.click)throw new Error("must provide button 'click' function in button config");button.addEventListener("click",function(ev){config.click(_this.graphInfo,ev),_this.updateActiveButton(ev.currentTarget)}),button.setAttribute("data-toggle",config.toggle||!1),config.toggle&&d3.select(button).classed("active",!0);var icon=config.icon;return"function"==typeof icon?button.appendChild(icon()):button.appendChild(this.createIcon(icon||Icons.question)),button.setAttribute("data-gravity",config.gravity||"n"),button},proto.createIcon=function(thisIcon){var iconHeight=isNumeric(thisIcon.height)?Number(thisIcon.height):thisIcon.ascent-thisIcon.descent,svgNS="http://www.w3.org/2000/svg",icon=document.createElementNS(svgNS,"svg"),path=document.createElementNS(svgNS,"path");return icon.setAttribute("height","1em"),icon.setAttribute("width",thisIcon.width/iconHeight+"em"),icon.setAttribute("viewBox",[0,0,thisIcon.width,iconHeight].join(" ")),path.setAttribute("d",thisIcon.path),thisIcon.transform?path.setAttribute("transform",thisIcon.transform):void 0!==thisIcon.ascent&&path.setAttribute("transform","matrix(1 0 0 -1 0 "+thisIcon.ascent+")"),icon.appendChild(path),icon},proto.updateActiveButton=function(buttonClicked){var fullLayout=this.graphInfo._fullLayout,dataAttrClicked=void 0!==buttonClicked?buttonClicked.getAttribute("data-attr"):null;this.buttonElements.forEach(function(button){var thisval=button.getAttribute("data-val")||!0,dataAttr=button.getAttribute("data-attr"),isToggleButton="true"===button.getAttribute("data-toggle"),button3=d3.select(button);if(isToggleButton)dataAttr===dataAttrClicked&&button3.classed("active",!button3.classed("active"));else{var val=null===dataAttr?dataAttr:Lib.nestedProperty(fullLayout,dataAttr).get();button3.classed("active",val===thisval)}})},proto.hasButtons=function(buttons){var currentButtons=this.buttons;if(!currentButtons)return!1;if(buttons.length!==currentButtons.length)return!1;for(var i=0;i<buttons.length;++i){if(buttons[i].length!==currentButtons[i].length)return!1;for(var j=0;j<buttons[i].length;j++)if(buttons[i][j].name!==currentButtons[i][j].name)return!1}return!0},proto.getLogo=function(){var group=this.createGroup(),a=document.createElement("a");return a.href="https://plot.ly/",a.target="_blank",a.setAttribute("data-title",Lib._(this.graphInfo,"Produced with Plotly")),a.className="modebar-btn plotlyjsicon modebar-btn--logo",a.appendChild(this.createIcon(Icons.plotlylogo)),group.appendChild(a),group},proto.removeAllButtons=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.hasLogo=!1},proto.destroy=function(){Lib.removeElement(this.container.querySelector(".modebar"))},module.exports=function createModeBar(gd,buttons){var fullLayout=gd._fullLayout,modeBar=new ModeBar({graphInfo:gd,container:fullLayout._paperdiv.node(),buttons:buttons});return fullLayout._privateplot&&d3.select(modeBar.element).append("span").classed("badge-private float--left",!0).text("PRIVATE"),modeBar}},{"../../../build/ploticon":2,"../../lib":693,d3:147,"fast-isnumeric":213}],633:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),colorAttrs=_dereq_("../color/attributes"),buttonAttrs=(0,_dereq_("../../plot_api/plot_template").templatedArray)("button",{visible:{valType:"boolean",dflt:!0,editType:"plot"},step:{valType:"enumerated",values:["month","year","day","hour","minute","second","all"],dflt:"month",editType:"plot"},stepmode:{valType:"enumerated",values:["backward","todate"],dflt:"backward",editType:"plot"},count:{valType:"number",min:0,dflt:1,editType:"plot"},label:{valType:"string",editType:"plot"},editType:"plot"});module.exports={visible:{valType:"boolean",editType:"plot"},buttons:buttonAttrs,x:{valType:"number",min:-2,max:3,editType:"plot"},xanchor:{valType:"enumerated",values:["auto","left","center","right"],dflt:"left",editType:"plot"},y:{valType:"number",min:-2,max:3,editType:"plot"},yanchor:{valType:"enumerated",values:["auto","top","middle","bottom"],dflt:"bottom",editType:"plot"},font:fontAttrs({editType:"plot"}),bgcolor:{valType:"color",dflt:colorAttrs.lightLine,editType:"plot"},activecolor:{valType:"color",editType:"plot"},bordercolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"plot"},borderwidth:{valType:"number",min:0,dflt:0,editType:"plot"},editType:"plot"}},{"../../plot_api/plot_template":732,"../../plots/font_attributes":768,"../color/attributes":566}],634:[function(_dereq_,module,exports){"use strict";module.exports={yPad:.02,minButtonWidth:30,rx:3,ry:3,lightAmount:25,darkAmount:10}},{}],635:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../color"),Template=_dereq_("../../plot_api/plot_template"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),constants=_dereq_("./constants");function buttonDefaults(buttonIn,buttonOut,selectorOut,opts){var calendar=opts.calendar;function coerce(attr,dflt){return Lib.coerce(buttonIn,buttonOut,attributes.buttons,attr,dflt)}if(coerce("visible")){var step=coerce("step");"all"!==step&&(!calendar||"gregorian"===calendar||"month"!==step&&"year"!==step?coerce("stepmode"):buttonOut.stepmode="backward",coerce("count")),coerce("label")}}module.exports=function handleDefaults(containerIn,containerOut,layout,counterAxes,calendar){var selectorIn=containerIn.rangeselector||{},selectorOut=Template.newContainer(containerOut,"rangeselector");function coerce(attr,dflt){return Lib.coerce(selectorIn,selectorOut,attributes,attr,dflt)}if(coerce("visible",handleArrayContainerDefaults(selectorIn,selectorOut,{name:"buttons",handleItemDefaults:buttonDefaults,calendar:calendar}).length>0)){var posDflt=function getPosDflt(containerOut,layout,counterAxes){for(var anchoredList=counterAxes.filter(function(ax){return layout[ax].anchor===containerOut._id}),posY=0,i=0;i<anchoredList.length;i++){var domain=layout[anchoredList[i]].domain;domain&&(posY=Math.max(domain[1],posY))}return[containerOut.domain[0],posY+constants.yPad]}(containerOut,layout,counterAxes);coerce("x",posDflt[0]),coerce("y",posDflt[1]),Lib.noneOrAll(containerIn,containerOut,["x","y"]),coerce("xanchor"),coerce("yanchor"),Lib.coerceFont(coerce,"font",layout.font);var bgColor=coerce("bgcolor");coerce("activecolor",Color.contrast(bgColor,constants.lightAmount,constants.darkAmount)),coerce("bordercolor"),coerce("borderwidth")}}},{"../../lib":693,"../../plot_api/plot_template":732,"../../plots/array_container_defaults":738,"../color":567,"./attributes":633,"./constants":634}],636:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Plots=_dereq_("../../plots/plots"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),axisIds=_dereq_("../../plots/cartesian/axis_ids"),anchorUtils=_dereq_("../legend/anchor_utils"),alignmentConstants=_dereq_("../../constants/alignment"),LINE_SPACING=alignmentConstants.LINE_SPACING,FROM_TL=alignmentConstants.FROM_TL,FROM_BR=alignmentConstants.FROM_BR,constants=_dereq_("./constants"),getUpdateObject=_dereq_("./get_update_object");function selectorKeyFunc(d){return d._id}function drawButtonRect(button,selectorLayout,d){var rect=Lib.ensureSingle(button,"rect","selector-rect",function(s){s.attr("shape-rendering","crispEdges")});rect.attr({rx:constants.rx,ry:constants.ry}),rect.call(Color.stroke,selectorLayout.bordercolor).call(Color.fill,function getFillColor(selectorLayout,d){return d._isActive||d._isHovered?selectorLayout.activecolor:selectorLayout.bgcolor}(selectorLayout,d)).style("stroke-width",selectorLayout.borderwidth+"px")}function drawButtonText(button,selectorLayout,d,gd){Lib.ensureSingle(button,"text","selector-text",function(s){s.classed("user-select-none",!0).attr("text-anchor","middle")}).call(Drawing.font,selectorLayout.font).text(function getLabel(opts){return opts.label?opts.label:"all"===opts.step?"all":opts.count+opts.step.charAt(0)}(d)).call(function textLayout(s){svgTextUtils.convertToTspans(s,gd)})}module.exports=function draw(gd){var selectors=gd._fullLayout._infolayer.selectAll(".rangeselector").data(function makeSelectorData(gd){for(var axes=axisIds.list(gd,"x",!0),data=[],i=0;i<axes.length;i++){var axis=axes[i];axis.rangeselector&&axis.rangeselector.visible&&data.push(axis)}return data}(gd),selectorKeyFunc);selectors.enter().append("g").classed("rangeselector",!0),selectors.exit().remove(),selectors.style({cursor:"pointer","pointer-events":"all"}),selectors.each(function(d){var selector=d3.select(this),axisLayout=d,selectorLayout=axisLayout.rangeselector,buttons=selector.selectAll("g.button").data(Lib.filterVisible(selectorLayout.buttons));buttons.enter().append("g").classed("button",!0),buttons.exit().remove(),buttons.each(function(d){var button=d3.select(this),update=getUpdateObject(axisLayout,d);d._isActive=function isActive(axisLayout,opts,update){if("all"===opts.step)return!0===axisLayout.autorange;var keys=Object.keys(update);return axisLayout.range[0]===update[keys[0]]&&axisLayout.range[1]===update[keys[1]]}(axisLayout,d,update),button.call(drawButtonRect,selectorLayout,d),button.call(drawButtonText,selectorLayout,d,gd),button.on("click",function(){gd._dragged||Registry.call("relayout",gd,update)}),button.on("mouseover",function(){d._isHovered=!0,button.call(drawButtonRect,selectorLayout,d)}),button.on("mouseout",function(){d._isHovered=!1,button.call(drawButtonRect,selectorLayout,d)})}),function reposition(gd,buttons,opts,axName,selector){var width=0,height=0,borderWidth=opts.borderwidth;buttons.each(function(){var button=d3.select(this),text=button.select(".selector-text"),tHeight=opts.font.size*LINE_SPACING,hEff=Math.max(tHeight*svgTextUtils.lineCount(text),16)+3;height=Math.max(height,hEff)}),buttons.each(function(){var button=d3.select(this),rect=button.select(".selector-rect"),text=button.select(".selector-text"),tWidth=text.node()&&Drawing.bBox(text.node()).width,tHeight=opts.font.size*LINE_SPACING,tLines=svgTextUtils.lineCount(text),wEff=Math.max(tWidth+10,constants.minButtonWidth);button.attr("transform","translate("+(borderWidth+width)+","+borderWidth+")"),rect.attr({x:0,y:0,width:wEff,height:height}),svgTextUtils.positionText(text,wEff/2,height/2-(tLines-1)*tHeight/2+3),width+=wEff+5});var graphSize=gd._fullLayout._size,lx=graphSize.l+graphSize.w*opts.x,ly=graphSize.t+graphSize.h*(1-opts.y),xanchor="left";anchorUtils.isRightAnchor(opts)&&(lx-=width,xanchor="right");anchorUtils.isCenterAnchor(opts)&&(lx-=width/2,xanchor="center");var yanchor="top";anchorUtils.isBottomAnchor(opts)&&(ly-=height,yanchor="bottom");anchorUtils.isMiddleAnchor(opts)&&(ly-=height/2,yanchor="middle");width=Math.ceil(width),height=Math.ceil(height),lx=Math.round(lx),ly=Math.round(ly),Plots.autoMargin(gd,axName+"-range-selector",{x:opts.x,y:opts.y,l:width*FROM_TL[xanchor],r:width*FROM_BR[xanchor],b:height*FROM_BR[yanchor],t:height*FROM_TL[yanchor]}),selector.attr("transform","translate("+lx+","+ly+")")}(gd,buttons,selectorLayout,axisLayout._name,selector)})}},{"../../constants/alignment":665,"../../lib":693,"../../lib/svg_text_utils":718,"../../plots/cartesian/axis_ids":745,"../../plots/plots":805,"../../registry":825,"../color":567,"../drawing":592,"../legend/anchor_utils":619,"./constants":634,"./get_update_object":637,d3:147}],637:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3");module.exports=function getUpdateObject(axisLayout,buttonLayout){var axName=axisLayout._name,update={};if("all"===buttonLayout.step)update[axName+".autorange"]=!0;else{var xrange=function getXRange(axisLayout,buttonLayout){var range0,currentRange=axisLayout.range,base=new Date(axisLayout.r2l(currentRange[1])),step=buttonLayout.step,count=buttonLayout.count;switch(buttonLayout.stepmode){case"backward":range0=axisLayout.l2r(+d3.time[step].utc.offset(base,-count));break;case"todate":var base2=d3.time[step].utc.offset(base,-count);range0=axisLayout.l2r(+d3.time[step].utc.ceil(base2))}var range1=currentRange[1];return[range0,range1]}(axisLayout,buttonLayout);update[axName+".range[0]"]=xrange[0],update[axName+".range[1]"]=xrange[1]}return update}},{d3:147}],638:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"component",name:"rangeselector",schema:{subplots:{xaxis:{rangeselector:_dereq_("./attributes")}}},layoutAttributes:_dereq_("./attributes"),handleDefaults:_dereq_("./defaults"),draw:_dereq_("./draw")}},{"./attributes":633,"./defaults":635,"./draw":636}],639:[function(_dereq_,module,exports){"use strict";var colorAttributes=_dereq_("../color/attributes");module.exports={bgcolor:{valType:"color",dflt:colorAttributes.background,editType:"plot"},bordercolor:{valType:"color",dflt:colorAttributes.defaultLine,editType:"plot"},borderwidth:{valType:"integer",dflt:0,min:0,editType:"plot"},autorange:{valType:"boolean",dflt:!0,editType:"calc",impliedEdits:{"range[0]":void 0,"range[1]":void 0}},range:{valType:"info_array",items:[{valType:"any",editType:"calc",impliedEdits:{"^autorange":!1}},{valType:"any",editType:"calc",impliedEdits:{"^autorange":!1}}],editType:"calc",impliedEdits:{autorange:!1}},thickness:{valType:"number",dflt:.15,min:0,max:1,editType:"plot"},visible:{valType:"boolean",dflt:!0,editType:"calc"},editType:"calc"}},{"../color/attributes":566}],640:[function(_dereq_,module,exports){"use strict";var listAxes=_dereq_("../../plots/cartesian/axis_ids").list,getAutoRange=_dereq_("../../plots/cartesian/autorange").getAutoRange,constants=_dereq_("./constants");module.exports=function calcAutorange(gd){for(var axes=listAxes(gd,"x",!0),i=0;i<axes.length;i++){var ax=axes[i],opts=ax[constants.name];opts&&opts.visible&&opts.autorange&&(opts._input.autorange=!0,opts._input.range=opts.range=getAutoRange(gd,ax))}}},{"../../plots/cartesian/autorange":741,"../../plots/cartesian/axis_ids":745,"./constants":641}],641:[function(_dereq_,module,exports){"use strict";module.exports={name:"rangeslider",containerClassName:"rangeslider-container",bgClassName:"rangeslider-bg",rangePlotClassName:"rangeslider-rangeplot",maskMinClassName:"rangeslider-mask-min",maskMaxClassName:"rangeslider-mask-max",slideBoxClassName:"rangeslider-slidebox",grabberMinClassName:"rangeslider-grabber-min",grabAreaMinClassName:"rangeslider-grabarea-min",handleMinClassName:"rangeslider-handle-min",grabberMaxClassName:"rangeslider-grabber-max",grabAreaMaxClassName:"rangeslider-grabarea-max",handleMaxClassName:"rangeslider-handle-max",maskMinOppAxisClassName:"rangeslider-mask-min-opp-axis",maskMaxOppAxisClassName:"rangeslider-mask-max-opp-axis",maskColor:"rgba(0,0,0,0.4)",maskOppAxisColor:"rgba(0,0,0,0.2)",slideBoxFill:"transparent",slideBoxCursor:"ew-resize",grabAreaFill:"transparent",grabAreaCursor:"col-resize",grabAreaWidth:10,handleWidth:4,handleRadius:1,handleStrokeWidth:1,extraPad:15}},{}],642:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Template=_dereq_("../../plot_api/plot_template"),axisIds=_dereq_("../../plots/cartesian/axis_ids"),attributes=_dereq_("./attributes"),oppAxisAttrs=_dereq_("./oppaxis_attributes");module.exports=function handleDefaults(layoutIn,layoutOut,axName){var axIn=layoutIn[axName],axOut=layoutOut[axName];if(axIn.rangeslider||layoutOut._requestRangeslider[axOut._id]){Lib.isPlainObject(axIn.rangeslider)||(axIn.rangeslider={});var rangeContainerIn,rangeContainerOut,containerIn=axIn.rangeslider,containerOut=Template.newContainer(axOut,"rangeslider");if(coerce("visible")){coerce("bgcolor",layoutOut.plot_bgcolor),coerce("bordercolor"),coerce("borderwidth"),coerce("thickness"),coerce("autorange",!axOut.isValidRange(containerIn.range)),coerce("range");var subplots=layoutOut._subplots;if(subplots)for(var yIds=subplots.cartesian.filter(function(subplotId){return subplotId.substr(0,subplotId.indexOf("y"))===axisIds.name2id(axName)}).map(function(subplotId){return subplotId.substr(subplotId.indexOf("y"),subplotId.length)}),yNames=Lib.simpleMap(yIds,axisIds.id2name),i=0;i<yNames.length;i++){var yName=yNames[i];rangeContainerIn=containerIn[yName]||{},rangeContainerOut=Template.newContainer(containerOut,yName,"yaxis");var rangemodeDflt,yAxOut=layoutOut[yName];rangeContainerIn.range&&yAxOut.isValidRange(rangeContainerIn.range)&&(rangemodeDflt="fixed"),"match"!==coerceRange("rangemode",rangemodeDflt)&&coerceRange("range",yAxOut.range.slice())}containerOut._input=containerIn}}function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,attributes,attr,dflt)}function coerceRange(attr,dflt){return Lib.coerce(rangeContainerIn,rangeContainerOut,oppAxisAttrs,attr,dflt)}}},{"../../lib":693,"../../plot_api/plot_template":732,"../../plots/cartesian/axis_ids":745,"./attributes":639,"./oppaxis_attributes":645}],643:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Plots=_dereq_("../../plots/plots"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),Titles=_dereq_("../titles"),Cartesian=_dereq_("../../plots/cartesian"),Axes=_dereq_("../../plots/cartesian/axes"),dragElement=_dereq_("../dragelement"),setCursor=_dereq_("../../lib/setcursor"),constants=_dereq_("./constants");function drawBg(rangeSlider,gd,axisOpts,opts){var bg=Lib.ensureSingle(rangeSlider,"rect",constants.bgClassName,function(s){s.attr({x:0,y:0,"shape-rendering":"crispEdges"})}),borderCorrect=opts.borderwidth%2==0?opts.borderwidth:opts.borderwidth-1,offsetShift=-opts._offsetShift,lw=Drawing.crispRound(gd,opts.borderwidth);bg.attr({width:opts._width+borderCorrect,height:opts._height+borderCorrect,transform:"translate("+offsetShift+","+offsetShift+")",fill:opts.bgcolor,stroke:opts.bordercolor,"stroke-width":lw})}function addClipPath(rangeSlider,gd,axisOpts,opts){var fullLayout=gd._fullLayout;Lib.ensureSingleById(fullLayout._topdefs,"clipPath",opts._clipId,function(s){s.append("rect").attr({x:0,y:0})}).select("rect").attr({width:opts._width,height:opts._height})}function drawRangePlot(rangeSlider,gd,axisOpts,opts){var mainplotinfo,subplotData=Axes.getSubplots(gd,axisOpts),calcData=gd.calcdata,rangePlots=rangeSlider.selectAll("g."+constants.rangePlotClassName).data(subplotData,Lib.identity);rangePlots.enter().append("g").attr("class",function(id){return constants.rangePlotClassName+" "+id}).call(Drawing.setClipUrl,opts._clipId),rangePlots.order(),rangePlots.exit().remove(),rangePlots.each(function(id,i){var plotgroup=d3.select(this),isMainPlot=0===i,oppAxisOpts=Axes.getFromId(gd,id,"y"),oppAxisName=oppAxisOpts._name,oppAxisRangeOpts=opts[oppAxisName],mockFigure={data:[],layout:{xaxis:{type:axisOpts.type,domain:[0,1],range:opts.range.slice(),calendar:axisOpts.calendar},width:opts._width,height:opts._height,margin:{t:0,b:0,l:0,r:0}},_context:gd._context};mockFigure.layout[oppAxisName]={type:oppAxisOpts.type,domain:[0,1],range:"match"!==oppAxisRangeOpts.rangemode?oppAxisRangeOpts.range.slice():oppAxisOpts.range.slice(),calendar:oppAxisOpts.calendar},Plots.supplyDefaults(mockFigure);var plotinfo={id:id,plotgroup:plotgroup,xaxis:mockFigure._fullLayout.xaxis,yaxis:mockFigure._fullLayout[oppAxisName],isRangePlot:!0};isMainPlot?mainplotinfo=plotinfo:(plotinfo.mainplot="xy",plotinfo.mainplotinfo=mainplotinfo),Cartesian.rangePlot(gd,plotinfo,function filterRangePlotCalcData(calcData,subplotId){for(var out=[],i=0;i<calcData.length;i++){var calcTrace=calcData[i],trace=calcTrace[0].trace;trace.xaxis+trace.yaxis===subplotId&&out.push(calcTrace)}return out}(calcData,id))})}function drawMasks(rangeSlider,gd,axisOpts,opts,oppAxisRangeOpts){(Lib.ensureSingle(rangeSlider,"rect",constants.maskMinClassName,function(s){s.attr({x:0,y:0,"shape-rendering":"crispEdges"})}).attr("height",opts._height).call(Color.fill,constants.maskColor),Lib.ensureSingle(rangeSlider,"rect",constants.maskMaxClassName,function(s){s.attr({y:0,"shape-rendering":"crispEdges"})}).attr("height",opts._height).call(Color.fill,constants.maskColor),"match"!==oppAxisRangeOpts.rangemode)&&(Lib.ensureSingle(rangeSlider,"rect",constants.maskMinOppAxisClassName,function(s){s.attr({y:0,"shape-rendering":"crispEdges"})}).attr("width",opts._width).call(Color.fill,constants.maskOppAxisColor),Lib.ensureSingle(rangeSlider,"rect",constants.maskMaxOppAxisClassName,function(s){s.attr({y:0,"shape-rendering":"crispEdges"})}).attr("width",opts._width).style("border-top",constants.maskOppBorder).call(Color.fill,constants.maskOppAxisColor))}function drawSlideBox(rangeSlider,gd,axisOpts,opts){gd._context.staticPlot||Lib.ensureSingle(rangeSlider,"rect",constants.slideBoxClassName,function(s){s.attr({y:0,cursor:constants.slideBoxCursor,"shape-rendering":"crispEdges"})}).attr({height:opts._height,fill:constants.slideBoxFill})}function drawGrabbers(rangeSlider,gd,axisOpts,opts){var grabberMin=Lib.ensureSingle(rangeSlider,"g",constants.grabberMinClassName),grabberMax=Lib.ensureSingle(rangeSlider,"g",constants.grabberMaxClassName),handleFixAttrs={x:0,width:constants.handleWidth,rx:constants.handleRadius,fill:Color.background,stroke:Color.defaultLine,"stroke-width":constants.handleStrokeWidth,"shape-rendering":"crispEdges"},handleDynamicAttrs={y:Math.round(opts._height/4),height:Math.round(opts._height/2)};if(Lib.ensureSingle(grabberMin,"rect",constants.handleMinClassName,function(s){s.attr(handleFixAttrs)}).attr(handleDynamicAttrs),Lib.ensureSingle(grabberMax,"rect",constants.handleMaxClassName,function(s){s.attr(handleFixAttrs)}).attr(handleDynamicAttrs),!gd._context.staticPlot){var grabAreaFixAttrs={width:constants.grabAreaWidth,x:0,y:0,fill:constants.grabAreaFill,cursor:constants.grabAreaCursor};Lib.ensureSingle(grabberMin,"rect",constants.grabAreaMinClassName,function(s){s.attr(grabAreaFixAttrs)}).attr("height",opts._height),Lib.ensureSingle(grabberMax,"rect",constants.grabAreaMaxClassName,function(s){s.attr(grabAreaFixAttrs)}).attr("height",opts._height)}}module.exports=function(gd){var fullLayout=gd._fullLayout,rangeSliderData=function makeRangeSliderData(fullLayout){var axes=Axes.list({_fullLayout:fullLayout},"x",!0),name=constants.name,out=[];if(fullLayout._has("gl2d"))return out;for(var i=0;i<axes.length;i++){var ax=axes[i];ax[name]&&ax[name].visible&&out.push(ax)}return out}(fullLayout);var rangeSliders=fullLayout._infolayer.selectAll("g."+constants.containerClassName).data(rangeSliderData,function keyFunction(axisOpts){return axisOpts._name});rangeSliders.enter().append("g").classed(constants.containerClassName,!0).attr("pointer-events","all"),rangeSliders.exit().each(function(axisOpts){var opts=axisOpts[constants.name];fullLayout._topdefs.select("#"+opts._clipId).remove()}).remove(),0!==rangeSliderData.length&&rangeSliders.each(function(axisOpts){var rangeSlider=d3.select(this),opts=axisOpts[constants.name],oppAxisOpts=fullLayout[Axes.id2name(axisOpts.anchor)],oppAxisRangeOpts=opts[Axes.id2name(axisOpts.anchor)];if(opts.range){var outRange=opts.range,axRange=axisOpts.range;outRange[0]=axisOpts.l2r(Math.min(axisOpts.r2l(outRange[0]),axisOpts.r2l(axRange[0]))),outRange[1]=axisOpts.l2r(Math.max(axisOpts.r2l(outRange[1]),axisOpts.r2l(axRange[1]))),opts._input.range=outRange.slice()}axisOpts.cleanRange("rangeslider.range");for(var margin=fullLayout.margin,graphSize=fullLayout._size,domain=axisOpts.domain,tickHeight=(axisOpts._boundingBox||{}).height||0,oppBottom=1/0,subplotData=Axes.getSubplots(gd,axisOpts),i=0;i<subplotData.length;i++){var oppAxis=Axes.getFromId(gd,subplotData[i].substr(subplotData[i].indexOf("y")));oppBottom=Math.min(oppBottom,oppAxis.domain[0])}opts._id=constants.name+axisOpts._id,opts._clipId=opts._id+"-"+fullLayout._uid,opts._width=graphSize.w*(domain[1]-domain[0]),opts._height=(fullLayout.height-margin.b-margin.t)*opts.thickness,opts._offsetShift=Math.floor(opts.borderwidth/2);var x=Math.round(margin.l+graphSize.w*domain[0]),y=Math.round(graphSize.t+graphSize.h*(1-oppBottom)+tickHeight+opts._offsetShift+constants.extraPad);rangeSlider.attr("transform","translate("+x+","+y+")");var range0=axisOpts.r2l(opts.range[0]),range1=axisOpts.r2l(opts.range[1]),dist=range1-range0;if(opts.p2d=function(v){return v/opts._width*dist+range0},opts.d2p=function(v){return(v-range0)/dist*opts._width},opts._rl=[range0,range1],"match"!==oppAxisRangeOpts.rangemode){var range0OppAxis=oppAxisOpts.r2l(oppAxisRangeOpts.range[0]),distOppAxis=oppAxisOpts.r2l(oppAxisRangeOpts.range[1])-range0OppAxis;opts.d2pOppAxis=function(v){return(v-range0OppAxis)/distOppAxis*opts._height}}rangeSlider.call(drawBg,gd,axisOpts,opts).call(addClipPath,gd,axisOpts,opts).call(drawRangePlot,gd,axisOpts,opts).call(drawMasks,gd,axisOpts,opts,oppAxisRangeOpts).call(drawSlideBox,gd,axisOpts,opts).call(drawGrabbers,gd,axisOpts,opts),function setupDragElement(rangeSlider,gd,axisOpts,opts){var slideBox=rangeSlider.select("rect."+constants.slideBoxClassName).node(),grabAreaMin=rangeSlider.select("rect."+constants.grabAreaMinClassName).node(),grabAreaMax=rangeSlider.select("rect."+constants.grabAreaMaxClassName).node();rangeSlider.on("mousedown",function(){var event=d3.event,target=event.target,startX=event.clientX,offsetX=startX-rangeSlider.node().getBoundingClientRect().left,minVal=opts.d2p(axisOpts._rl[0]),maxVal=opts.d2p(axisOpts._rl[1]),dragCover=dragElement.coverSlip();function mouseMove(e){var pixelMin,pixelMax,cursor,delta=+e.clientX-startX;switch(target){case slideBox:cursor="ew-resize",pixelMin=minVal+delta,pixelMax=maxVal+delta;break;case grabAreaMin:cursor="col-resize",pixelMin=minVal+delta,pixelMax=maxVal;break;case grabAreaMax:cursor="col-resize",pixelMin=minVal,pixelMax=maxVal+delta;break;default:cursor="ew-resize",pixelMin=offsetX,pixelMax=offsetX+delta}if(pixelMax<pixelMin){var tmp=pixelMax;pixelMax=pixelMin,pixelMin=tmp}opts._pixelMin=pixelMin,opts._pixelMax=pixelMax,setCursor(d3.select(dragCover),cursor),function setDataRange(rangeSlider,gd,axisOpts,opts){function clamp(v){return axisOpts.l2r(Lib.constrain(v,opts._rl[0],opts._rl[1]))}var dataMin=clamp(opts.p2d(opts._pixelMin)),dataMax=clamp(opts.p2d(opts._pixelMax));window.requestAnimationFrame(function(){Registry.call("relayout",gd,axisOpts._name+".range",[dataMin,dataMax])})}(0,gd,axisOpts,opts)}dragCover.addEventListener("mousemove",mouseMove),dragCover.addEventListener("mouseup",function mouseUp(){dragCover.removeEventListener("mousemove",mouseMove);dragCover.removeEventListener("mouseup",mouseUp);Lib.removeElement(dragCover)})})}(rangeSlider,gd,axisOpts,opts),function setPixelRange(rangeSlider,gd,axisOpts,opts,oppAxisOpts,oppAxisRangeOpts){var hw2=constants.handleWidth/2;function clamp(v){return Lib.constrain(v,0,opts._width)}function clampOppAxis(v){return Lib.constrain(v,0,opts._height)}function clampHandle(v){return Lib.constrain(v,-hw2,opts._width+hw2)}var pixelMin=clamp(opts.d2p(axisOpts._rl[0])),pixelMax=clamp(opts.d2p(axisOpts._rl[1]));if(rangeSlider.select("rect."+constants.slideBoxClassName).attr("x",pixelMin).attr("width",pixelMax-pixelMin),rangeSlider.select("rect."+constants.maskMinClassName).attr("width",pixelMin),rangeSlider.select("rect."+constants.maskMaxClassName).attr("x",pixelMax).attr("width",opts._width-pixelMax),"match"!==oppAxisRangeOpts.rangemode){var pixelMinOppAxis=opts._height-clampOppAxis(opts.d2pOppAxis(oppAxisOpts._rl[1])),pixelMaxOppAxis=opts._height-clampOppAxis(opts.d2pOppAxis(oppAxisOpts._rl[0]));rangeSlider.select("rect."+constants.maskMinOppAxisClassName).attr("x",pixelMin).attr("height",pixelMinOppAxis).attr("width",pixelMax-pixelMin),rangeSlider.select("rect."+constants.maskMaxOppAxisClassName).attr("x",pixelMin).attr("y",pixelMaxOppAxis).attr("height",opts._height-pixelMaxOppAxis).attr("width",pixelMax-pixelMin),rangeSlider.select("rect."+constants.slideBoxClassName).attr("y",pixelMinOppAxis).attr("height",pixelMaxOppAxis-pixelMinOppAxis)}var xMin=Math.round(clampHandle(pixelMin-hw2))-.5,xMax=Math.round(clampHandle(pixelMax-hw2))+.5;rangeSlider.select("g."+constants.grabberMinClassName).attr("transform","translate("+xMin+",0.5)"),rangeSlider.select("g."+constants.grabberMaxClassName).attr("transform","translate("+xMax+",0.5)")}(rangeSlider,0,axisOpts,opts,oppAxisOpts,oppAxisRangeOpts),"bottom"===axisOpts.side&&Titles.draw(gd,axisOpts._id+"title",{propContainer:axisOpts,propName:axisOpts._name+".title",placeholder:fullLayout._dfltTitle.x,attributes:{x:axisOpts._offset+axisOpts._length/2,y:y+opts._height+opts._offsetShift+10+1.5*axisOpts.titlefont.size,"text-anchor":"middle"}}),Plots.autoMargin(gd,opts._id,{x:domain[0],y:oppBottom,l:0,r:0,t:0,b:opts._height+margin.b+tickHeight,pad:constants.extraPad+2*opts._offsetShift})})}},{"../../lib":693,"../../lib/setcursor":714,"../../plots/cartesian":753,"../../plots/cartesian/axes":742,"../../plots/plots":805,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"../titles":658,"./constants":641,d3:147}],644:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attrs=_dereq_("./attributes"),oppAxisAttrs=_dereq_("./oppaxis_attributes");module.exports={moduleType:"component",name:"rangeslider",schema:{subplots:{xaxis:{rangeslider:Lib.extendFlat({},attrs,{yaxis:oppAxisAttrs})}}},layoutAttributes:_dereq_("./attributes"),handleDefaults:_dereq_("./defaults"),calcAutorange:_dereq_("./calc_autorange"),draw:_dereq_("./draw")}},{"../../lib":693,"./attributes":639,"./calc_autorange":640,"./defaults":642,"./draw":643,"./oppaxis_attributes":645}],645:[function(_dereq_,module,exports){"use strict";module.exports={_isSubplotObj:!0,rangemode:{valType:"enumerated",values:["auto","fixed","match"],dflt:"match",editType:"calc"},range:{valType:"info_array",items:[{valType:"any",editType:"plot"},{valType:"any",editType:"plot"}],editType:"plot"},editType:"calc"}},{}],646:[function(_dereq_,module,exports){"use strict";var annAttrs=_dereq_("../annotations/attributes"),scatterLineAttrs=_dereq_("../../traces/scatter/attributes").line,dash=_dereq_("../drawing/attributes").dash,extendFlat=_dereq_("../../lib/extend").extendFlat,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;module.exports=templatedArray("shape",{visible:{valType:"boolean",dflt:!0,editType:"calc+arraydraw"},type:{valType:"enumerated",values:["circle","rect","path","line"],editType:"calc+arraydraw"},layer:{valType:"enumerated",values:["below","above"],dflt:"above",editType:"arraydraw"},xref:extendFlat({},annAttrs.xref,{}),xsizemode:{valType:"enumerated",values:["scaled","pixel"],dflt:"scaled",editType:"calc+arraydraw"},xanchor:{valType:"any",editType:"calc+arraydraw"},x0:{valType:"any",editType:"calc+arraydraw"},x1:{valType:"any",editType:"calc+arraydraw"},yref:extendFlat({},annAttrs.yref,{}),ysizemode:{valType:"enumerated",values:["scaled","pixel"],dflt:"scaled",editType:"calc+arraydraw"},yanchor:{valType:"any",editType:"calc+arraydraw"},y0:{valType:"any",editType:"calc+arraydraw"},y1:{valType:"any",editType:"calc+arraydraw"},path:{valType:"string",editType:"calc+arraydraw"},opacity:{valType:"number",min:0,max:1,dflt:1,editType:"arraydraw"},line:{color:extendFlat({},scatterLineAttrs.color,{editType:"arraydraw"}),width:extendFlat({},scatterLineAttrs.width,{editType:"calc+arraydraw"}),dash:extendFlat({},dash,{editType:"arraydraw"}),editType:"calc+arraydraw"},fillcolor:{valType:"color",dflt:"rgba(0,0,0,0)",editType:"arraydraw"},editType:"arraydraw"})},{"../../lib/extend":682,"../../plot_api/plot_template":732,"../../traces/scatter/attributes":1032,"../annotations/attributes":550,"../drawing/attributes":591}],647:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),constants=_dereq_("./constants"),helpers=_dereq_("./helpers");function calcXPaddingOptions(shape){return calcPaddingOptions(shape.line.width,shape.xsizemode,shape.x0,shape.x1,shape.path,!1)}function calcYPaddingOptions(shape){return calcPaddingOptions(shape.line.width,shape.ysizemode,shape.y0,shape.y1,shape.path,!0)}function calcPaddingOptions(lineWidth,sizeMode,v0,v1,path,isYAxis){var ppad=lineWidth/2,axisDirectionReverted=isYAxis;if("pixel"===sizeMode){var coords=path?helpers.extractPathCoords(path,isYAxis?constants.paramIsY:constants.paramIsX):[v0,v1],maxValue=Lib.aggNums(Math.max,null,coords),minValue=Lib.aggNums(Math.min,null,coords),beforePad=minValue<0?Math.abs(minValue)+ppad:ppad,afterPad=maxValue>0?maxValue+ppad:ppad;return{ppad:ppad,ppadplus:axisDirectionReverted?beforePad:afterPad,ppadminus:axisDirectionReverted?afterPad:beforePad}}return{ppad:ppad}}function shapeBounds(ax,v0,v1,path,paramsToUse){var convertVal="category"===ax.type?ax.r2c:ax.d2c;if(void 0!==v0)return[convertVal(v0),convertVal(v1)];if(path){var i,drawnParam,params,val,min=1/0,max=-1/0,segments=path.match(constants.segmentRE);for("date"===ax.type&&(convertVal=helpers.decodeDate(convertVal)),i=0;i<segments.length;i++)void 0!==(drawnParam=paramsToUse[segments[i].charAt(0)].drawn)&&(!(params=segments[i].substr(1).match(constants.paramRE))||params.length<drawnParam||((val=convertVal(params[drawnParam]))<min&&(min=val),val>max&&(max=val)));return max>=min?[min,max]:void 0}}module.exports=function calcAutorange(gd){var fullLayout=gd._fullLayout,shapeList=Lib.filterVisible(fullLayout.shapes);if(shapeList.length&&gd._fullData.length)for(var i=0;i<shapeList.length;i++){var ax,bounds,shape=shapeList[i];if(shape._extremes={},"paper"!==shape.xref){var vx0="pixel"===shape.xsizemode?shape.xanchor:shape.x0,vx1="pixel"===shape.xsizemode?shape.xanchor:shape.x1;(bounds=shapeBounds(ax=Axes.getFromId(gd,shape.xref),vx0,vx1,shape.path,constants.paramIsX))&&(shape._extremes[ax._id]=Axes.findExtremes(ax,bounds,calcXPaddingOptions(shape)))}if("paper"!==shape.yref){var vy0="pixel"===shape.ysizemode?shape.yanchor:shape.y0,vy1="pixel"===shape.ysizemode?shape.yanchor:shape.y1;(bounds=shapeBounds(ax=Axes.getFromId(gd,shape.yref),vy0,vy1,shape.path,constants.paramIsY))&&(shape._extremes[ax._id]=Axes.findExtremes(ax,bounds,calcYPaddingOptions(shape)))}}}},{"../../lib":693,"../../plots/cartesian/axes":742,"./constants":648,"./helpers":651}],648:[function(_dereq_,module,exports){"use strict";module.exports={segmentRE:/[MLHVQCTSZ][^MLHVQCTSZ]*/g,paramRE:/[^\s,]+/g,paramIsX:{M:{0:!0,drawn:0},L:{0:!0,drawn:0},H:{0:!0,drawn:0},V:{},Q:{0:!0,2:!0,drawn:2},C:{0:!0,2:!0,4:!0,drawn:4},T:{0:!0,drawn:0},S:{0:!0,2:!0,drawn:2},Z:{}},paramIsY:{M:{1:!0,drawn:1},L:{1:!0,drawn:1},H:{},V:{0:!0,drawn:0},Q:{1:!0,3:!0,drawn:3},C:{1:!0,3:!0,5:!0,drawn:5},T:{1:!0,drawn:1},S:{1:!0,3:!0,drawn:5},Z:{}},numParams:{M:2,L:2,H:1,V:1,Q:4,C:6,T:2,S:4,Z:0}}},{}],649:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),helpers=_dereq_("./helpers");function handleShapeDefaults(shapeIn,shapeOut,fullLayout){function coerce(attr,dflt){return Lib.coerce(shapeIn,shapeOut,attributes,attr,dflt)}if(coerce("visible")){coerce("layer"),coerce("opacity"),coerce("fillcolor"),coerce("line.color"),coerce("line.width"),coerce("line.dash");for(var shapeType=coerce("type",shapeIn.path?"path":"rect"),xSizeMode=coerce("xsizemode"),ySizeMode=coerce("ysizemode"),axLetters=["x","y"],i=0;i<2;i++){var ax,pos2r,r2pos,axLetter=axLetters[i],attrAnchor=axLetter+"anchor",sizeMode="x"===axLetter?xSizeMode:ySizeMode,gdMock={_fullLayout:fullLayout},axRef=Axes.coerceRef(shapeIn,shapeOut,gdMock,axLetter,"","paper");if("paper"!==axRef?((ax=Axes.getFromId(gdMock,axRef))._shapeIndices.push(shapeOut._index),r2pos=helpers.rangeToShapePosition(ax),pos2r=helpers.shapePositionToRange(ax)):pos2r=r2pos=Lib.identity,"path"!==shapeType){var attr0=axLetter+"0",attr1=axLetter+"1",in0=shapeIn[attr0],in1=shapeIn[attr1];shapeIn[attr0]=pos2r(shapeIn[attr0],!0),shapeIn[attr1]=pos2r(shapeIn[attr1],!0),"pixel"===sizeMode?(coerce(attr0,0),coerce(attr1,10)):(Axes.coercePosition(shapeOut,gdMock,coerce,axRef,attr0,.25),Axes.coercePosition(shapeOut,gdMock,coerce,axRef,attr1,.75)),shapeOut[attr0]=r2pos(shapeOut[attr0]),shapeOut[attr1]=r2pos(shapeOut[attr1]),shapeIn[attr0]=in0,shapeIn[attr1]=in1}if("pixel"===sizeMode){var inAnchor=shapeIn[attrAnchor];shapeIn[attrAnchor]=pos2r(shapeIn[attrAnchor],!0),Axes.coercePosition(shapeOut,gdMock,coerce,axRef,attrAnchor,.25),shapeOut[attrAnchor]=r2pos(shapeOut[attrAnchor]),shapeIn[attrAnchor]=inAnchor}}"path"===shapeType?coerce("path"):Lib.noneOrAll(shapeIn,shapeOut,["x0","x1","y0","y1"])}}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut){handleArrayContainerDefaults(layoutIn,layoutOut,{name:"shapes",handleItemDefaults:handleShapeDefaults})}},{"../../lib":693,"../../plots/array_container_defaults":738,"../../plots/cartesian/axes":742,"./attributes":646,"./helpers":651}],650:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),arrayEditor=_dereq_("../../plot_api/plot_template").arrayEditor,dragElement=_dereq_("../dragelement"),setCursor=_dereq_("../../lib/setcursor"),constants=_dereq_("./constants"),helpers=_dereq_("./helpers");function drawOne(gd,index){gd._fullLayout._paperdiv.selectAll('.shapelayer [data-index="'+index+'"]').remove();var options=gd._fullLayout.shapes[index]||{};if(options._input&&!1!==options.visible)if("below"!==options.layer)drawShape(gd._fullLayout._shapeUpperLayer);else if("paper"===options.xref||"paper"===options.yref)drawShape(gd._fullLayout._shapeLowerLayer);else{var plotinfo=gd._fullLayout._plots[options.xref+options.yref];if(plotinfo)drawShape((plotinfo.mainplotinfo||plotinfo).shapelayer);else drawShape(gd._fullLayout._shapeLowerLayer)}function drawShape(shapeLayer){var attrs={"data-index":index,"fill-rule":"evenodd",d:getPathString(gd,options)},lineColor=options.line.width?options.line.color:"rgba(0,0,0,0)",path=shapeLayer.append("path").attr(attrs).style("opacity",options.opacity).call(Color.stroke,lineColor).call(Color.fill,options.fillcolor).call(Drawing.dashLine,options.line.dash,options.line.width);setClipPath(path,gd,options),gd._context.edits.shapePosition&&function setupDragElement(gd,shapePath,shapeOptions,index,shapeLayer){var x0,y0,x1,y1,xAnchor,yAnchor,n0,s0,w0,e0,optN,optS,optW,optE,pathIn,dragMode,MINWIDTH=10,MINHEIGHT=10,xPixelSized="pixel"===shapeOptions.xsizemode,yPixelSized="pixel"===shapeOptions.ysizemode,isLine="line"===shapeOptions.type,isPath="path"===shapeOptions.type,editHelpers=arrayEditor(gd.layout,"shapes",shapeOptions),modifyItem=editHelpers.modifyItem,xa=Axes.getFromId(gd,shapeOptions.xref),ya=Axes.getFromId(gd,shapeOptions.yref),x2p=helpers.getDataToPixel(gd,xa),y2p=helpers.getDataToPixel(gd,ya,!0),p2x=helpers.getPixelToData(gd,xa),p2y=helpers.getPixelToData(gd,ya,!0),sensoryElement=function obtainSensoryElement(){return isLine?function createLineDragHandles(){var sensoryWidth=Math.max(shapeOptions.line.width,10),g=shapeLayer.append("g").attr("data-index",index);g.append("path").attr("d",shapePath.attr("d")).style({cursor:"move","stroke-width":sensoryWidth,"stroke-opacity":"0"});var circleStyle={"fill-opacity":"0"},circleRadius=sensoryWidth/2>10?sensoryWidth/2:10;return g.append("circle").attr({"data-line-point":"start-point",cx:xPixelSized?x2p(shapeOptions.xanchor)+shapeOptions.x0:x2p(shapeOptions.x0),cy:yPixelSized?y2p(shapeOptions.yanchor)-shapeOptions.y0:y2p(shapeOptions.y0),r:circleRadius}).style(circleStyle).classed("cursor-grab",!0),g.append("circle").attr({"data-line-point":"end-point",cx:xPixelSized?x2p(shapeOptions.xanchor)+shapeOptions.x1:x2p(shapeOptions.x1),cy:yPixelSized?y2p(shapeOptions.yanchor)-shapeOptions.y1:y2p(shapeOptions.y1),r:circleRadius}).style(circleStyle).classed("cursor-grab",!0),g}():shapePath}(),dragOptions={element:sensoryElement.node(),gd:gd,prepFn:function startDrag(evt){xPixelSized&&(xAnchor=x2p(shapeOptions.xanchor));yPixelSized&&(yAnchor=y2p(shapeOptions.yanchor));"path"===shapeOptions.type?pathIn=shapeOptions.path:(x0=xPixelSized?shapeOptions.x0:x2p(shapeOptions.x0),y0=yPixelSized?shapeOptions.y0:y2p(shapeOptions.y0),x1=xPixelSized?shapeOptions.x1:x2p(shapeOptions.x1),y1=yPixelSized?shapeOptions.y1:y2p(shapeOptions.y1));x0<x1?(w0=x0,optW="x0",e0=x1,optE="x1"):(w0=x1,optW="x1",e0=x0,optE="x0");!yPixelSized&&y0<y1||yPixelSized&&y0>y1?(n0=y0,optN="y0",s0=y1,optS="y1"):(n0=y1,optN="y1",s0=y0,optS="y0");updateDragMode(evt),renderVisualCues(shapeLayer,shapeOptions),function deactivateClipPathTemporarily(shapePath,shapeOptions,gd){var xref=shapeOptions.xref,yref=shapeOptions.yref,xa=Axes.getFromId(gd,xref),ya=Axes.getFromId(gd,yref),clipAxes="";"paper"===xref||xa.autorange||(clipAxes+=xref);"paper"===yref||ya.autorange||(clipAxes+=yref);shapePath.call(Drawing.setClipUrl,clipAxes?"clip"+gd._fullLayout._uid+clipAxes:null)}(shapePath,shapeOptions,gd),dragOptions.moveFn="move"===dragMode?moveShape:resizeShape},doneFn:function endDrag(){setCursor(shapePath),removeVisualCues(shapeLayer),setClipPath(shapePath,gd,shapeOptions),Registry.call("relayout",gd,editHelpers.getUpdateObj())},clickFn:function abortDrag(){removeVisualCues(shapeLayer)}};function updateDragMode(evt){if(isLine)dragMode="path"===evt.target.tagName?"move":"start-point"===evt.target.attributes["data-line-point"].value?"resize-over-start-point":"resize-over-end-point";else{var dragBBox=dragOptions.element.getBoundingClientRect(),w=dragBBox.right-dragBBox.left,h=dragBBox.bottom-dragBBox.top,x=evt.clientX-dragBBox.left,y=evt.clientY-dragBBox.top,cursor=!isPath&&w>MINWIDTH&&h>MINHEIGHT&&!evt.shiftKey?dragElement.getCursor(x/w,1-y/h):"move";setCursor(shapePath,cursor),dragMode=cursor.split("-")[0]}}function moveShape(dx,dy){if("path"===shapeOptions.type){var noOp=function(coord){return coord},moveX=noOp,moveY=noOp;xPixelSized?modifyItem("xanchor",shapeOptions.xanchor=p2x(xAnchor+dx)):(moveX=function moveX(x){return p2x(x2p(x)+dx)},xa&&"date"===xa.type&&(moveX=helpers.encodeDate(moveX))),yPixelSized?modifyItem("yanchor",shapeOptions.yanchor=p2y(yAnchor+dy)):(moveY=function moveY(y){return p2y(y2p(y)+dy)},ya&&"date"===ya.type&&(moveY=helpers.encodeDate(moveY))),modifyItem("path",shapeOptions.path=movePath(pathIn,moveX,moveY))}else xPixelSized?modifyItem("xanchor",shapeOptions.xanchor=p2x(xAnchor+dx)):(modifyItem("x0",shapeOptions.x0=p2x(x0+dx)),modifyItem("x1",shapeOptions.x1=p2x(x1+dx))),yPixelSized?modifyItem("yanchor",shapeOptions.yanchor=p2y(yAnchor+dy)):(modifyItem("y0",shapeOptions.y0=p2y(y0+dy)),modifyItem("y1",shapeOptions.y1=p2y(y1+dy)));shapePath.attr("d",getPathString(gd,shapeOptions)),renderVisualCues(shapeLayer,shapeOptions)}function resizeShape(dx,dy){if(isPath){var noOp=function(coord){return coord},moveX=noOp,moveY=noOp;xPixelSized?modifyItem("xanchor",shapeOptions.xanchor=p2x(xAnchor+dx)):(moveX=function moveX(x){return p2x(x2p(x)+dx)},xa&&"date"===xa.type&&(moveX=helpers.encodeDate(moveX))),yPixelSized?modifyItem("yanchor",shapeOptions.yanchor=p2y(yAnchor+dy)):(moveY=function moveY(y){return p2y(y2p(y)+dy)},ya&&"date"===ya.type&&(moveY=helpers.encodeDate(moveY))),modifyItem("path",shapeOptions.path=movePath(pathIn,moveX,moveY))}else if(isLine){if("resize-over-start-point"===dragMode){var newX0=x0+dx,newY0=yPixelSized?y0-dy:y0+dy;modifyItem("x0",shapeOptions.x0=xPixelSized?newX0:p2x(newX0)),modifyItem("y0",shapeOptions.y0=yPixelSized?newY0:p2y(newY0))}else if("resize-over-end-point"===dragMode){var newX1=x1+dx,newY1=yPixelSized?y1-dy:y1+dy;modifyItem("x1",shapeOptions.x1=xPixelSized?newX1:p2x(newX1)),modifyItem("y1",shapeOptions.y1=yPixelSized?newY1:p2y(newY1))}}else{var newN=~dragMode.indexOf("n")?n0+dy:n0,newS=~dragMode.indexOf("s")?s0+dy:s0,newW=~dragMode.indexOf("w")?w0+dx:w0,newE=~dragMode.indexOf("e")?e0+dx:e0;~dragMode.indexOf("n")&&yPixelSized&&(newN=n0-dy),~dragMode.indexOf("s")&&yPixelSized&&(newS=s0-dy),(!yPixelSized&&newS-newN>MINHEIGHT||yPixelSized&&newN-newS>MINHEIGHT)&&(modifyItem(optN,shapeOptions[optN]=yPixelSized?newN:p2y(newN)),modifyItem(optS,shapeOptions[optS]=yPixelSized?newS:p2y(newS))),newE-newW>MINWIDTH&&(modifyItem(optW,shapeOptions[optW]=xPixelSized?newW:p2x(newW)),modifyItem(optE,shapeOptions[optE]=xPixelSized?newE:p2x(newE)))}shapePath.attr("d",getPathString(gd,shapeOptions)),renderVisualCues(shapeLayer,shapeOptions)}function renderVisualCues(shapeLayer,shapeOptions){(xPixelSized||yPixelSized)&&function renderAnchor(){var isNotPath="path"!==shapeOptions.type,visualCues=shapeLayer.selectAll(".visual-cue").data([0]);visualCues.enter().append("path").attr({fill:"#fff","fill-rule":"evenodd",stroke:"#000","stroke-width":1}).classed("visual-cue",!0);var posX=x2p(xPixelSized?shapeOptions.xanchor:Lib.midRange(isNotPath?[shapeOptions.x0,shapeOptions.x1]:helpers.extractPathCoords(shapeOptions.path,constants.paramIsX))),posY=y2p(yPixelSized?shapeOptions.yanchor:Lib.midRange(isNotPath?[shapeOptions.y0,shapeOptions.y1]:helpers.extractPathCoords(shapeOptions.path,constants.paramIsY)));if(posX=helpers.roundPositionForSharpStrokeRendering(posX,1),posY=helpers.roundPositionForSharpStrokeRendering(posY,1),xPixelSized&&yPixelSized){var crossPath="M"+(posX-1-1)+","+(posY-1-1)+"h-8v2h8 v8h2v-8 h8v-2h-8 v-8h-2 Z";visualCues.attr("d",crossPath)}else if(xPixelSized){var vBarPath="M"+(posX-1-1)+","+(posY-9-1)+"v18 h2 v-18 Z";visualCues.attr("d",vBarPath)}else{var hBarPath="M"+(posX-9-1)+","+(posY-1-1)+"h18 v2 h-18 Z";visualCues.attr("d",hBarPath)}}()}function removeVisualCues(shapeLayer){shapeLayer.selectAll(".visual-cue").remove()}dragElement.init(dragOptions),sensoryElement.node().onmousemove=updateDragMode}(gd,path,options,index,shapeLayer)}}function setClipPath(shapePath,gd,shapeOptions){var clipAxes=(shapeOptions.xref+shapeOptions.yref).replace(/paper/g,"");shapePath.call(Drawing.setClipUrl,clipAxes?"clip"+gd._fullLayout._uid+clipAxes:null)}function getPathString(gd,options){var x2r,x2p,y2r,y2p,x0,x1,y0,y1,type=options.type,xa=Axes.getFromId(gd,options.xref),ya=Axes.getFromId(gd,options.yref),gs=gd._fullLayout._size;if(xa?(x2r=helpers.shapePositionToRange(xa),x2p=function(v){return xa._offset+xa.r2p(x2r(v,!0))}):x2p=function(v){return gs.l+gs.w*v},ya?(y2r=helpers.shapePositionToRange(ya),y2p=function(v){return ya._offset+ya.r2p(y2r(v,!0))}):y2p=function(v){return gs.t+gs.h*(1-v)},"path"===type)return xa&&"date"===xa.type&&(x2p=helpers.decodeDate(x2p)),ya&&"date"===ya.type&&(y2p=helpers.decodeDate(y2p)),function convertPath(options,x2p,y2p){var pathIn=options.path,xSizemode=options.xsizemode,ySizemode=options.ysizemode,xAnchor=options.xanchor,yAnchor=options.yanchor;return pathIn.replace(constants.segmentRE,function(segment){var paramNumber=0,segmentType=segment.charAt(0),xParams=constants.paramIsX[segmentType],yParams=constants.paramIsY[segmentType],nParams=constants.numParams[segmentType],paramString=segment.substr(1).replace(constants.paramRE,function(param){return xParams[paramNumber]?param="pixel"===xSizemode?x2p(xAnchor)+Number(param):x2p(param):yParams[paramNumber]&&(param="pixel"===ySizemode?y2p(yAnchor)-Number(param):y2p(param)),++paramNumber>nParams&&(param="X"),param});return paramNumber>nParams&&(paramString=paramString.replace(/[\s,]*X.*/,""),Lib.log("Ignoring extra params in segment "+segment)),segmentType+paramString})}(options,x2p,y2p);if("pixel"===options.xsizemode){var xAnchorPos=x2p(options.xanchor);x0=xAnchorPos+options.x0,x1=xAnchorPos+options.x1}else x0=x2p(options.x0),x1=x2p(options.x1);if("pixel"===options.ysizemode){var yAnchorPos=y2p(options.yanchor);y0=yAnchorPos-options.y0,y1=yAnchorPos-options.y1}else y0=y2p(options.y0),y1=y2p(options.y1);if("line"===type)return"M"+x0+","+y0+"L"+x1+","+y1;if("rect"===type)return"M"+x0+","+y0+"H"+x1+"V"+y1+"H"+x0+"Z";var cx=(x0+x1)/2,cy=(y0+y1)/2,rx=Math.abs(cx-x0),ry=Math.abs(cy-y0),rArc="A"+rx+","+ry,rightPt=cx+rx+","+cy;return"M"+rightPt+rArc+" 0 1,1 "+(cx+","+(cy-ry))+rArc+" 0 0,1 "+rightPt+"Z"}function movePath(pathIn,moveX,moveY){return pathIn.replace(constants.segmentRE,function(segment){var paramNumber=0,segmentType=segment.charAt(0),xParams=constants.paramIsX[segmentType],yParams=constants.paramIsY[segmentType],nParams=constants.numParams[segmentType];return segmentType+segment.substr(1).replace(constants.paramRE,function(param){return paramNumber>=nParams?param:(xParams[paramNumber]?param=moveX(param):yParams[paramNumber]&&(param=moveY(param)),paramNumber++,param)})})}module.exports={draw:function draw(gd){var fullLayout=gd._fullLayout;for(var k in fullLayout._shapeUpperLayer.selectAll("path").remove(),fullLayout._shapeLowerLayer.selectAll("path").remove(),fullLayout._plots){var shapelayer=fullLayout._plots[k].shapelayer;shapelayer&&shapelayer.selectAll("path").remove()}for(var i=0;i<fullLayout.shapes.length;i++)fullLayout.shapes[i].visible&&drawOne(gd,i)},drawOne:drawOne}},{"../../lib":693,"../../lib/setcursor":714,"../../plot_api/plot_template":732,"../../plots/cartesian/axes":742,"../../registry":825,"../color":567,"../dragelement":589,"../drawing":592,"./constants":648,"./helpers":651}],651:[function(_dereq_,module,exports){"use strict";var constants=_dereq_("./constants"),Lib=_dereq_("../../lib");exports.rangeToShapePosition=function(ax){return"log"===ax.type?ax.r2d:function(v){return v}},exports.shapePositionToRange=function(ax){return"log"===ax.type?ax.d2r:function(v){return v}},exports.decodeDate=function(convertToPx){return function(v){return v.replace&&(v=v.replace("_"," ")),convertToPx(v)}},exports.encodeDate=function(convertToDate){return function(v){return convertToDate(v).replace(" ","_")}},exports.extractPathCoords=function(path,paramsToUse){var extractedCoordinates=[];return path.match(constants.segmentRE).forEach(function(segment){var relevantParamIdx=paramsToUse[segment.charAt(0)].drawn;if(void 0!==relevantParamIdx){var params=segment.substr(1).match(constants.paramRE);!params||params.length<relevantParamIdx||extractedCoordinates.push(Lib.cleanNumber(params[relevantParamIdx]))}}),extractedCoordinates},exports.getDataToPixel=function(gd,axis,isVertical){var dataToPixel,gs=gd._fullLayout._size;if(axis){var d2r=exports.shapePositionToRange(axis);dataToPixel=function(v){return axis._offset+axis.r2p(d2r(v,!0))},"date"===axis.type&&(dataToPixel=exports.decodeDate(dataToPixel))}else dataToPixel=isVertical?function(v){return gs.t+gs.h*(1-v)}:function(v){return gs.l+gs.w*v};return dataToPixel},exports.getPixelToData=function(gd,axis,isVertical){var pixelToData,gs=gd._fullLayout._size;if(axis){var r2d=exports.rangeToShapePosition(axis);pixelToData=function(p){return r2d(axis.p2r(p-axis._offset))}}else pixelToData=isVertical?function(p){return 1-(p-gs.t)/gs.h}:function(p){return(p-gs.l)/gs.w};return pixelToData},exports.roundPositionForSharpStrokeRendering=function(pos,strokeWidth){var strokeWidthIsOdd=1===Math.round(strokeWidth%2),posValAsInt=Math.round(pos);return strokeWidthIsOdd?posValAsInt+.5:posValAsInt}},{"../../lib":693,"./constants":648}],652:[function(_dereq_,module,exports){"use strict";var drawModule=_dereq_("./draw");module.exports={moduleType:"component",name:"shapes",layoutAttributes:_dereq_("./attributes"),supplyLayoutDefaults:_dereq_("./defaults"),includeBasePlot:_dereq_("../../plots/cartesian/include_components")("shapes"),calcAutorange:_dereq_("./calc_autorange"),draw:drawModule.draw,drawOne:drawModule.drawOne}},{"../../plots/cartesian/include_components":752,"./attributes":646,"./calc_autorange":647,"./defaults":649,"./draw":650}],653:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),padAttrs=_dereq_("../../plots/pad_attributes"),extendDeepAll=_dereq_("../../lib/extend").extendDeepAll,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,animationAttrs=_dereq_("../../plots/animation_attributes"),templatedArray=_dereq_("../../plot_api/plot_template").templatedArray,constants=_dereq_("./constants"),stepsAttrs=templatedArray("step",{visible:{valType:"boolean",dflt:!0},method:{valType:"enumerated",values:["restyle","relayout","animate","update","skip"],dflt:"restyle"},args:{valType:"info_array",freeLength:!0,items:[{valType:"any"},{valType:"any"},{valType:"any"}]},label:{valType:"string"},value:{valType:"string"},execute:{valType:"boolean",dflt:!0}});module.exports=overrideAll(templatedArray("slider",{visible:{valType:"boolean",dflt:!0},active:{valType:"number",min:0,dflt:0},steps:stepsAttrs,lenmode:{valType:"enumerated",values:["fraction","pixels"],dflt:"fraction"},len:{valType:"number",min:0,dflt:1},x:{valType:"number",min:-2,max:3,dflt:0},pad:extendDeepAll({},padAttrs,{},{t:{dflt:20}}),xanchor:{valType:"enumerated",values:["auto","left","center","right"],dflt:"left"},y:{valType:"number",min:-2,max:3,dflt:0},yanchor:{valType:"enumerated",values:["auto","top","middle","bottom"],dflt:"top"},transition:{duration:{valType:"number",min:0,dflt:150},easing:{valType:"enumerated",values:animationAttrs.transition.easing.values,dflt:"cubic-in-out"}},currentvalue:{visible:{valType:"boolean",dflt:!0},xanchor:{valType:"enumerated",values:["left","center","right"],dflt:"left"},offset:{valType:"number",dflt:10},prefix:{valType:"string"},suffix:{valType:"string"},font:fontAttrs({})},font:fontAttrs({}),activebgcolor:{valType:"color",dflt:constants.gripBgActiveColor},bgcolor:{valType:"color",dflt:constants.railBgColor},bordercolor:{valType:"color",dflt:constants.railBorderColor},borderwidth:{valType:"number",min:0,dflt:constants.railBorderWidth},ticklen:{valType:"number",min:0,dflt:constants.tickLength},tickcolor:{valType:"color",dflt:constants.tickColor},tickwidth:{valType:"number",min:0,dflt:1},minorticklen:{valType:"number",min:0,dflt:constants.minorTickLength}}),"arraydraw","from-root")},{"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plot_api/plot_template":732,"../../plots/animation_attributes":737,"../../plots/font_attributes":768,"../../plots/pad_attributes":804,"./constants":654}],654:[function(_dereq_,module,exports){"use strict";module.exports={name:"sliders",containerClassName:"slider-container",groupClassName:"slider-group",inputAreaClass:"slider-input-area",railRectClass:"slider-rail-rect",railTouchRectClass:"slider-rail-touch-rect",gripRectClass:"slider-grip-rect",tickRectClass:"slider-tick-rect",inputProxyClass:"slider-input-proxy",labelsClass:"slider-labels",labelGroupClass:"slider-label-group",labelClass:"slider-label",currentValueClass:"slider-current-value",railHeight:5,menuIndexAttrName:"slider-active-index",autoMarginIdRoot:"slider-",minWidth:30,minHeight:30,textPadX:40,arrowOffsetX:4,railRadius:2,railWidth:5,railBorder:4,railBorderWidth:1,railBorderColor:"#bec8d9",railBgColor:"#f8fafc",railInset:8,stepInset:10,gripRadius:10,gripWidth:20,gripHeight:20,gripBorder:20,gripBorderWidth:1,gripBorderColor:"#bec8d9",gripBgColor:"#f6f8fa",gripBgActiveColor:"#dbdde0",labelPadding:8,labelOffset:0,tickWidth:1,tickColor:"#333",tickOffset:25,tickLength:7,minorTickOffset:25,minorTickColor:"#333",minorTickLength:4,currentValuePadding:8,currentValueInset:0}},{}],655:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),name=_dereq_("./constants").name,stepAttrs=attributes.steps;function sliderDefaults(sliderIn,sliderOut,layoutOut){function coerce(attr,dflt){return Lib.coerce(sliderIn,sliderOut,attributes,attr,dflt)}for(var steps=handleArrayContainerDefaults(sliderIn,sliderOut,{name:"steps",handleItemDefaults:stepDefaults}),stepCount=0,i=0;i<steps.length;i++)steps[i].visible&&stepCount++;if(stepCount<2?sliderOut.visible=!1:coerce("visible")){sliderOut._stepCount=stepCount;var visSteps=sliderOut._visibleSteps=Lib.filterVisible(steps);(steps[coerce("active")]||{}).visible||(sliderOut.active=visSteps[0]._index),coerce("x"),coerce("y"),Lib.noneOrAll(sliderIn,sliderOut,["x","y"]),coerce("xanchor"),coerce("yanchor"),coerce("len"),coerce("lenmode"),coerce("pad.t"),coerce("pad.r"),coerce("pad.b"),coerce("pad.l"),Lib.coerceFont(coerce,"font",layoutOut.font),coerce("currentvalue.visible")&&(coerce("currentvalue.xanchor"),coerce("currentvalue.prefix"),coerce("currentvalue.suffix"),coerce("currentvalue.offset"),Lib.coerceFont(coerce,"currentvalue.font",sliderOut.font)),coerce("transition.duration"),coerce("transition.easing"),coerce("bgcolor"),coerce("activebgcolor"),coerce("bordercolor"),coerce("borderwidth"),coerce("ticklen"),coerce("tickwidth"),coerce("tickcolor"),coerce("minorticklen")}}function stepDefaults(valueIn,valueOut){function coerce(attr,dflt){return Lib.coerce(valueIn,valueOut,stepAttrs,attr,dflt)}("skip"===valueIn.method||Array.isArray(valueIn.args)?coerce("visible"):valueOut.visible=!1)&&(coerce("method"),coerce("args"),coerce("value",coerce("label","step-"+valueOut._index)),coerce("execute"))}module.exports=function slidersDefaults(layoutIn,layoutOut){handleArrayContainerDefaults(layoutIn,layoutOut,{name:name,handleItemDefaults:sliderDefaults})}},{"../../lib":693,"../../plots/array_container_defaults":738,"./attributes":653,"./constants":654}],656:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Plots=_dereq_("../../plots/plots"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),anchorUtils=_dereq_("../legend/anchor_utils"),arrayEditor=_dereq_("../../plot_api/plot_template").arrayEditor,constants=_dereq_("./constants"),alignmentConstants=_dereq_("../../constants/alignment"),LINE_SPACING=alignmentConstants.LINE_SPACING,FROM_TL=alignmentConstants.FROM_TL,FROM_BR=alignmentConstants.FROM_BR;function autoMarginId(sliderOpts){return constants.autoMarginIdRoot+sliderOpts._index}function keyFunction(opts){return opts._index}function findDimensions(gd,sliderOpts){var sliderLabels=Drawing.tester.selectAll("g."+constants.labelGroupClass).data(sliderOpts._visibleSteps);sliderLabels.enter().append("g").classed(constants.labelGroupClass,!0);var maxLabelWidth=0,labelHeight=0;sliderLabels.each(function(stepOpts){var textNode=drawLabel(d3.select(this),{step:stepOpts},sliderOpts).node();if(textNode){var bBox=Drawing.bBox(textNode);labelHeight=Math.max(labelHeight,bBox.height),maxLabelWidth=Math.max(maxLabelWidth,bBox.width)}}),sliderLabels.remove();var dims=sliderOpts._dims={};dims.inputAreaWidth=Math.max(constants.railWidth,constants.gripHeight);var graphSize=gd._fullLayout._size;dims.lx=graphSize.l+graphSize.w*sliderOpts.x,dims.ly=graphSize.t+graphSize.h*(1-sliderOpts.y),"fraction"===sliderOpts.lenmode?dims.outerLength=Math.round(graphSize.w*sliderOpts.len):dims.outerLength=sliderOpts.len,dims.inputAreaStart=0,dims.inputAreaLength=Math.round(dims.outerLength-sliderOpts.pad.l-sliderOpts.pad.r);var availableSpacePerLabel=(dims.inputAreaLength-2*constants.stepInset)/(sliderOpts._stepCount-1),computedSpacePerLabel=maxLabelWidth+constants.labelPadding;if(dims.labelStride=Math.max(1,Math.ceil(computedSpacePerLabel/availableSpacePerLabel)),dims.labelHeight=labelHeight,dims.currentValueMaxWidth=0,dims.currentValueHeight=0,dims.currentValueTotalHeight=0,dims.currentValueMaxLines=1,sliderOpts.currentvalue.visible){var dummyGroup=Drawing.tester.append("g");sliderLabels.each(function(stepOpts){var curValPrefix=drawCurrentValue(dummyGroup,sliderOpts,stepOpts.label),curValSize=curValPrefix.node()&&Drawing.bBox(curValPrefix.node())||{width:0,height:0},lines=svgTextUtils.lineCount(curValPrefix);dims.currentValueMaxWidth=Math.max(dims.currentValueMaxWidth,Math.ceil(curValSize.width)),dims.currentValueHeight=Math.max(dims.currentValueHeight,Math.ceil(curValSize.height)),dims.currentValueMaxLines=Math.max(dims.currentValueMaxLines,lines)}),dims.currentValueTotalHeight=dims.currentValueHeight+sliderOpts.currentvalue.offset,dummyGroup.remove()}dims.height=dims.currentValueTotalHeight+constants.tickOffset+sliderOpts.ticklen+constants.labelOffset+dims.labelHeight+sliderOpts.pad.t+sliderOpts.pad.b;var xanchor="left";anchorUtils.isRightAnchor(sliderOpts)&&(dims.lx-=dims.outerLength,xanchor="right"),anchorUtils.isCenterAnchor(sliderOpts)&&(dims.lx-=dims.outerLength/2,xanchor="center");var yanchor="top";anchorUtils.isBottomAnchor(sliderOpts)&&(dims.ly-=dims.height,yanchor="bottom"),anchorUtils.isMiddleAnchor(sliderOpts)&&(dims.ly-=dims.height/2,yanchor="middle"),dims.outerLength=Math.ceil(dims.outerLength),dims.height=Math.ceil(dims.height),dims.lx=Math.round(dims.lx),dims.ly=Math.round(dims.ly);var marginOpts={y:sliderOpts.y,b:dims.height*FROM_BR[yanchor],t:dims.height*FROM_TL[yanchor]};"fraction"===sliderOpts.lenmode?(marginOpts.l=0,marginOpts.xl=sliderOpts.x-sliderOpts.len*FROM_TL[xanchor],marginOpts.r=0,marginOpts.xr=sliderOpts.x+sliderOpts.len*FROM_BR[xanchor]):(marginOpts.x=sliderOpts.x,marginOpts.l=dims.outerLength*FROM_TL[xanchor],marginOpts.r=dims.outerLength*FROM_BR[xanchor]),Plots.autoMargin(gd,autoMarginId(sliderOpts),marginOpts)}function drawCurrentValue(sliderGroup,sliderOpts,valueOverride){if(sliderOpts.currentvalue.visible){var x0,textAnchor,dims=sliderOpts._dims;switch(sliderOpts.currentvalue.xanchor){case"right":x0=dims.inputAreaLength-constants.currentValueInset-dims.currentValueMaxWidth,textAnchor="left";break;case"center":x0=.5*dims.inputAreaLength,textAnchor="middle";break;default:x0=constants.currentValueInset,textAnchor="left"}var text=Lib.ensureSingle(sliderGroup,"text",constants.labelClass,function(s){s.classed("user-select-none",!0).attr({"text-anchor":textAnchor,"data-notex":1})}),str=sliderOpts.currentvalue.prefix?sliderOpts.currentvalue.prefix:"";if("string"==typeof valueOverride)str+=valueOverride;else str+=sliderOpts.steps[sliderOpts.active].label;sliderOpts.currentvalue.suffix&&(str+=sliderOpts.currentvalue.suffix),text.call(Drawing.font,sliderOpts.currentvalue.font).text(str).call(svgTextUtils.convertToTspans,sliderOpts._gd);var lines=svgTextUtils.lineCount(text),y0=(dims.currentValueMaxLines+1-lines)*sliderOpts.currentvalue.font.size*LINE_SPACING;return svgTextUtils.positionText(text,x0,y0),text}}function drawGrip(sliderGroup,gd,sliderOpts){Lib.ensureSingle(sliderGroup,"rect",constants.gripRectClass,function(s){s.call(attachGripEvents,gd,sliderGroup,sliderOpts).style("pointer-events","all")}).attr({width:constants.gripWidth,height:constants.gripHeight,rx:constants.gripRadius,ry:constants.gripRadius}).call(Color.stroke,sliderOpts.bordercolor).call(Color.fill,sliderOpts.bgcolor).style("stroke-width",sliderOpts.borderwidth+"px")}function drawLabel(item,data,sliderOpts){var text=Lib.ensureSingle(item,"text",constants.labelClass,function(s){s.classed("user-select-none",!0).attr({"text-anchor":"middle","data-notex":1})});return text.call(Drawing.font,sliderOpts.font).text(data.step.label).call(svgTextUtils.convertToTspans,sliderOpts._gd),text}function drawLabelGroup(sliderGroup,sliderOpts){var labels=Lib.ensureSingle(sliderGroup,"g",constants.labelsClass),dims=sliderOpts._dims,labelItems=labels.selectAll("g."+constants.labelGroupClass).data(dims.labelSteps);labelItems.enter().append("g").classed(constants.labelGroupClass,!0),labelItems.exit().remove(),labelItems.each(function(d){var item=d3.select(this);item.call(drawLabel,d,sliderOpts),Drawing.setTranslate(item,normalizedValueToPosition(sliderOpts,d.fraction),constants.tickOffset+sliderOpts.ticklen+sliderOpts.font.size*LINE_SPACING+constants.labelOffset+dims.currentValueTotalHeight)})}function handleInput(gd,sliderGroup,sliderOpts,normalizedPosition,doTransition){var quantizedPosition=Math.round(normalizedPosition*(sliderOpts._stepCount-1)),quantizedIndex=sliderOpts._visibleSteps[quantizedPosition]._index;quantizedIndex!==sliderOpts.active&&setActive(gd,sliderGroup,sliderOpts,quantizedIndex,!0,doTransition)}function setActive(gd,sliderGroup,sliderOpts,index,doCallback,doTransition){var previousActive=sliderOpts.active;sliderOpts.active=index,arrayEditor(gd.layout,constants.name,sliderOpts).applyUpdate("active",index);var step=sliderOpts.steps[sliderOpts.active];sliderGroup.call(setGripPosition,sliderOpts,doTransition),sliderGroup.call(drawCurrentValue,sliderOpts),gd.emit("plotly_sliderchange",{slider:sliderOpts,step:sliderOpts.steps[sliderOpts.active],interaction:doCallback,previousActive:previousActive}),step&&step.method&&doCallback&&(sliderGroup._nextMethod?(sliderGroup._nextMethod.step=step,sliderGroup._nextMethod.doCallback=doCallback,sliderGroup._nextMethod.doTransition=doTransition):(sliderGroup._nextMethod={step:step,doCallback:doCallback,doTransition:doTransition},sliderGroup._nextMethodRaf=window.requestAnimationFrame(function(){var _step=sliderGroup._nextMethod.step;_step.method&&(_step.execute&&Plots.executeAPICommand(gd,_step.method,_step.args),sliderGroup._nextMethod=null,sliderGroup._nextMethodRaf=null)})))}function attachGripEvents(item,gd,sliderGroup){var node=sliderGroup.node(),$gd=d3.select(gd);function getSliderOpts(){return sliderGroup.data()[0]}item.on("mousedown",function(){var sliderOpts=getSliderOpts();gd.emit("plotly_sliderstart",{slider:sliderOpts});var grip=sliderGroup.select("."+constants.gripRectClass);d3.event.stopPropagation(),d3.event.preventDefault(),grip.call(Color.fill,sliderOpts.activebgcolor);var normalizedPosition=positionToNormalizedValue(sliderOpts,d3.mouse(node)[0]);handleInput(gd,sliderGroup,sliderOpts,normalizedPosition,!0),sliderOpts._dragging=!0,$gd.on("mousemove",function(){var sliderOpts=getSliderOpts(),normalizedPosition=positionToNormalizedValue(sliderOpts,d3.mouse(node)[0]);handleInput(gd,sliderGroup,sliderOpts,normalizedPosition,!1)}),$gd.on("mouseup",function(){var sliderOpts=getSliderOpts();sliderOpts._dragging=!1,grip.call(Color.fill,sliderOpts.bgcolor),$gd.on("mouseup",null),$gd.on("mousemove",null),gd.emit("plotly_sliderend",{slider:sliderOpts,step:sliderOpts.steps[sliderOpts.active]})})})}function drawTicks(sliderGroup,sliderOpts){var tick=sliderGroup.selectAll("rect."+constants.tickRectClass).data(sliderOpts._visibleSteps),dims=sliderOpts._dims;tick.enter().append("rect").classed(constants.tickRectClass,!0),tick.exit().remove(),tick.attr({width:sliderOpts.tickwidth+"px","shape-rendering":"crispEdges"}),tick.each(function(d,i){var isMajor=i%dims.labelStride==0,item=d3.select(this);item.attr({height:isMajor?sliderOpts.ticklen:sliderOpts.minorticklen}).call(Color.fill,sliderOpts.tickcolor),Drawing.setTranslate(item,normalizedValueToPosition(sliderOpts,i/(sliderOpts._stepCount-1))-.5*sliderOpts.tickwidth,(isMajor?constants.tickOffset:constants.minorTickOffset)+dims.currentValueTotalHeight)})}function setGripPosition(sliderGroup,sliderOpts,doTransition){for(var grip=sliderGroup.select("rect."+constants.gripRectClass),quantizedIndex=0,i=0;i<sliderOpts._stepCount;i++)if(sliderOpts._visibleSteps[i]._index===sliderOpts.active){quantizedIndex=i;break}var x=normalizedValueToPosition(sliderOpts,quantizedIndex/(sliderOpts._stepCount-1));if(!sliderOpts._invokingCommand){var el=grip;doTransition&&sliderOpts.transition.duration>0&&(el=el.transition().duration(sliderOpts.transition.duration).ease(sliderOpts.transition.easing)),el.attr("transform","translate("+(x-.5*constants.gripWidth)+","+sliderOpts._dims.currentValueTotalHeight+")")}}function normalizedValueToPosition(sliderOpts,normalizedPosition){var dims=sliderOpts._dims;return dims.inputAreaStart+constants.stepInset+(dims.inputAreaLength-2*constants.stepInset)*Math.min(1,Math.max(0,normalizedPosition))}function positionToNormalizedValue(sliderOpts,position){var dims=sliderOpts._dims;return Math.min(1,Math.max(0,(position-constants.stepInset-dims.inputAreaStart)/(dims.inputAreaLength-2*constants.stepInset-2*dims.inputAreaStart)))}function drawTouchRect(sliderGroup,gd,sliderOpts){var dims=sliderOpts._dims,rect=Lib.ensureSingle(sliderGroup,"rect",constants.railTouchRectClass,function(s){s.call(attachGripEvents,gd,sliderGroup,sliderOpts).style("pointer-events","all")});rect.attr({width:dims.inputAreaLength,height:Math.max(dims.inputAreaWidth,constants.tickOffset+sliderOpts.ticklen+dims.labelHeight)}).call(Color.fill,sliderOpts.bgcolor).attr("opacity",0),Drawing.setTranslate(rect,0,dims.currentValueTotalHeight)}function drawRail(sliderGroup,sliderOpts){var dims=sliderOpts._dims,computedLength=dims.inputAreaLength-2*constants.railInset,rect=Lib.ensureSingle(sliderGroup,"rect",constants.railRectClass);rect.attr({width:computedLength,height:constants.railWidth,rx:constants.railRadius,ry:constants.railRadius,"shape-rendering":"crispEdges"}).call(Color.stroke,sliderOpts.bordercolor).call(Color.fill,sliderOpts.bgcolor).style("stroke-width",sliderOpts.borderwidth+"px"),Drawing.setTranslate(rect,constants.railInset,.5*(dims.inputAreaWidth-constants.railWidth)+dims.currentValueTotalHeight)}module.exports=function draw(gd){var fullLayout=gd._fullLayout,sliderData=function makeSliderData(fullLayout,gd){for(var contOpts=fullLayout[constants.name],sliderData=[],i=0;i<contOpts.length;i++){var item=contOpts[i];item.visible&&(item._gd=gd,sliderData.push(item))}return sliderData}(fullLayout,gd),sliders=fullLayout._infolayer.selectAll("g."+constants.containerClassName).data(sliderData.length>0?[0]:[]);function clearSlider(sliderOpts){sliderOpts._commandObserver&&(sliderOpts._commandObserver.remove(),delete sliderOpts._commandObserver),Plots.autoMargin(gd,autoMarginId(sliderOpts))}if(sliders.enter().append("g").classed(constants.containerClassName,!0).style("cursor","ew-resize"),sliders.exit().each(function(){d3.select(this).selectAll("g."+constants.groupClassName).each(clearSlider)}).remove(),0!==sliderData.length){var sliderGroups=sliders.selectAll("g."+constants.groupClassName).data(sliderData,keyFunction);sliderGroups.enter().append("g").classed(constants.groupClassName,!0),sliderGroups.exit().each(clearSlider).remove();for(var i=0;i<sliderData.length;i++){var sliderOpts=sliderData[i];findDimensions(gd,sliderOpts)}sliderGroups.each(function(sliderOpts){var gSlider=d3.select(this);!function computeLabelSteps(sliderOpts){var dims=sliderOpts._dims;dims.labelSteps=[];for(var nsteps=sliderOpts._stepCount,i=0;i<nsteps;i+=dims.labelStride)dims.labelSteps.push({fraction:i/(nsteps-1),step:sliderOpts._visibleSteps[i]})}(sliderOpts),Plots.manageCommandObserver(gd,sliderOpts,sliderOpts._visibleSteps,function(data){var opts=gSlider.data()[0];opts.active!==data.index&&(opts._dragging||setActive(gd,gSlider,opts,data.index,!1,!0))}),function drawSlider(gd,sliderGroup,sliderOpts){(sliderOpts.steps[sliderOpts.active]||{}).visible||(sliderOpts.active=sliderOpts._visibleSteps[0]._index);sliderGroup.call(drawCurrentValue,sliderOpts).call(drawRail,sliderOpts).call(drawLabelGroup,sliderOpts).call(drawTicks,sliderOpts).call(drawTouchRect,gd,sliderOpts).call(drawGrip,gd,sliderOpts);var dims=sliderOpts._dims;Drawing.setTranslate(sliderGroup,dims.lx+sliderOpts.pad.l,dims.ly+sliderOpts.pad.t),sliderGroup.call(setGripPosition,sliderOpts,!1),sliderGroup.call(drawCurrentValue,sliderOpts)}(gd,d3.select(this),sliderOpts)})}}},{"../../constants/alignment":665,"../../lib":693,"../../lib/svg_text_utils":718,"../../plot_api/plot_template":732,"../../plots/plots":805,"../color":567,"../drawing":592,"../legend/anchor_utils":619,"./constants":654,d3:147}],657:[function(_dereq_,module,exports){"use strict";var constants=_dereq_("./constants");module.exports={moduleType:"component",name:constants.name,layoutAttributes:_dereq_("./attributes"),supplyLayoutDefaults:_dereq_("./defaults"),draw:_dereq_("./draw")}},{"./attributes":653,"./constants":654,"./defaults":655,"./draw":656}],658:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Plots=_dereq_("../../plots/plots"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../drawing"),Color=_dereq_("../color"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),interactConstants=_dereq_("../../constants/interactions");module.exports={draw:function draw(gd,titleClass,options){var editAttr,cont=options.propContainer,prop=options.propName,placeholder=options.placeholder,traceIndex=options.traceIndex,avoid=options.avoid||{},attributes=options.attributes,transform=options.transform,group=options.containerGroup,fullLayout=gd._fullLayout,titlefont=cont.titlefont||{},font=titlefont.family,fontSize=titlefont.size,fontColor=titlefont.color,opacity=1,isplaceholder=!1,txt=(cont.title||"").trim();"title"===prop?editAttr="titleText":-1!==prop.indexOf("axis")?editAttr="axisTitleText":prop.indexOf(!0)&&(editAttr="colorbarTitleText");var editable=gd._context.edits[editAttr];""===txt?opacity=0:txt.replace(numStripRE," % ")===placeholder.replace(numStripRE," % ")&&(opacity=.2,isplaceholder=!0,editable||(txt=""));var elShouldExist=txt||editable;group||(group=Lib.ensureSingle(fullLayout._infolayer,"g","g-"+titleClass));var el=group.selectAll("text").data(elShouldExist?[0]:[]);if(el.enter().append("text"),el.text(txt).attr("class",titleClass),el.exit().remove(),!elShouldExist)return group;function titleLayout(titleEl){Lib.syncOrAsync([drawTitle,scootTitle],titleEl)}function drawTitle(titleEl){var transformVal;return transform?(transformVal="",transform.rotate&&(transformVal+="rotate("+[transform.rotate,attributes.x,attributes.y]+")"),transform.offset&&(transformVal+="translate(0, "+transform.offset+")")):transformVal=null,titleEl.attr("transform",transformVal),titleEl.style({"font-family":font,"font-size":d3.round(fontSize,2)+"px",fill:Color.rgb(fontColor),opacity:opacity*Color.opacity(fontColor),"font-weight":Plots.fontWeight}).attr(attributes).call(svgTextUtils.convertToTspans,gd),Plots.previousPromises(gd)}function scootTitle(titleElIn){var titleGroup=d3.select(titleElIn.node().parentNode);if(avoid&&avoid.selection&&avoid.side&&txt){titleGroup.attr("transform",null);var shift=0,backside={left:"right",right:"left",top:"bottom",bottom:"top"}[avoid.side],shiftSign=-1!==["left","top"].indexOf(avoid.side)?-1:1,pad=isNumeric(avoid.pad)?avoid.pad:2,titlebb=Drawing.bBox(titleGroup.node()),paperbb={left:0,top:0,right:fullLayout.width,bottom:fullLayout.height},maxshift=avoid.maxShift||(paperbb[avoid.side]-titlebb[avoid.side])*("left"===avoid.side||"top"===avoid.side?-1:1);if(maxshift<0)shift=maxshift;else{var offsetLeft=avoid.offsetLeft||0,offsetTop=avoid.offsetTop||0;titlebb.left-=offsetLeft,titlebb.right-=offsetLeft,titlebb.top-=offsetTop,titlebb.bottom-=offsetTop,avoid.selection.each(function(){var avoidbb=Drawing.bBox(this);Lib.bBoxIntersect(titlebb,avoidbb,pad)&&(shift=Math.max(shift,shiftSign*(avoidbb[avoid.side]-titlebb[backside])+pad))}),shift=Math.min(maxshift,shift)}if(shift>0||maxshift<0){var shiftTemplate={left:[-shift,0],right:[shift,0],top:[0,-shift],bottom:[0,shift]}[avoid.side];titleGroup.attr("transform","translate("+shiftTemplate+")")}}}el.call(titleLayout),editable&&(txt?el.on(".opacity",null):function setPlaceholder(){opacity=0,isplaceholder=!0,el.text(placeholder).on("mouseover.opacity",function(){d3.select(this).transition().duration(interactConstants.SHOW_PLACEHOLDER).style("opacity",1)}).on("mouseout.opacity",function(){d3.select(this).transition().duration(interactConstants.HIDE_PLACEHOLDER).style("opacity",0)})}(),el.call(svgTextUtils.makeEditable,{gd:gd}).on("edit",function(text){void 0!==traceIndex?Registry.call("restyle",gd,prop,text,traceIndex):Registry.call("relayout",gd,prop,text)}).on("cancel",function(){this.text(this.attr("data-unformatted")).call(titleLayout)}).on("input",function(d){this.text(d||" ").call(svgTextUtils.positionText,attributes.x,attributes.y)}));return el.classed("js-placeholder",isplaceholder),group}};var numStripRE=/ [XY][0-9]* /},{"../../constants/interactions":669,"../../lib":693,"../../lib/svg_text_utils":718,"../../plots/plots":805,"../../registry":825,"../color":567,"../drawing":592,d3:147,"fast-isnumeric":213}],659:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),colorAttrs=_dereq_("../color/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,padAttrs=_dereq_("../../plots/pad_attributes"),templatedArray=_dereq_("../../plot_api/plot_template").templatedArray,buttonsAttrs=templatedArray("button",{visible:{valType:"boolean"},method:{valType:"enumerated",values:["restyle","relayout","animate","update","skip"],dflt:"restyle"},args:{valType:"info_array",freeLength:!0,items:[{valType:"any"},{valType:"any"},{valType:"any"}]},label:{valType:"string",dflt:""},execute:{valType:"boolean",dflt:!0}});module.exports=overrideAll(templatedArray("updatemenu",{_arrayAttrRegexps:[/^updatemenus\[(0|[1-9][0-9]+)\]\.buttons/],visible:{valType:"boolean"},type:{valType:"enumerated",values:["dropdown","buttons"],dflt:"dropdown"},direction:{valType:"enumerated",values:["left","right","up","down"],dflt:"down"},active:{valType:"integer",min:-1,dflt:0},showactive:{valType:"boolean",dflt:!0},buttons:buttonsAttrs,x:{valType:"number",min:-2,max:3,dflt:-.05},xanchor:{valType:"enumerated",values:["auto","left","center","right"],dflt:"right"},y:{valType:"number",min:-2,max:3,dflt:1},yanchor:{valType:"enumerated",values:["auto","top","middle","bottom"],dflt:"top"},pad:extendFlat({},padAttrs,{}),font:fontAttrs({}),bgcolor:{valType:"color"},bordercolor:{valType:"color",dflt:colorAttrs.borderLine},borderwidth:{valType:"number",min:0,dflt:1,editType:"arraydraw"}}),"arraydraw","from-root")},{"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plot_api/plot_template":732,"../../plots/font_attributes":768,"../../plots/pad_attributes":804,"../color/attributes":566}],660:[function(_dereq_,module,exports){"use strict";module.exports={name:"updatemenus",containerClassName:"updatemenu-container",headerGroupClassName:"updatemenu-header-group",headerClassName:"updatemenu-header",headerArrowClassName:"updatemenu-header-arrow",dropdownButtonGroupClassName:"updatemenu-dropdown-button-group",dropdownButtonClassName:"updatemenu-dropdown-button",buttonClassName:"updatemenu-button",itemRectClassName:"updatemenu-item-rect",itemTextClassName:"updatemenu-item-text",menuIndexAttrName:"updatemenu-active-index",autoMarginIdRoot:"updatemenu-",blankHeaderOpts:{label:"  "},minWidth:30,minHeight:30,textPadX:24,arrowPadX:16,rx:2,ry:2,textOffsetX:12,textOffsetY:3,arrowOffsetX:4,gapButtonHeader:5,gapButton:2,activeColor:"#F4FAFF",hoverColor:"#F4FAFF",arrowSymbol:{left:"",right:"",up:"",down:""}}},{}],661:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),name=_dereq_("./constants").name,buttonAttrs=attributes.buttons;function menuDefaults(menuIn,menuOut,layoutOut){function coerce(attr,dflt){return Lib.coerce(menuIn,menuOut,attributes,attr,dflt)}coerce("visible",handleArrayContainerDefaults(menuIn,menuOut,{name:"buttons",handleItemDefaults:buttonDefaults}).length>0)&&(coerce("active"),coerce("direction"),coerce("type"),coerce("showactive"),coerce("x"),coerce("y"),Lib.noneOrAll(menuIn,menuOut,["x","y"]),coerce("xanchor"),coerce("yanchor"),coerce("pad.t"),coerce("pad.r"),coerce("pad.b"),coerce("pad.l"),Lib.coerceFont(coerce,"font",layoutOut.font),coerce("bgcolor",layoutOut.paper_bgcolor),coerce("bordercolor"),coerce("borderwidth"))}function buttonDefaults(buttonIn,buttonOut){function coerce(attr,dflt){return Lib.coerce(buttonIn,buttonOut,buttonAttrs,attr,dflt)}coerce("visible","skip"===buttonIn.method||Array.isArray(buttonIn.args))&&(coerce("method"),coerce("args"),coerce("label"),coerce("execute"))}module.exports=function updateMenusDefaults(layoutIn,layoutOut){handleArrayContainerDefaults(layoutIn,layoutOut,{name:name,handleItemDefaults:menuDefaults})}},{"../../lib":693,"../../plots/array_container_defaults":738,"./attributes":659,"./constants":660}],662:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Plots=_dereq_("../../plots/plots"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),anchorUtils=_dereq_("../legend/anchor_utils"),arrayEditor=_dereq_("../../plot_api/plot_template").arrayEditor,LINE_SPACING=_dereq_("../../constants/alignment").LINE_SPACING,constants=_dereq_("./constants"),ScrollBox=_dereq_("./scrollbox");function keyFunction(menuOpts){return menuOpts._index}function isActive(gButton,menuOpts){return+gButton.attr(constants.menuIndexAttrName)===menuOpts._index}function setActive(gd,menuOpts,buttonOpts,gHeader,gButton,scrollBox,buttonIndex,isSilentUpdate){menuOpts.active=buttonIndex,arrayEditor(gd.layout,constants.name,menuOpts).applyUpdate("active",buttonIndex),"buttons"===menuOpts.type?drawButtons(gd,gHeader,null,null,menuOpts):"dropdown"===menuOpts.type&&(gButton.attr(constants.menuIndexAttrName,"-1"),drawHeader(gd,gHeader,gButton,scrollBox,menuOpts),isSilentUpdate||drawButtons(gd,gHeader,gButton,scrollBox,menuOpts))}function drawHeader(gd,gHeader,gButton,scrollBox,menuOpts){var header=Lib.ensureSingle(gHeader,"g",constants.headerClassName,function(s){s.style("pointer-events","all")}),dims=menuOpts._dims,active=menuOpts.active,headerOpts=menuOpts.buttons[active]||constants.blankHeaderOpts,posOpts={y:menuOpts.pad.t,yPad:0,x:menuOpts.pad.l,xPad:0,index:0},positionOverrides={width:dims.headerWidth,height:dims.headerHeight};header.call(drawItem,menuOpts,headerOpts,gd).call(setItemPosition,menuOpts,posOpts,positionOverrides),Lib.ensureSingle(gHeader,"text",constants.headerArrowClassName,function(s){s.classed("user-select-none",!0).attr("text-anchor","end").call(Drawing.font,menuOpts.font).text(constants.arrowSymbol[menuOpts.direction])}).attr({x:dims.headerWidth-constants.arrowOffsetX+menuOpts.pad.l,y:dims.headerHeight/2+constants.textOffsetY+menuOpts.pad.t}),header.on("click",function(){gButton.call(removeAllButtons,String(isActive(gButton,menuOpts)?-1:menuOpts._index)),drawButtons(gd,gHeader,gButton,scrollBox,menuOpts)}),header.on("mouseover",function(){header.call(styleOnMouseOver)}),header.on("mouseout",function(){header.call(styleOnMouseOut,menuOpts)}),Drawing.setTranslate(gHeader,dims.lx,dims.ly)}function drawButtons(gd,gHeader,gButton,scrollBox,menuOpts){gButton||(gButton=gHeader).attr("pointer-events","all");var buttonData=function isFolded(gButton){return-1==+gButton.attr(constants.menuIndexAttrName)}(gButton)&&"buttons"!==menuOpts.type?[]:menuOpts.buttons,klass="dropdown"===menuOpts.type?constants.dropdownButtonClassName:constants.buttonClassName,buttons=gButton.selectAll("g."+klass).data(Lib.filterVisible(buttonData)),enter=buttons.enter().append("g").classed(klass,!0),exit=buttons.exit();"dropdown"===menuOpts.type?(enter.attr("opacity","0").transition().attr("opacity","1"),exit.transition().attr("opacity","0").remove()):exit.remove();var x0=0,y0=0,dims=menuOpts._dims,isVertical=-1!==["up","down"].indexOf(menuOpts.direction);"dropdown"===menuOpts.type&&(isVertical?y0=dims.headerHeight+constants.gapButtonHeader:x0=dims.headerWidth+constants.gapButtonHeader),"dropdown"===menuOpts.type&&"up"===menuOpts.direction&&(y0=-constants.gapButtonHeader+constants.gapButton-dims.openHeight),"dropdown"===menuOpts.type&&"left"===menuOpts.direction&&(x0=-constants.gapButtonHeader+constants.gapButton-dims.openWidth);var posOpts={x:dims.lx+x0+menuOpts.pad.l,y:dims.ly+y0+menuOpts.pad.t,yPad:constants.gapButton,xPad:constants.gapButton,index:0},scrollBoxPosition={l:posOpts.x+menuOpts.borderwidth,t:posOpts.y+menuOpts.borderwidth};buttons.each(function(buttonOpts,buttonIndex){var button=d3.select(this);button.call(drawItem,menuOpts,buttonOpts,gd).call(setItemPosition,menuOpts,posOpts),button.on("click",function(){d3.event.defaultPrevented||(setActive(gd,menuOpts,0,gHeader,gButton,scrollBox,buttonIndex),buttonOpts.execute&&Plots.executeAPICommand(gd,buttonOpts.method,buttonOpts.args),gd.emit("plotly_buttonclicked",{menu:menuOpts,button:buttonOpts,active:menuOpts.active}))}),button.on("mouseover",function(){button.call(styleOnMouseOver)}),button.on("mouseout",function(){button.call(styleOnMouseOut,menuOpts),buttons.call(styleButtons,menuOpts)})}),buttons.call(styleButtons,menuOpts),isVertical?(scrollBoxPosition.w=Math.max(dims.openWidth,dims.headerWidth),scrollBoxPosition.h=posOpts.y-scrollBoxPosition.t):(scrollBoxPosition.w=posOpts.x-scrollBoxPosition.l,scrollBoxPosition.h=Math.max(dims.openHeight,dims.headerHeight)),scrollBoxPosition.direction=menuOpts.direction,scrollBox&&(buttons.size()?function drawScrollBox(gd,gHeader,gButton,scrollBox,menuOpts,position){var translateX,translateY,i,direction=menuOpts.direction,isVertical="up"===direction||"down"===direction,dims=menuOpts._dims,active=menuOpts.active;if(isVertical)for(translateY=0,i=0;i<active;i++)translateY+=dims.heights[i]+constants.gapButton;else for(translateX=0,i=0;i<active;i++)translateX+=dims.widths[i]+constants.gapButton;scrollBox.enable(position,translateX,translateY),scrollBox.hbar&&scrollBox.hbar.attr("opacity","0").transition().attr("opacity","1");scrollBox.vbar&&scrollBox.vbar.attr("opacity","0").transition().attr("opacity","1")}(0,0,0,scrollBox,menuOpts,scrollBoxPosition):function hideScrollBox(scrollBox){var hasHBar=!!scrollBox.hbar,hasVBar=!!scrollBox.vbar;hasHBar&&scrollBox.hbar.transition().attr("opacity","0").each("end",function(){hasHBar=!1,hasVBar||scrollBox.disable()});hasVBar&&scrollBox.vbar.transition().attr("opacity","0").each("end",function(){hasVBar=!1,hasHBar||scrollBox.disable()})}(scrollBox))}function drawItem(item,menuOpts,itemOpts,gd){item.call(drawItemRect,menuOpts).call(drawItemText,menuOpts,itemOpts,gd)}function drawItemRect(item,menuOpts){Lib.ensureSingle(item,"rect",constants.itemRectClassName,function(s){s.attr({rx:constants.rx,ry:constants.ry,"shape-rendering":"crispEdges"})}).call(Color.stroke,menuOpts.bordercolor).call(Color.fill,menuOpts.bgcolor).style("stroke-width",menuOpts.borderwidth+"px")}function drawItemText(item,menuOpts,itemOpts,gd){Lib.ensureSingle(item,"text",constants.itemTextClassName,function(s){s.classed("user-select-none",!0).attr({"text-anchor":"start","data-notex":1})}).call(Drawing.font,menuOpts.font).text(itemOpts.label).call(svgTextUtils.convertToTspans,gd)}function styleButtons(buttons,menuOpts){var active=menuOpts.active;buttons.each(function(buttonOpts,i){var button=d3.select(this);i===active&&menuOpts.showactive&&button.select("rect."+constants.itemRectClassName).call(Color.fill,constants.activeColor)})}function styleOnMouseOver(item){item.select("rect."+constants.itemRectClassName).call(Color.fill,constants.hoverColor)}function styleOnMouseOut(item,menuOpts){item.select("rect."+constants.itemRectClassName).call(Color.fill,menuOpts.bgcolor)}function findDimensions(gd,menuOpts){var dims=menuOpts._dims={width1:0,height1:0,heights:[],widths:[],totalWidth:0,totalHeight:0,openWidth:0,openHeight:0,lx:0,ly:0},fakeButtons=Drawing.tester.selectAll("g."+constants.dropdownButtonClassName).data(Lib.filterVisible(menuOpts.buttons));fakeButtons.enter().append("g").classed(constants.dropdownButtonClassName,!0);var isVertical=-1!==["up","down"].indexOf(menuOpts.direction);fakeButtons.each(function(buttonOpts,i){var button=d3.select(this);button.call(drawItem,menuOpts,buttonOpts,gd);var text=button.select("."+constants.itemTextClassName),tWidth=text.node()&&Drawing.bBox(text.node()).width,wEff=Math.max(tWidth+constants.textPadX,constants.minWidth),tHeight=menuOpts.font.size*LINE_SPACING,tLines=svgTextUtils.lineCount(text),hEff=Math.max(tHeight*tLines,constants.minHeight)+constants.textOffsetY;hEff=Math.ceil(hEff),wEff=Math.ceil(wEff),dims.widths[i]=wEff,dims.heights[i]=hEff,dims.height1=Math.max(dims.height1,hEff),dims.width1=Math.max(dims.width1,wEff),isVertical?(dims.totalWidth=Math.max(dims.totalWidth,wEff),dims.openWidth=dims.totalWidth,dims.totalHeight+=hEff+constants.gapButton,dims.openHeight+=hEff+constants.gapButton):(dims.totalWidth+=wEff+constants.gapButton,dims.openWidth+=wEff+constants.gapButton,dims.totalHeight=Math.max(dims.totalHeight,hEff),dims.openHeight=dims.totalHeight)}),isVertical?dims.totalHeight-=constants.gapButton:dims.totalWidth-=constants.gapButton,dims.headerWidth=dims.width1+constants.arrowPadX,dims.headerHeight=dims.height1,"dropdown"===menuOpts.type&&(isVertical?(dims.width1+=constants.arrowPadX,dims.totalHeight=dims.height1):dims.totalWidth=dims.width1,dims.totalWidth+=constants.arrowPadX),fakeButtons.remove();var paddedWidth=dims.totalWidth+menuOpts.pad.l+menuOpts.pad.r,paddedHeight=dims.totalHeight+menuOpts.pad.t+menuOpts.pad.b,graphSize=gd._fullLayout._size;dims.lx=graphSize.l+graphSize.w*menuOpts.x,dims.ly=graphSize.t+graphSize.h*(1-menuOpts.y);var xanchor="left";anchorUtils.isRightAnchor(menuOpts)&&(dims.lx-=paddedWidth,xanchor="right"),anchorUtils.isCenterAnchor(menuOpts)&&(dims.lx-=paddedWidth/2,xanchor="center");var yanchor="top";anchorUtils.isBottomAnchor(menuOpts)&&(dims.ly-=paddedHeight,yanchor="bottom"),anchorUtils.isMiddleAnchor(menuOpts)&&(dims.ly-=paddedHeight/2,yanchor="middle"),dims.totalWidth=Math.ceil(dims.totalWidth),dims.totalHeight=Math.ceil(dims.totalHeight),dims.lx=Math.round(dims.lx),dims.ly=Math.round(dims.ly),Plots.autoMargin(gd,autoMarginId(menuOpts),{x:menuOpts.x,y:menuOpts.y,l:paddedWidth*({right:1,center:.5}[xanchor]||0),r:paddedWidth*({left:1,center:.5}[xanchor]||0),b:paddedHeight*({top:1,middle:.5}[yanchor]||0),t:paddedHeight*({bottom:1,middle:.5}[yanchor]||0)})}function autoMarginId(menuOpts){return constants.autoMarginIdRoot+menuOpts._index}function setItemPosition(item,menuOpts,posOpts,overrideOpts){overrideOpts=overrideOpts||{};var rect=item.select("."+constants.itemRectClassName),text=item.select("."+constants.itemTextClassName),borderWidth=menuOpts.borderwidth,index=posOpts.index,dims=menuOpts._dims;Drawing.setTranslate(item,borderWidth+posOpts.x,borderWidth+posOpts.y);var isVertical=-1!==["up","down"].indexOf(menuOpts.direction),finalHeight=overrideOpts.height||(isVertical?dims.heights[index]:dims.height1);rect.attr({x:0,y:0,width:overrideOpts.width||(isVertical?dims.width1:dims.widths[index]),height:finalHeight});var tHeight=menuOpts.font.size*LINE_SPACING,spanOffset=(svgTextUtils.lineCount(text)-1)*tHeight/2;svgTextUtils.positionText(text,constants.textOffsetX,finalHeight/2-spanOffset+constants.textOffsetY),isVertical?posOpts.y+=dims.heights[index]+posOpts.yPad:posOpts.x+=dims.widths[index]+posOpts.xPad,posOpts.index++}function removeAllButtons(gButton,newMenuIndexAttr){gButton.attr(constants.menuIndexAttrName,newMenuIndexAttr||"-1").selectAll("g."+constants.dropdownButtonClassName).remove()}module.exports=function draw(gd){var fullLayout=gd._fullLayout,menuData=Lib.filterVisible(fullLayout[constants.name]);function clearAutoMargin(menuOpts){Plots.autoMargin(gd,autoMarginId(menuOpts))}var menus=fullLayout._menulayer.selectAll("g."+constants.containerClassName).data(menuData.length>0?[0]:[]);if(menus.enter().append("g").classed(constants.containerClassName,!0).style("cursor","pointer"),menus.exit().each(function(){d3.select(this).selectAll("g."+constants.headerGroupClassName).each(clearAutoMargin)}).remove(),0!==menuData.length){var headerGroups=menus.selectAll("g."+constants.headerGroupClassName).data(menuData,keyFunction);headerGroups.enter().append("g").classed(constants.headerGroupClassName,!0);for(var gButton=Lib.ensureSingle(menus,"g",constants.dropdownButtonGroupClassName,function(s){s.style("pointer-events","all")}),i=0;i<menuData.length;i++){var menuOpts=menuData[i];findDimensions(gd,menuOpts)}var scrollBoxId="updatemenus"+fullLayout._uid,scrollBox=new ScrollBox(gd,gButton,scrollBoxId);headerGroups.enter().size()&&(gButton.node().parentNode.appendChild(gButton.node()),gButton.call(removeAllButtons)),headerGroups.exit().each(function(menuOpts){gButton.call(removeAllButtons),clearAutoMargin(menuOpts)}).remove(),headerGroups.each(function(menuOpts){var gHeader=d3.select(this),_gButton="dropdown"===menuOpts.type?gButton:null;Plots.manageCommandObserver(gd,menuOpts,menuOpts.buttons,function(data){setActive(gd,menuOpts,menuOpts.buttons[data.index],gHeader,_gButton,scrollBox,data.index,!0)}),"dropdown"===menuOpts.type?(drawHeader(gd,gHeader,gButton,scrollBox,menuOpts),isActive(gButton,menuOpts)&&drawButtons(gd,gHeader,gButton,scrollBox,menuOpts)):drawButtons(gd,gHeader,null,null,menuOpts)})}}},{"../../constants/alignment":665,"../../lib":693,"../../lib/svg_text_utils":718,"../../plot_api/plot_template":732,"../../plots/plots":805,"../color":567,"../drawing":592,"../legend/anchor_utils":619,"./constants":660,"./scrollbox":664,d3:147}],663:[function(_dereq_,module,exports){arguments[4][657][0].apply(exports,arguments)},{"./attributes":659,"./constants":660,"./defaults":661,"./draw":662,dup:657}],664:[function(_dereq_,module,exports){"use strict";module.exports=ScrollBox;var d3=_dereq_("d3"),Color=_dereq_("../color"),Drawing=_dereq_("../drawing"),Lib=_dereq_("../../lib");function ScrollBox(gd,container,id){this.gd=gd,this.container=container,this.id=id,this.position=null,this.translateX=null,this.translateY=null,this.hbar=null,this.vbar=null,this.bg=this.container.selectAll("rect.scrollbox-bg").data([0]),this.bg.exit().on(".drag",null).on("wheel",null).remove(),this.bg.enter().append("rect").classed("scrollbox-bg",!0).style("pointer-events","all").attr({opacity:0,x:0,y:0,width:0,height:0})}ScrollBox.barWidth=2,ScrollBox.barLength=20,ScrollBox.barRadius=2,ScrollBox.barPad=1,ScrollBox.barColor="#808BA4",ScrollBox.prototype.enable=function enable(position,translateX,translateY){var fullLayout=this.gd._fullLayout,fullWidth=fullLayout.width,fullHeight=fullLayout.height;this.position=position;var boxL,boxR,boxT,boxB,l=this.position.l,w=this.position.w,t=this.position.t,h=this.position.h,direction=this.position.direction,isDown="down"===direction,isLeft="left"===direction,isUp="up"===direction,boxW=w,boxH=h;isDown||isLeft||"right"===direction||isUp||(this.position.direction="down",isDown=!0),isDown||isUp?(boxR=(boxL=l)+boxW,isDown?(boxT=t,boxH=(boxB=Math.min(boxT+boxH,fullHeight))-boxT):boxH=(boxB=t+boxH)-(boxT=Math.max(boxB-boxH,0))):(boxB=(boxT=t)+boxH,isLeft?boxW=(boxR=l+boxW)-(boxL=Math.max(boxR-boxW,0)):(boxL=l,boxW=(boxR=Math.min(boxL+boxW,fullWidth))-boxL)),this._box={l:boxL,t:boxT,w:boxW,h:boxH};var needsHorizontalScrollBar=w>boxW,hbarW=ScrollBox.barLength+2*ScrollBox.barPad,hbarH=ScrollBox.barWidth+2*ScrollBox.barPad,hbarL=l,hbarT=t+h;hbarT+hbarH>fullHeight&&(hbarT=fullHeight-hbarH);var hbar=this.container.selectAll("rect.scrollbar-horizontal").data(needsHorizontalScrollBar?[0]:[]);hbar.exit().on(".drag",null).remove(),hbar.enter().append("rect").classed("scrollbar-horizontal",!0).call(Color.fill,ScrollBox.barColor),needsHorizontalScrollBar?(this.hbar=hbar.attr({rx:ScrollBox.barRadius,ry:ScrollBox.barRadius,x:hbarL,y:hbarT,width:hbarW,height:hbarH}),this._hbarXMin=hbarL+hbarW/2,this._hbarTranslateMax=boxW-hbarW):(delete this.hbar,delete this._hbarXMin,delete this._hbarTranslateMax);var needsVerticalScrollBar=h>boxH,vbarW=ScrollBox.barWidth+2*ScrollBox.barPad,vbarH=ScrollBox.barLength+2*ScrollBox.barPad,vbarL=l+w,vbarT=t;vbarL+vbarW>fullWidth&&(vbarL=fullWidth-vbarW);var vbar=this.container.selectAll("rect.scrollbar-vertical").data(needsVerticalScrollBar?[0]:[]);vbar.exit().on(".drag",null).remove(),vbar.enter().append("rect").classed("scrollbar-vertical",!0).call(Color.fill,ScrollBox.barColor),needsVerticalScrollBar?(this.vbar=vbar.attr({rx:ScrollBox.barRadius,ry:ScrollBox.barRadius,x:vbarL,y:vbarT,width:vbarW,height:vbarH}),this._vbarYMin=vbarT+vbarH/2,this._vbarTranslateMax=boxH-vbarH):(delete this.vbar,delete this._vbarYMin,delete this._vbarTranslateMax);var clipId=this.id,clipL=boxL-.5,clipR=needsVerticalScrollBar?boxR+vbarW+.5:boxR+.5,clipT=boxT-.5,clipB=needsHorizontalScrollBar?boxB+hbarH+.5:boxB+.5,clipPath=fullLayout._topdefs.selectAll("#"+clipId).data(needsHorizontalScrollBar||needsVerticalScrollBar?[0]:[]);if(clipPath.exit().remove(),clipPath.enter().append("clipPath").attr("id",clipId).append("rect"),needsHorizontalScrollBar||needsVerticalScrollBar?(this._clipRect=clipPath.select("rect").attr({x:Math.floor(clipL),y:Math.floor(clipT),width:Math.ceil(clipR)-Math.floor(clipL),height:Math.ceil(clipB)-Math.floor(clipT)}),this.container.call(Drawing.setClipUrl,clipId),this.bg.attr({x:l,y:t,width:w,height:h})):(this.bg.attr({width:0,height:0}),this.container.on("wheel",null).on(".drag",null).call(Drawing.setClipUrl,null),delete this._clipRect),needsHorizontalScrollBar||needsVerticalScrollBar){var onBoxDrag=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.preventDefault()}).on("drag",this._onBoxDrag.bind(this));this.container.on("wheel",null).on("wheel",this._onBoxWheel.bind(this)).on(".drag",null).call(onBoxDrag);var onBarDrag=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.preventDefault(),d3.event.sourceEvent.stopPropagation()}).on("drag",this._onBarDrag.bind(this));needsHorizontalScrollBar&&this.hbar.on(".drag",null).call(onBarDrag),needsVerticalScrollBar&&this.vbar.on(".drag",null).call(onBarDrag)}this.setTranslate(translateX,translateY)},ScrollBox.prototype.disable=function disable(){(this.hbar||this.vbar)&&(this.bg.attr({width:0,height:0}),this.container.on("wheel",null).on(".drag",null).call(Drawing.setClipUrl,null),delete this._clipRect),this.hbar&&(this.hbar.on(".drag",null),this.hbar.remove(),delete this.hbar,delete this._hbarXMin,delete this._hbarTranslateMax),this.vbar&&(this.vbar.on(".drag",null),this.vbar.remove(),delete this.vbar,delete this._vbarYMin,delete this._vbarTranslateMax)},ScrollBox.prototype._onBoxDrag=function onBarDrag(){var translateX=this.translateX,translateY=this.translateY;this.hbar&&(translateX-=d3.event.dx),this.vbar&&(translateY-=d3.event.dy),this.setTranslate(translateX,translateY)},ScrollBox.prototype._onBoxWheel=function onBarWheel(){var translateX=this.translateX,translateY=this.translateY;this.hbar&&(translateX+=d3.event.deltaY),this.vbar&&(translateY+=d3.event.deltaY),this.setTranslate(translateX,translateY)},ScrollBox.prototype._onBarDrag=function onBarDrag(){var translateX=this.translateX,translateY=this.translateY;if(this.hbar){var xMin=translateX+this._hbarXMin,xMax=xMin+this._hbarTranslateMax;translateX=(Lib.constrain(d3.event.x,xMin,xMax)-xMin)/(xMax-xMin)*(this.position.w-this._box.w)}if(this.vbar){var yMin=translateY+this._vbarYMin,yMax=yMin+this._vbarTranslateMax;translateY=(Lib.constrain(d3.event.y,yMin,yMax)-yMin)/(yMax-yMin)*(this.position.h-this._box.h)}this.setTranslate(translateX,translateY)},ScrollBox.prototype.setTranslate=function setTranslate(translateX,translateY){var translateXMax=this.position.w-this._box.w,translateYMax=this.position.h-this._box.h;if(translateX=Lib.constrain(translateX||0,0,translateXMax),translateY=Lib.constrain(translateY||0,0,translateYMax),this.translateX=translateX,this.translateY=translateY,this.container.call(Drawing.setTranslate,this._box.l-this.position.l-translateX,this._box.t-this.position.t-translateY),this._clipRect&&this._clipRect.attr({x:Math.floor(this.position.l+translateX-.5),y:Math.floor(this.position.t+translateY-.5)}),this.hbar){var xf=translateX/translateXMax;this.hbar.call(Drawing.setTranslate,translateX+xf*this._hbarTranslateMax,translateY)}if(this.vbar){var yf=translateY/translateYMax;this.vbar.call(Drawing.setTranslate,translateX,translateY+yf*this._vbarTranslateMax)}}},{"../../lib":693,"../color":567,"../drawing":592,d3:147}],665:[function(_dereq_,module,exports){"use strict";module.exports={FROM_BL:{left:0,center:.5,right:1,bottom:0,middle:.5,top:1},FROM_TL:{left:0,center:.5,right:1,bottom:1,middle:.5,top:0},FROM_BR:{left:1,center:.5,right:0,bottom:0,middle:.5,top:1},LINE_SPACING:1.3,MID_SHIFT:.35,OPPOSITE_SIDE:{left:"right",right:"left",top:"bottom",bottom:"top"}}},{}],666:[function(_dereq_,module,exports){"use strict";module.exports={COMPARISON_OPS:["=","!=","<",">=",">","<="],COMPARISON_OPS2:["=","<",">=",">","<="],INTERVAL_OPS:["[]","()","[)","(]","][",")(","](",")["],SET_OPS:["{}","}{"],CONSTRAINT_REDUCTION:{"=":"=","<":"<","<=":"<",">":">",">=":">","[]":"[]","()":"[]","[)":"[]","(]":"[]","][":"][",")(":"][","](":"][",")[":"]["}}},{}],667:[function(_dereq_,module,exports){"use strict";module.exports={solid:[[],0],dot:[[.5,1],200],dash:[[.5,1],50],longdash:[[.5,1],10],dashdot:[[.5,.625,.875,1],50],longdashdot:[[.5,.7,.8,1],10]}},{}],668:[function(_dereq_,module,exports){"use strict";module.exports={circle:"","circle-open":"",square:"","square-open":"",diamond:"","diamond-open":"",cross:"+",x:""}},{}],669:[function(_dereq_,module,exports){"use strict";module.exports={SHOW_PLACEHOLDER:100,HIDE_PLACEHOLDER:1e3,DBLCLICKDELAY:300,DESELECTDIM:.2}},{}],670:[function(_dereq_,module,exports){"use strict";module.exports={BADNUM:void 0,FP_SAFE:Number.MAX_VALUE/1e4,ONEAVGYEAR:315576e5,ONEAVGMONTH:26298e5,ONEDAY:864e5,ONEHOUR:36e5,ONEMIN:6e4,ONESEC:1e3,EPOCHJD:2440587.5,ALMOST_EQUAL:1-1e-6,LOG_CLIP:10,MINUS_SIGN:""}},{}],671:[function(_dereq_,module,exports){"use strict";exports.xmlns="http://www.w3.org/2000/xmlns/",exports.svg="http://www.w3.org/2000/svg",exports.xlink="http://www.w3.org/1999/xlink",exports.svgAttrs={xmlns:exports.svg,"xmlns:xlink":exports.xlink}},{}],672:[function(_dereq_,module,exports){"use strict";exports.version="1.41.3",_dereq_("es6-promise").polyfill(),_dereq_("../build/plotcss"),_dereq_("./fonts/mathjax_config");for(var Registry=_dereq_("./registry"),register=exports.register=Registry.register,plotApi=_dereq_("./plot_api"),methodNames=Object.keys(plotApi),i=0;i<methodNames.length;i++){var name=methodNames[i];exports[name]=plotApi[name],register({moduleType:"apiMethod",name:name,fn:plotApi[name]})}register(_dereq_("./traces/scatter")),register([_dereq_("./components/fx"),_dereq_("./components/legend"),_dereq_("./components/annotations"),_dereq_("./components/annotations3d"),_dereq_("./components/shapes"),_dereq_("./components/images"),_dereq_("./components/updatemenus"),_dereq_("./components/sliders"),_dereq_("./components/rangeslider"),_dereq_("./components/rangeselector"),_dereq_("./components/grid"),_dereq_("./components/errorbars")]),register([_dereq_("./locale-en"),_dereq_("./locale-en-us")]),exports.Icons=_dereq_("../build/ploticon"),exports.Plots=_dereq_("./plots/plots"),exports.Fx=_dereq_("./components/fx"),exports.Snapshot=_dereq_("./snapshot"),exports.PlotSchema=_dereq_("./plot_api/plot_schema"),exports.Queue=_dereq_("./lib/queue"),exports.d3=_dereq_("d3")},{"../build/plotcss":1,"../build/ploticon":2,"./components/annotations":558,"./components/annotations3d":563,"./components/errorbars":598,"./components/fx":609,"./components/grid":613,"./components/images":618,"./components/legend":627,"./components/rangeselector":638,"./components/rangeslider":644,"./components/shapes":652,"./components/sliders":657,"./components/updatemenus":663,"./fonts/mathjax_config":673,"./lib/queue":709,"./locale-en":723,"./locale-en-us":722,"./plot_api":727,"./plot_api/plot_schema":731,"./plots/plots":805,"./registry":825,"./snapshot":830,"./traces/scatter":1044,d3:147,"es6-promise":202}],673:[function(_dereq_,module,exports){"use strict";"undefined"!=typeof MathJax?(exports.MathJax=!0,MathJax.Hub.Config({messageStyle:"none",skipStartupTypeset:!0,displayAlign:"left",tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}}),MathJax.Hub.Configured()):exports.MathJax=!1},{}],674:[function(_dereq_,module,exports){"use strict";var modModule=_dereq_("./mod"),mod=modModule.mod,modHalf=modModule.modHalf,PI=Math.PI,twoPI=2*PI;function isFullCircle(aBnds){return Math.abs(aBnds[1]-aBnds[0])>twoPI-1e-15}function angleDelta(a,b){return modHalf(b-a,twoPI)}function isAngleInsideSector(a,aBnds){if(isFullCircle(aBnds))return!0;var s0,s1;aBnds[0]<aBnds[1]?(s0=aBnds[0],s1=aBnds[1]):(s0=aBnds[1],s1=aBnds[0]),(s0=mod(s0,twoPI))>(s1=mod(s1,twoPI))&&(s1+=twoPI);var a0=mod(a,twoPI),a1=a0+twoPI;return a0>=s0&&a0<=s1||a1>=s0&&a1<=s1}function _path(r0,r1,a0,a1,cx,cy,isClosed){cx=cx||0,cy=cy||0;var aStart,aMid,aEnd,rStart,rEnd,isCircle=isFullCircle([a0,a1]);function pt(r,a){return[r*Math.cos(a)+cx,cy-r*Math.sin(a)]}isCircle?(aStart=0,aMid=PI,aEnd=twoPI):a0<a1?(aStart=a0,aEnd=a1):(aStart=a1,aEnd=a0),r0<r1?(rStart=r0,rEnd=r1):(rStart=r1,rEnd=r0);var p,largeArc=Math.abs(aEnd-aStart)<=PI?0:1;function arc(r,a,cw){return"A"+[r,r]+" "+[0,largeArc,cw]+" "+pt(r,a)}return isCircle?p=null===rStart?"M"+pt(rEnd,aStart)+arc(rEnd,aMid,0)+arc(rEnd,aEnd,0)+"Z":"M"+pt(rStart,aStart)+arc(rStart,aMid,0)+arc(rStart,aEnd,0)+"ZM"+pt(rEnd,aStart)+arc(rEnd,aMid,1)+arc(rEnd,aEnd,1)+"Z":null===rStart?(p="M"+pt(rEnd,aStart)+arc(rEnd,aEnd,0),isClosed&&(p+="L0,0Z")):p="M"+pt(rStart,aStart)+"L"+pt(rEnd,aStart)+arc(rEnd,aEnd,0)+"L"+pt(rStart,aEnd)+arc(rStart,aStart,1)+"Z",p}module.exports={deg2rad:function deg2rad(deg){return deg/180*PI},rad2deg:function rad2deg(rad){return rad/PI*180},angleDelta:angleDelta,angleDist:function angleDist(a,b){return Math.abs(angleDelta(a,b))},isFullCircle:isFullCircle,isAngleInsideSector:isAngleInsideSector,isPtInsideSector:function isPtInsideSector(r,a,rBnds,aBnds){return!!isAngleInsideSector(a,aBnds)&&(rBnds[0]<rBnds[1]?(r0=rBnds[0],r1=rBnds[1]):(r0=rBnds[1],r1=rBnds[0]),r>=r0&&r<=r1);var r0,r1},pathArc:function pathArc(r,a0,a1,cx,cy){return _path(null,r,a0,a1,cx,cy,0)},pathSector:function pathSector(r,a0,a1,cx,cy){return _path(null,r,a0,a1,cx,cy,1)},pathAnnulus:function pathAnnulus(r0,r1,a0,a1,cx,cy){return _path(r0,r1,a0,a1,cx,cy,1)}}},{"./mod":701}],675:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),BADNUM=_dereq_("../constants/numerical").BADNUM,JUNK=/^['"%,$#\s']+|[, ]|['"%,$#\s']+$/g;module.exports=function cleanNumber(v){return"string"==typeof v&&(v=v.replace(JUNK,"")),isNumeric(v)?Number(v):BADNUM}},{"../constants/numerical":670,"fast-isnumeric":213}],676:[function(_dereq_,module,exports){"use strict";module.exports=function clearGlCanvases(gd){var fullLayout=gd._fullLayout;fullLayout._glcanvas&&fullLayout._glcanvas.size()&&fullLayout._glcanvas.each(function(d){d.regl&&d.regl.clear({color:!0,depth:!0})})}},{}],677:[function(_dereq_,module,exports){"use strict";module.exports=function clearResponsive(gd){gd._responsiveChartHandler&&(window.removeEventListener("resize",gd._responsiveChartHandler),delete gd._responsiveChartHandler)}},{}],678:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),tinycolor=_dereq_("tinycolor2"),baseTraceAttrs=_dereq_("../plots/attributes"),getColorscale=_dereq_("../components/colorscale/get_scale"),nestedProperty=(Object.keys(_dereq_("../components/colorscale/scales")),_dereq_("./nested_property")),counterRegex=_dereq_("./regex").counter,DESELECTDIM=_dereq_("../constants/interactions").DESELECTDIM,modHalf=_dereq_("./mod").modHalf,isArrayOrTypedArray=_dereq_("./is_array").isArrayOrTypedArray;function validate(value,opts){var valObjectDef=exports.valObjectMeta[opts.valType];if(opts.arrayOk&&isArrayOrTypedArray(value))return!0;if(valObjectDef.validateFunction)return valObjectDef.validateFunction(value,opts);var failed={},out=failed,propMock={set:function(v){out=v}};return valObjectDef.coerceFunction(value,propMock,failed,opts),out!==failed}exports.valObjectMeta={data_array:{coerceFunction:function(v,propOut,dflt){isArrayOrTypedArray(v)?propOut.set(v):void 0!==dflt&&propOut.set(dflt)}},enumerated:{coerceFunction:function(v,propOut,dflt,opts){opts.coerceNumber&&(v=+v),-1===opts.values.indexOf(v)?propOut.set(dflt):propOut.set(v)},validateFunction:function(v,opts){opts.coerceNumber&&(v=+v);for(var values=opts.values,i=0;i<values.length;i++){var k=String(values[i]);if("/"===k.charAt(0)&&"/"===k.charAt(k.length-1)){if(new RegExp(k.substr(1,k.length-2)).test(v))return!0}else if(v===values[i])return!0}return!1}},boolean:{coerceFunction:function(v,propOut,dflt){!0===v||!1===v?propOut.set(v):propOut.set(dflt)}},number:{coerceFunction:function(v,propOut,dflt,opts){!isNumeric(v)||void 0!==opts.min&&v<opts.min||void 0!==opts.max&&v>opts.max?propOut.set(dflt):propOut.set(+v)}},integer:{coerceFunction:function(v,propOut,dflt,opts){v%1||!isNumeric(v)||void 0!==opts.min&&v<opts.min||void 0!==opts.max&&v>opts.max?propOut.set(dflt):propOut.set(+v)}},string:{coerceFunction:function(v,propOut,dflt,opts){if("string"!=typeof v){var okToCoerce="number"==typeof v;!0!==opts.strict&&okToCoerce?propOut.set(String(v)):propOut.set(dflt)}else opts.noBlank&&!v?propOut.set(dflt):propOut.set(v)}},color:{coerceFunction:function(v,propOut,dflt){tinycolor(v).isValid()?propOut.set(v):propOut.set(dflt)}},colorlist:{coerceFunction:function(v,propOut,dflt){Array.isArray(v)&&v.length&&v.every(function isColor(color){return tinycolor(color).isValid()})?propOut.set(v):propOut.set(dflt)}},colorscale:{coerceFunction:function(v,propOut,dflt){propOut.set(getColorscale(v,dflt))}},angle:{coerceFunction:function(v,propOut,dflt){"auto"===v?propOut.set("auto"):isNumeric(v)?propOut.set(modHalf(+v,360)):propOut.set(dflt)}},subplotid:{coerceFunction:function(v,propOut,dflt,opts){var regex=opts.regex||counterRegex(dflt);"string"==typeof v&&regex.test(v)?propOut.set(v):propOut.set(dflt)},validateFunction:function(v,opts){var dflt=opts.dflt;return v===dflt||"string"==typeof v&&!!counterRegex(dflt).test(v)}},flaglist:{coerceFunction:function(v,propOut,dflt,opts){if("string"==typeof v)if(-1===(opts.extras||[]).indexOf(v)){for(var vParts=v.split("+"),i=0;i<vParts.length;){var vi=vParts[i];-1===opts.flags.indexOf(vi)||vParts.indexOf(vi)<i?vParts.splice(i,1):i++}vParts.length?propOut.set(vParts.join("+")):propOut.set(dflt)}else propOut.set(v);else propOut.set(dflt)}},any:{coerceFunction:function(v,propOut,dflt){void 0===v?propOut.set(dflt):propOut.set(v)}},info_array:{coerceFunction:function(v,propOut,dflt,opts){function coercePart(v,opts,dflt){var out,propPart={set:function(v){out=v}};return void 0===dflt&&(dflt=opts.dflt),exports.valObjectMeta[opts.valType].coerceFunction(v,propPart,dflt,opts),out}var twoD=2===opts.dimensions||"1-2"===opts.dimensions&&Array.isArray(v)&&Array.isArray(v[0]);if(Array.isArray(v)){var i,j,row,item,len2,vNew,items=opts.items,vOut=[],arrayItems=Array.isArray(items),arrayItems2D=arrayItems&&twoD&&Array.isArray(items[0]),innerItemsOnly=twoD&&arrayItems&&!arrayItems2D,len=arrayItems&&!innerItemsOnly?items.length:v.length;if(dflt=Array.isArray(dflt)?dflt:[],twoD)for(i=0;i<len;i++)for(vOut[i]=[],row=Array.isArray(v[i])?v[i]:[],len2=innerItemsOnly?items.length:arrayItems?items[i].length:row.length,j=0;j<len2;j++)item=innerItemsOnly?items[j]:arrayItems?items[i][j]:items,void 0!==(vNew=coercePart(row[j],item,(dflt[i]||[])[j]))&&(vOut[i][j]=vNew);else for(i=0;i<len;i++)void 0!==(vNew=coercePart(v[i],arrayItems?items[i]:items,dflt[i]))&&(vOut[i]=vNew);propOut.set(vOut)}else propOut.set(dflt)},validateFunction:function(v,opts){if(!Array.isArray(v))return!1;var items=opts.items,arrayItems=Array.isArray(items),twoD=2===opts.dimensions;if(!opts.freeLength&&v.length!==items.length)return!1;for(var i=0;i<v.length;i++)if(twoD){if(!Array.isArray(v[i])||!opts.freeLength&&v[i].length!==items[i].length)return!1;for(var j=0;j<v[i].length;j++)if(!validate(v[i][j],arrayItems?items[i][j]:items))return!1}else if(!validate(v[i],arrayItems?items[i]:items))return!1;return!0}}},exports.coerce=function(containerIn,containerOut,attributes,attribute,dflt){var opts=nestedProperty(attributes,attribute).get(),propIn=nestedProperty(containerIn,attribute),propOut=nestedProperty(containerOut,attribute),v=propIn.get(),template=containerOut._template;if(void 0===v&&template&&(v=nestedProperty(template,attribute).get(),template=0),void 0===dflt&&(dflt=opts.dflt),opts.arrayOk&&isArrayOrTypedArray(v))return propOut.set(v),v;var coerceFunction=exports.valObjectMeta[opts.valType].coerceFunction;coerceFunction(v,propOut,dflt,opts);var out=propOut.get();return template&&out===dflt&&!validate(v,opts)&&(coerceFunction(v=nestedProperty(template,attribute).get(),propOut,dflt,opts),out=propOut.get()),out},exports.coerce2=function(containerIn,containerOut,attributes,attribute,dflt){var propIn=nestedProperty(containerIn,attribute),propOut=exports.coerce(containerIn,containerOut,attributes,attribute,dflt),valIn=propIn.get();return void 0!==valIn&&null!==valIn&&propOut},exports.coerceFont=function(coerce,attr,dfltObj){var out={};return dfltObj=dfltObj||{},out.family=coerce(attr+".family",dfltObj.family),out.size=coerce(attr+".size",dfltObj.size),out.color=coerce(attr+".color",dfltObj.color),out},exports.coerceHoverinfo=function(traceIn,traceOut,layoutOut){var dflt,moduleAttrs=traceOut._module.attributes,attrs=moduleAttrs.hoverinfo?moduleAttrs:baseTraceAttrs,valObj=attrs.hoverinfo;if(1===layoutOut._dataLength){var flags="all"===valObj.dflt?valObj.flags.slice():valObj.dflt.split("+");flags.splice(flags.indexOf("name"),1),dflt=flags.join("+")}return exports.coerce(traceIn,traceOut,attrs,"hoverinfo",dflt)},exports.coerceSelectionMarkerOpacity=function(traceOut,coerce){if(traceOut.marker){var smoDflt,usmoDflt,mo=traceOut.marker.opacity;if(void 0!==mo)isArrayOrTypedArray(mo)||traceOut.selected||traceOut.unselected||(smoDflt=mo,usmoDflt=DESELECTDIM*mo),coerce("selected.marker.opacity",smoDflt),coerce("unselected.marker.opacity",usmoDflt)}},exports.validate=validate},{"../components/colorscale/get_scale":580,"../components/colorscale/scales":586,"../constants/interactions":669,"../plots/attributes":739,"./is_array":694,"./mod":701,"./nested_property":702,"./regex":710,"fast-isnumeric":213,tinycolor2:511}],679:[function(_dereq_,module,exports){"use strict";var MIN_MS,MAX_MS,d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Loggers=_dereq_("./loggers"),mod=_dereq_("./mod").mod,constants=_dereq_("../constants/numerical"),BADNUM=constants.BADNUM,ONEDAY=constants.ONEDAY,ONEHOUR=constants.ONEHOUR,ONEMIN=constants.ONEMIN,ONESEC=constants.ONESEC,EPOCHJD=constants.EPOCHJD,Registry=_dereq_("../registry"),utcFormat=d3.time.format.utc,DATETIME_REGEXP=/^\s*(-?\d\d\d\d|\d\d)(-(\d?\d)(-(\d?\d)([ Tt]([01]?\d|2[0-3])(:([0-5]\d)(:([0-5]\d(\.\d+)?))?(Z|z|[+\-]\d\d:?\d\d)?)?)?)?)?\s*$/m,DATETIME_REGEXP_CN=/^\s*(-?\d\d\d\d|\d\d)(-(\d?\di?)(-(\d?\d)([ Tt]([01]?\d|2[0-3])(:([0-5]\d)(:([0-5]\d(\.\d+)?))?(Z|z|[+\-]\d\d:?\d\d)?)?)?)?)?\s*$/m,YFIRST=(new Date).getFullYear()-70;function isWorldCalendar(calendar){return calendar&&Registry.componentsRegistry.calendars&&"string"==typeof calendar&&"gregorian"!==calendar}function lpad(val,digits){return String(val+Math.pow(10,digits)).substr(1)}exports.dateTick0=function(calendar,sunday){return isWorldCalendar(calendar)?sunday?Registry.getComponentMethod("calendars","CANONICAL_SUNDAY")[calendar]:Registry.getComponentMethod("calendars","CANONICAL_TICK")[calendar]:sunday?"2000-01-02":"2000-01-01"},exports.dfltRange=function(calendar){return isWorldCalendar(calendar)?Registry.getComponentMethod("calendars","DFLTRANGE")[calendar]:["2000-01-01","2001-01-01"]},exports.isJSDate=function(v){return"object"==typeof v&&null!==v&&"function"==typeof v.getTime},exports.dateTime2ms=function(s,calendar){if(exports.isJSDate(s)){var tzOffset=s.getTimezoneOffset()*ONEMIN,offsetTweak=(s.getUTCMinutes()-s.getMinutes())*ONEMIN+(s.getUTCSeconds()-s.getSeconds())*ONESEC+(s.getUTCMilliseconds()-s.getMilliseconds());if(offsetTweak){var comb=3*ONEMIN;tzOffset=tzOffset-comb/2+mod(offsetTweak-tzOffset+comb/2,comb)}return(s=Number(s)-tzOffset)>=MIN_MS&&s<=MAX_MS?s:BADNUM}if("string"!=typeof s&&"number"!=typeof s)return BADNUM;s=String(s);var isWorld=isWorldCalendar(calendar),s0=s.charAt(0);!isWorld||"G"!==s0&&"g"!==s0||(s=s.substr(1),calendar="");var isChinese=isWorld&&"chinese"===calendar.substr(0,7),match=s.match(isChinese?DATETIME_REGEXP_CN:DATETIME_REGEXP);if(!match)return BADNUM;var y=match[1],m=match[3]||"1",d=Number(match[5]||1),H=Number(match[7]||0),M=Number(match[9]||0),S=Number(match[11]||0);if(isWorld){if(2===y.length)return BADNUM;var cDate;y=Number(y);try{var calInstance=Registry.getComponentMethod("calendars","getCal")(calendar);if(isChinese){var isIntercalary="i"===m.charAt(m.length-1);m=parseInt(m,10),cDate=calInstance.newDate(y,calInstance.toMonthIndex(y,m,isIntercalary),d)}else cDate=calInstance.newDate(y,Number(m),d)}catch(e){return BADNUM}return cDate?(cDate.toJD()-EPOCHJD)*ONEDAY+H*ONEHOUR+M*ONEMIN+S*ONESEC:BADNUM}y=2===y.length?(Number(y)+2e3-YFIRST)%100+YFIRST:Number(y),m-=1;var date=new Date(Date.UTC(2e3,m,d,H,M));return date.setUTCFullYear(y),date.getUTCMonth()!==m?BADNUM:date.getUTCDate()!==d?BADNUM:date.getTime()+S*ONESEC},MIN_MS=exports.MIN_MS=exports.dateTime2ms("-9999"),MAX_MS=exports.MAX_MS=exports.dateTime2ms("9999-12-31 23:59:59.9999"),exports.isDateTime=function(s,calendar){return exports.dateTime2ms(s,calendar)!==BADNUM};var NINETYDAYS=90*ONEDAY,THREEHOURS=3*ONEHOUR,FIVEMIN=5*ONEMIN;function includeTime(dateStr,h,m,s,msec10){if((h||m||s||msec10)&&(dateStr+=" "+lpad(h,2)+":"+lpad(m,2),(s||msec10)&&(dateStr+=":"+lpad(s,2),msec10))){for(var digits=4;msec10%10==0;)digits-=1,msec10/=10;dateStr+="."+lpad(msec10,digits)}return dateStr}exports.ms2DateTime=function(ms,r,calendar){if("number"!=typeof ms||!(ms>=MIN_MS&&ms<=MAX_MS))return BADNUM;r||(r=0);var dateStr,h,m,s,msec10,d,msecTenths=Math.floor(10*mod(ms+.05,1)),msRounded=Math.round(ms-msecTenths/10);if(isWorldCalendar(calendar)){var dateJD=Math.floor(msRounded/ONEDAY)+EPOCHJD,timeMs=Math.floor(mod(ms,ONEDAY));try{dateStr=Registry.getComponentMethod("calendars","getCal")(calendar).fromJD(dateJD).formatDate("yyyy-mm-dd")}catch(e){dateStr=utcFormat("G%Y-%m-%d")(new Date(msRounded))}if("-"===dateStr.charAt(0))for(;dateStr.length<11;)dateStr="-0"+dateStr.substr(1);else for(;dateStr.length<10;)dateStr="0"+dateStr;h=r<NINETYDAYS?Math.floor(timeMs/ONEHOUR):0,m=r<NINETYDAYS?Math.floor(timeMs%ONEHOUR/ONEMIN):0,s=r<THREEHOURS?Math.floor(timeMs%ONEMIN/ONESEC):0,msec10=r<FIVEMIN?timeMs%ONESEC*10+msecTenths:0}else d=new Date(msRounded),dateStr=utcFormat("%Y-%m-%d")(d),h=r<NINETYDAYS?d.getUTCHours():0,m=r<NINETYDAYS?d.getUTCMinutes():0,s=r<THREEHOURS?d.getUTCSeconds():0,msec10=r<FIVEMIN?10*d.getUTCMilliseconds()+msecTenths:0;return includeTime(dateStr,h,m,s,msec10)},exports.ms2DateTimeLocal=function(ms){if(!(ms>=MIN_MS+ONEDAY&&ms<=MAX_MS-ONEDAY))return BADNUM;var msecTenths=Math.floor(10*mod(ms+.05,1)),d=new Date(Math.round(ms-msecTenths/10));return includeTime(d3.time.format("%Y-%m-%d")(d),d.getHours(),d.getMinutes(),d.getSeconds(),10*d.getUTCMilliseconds()+msecTenths)},exports.cleanDate=function(v,dflt,calendar){if(exports.isJSDate(v)||"number"==typeof v){if(isWorldCalendar(calendar))return Loggers.error("JS Dates and milliseconds are incompatible with world calendars",v),dflt;if(!(v=exports.ms2DateTimeLocal(+v))&&void 0!==dflt)return dflt}else if(!exports.isDateTime(v,calendar))return Loggers.error("unrecognized date",v),dflt;return v};var fracMatch=/%\d?f/g;function modDateFormat(fmt,x,formatter,calendar){fmt=fmt.replace(fracMatch,function(match){var digits=Math.min(+match.charAt(1)||6,6);return(x/1e3%1+2).toFixed(digits).substr(2).replace(/0+$/,"")||"0"});var d=new Date(Math.floor(x+.05));if(isWorldCalendar(calendar))try{fmt=Registry.getComponentMethod("calendars","worldCalFmt")(fmt,x,calendar)}catch(e){return"Invalid"}return formatter(fmt)(d)}var MAXSECONDS=[59,59.9,59.99,59.999,59.9999];exports.formatDate=function(x,fmt,tr,formatter,calendar,extraFormat){if(calendar=isWorldCalendar(calendar)&&calendar,!fmt)if("y"===tr)fmt=extraFormat.year;else if("m"===tr)fmt=extraFormat.month;else{if("d"!==tr)return function formatTime(x,tr){var timePart=mod(x+.05,ONEDAY),timeStr=lpad(Math.floor(timePart/ONEHOUR),2)+":"+lpad(mod(Math.floor(timePart/ONEMIN),60),2);if("M"!==tr){isNumeric(tr)||(tr=0);var secStr=(100+Math.min(mod(x/ONESEC,60),MAXSECONDS[tr])).toFixed(tr).substr(1);tr>0&&(secStr=secStr.replace(/0+$/,"").replace(/[\.]$/,"")),timeStr+=":"+secStr}return timeStr}(x,tr)+"\n"+modDateFormat(extraFormat.dayMonthYear,x,formatter,calendar);fmt=extraFormat.dayMonth+"\n"+extraFormat.year}return modDateFormat(fmt,x,formatter,calendar)};var THREEDAYS=3*ONEDAY;exports.incrementMonth=function(ms,dMonth,calendar){calendar=isWorldCalendar(calendar)&&calendar;var timeMs=mod(ms,ONEDAY);if(ms=Math.round(ms-timeMs),calendar)try{var dateJD=Math.round(ms/ONEDAY)+EPOCHJD,calInstance=Registry.getComponentMethod("calendars","getCal")(calendar),cDate=calInstance.fromJD(dateJD);return dMonth%12?calInstance.add(cDate,dMonth,"m"):calInstance.add(cDate,dMonth/12,"y"),(cDate.toJD()-EPOCHJD)*ONEDAY+timeMs}catch(e){Loggers.error("invalid ms "+ms+" in calendar "+calendar)}var y=new Date(ms+THREEDAYS);return y.setUTCMonth(y.getUTCMonth()+dMonth)+timeMs-THREEDAYS},exports.findExactDates=function(data,calendar){for(var d,di,exactYears=0,exactMonths=0,exactDays=0,blankCount=0,calInstance=isWorldCalendar(calendar)&&Registry.getComponentMethod("calendars","getCal")(calendar),i=0;i<data.length;i++)if(di=data[i],isNumeric(di)){if(!(di%ONEDAY))if(calInstance)try{1===(d=calInstance.fromJD(di/ONEDAY+EPOCHJD)).day()?1===d.month()?exactYears++:exactMonths++:exactDays++}catch(e){}else 1===(d=new Date(di)).getUTCDate()?0===d.getUTCMonth()?exactYears++:exactMonths++:exactDays++}else blankCount++;exactDays+=exactMonths+=exactYears;var dataCount=data.length-blankCount;return{exactYears:exactYears/dataCount,exactMonths:exactMonths/dataCount,exactDays:exactDays/dataCount}}},{"../constants/numerical":670,"../registry":825,"./loggers":698,"./mod":701,d3:147,"fast-isnumeric":213}],680:[function(_dereq_,module,exports){"use strict";module.exports=function ensureArray(out,n){return Array.isArray(out)||(out=[]),out.length=n,out}},{}],681:[function(_dereq_,module,exports){"use strict";var EventEmitter=_dereq_("events").EventEmitter,Events={init:function(plotObj){if(plotObj._ev instanceof EventEmitter)return plotObj;var ev=new EventEmitter,internalEv=new EventEmitter;return plotObj._ev=ev,plotObj._internalEv=internalEv,plotObj.on=ev.on.bind(ev),plotObj.once=ev.once.bind(ev),plotObj.removeListener=ev.removeListener.bind(ev),plotObj.removeAllListeners=ev.removeAllListeners.bind(ev),plotObj._internalOn=internalEv.on.bind(internalEv),plotObj._internalOnce=internalEv.once.bind(internalEv),plotObj._removeInternalListener=internalEv.removeListener.bind(internalEv),plotObj._removeAllInternalListeners=internalEv.removeAllListeners.bind(internalEv),plotObj.emit=function(event,data){"undefined"!=typeof jQuery&&jQuery(plotObj).trigger(event,data),ev.emit(event,data),internalEv.emit(event,data)},plotObj},triggerHandler:function(plotObj,event,data){var jQueryHandlerValue,nodeEventHandlerValue;"undefined"!=typeof jQuery&&(jQueryHandlerValue=jQuery(plotObj).triggerHandler(event,data));var ev=plotObj._ev;if(!ev)return jQueryHandlerValue;var i,handlers=ev._events[event];if(!handlers)return jQueryHandlerValue;function apply(handler){return handler.listener?(ev.removeListener(event,handler.listener),handler.fired?void 0:(handler.fired=!0,handler.listener.apply(ev,[data]))):handler.apply(ev,[data])}for(handlers=Array.isArray(handlers)?handlers:[handlers],i=0;i<handlers.length-1;i++)apply(handlers[i]);return nodeEventHandlerValue=apply(handlers[i]),void 0!==jQueryHandlerValue?jQueryHandlerValue:nodeEventHandlerValue},purge:function(plotObj){return delete plotObj._ev,delete plotObj.on,delete plotObj.once,delete plotObj.removeListener,delete plotObj.removeAllListeners,delete plotObj.emit,delete plotObj._ev,delete plotObj._internalEv,delete plotObj._internalOn,delete plotObj._internalOnce,delete plotObj._removeInternalListener,delete plotObj._removeAllInternalListeners,plotObj}};module.exports=Events},{events:91}],682:[function(_dereq_,module,exports){"use strict";var isPlainObject=_dereq_("./is_plain_object.js"),isArray=Array.isArray;function _extend(inputs,isDeep,keepAllKeys,noArrayCopies){var input,key,src,copy,copyIsArray,clone,target=inputs[0],length=inputs.length;if(2===length&&isArray(target)&&isArray(inputs[1])&&0===target.length){if(function primitivesLoopSplice(source,target){var i,value;for(i=0;i<source.length;i++){if(null!==(value=source[i])&&"object"==typeof value)return!1;void 0!==value&&(target[i]=value)}return!0}(inputs[1],target))return target;target.splice(0,target.length)}for(var i=1;i<length;i++)for(key in input=inputs[i])src=target[key],copy=input[key],noArrayCopies&&isArray(copy)?target[key]=copy:isDeep&&copy&&(isPlainObject(copy)||(copyIsArray=isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&isArray(src)?src:[]):clone=src&&isPlainObject(src)?src:{},target[key]=_extend([clone,copy],isDeep,keepAllKeys,noArrayCopies)):(void 0!==copy||keepAllKeys)&&(target[key]=copy);return target}exports.extendFlat=function(){return _extend(arguments,!1,!1,!1)},exports.extendDeep=function(){return _extend(arguments,!0,!1,!1)},exports.extendDeepAll=function(){return _extend(arguments,!0,!0,!1)},exports.extendDeepNoArrays=function(){return _extend(arguments,!0,!1,!0)}},{"./is_plain_object.js":695}],683:[function(_dereq_,module,exports){"use strict";module.exports=function filterUnique(array){for(var seen={},out=[],j=0,i=0;i<array.length;i++){var item=array[i];1!==seen[item]&&(seen[item]=1,out[j++]=item)}return out}},{}],684:[function(_dereq_,module,exports){"use strict";function baseFilter(item){return!0===item.visible}function calcDataFilter(item){return!0===item[0].trace.visible}module.exports=function filterVisible(container){for(var filterFn=function isCalcData(cont){return Array.isArray(cont)&&Array.isArray(cont[0])&&cont[0][0]&&cont[0][0].trace}(container)?calcDataFilter:baseFilter,out=[],i=0;i<container.length;i++){var item=container[i];filterFn(item)&&out.push(item)}return out}},{}],685:[function(_dereq_,module,exports){"use strict";var countryRegex=_dereq_("country-regex"),Lib=_dereq_("../lib"),countryIds=Object.keys(countryRegex),locationmodeToIdFinder={"ISO-3":Lib.identity,"USA-states":Lib.identity,"country names":function countryNameToISO3(countryName){for(var i=0;i<countryIds.length;i++){var iso3=countryIds[i],regex=new RegExp(countryRegex[iso3]);if(regex.test(countryName.trim().toLowerCase()))return iso3}return Lib.log("Unrecognized country name: "+countryName+"."),!1}};exports.locationToFeature=function(locationmode,location,features){if(!location||"string"!=typeof location)return!1;var locationId=function getLocationId(locationmode,location){return(0,locationmodeToIdFinder[locationmode])(location)}(locationmode,location);if(locationId){for(var i=0;i<features.length;i++){var feature=features[i];if(feature.id===locationId)return feature}Lib.log(["Location with id",locationId,"does not have a matching topojson feature at this resolution."].join(" "))}return!1}},{"../lib":693,"country-regex":121}],686:[function(_dereq_,module,exports){"use strict";var BADNUM=_dereq_("../constants/numerical").BADNUM;exports.calcTraceToLineCoords=function(calcTrace){for(var connectgaps=calcTrace[0].trace.connectgaps,coords=[],lineString=[],i=0;i<calcTrace.length;i++){var lonlat=calcTrace[i].lonlat;lonlat[0]!==BADNUM?lineString.push(lonlat):!connectgaps&&lineString.length>0&&(coords.push(lineString),lineString=[])}return lineString.length>0&&coords.push(lineString),coords},exports.makeLine=function(coords){return 1===coords.length?{type:"LineString",coordinates:coords[0]}:{type:"MultiLineString",coordinates:coords}},exports.makePolygon=function(coords){if(1===coords.length)return{type:"Polygon",coordinates:coords};for(var _coords=new Array(coords.length),i=0;i<coords.length;i++)_coords[i]=[coords[i]];return{type:"MultiPolygon",coordinates:_coords}},exports.makeBlank=function(){return{type:"Point",coordinates:[]}}},{"../constants/numerical":670}],687:[function(_dereq_,module,exports){"use strict";var locationCache,workingPath,workingTextWidth,mod=_dereq_("./mod").mod;function segmentsIntersect(x1,y1,x2,y2,x3,y3,x4,y4){var a=x2-x1,b=x3-x1,c=x4-x3,d=y2-y1,e=y3-y1,f=y4-y3,det=a*f-c*d;if(0===det)return null;var t=(b*f-c*e)/det,u=(b*d-a*e)/det;return u<0||u>1||t<0||t>1?null:{x:x1+a*t,y:y1+d*t}}function perpDistance2(xab,yab,l2_ab,xac,yac){var fc_ab=xac*xab+yac*yab;if(fc_ab<0)return xac*xac+yac*yac;if(fc_ab>l2_ab){var xbc=xac-xab,ybc=yac-yab;return xbc*xbc+ybc*ybc}var crossProduct=xac*yab-yac*xab;return crossProduct*crossProduct/l2_ab}exports.segmentsIntersect=segmentsIntersect,exports.segmentDistance=function segmentDistance(x1,y1,x2,y2,x3,y3,x4,y4){if(segmentsIntersect(x1,y1,x2,y2,x3,y3,x4,y4))return 0;var x12=x2-x1,y12=y2-y1,x34=x4-x3,y34=y4-y3,l2_12=x12*x12+y12*y12,l2_34=x34*x34+y34*y34,dist2=Math.min(perpDistance2(x12,y12,l2_12,x3-x1,y3-y1),perpDistance2(x12,y12,l2_12,x4-x1,y4-y1),perpDistance2(x34,y34,l2_34,x1-x3,y1-y3),perpDistance2(x34,y34,l2_34,x2-x3,y2-y3));return Math.sqrt(dist2)},exports.getTextLocation=function getTextLocation(path,totalPathLen,positionOnPath,textWidth){if(path===workingPath&&textWidth===workingTextWidth||(locationCache={},workingPath=path,workingTextWidth=textWidth),locationCache[positionOnPath])return locationCache[positionOnPath];var p0=path.getPointAtLength(mod(positionOnPath-textWidth/2,totalPathLen)),p1=path.getPointAtLength(mod(positionOnPath+textWidth/2,totalPathLen)),theta=Math.atan((p1.y-p0.y)/(p1.x-p0.x)),pCenter=path.getPointAtLength(mod(positionOnPath,totalPathLen)),out={x:(4*pCenter.x+p0.x+p1.x)/6,y:(4*pCenter.y+p0.y+p1.y)/6,theta:theta};return locationCache[positionOnPath]=out,out},exports.clearLocationCache=function(){workingPath=null},exports.getVisibleSegment=function getVisibleSegment(path,bounds,buffer){var pt0,ptTotal,left=bounds.left,right=bounds.right,top=bounds.top,bottom=bounds.bottom,pMin=0,pTotal=path.getTotalLength(),pMax=pTotal;function getDistToPlot(len){var pt=path.getPointAtLength(len);0===len?pt0=pt:len===pTotal&&(ptTotal=pt);var dx=pt.x<left?left-pt.x:pt.x>right?pt.x-right:0,dy=pt.y<top?top-pt.y:pt.y>bottom?pt.y-bottom:0;return Math.sqrt(dx*dx+dy*dy)}for(var distToPlot=getDistToPlot(pMin);distToPlot;){if((pMin+=distToPlot+buffer)>pMax)return;distToPlot=getDistToPlot(pMin)}for(distToPlot=getDistToPlot(pMax);distToPlot;){if(pMin>(pMax-=distToPlot+buffer))return;distToPlot=getDistToPlot(pMax)}return{min:pMin,max:pMax,len:pMax-pMin,total:pTotal,isClosed:0===pMin&&pMax===pTotal&&Math.abs(pt0.x-ptTotal.x)<.1&&Math.abs(pt0.y-ptTotal.y)<.1}},exports.findPointOnPath=function findPointOnPath(path,val,coord,opts){for(var mid,pt,diff,pathLength=(opts=opts||{}).pathLength||path.getTotalLength(),tolerance=opts.tolerance||.001,iterationLimit=opts.iterationLimit||30,mul=path.getPointAtLength(0)[coord]>path.getPointAtLength(pathLength)[coord]?-1:1,i=0,b0=0,b1=pathLength;i<iterationLimit;){if(mid=(b0+b1)/2,diff=(pt=path.getPointAtLength(mid))[coord]-val,Math.abs(diff)<tolerance)return pt;mul*diff>0?b1=mid:b0=mid,i++}return pt}},{"./mod":701}],688:[function(_dereq_,module,exports){"use strict";module.exports=function(gd){var gdElement;if("string"==typeof gd){if(null===(gdElement=document.getElementById(gd)))throw new Error("No DOM element with id '"+gd+"' exists on the page.");return gdElement}if(null===gd||void 0===gd)throw new Error("DOM element provided is null or undefined");return gd}},{}],689:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),tinycolor=_dereq_("tinycolor2"),rgba=_dereq_("color-normalize"),Colorscale=_dereq_("../components/colorscale"),colorDflt=_dereq_("../components/color/attributes").defaultLine,isArrayOrTypedArray=_dereq_("./is_array").isArrayOrTypedArray,colorDfltRgba=rgba(colorDflt),opacityDflt=1;function calculateColor(colorIn,opacityIn){var colorOut=colorIn;return colorOut[3]*=opacityIn,colorOut}function validateColor(colorIn){if(isNumeric(colorIn))return colorDfltRgba;var colorOut=rgba(colorIn);return colorOut.length?colorOut:colorDfltRgba}function validateOpacity(opacityIn){return isNumeric(opacityIn)?opacityIn:opacityDflt}module.exports={formatColor:function formatColor(containerIn,opacityIn,len){var sclFunc,getColor,getOpacity,colori,opacityi,colorIn=containerIn.color,isArrayColorIn=isArrayOrTypedArray(colorIn),isArrayOpacityIn=isArrayOrTypedArray(opacityIn),colorOut=[];if(sclFunc=void 0!==containerIn.colorscale?Colorscale.makeColorScaleFunc(Colorscale.extractScale(containerIn.colorscale,containerIn.cmin,containerIn.cmax)):validateColor,getColor=isArrayColorIn?function(c,i){return void 0===c[i]?colorDfltRgba:rgba(sclFunc(c[i]))}:validateColor,getOpacity=isArrayOpacityIn?function(o,i){return void 0===o[i]?opacityDflt:validateOpacity(o[i])}:validateOpacity,isArrayColorIn||isArrayOpacityIn)for(var i=0;i<len;i++)colori=getColor(colorIn,i),opacityi=getOpacity(opacityIn,i),colorOut[i]=calculateColor(colori,opacityi);else colorOut=calculateColor(rgba(colorIn),opacityIn);return colorOut},parseColorScale:function parseColorScale(colorscale,alpha){return void 0===alpha&&(alpha=1),colorscale.map(function(elem){var index=elem[0],rgb=tinycolor(elem[1]).toRgb();return{index:index,rgb:[rgb.r,rgb.g,rgb.b,alpha]}})}}},{"../components/color/attributes":566,"../components/colorscale":582,"./is_array":694,"color-normalize":107,"fast-isnumeric":213,tinycolor2:511}],690:[function(_dereq_,module,exports){"use strict";var identity=_dereq_("./identity");function wrap(d){return[d]}module.exports={keyFun:function(d){return d.key},repeat:wrap,descend:identity,wrap:wrap,unwrap:function(d){return d[0]}}},{"./identity":692}],691:[function(_dereq_,module,exports){"use strict";var toSuperScript=_dereq_("superscript-text"),fixEntities=_dereq_("./svg_text_utils").convertEntities;module.exports=function convertHTMLToUnicode(html){return""+fixEntities(function stripTags(x){return x.replace(/\<.*\>/g,"")}(function fixSuperScript(x){for(var idx=0;(idx=x.indexOf("<sup>",idx))>=0;){var nidx=x.indexOf("</sup>",idx);if(nidx<idx)break;x=x.slice(0,idx)+toSuperScript(x.slice(idx+5,nidx))+x.slice(nidx+6)}return x}(function fixBR(x){return x.replace(/\<br\>/g,"\n")}(html))))}},{"./svg_text_utils":718,"superscript-text":504}],692:[function(_dereq_,module,exports){"use strict";module.exports=function identity(d){return d}},{}],693:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),numConstants=_dereq_("../constants/numerical"),FP_SAFE=numConstants.FP_SAFE,BADNUM=numConstants.BADNUM,lib=module.exports={};lib.nestedProperty=_dereq_("./nested_property"),lib.keyedContainer=_dereq_("./keyed_container"),lib.relativeAttr=_dereq_("./relative_attr"),lib.isPlainObject=_dereq_("./is_plain_object"),lib.toLogRange=_dereq_("./to_log_range"),lib.relinkPrivateKeys=_dereq_("./relink_private"),lib.ensureArray=_dereq_("./ensure_array");var modModule=_dereq_("./mod");lib.mod=modModule.mod,lib.modHalf=modModule.modHalf;var isArrayModule=_dereq_("./is_array");lib.isTypedArray=isArrayModule.isTypedArray,lib.isArrayOrTypedArray=isArrayModule.isArrayOrTypedArray,lib.isArray1D=isArrayModule.isArray1D;var coerceModule=_dereq_("./coerce");lib.valObjectMeta=coerceModule.valObjectMeta,lib.coerce=coerceModule.coerce,lib.coerce2=coerceModule.coerce2,lib.coerceFont=coerceModule.coerceFont,lib.coerceHoverinfo=coerceModule.coerceHoverinfo,lib.coerceSelectionMarkerOpacity=coerceModule.coerceSelectionMarkerOpacity,lib.validate=coerceModule.validate;var datesModule=_dereq_("./dates");lib.dateTime2ms=datesModule.dateTime2ms,lib.isDateTime=datesModule.isDateTime,lib.ms2DateTime=datesModule.ms2DateTime,lib.ms2DateTimeLocal=datesModule.ms2DateTimeLocal,lib.cleanDate=datesModule.cleanDate,lib.isJSDate=datesModule.isJSDate,lib.formatDate=datesModule.formatDate,lib.incrementMonth=datesModule.incrementMonth,lib.dateTick0=datesModule.dateTick0,lib.dfltRange=datesModule.dfltRange,lib.findExactDates=datesModule.findExactDates,lib.MIN_MS=datesModule.MIN_MS,lib.MAX_MS=datesModule.MAX_MS;var searchModule=_dereq_("./search");lib.findBin=searchModule.findBin,lib.sorterAsc=searchModule.sorterAsc,lib.sorterDes=searchModule.sorterDes,lib.distinctVals=searchModule.distinctVals,lib.roundUp=searchModule.roundUp,lib.sort=searchModule.sort,lib.findIndexOfMin=searchModule.findIndexOfMin;var statsModule=_dereq_("./stats");lib.aggNums=statsModule.aggNums,lib.len=statsModule.len,lib.mean=statsModule.mean,lib.midRange=statsModule.midRange,lib.variance=statsModule.variance,lib.stdev=statsModule.stdev,lib.interp=statsModule.interp;var matrixModule=_dereq_("./matrix");lib.init2dArray=matrixModule.init2dArray,lib.transposeRagged=matrixModule.transposeRagged,lib.dot=matrixModule.dot,lib.translationMatrix=matrixModule.translationMatrix,lib.rotationMatrix=matrixModule.rotationMatrix,lib.rotationXYMatrix=matrixModule.rotationXYMatrix,lib.apply2DTransform=matrixModule.apply2DTransform,lib.apply2DTransform2=matrixModule.apply2DTransform2;var anglesModule=_dereq_("./angles");lib.deg2rad=anglesModule.deg2rad,lib.rad2deg=anglesModule.rad2deg,lib.angleDelta=anglesModule.angleDelta,lib.angleDist=anglesModule.angleDist,lib.isFullCircle=anglesModule.isFullCircle,lib.isAngleInsideSector=anglesModule.isAngleInsideSector,lib.isPtInsideSector=anglesModule.isPtInsideSector,lib.pathArc=anglesModule.pathArc,lib.pathSector=anglesModule.pathSector,lib.pathAnnulus=anglesModule.pathAnnulus;var geom2dModule=_dereq_("./geometry2d");lib.segmentsIntersect=geom2dModule.segmentsIntersect,lib.segmentDistance=geom2dModule.segmentDistance,lib.getTextLocation=geom2dModule.getTextLocation,lib.clearLocationCache=geom2dModule.clearLocationCache,lib.getVisibleSegment=geom2dModule.getVisibleSegment,lib.findPointOnPath=geom2dModule.findPointOnPath;var extendModule=_dereq_("./extend");lib.extendFlat=extendModule.extendFlat,lib.extendDeep=extendModule.extendDeep,lib.extendDeepAll=extendModule.extendDeepAll,lib.extendDeepNoArrays=extendModule.extendDeepNoArrays;var loggersModule=_dereq_("./loggers");lib.log=loggersModule.log,lib.warn=loggersModule.warn,lib.error=loggersModule.error;var regexModule=_dereq_("./regex");lib.counterRegex=regexModule.counter;var throttleModule=_dereq_("./throttle");function makePtIndex2PtNumber(indexToPoints){var ptIndex2ptNumber={};for(var k in indexToPoints)for(var pts=indexToPoints[k],j=0;j<pts.length;j++)ptIndex2ptNumber[pts[j]]=+k;return ptIndex2ptNumber}lib.throttle=throttleModule.throttle,lib.throttleDone=throttleModule.done,lib.clearThrottle=throttleModule.clear,lib.getGraphDiv=_dereq_("./get_graph_div"),lib.clearResponsive=_dereq_("./clear_responsive"),lib.makeTraceGroups=_dereq_("./make_trace_groups"),lib._=_dereq_("./localize"),lib.notifier=_dereq_("./notifier"),lib.filterUnique=_dereq_("./filter_unique"),lib.filterVisible=_dereq_("./filter_visible"),lib.pushUnique=_dereq_("./push_unique"),lib.cleanNumber=_dereq_("./clean_number"),lib.ensureNumber=function num(v){return isNumeric(v)?(v=Number(v))<-FP_SAFE||v>FP_SAFE?BADNUM:isNumeric(v)?Number(v):BADNUM:BADNUM},lib.isIndex=function(v,len){return!(void 0!==len&&v>=len)&&(isNumeric(v)&&v>=0&&v%1==0)},lib.noop=_dereq_("./noop"),lib.identity=_dereq_("./identity"),lib.repeat=function(v,cnt){for(var out=new Array(cnt),i=0;i<cnt;i++)out[i]=v;return out},lib.swapAttrs=function(cont,attrList,part1,part2){part1||(part1="x"),part2||(part2="y");for(var i=0;i<attrList.length;i++){var attr=attrList[i],xp=lib.nestedProperty(cont,attr.replace("?",part1)),yp=lib.nestedProperty(cont,attr.replace("?",part2)),temp=xp.get();xp.set(yp.get()),yp.set(temp)}},lib.raiseToTop=function raiseToTop(elem){elem.parentNode.appendChild(elem)},lib.cancelTransition=function(selection){return selection.transition().duration(0)},lib.constrain=function(v,v0,v1){return v0>v1?Math.max(v1,Math.min(v0,v)):Math.max(v0,Math.min(v1,v))},lib.bBoxIntersect=function(a,b,pad){return pad=pad||0,a.left<=b.right+pad&&b.left<=a.right+pad&&a.top<=b.bottom+pad&&b.top<=a.bottom+pad},lib.simpleMap=function(array,func,x1,x2){for(var len=array.length,out=new Array(len),i=0;i<len;i++)out[i]=func(array[i],x1,x2);return out},lib.randstr=function randstr(existing,bits,base,_recursion){if(base||(base=16),void 0===bits&&(bits=24),bits<=0)return"0";var i,b,digits=Math.log(Math.pow(2,bits))/Math.log(base),res="";for(i=2;digits===1/0;i*=2)digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;var rem=digits-Math.floor(digits);for(i=0;i<Math.floor(digits);i++)res=Math.floor(Math.random()*base).toString(base)+res;rem&&(b=Math.pow(base,rem),res=Math.floor(Math.random()*b).toString(base)+res);var parsed=parseInt(res,base);return existing&&existing[res]||parsed!==1/0&&parsed>=Math.pow(2,bits)?_recursion>10?(lib.warn("randstr failed uniqueness"),res):randstr(existing,bits,base,(_recursion||0)+1):res},lib.OptionControl=function(opt,optname){opt||(opt={}),optname||(optname="opt");var self={optionList:[],_newoption:function(optObj){optObj[optname]=opt,self[optObj.name]=optObj,self.optionList.push(optObj)}};return self["_"+optname]=opt,self},lib.smooth=function(arrayIn,FWHM){if((FWHM=Math.round(FWHM)||0)<2)return arrayIn;var i,j,k,v,alen=arrayIn.length,alen2=2*alen,wlen=2*FWHM-1,w=new Array(wlen),arrayOut=new Array(alen);for(i=0;i<wlen;i++)w[i]=(1-Math.cos(Math.PI*(i+1)/FWHM))/(2*FWHM);for(i=0;i<alen;i++){for(v=0,j=0;j<wlen;j++)(k=i+j+1-FWHM)<-alen?k-=alen2*Math.round(k/alen2):k>=alen2&&(k-=alen2*Math.floor(k/alen2)),k<0?k=-1-k:k>=alen&&(k=alen2-1-k),v+=arrayIn[k]*w[j];arrayOut[i]=v}return arrayOut},lib.syncOrAsync=function(sequence,arg,finalStep){var ret;function continueAsync(){return lib.syncOrAsync(sequence,arg,finalStep)}for(;sequence.length;)if((ret=(0,sequence.splice(0,1)[0])(arg))&&ret.then)return ret.then(continueAsync).then(void 0,lib.promiseError);return finalStep&&finalStep(arg)},lib.stripTrailingSlash=function(str){return"/"===str.substr(-1)?str.substr(0,str.length-1):str},lib.noneOrAll=function(containerIn,containerOut,attrList){if(containerIn){var i,val,hasAny=!1,hasAll=!0;for(i=0;i<attrList.length;i++)void 0!==(val=containerIn[attrList[i]])&&null!==val?hasAny=!0:hasAll=!1;if(hasAny&&!hasAll)for(i=0;i<attrList.length;i++)containerIn[attrList[i]]=containerOut[attrList[i]]}},lib.mergeArray=function(traceAttr,cd,cdAttr){if(lib.isArrayOrTypedArray(traceAttr))for(var imax=Math.min(traceAttr.length,cd.length),i=0;i<imax;i++)cd[i][cdAttr]=traceAttr[i]},lib.fillArray=function(traceAttr,cd,cdAttr,fn){if(fn=fn||lib.identity,lib.isArrayOrTypedArray(traceAttr))for(var i=0;i<cd.length;i++)cd[i][cdAttr]=fn(traceAttr[i])},lib.castOption=function(trace,ptNumber,astr,fn){fn=fn||lib.identity;var val=lib.nestedProperty(trace,astr).get();return lib.isArrayOrTypedArray(val)?Array.isArray(ptNumber)&&lib.isArrayOrTypedArray(val[ptNumber[0]])?fn(val[ptNumber[0]][ptNumber[1]]):fn(val[ptNumber]):val},lib.extractOption=function(calcPt,trace,calcKey,traceKey){if(calcKey in calcPt)return calcPt[calcKey];var traceVal=lib.nestedProperty(trace,traceKey).get();return Array.isArray(traceVal)?void 0:traceVal},lib.tagSelected=function(calcTrace,trace,ptNumber2cdIndex){var ptIndex2ptNumber,v,selectedpoints=trace.selectedpoints,indexToPoints=trace._indexToPoints;indexToPoints&&(ptIndex2ptNumber=makePtIndex2PtNumber(indexToPoints));for(var i=0;i<selectedpoints.length;i++){var ptIndex=selectedpoints[i];if(lib.isIndex(ptIndex)){var ptNumber=ptIndex2ptNumber?ptIndex2ptNumber[ptIndex]:ptIndex,cdIndex=ptNumber2cdIndex?ptNumber2cdIndex[ptNumber]:ptNumber;void 0!==(v=cdIndex)&&v<calcTrace.length&&(calcTrace[cdIndex].selected=1)}}},lib.selIndices2selPoints=function(trace){var selectedpoints=trace.selectedpoints,indexToPoints=trace._indexToPoints;if(indexToPoints){for(var ptIndex2ptNumber=makePtIndex2PtNumber(indexToPoints),out=[],i=0;i<selectedpoints.length;i++){var ptIndex=selectedpoints[i];if(lib.isIndex(ptIndex)){var ptNumber=ptIndex2ptNumber[ptIndex];lib.isIndex(ptNumber)&&out.push(ptNumber)}}return out}return selectedpoints},lib.getTargetArray=function(trace,transformOpts){var target=transformOpts.target;if("string"==typeof target&&target){var array=lib.nestedProperty(trace,target).get();return!!Array.isArray(array)&&array}return!!Array.isArray(target)&&target},lib.minExtend=function(obj1,obj2){var objOut={};"object"!=typeof obj2&&(obj2={});var i,k,v,keys=Object.keys(obj1);for(i=0;i<keys.length;i++)v=obj1[k=keys[i]],"_"!==k.charAt(0)&&"function"!=typeof v&&("module"===k?objOut[k]=v:Array.isArray(v)?objOut[k]=v.slice(0,3):objOut[k]=v&&"object"==typeof v?lib.minExtend(obj1[k],obj2[k]):v);for(keys=Object.keys(obj2),i=0;i<keys.length;i++)"object"==typeof(v=obj2[k=keys[i]])&&k in objOut&&"object"==typeof objOut[k]||(objOut[k]=v);return objOut},lib.titleCase=function(s){return s.charAt(0).toUpperCase()+s.substr(1)},lib.containsAny=function(s,fragments){for(var i=0;i<fragments.length;i++)if(-1!==s.indexOf(fragments[i]))return!0;return!1},lib.isPlotDiv=function(el){var el3=d3.select(el);return el3.node()instanceof HTMLElement&&el3.size()&&el3.classed("js-plotly-plot")},lib.removeElement=function(el){var elParent=el&&el.parentNode;elParent&&elParent.removeChild(el)},lib.addStyleRule=function(selector,styleString){if(!lib.styleSheet){var style=document.createElement("style");style.appendChild(document.createTextNode("")),document.head.appendChild(style),lib.styleSheet=style.sheet}var styleSheet=lib.styleSheet;styleSheet.insertRule?styleSheet.insertRule(selector+"{"+styleString+"}",0):styleSheet.addRule?styleSheet.addRule(selector,styleString,0):lib.warn("addStyleRule failed")},lib.isIE=function(){return void 0!==window.navigator.msSaveBlob},lib.isD3Selection=function(obj){return obj&&"function"==typeof obj.classed},lib.ensureSingle=function(parent,nodeType,className,enterFn){var sel=parent.select(nodeType+(className?"."+className:""));if(sel.size())return sel;var layer=parent.append(nodeType);return className&&layer.classed(className,!0),enterFn&&layer.call(enterFn),layer},lib.ensureSingleById=function(parent,nodeType,id,enterFn){var sel=parent.select(nodeType+"#"+id);if(sel.size())return sel;var layer=parent.append(nodeType).attr("id",id);return enterFn&&layer.call(enterFn),layer},lib.objectFromPath=function(path,value){for(var tmpObj,keys=path.split("."),obj=tmpObj={},i=0;i<keys.length;i++){var key=keys[i],el=null,parts=keys[i].match(/(.*)\[([0-9]+)\]/);parts?(key=parts[1],el=parts[2],tmpObj=tmpObj[key]=[],i===keys.length-1?tmpObj[el]=value:tmpObj[el]={},tmpObj=tmpObj[el]):(i===keys.length-1?tmpObj[key]=value:tmpObj[key]={},tmpObj=tmpObj[key])}return obj};var dottedPropertyRegex=/^([^\[\.]+)\.(.+)?/,indexedPropertyRegex=/^([^\.]+)\[([0-9]+)\](\.)?(.+)?/;lib.expandObjectPaths=function(data){var match,key,prop,datum,idx,dest,trailingPath;if("object"==typeof data&&!Array.isArray(data))for(key in data)data.hasOwnProperty(key)&&((match=key.match(dottedPropertyRegex))?(datum=data[key],prop=match[1],delete data[key],data[prop]=lib.extendDeepNoArrays(data[prop]||{},lib.objectFromPath(key,lib.expandObjectPaths(datum))[prop])):(match=key.match(indexedPropertyRegex))?(datum=data[key],prop=match[1],idx=parseInt(match[2]),delete data[key],data[prop]=data[prop]||[],"."===match[3]?(trailingPath=match[4],dest=data[prop][idx]=data[prop][idx]||{},lib.extendDeepNoArrays(dest,lib.objectFromPath(trailingPath,lib.expandObjectPaths(datum)))):data[prop][idx]=lib.expandObjectPaths(datum)):data[key]=lib.expandObjectPaths(data[key]));return data},lib.numSeparate=function(value,separators,separatethousands){if(separatethousands||(separatethousands=!1),"string"!=typeof separators||0===separators.length)throw new Error("Separator string required for formatting!");"number"==typeof value&&(value=String(value));var thousandsRe=/(\d+)(\d{3})/,decimalSep=separators.charAt(0),thouSep=separators.charAt(1),x=value.split("."),x1=x[0],x2=x.length>1?decimalSep+x[1]:"";if(thouSep&&(x.length>1||x1.length>4||separatethousands))for(;thousandsRe.test(x1);)x1=x1.replace(thousandsRe,"$1"+thouSep+"$2");return x1+x2};var TEMPLATE_STRING_REGEX=/%{([^\s%{}]*)}/g,SIMPLE_PROPERTY_REGEX=/^\w*$/;lib.templateString=function(string,obj){var getterCache={};return string.replace(TEMPLATE_STRING_REGEX,function(dummy,key){return SIMPLE_PROPERTY_REGEX.test(key)?obj[key]||"":(getterCache[key]=getterCache[key]||lib.nestedProperty(obj,key).get,getterCache[key]()||"")})};lib.subplotSort=function(a,b){for(var l=Math.min(a.length,b.length)+1,numA=0,numB=0,i=0;i<l;i++){var charA=a.charCodeAt(i)||0,charB=b.charCodeAt(i)||0,isNumA=charA>=48&&charA<=57,isNumB=charB>=48&&charB<=57;if(isNumA&&(numA=10*numA+charA-48),isNumB&&(numB=10*numB+charB-48),!isNumA||!isNumB){if(numA!==numB)return numA-numB;if(charA!==charB)return charA-charB}}return numB-numA};var randSeed=2e9;lib.seedPseudoRandom=function(){randSeed=2e9},lib.pseudoRandom=function(){var lastVal=randSeed;return randSeed=(69069*randSeed+1)%4294967296,Math.abs(randSeed-lastVal)<429496729?lib.pseudoRandom():randSeed/4294967296}},{"../constants/numerical":670,"./angles":674,"./clean_number":675,"./clear_responsive":677,"./coerce":678,"./dates":679,"./ensure_array":680,"./extend":682,"./filter_unique":683,"./filter_visible":684,"./geometry2d":687,"./get_graph_div":688,"./identity":692,"./is_array":694,"./is_plain_object":695,"./keyed_container":696,"./localize":697,"./loggers":698,"./make_trace_groups":699,"./matrix":700,"./mod":701,"./nested_property":702,"./noop":703,"./notifier":704,"./push_unique":708,"./regex":710,"./relative_attr":711,"./relink_private":712,"./search":713,"./stats":716,"./throttle":719,"./to_log_range":720,d3:147,"fast-isnumeric":213}],694:[function(_dereq_,module,exports){"use strict";var ab="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer:{isView:function(){return!1}},dv="undefined"==typeof DataView?function(){}:DataView;function isTypedArray(a){return ab.isView(a)&&!(a instanceof dv)}function isArrayOrTypedArray(a){return Array.isArray(a)||isTypedArray(a)}module.exports={isTypedArray:isTypedArray,isArrayOrTypedArray:isArrayOrTypedArray,isArray1D:function isArray1D(a){return!isArrayOrTypedArray(a[0])}}},{}],695:[function(_dereq_,module,exports){"use strict";module.exports=function isPlainObject(obj){return window&&window.process&&window.process.versions?"[object Object]"===Object.prototype.toString.call(obj):"[object Object]"===Object.prototype.toString.call(obj)&&Object.getPrototypeOf(obj)===Object.prototype}},{}],696:[function(_dereq_,module,exports){"use strict";var nestedProperty=_dereq_("./nested_property"),SIMPLE_PROPERTY_REGEX=/^\w*$/;module.exports=function keyedContainer(baseObj,path,keyName,valueName){var i,arr,baseProp;keyName=keyName||"name",valueName=valueName||"value";var changeTypes={};path&&path.length?(baseProp=nestedProperty(baseObj,path),arr=baseProp.get()):arr=baseObj,path=path||"";var indexLookup={};if(arr)for(i=0;i<arr.length;i++)indexLookup[arr[i][keyName]]=i;var isSimpleValueProp=SIMPLE_PROPERTY_REGEX.test(valueName),obj={set:function(name,value){var changeType=null===value?4:0;if(!arr){if(!baseProp||4===changeType)return;arr=[],baseProp.set(arr)}var idx=indexLookup[name];if(void 0===idx){if(4===changeType)return;changeType|=3,idx=arr.length,indexLookup[name]=idx}else value!==(isSimpleValueProp?arr[idx][valueName]:nestedProperty(arr[idx],valueName).get())&&(changeType|=2);var newValue=arr[idx]=arr[idx]||{};return newValue[keyName]=name,isSimpleValueProp?newValue[valueName]=value:nestedProperty(newValue,valueName).set(value),null!==value&&(changeType&=-5),changeTypes[idx]=changeTypes[idx]|changeType,obj},get:function(name){if(arr){var idx=indexLookup[name];return void 0===idx?void 0:isSimpleValueProp?arr[idx][valueName]:nestedProperty(arr[idx],valueName).get()}},rename:function(name,newName){var idx=indexLookup[name];return void 0===idx?obj:(changeTypes[idx]=1|changeTypes[idx],indexLookup[newName]=idx,delete indexLookup[name],arr[idx][keyName]=newName,obj)},remove:function(name){var idx=indexLookup[name];if(void 0===idx)return obj;var object=arr[idx];if(Object.keys(object).length>2)return changeTypes[idx]=2|changeTypes[idx],obj.set(name,null);if(isSimpleValueProp){for(i=idx;i<arr.length;i++)changeTypes[i]=3|changeTypes[i];for(i=idx;i<arr.length;i++)indexLookup[arr[i][keyName]]--;arr.splice(idx,1),delete indexLookup[name]}else nestedProperty(object,valueName).set(null),changeTypes[idx]=6|changeTypes[idx];return obj},constructUpdate:function(){for(var astr,idx,update={},changed=Object.keys(changeTypes),i=0;i<changed.length;i++)idx=changed[i],astr=path+"["+idx+"]",arr[idx]?(1&changeTypes[idx]&&(update[astr+"."+keyName]=arr[idx][keyName]),2&changeTypes[idx]&&(update[astr+"."+valueName]=isSimpleValueProp?4&changeTypes[idx]?null:arr[idx][valueName]:4&changeTypes[idx]?null:nestedProperty(arr[idx],valueName).get())):update[astr]=null;return update}};return obj}},{"./nested_property":702}],697:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../registry");module.exports=function localize(gd,s){for(var locale=gd._context.locale,i=0;i<2;i++){for(var locales=gd._context.locales,j=0;j<2;j++){var dict=(locales[locale]||{}).dictionary;if(dict){var out=dict[s];if(out)return out}locales=Registry.localeRegistry}var baseLocale=locale.split("-")[0];if(baseLocale===locale)break;locale=baseLocale}return s}},{"../registry":825}],698:[function(_dereq_,module,exports){"use strict";var config=_dereq_("../plot_api/plot_config"),loggers=module.exports={};function apply(f,args){if(f.apply)f.apply(f,args);else for(var i=0;i<args.length;i++)f(args[i])}loggers.log=function(){if(config.logging>1){for(var messages=["LOG:"],i=0;i<arguments.length;i++)messages.push(arguments[i]);apply(console.trace||console.log,messages)}},loggers.warn=function(){if(config.logging>0){for(var messages=["WARN:"],i=0;i<arguments.length;i++)messages.push(arguments[i]);apply(console.trace||console.log,messages)}},loggers.error=function(){if(config.logging>0){for(var messages=["ERROR:"],i=0;i<arguments.length;i++)messages.push(arguments[i]);apply(console.error,messages)}}},{"../plot_api/plot_config":730}],699:[function(_dereq_,module,exports){"use strict";module.exports=function makeTraceGroups(traceLayer,cdModule,cls){var traces=traceLayer.selectAll("g."+cls.replace(/\s/g,".")).data(cdModule,function(cd){return cd[0].trace.uid});return traces.exit().remove(),traces.enter().append("g").attr("class",cls),traces.order(),traces}},{}],700:[function(_dereq_,module,exports){"use strict";exports.init2dArray=function(rowLength,colLength){for(var array=new Array(rowLength),i=0;i<rowLength;i++)array[i]=new Array(colLength);return array},exports.transposeRagged=function(z){var i,j,maxlen=0,zlen=z.length;for(i=0;i<zlen;i++)maxlen=Math.max(maxlen,z[i].length);var t=new Array(maxlen);for(i=0;i<maxlen;i++)for(t[i]=new Array(zlen),j=0;j<zlen;j++)t[i][j]=z[j][i];return t},exports.dot=function(x,y){if(!x.length||!y.length||x.length!==y.length)return null;var out,i,len=x.length;if(x[0].length)for(out=new Array(len),i=0;i<len;i++)out[i]=exports.dot(x[i],y);else if(y[0].length){var yTranspose=exports.transposeRagged(y);for(out=new Array(yTranspose.length),i=0;i<yTranspose.length;i++)out[i]=exports.dot(x,yTranspose[i])}else for(out=0,i=0;i<len;i++)out+=x[i]*y[i];return out},exports.translationMatrix=function(x,y){return[[1,0,x],[0,1,y],[0,0,1]]},exports.rotationMatrix=function(alpha){var a=alpha*Math.PI/180;return[[Math.cos(a),-Math.sin(a),0],[Math.sin(a),Math.cos(a),0],[0,0,1]]},exports.rotationXYMatrix=function(a,x,y){return exports.dot(exports.dot(exports.translationMatrix(x,y),exports.rotationMatrix(a)),exports.translationMatrix(-x,-y))},exports.apply2DTransform=function(transform){return function(){var args=arguments;3===args.length&&(args=args[0]);var xy=1===arguments.length?args[0]:[args[0],args[1]];return exports.dot(transform,[xy[0],xy[1],1]).slice(0,2)}},exports.apply2DTransform2=function(transform){var at=exports.apply2DTransform(transform);return function(xys){return at(xys.slice(0,2)).concat(at(xys.slice(2,4)))}}},{}],701:[function(_dereq_,module,exports){"use strict";module.exports={mod:function mod(v,d){var out=v%d;return out<0?out+d:out},modHalf:function modHalf(v,d){return Math.abs(v)>d/2?v-Math.round(v/d)*d:v}}},{}],702:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),isArrayOrTypedArray=_dereq_("./is_array").isArrayOrTypedArray;module.exports=function nestedProperty(container,propStr){if(isNumeric(propStr))propStr=String(propStr);else if("string"!=typeof propStr||"[-1]"===propStr.substr(propStr.length-4))throw"bad property string";for(var indexed,indices,i,j=0,propParts=propStr.split(".");j<propParts.length;){if(indexed=String(propParts[j]).match(/^([^\[\]]*)((\[\-?[0-9]*\])+)$/)){if(indexed[1])propParts[j]=indexed[1];else{if(0!==j)throw"bad property string";propParts.splice(0,1)}for(indices=indexed[2].substr(1,indexed[2].length-2).split("]["),i=0;i<indices.length;i++)j++,propParts.splice(j,0,Number(indices[i]))}j++}return"object"!=typeof container?function badContainer(container,propStr,propParts){return{set:function(){throw"bad container"},get:function(){},astr:propStr,parts:propParts,obj:container}}(container,propStr,propParts):{set:npSet(container,propParts,propStr),get:function npGet(cont,parts){return function(){var curPart,allSame,out,i,j,curCont=cont;for(i=0;i<parts.length-1;i++){if(-1===(curPart=parts[i])){for(allSame=!0,out=[],j=0;j<curCont.length;j++)out[j]=npGet(curCont[j],parts.slice(i+1))(),out[j]!==out[0]&&(allSame=!1);return allSame?out[0]:out}if("number"==typeof curPart&&!isArrayOrTypedArray(curCont))return;if("object"!=typeof(curCont=curCont[curPart])||null===curCont)return}if("object"==typeof curCont&&null!==curCont&&null!==(out=curCont[parts[i]]))return out}}(container,propParts),astr:propStr,parts:propParts,obj:container}};var ARGS_PATTERN=/(^|\.)args\[/;function isDeletable(val,propStr){return void 0===val||null===val&&!propStr.match(ARGS_PATTERN)}function npSet(cont,parts,propStr){return function(val){var curPart,i,curCont=cont,propPart="",containerLevels=[[cont,propPart]],toDelete=isDeletable(val,propStr);for(i=0;i<parts.length-1;i++){if("number"==typeof(curPart=parts[i])&&!isArrayOrTypedArray(curCont))throw"array index but container is not an array";if(-1===curPart){if(toDelete=!setArrayAll(curCont,parts.slice(i+1),val,propStr))break;return}if(!checkNewContainer(curCont,curPart,parts[i+1],toDelete))break;if("object"!=typeof(curCont=curCont[curPart])||null===curCont)throw"container is not an object";propPart=joinPropStr(propPart,curPart),containerLevels.push([curCont,propPart])}if(toDelete){if(i===parts.length-1&&(delete curCont[parts[i]],Array.isArray(curCont)&&+parts[i]==curCont.length-1))for(;curCont.length&&void 0===curCont[curCont.length-1];)curCont.pop()}else curCont[parts[i]]=val}}function joinPropStr(propStr,newPart){var toAdd=newPart;return isNumeric(newPart)?toAdd="["+newPart+"]":propStr&&(toAdd="."+newPart),propStr+toAdd}function setArrayAll(containerArray,innerParts,val,propStr){var i,arrayVal=isArrayOrTypedArray(val),allSet=!0,thisVal=val,thisPropStr=propStr.replace("-1",0),deleteThis=!arrayVal&&isDeletable(val,thisPropStr),firstPart=innerParts[0];for(i=0;i<containerArray.length;i++)thisPropStr=propStr.replace("-1",i),arrayVal&&(deleteThis=isDeletable(thisVal=val[i%val.length],thisPropStr)),deleteThis&&(allSet=!1),checkNewContainer(containerArray,i,firstPart,deleteThis)&&npSet(containerArray[i],innerParts,propStr.replace("-1",i))(thisVal);return allSet}function checkNewContainer(container,part,nextPart,toDelete){if(void 0===container[part]){if(toDelete)return!1;container[part]="number"==typeof nextPart?[]:{}}return!0}},{"./is_array":694,"fast-isnumeric":213}],703:[function(_dereq_,module,exports){"use strict";module.exports=function noop(){}},{}],704:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),NOTEDATA=[];module.exports=function(text,displayLength){if(-1===NOTEDATA.indexOf(text)){NOTEDATA.push(text);var ts=1e3;isNumeric(displayLength)?ts=displayLength:"long"===displayLength&&(ts=3e3);var notifierContainer=d3.select("body").selectAll(".plotly-notifier").data([0]);notifierContainer.enter().append("div").classed("plotly-notifier",!0),notifierContainer.selectAll(".notifier-note").data(NOTEDATA).enter().append("div").classed("notifier-note",!0).style("opacity",0).each(function(thisText){var note=d3.select(this);note.append("button").classed("notifier-close",!0).html("&times;").on("click",function(){note.transition().call(killNote)});for(var p=note.append("p"),lines=thisText.split(/<br\s*\/?>/g),i=0;i<lines.length;i++)i&&p.append("br"),p.append("span").text(lines[i]);note.transition().duration(700).style("opacity",1).transition().delay(ts).call(killNote)})}function killNote(transition){transition.duration(700).style("opacity",0).each("end",function(thisText){var thisIndex=NOTEDATA.indexOf(thisText);-1!==thisIndex&&NOTEDATA.splice(thisIndex,1),d3.select(this).remove()})}}},{d3:147,"fast-isnumeric":213}],705:[function(_dereq_,module,exports){"use strict";var setCursor=_dereq_("./setcursor"),STASHATTR="data-savedcursor";module.exports=function overrideCursor(el3,csr){var savedCursor=el3.attr(STASHATTR);if(csr){if(!savedCursor){for(var classes=(el3.attr("class")||"").split(" "),i=0;i<classes.length;i++){var cls=classes[i];0===cls.indexOf("cursor-")&&el3.attr(STASHATTR,cls.substr(7)).classed(cls,!1)}el3.attr(STASHATTR)||el3.attr(STASHATTR,"!!")}setCursor(el3,csr)}else savedCursor&&(el3.attr(STASHATTR,null),"!!"===savedCursor?setCursor(el3):setCursor(el3,savedCursor))}},{"./setcursor":714}],706:[function(_dereq_,module,exports){"use strict";var dot=_dereq_("./matrix").dot,BADNUM=_dereq_("../constants/numerical").BADNUM,polygon=module.exports={};polygon.tester=function tester(ptsIn){var i,pts=ptsIn.slice(),xmin=pts[0][0],xmax=xmin,ymin=pts[0][1],ymax=ymin;for(pts.push(pts[0]),i=1;i<pts.length;i++)xmin=Math.min(xmin,pts[i][0]),xmax=Math.max(xmax,pts[i][0]),ymin=Math.min(ymin,pts[i][1]),ymax=Math.max(ymax,pts[i][1]);var rectFirstEdgeTest,isRect=!1;5===pts.length&&(pts[0][0]===pts[1][0]?pts[2][0]===pts[3][0]&&pts[0][1]===pts[3][1]&&pts[1][1]===pts[2][1]&&(isRect=!0,rectFirstEdgeTest=function(pt){return pt[0]===pts[0][0]}):pts[0][1]===pts[1][1]&&pts[2][1]===pts[3][1]&&pts[0][0]===pts[3][0]&&pts[1][0]===pts[2][0]&&(isRect=!0,rectFirstEdgeTest=function(pt){return pt[1]===pts[0][1]}));var degenerate=!0,lastPt=pts[0];for(i=1;i<pts.length;i++)if(lastPt[0]!==pts[i][0]||lastPt[1]!==pts[i][1]){degenerate=!1;break}return{xmin:xmin,xmax:xmax,ymin:ymin,ymax:ymax,pts:pts,contains:isRect?function rectContains(pt,omitFirstEdge){var x=pt[0],y=pt[1];return!(x===BADNUM||x<xmin||x>xmax||y===BADNUM||y<ymin||y>ymax||omitFirstEdge&&rectFirstEdgeTest(pt))}:function contains(pt,omitFirstEdge){var x=pt[0],y=pt[1];if(x===BADNUM||x<xmin||x>xmax||y===BADNUM||y<ymin||y>ymax)return!1;var i,x0,y0,xmini,ycross,imax=pts.length,x1=pts[0][0],y1=pts[0][1],crossings=0;for(i=1;i<imax;i++)if(x0=x1,y0=y1,x1=pts[i][0],y1=pts[i][1],!(x<(xmini=Math.min(x0,x1))||x>Math.max(x0,x1)||y>Math.max(y0,y1)))if(y<Math.min(y0,y1))x!==xmini&&crossings++;else{if(y===(ycross=x1===x0?y:y0+(x-x0)*(y1-y0)/(x1-x0)))return 1!==i||!omitFirstEdge;y<=ycross&&x!==xmini&&crossings++}return crossings%2==1},isRect:isRect,degenerate:degenerate}};var isBent=polygon.isSegmentBent=function isBent(pts,start,end,tolerance){var i,part,partParallel,startPt=pts[start],segment=[pts[end][0]-startPt[0],pts[end][1]-startPt[1]],segmentSquared=dot(segment,segment),segmentLen=Math.sqrt(segmentSquared),unitPerp=[-segment[1]/segmentLen,segment[0]/segmentLen];for(i=start+1;i<end;i++)if(part=[pts[i][0]-startPt[0],pts[i][1]-startPt[1]],(partParallel=dot(part,segment))<0||partParallel>segmentSquared||Math.abs(dot(part,unitPerp))>tolerance)return!0;return!1};polygon.filter=function filter(pts,tolerance){var ptsFiltered=[pts[0]],doneRawIndex=0,doneFilteredIndex=0;function addPt(pt){pts.push(pt);var prevFilterLen=ptsFiltered.length,iLast=doneRawIndex;ptsFiltered.splice(doneFilteredIndex+1);for(var i=iLast+1;i<pts.length;i++)(i===pts.length-1||isBent(pts,iLast,i+1,tolerance))&&(ptsFiltered.push(pts[i]),ptsFiltered.length<prevFilterLen-2&&(doneRawIndex=i,doneFilteredIndex=ptsFiltered.length-1),iLast=i)}pts.length>1&&addPt(pts.pop());return{addPt:addPt,raw:pts,filtered:ptsFiltered}}},{"../constants/numerical":670,"./matrix":700}],707:[function(_dereq_,module,exports){(function(global){"use strict";var showNoWebGlMsg=_dereq_("./show_no_webgl_msg"),createRegl=_dereq_("regl");module.exports=function prepareRegl(gd,extensions){var fullLayout=gd._fullLayout,success=!0;return fullLayout._glcanvas.each(function(d){if(!d.regl&&(!d.pick||fullLayout._has("parcoords"))){try{d.regl=createRegl({canvas:this,attributes:{antialias:!d.pick,preserveDrawingBuffer:!0},pixelRatio:gd._context.plotGlPixelRatio||global.devicePixelRatio,extensions:extensions||[]})}catch(e){success=!1}success&&this.addEventListener("webglcontextlost",function(event){gd&&gd.emit&&gd.emit("plotly_webglcontextlost",{event:event,layer:d.key})},!1)}}),success||showNoWebGlMsg({container:fullLayout._glcontainer.node()}),success}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./show_no_webgl_msg":715,regl:475}],708:[function(_dereq_,module,exports){"use strict";module.exports=function pushUnique(array,item){if(item instanceof RegExp){var i,itemStr=item.toString();for(i=0;i<array.length;i++)if(array[i]instanceof RegExp&&array[i].toString()===itemStr)return array;array.push(item)}else!item&&0!==item||-1!==array.indexOf(item)||array.push(item);return array}},{}],709:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),config=_dereq_("../plot_api/plot_config");var queue={add:function(gd,undoFunc,undoArgs,redoFunc,redoArgs){var queueObj,queueIndex;gd.undoQueue=gd.undoQueue||{index:0,queue:[],sequence:!1},queueIndex=gd.undoQueue.index,gd.autoplay?gd.undoQueue.inSequence||(gd.autoplay=!1):(!gd.undoQueue.sequence||gd.undoQueue.beginSequence?(queueObj={undo:{calls:[],args:[]},redo:{calls:[],args:[]}},gd.undoQueue.queue.splice(queueIndex,gd.undoQueue.queue.length-queueIndex,queueObj),gd.undoQueue.index+=1):queueObj=gd.undoQueue.queue[queueIndex-1],gd.undoQueue.beginSequence=!1,queueObj&&(queueObj.undo.calls.unshift(undoFunc),queueObj.undo.args.unshift(undoArgs),queueObj.redo.calls.push(redoFunc),queueObj.redo.args.push(redoArgs)),gd.undoQueue.queue.length>config.queueLength&&(gd.undoQueue.queue.shift(),gd.undoQueue.index--))},startSequence:function(gd){gd.undoQueue=gd.undoQueue||{index:0,queue:[],sequence:!1},gd.undoQueue.sequence=!0,gd.undoQueue.beginSequence=!0},stopSequence:function(gd){gd.undoQueue=gd.undoQueue||{index:0,queue:[],sequence:!1},gd.undoQueue.sequence=!1,gd.undoQueue.beginSequence=!1},undo:function undo(gd){var queueObj,i;if(gd.framework&&gd.framework.isPolar)gd.framework.undo();else if(!(void 0===gd.undoQueue||isNaN(gd.undoQueue.index)||gd.undoQueue.index<=0)){for(gd.undoQueue.index--,queueObj=gd.undoQueue.queue[gd.undoQueue.index],gd.undoQueue.inSequence=!0,i=0;i<queueObj.undo.calls.length;i++)queue.plotDo(gd,queueObj.undo.calls[i],queueObj.undo.args[i]);gd.undoQueue.inSequence=!1,gd.autoplay=!1}},redo:function redo(gd){var queueObj,i;if(gd.framework&&gd.framework.isPolar)gd.framework.redo();else if(!(void 0===gd.undoQueue||isNaN(gd.undoQueue.index)||gd.undoQueue.index>=gd.undoQueue.queue.length)){for(queueObj=gd.undoQueue.queue[gd.undoQueue.index],gd.undoQueue.inSequence=!0,i=0;i<queueObj.redo.calls.length;i++)queue.plotDo(gd,queueObj.redo.calls[i],queueObj.redo.args[i]);gd.undoQueue.inSequence=!1,gd.autoplay=!1,gd.undoQueue.index++}}};queue.plotDo=function(gd,func,args){gd.autoplay=!0,args=function copyArgArray(gd,args){for(var arg,copy=[],i=0;i<args.length;i++)arg=args[i],copy[i]=arg===gd?arg:"object"==typeof arg?Array.isArray(arg)?Lib.extendDeep([],arg):Lib.extendDeepAll({},arg):arg;return copy}(gd,args),func.apply(null,args)},module.exports=queue},{"../lib":693,"../plot_api/plot_config":730}],710:[function(_dereq_,module,exports){"use strict";exports.counter=function(head,tail,openEnded){var fullTail=(tail||"")+(openEnded?"":"$");return"xy"===head?new RegExp("^x([2-9]|[1-9][0-9]+)?y([2-9]|[1-9][0-9]+)?"+fullTail):new RegExp("^"+head+"([2-9]|[1-9][0-9]+)?"+fullTail)}},{}],711:[function(_dereq_,module,exports){"use strict";var ASCEND=/^(.*)(\.[^\.\[\]]+|\[\d\])$/,SIMPLEATTR=/^[^\.\[\]]+$/;module.exports=function(baseAttr,relativeAttr){for(;relativeAttr;){var match=baseAttr.match(ASCEND);if(match)baseAttr=match[1];else{if(!baseAttr.match(SIMPLEATTR))throw new Error("bad relativeAttr call:"+[baseAttr,relativeAttr]);baseAttr=""}if("^"!==relativeAttr.charAt(0))break;relativeAttr=relativeAttr.slice(1)}return baseAttr&&"["!==relativeAttr.charAt(0)?baseAttr+"."+relativeAttr:baseAttr+relativeAttr}},{}],712:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("./is_array").isArrayOrTypedArray,isPlainObject=_dereq_("./is_plain_object");module.exports=function relinkPrivateKeys(toContainer,fromContainer){for(var k in fromContainer){var fromVal=fromContainer[k],toVal=toContainer[k];if(toVal!==fromVal)if("_"===k.charAt(0)||"function"==typeof fromVal){if(k in toContainer)continue;toContainer[k]=fromVal}else if(isArrayOrTypedArray(fromVal)&&isArrayOrTypedArray(toVal)&&isPlainObject(fromVal[0])){if("customdata"===k||"ids"===k)continue;for(var minLen=Math.min(fromVal.length,toVal.length),j=0;j<minLen;j++)toVal[j]!==fromVal[j]&&isPlainObject(fromVal[j])&&isPlainObject(toVal[j])&&relinkPrivateKeys(toVal[j],fromVal[j])}else isPlainObject(fromVal)&&isPlainObject(toVal)&&(relinkPrivateKeys(toVal,fromVal),Object.keys(toVal).length||delete toContainer[k])}}},{"./is_array":694,"./is_plain_object":695}],713:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),loggers=_dereq_("./loggers"),identity=_dereq_("./identity");function lessThan(a,b){return a<b}function lessOrEqual(a,b){return a<=b}function greaterThan(a,b){return a>b}function greaterOrEqual(a,b){return a>=b}exports.findBin=function(val,bins,linelow){if(isNumeric(bins.start))return linelow?Math.ceil((val-bins.start)/bins.size-1e-9)-1:Math.floor((val-bins.start)/bins.size+1e-9);var n,test,n1=0,n2=bins.length,c=0,binSize=n2>1?(bins[n2-1]-bins[0])/(n2-1):1;for(test=binSize>=0?linelow?lessThan:lessOrEqual:linelow?greaterOrEqual:greaterThan,val+=1e-9*binSize*(linelow?-1:1)*(binSize>=0?1:-1);n1<n2&&c++<100;)test(bins[n=Math.floor((n1+n2)/2)],val)?n1=n+1:n2=n;return c>90&&loggers.log("Long binary search..."),n1-1},exports.sorterAsc=function(a,b){return a-b},exports.sorterDes=function(a,b){return b-a},exports.distinctVals=function(valsIn){var vals=valsIn.slice();vals.sort(exports.sorterAsc);for(var l=vals.length-1,minDiff=vals[l]-vals[0]||1,errDiff=minDiff/(l||1)/1e4,v2=[vals[0]],i=0;i<l;i++)vals[i+1]>vals[i]+errDiff&&(minDiff=Math.min(minDiff,vals[i+1]-vals[i]),v2.push(vals[i+1]));return{vals:v2,minDiff:minDiff}},exports.roundUp=function(val,arrayIn,reverse){for(var mid,low=0,high=arrayIn.length-1,c=0,dlow=reverse?0:1,dhigh=reverse?1:0,rounded=reverse?Math.ceil:Math.floor;low<high&&c++<100;)arrayIn[mid=rounded((low+high)/2)]<=val?low=mid+dlow:high=mid-dhigh;return arrayIn[low]},exports.sort=function(array,sortFn){for(var notOrdered=0,notReversed=0,i=1;i<array.length;i++){var pairOrder=sortFn(array[i],array[i-1]);if(pairOrder<0?notOrdered=1:pairOrder>0&&(notReversed=1),notOrdered&&notReversed)return array.sort(sortFn)}return notReversed?array:array.reverse()},exports.findIndexOfMin=function(arr,fn){fn=fn||identity;for(var ind,min=1/0,i=0;i<arr.length;i++){var v=fn(arr[i]);v<min&&(min=v,ind=i)}return ind}},{"./identity":692,"./loggers":698,"fast-isnumeric":213}],714:[function(_dereq_,module,exports){"use strict";module.exports=function setCursor(el3,csr){(el3.attr("class")||"").split(" ").forEach(function(cls){0===cls.indexOf("cursor-")&&el3.classed(cls,!1)}),csr&&el3.classed("cursor-"+csr,!0)}},{}],715:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../components/color"),noop=function(){};module.exports=function showNoWebGlMsg(scene){for(var prop in scene)"function"==typeof scene[prop]&&(scene[prop]=noop);scene.destroy=function(){scene.container.parentNode.removeChild(scene.container)};var div=document.createElement("div");div.className="no-webgl",div.style.cursor="pointer",div.style.fontSize="24px",div.style.color=Color.defaults[0],div.style.position="absolute",div.style.left=div.style.top="0px",div.style.width=div.style.height="100%",div.style["background-color"]=Color.lightLine,div.style["z-index"]=30;var p=document.createElement("p");return p.textContent="WebGL is not supported by your browser - visit https://get.webgl.org for more info",p.style.position="relative",p.style.top="50%",p.style.left="50%",p.style.height="30%",p.style.width="50%",p.style.margin="-15% 0 0 -25%",div.appendChild(p),scene.container.appendChild(div),scene.container.style.background="#FFFFFF",scene.container.onclick=function(){window.open("https://get.webgl.org")},!1}},{"../components/color":567}],716:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),isArrayOrTypedArray=_dereq_("./is_array").isArrayOrTypedArray;exports.aggNums=function(f,v,a,len){var i,b;if((!len||len>a.length)&&(len=a.length),isNumeric(v)||(v=!1),isArrayOrTypedArray(a[0])){for(b=new Array(len),i=0;i<len;i++)b[i]=exports.aggNums(f,v,a[i]);a=b}for(i=0;i<len;i++)isNumeric(v)?isNumeric(a[i])&&(v=f(+v,+a[i])):v=a[i];return v},exports.len=function(data){return exports.aggNums(function(a){return a+1},0,data)},exports.mean=function(data,len){return len||(len=exports.len(data)),exports.aggNums(function(a,b){return a+b},0,data)/len},exports.midRange=function(numArr){if(void 0!==numArr&&0!==numArr.length)return(exports.aggNums(Math.max,null,numArr)+exports.aggNums(Math.min,null,numArr))/2},exports.variance=function(data,len,mean){return len||(len=exports.len(data)),isNumeric(mean)||(mean=exports.mean(data,len)),exports.aggNums(function(a,b){return a+Math.pow(b-mean,2)},0,data)/len},exports.stdev=function(data,len,mean){return Math.sqrt(exports.variance(data,len,mean))},exports.interp=function(arr,n){if(!isNumeric(n))throw"n should be a finite number";if((n=n*arr.length-.5)<0)return arr[0];if(n>arr.length-1)return arr[arr.length-1];var frac=n%1;return frac*arr[Math.ceil(n)]+(1-frac)*arr[Math.floor(n)]}},{"./is_array":694,"fast-isnumeric":213}],717:[function(_dereq_,module,exports){"use strict";var rgba=_dereq_("color-normalize");module.exports=function str2RgbaArray(color){return color?rgba(color):[0,0,0,1]}},{"color-normalize":107}],718:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../lib"),xmlnsNamespaces=_dereq_("../constants/xmlns_namespaces"),LINE_SPACING=_dereq_("../constants/alignment").LINE_SPACING;function getSize(_selection,_dimension){return _selection.node().getBoundingClientRect()[_dimension]}var FIND_TEX=/([^$]*)([$]+[^$]*[$]+)([^$]*)/;exports.convertToTspans=function(_context,gd,_callback){var str=_context.text(),tex=!_context.attr("data-notex")&&"undefined"!=typeof MathJax&&str.match(FIND_TEX),parent=d3.select(_context.node().parentNode);if(!parent.empty()){var svgClass=_context.attr("class")?_context.attr("class").split(" ")[0]:"text";return svgClass+="-math",parent.selectAll("svg."+svgClass).remove(),parent.selectAll("g."+svgClass+"-group").remove(),_context.style("display",null).attr({"data-unformatted":str,"data-math":"N"}),tex?(gd&&gd._promises||[]).push(new Promise(function(resolve){_context.style("display","none");var fontSize=parseInt(_context.node().style.fontSize,10),config={fontSize:fontSize};!function texToSVG(_texString,_config,_callback){var randomID="math-output-"+Lib.randstr({},64),tmpDiv=d3.select("body").append("div").attr({id:randomID}).style({visibility:"hidden",position:"absolute"}).style({"font-size":_config.fontSize+"px"}).text(function cleanEscapesForTex(s){return s.replace(LT_MATCH,"\\lt ").replace(GT_MATCH,"\\gt ")}(_texString));MathJax.Hub.Queue(["Typeset",MathJax.Hub,tmpDiv.node()],function(){var glyphDefs=d3.select("body").select("#MathJax_SVG_glyphs");if(tmpDiv.select(".MathJax_SVG").empty()||!tmpDiv.select("svg").node())Lib.log("There was an error in the tex syntax.",_texString),_callback();else{var svgBBox=tmpDiv.select("svg").node().getBoundingClientRect();_callback(tmpDiv.select(".MathJax_SVG"),glyphDefs,svgBBox)}tmpDiv.remove()})}(tex[2],config,function(_svgEl,_glyphDefs,_svgBBox){parent.selectAll("svg."+svgClass).remove(),parent.selectAll("g."+svgClass+"-group").remove();var newSvg=_svgEl&&_svgEl.select("svg");if(!newSvg||!newSvg.node())return showText(),void resolve();var mathjaxGroup=parent.append("g").classed(svgClass+"-group",!0).attr({"pointer-events":"none","data-unformatted":str,"data-math":"Y"});mathjaxGroup.node().appendChild(newSvg.node()),_glyphDefs&&_glyphDefs.node()&&newSvg.node().insertBefore(_glyphDefs.node().cloneNode(!0),newSvg.node().firstChild),newSvg.attr({class:svgClass,height:_svgBBox.height,preserveAspectRatio:"xMinYMin meet"}).style({overflow:"visible","pointer-events":"none"});var fill=_context.node().style.fill||"black";newSvg.select("g").attr({fill:fill,stroke:fill});var newSvgW=getSize(newSvg,"width"),newSvgH=getSize(newSvg,"height"),newX=+_context.attr("x")-newSvgW*{start:0,middle:.5,end:1}[_context.attr("text-anchor")||"start"],dy=-(fontSize||getSize(_context,"height"))/4;"y"===svgClass[0]?(mathjaxGroup.attr({transform:"rotate("+[-90,+_context.attr("x"),+_context.attr("y")]+") translate("+[-newSvgW/2,dy-newSvgH/2]+")"}),newSvg.attr({x:+_context.attr("x"),y:+_context.attr("y")})):"l"===svgClass[0]?newSvg.attr({x:_context.attr("x"),y:dy-newSvgH/2}):"a"===svgClass[0]?newSvg.attr({x:0,y:dy}):newSvg.attr({x:newX,y:+_context.attr("y")+dy-newSvgH/2}),_callback&&_callback.call(_context,mathjaxGroup),resolve(mathjaxGroup)})})):showText(),_context}function showText(){parent.empty()||(svgClass=_context.attr("class")+"-math",parent.select("svg."+svgClass).remove()),_context.text("").style("white-space","pre"),function buildSVGText(containerNode,str){str=str.replace(NEWLINES," ");var currentNode,hasLink=!1,nodeStack=[],currentLine=-1;function newLine(){currentLine++;var lineNode=document.createElementNS(xmlnsNamespaces.svg,"tspan");d3.select(lineNode).attr({class:"line",dy:currentLine*LINE_SPACING+"em"}),containerNode.appendChild(lineNode),currentNode=lineNode;var oldNodeStack=nodeStack;if(nodeStack=[{node:lineNode}],oldNodeStack.length>1)for(var i=1;i<oldNodeStack.length;i++)enterNode(oldNodeStack[i])}function enterNode(nodeSpec){var nodeType,type=nodeSpec.type,nodeAttrs={};if("a"===type){nodeType="a";var target=nodeSpec.target,href=nodeSpec.href,popup=nodeSpec.popup;href&&(nodeAttrs={"xlink:xlink:show":"_blank"===target||"_"!==target.charAt(0)?"new":"replace",target:target,"xlink:xlink:href":href},popup&&(nodeAttrs.onclick='window.open(this.href.baseVal,this.target.baseVal,"'+popup+'");return false;'))}else nodeType="tspan";nodeSpec.style&&(nodeAttrs.style=nodeSpec.style);var newNode=document.createElementNS(xmlnsNamespaces.svg,nodeType);if("sup"===type||"sub"===type){addTextNode(currentNode,ZERO_WIDTH_SPACE),currentNode.appendChild(newNode);var resetter=document.createElementNS(xmlnsNamespaces.svg,"tspan");addTextNode(resetter,ZERO_WIDTH_SPACE),d3.select(resetter).attr("dy",RESET_DY[type]),nodeAttrs.dy=SHIFT_DY[type],currentNode.appendChild(newNode),currentNode.appendChild(resetter)}else currentNode.appendChild(newNode);d3.select(newNode).attr(nodeAttrs),currentNode=nodeSpec.node=newNode,nodeStack.push(nodeSpec)}function addTextNode(node,text){node.appendChild(document.createTextNode(text))}function exitNode(type){if(1!==nodeStack.length){var innerNode=nodeStack.pop();type!==innerNode.type&&Lib.log("Start tag <"+innerNode.type+"> doesnt match end tag <"+type+">. Pretending it did match.",str),currentNode=nodeStack[nodeStack.length-1].node}else Lib.log("Ignoring unexpected end tag </"+type+">.",str)}BR_TAG.test(str)?newLine():(currentNode=containerNode,nodeStack=[{node:containerNode}]);for(var parts=str.split(SPLIT_TAGS),i=0;i<parts.length;i++){var parti=parts[i],match=parti.match(ONE_TAG),tagType=match&&match[2].toLowerCase(),tagStyle=TAG_STYLES[tagType];if("br"===tagType)newLine();else if(void 0===tagStyle)addTextNode(currentNode,convertEntities(parti));else if(match[1])exitNode(tagType);else{var extra=match[4],nodeSpec={type:tagType},css=getQuotedMatch(extra,STYLEMATCH);if(css?(css=css.replace(COLORMATCH,"$1 fill:"),tagStyle&&(css+=";"+tagStyle)):tagStyle&&(css=tagStyle),css&&(nodeSpec.style=css),"a"===tagType){hasLink=!0;var href=getQuotedMatch(extra,HREFMATCH);if(href){var dummyAnchor=document.createElement("a");dummyAnchor.href=href,-1!==PROTOCOLS.indexOf(dummyAnchor.protocol)&&(nodeSpec.href=encodeURI(decodeURI(href)),nodeSpec.target=getQuotedMatch(extra,TARGETMATCH)||"_blank",nodeSpec.popup=getQuotedMatch(extra,POPUPMATCH))}}enterNode(nodeSpec)}}return hasLink}(_context.node(),str)&&_context.style("pointer-events","all"),exports.positionText(_context),_callback&&_callback.call(_context)}};var LT_MATCH=/(<|&lt;|&#60;)/g,GT_MATCH=/(>|&gt;|&#62;)/g;var TAG_STYLES={sup:"font-size:70%",sub:"font-size:70%",b:"font-weight:bold",i:"font-style:italic",a:"cursor:pointer",span:"",em:"font-style:italic;font-weight:bold"},SHIFT_DY={sub:"0.3em",sup:"-0.6em"},RESET_DY={sub:"-0.21em",sup:"0.42em"},ZERO_WIDTH_SPACE="",PROTOCOLS=["http:","https:","mailto:","",void 0,":"],STRIP_TAGS=new RegExp("</?("+Object.keys(TAG_STYLES).join("|")+")( [^>]*)?/?>","g"),NEWLINES=/(\r\n?|\n)/g,SPLIT_TAGS=/(<[^<>]*>)/,ONE_TAG=/<(\/?)([^ >]*)(\s+(.*))?>/i,BR_TAG=/<br(\s+.*)?>/i,STYLEMATCH=/(^|[\s"'])style\s*=\s*("([^"]*);?"|'([^']*);?')/i,HREFMATCH=/(^|[\s"'])href\s*=\s*("([^"]*)"|'([^']*)')/i,TARGETMATCH=/(^|[\s"'])target\s*=\s*("([^"\s]*)"|'([^'\s]*)')/i,POPUPMATCH=/(^|[\s"'])popup\s*=\s*("([\w=,]*)"|'([\w=,]*)')/i;function getQuotedMatch(_str,re){if(!_str)return null;var match=_str.match(re),result=match&&(match[3]||match[4]);return result&&convertEntities(result)}var COLORMATCH=/(^|;)\s*color:/;exports.plainText=function(_str){return(_str||"").replace(STRIP_TAGS," ")};var entityToUnicode={mu:"",amp:"&",lt:"<",gt:">",nbsp:"",times:"",plusmn:"",deg:""},ENTITY_MATCH=/&(#\d+|#x[\da-fA-F]+|[a-z]+);/g;function convertEntities(_str){return _str.replace(ENTITY_MATCH,function(fullMatch,innerMatch){return("#"===innerMatch.charAt(0)?function fromCodePoint(code){if(code>1114111)return;var stringFromCodePoint=String.fromCodePoint;if(stringFromCodePoint)return stringFromCodePoint(code);var stringFromCharCode=String.fromCharCode;return code<=65535?stringFromCharCode(code):stringFromCharCode(55232+(code>>10),code%1024+56320)}("x"===innerMatch.charAt(1)?parseInt(innerMatch.substr(2),16):parseInt(innerMatch.substr(1),10)):entityToUnicode[innerMatch])||fullMatch})}function alignHTMLWith(_base,container,options){var thisRect,getTop,getLeft,alignH=options.horizontalAlign,alignV=options.verticalAlign||"top",bRect=_base.node().getBoundingClientRect(),cRect=container.node().getBoundingClientRect();return getTop="bottom"===alignV?function(){return bRect.bottom-thisRect.height}:"middle"===alignV?function(){return bRect.top+(bRect.height-thisRect.height)/2}:function(){return bRect.top},getLeft="right"===alignH?function(){return bRect.right-thisRect.width}:"center"===alignH?function(){return bRect.left+(bRect.width-thisRect.width)/2}:function(){return bRect.left},function(){return thisRect=this.node().getBoundingClientRect(),this.style({top:getTop()-cRect.top+"px",left:getLeft()-cRect.left+"px","z-index":1e3}),this}}exports.convertEntities=convertEntities,exports.lineCount=function lineCount(s){return s.selectAll("tspan.line").size()||1},exports.positionText=function positionText(s,x,y){return s.each(function(){var text=d3.select(this);function setOrGet(attr,val){return void 0===val?null===(val=text.attr(attr))&&(text.attr(attr,0),val=0):text.attr(attr,val),val}var thisX=setOrGet("x",x),thisY=setOrGet("y",y);"text"===this.nodeName&&text.selectAll("tspan.line").attr({x:thisX,y:thisY})})},exports.makeEditable=function(context,options){var gd=options.gd,_delegate=options.delegate,dispatch=d3.dispatch("edit","input","cancel"),handlerElement=_delegate||context;if(context.style({"pointer-events":_delegate?"none":"all"}),1!==context.size())throw new Error("boo");function handleClick(){!function appendEditable(){var container=d3.select(gd).select(".svg-container"),div=container.append("div"),cStyle=context.node().style,fontSize=parseFloat(cStyle.fontSize||12),initialText=options.text;void 0===initialText&&(initialText=context.attr("data-unformatted"));div.classed("plugin-editable editable",!0).style({position:"absolute","font-family":cStyle.fontFamily||"Arial","font-size":fontSize,color:options.fill||cStyle.fill||"black",opacity:1,"background-color":options.background||"transparent",outline:"#ffffff33 1px solid",margin:[-fontSize/8+1,0,0,-1].join("px ")+"px",padding:"0","box-sizing":"border-box"}).attr({contenteditable:!0}).text(initialText).call(alignHTMLWith(context,container,options)).on("blur",function(){gd._editing=!1,context.text(this.textContent).style({opacity:1});var mathjaxClass,svgClass=d3.select(this).attr("class");(mathjaxClass=svgClass?"."+svgClass.split(" ")[0]+"-math-group":"[class*=-math-group]")&&d3.select(context.node().parentNode).select(mathjaxClass).style({opacity:0});var text=this.textContent;d3.select(this).transition().duration(0).remove(),d3.select(document).on("mouseup",null),dispatch.edit.call(context,text)}).on("focus",function(){var editDiv=this;gd._editing=!0,d3.select(document).on("mouseup",function(){if(d3.event.target===editDiv)return!1;document.activeElement===div.node()&&div.node().blur()})}).on("keyup",function(){27===d3.event.which?(gd._editing=!1,context.style({opacity:1}),d3.select(this).style({opacity:0}).on("blur",function(){return!1}).transition().remove(),dispatch.cancel.call(context,this.textContent)):(dispatch.input.call(context,this.textContent),d3.select(this).call(alignHTMLWith(context,container,options)))}).on("keydown",function(){13===d3.event.which&&this.blur()}).call(selectElementContents)}(),context.style({opacity:0});var mathjaxClass,svgClass=handlerElement.attr("class");(mathjaxClass=svgClass?"."+svgClass.split(" ")[0]+"-math-group":"[class*=-math-group]")&&d3.select(context.node().parentNode).select(mathjaxClass).style({opacity:0})}function selectElementContents(_el){var el=_el.node(),range=document.createRange();range.selectNodeContents(el);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range),el.focus()}return options.immediate?handleClick():handlerElement.on("click",handleClick),d3.rebind(context,dispatch,"on")}},{"../constants/alignment":665,"../constants/xmlns_namespaces":671,"../lib":693,d3:147}],719:[function(_dereq_,module,exports){"use strict";var timerCache={};function _clearTimeout(cache){cache&&null!==cache.timer&&(clearTimeout(cache.timer),cache.timer=null)}exports.throttle=function throttle(id,minInterval,callback){var cache=timerCache[id],now=Date.now();if(!cache){for(var idi in timerCache)timerCache[idi].ts<now-6e4&&delete timerCache[idi];cache=timerCache[id]={ts:0,timer:null}}function exec(){callback(),cache.ts=Date.now(),cache.onDone&&(cache.onDone(),cache.onDone=null)}_clearTimeout(cache),now>cache.ts+minInterval?exec():cache.timer=setTimeout(function(){exec(),cache.timer=null},minInterval)},exports.done=function(id){var cache=timerCache[id];return cache&&cache.timer?new Promise(function(resolve){var previousOnDone=cache.onDone;cache.onDone=function onDone(){previousOnDone&&previousOnDone(),resolve(),cache.onDone=null}}):Promise.resolve()},exports.clear=function(id){if(id)_clearTimeout(timerCache[id]),delete timerCache[id];else for(var idi in timerCache)exports.clear(idi)}},{}],720:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric");module.exports=function toLogRange(val,range){if(val>0)return Math.log(val)/Math.LN10;var newVal=Math.log(Math.min(range[0],range[1]))/Math.LN10;return isNumeric(newVal)||(newVal=Math.log(Math.max(range[0],range[1]))/Math.LN10-6),newVal}},{"fast-isnumeric":213}],721:[function(_dereq_,module,exports){"use strict";var topojsonUtils=module.exports={},locationmodeToLayer=_dereq_("../plots/geo/constants").locationmodeToLayer,topojsonFeature=_dereq_("topojson-client").feature;topojsonUtils.getTopojsonName=function(geoLayout){return[geoLayout.scope.replace(/ /g,"-"),"_",geoLayout.resolution.toString(),"m"].join("")},topojsonUtils.getTopojsonPath=function(topojsonURL,topojsonName){return topojsonURL+topojsonName+".json"},topojsonUtils.getTopojsonFeatures=function(trace,topojson){var layer=locationmodeToLayer[trace.locationmode],obj=topojson.objects[layer];return topojsonFeature(topojson,obj).features}},{"../plots/geo/constants":770,"topojson-client":514}],722:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"locale",name:"en-US",dictionary:{"Click to enter Colorscale title":"Click to enter Colorscale title"},format:{date:"%m/%d/%Y"}}},{}],723:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"locale",name:"en",dictionary:{"Click to enter Colorscale title":"Click to enter Colourscale title"},format:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],periods:["AM","PM"],dateTime:"%a %b %e %X %Y",date:"%d/%m/%Y",time:"%H:%M:%S",decimal:".",thousands:",",grouping:[3],currency:["$",""],year:"%Y",month:"%b %Y",dayMonth:"%b %-d",dayMonthYear:"%b %-d, %Y"}}},{}],724:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../registry");module.exports=function containerArrayMatch(astr){for(var arrayStr,match,rootContainers=Registry.layoutArrayContainers,regexpContainers=Registry.layoutArrayRegexes,rootPart=astr.split("[")[0],i=0;i<regexpContainers.length;i++)if((match=astr.match(regexpContainers[i]))&&0===match.index){arrayStr=match[0];break}if(arrayStr||(arrayStr=rootContainers[rootContainers.indexOf(rootPart)]),!arrayStr)return!1;var tail=astr.substr(arrayStr.length);return tail?!!(match=tail.match(/^\[(0|[1-9][0-9]*)\](\.(.+))?$/))&&{array:arrayStr,index:Number(match[1]),property:match[3]||""}:{array:arrayStr,index:"",property:""}}},{"../registry":825}],725:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),extendFlat=Lib.extendFlat,isPlainObject=Lib.isPlainObject,traceOpts={valType:"flaglist",extras:["none"],flags:["calc","clearAxisTypes","plot","style","colorbars"]},layoutOpts={valType:"flaglist",extras:["none"],flags:["calc","plot","legend","ticks","axrange","layoutstyle","modebar","camera","arraydraw"]},traceEditTypeFlags=traceOpts.flags.slice().concat(["fullReplot"]),layoutEditTypeFlags=layoutOpts.flags.slice().concat("layoutReplot");function falseObj(keys){for(var out={},i=0;i<keys.length;i++)out[keys[i]]=!1;return out}function overrideAll(attrs,editTypeOverride,overrideContainers){var out=extendFlat({},attrs);for(var key in out){var attr=out[key];isPlainObject(attr)&&(out[key]=overrideOne(attr,editTypeOverride,overrideContainers,key))}return"from-root"===overrideContainers&&(out.editType=editTypeOverride),out}function overrideOne(attr,editTypeOverride,overrideContainers,key){if(attr.valType){var out=extendFlat({},attr);if(out.editType=editTypeOverride,Array.isArray(attr.items)){out.items=new Array(attr.items.length);for(var i=0;i<attr.items.length;i++)out.items[i]=overrideOne(attr.items[i],editTypeOverride,"from-root")}return out}return overrideAll(attr,editTypeOverride,"_"===key.charAt(0)?"nested":"from-root")}module.exports={traces:traceOpts,layout:layoutOpts,traceFlags:function(){return falseObj(traceEditTypeFlags)},layoutFlags:function(){return falseObj(layoutEditTypeFlags)},update:function(flags,attr){var editType=attr.editType;if(editType&&"none"!==editType)for(var editTypeParts=editType.split("+"),i=0;i<editTypeParts.length;i++)flags[editTypeParts[i]]=!0},overrideAll:overrideAll}},{"../lib":693}],726:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),m4FromQuat=_dereq_("gl-mat4/fromQuat"),Registry=_dereq_("../registry"),Lib=_dereq_("../lib"),Plots=_dereq_("../plots/plots"),AxisIds=_dereq_("../plots/cartesian/axis_ids"),cleanId=AxisIds.cleanId,getFromTrace=AxisIds.getFromTrace,Color=_dereq_("../components/color");function cleanAxRef(container,attr){var valIn=container[attr],axLetter=attr.charAt(0);valIn&&"paper"!==valIn&&(container[attr]=cleanId(valIn,axLetter))}function cleanFinanceDir(dirContainer){if(!Lib.isPlainObject(dirContainer))return!1;var dirName=dirContainer.name;return delete dirContainer.name,delete dirContainer.showlegend,("string"==typeof dirName||"number"==typeof dirName)&&String(dirName)}function commonPrefix(name1,name2,show1,show2){if(show1&&!show2)return name1;if(show2&&!show1)return name2;if(!name1.trim())return name2;if(!name2.trim())return name1;var i,minLen=Math.min(name1.length,name2.length);for(i=0;i<minLen&&name1.charAt(i)===name2.charAt(i);i++);return name1.substr(0,i).trim()}function cleanTextPosition(textposition){var posY="middle",posX="center";return-1!==textposition.indexOf("top")?posY="top":-1!==textposition.indexOf("bottom")&&(posY="bottom"),-1!==textposition.indexOf("left")?posX="left":-1!==textposition.indexOf("right")&&(posX="right"),posY+" "+posX}function emptyContainer(outer,innerStr){return innerStr in outer&&"object"==typeof outer[innerStr]&&0===Object.keys(outer[innerStr]).length}exports.clearPromiseQueue=function(gd){Array.isArray(gd._promises)&&gd._promises.length>0&&Lib.log("Clearing previous rejected promises from queue."),gd._promises=[]},exports.cleanLayout=function(layout){var i,j;layout||(layout={}),layout.xaxis1&&(layout.xaxis||(layout.xaxis=layout.xaxis1),delete layout.xaxis1),layout.yaxis1&&(layout.yaxis||(layout.yaxis=layout.yaxis1),delete layout.yaxis1),layout.scene1&&(layout.scene||(layout.scene=layout.scene1),delete layout.scene1);var axisAttrRegex=(Plots.subplotsRegistry.cartesian||{}).attrRegex,sceneAttrRegex=(Plots.subplotsRegistry.gl3d||{}).attrRegex,keys=Object.keys(layout);for(i=0;i<keys.length;i++){var key=keys[i];if(axisAttrRegex&&axisAttrRegex.test(key)){var ax=layout[key];ax.anchor&&"free"!==ax.anchor&&(ax.anchor=cleanId(ax.anchor)),ax.overlaying&&(ax.overlaying=cleanId(ax.overlaying)),ax.type||(ax.isdate?ax.type="date":ax.islog?ax.type="log":!1===ax.isdate&&!1===ax.islog&&(ax.type="linear")),"withzero"!==ax.autorange&&"tozero"!==ax.autorange||(ax.autorange=!0,ax.rangemode="tozero"),delete ax.islog,delete ax.isdate,delete ax.categories,emptyContainer(ax,"domain")&&delete ax.domain,void 0!==ax.autotick&&(void 0===ax.tickmode&&(ax.tickmode=ax.autotick?"auto":"linear"),delete ax.autotick)}else if(sceneAttrRegex&&sceneAttrRegex.test(key)){var scene=layout[key],cameraposition=scene.cameraposition;if(Array.isArray(cameraposition)&&4===cameraposition[0].length){var rotation=cameraposition[0],center=cameraposition[1],radius=cameraposition[2],mat=m4FromQuat([],rotation),eye=[];for(j=0;j<3;++j)eye[j]=center[j]+radius*mat[2+4*j];scene.camera={eye:{x:eye[0],y:eye[1],z:eye[2]},center:{x:center[0],y:center[1],z:center[2]},up:{x:mat[1],y:mat[5],z:mat[9]}},delete scene.cameraposition}}}var annotationsLen=Array.isArray(layout.annotations)?layout.annotations.length:0;for(i=0;i<annotationsLen;i++){var ann=layout.annotations[i];Lib.isPlainObject(ann)&&(ann.ref&&("paper"===ann.ref?(ann.xref="paper",ann.yref="paper"):"data"===ann.ref&&(ann.xref="x",ann.yref="y"),delete ann.ref),cleanAxRef(ann,"xref"),cleanAxRef(ann,"yref"))}var shapesLen=Array.isArray(layout.shapes)?layout.shapes.length:0;for(i=0;i<shapesLen;i++){var shape=layout.shapes[i];Lib.isPlainObject(shape)&&(cleanAxRef(shape,"xref"),cleanAxRef(shape,"yref"))}var legend=layout.legend;return legend&&(legend.x>3?(legend.x=1.02,legend.xanchor="left"):legend.x<-2&&(legend.x=-.02,legend.xanchor="right"),legend.y>3?(legend.y=1.02,legend.yanchor="bottom"):legend.y<-2&&(legend.y=-.02,legend.yanchor="top")),"rotate"===layout.dragmode&&(layout.dragmode="orbit"),Color.clean(layout),layout},exports.cleanData=function(data){for(var tracei=0;tracei<data.length;tracei++){var i,trace=data[tracei];if("histogramy"===trace.type&&"xbins"in trace&&!("ybins"in trace)&&(trace.ybins=trace.xbins,delete trace.xbins),trace.error_y&&"opacity"in trace.error_y){var dc=Color.defaults,yeColor=trace.error_y.color||(Registry.traceIs(trace,"bar")?Color.defaultLine:dc[tracei%dc.length]);trace.error_y.color=Color.addOpacity(Color.rgb(yeColor),Color.opacity(yeColor)*trace.error_y.opacity),delete trace.error_y.opacity}if("bardir"in trace&&("h"!==trace.bardir||!Registry.traceIs(trace,"bar")&&"histogram"!==trace.type.substr(0,9)||(trace.orientation="h",exports.swapXYData(trace)),delete trace.bardir),"histogramy"===trace.type&&exports.swapXYData(trace),"histogramx"!==trace.type&&"histogramy"!==trace.type||(trace.type="histogram"),"scl"in trace&&(trace.colorscale=trace.scl,delete trace.scl),"reversescl"in trace&&(trace.reversescale=trace.reversescl,delete trace.reversescl),trace.xaxis&&(trace.xaxis=cleanId(trace.xaxis,"x")),trace.yaxis&&(trace.yaxis=cleanId(trace.yaxis,"y")),Registry.traceIs(trace,"gl3d")&&trace.scene&&(trace.scene=Plots.subplotsRegistry.gl3d.cleanId(trace.scene)),!Registry.traceIs(trace,"pie")&&!Registry.traceIs(trace,"bar"))if(Array.isArray(trace.textposition))for(i=0;i<trace.textposition.length;i++)trace.textposition[i]=cleanTextPosition(trace.textposition[i]);else trace.textposition&&(trace.textposition=cleanTextPosition(trace.textposition));var _module=Registry.getModule(trace);if(_module&&_module.colorbar){var containerName=_module.colorbar.container,container=containerName?trace[containerName]:trace;container&&container.colorscale&&("YIGnBu"===container.colorscale&&(container.colorscale="YlGnBu"),"YIOrRd"===container.colorscale&&(container.colorscale="YlOrRd"))}if("surface"===trace.type&&Lib.isPlainObject(trace.contours)){var dims=["x","y","z"];for(i=0;i<dims.length;i++){var opts=trace.contours[dims[i]];Lib.isPlainObject(opts)&&(opts.highlightColor&&(opts.highlightcolor=opts.highlightColor,delete opts.highlightColor),opts.highlightWidth&&(opts.highlightwidth=opts.highlightWidth,delete opts.highlightWidth))}}if("candlestick"===trace.type||"ohlc"===trace.type){var increasingShowlegend=!1!==(trace.increasing||{}).showlegend,decreasingShowlegend=!1!==(trace.decreasing||{}).showlegend,increasingName=cleanFinanceDir(trace.increasing),decreasingName=cleanFinanceDir(trace.decreasing);if(!1!==increasingName&&!1!==decreasingName){var newName=commonPrefix(increasingName,decreasingName,increasingShowlegend,decreasingShowlegend);newName&&(trace.name=newName)}else!increasingName&&!decreasingName||trace.name||(trace.name=increasingName||decreasingName)}if(Array.isArray(trace.transforms)){var transforms=trace.transforms;for(i=0;i<transforms.length;i++){var transform=transforms[i];if(Lib.isPlainObject(transform))switch(transform.type){case"filter":transform.filtersrc&&(transform.target=transform.filtersrc,delete transform.filtersrc),transform.calendar&&(transform.valuecalendar||(transform.valuecalendar=transform.calendar),delete transform.calendar);break;case"groupby":if(transform.styles=transform.styles||transform.style,transform.styles&&!Array.isArray(transform.styles)){var prevStyles=transform.styles,styleKeys=Object.keys(prevStyles);transform.styles=[];for(var j=0;j<styleKeys.length;j++)transform.styles.push({target:styleKeys[j],value:prevStyles[styleKeys[j]]})}}}}emptyContainer(trace,"line")&&delete trace.line,"marker"in trace&&(emptyContainer(trace.marker,"line")&&delete trace.marker.line,emptyContainer(trace,"marker")&&delete trace.marker),Color.clean(trace)}},exports.swapXYData=function(trace){var i;if(Lib.swapAttrs(trace,["?","?0","d?","?bins","nbins?","autobin?","?src","error_?"]),Array.isArray(trace.z)&&Array.isArray(trace.z[0])&&(trace.transpose?delete trace.transpose:trace.transpose=!0),trace.error_x&&trace.error_y){var errorY=trace.error_y,copyYstyle="copy_ystyle"in errorY?errorY.copy_ystyle:!(errorY.color||errorY.thickness||errorY.width);Lib.swapAttrs(trace,["error_?.copy_ystyle"]),copyYstyle&&Lib.swapAttrs(trace,["error_?.color","error_?.thickness","error_?.width"])}if("string"==typeof trace.hoverinfo){var hoverInfoParts=trace.hoverinfo.split("+");for(i=0;i<hoverInfoParts.length;i++)"x"===hoverInfoParts[i]?hoverInfoParts[i]="y":"y"===hoverInfoParts[i]&&(hoverInfoParts[i]="x");trace.hoverinfo=hoverInfoParts.join("+")}},exports.coerceTraceIndices=function(gd,traceIndices){return isNumeric(traceIndices)?[traceIndices]:Array.isArray(traceIndices)&&traceIndices.length?traceIndices:gd.data.map(function(_,i){return i})},exports.manageArrayContainers=function(np,newVal,undoit){var obj=np.obj,parts=np.parts,pLength=parts.length,pLast=parts[pLength-1],pLastIsNumber=isNumeric(pLast);if(pLastIsNumber&&null===newVal){var contPath=parts.slice(0,pLength-1).join(".");Lib.nestedProperty(obj,contPath).get().splice(pLast,1)}else pLastIsNumber&&void 0===np.get()?(void 0===np.get()&&(undoit[np.astr]=null),np.set(newVal)):np.set(newVal)};var ATTR_TAIL_RE=/(\.[^\[\]\.]+|\[[^\[\]\.]+\])$/;function getParent(attr){var tail=attr.search(ATTR_TAIL_RE);if(tail>0)return attr.substr(0,tail)}exports.hasParent=function(aobj,attr){for(var attrParent=getParent(attr);attrParent;){if(attrParent in aobj)return!0;attrParent=getParent(attrParent)}return!1};var axLetters=["x","y","z"];exports.clearAxisTypes=function(gd,traces,layoutUpdate){for(var i=0;i<traces.length;i++)for(var trace=gd._fullData[i],j=0;j<3;j++){var ax=getFromTrace(gd,trace,axLetters[j]);if(ax&&"log"!==ax.type){var axAttr=ax._name,sceneName=ax._id.substr(1);if("scene"===sceneName.substr(0,5)){if(void 0!==layoutUpdate[sceneName])continue;axAttr=sceneName+"."+axAttr}var typeAttr=axAttr+".type";void 0===layoutUpdate[axAttr]&&void 0===layoutUpdate[typeAttr]&&Lib.nestedProperty(gd.layout,typeAttr).set(null)}}}},{"../components/color":567,"../lib":693,"../plots/cartesian/axis_ids":745,"../plots/plots":805,"../registry":825,"fast-isnumeric":213,"gl-mat4/fromQuat":250}],727:[function(_dereq_,module,exports){"use strict";var main=_dereq_("./plot_api");exports.plot=main.plot,exports.newPlot=main.newPlot,exports.restyle=main.restyle,exports.relayout=main.relayout,exports.redraw=main.redraw,exports.update=main.update,exports.react=main.react,exports.extendTraces=main.extendTraces,exports.prependTraces=main.prependTraces,exports.addTraces=main.addTraces,exports.deleteTraces=main.deleteTraces,exports.moveTraces=main.moveTraces,exports.purge=main.purge,exports.addFrames=main.addFrames,exports.deleteFrames=main.deleteFrames,exports.animate=main.animate,exports.setPlotConfig=main.setPlotConfig,exports.toImage=_dereq_("./to_image"),exports.validate=_dereq_("./validate"),exports.downloadImage=_dereq_("../snapshot/download");var templateApi=_dereq_("./template_api");exports.makeTemplate=templateApi.makeTemplate,exports.validateTemplate=templateApi.validateTemplate},{"../snapshot/download":827,"./plot_api":729,"./template_api":734,"./to_image":735,"./validate":736}],728:[function(_dereq_,module,exports){"use strict";var nestedProperty=_dereq_("../lib/nested_property"),isPlainObject=_dereq_("../lib/is_plain_object"),noop=_dereq_("../lib/noop"),Loggers=_dereq_("../lib/loggers"),sorterAsc=_dereq_("../lib/search").sorterAsc,Registry=_dereq_("../registry");exports.containerArrayMatch=_dereq_("./container_array_match");var isAddVal=exports.isAddVal=function isAddVal(val){return"add"===val||isPlainObject(val)},isRemoveVal=exports.isRemoveVal=function isRemoveVal(val){return null===val||"remove"===val};exports.applyContainerArrayChanges=function applyContainerArrayChanges(gd,np,edits,flags){var componentType=np.astr,supplyComponentDefaults=Registry.getComponentMethod(componentType,"supplyLayoutDefaults"),draw=Registry.getComponentMethod(componentType,"draw"),drawOne=Registry.getComponentMethod(componentType,"drawOne"),replotLater=flags.replot||flags.recalc||supplyComponentDefaults===noop||draw===noop,layout=gd.layout,fullLayout=gd._fullLayout;if(edits[""]){Object.keys(edits).length>1&&Loggers.warn("Full array edits are incompatible with other edits",componentType);var fullVal=edits[""][""];if(isRemoveVal(fullVal))np.set(null);else{if(!Array.isArray(fullVal))return Loggers.warn("Unrecognized full array edit value",componentType,fullVal),!0;np.set(fullVal)}return!replotLater&&(supplyComponentDefaults(layout,fullLayout),draw(gd),!0)}var i,j,componentNum,objEdits,objKeys,objVal,adding,componentNums=Object.keys(edits).map(Number).sort(sorterAsc),componentArrayIn=np.get(),componentArray=componentArrayIn||[],componentArrayFull=nestedProperty(fullLayout,componentType).get(),deletes=[],firstIndexChange=-1,maxIndex=componentArray.length;for(i=0;i<componentNums.length;i++)if(objEdits=edits[componentNum=componentNums[i]],objKeys=Object.keys(objEdits),objVal=objEdits[""],adding=isAddVal(objVal),componentNum<0||componentNum>componentArray.length-(adding?0:1))Loggers.warn("index out of range",componentType,componentNum);else if(void 0!==objVal)objKeys.length>1&&Loggers.warn("Insertion & removal are incompatible with edits to the same index.",componentType,componentNum),isRemoveVal(objVal)?deletes.push(componentNum):adding?("add"===objVal&&(objVal={}),componentArray.splice(componentNum,0,objVal),componentArrayFull&&componentArrayFull.splice(componentNum,0,{})):Loggers.warn("Unrecognized full object edit value",componentType,componentNum,objVal),-1===firstIndexChange&&(firstIndexChange=componentNum);else for(j=0;j<objKeys.length;j++)nestedProperty(componentArray[componentNum],objKeys[j]).set(objEdits[objKeys[j]]);for(i=deletes.length-1;i>=0;i--)componentArray.splice(deletes[i],1),componentArrayFull&&componentArrayFull.splice(deletes[i],1);if(componentArray.length?componentArrayIn||np.set(componentArray):np.set(null),replotLater)return!1;if(supplyComponentDefaults(layout,fullLayout),drawOne!==noop){var indicesToDraw;if(-1===firstIndexChange)indicesToDraw=componentNums;else{for(maxIndex=Math.max(componentArray.length,maxIndex),indicesToDraw=[],i=0;i<componentNums.length&&!((componentNum=componentNums[i])>=firstIndexChange);i++)indicesToDraw.push(componentNum);for(i=firstIndexChange;i<maxIndex;i++)indicesToDraw.push(i)}for(i=0;i<indicesToDraw.length;i++)drawOne(gd,indicesToDraw[i])}else draw(gd);return!0}},{"../lib/is_plain_object":695,"../lib/loggers":698,"../lib/nested_property":702,"../lib/noop":703,"../lib/search":713,"../registry":825,"./container_array_match":724}],729:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),hasHover=_dereq_("has-hover"),Lib=_dereq_("../lib"),Events=_dereq_("../lib/events"),Queue=_dereq_("../lib/queue"),Registry=_dereq_("../registry"),PlotSchema=_dereq_("./plot_schema"),Plots=_dereq_("../plots/plots"),Polar=_dereq_("../plots/polar/legacy"),Axes=_dereq_("../plots/cartesian/axes"),Drawing=_dereq_("../components/drawing"),Color=_dereq_("../components/color"),connectColorbar=_dereq_("../components/colorbar/connect"),initInteractions=_dereq_("../plots/cartesian/graph_interact").initInteractions,xmlnsNamespaces=_dereq_("../constants/xmlns_namespaces"),svgTextUtils=_dereq_("../lib/svg_text_utils"),defaultConfig=_dereq_("./plot_config"),manageArrays=_dereq_("./manage_arrays"),helpers=_dereq_("./helpers"),subroutines=_dereq_("./subroutines"),editTypes=_dereq_("./edit_types"),AX_NAME_PATTERN=_dereq_("../plots/cartesian/constants").AX_NAME_PATTERN,numericNameWarningCount=0;function emitAfterPlot(gd){var fullLayout=gd._fullLayout;fullLayout._redrawFromAutoMarginCount?fullLayout._redrawFromAutoMarginCount--:gd.emit("plotly_afterplot")}function setBackground(gd,bgColor){try{gd._fullLayout._paper.style("background",bgColor)}catch(e){Lib.error(e)}}function opaqueSetBackground(gd,bgColor){setBackground(gd,Color.combine(bgColor,"white"))}function setPlotContext(gd,config){gd._context||(gd._context=Lib.extendDeep({},defaultConfig));var i,keys,key,context=gd._context;if(config){for(keys=Object.keys(config),i=0;i<keys.length;i++)"editable"!==(key=keys[i])&&"edits"!==key&&key in context&&("setBackground"===key&&"opaque"===config[key]?context[key]=opaqueSetBackground:context[key]=config[key]);config.plot3dPixelRatio&&!context.plotGlPixelRatio&&(context.plotGlPixelRatio=context.plot3dPixelRatio);var editable=config.editable;if(void 0!==editable)for(context.editable=editable,keys=Object.keys(context.edits),i=0;i<keys.length;i++)context.edits[keys[i]]=editable;if(config.edits)for(keys=Object.keys(config.edits),i=0;i<keys.length;i++)(key=keys[i])in context.edits&&(context.edits[key]=config.edits[key])}context.staticPlot&&(context.editable=!1,context.edits={},context.autosizable=!1,context.scrollZoom=!1,context.doubleClick=!1,context.showTips=!1,context.showLink=!1,context.displayModeBar=!1),"hover"!==context.displayModeBar||hasHover||(context.displayModeBar=!0),"transparent"!==context.setBackground&&"function"==typeof context.setBackground||(context.setBackground=setBackground)}function positivifyIndices(indices,maxIndex){var i,index,parentLength=maxIndex+1,positiveIndices=[];for(i=0;i<indices.length;i++)(index=indices[i])<0?positiveIndices.push(parentLength+index):positiveIndices.push(index);return positiveIndices}function assertIndexArray(gd,indices,arrayName){var i,index;for(i=0;i<indices.length;i++){if((index=indices[i])!==parseInt(index,10))throw new Error("all values in "+arrayName+" must be integers");if(index>=gd.data.length||index<-gd.data.length)throw new Error(arrayName+" must be valid indices for gd.data.");if(indices.indexOf(index,i+1)>-1||index>=0&&indices.indexOf(-gd.data.length+index)>-1||index<0&&indices.indexOf(gd.data.length+index)>-1)throw new Error("each index in "+arrayName+" must be unique.")}}function checkMoveTracesArgs(gd,currentIndices,newIndices){if(!Array.isArray(gd.data))throw new Error("gd.data must be an array.");if(void 0===currentIndices)throw new Error("currentIndices is a required argument.");if(Array.isArray(currentIndices)||(currentIndices=[currentIndices]),assertIndexArray(gd,currentIndices,"currentIndices"),void 0===newIndices||Array.isArray(newIndices)||(newIndices=[newIndices]),void 0!==newIndices&&assertIndexArray(gd,newIndices,"newIndices"),void 0!==newIndices&&currentIndices.length!==newIndices.length)throw new Error("current and new indices must be of equal length.")}function spliceTraces(gd,update,indices,maxPoints,updateArray){!function assertExtendTracesArgs(gd,update,indices,maxPoints){var maxPointsIsObject=Lib.isPlainObject(maxPoints);if(!Array.isArray(gd.data))throw new Error("gd.data must be an array");if(!Lib.isPlainObject(update))throw new Error("update must be a key:value object");if(void 0===indices)throw new Error("indices must be an integer or array of integers");for(var key in assertIndexArray(gd,indices,"indices"),update){if(!Array.isArray(update[key])||update[key].length!==indices.length)throw new Error("attribute "+key+" must be an array of length equal to indices array length");if(maxPointsIsObject&&(!(key in maxPoints)||!Array.isArray(maxPoints[key])||maxPoints[key].length!==update[key].length))throw new Error("when maxPoints is set as a key:value object it must contain a 1:1 corrispondence with the keys and number of traces in the update object")}}(gd,update,indices,maxPoints);for(var updateProps=function getExtendProperties(gd,update,indices,maxPoints){var trace,target,prop,insert,maxp,maxPointsIsObject=Lib.isPlainObject(maxPoints),updateProps=[];for(var key in Array.isArray(indices)||(indices=[indices]),indices=positivifyIndices(indices,gd.data.length-1),update)for(var j=0;j<indices.length;j++){if(trace=gd.data[indices[j]],target=(prop=Lib.nestedProperty(trace,key)).get(),insert=update[key][j],!Lib.isArrayOrTypedArray(insert))throw new Error("attribute: "+key+" index: "+j+" must be an array");if(!Lib.isArrayOrTypedArray(target))throw new Error("cannot extend missing or non-array attribute: "+key);if(target.constructor!==insert.constructor)throw new Error("cannot extend array with an array of a different type: "+key);maxp=maxPointsIsObject?maxPoints[key][j]:maxPoints,isNumeric(maxp)||(maxp=-1),updateProps.push({prop:prop,target:target,insert:insert,maxp:Math.floor(maxp)})}return updateProps}(gd,update,indices,maxPoints),undoUpdate={},undoPoints={},i=0;i<updateProps.length;i++){var prop=updateProps[i].prop,maxp=updateProps[i].maxp,out=updateArray(updateProps[i].target,updateProps[i].insert,maxp);prop.set(out[0]),Array.isArray(undoUpdate[prop.astr])||(undoUpdate[prop.astr]=[]),undoUpdate[prop.astr].push(out[1]),Array.isArray(undoPoints[prop.astr])||(undoPoints[prop.astr]=[]),undoPoints[prop.astr].push(updateProps[i].target.length)}return{update:undoUpdate,maxPoints:undoPoints}}function concatTypedArray(arr0,arr1){var arr2=new arr0.constructor(arr0.length+arr1.length);return arr2.set(arr0),arr2.set(arr1,arr0.length),arr2}function undefinedToNull(val){return void 0===val?null:val}function _restyle(gd,aobj,traces){var i,axlist,fullLayout=gd._fullLayout,fullData=gd._fullData,data=gd.data,flags=editTypes.traceFlags(),redoit={},undoit={};function a0(){return traces.map(function(){})}function addToAxlist(axid){var axName=Axes.id2name(axid);-1===axlist.indexOf(axName)&&axlist.push(axName)}function autorangeAttr(axName){return"LAYOUT"+axName+".autorange"}function rangeAttr(axName){return"LAYOUT"+axName+".range"}function doextra(attr,val,i){var extraparam;Array.isArray(attr)?attr.forEach(function(a){doextra(a,val,i)}):attr in aobj||helpers.hasParent(aobj,attr)||(extraparam="LAYOUT"===attr.substr(0,6)?Lib.nestedProperty(gd.layout,attr.replace("LAYOUT","")):Lib.nestedProperty(data[traces[i]],attr),attr in undoit||(undoit[attr]=a0()),void 0===undoit[attr][i]&&(undoit[attr][i]=undefinedToNull(extraparam.get())),void 0!==val&&extraparam.set(val))}for(var ai in aobj){if(helpers.hasParent(aobj,ai))throw new Error("cannot set "+ai+"and a parent attribute simultaneously");var cont,contFull,param,oldVal,newVal,valObject,vi=aobj[ai];if(redoit[ai]=vi,"LAYOUT"!==ai.substr(0,6)){for(undoit[ai]=a0(),i=0;i<traces.length;i++)if(cont=data[traces[i]],contFull=fullData[traces[i]],oldVal=(param=Lib.nestedProperty(cont,ai)).get(),void 0!==(newVal=Array.isArray(vi)?vi[i%vi.length]:vi)){var finalPart=param.parts[param.parts.length-1],prefix=ai.substr(0,ai.length-finalPart.length-1),prefixDot=prefix?prefix+".":"",innerContFull=prefix?Lib.nestedProperty(contFull,prefix).get():contFull;if((valObject=PlotSchema.getTraceValObject(contFull,param.parts))&&valObject.impliedEdits&&null!==newVal)for(var impliedKey in valObject.impliedEdits)doextra(Lib.relativeAttr(ai,impliedKey),valObject.impliedEdits[impliedKey],i);else if("thicknessmode"!==finalPart&&"lenmode"!==finalPart||oldVal===newVal||"fraction"!==newVal&&"pixels"!==newVal||!innerContFull){if("type"===ai&&"pie"===newVal!=("pie"===oldVal)){var labelsTo="x",valuesTo="y";"bar"!==newVal&&"bar"!==oldVal||"h"!==cont.orientation||(labelsTo="y",valuesTo="x"),Lib.swapAttrs(cont,["?","?src"],"labels",labelsTo),Lib.swapAttrs(cont,["d?","?0"],"label",labelsTo),Lib.swapAttrs(cont,["?","?src"],"values",valuesTo),"pie"===oldVal?(Lib.nestedProperty(cont,"marker.color").set(Lib.nestedProperty(cont,"marker.colors").get()),fullLayout._pielayer.selectAll("g.trace").remove()):Registry.traceIs(cont,"cartesian")&&Lib.nestedProperty(cont,"marker.colors").set(Lib.nestedProperty(cont,"marker.color").get())}}else{var gs=fullLayout._size,orient=innerContFull.orient,topOrBottom="top"===orient||"bottom"===orient;if("thicknessmode"===finalPart){var thicknorm=topOrBottom?gs.h:gs.w;doextra(prefixDot+"thickness",innerContFull.thickness*("fraction"===newVal?1/thicknorm:thicknorm),i)}else{var lennorm=topOrBottom?gs.w:gs.h;doextra(prefixDot+"len",innerContFull.len*("fraction"===newVal?1/lennorm:lennorm),i)}}undoit[ai][i]=undefinedToNull(oldVal);if(-1!==["swapxy","swapxyaxes","orientation","orientationaxes"].indexOf(ai)){if("orientation"===ai){param.set(newVal);var defaultOrientation=cont.x&&!cont.y?"h":"v";if((param.get()||defaultOrientation)===contFull.orientation)continue}else"orientationaxes"===ai&&(cont.orientation={v:"h",h:"v"}[contFull.orientation]);helpers.swapXYData(cont),flags.calc=flags.clearAxisTypes=!0}else-1!==Plots.dataArrayContainers.indexOf(param.parts[0])?(helpers.manageArrayContainers(param,newVal,undoit),flags.calc=!0):(valObject?valObject.arrayOk&&(Lib.isArrayOrTypedArray(newVal)||Lib.isArrayOrTypedArray(oldVal))?flags.calc=!0:editTypes.update(flags,valObject):flags.calc=!0,param.set(newVal))}if(-1!==["swapxyaxes","orientationaxes"].indexOf(ai)&&Axes.swap(gd,traces),"orientationaxes"===ai){var hovermode=Lib.nestedProperty(gd.layout,"hovermode");"x"===hovermode.get()?hovermode.set("y"):"y"===hovermode.get()&&hovermode.set("x")}if(-1!==["orientation","type"].indexOf(ai)){for(axlist=[],i=0;i<traces.length;i++){var trace=data[traces[i]];Registry.traceIs(trace,"cartesian")&&(addToAxlist(trace.xaxis||"x"),addToAxlist(trace.yaxis||"y"),"type"===ai&&doextra(["autobinx","autobiny"],!0,i))}doextra(axlist.map(autorangeAttr),!0,0),doextra(axlist.map(rangeAttr),[0,1],0)}}else param=Lib.nestedProperty(gd.layout,ai.replace("LAYOUT","")),undoit[ai]=[undefinedToNull(param.get())],param.set(Array.isArray(vi)?vi[0]:vi),flags.calc=!0}return(flags.calc||flags.plot)&&(flags.fullReplot=!0),{flags:flags,undoit:undoit,redoit:redoit,traces:traces,eventData:Lib.extendDeepNoArrays([],[redoit,traces])}}function addAxRangeSequence(seq,rangesAltered){var doTicks=rangesAltered?function(gd){return subroutines.doTicksRelayout(gd,rangesAltered)}:subroutines.doTicksRelayout;seq.push(subroutines.doAutoRangeAndConstraints,doTicks,subroutines.drawData,subroutines.finalDraw)}exports.plot=function(gd,data,layout,config){var frames;if(gd=Lib.getGraphDiv(gd),Events.init(gd),Lib.isPlainObject(data)){var obj=data;data=obj.data,layout=obj.layout,config=obj.config,frames=obj.frames}if(!1===Events.triggerHandler(gd,"plotly_beforeplot",[data,layout,config]))return Promise.reject();data||layout||Lib.isPlotDiv(gd)||Lib.warn("Calling Plotly.plot as if redrawing but this container doesn't yet have a plot.",gd),setPlotContext(gd,config),layout||(layout={}),d3.select(gd).classed("js-plotly-plot",!0),Drawing.makeTester(),delete Drawing.baseUrl,Array.isArray(gd._promises)||(gd._promises=[]);var graphWasEmpty=0===(gd.data||[]).length&&Array.isArray(data);if(Array.isArray(data)&&(helpers.cleanData(data),graphWasEmpty?gd.data=data:gd.data.push.apply(gd.data,data),gd.empty=!1),gd.layout&&!graphWasEmpty||(gd.layout=helpers.cleanLayout(layout)),gd._dragging&&!gd._transitioning)return gd._replotPending=!0,Promise.reject();gd._replotPending=!1,Plots.supplyDefaults(gd);var fullLayout=gd._fullLayout,hasCartesian=fullLayout._has("cartesian");if(!fullLayout._has("polar")&&data&&data[0]&&data[0].r)return Lib.log("Legacy polar charts are deprecated!"),function plotPolar(gd,data,layout){var plotContainer=d3.select(gd).selectAll(".plot-container").data([0]);plotContainer.enter().insert("div",":first-child").classed("plot-container plotly",!0);var paperDiv=plotContainer.selectAll(".svg-container").data([0]);paperDiv.enter().append("div").classed("svg-container",!0).style("position","relative"),paperDiv.html(""),data&&(gd.data=data);layout&&(gd.layout=layout);Polar.manager.fillLayout(gd),paperDiv.style({width:gd._fullLayout.width+"px",height:gd._fullLayout.height+"px"}),gd.framework=Polar.manager.framework(gd),gd.framework({data:gd.data,layout:gd.layout},paperDiv.node()),gd.framework.setUndoPoint();var polarPlotSVG=gd.framework.svg(),opacity=1,txt=gd._fullLayout.title;""!==txt&&txt||(opacity=0);var titleLayout=function(){this.call(svgTextUtils.convertToTspans,gd)},title=polarPlotSVG.select(".title-group text").call(titleLayout);if(gd._context.edits.titleText){var placeholderText=Lib._(gd,"Click to enter Plot title");txt&&txt!==placeholderText||(opacity=.2,title.attr({"data-unformatted":placeholderText}).text(placeholderText).style({opacity:opacity}).on("mouseover.opacity",function(){d3.select(this).transition().duration(100).style("opacity",1)}).on("mouseout.opacity",function(){d3.select(this).transition().duration(1e3).style("opacity",0)}));var setContenteditable=function(){this.call(svgTextUtils.makeEditable,{gd:gd}).on("edit",function(text){gd.framework({layout:{title:text}}),this.text(text).call(titleLayout),this.call(setContenteditable)}).on("cancel",function(){var txt=this.attr("data-unformatted");this.text(txt).call(titleLayout)})};title.call(setContenteditable)}return gd._context.setBackground(gd,gd._fullLayout.paper_bgcolor),Plots.addLinks(gd),Promise.resolve()}(gd,data,layout);fullLayout._replotting=!0,graphWasEmpty&&makePlotFramework(gd),gd.framework!==makePlotFramework&&(gd.framework=makePlotFramework,makePlotFramework(gd)),Drawing.initGradients(gd),graphWasEmpty&&Axes.saveShowSpikeInitial(gd);var recalc=!gd.calcdata||gd.calcdata.length!==(gd._fullData||[]).length;recalc&&Plots.doCalcdata(gd);for(var i=0;i<gd.calcdata.length;i++)gd.calcdata[i][0].trace=gd._fullData[i];gd._context.responsive?gd._responsiveChartHandler||(gd._responsiveChartHandler=function(){Plots.resize(gd)},window.addEventListener("resize",gd._responsiveChartHandler)):Lib.clearResponsive(gd);var oldmargins=JSON.stringify(fullLayout._size),drawFrameworkCalls=0;function marginPushers(){var i,cd,trace,calcdata=gd.calcdata;for(Plots.clearAutoMarginIds(gd),subroutines.drawMarginPushers(gd),Axes.allowAutoMargin(gd),i=0;i<calcdata.length;i++){var colorbarOpts=(trace=(cd=calcdata[i])[0].trace)._module.colorbar;!0===trace.visible&&colorbarOpts?connectColorbar(gd,cd,colorbarOpts):Plots.autoMargin(gd,"cb"+trace.uid)}return Plots.doAutoMargin(gd),Plots.previousPromises(gd)}function doAutoRangeAndConstraints(){gd._transitioning||(subroutines.doAutoRangeAndConstraints(gd),graphWasEmpty&&Axes.saveRangeInitial(gd))}var seq=[Plots.previousPromises,function addFrames(){if(frames)return exports.addFrames(gd,frames)},function drawFramework(){for(var basePlotModules=fullLayout._basePlotModules,i=0;i<basePlotModules.length;i++)basePlotModules[i].drawFramework&&basePlotModules[i].drawFramework(gd);if(!fullLayout._glcanvas&&fullLayout._has("gl")&&(fullLayout._glcanvas=fullLayout._glcontainer.selectAll(".gl-canvas").data([{key:"contextLayer",context:!0,pick:!1},{key:"focusLayer",context:!1,pick:!1},{key:"pickLayer",context:!1,pick:!0}],function(d){return d.key}),fullLayout._glcanvas.enter().append("canvas").attr("class",function(d){return"gl-canvas gl-canvas-"+d.key.replace("Layer","")}).style({position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"visible","pointer-events":"none"})),fullLayout._glcanvas){fullLayout._glcanvas.attr("width",fullLayout.width).attr("height",fullLayout.height);var regl=fullLayout._glcanvas.data()[0].regl;if(regl&&(fullLayout.width!==regl._gl.drawingBufferWidth||fullLayout.height!==regl._gl.drawingBufferHeight)){var msg="WebGL context buffer and canvas dimensions do not match due to browser/WebGL bug.";if(!drawFrameworkCalls)return Lib.log(msg+" Clearing graph and plotting again."),Plots.cleanPlot([],{},gd._fullData,fullLayout,gd.calcdata),Plots.supplyDefaults(gd),fullLayout=gd._fullLayout,Plots.doCalcdata(gd),drawFrameworkCalls++,drawFramework();Lib.error(msg)}}return Plots.previousPromises(gd)},marginPushers,function marginPushersAgain(){if(JSON.stringify(fullLayout._size)!==oldmargins)return Lib.syncOrAsync([marginPushers,subroutines.layoutStyles],gd)}];hasCartesian&&seq.push(function positionAndAutorange(){if(recalc)return Lib.syncOrAsync([Registry.getComponentMethod("shapes","calcAutorange"),Registry.getComponentMethod("annotations","calcAutorange"),doAutoRangeAndConstraints,Registry.getComponentMethod("rangeslider","calcAutorange")],gd);doAutoRangeAndConstraints()}),seq.push(subroutines.layoutStyles),hasCartesian&&seq.push(function drawAxes(){return Axes.doTicks(gd,graphWasEmpty?"":"redraw")}),seq.push(subroutines.drawData,subroutines.finalDraw,initInteractions,Plots.addLinks,Plots.rehover,Plots.doAutoMargin,Plots.previousPromises);var plotDone=Lib.syncOrAsync(seq,gd);return plotDone&&plotDone.then||(plotDone=Promise.resolve()),plotDone.then(function(){return emitAfterPlot(gd),gd})},exports.setPlotConfig=function setPlotConfig(obj){return Lib.extendFlat(defaultConfig,obj)},exports.redraw=function(gd){if(gd=Lib.getGraphDiv(gd),!Lib.isPlotDiv(gd))throw new Error("This element is not a Plotly plot: "+gd);return helpers.cleanData(gd.data),helpers.cleanLayout(gd.layout),gd.calcdata=void 0,exports.plot(gd).then(function(){return gd.emit("plotly_redraw"),gd})},exports.newPlot=function(gd,data,layout,config){return gd=Lib.getGraphDiv(gd),Plots.cleanPlot([],{},gd._fullData||[],gd._fullLayout||{},gd.calcdata||[]),Plots.purge(gd),exports.plot(gd,data,layout,config)},exports.extendTraces=function extendTraces(gd,update,indices,maxPoints){var undo=spliceTraces(gd=Lib.getGraphDiv(gd),update,indices,maxPoints,function updateArray(target,insert,maxp){var newArray,remainder;if(Lib.isTypedArray(target))if(maxp<0){var none=new target.constructor(0),both=concatTypedArray(target,insert);maxp<0?(newArray=both,remainder=none):(newArray=none,remainder=both)}else if(newArray=new target.constructor(maxp),remainder=new target.constructor(target.length+insert.length-maxp),maxp===insert.length)newArray.set(insert),remainder.set(target);else if(maxp<insert.length){var numberOfItemsFromInsert=insert.length-maxp;newArray.set(insert.subarray(numberOfItemsFromInsert)),remainder.set(target),remainder.set(insert.subarray(0,numberOfItemsFromInsert),target.length)}else{var numberOfItemsFromTarget=maxp-insert.length,targetBegin=target.length-numberOfItemsFromTarget;newArray.set(target.subarray(targetBegin)),newArray.set(insert,numberOfItemsFromTarget),remainder.set(target.subarray(0,targetBegin))}else newArray=target.concat(insert),remainder=maxp>=0&&maxp<newArray.length?newArray.splice(0,newArray.length-maxp):[];return[newArray,remainder]}),promise=exports.redraw(gd),undoArgs=[gd,undo.update,indices,undo.maxPoints];return Queue.add(gd,exports.prependTraces,undoArgs,extendTraces,arguments),promise},exports.prependTraces=function prependTraces(gd,update,indices,maxPoints){var undo=spliceTraces(gd=Lib.getGraphDiv(gd),update,indices,maxPoints,function updateArray(target,insert,maxp){var newArray,remainder;if(Lib.isTypedArray(target))if(maxp<=0){var none=new target.constructor(0),both=concatTypedArray(insert,target);maxp<0?(newArray=both,remainder=none):(newArray=none,remainder=both)}else if(newArray=new target.constructor(maxp),remainder=new target.constructor(target.length+insert.length-maxp),maxp===insert.length)newArray.set(insert),remainder.set(target);else if(maxp<insert.length){var numberOfItemsFromInsert=insert.length-maxp;newArray.set(insert.subarray(0,numberOfItemsFromInsert)),remainder.set(insert.subarray(numberOfItemsFromInsert)),remainder.set(target,numberOfItemsFromInsert)}else{var numberOfItemsFromTarget=maxp-insert.length;newArray.set(insert),newArray.set(target.subarray(0,numberOfItemsFromTarget),insert.length),remainder.set(target.subarray(numberOfItemsFromTarget))}else newArray=insert.concat(target),remainder=maxp>=0&&maxp<newArray.length?newArray.splice(maxp,newArray.length):[];return[newArray,remainder]}),promise=exports.redraw(gd),undoArgs=[gd,undo.update,indices,undo.maxPoints];return Queue.add(gd,exports.extendTraces,undoArgs,prependTraces,arguments),promise},exports.addTraces=function addTraces(gd,traces,newIndices){gd=Lib.getGraphDiv(gd);var i,promise,currentIndices=[],undoFunc=exports.deleteTraces,redoFunc=addTraces,undoArgs=[gd,currentIndices],redoArgs=[gd,traces];for(function checkAddTracesArgs(gd,traces,newIndices){var i,value;if(!Array.isArray(gd.data))throw new Error("gd.data must be an array.");if(void 0===traces)throw new Error("traces must be defined.");for(Array.isArray(traces)||(traces=[traces]),i=0;i<traces.length;i++)if("object"!=typeof(value=traces[i])||Array.isArray(value)||null===value)throw new Error("all values in traces array must be non-array objects");if(void 0===newIndices||Array.isArray(newIndices)||(newIndices=[newIndices]),void 0!==newIndices&&newIndices.length!==traces.length)throw new Error("if indices is specified, traces.length must equal indices.length")}(gd,traces,newIndices),Array.isArray(traces)||(traces=[traces]),traces=traces.map(function(trace){return Lib.extendFlat({},trace)}),helpers.cleanData(traces),i=0;i<traces.length;i++)gd.data.push(traces[i]);for(i=0;i<traces.length;i++)currentIndices.push(-traces.length+i);if(void 0===newIndices)return promise=exports.redraw(gd),Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),promise;Array.isArray(newIndices)||(newIndices=[newIndices]);try{checkMoveTracesArgs(gd,currentIndices,newIndices)}catch(error){throw gd.data.splice(gd.data.length-traces.length,traces.length),error}return Queue.startSequence(gd),Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),promise=exports.moveTraces(gd,currentIndices,newIndices),Queue.stopSequence(gd),promise},exports.deleteTraces=function deleteTraces(gd,indices){gd=Lib.getGraphDiv(gd);var i,deletedTrace,traces=[],undoFunc=exports.addTraces,redoFunc=deleteTraces,undoArgs=[gd,traces,indices],redoArgs=[gd,indices];if(void 0===indices)throw new Error("indices must be an integer or array of integers.");for(Array.isArray(indices)||(indices=[indices]),assertIndexArray(gd,indices,"indices"),(indices=positivifyIndices(indices,gd.data.length-1)).sort(Lib.sorterDes),i=0;i<indices.length;i+=1)deletedTrace=gd.data.splice(indices[i],1)[0],traces.push(deletedTrace);var promise=exports.redraw(gd);return Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),promise},exports.moveTraces=function moveTraces(gd,currentIndices,newIndices){var i,newData=[],movingTraceMap=[],undoFunc=moveTraces,redoFunc=moveTraces,undoArgs=[gd=Lib.getGraphDiv(gd),newIndices,currentIndices],redoArgs=[gd,currentIndices,newIndices];if(checkMoveTracesArgs(gd,currentIndices,newIndices),currentIndices=Array.isArray(currentIndices)?currentIndices:[currentIndices],void 0===newIndices)for(newIndices=[],i=0;i<currentIndices.length;i++)newIndices.push(-currentIndices.length+i);for(newIndices=Array.isArray(newIndices)?newIndices:[newIndices],currentIndices=positivifyIndices(currentIndices,gd.data.length-1),newIndices=positivifyIndices(newIndices,gd.data.length-1),i=0;i<gd.data.length;i++)-1===currentIndices.indexOf(i)&&newData.push(gd.data[i]);for(i=0;i<currentIndices.length;i++)movingTraceMap.push({newIndex:newIndices[i],trace:gd.data[currentIndices[i]]});for(movingTraceMap.sort(function(a,b){return a.newIndex-b.newIndex}),i=0;i<movingTraceMap.length;i+=1)newData.splice(movingTraceMap[i].newIndex,0,movingTraceMap[i].trace);gd.data=newData;var promise=exports.redraw(gd);return Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),promise},exports.restyle=function restyle(gd,astr,val,_traces){gd=Lib.getGraphDiv(gd),helpers.clearPromiseQueue(gd);var aobj={};if("string"==typeof astr)aobj[astr]=val;else{if(!Lib.isPlainObject(astr))return Lib.warn("Restyle fail.",astr,val,_traces),Promise.reject();aobj=Lib.extendFlat({},astr),void 0===_traces&&(_traces=val)}Object.keys(aobj).length&&(gd.changed=!0);var traces=helpers.coerceTraceIndices(gd,_traces),specs=_restyle(gd,aobj,traces),flags=specs.flags;flags.calc&&(gd.calcdata=void 0),flags.clearAxisTypes&&helpers.clearAxisTypes(gd,traces,{});var seq=[];flags.fullReplot?seq.push(exports.plot):(seq.push(Plots.previousPromises),Plots.supplyDefaults(gd),flags.style&&seq.push(subroutines.doTraceStyle),flags.colorbars&&seq.push(subroutines.doColorBars),seq.push(emitAfterPlot)),seq.push(Plots.rehover),Queue.add(gd,restyle,[gd,specs.undoit,specs.traces],restyle,[gd,specs.redoit,specs.traces]);var plotDone=Lib.syncOrAsync(seq,gd);return plotDone&&plotDone.then||(plotDone=Promise.resolve()),plotDone.then(function(){return gd.emit("plotly_restyle",specs.eventData),gd})},exports.relayout=function relayout(gd,astr,val){if(gd=Lib.getGraphDiv(gd),helpers.clearPromiseQueue(gd),gd.framework&&gd.framework.isPolar)return Promise.resolve(gd);var aobj={};if("string"==typeof astr)aobj[astr]=val;else{if(!Lib.isPlainObject(astr))return Lib.warn("Relayout fail.",astr,val),Promise.reject();aobj=Lib.extendFlat({},astr)}Object.keys(aobj).length&&(gd.changed=!0);var specs=_relayout(gd,aobj),flags=specs.flags;flags.calc&&(gd.calcdata=void 0);var seq=[Plots.previousPromises];flags.layoutReplot?seq.push(subroutines.layoutReplot):Object.keys(aobj).length&&(Plots.supplyDefaults(gd),flags.legend&&seq.push(subroutines.doLegend),flags.layoutstyle&&seq.push(subroutines.layoutStyles),flags.axrange&&addAxRangeSequence(seq,specs.rangesAltered),flags.ticks&&seq.push(subroutines.doTicksRelayout),flags.modebar&&seq.push(subroutines.doModeBar),flags.camera&&seq.push(subroutines.doCamera),seq.push(emitAfterPlot)),seq.push(Plots.rehover),Queue.add(gd,relayout,[gd,specs.undoit],relayout,[gd,specs.redoit]);var plotDone=Lib.syncOrAsync(seq,gd);return plotDone&&plotDone.then||(plotDone=Promise.resolve(gd)),plotDone.then(function(){return gd.emit("plotly_relayout",specs.eventData),gd})};var AX_RANGE_RE=/^[xyz]axis[0-9]*\.range(\[[0|1]\])?$/,AX_AUTORANGE_RE=/^[xyz]axis[0-9]*\.autorange$/,AX_DOMAIN_RE=/^[xyz]axis[0-9]*\.domain(\[[0|1]\])?$/;function _relayout(gd,aobj){var arrayStr,i,j,layout=gd.layout,fullLayout=gd._fullLayout,keys=Object.keys(aobj),axes=Axes.list(gd),arrayEdits={};for(i=0;i<keys.length;i++)if(0===keys[i].indexOf("allaxes")){for(j=0;j<axes.length;j++){var scene=axes[j]._id.substr(1),axisAttr=-1!==scene.indexOf("scene")?scene+".":"",newkey=keys[i].replace("allaxes",axisAttr+axes[j]._name);aobj[newkey]||(aobj[newkey]=aobj[keys[i]])}delete aobj[keys[i]]}var flags=editTypes.layoutFlags(),redoit={},undoit={};function doextra(attr,val){if(Array.isArray(attr))attr.forEach(function(a){doextra(a,val)});else if(!(attr in aobj||helpers.hasParent(aobj,attr))){var p=Lib.nestedProperty(layout,attr);attr in undoit||(undoit[attr]=undefinedToNull(p.get())),void 0!==val&&p.set(val)}}var axId,rangesAltered={};function recordAlteredAxis(pleafPlus){var axId=Axes.name2id(pleafPlus.split(".")[0]);return rangesAltered[axId]=1,axId}for(var ai in aobj){if(helpers.hasParent(aobj,ai))throw new Error("cannot set "+ai+"and a parent attribute simultaneously");for(var p=Lib.nestedProperty(layout,ai),vi=aobj[ai],pend=p.parts.length-1;pend>0&&"string"!=typeof p.parts[pend];)pend--;var pleaf=p.parts[pend],pleafPlus=p.parts[pend-1]+"."+pleaf,ptrunk=p.parts.slice(0,pend).join("."),parentIn=Lib.nestedProperty(gd.layout,ptrunk).get(),parentFull=Lib.nestedProperty(fullLayout,ptrunk).get(),vOld=p.get();if(void 0!==vi){redoit[ai]=vi,undoit[ai]="reverse"===pleaf?vi:undefinedToNull(vOld);var valObject=PlotSchema.getLayoutValObject(fullLayout,p.parts);if(valObject&&valObject.impliedEdits&&null!==vi)for(var impliedKey in valObject.impliedEdits)doextra(Lib.relativeAttr(ai,impliedKey),valObject.impliedEdits[impliedKey]);if(-1!==["width","height"].indexOf(ai)&&null===vi)fullLayout[ai]=gd._initialAutoSize[ai];else if(pleafPlus.match(AX_RANGE_RE))recordAlteredAxis(pleafPlus),Lib.nestedProperty(fullLayout,ptrunk+"._inputRange").set(null);else if(pleafPlus.match(AX_AUTORANGE_RE)){recordAlteredAxis(pleafPlus),Lib.nestedProperty(fullLayout,ptrunk+"._inputRange").set(null);var axFull=Lib.nestedProperty(fullLayout,ptrunk).get();axFull._inputDomain&&(axFull._input.domain=axFull._inputDomain.slice())}else pleafPlus.match(AX_DOMAIN_RE)&&Lib.nestedProperty(fullLayout,ptrunk+"._inputDomain").set(null);if("type"===pleaf){var ax=parentIn,toLog="linear"===parentFull.type&&"log"===vi,fromLog="log"===parentFull.type&&"linear"===vi;if(toLog||fromLog){if(ax&&ax.range)if(parentFull.autorange)toLog&&(ax.range=ax.range[1]>ax.range[0]?[1,2]:[2,1]);else{var r0=ax.range[0],r1=ax.range[1];toLog?(r0<=0&&r1<=0&&doextra(ptrunk+".autorange",!0),r0<=0?r0=r1/1e6:r1<=0&&(r1=r0/1e6),doextra(ptrunk+".range[0]",Math.log(r0)/Math.LN10),doextra(ptrunk+".range[1]",Math.log(r1)/Math.LN10)):(doextra(ptrunk+".range[0]",Math.pow(10,r0)),doextra(ptrunk+".range[1]",Math.pow(10,r1)))}else doextra(ptrunk+".autorange",!0);Array.isArray(fullLayout._subplots.polar)&&fullLayout._subplots.polar.length&&fullLayout[p.parts[0]]&&"radialaxis"===p.parts[1]&&delete fullLayout[p.parts[0]]._subplot.viewInitial["radialaxis.range"],Registry.getComponentMethod("annotations","convertCoords")(gd,parentFull,vi,doextra),Registry.getComponentMethod("images","convertCoords")(gd,parentFull,vi,doextra)}else doextra(ptrunk+".autorange",!0),doextra(ptrunk+".range",null);Lib.nestedProperty(fullLayout,ptrunk+"._inputRange").set(null)}else if(pleaf.match(AX_NAME_PATTERN)){var fullProp=Lib.nestedProperty(fullLayout,ai).get(),newType=(vi||{}).type;newType&&"-"!==newType||(newType="linear"),Registry.getComponentMethod("annotations","convertCoords")(gd,fullProp,newType,doextra),Registry.getComponentMethod("images","convertCoords")(gd,fullProp,newType,doextra)}var containerArrayMatch=manageArrays.containerArrayMatch(ai);if(containerArrayMatch){arrayStr=containerArrayMatch.array,i=containerArrayMatch.index;var propStr=containerArrayMatch.property,obji=(Lib.nestedProperty(layout,arrayStr)||[])[i]||{},updateValObject=valObject||{editType:"calc"};""===propStr&&(manageArrays.isAddVal(vi)?undoit[ai]=null:manageArrays.isRemoveVal(vi)?undoit[ai]=obji:Lib.warn("unrecognized full object value",aobj)),editTypes.update(flags,updateValObject),arrayEdits[arrayStr]||(arrayEdits[arrayStr]={});var objEdits=arrayEdits[arrayStr][i];objEdits||(objEdits=arrayEdits[arrayStr][i]={}),objEdits[propStr]=vi,delete aobj[ai]}else"reverse"===pleaf?(parentIn.range?parentIn.range.reverse():(doextra(ptrunk+".autorange",!0),parentIn.range=[1,0]),parentFull.autorange?flags.calc=!0:flags.plot=!0):(fullLayout._has("scatter-like")&&fullLayout._has("regl")&&"dragmode"===ai&&("lasso"===vi||"select"===vi)&&"lasso"!==vOld&&"select"!==vOld?flags.plot=!0:valObject?editTypes.update(flags,valObject):flags.calc=!0,p.set(vi))}}for(arrayStr in arrayEdits){manageArrays.applyContainerArrayChanges(gd,Lib.nestedProperty(layout,arrayStr),arrayEdits[arrayStr],flags)||(flags.plot=!0)}var constraints=fullLayout._axisConstraintGroups||[];for(axId in rangesAltered)for(i=0;i<constraints.length;i++){var group=constraints[i];if(group[axId])for(var groupAxId in flags.calc=!0,group)rangesAltered[groupAxId]||(Axes.getFromId(gd,groupAxId)._constraintShrinkable=!0)}return(updateAutosize(gd)||aobj.height||aobj.width)&&(flags.plot=!0),(flags.plot||flags.calc)&&(flags.layoutReplot=!0),{flags:flags,rangesAltered:rangesAltered,undoit:undoit,redoit:redoit,eventData:Lib.extendDeep({},redoit)}}function updateAutosize(gd){var fullLayout=gd._fullLayout,oldWidth=fullLayout.width,oldHeight=fullLayout.height;return gd.layout.autosize&&Plots.plotAutoSize(gd,gd.layout,fullLayout),fullLayout.width!==oldWidth||fullLayout.height!==oldHeight}function getDiffFlags(oldContainer,newContainer,outerparts,opts){var valObject,key,getValObject=opts.getValObject,flags=opts.flags,immutable=opts.immutable,inArray=opts.inArray,arrayIndex=opts.arrayIndex;function changed(){var editType=valObject.editType;inArray&&-1!==editType.indexOf("arraydraw")?Lib.pushUnique(flags.arrays[inArray],arrayIndex):editTypes.update(flags,valObject)}function valObjectCanBeDataArray(valObject){return"data_array"===valObject.valType||valObject.arrayOk}for(key in oldContainer){if(flags.calc)return;var oldVal=oldContainer[key],newVal=newContainer[key];if("_"!==key.charAt(0)&&"function"!=typeof oldVal&&oldVal!==newVal){if(("tick0"===key||"dtick"===key)&&"geo"!==outerparts[0]){var tickMode=newContainer.tickmode;if("auto"===tickMode||"array"===tickMode||!tickMode)continue}if(("range"!==key||!newContainer.autorange)&&("zmin"!==key&&"zmax"!==key||"contourcarpet"!==newContainer.type)){var parts=outerparts.concat(key);if((valObject=getValObject(parts))&&(!valObject._compareAsJSON||JSON.stringify(oldVal)!==JSON.stringify(newVal))){var i,valType=valObject.valType,canBeDataArray=valObjectCanBeDataArray(valObject),wasArray=Array.isArray(oldVal),nowArray=Array.isArray(newVal);if(wasArray&&nowArray){var inputKey="_input_"+key,oldValIn=oldContainer[inputKey],newValIn=newContainer[inputKey];if(Array.isArray(oldValIn)&&oldValIn===newValIn)continue}if(void 0===newVal)canBeDataArray&&wasArray?flags.calc=!0:changed();else if(valObject._isLinkedToArray){var arrayEditIndices=[],extraIndices=!1;inArray||(flags.arrays[key]=arrayEditIndices);var minLen=Math.min(oldVal.length,newVal.length),maxLen=Math.max(oldVal.length,newVal.length);if(minLen!==maxLen){if("arraydraw"!==valObject.editType){changed();continue}extraIndices=!0}for(i=0;i<minLen;i++)getDiffFlags(oldVal[i],newVal[i],parts.concat(i),Lib.extendFlat({inArray:key,arrayIndex:i},opts));if(extraIndices)for(i=minLen;i<maxLen;i++)arrayEditIndices.push(i)}else!valType&&Lib.isPlainObject(oldVal)?getDiffFlags(oldVal,newVal,parts,opts):canBeDataArray?wasArray&&nowArray?immutable&&(flags.calc=!0):wasArray!==nowArray?flags.calc=!0:changed():wasArray&&nowArray&&oldVal.length===newVal.length&&String(oldVal)===String(newVal)||changed()}}}}for(key in newContainer)if(!(key in oldContainer||"_"===key.charAt(0)||"function"==typeof newContainer[key])){if(valObjectCanBeDataArray(valObject=getValObject(outerparts.concat(key)))&&Array.isArray(newContainer[key]))return void(flags.calc=!0);changed()}}function makePlotFramework(gd){var gd3=d3.select(gd),fullLayout=gd._fullLayout;if(fullLayout._container=gd3.selectAll(".plot-container").data([0]),fullLayout._container.enter().insert("div",":first-child").classed("plot-container",!0).classed("plotly",!0),fullLayout._paperdiv=fullLayout._container.selectAll(".svg-container").data([0]),fullLayout._paperdiv.enter().append("div").classed("svg-container",!0).style("position","relative"),fullLayout._glcontainer=fullLayout._paperdiv.selectAll(".gl-container").data([{}]),fullLayout._glcontainer.enter().append("div").classed("gl-container",!0),fullLayout._paperdiv.selectAll(".main-svg").remove(),fullLayout._paper=fullLayout._paperdiv.insert("svg",":first-child").classed("main-svg",!0),fullLayout._toppaper=fullLayout._paperdiv.append("svg").classed("main-svg",!0),!fullLayout._uid){var otherUids={};d3.selectAll("defs").each(function(){this.id&&(otherUids[this.id.split("-")[1]]=1)}),fullLayout._uid=Lib.randstr(otherUids)}fullLayout._paperdiv.selectAll(".main-svg").attr(xmlnsNamespaces.svgAttrs),fullLayout._defs=fullLayout._paper.append("defs").attr("id","defs-"+fullLayout._uid),fullLayout._clips=fullLayout._defs.append("g").classed("clips",!0),fullLayout._topdefs=fullLayout._toppaper.append("defs").attr("id","topdefs-"+fullLayout._uid),fullLayout._topclips=fullLayout._topdefs.append("g").classed("clips",!0),fullLayout._bgLayer=fullLayout._paper.append("g").classed("bglayer",!0),fullLayout._draggers=fullLayout._paper.append("g").classed("draglayer",!0);var layerBelow=fullLayout._paper.append("g").classed("layer-below",!0);fullLayout._imageLowerLayer=layerBelow.append("g").classed("imagelayer",!0),fullLayout._shapeLowerLayer=layerBelow.append("g").classed("shapelayer",!0),fullLayout._cartesianlayer=fullLayout._paper.append("g").classed("cartesianlayer",!0),fullLayout._polarlayer=fullLayout._paper.append("g").classed("polarlayer",!0),fullLayout._ternarylayer=fullLayout._paper.append("g").classed("ternarylayer",!0),fullLayout._geolayer=fullLayout._paper.append("g").classed("geolayer",!0),fullLayout._pielayer=fullLayout._paper.append("g").classed("pielayer",!0),fullLayout._glimages=fullLayout._paper.append("g").classed("glimages",!0);var layerAbove=fullLayout._toppaper.append("g").classed("layer-above",!0);fullLayout._imageUpperLayer=layerAbove.append("g").classed("imagelayer",!0),fullLayout._shapeUpperLayer=layerAbove.append("g").classed("shapelayer",!0),fullLayout._infolayer=fullLayout._toppaper.append("g").classed("infolayer",!0),fullLayout._menulayer=fullLayout._toppaper.append("g").classed("menulayer",!0),fullLayout._zoomlayer=fullLayout._toppaper.append("g").classed("zoomlayer",!0),fullLayout._hoverlayer=fullLayout._toppaper.append("g").classed("hoverlayer",!0),gd.emit("plotly_framework")}exports.update=function update(gd,traceUpdate,layoutUpdate,_traces){if(gd=Lib.getGraphDiv(gd),helpers.clearPromiseQueue(gd),gd.framework&&gd.framework.isPolar)return Promise.resolve(gd);Lib.isPlainObject(traceUpdate)||(traceUpdate={}),Lib.isPlainObject(layoutUpdate)||(layoutUpdate={}),Object.keys(traceUpdate).length&&(gd.changed=!0),Object.keys(layoutUpdate).length&&(gd.changed=!0);var traces=helpers.coerceTraceIndices(gd,_traces),restyleSpecs=_restyle(gd,Lib.extendFlat({},traceUpdate),traces),restyleFlags=restyleSpecs.flags,relayoutSpecs=_relayout(gd,Lib.extendFlat({},layoutUpdate)),relayoutFlags=relayoutSpecs.flags;(restyleFlags.calc||relayoutFlags.calc)&&(gd.calcdata=void 0),restyleFlags.clearAxisTypes&&helpers.clearAxisTypes(gd,traces,layoutUpdate);var seq=[];if(restyleFlags.fullReplot&&relayoutFlags.layoutReplot){var data=gd.data,layout=gd.layout;gd.data=void 0,gd.layout=void 0,seq.push(function(){return exports.plot(gd,data,layout)})}else restyleFlags.fullReplot?seq.push(exports.plot):relayoutFlags.layoutReplot?seq.push(subroutines.layoutReplot):(seq.push(Plots.previousPromises),Plots.supplyDefaults(gd),restyleFlags.style&&seq.push(subroutines.doTraceStyle),restyleFlags.colorbars&&seq.push(subroutines.doColorBars),relayoutFlags.legend&&seq.push(subroutines.doLegend),relayoutFlags.layoutstyle&&seq.push(subroutines.layoutStyles),relayoutFlags.axrange&&addAxRangeSequence(seq,relayoutSpecs.rangesAltered),relayoutFlags.ticks&&seq.push(subroutines.doTicksRelayout),relayoutFlags.modebar&&seq.push(subroutines.doModeBar),relayoutFlags.camera&&seq.push(subroutines.doCamera),seq.push(emitAfterPlot));seq.push(Plots.rehover),Queue.add(gd,update,[gd,restyleSpecs.undoit,relayoutSpecs.undoit,restyleSpecs.traces],update,[gd,restyleSpecs.redoit,relayoutSpecs.redoit,restyleSpecs.traces]);var plotDone=Lib.syncOrAsync(seq,gd);return plotDone&&plotDone.then||(plotDone=Promise.resolve(gd)),plotDone.then(function(){return gd.emit("plotly_update",{data:restyleSpecs.eventData,layout:relayoutSpecs.eventData}),gd})},exports.react=function(gd,data,layout,config){var frames,plotDone;var oldFullData=(gd=Lib.getGraphDiv(gd))._fullData,oldFullLayout=gd._fullLayout;if(Lib.isPlotDiv(gd)&&oldFullData&&oldFullLayout){if(Lib.isPlainObject(data)){var obj=data;data=obj.data,layout=obj.layout,config=obj.config,frames=obj.frames}var configChanged=!1;if(config){var oldConfig=Lib.extendDeep({},gd._context);gd._context=void 0,setPlotContext(gd,config),configChanged=function diffConfig(oldConfig,newConfig){var key;for(key in oldConfig){var oldVal=oldConfig[key],newVal=newConfig[key];if(oldVal!==newVal)if(Lib.isPlainObject(oldVal)&&Lib.isPlainObject(newVal)){if(diffConfig(oldVal,newVal))return!0}else{if(!Array.isArray(oldVal)||!Array.isArray(newVal))return!0;if(oldVal.length!==newVal.length)return!0;for(var i=0;i<oldVal.length;i++)if(oldVal[i]!==newVal[i]){if(!Lib.isPlainObject(oldVal[i])||!Lib.isPlainObject(newVal[i]))return!0;if(diffConfig(oldVal[i],newVal[i]))return!0}}}}(oldConfig,gd._context)}gd.data=data||[],helpers.cleanData(gd.data),gd.layout=layout||{},helpers.cleanLayout(gd.layout),Plots.supplyDefaults(gd,{skipUpdateCalc:!0});var newFullData=gd._fullData,newFullLayout=gd._fullLayout,immutable=void 0===newFullLayout.datarevision,restyleFlags=function diffData(gd,oldFullData,newFullData,immutable){if(oldFullData.length!==newFullData.length)return{fullReplot:!0,calc:!0};var i,trace,flags=editTypes.traceFlags();flags.arrays={};var diffOpts={getValObject:function getTraceValObject(parts){return PlotSchema.getTraceValObject(trace,parts)},flags:flags,immutable:immutable,gd:gd},seenUIDs={};for(i=0;i<oldFullData.length;i++)trace=newFullData[i]._fullInput,Plots.hasMakesDataTransform(trace)&&(trace=newFullData[i]),seenUIDs[trace.uid]||(seenUIDs[trace.uid]=1,getDiffFlags(oldFullData[i]._fullInput,trace,[],diffOpts));(flags.calc||flags.plot)&&(flags.fullReplot=!0);return flags}(gd,oldFullData,newFullData,immutable),relayoutFlags=function diffLayout(gd,oldFullLayout,newFullLayout,immutable){var flags=editTypes.layoutFlags();flags.arrays={},getDiffFlags(oldFullLayout,newFullLayout,[],{getValObject:function getLayoutValObject(parts){return PlotSchema.getLayoutValObject(newFullLayout,parts)},flags:flags,immutable:immutable,gd:gd}),(flags.plot||flags.calc)&&(flags.layoutReplot=!0);return flags}(gd,oldFullLayout,newFullLayout,immutable);updateAutosize(gd)&&(relayoutFlags.layoutReplot=!0),restyleFlags.calc||relayoutFlags.calc?gd.calcdata=void 0:Plots.supplyDefaultsUpdateCalc(gd.calcdata,newFullData);var seq=[];if(frames&&(gd._transitionData={},Plots.createTransitionData(gd),seq.push(function addFrames(){return exports.addFrames(gd,frames)})),restyleFlags.fullReplot||relayoutFlags.layoutReplot||configChanged)gd._fullLayout._skipDefaults=!0,seq.push(exports.plot);else{for(var componentType in relayoutFlags.arrays){var indices=relayoutFlags.arrays[componentType];if(indices.length){var drawOne=Registry.getComponentMethod(componentType,"drawOne");if(drawOne!==Lib.noop)for(var i=0;i<indices.length;i++)drawOne(gd,indices[i]);else{var draw=Registry.getComponentMethod(componentType,"draw");if(draw===Lib.noop)throw new Error("cannot draw components: "+componentType);draw(gd)}}}seq.push(Plots.previousPromises),restyleFlags.style&&seq.push(subroutines.doTraceStyle),restyleFlags.colorbars&&seq.push(subroutines.doColorBars),relayoutFlags.legend&&seq.push(subroutines.doLegend),relayoutFlags.layoutstyle&&seq.push(subroutines.layoutStyles),relayoutFlags.axrange&&addAxRangeSequence(seq),relayoutFlags.ticks&&seq.push(subroutines.doTicksRelayout),relayoutFlags.modebar&&seq.push(subroutines.doModeBar),relayoutFlags.camera&&seq.push(subroutines.doCamera),seq.push(emitAfterPlot)}seq.push(Plots.rehover),(plotDone=Lib.syncOrAsync(seq,gd))&&plotDone.then||(plotDone=Promise.resolve(gd))}else plotDone=exports.newPlot(gd,data,layout,config);return plotDone.then(function(){return gd.emit("plotly_react",{data:data,layout:layout}),gd})},exports.animate=function(gd,frameOrGroupNameOrFrameList,animationOpts){if(gd=Lib.getGraphDiv(gd),!Lib.isPlotDiv(gd))throw new Error("This element is not a Plotly plot: "+gd+". It's likely that you've failed to create a plot before animating it. For more details, see https://plot.ly/javascript/animations/");var trans=gd._transitionData;trans._frameQueue||(trans._frameQueue=[]);var transitionOpts=(animationOpts=Plots.supplyAnimationDefaults(animationOpts)).transition,frameOpts=animationOpts.frame;function getTransitionOpts(i){return Array.isArray(transitionOpts)?i>=transitionOpts.length?transitionOpts[0]:transitionOpts[i]:transitionOpts}function getFrameOpts(i){return Array.isArray(frameOpts)?i>=frameOpts.length?frameOpts[0]:frameOpts[i]:frameOpts}function callbackOnNthTime(cb,n){var cnt=0;return function(){if(cb&&++cnt===n)return cb()}}return void 0===trans._frameWaitingCnt&&(trans._frameWaitingCnt=0),new Promise(function(resolve,reject){function nextFrame(){trans._currentFrame&&trans._currentFrame.onComplete&&trans._currentFrame.onComplete();var newFrame=trans._currentFrame=trans._frameQueue.shift();if(newFrame){var stringName=newFrame.name?newFrame.name.toString():null;gd._fullLayout._currentFrame=stringName,trans._lastFrameAt=Date.now(),trans._timeToNext=newFrame.frameOpts.duration,Plots.transition(gd,newFrame.frame.data,newFrame.frame.layout,helpers.coerceTraceIndices(gd,newFrame.frame.traces),newFrame.frameOpts,newFrame.transitionOpts).then(function(){newFrame.onComplete&&newFrame.onComplete()}),gd.emit("plotly_animatingframe",{name:stringName,frame:newFrame.frame,animation:{frame:newFrame.frameOpts,transition:newFrame.transitionOpts}})}else!function stopAnimationLoop(){gd.emit("plotly_animated"),window.cancelAnimationFrame(trans._animationRaf),trans._animationRaf=null}()}function beginAnimationLoop(){gd.emit("plotly_animating"),trans._lastFrameAt=-1/0,trans._timeToNext=0,trans._runningTransitions=0,trans._currentFrame=null;var doFrame=function(){trans._animationRaf=window.requestAnimationFrame(doFrame),Date.now()-trans._lastFrameAt>trans._timeToNext&&nextFrame()};doFrame()}var i,frame,configCounter=0;function setTransitionConfig(frame){return Array.isArray(transitionOpts)?configCounter>=transitionOpts.length?frame.transitionOpts=transitionOpts[configCounter]:frame.transitionOpts=transitionOpts[0]:frame.transitionOpts=transitionOpts,configCounter++,frame}var frameList=[],allFrames=void 0===frameOrGroupNameOrFrameList||null===frameOrGroupNameOrFrameList,isFrameArray=Array.isArray(frameOrGroupNameOrFrameList);if(!allFrames&&!isFrameArray&&Lib.isPlainObject(frameOrGroupNameOrFrameList))frameList.push({type:"object",data:setTransitionConfig(Lib.extendFlat({},frameOrGroupNameOrFrameList))});else if(allFrames||-1!==["string","number"].indexOf(typeof frameOrGroupNameOrFrameList))for(i=0;i<trans._frames.length;i++)(frame=trans._frames[i])&&(allFrames||String(frame.group)===String(frameOrGroupNameOrFrameList))&&frameList.push({type:"byname",name:String(frame.name),data:setTransitionConfig({name:frame.name})});else if(isFrameArray)for(i=0;i<frameOrGroupNameOrFrameList.length;i++){var frameOrName=frameOrGroupNameOrFrameList[i];-1!==["number","string"].indexOf(typeof frameOrName)?(frameOrName=String(frameOrName),frameList.push({type:"byname",name:frameOrName,data:setTransitionConfig({name:frameOrName})})):Lib.isPlainObject(frameOrName)&&frameList.push({type:"object",data:setTransitionConfig(Lib.extendFlat({},frameOrName))})}for(i=0;i<frameList.length;i++)if("byname"===(frame=frameList[i]).type&&!trans._frameHash[frame.data.name])return Lib.warn('animate failure: frame not found: "'+frame.data.name+'"'),void reject();-1!==["next","immediate"].indexOf(animationOpts.mode)&&function discardExistingFrames(){if(0!==trans._frameQueue.length){for(;trans._frameQueue.length;){var next=trans._frameQueue.pop();next.onInterrupt&&next.onInterrupt()}gd.emit("plotly_animationinterrupted",[])}}(),"reverse"===animationOpts.direction&&frameList.reverse();var currentFrame=gd._fullLayout._currentFrame;if(currentFrame&&animationOpts.fromcurrent){var idx=-1;for(i=0;i<frameList.length;i++)if("byname"===(frame=frameList[i]).type&&frame.name===currentFrame){idx=i;break}if(idx>0&&idx<frameList.length-1){var filteredFrameList=[];for(i=0;i<frameList.length;i++)frame=frameList[i],("byname"!==frameList[i].type||i>idx)&&filteredFrameList.push(frame);frameList=filteredFrameList}}frameList.length>0?function queueFrames(frameList){if(0!==frameList.length){for(var i=0;i<frameList.length;i++){var computedFrame;computedFrame="byname"===frameList[i].type?Plots.computeFrame(gd,frameList[i].name):frameList[i].data;var frameOpts=getFrameOpts(i),transitionOpts=getTransitionOpts(i);transitionOpts.duration=Math.min(transitionOpts.duration,frameOpts.duration);var nextFrame={frame:computedFrame,name:frameList[i].name,frameOpts:frameOpts,transitionOpts:transitionOpts};i===frameList.length-1&&(nextFrame.onComplete=callbackOnNthTime(resolve,2),nextFrame.onInterrupt=reject),trans._frameQueue.push(nextFrame)}"immediate"===animationOpts.mode&&(trans._lastFrameAt=-1/0),trans._animationRaf||beginAnimationLoop()}}(frameList):(gd.emit("plotly_animated"),resolve())})},exports.addFrames=function(gd,frameList,indices){if(gd=Lib.getGraphDiv(gd),null===frameList||void 0===frameList)return Promise.resolve();if(!Lib.isPlotDiv(gd))throw new Error("This element is not a Plotly plot: "+gd+". It's likely that you've failed to create a plot before adding frames. For more details, see https://plot.ly/javascript/animations/");var i,frame,j,idx,_frames=gd._transitionData._frames,_frameHash=gd._transitionData._frameHash;if(!Array.isArray(frameList))throw new Error("addFrames failure: frameList must be an Array of frame definitions"+frameList);var bigIndex=_frames.length+2*frameList.length,insertions=[],_frameHashLocal={};for(i=frameList.length-1;i>=0;i--)if(Lib.isPlainObject(frameList[i])){var lookupName=frameList[i].name,name=(_frameHash[lookupName]||_frameHashLocal[lookupName]||{}).name,newName=frameList[i].name,collisionPresent=_frameHash[name]||_frameHashLocal[name];name&&newName&&"number"==typeof newName&&collisionPresent&&numericNameWarningCount<5&&(numericNameWarningCount++,Lib.warn('addFrames: overwriting frame "'+(_frameHash[name]||_frameHashLocal[name]).name+'" with a frame whose name of type "number" also equates to "'+name+'". This is valid but may potentially lead to unexpected behavior since all plotly.js frame names are stored internally as strings.'),5===numericNameWarningCount&&Lib.warn("addFrames: This API call has yielded too many of these warnings. For the rest of this call, further warnings about numeric frame names will be suppressed.")),_frameHashLocal[lookupName]={name:lookupName},insertions.push({frame:Plots.supplyFrameDefaults(frameList[i]),index:indices&&void 0!==indices[i]&&null!==indices[i]?indices[i]:bigIndex+i})}insertions.sort(function(a,b){return a.index>b.index?-1:a.index<b.index?1:0});var ops=[],revops=[],frameCount=_frames.length;for(i=insertions.length-1;i>=0;i--){if("number"==typeof(frame=insertions[i].frame).name&&Lib.warn("Warning: addFrames accepts frames with numeric names, but the numbers areimplicitly cast to strings"),!frame.name)for(;_frameHash[frame.name="frame "+gd._transitionData._counter++];);if(_frameHash[frame.name]){for(j=0;j<_frames.length&&(_frames[j]||{}).name!==frame.name;j++);ops.push({type:"replace",index:j,value:frame}),revops.unshift({type:"replace",index:j,value:_frames[j]})}else idx=Math.max(0,Math.min(insertions[i].index,frameCount)),ops.push({type:"insert",index:idx,value:frame}),revops.unshift({type:"delete",index:idx}),frameCount++}var undoFunc=Plots.modifyFrames,redoFunc=Plots.modifyFrames,undoArgs=[gd,revops],redoArgs=[gd,ops];return Queue&&Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),Plots.modifyFrames(gd,ops)},exports.deleteFrames=function(gd,frameList){if(gd=Lib.getGraphDiv(gd),!Lib.isPlotDiv(gd))throw new Error("This element is not a Plotly plot: "+gd);var i,idx,_frames=gd._transitionData._frames,ops=[],revops=[];if(!frameList)for(frameList=[],i=0;i<_frames.length;i++)frameList.push(i);for((frameList=frameList.slice(0)).sort(),i=frameList.length-1;i>=0;i--)idx=frameList[i],ops.push({type:"delete",index:idx}),revops.unshift({type:"insert",index:idx,value:_frames[idx]});var undoFunc=Plots.modifyFrames,redoFunc=Plots.modifyFrames,undoArgs=[gd,revops],redoArgs=[gd,ops];return Queue&&Queue.add(gd,undoFunc,undoArgs,redoFunc,redoArgs),Plots.modifyFrames(gd,ops)},exports.purge=function purge(gd){var fullLayout=(gd=Lib.getGraphDiv(gd))._fullLayout||{},fullData=gd._fullData||[],calcdata=gd.calcdata||[];return Plots.cleanPlot([],{},fullData,fullLayout,calcdata),Plots.purge(gd),Events.purge(gd),fullLayout._container&&fullLayout._container.remove(),delete gd._context,gd}},{"../components/color":567,"../components/colorbar/connect":569,"../components/drawing":592,"../constants/xmlns_namespaces":671,"../lib":693,"../lib/events":681,"../lib/queue":709,"../lib/svg_text_utils":718,"../plots/cartesian/axes":742,"../plots/cartesian/constants":747,"../plots/cartesian/graph_interact":751,"../plots/plots":805,"../plots/polar/legacy":813,"../registry":825,"./edit_types":725,"./helpers":726,"./manage_arrays":728,"./plot_config":730,"./plot_schema":731,"./subroutines":733,d3:147,"fast-isnumeric":213,"has-hover":391}],730:[function(_dereq_,module,exports){"use strict";module.exports={staticPlot:!1,plotlyServerURL:"https://plot.ly",editable:!1,edits:{annotationPosition:!1,annotationTail:!1,annotationText:!1,axisTitleText:!1,colorbarPosition:!1,colorbarTitleText:!1,legendPosition:!1,legendText:!1,shapePosition:!1,titleText:!1},autosizable:!1,responsive:!1,queueLength:0,fillFrame:!1,frameMargins:0,scrollZoom:!1,doubleClick:"reset+autosize",showTips:!0,showAxisDragHandles:!0,showAxisRangeEntryBoxes:!0,showLink:!1,sendData:!0,linkText:"Edit chart",showSources:!1,displayModeBar:"hover",modeBarButtonsToRemove:[],modeBarButtonsToAdd:[],modeBarButtons:!1,toImageButtonOptions:{},displaylogo:!0,plotGlPixelRatio:2,setBackground:"transparent",topojsonURL:"https://cdn.plot.ly/",mapboxAccessToken:null,logging:1,globalTransforms:[],locale:"en-US",locales:{}}},{}],731:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../registry"),Lib=_dereq_("../lib"),baseAttributes=_dereq_("../plots/attributes"),baseLayoutAttributes=_dereq_("../plots/layout_attributes"),frameAttributes=_dereq_("../plots/frame_attributes"),animationAttributes=_dereq_("../plots/animation_attributes"),polarAreaAttrs=_dereq_("../plots/polar/legacy/area_attributes"),polarAxisAttrs=_dereq_("../plots/polar/legacy/axis_attributes"),editTypes=_dereq_("./edit_types"),extendFlat=Lib.extendFlat,extendDeepAll=Lib.extendDeepAll,isPlainObject=Lib.isPlainObject,IS_SUBPLOT_OBJ="_isSubplotObj",IS_LINKED_TO_ARRAY="_isLinkedToArray",UNDERSCORE_ATTRS=[IS_SUBPLOT_OBJ,IS_LINKED_TO_ARRAY,"_arrayAttrRegexps","_deprecated"];function recurseIntoValObject(valObject,parts,i){if(!valObject)return!1;if(valObject._isLinkedToArray)if(isIndex(parts[i]))i++;else if(i<parts.length)return!1;for(;i<parts.length;i++){var newValObject=valObject[parts[i]];if(!isPlainObject(newValObject))break;if(valObject=newValObject,i===parts.length-1)break;if(valObject._isLinkedToArray){if(!isIndex(parts[++i]))return!1}else if("info_array"===valObject.valType){var index=parts[++i];if(!isIndex(index))return!1;var items=valObject.items;if(Array.isArray(items)){if(index>=items.length)return!1;if(2===valObject.dimensions){if(i++,parts.length===i)return valObject;var index2=parts[i];if(!isIndex(index2))return!1;valObject=items[index][index2]}else valObject=items[index]}else valObject=items}}return valObject}function isIndex(val){return val===Math.round(val)&&val>=0}function formatAttributes(attrs){return function mergeValTypeAndRole(attrs){exports.crawl(attrs,function callback(attr,attrName,attrs){exports.isValObject(attr)?"data_array"===attr.valType?(attr.role="data",attrs[attrName+"src"]={valType:"string",editType:"none"}):!0===attr.arrayOk&&(attrs[attrName+"src"]={valType:"string",editType:"none"}):isPlainObject(attr)&&(attr.role="object")})}(attrs),function formatArrayContainers(attrs){exports.crawl(attrs,function callback(attr,attrName,attrs){if(!attr)return;var itemName=attr[IS_LINKED_TO_ARRAY];if(!itemName)return;delete attr[IS_LINKED_TO_ARRAY],attrs[attrName]={items:{}},attrs[attrName].items[itemName]=attr,attrs[attrName].role="object"})}(attrs),function stringify(attrs){!function walk(attr){for(var k in attr)if(isPlainObject(attr[k]))walk(attr[k]);else if(Array.isArray(attr[k]))for(var i=0;i<attr[k].length;i++)walk(attr[k][i]);else attr[k]instanceof RegExp&&(attr[k]=attr[k].toString())}(attrs)}(attrs),attrs}function handleBasePlotModule(layoutAttributes,_module,astr){var np=Lib.nestedProperty(layoutAttributes,astr),attrs=extendDeepAll({},_module.layoutAttributes);attrs[IS_SUBPLOT_OBJ]=!0,np.set(attrs)}function insertAttrs(baseAttrs,newAttrs,astr){var np=Lib.nestedProperty(baseAttrs,astr);np.set(extendDeepAll(np.get()||{},newAttrs))}exports.IS_SUBPLOT_OBJ=IS_SUBPLOT_OBJ,exports.IS_LINKED_TO_ARRAY=IS_LINKED_TO_ARRAY,exports.DEPRECATED="_deprecated",exports.UNDERSCORE_ATTRS=UNDERSCORE_ATTRS,exports.get=function(){var traces={};Registry.allTypes.concat("area").forEach(function(type){traces[type]=function getTraceAttributes(type){var _module,basePlotModule;"area"===type?(_module={attributes:polarAreaAttrs},basePlotModule={}):(_module=Registry.modules[type]._module,basePlotModule=_module.basePlotModule);var attributes={type:null};extendDeepAll(attributes,baseAttributes),extendDeepAll(attributes,_module.attributes),basePlotModule.attributes&&extendDeepAll(attributes,basePlotModule.attributes);attributes.type=type;var out={meta:_module.meta||{},attributes:formatAttributes(attributes)};if(_module.layoutAttributes){var layoutAttributes={};extendDeepAll(layoutAttributes,_module.layoutAttributes),out.layoutAttributes=formatAttributes(layoutAttributes)}return out}(type)});var transforms={};return Object.keys(Registry.transformsRegistry).forEach(function(type){transforms[type]=function getTransformAttributes(type){var _module=Registry.transformsRegistry[type],attributes=extendDeepAll({},_module.attributes);return Object.keys(Registry.componentsRegistry).forEach(function(k){var _module=Registry.componentsRegistry[k];_module.schema&&_module.schema.transforms&&_module.schema.transforms[type]&&Object.keys(_module.schema.transforms[type]).forEach(function(v){insertAttrs(attributes,_module.schema.transforms[type][v],v)})}),{attributes:formatAttributes(attributes)}}(type)}),{defs:{valObjects:Lib.valObjectMeta,metaKeys:UNDERSCORE_ATTRS.concat(["description","role","editType","impliedEdits"]),editType:{traces:editTypes.traces,layout:editTypes.layout},impliedEdits:{}},traces:traces,layout:function getLayoutAttributes(){var key,_module,layoutAttributes={};for(key in extendDeepAll(layoutAttributes,baseLayoutAttributes),Registry.subplotsRegistry)if((_module=Registry.subplotsRegistry[key]).layoutAttributes)if(Array.isArray(_module.attr))for(var i=0;i<_module.attr.length;i++)handleBasePlotModule(layoutAttributes,_module,_module.attr[i]);else{var astr="subplot"===_module.attr?_module.name:_module.attr;handleBasePlotModule(layoutAttributes,_module,astr)}for(key in layoutAttributes=function assignPolarLayoutAttrs(layoutAttributes){return extendFlat(layoutAttributes,{radialaxis:polarAxisAttrs.radialaxis,angularaxis:polarAxisAttrs.angularaxis}),extendFlat(layoutAttributes,polarAxisAttrs.layout),layoutAttributes}(layoutAttributes),Registry.componentsRegistry){var schema=(_module=Registry.componentsRegistry[key]).schema;if(schema&&(schema.subplots||schema.layout)){var subplots=schema.subplots;if(subplots&&subplots.xaxis&&!subplots.yaxis)for(var xkey in subplots.xaxis)delete layoutAttributes.yaxis[xkey]}else _module.layoutAttributes&&insertAttrs(layoutAttributes,_module.layoutAttributes,_module.name)}return{layoutAttributes:formatAttributes(layoutAttributes)}}(),transforms:transforms,frames:function getFramesAttributes(){var attrs={frames:Lib.extendDeepAll({},frameAttributes)};return formatAttributes(attrs),attrs.frames}(),animation:formatAttributes(animationAttributes)}},exports.crawl=function(attrs,callback,specifiedLevel,attrString){var level=specifiedLevel||0;attrString=attrString||"",Object.keys(attrs).forEach(function(attrName){var attr=attrs[attrName];if(-1===UNDERSCORE_ATTRS.indexOf(attrName)){var fullAttrString=(attrString?attrString+".":"")+attrName;callback(attr,attrName,attrs,level,fullAttrString),exports.isValObject(attr)||isPlainObject(attr)&&"impliedEdits"!==attrName&&exports.crawl(attr,callback,level+1,fullAttrString)}})},exports.isValObject=function(obj){return obj&&void 0!==obj.valType},exports.findArrayAttributes=function(trace){var baseContainer,baseAttrName,arrayAttributes=[],stack=[],isArrayStack=[];function callback(attr,attrName,attrs,level){stack=stack.slice(0,level).concat([attrName]),isArrayStack=isArrayStack.slice(0,level).concat([attr&&attr._isLinkedToArray]),attr&&("data_array"===attr.valType||!0===attr.arrayOk)&&!("colorbar"===stack[level-1]&&("ticktext"===attrName||"tickvals"===attrName))&&function crawlIntoTrace(container,i,astrPartial){var item=container[stack[i]];var newAstrPartial=astrPartial+stack[i];if(i===stack.length-1)Lib.isArrayOrTypedArray(item)&&arrayAttributes.push(baseAttrName+newAstrPartial);else if(isArrayStack[i]){if(Array.isArray(item))for(var j=0;j<item.length;j++)Lib.isPlainObject(item[j])&&crawlIntoTrace(item[j],i+1,newAstrPartial+"["+j+"].")}else Lib.isPlainObject(item)&&crawlIntoTrace(item,i+1,newAstrPartial+".")}(baseContainer,0,"")}baseContainer=trace,baseAttrName="",exports.crawl(baseAttributes,callback),trace._module&&trace._module.attributes&&exports.crawl(trace._module.attributes,callback);var transforms=trace.transforms;if(transforms)for(var i=0;i<transforms.length;i++){var transform=transforms[i],module=transform._module;module&&(baseAttrName="transforms["+i+"].",baseContainer=transform,exports.crawl(module.attributes,callback))}return arrayAttributes},exports.getTraceValObject=function(trace,parts){var moduleAttrs,valObject,head=parts[0],i=1;if("transforms"===head){if(1===parts.length)return baseAttributes.transforms;var transforms=trace.transforms;if(!Array.isArray(transforms)||!transforms.length)return!1;var tNum=parts[1];if(!isIndex(tNum)||tNum>=transforms.length)return!1;valObject=(moduleAttrs=(Registry.transformsRegistry[transforms[tNum].type]||{}).attributes)&&moduleAttrs[parts[2]],i=3}else if("area"===trace.type)valObject=polarAreaAttrs[head];else{var _module=trace._module;if(_module||(_module=(Registry.modules[trace.type||baseAttributes.type.dflt]||{})._module),!_module)return!1;if(!(valObject=(moduleAttrs=_module.attributes)&&moduleAttrs[head])){var subplotModule=_module.basePlotModule;subplotModule&&subplotModule.attributes&&(valObject=subplotModule.attributes[head])}valObject||(valObject=baseAttributes[head])}return recurseIntoValObject(valObject,parts,i)},exports.getLayoutValObject=function(fullLayout,parts){return recurseIntoValObject(function layoutHeadAttr(fullLayout,head){var i,key,_module,attributes,basePlotModules=fullLayout._basePlotModules;if(basePlotModules){var out;for(i=0;i<basePlotModules.length;i++){if((_module=basePlotModules[i]).attrRegex&&_module.attrRegex.test(head)){if(_module.layoutAttrOverrides)return _module.layoutAttrOverrides;!out&&_module.layoutAttributes&&(out=_module.layoutAttributes)}var baseOverrides=_module.baseLayoutAttrOverrides;if(baseOverrides&&head in baseOverrides)return baseOverrides[head]}if(out)return out}var modules=fullLayout._modules;if(modules)for(i=0;i<modules.length;i++)if((attributes=modules[i].layoutAttributes)&&head in attributes)return attributes[head];for(key in Registry.componentsRegistry)if(!(_module=Registry.componentsRegistry[key]).schema&&head===_module.name)return _module.layoutAttributes;if(head in baseLayoutAttributes)return baseLayoutAttributes[head];if("radialaxis"===head||"angularaxis"===head)return polarAxisAttrs[head];return polarAxisAttrs.layout[head]||!1}(fullLayout,parts[0]),parts,1)}},{"../lib":693,"../plots/animation_attributes":737,"../plots/attributes":739,"../plots/frame_attributes":769,"../plots/layout_attributes":796,"../plots/polar/legacy/area_attributes":811,"../plots/polar/legacy/axis_attributes":812,"../registry":825,"./edit_types":725}],732:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),plotAttributes=_dereq_("../plots/attributes"),TEMPLATEITEMNAME="templateitemname",templateAttrs={name:{valType:"string",editType:"none"}};function validItemName(name){return name&&"string"==typeof name}function arrayDefaultKey(name){var lastChar=name.length-1;return"s"!==name.charAt(lastChar)&&Lib.warn("bad argument to arrayDefaultKey: "+name),name.substr(0,name.length-1)+"defaults"}templateAttrs[TEMPLATEITEMNAME]={valType:"string",editType:"calc"},exports.templatedArray=function(name,attrs){return attrs._isLinkedToArray=name,attrs.name=templateAttrs.name,attrs[TEMPLATEITEMNAME]=templateAttrs[TEMPLATEITEMNAME],attrs},exports.traceTemplater=function(dataTemplate){var traceType,typeTemplates,traceCounts={};for(traceType in dataTemplate)typeTemplates=dataTemplate[traceType],Array.isArray(typeTemplates)&&typeTemplates.length&&(traceCounts[traceType]=0);return{newTrace:function newTrace(traceIn){var traceOut={type:traceType=Lib.coerce(traceIn,{},plotAttributes,"type"),_template:null};if(traceType in traceCounts){typeTemplates=dataTemplate[traceType];var typei=traceCounts[traceType]%typeTemplates.length;traceCounts[traceType]++,traceOut._template=typeTemplates[typei]}return traceOut}}},exports.newContainer=function(container,name,baseName){var template=container._template,part=template&&(template[name]||baseName&&template[baseName]);return Lib.isPlainObject(part)||(part=null),container[name]={_template:part}},exports.arrayTemplater=function(container,name,inclusionAttr){var template=container._template,defaultsTemplate=template&&template[arrayDefaultKey(name)],templateItems=template&&template[name];Array.isArray(templateItems)&&templateItems.length||(templateItems=[]);var usedNames={};return{newItem:function newItem(itemIn){var out={name:itemIn.name,_input:itemIn},templateItemName=out[TEMPLATEITEMNAME]=itemIn[TEMPLATEITEMNAME];if(!validItemName(templateItemName))return out._template=defaultsTemplate,out;for(var i=0;i<templateItems.length;i++){var templateItem=templateItems[i];if(templateItem.name===templateItemName)return usedNames[templateItemName]=1,out._template=templateItem,out}return out[inclusionAttr]=itemIn[inclusionAttr]||!1,out._template=!1,out},defaultItems:function defaultItems(){for(var out=[],i=0;i<templateItems.length;i++){var templateItem=templateItems[i],name=templateItem.name;if(validItemName(name)&&!usedNames[name]){var outi={_template:templateItem,name:name,_input:{_templateitemname:name}};outi[TEMPLATEITEMNAME]=templateItem[TEMPLATEITEMNAME],out.push(outi),usedNames[name]=1}}return out}}},exports.arrayDefaultKey=arrayDefaultKey,exports.arrayEditor=function(parentIn,containerStr,itemOut){var lengthIn=(Lib.nestedProperty(parentIn,containerStr).get()||[]).length,index=itemOut._index,templateItemName=index>=lengthIn&&(itemOut._input||{})._templateitemname;templateItemName&&(index=lengthIn);var update,itemStr=containerStr+"["+index+"]";function resetUpdate(){update={},templateItemName&&(update[itemStr]={},update[itemStr][TEMPLATEITEMNAME]=templateItemName)}function modifyItem(attr,value){templateItemName?Lib.nestedProperty(update[itemStr],attr).set(value):update[itemStr+"."+attr]=value}function getUpdateObj(){var updateOut=update;return resetUpdate(),updateOut}return resetUpdate(),{modifyBase:function modifyBase(attr,value){update[attr]=value},modifyItem:modifyItem,getUpdateObj:getUpdateObj,applyUpdate:function applyUpdate(attr,value){attr&&modifyItem(attr,value);var updateToApply=getUpdateObj();for(var key in updateToApply)Lib.nestedProperty(parentIn,key).set(updateToApply[key])}}}},{"../lib":693,"../plots/attributes":739}],733:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../registry"),Plots=_dereq_("../plots/plots"),Lib=_dereq_("../lib"),clearGlCanvases=_dereq_("../lib/clear_gl_canvases"),Color=_dereq_("../components/color"),Drawing=_dereq_("../components/drawing"),Titles=_dereq_("../components/titles"),ModeBar=_dereq_("../components/modebar"),Axes=_dereq_("../plots/cartesian/axes"),alignmentConstants=_dereq_("../constants/alignment"),axisConstraints=_dereq_("../plots/cartesian/constraints"),enforceAxisConstraints=axisConstraints.enforce,cleanAxisConstraints=axisConstraints.clean,doAutoRange=_dereq_("../plots/cartesian/autorange").doAutoRange;function lsInner(gd){var i,fullLayout=gd._fullLayout,gs=fullLayout._size,pad=gs.p,axList=Axes.list(gd,"",!0),hasSVGCartesian=fullLayout._has("cartesian");function getLinePosition(ax,counterAx,side){var lwHalf=ax._lw/2;return"x"===ax._id.charAt(0)?counterAx?"top"===side?counterAx._offset-pad-lwHalf:counterAx._offset+counterAx._length+pad+lwHalf:gs.t+gs.h*(1-(ax.position||0))+lwHalf%1:counterAx?"right"===side?counterAx._offset+counterAx._length+pad+lwHalf:counterAx._offset-pad-lwHalf:gs.l+gs.w*(ax.position||0)+lwHalf%1}for(i=0;i<axList.length;i++){var ax=axList[i];ax.setScale();var counterAx=ax._anchorAxis;ax._linepositions={},ax._lw=Drawing.crispRound(gd,ax.linewidth,1),ax._mainLinePosition=getLinePosition(ax,counterAx,ax.side),ax._mainMirrorPosition=ax.mirror&&counterAx?getLinePosition(ax,counterAx,alignmentConstants.OPPOSITE_SIDE[ax.side]):null,ax._mainSubplot=findMainSubplot(ax,fullLayout)}fullLayout._paperdiv.style({width:fullLayout.width+"px",height:fullLayout.height+"px"}).selectAll(".main-svg").call(Drawing.setSize,fullLayout.width,fullLayout.height),gd._context.setBackground(gd,fullLayout.paper_bgcolor);var subplotSelection=fullLayout._paper.selectAll("g.subplot"),lowerBackgroundIDs=[],lowerDomains=[];subplotSelection.each(function(d){var subplot=d[0],plotinfo=fullLayout._plots[subplot];if(plotinfo.mainplot)return plotinfo.bg&&plotinfo.bg.remove(),void(plotinfo.bg=void 0);var xDomain=plotinfo.xaxis.domain,yDomain=plotinfo.yaxis.domain,plotgroup=plotinfo.plotgroup;if(function overlappingDomain(xDomain,yDomain,domains){for(var i=0;i<domains.length;i++){var existingX=domains[i][0],existingY=domains[i][1];if(!(existingX[0]>=xDomain[1]||existingX[1]<=xDomain[0])&&existingY[0]<yDomain[1]&&existingY[1]>yDomain[0])return!0}return!1}(xDomain,yDomain,lowerDomains)){var pgNode=plotgroup.node(),plotgroupBg=plotinfo.bg=Lib.ensureSingle(plotgroup,"rect","bg");pgNode.insertBefore(plotgroupBg.node(),pgNode.childNodes[0])}else plotgroup.select("rect.bg").remove(),lowerBackgroundIDs.push(subplot),lowerDomains.push([xDomain,yDomain])});var lowerBackgrounds=fullLayout._bgLayer.selectAll(".bg").data(lowerBackgroundIDs);return lowerBackgrounds.enter().append("rect").classed("bg",!0),lowerBackgrounds.exit().remove(),lowerBackgrounds.each(function(subplot){fullLayout._plots[subplot].bg=d3.select(this)}),subplotSelection.each(function(d){var subplot=d[0],plotinfo=fullLayout._plots[subplot],xa=plotinfo.xaxis,ya=plotinfo.yaxis;plotinfo.bg&&hasSVGCartesian&&plotinfo.bg.call(Drawing.setRect,xa._offset-pad,ya._offset-pad,xa._length+2*pad,ya._length+2*pad).call(Color.fill,fullLayout.plot_bgcolor).style("stroke-width",0);var plotClipId,layerClipId,clipId=plotinfo.clipId="clip"+fullLayout._uid+subplot+"plot",plotClip=Lib.ensureSingleById(fullLayout._clips,"clipPath",clipId,function(s){s.classed("plotclip",!0).append("rect")});if(plotinfo.clipRect=plotClip.select("rect").attr({width:xa._length,height:ya._length}),Drawing.setTranslate(plotinfo.plot,xa._offset,ya._offset),plotinfo._hasClipOnAxisFalse?(plotClipId=null,layerClipId=clipId):(plotClipId=clipId,layerClipId=null),Drawing.setClipUrl(plotinfo.plot,plotClipId),plotinfo.layerClipId=layerClipId,hasSVGCartesian){var xLinesXLeft,xLinesXRight,xLinesYBottom,xLinesYTop,leftYLineWidth,rightYLineWidth,yLinesYBottom,yLinesYTop,yLinesXLeft,yLinesXRight,connectYBottom,connectYTop,extraSubplot,xPath="M0,0";shouldShowLinesOrTicks(xa,subplot)&&(leftYLineWidth=findCounterAxisLineWidth(xa,"left",ya,axList),xLinesXLeft=xa._offset-(leftYLineWidth?pad+leftYLineWidth:0),rightYLineWidth=findCounterAxisLineWidth(xa,"right",ya,axList),xLinesXRight=xa._offset+xa._length+(rightYLineWidth?pad+rightYLineWidth:0),xLinesYBottom=getLinePosition(xa,ya,"bottom"),xLinesYTop=getLinePosition(xa,ya,"top"),!(extraSubplot=!xa._anchorAxis||subplot!==xa._mainSubplot)||"allticks"!==xa.mirror&&"all"!==xa.mirror||(xa._linepositions[subplot]=[xLinesYBottom,xLinesYTop]),xPath=mainPath(xa,xLinePath,function xLinePathFree(y){return"M"+xa._offset+","+y+"h"+xa._length}),extraSubplot&&xa.showline&&("all"===xa.mirror||"allticks"===xa.mirror)&&(xPath+=xLinePath(xLinesYBottom)+xLinePath(xLinesYTop)),plotinfo.xlines.style("stroke-width",xa._lw+"px").call(Color.stroke,xa.showline?xa.linecolor:"rgba(0,0,0,0)")),plotinfo.xlines.attr("d",xPath);var yPath="M0,0";shouldShowLinesOrTicks(ya,subplot)&&(connectYBottom=findCounterAxisLineWidth(ya,"bottom",xa,axList),yLinesYBottom=ya._offset+ya._length+(connectYBottom?pad:0),connectYTop=findCounterAxisLineWidth(ya,"top",xa,axList),yLinesYTop=ya._offset-(connectYTop?pad:0),yLinesXLeft=getLinePosition(ya,xa,"left"),yLinesXRight=getLinePosition(ya,xa,"right"),!(extraSubplot=!ya._anchorAxis||subplot!==ya._mainSubplot)||"allticks"!==ya.mirror&&"all"!==ya.mirror||(ya._linepositions[subplot]=[yLinesXLeft,yLinesXRight]),yPath=mainPath(ya,yLinePath,function yLinePathFree(x){return"M"+x+","+ya._offset+"v"+ya._length}),extraSubplot&&ya.showline&&("all"===ya.mirror||"allticks"===ya.mirror)&&(yPath+=yLinePath(yLinesXLeft)+yLinePath(yLinesXRight)),plotinfo.ylines.style("stroke-width",ya._lw+"px").call(Color.stroke,ya.showline?ya.linecolor:"rgba(0,0,0,0)")),plotinfo.ylines.attr("d",yPath)}function xLinePath(y){return"M"+xLinesXLeft+","+y+"H"+xLinesXRight}function yLinePath(x){return"M"+x+","+yLinesYTop+"V"+yLinesYBottom}function mainPath(ax,pathFn,pathFnFree){if(!ax.showline||subplot!==ax._mainSubplot)return"";if(!ax._anchorAxis)return pathFnFree(ax._mainLinePosition);var out=pathFn(ax._mainLinePosition);return ax.mirror&&(out+=pathFn(ax._mainMirrorPosition)),out}}),Axes.makeClipPaths(gd),exports.drawMainTitle(gd),ModeBar.manage(gd),gd._promises.length&&Promise.all(gd._promises)}function findMainSubplot(ax,fullLayout){var subplotList=fullLayout._subplots,ids=subplotList.cartesian.concat(subplotList.gl2d||[]),mockGd={_fullLayout:fullLayout},isX="x"===ax._id.charAt(0),anchorAx=ax._mainAxis._anchorAxis,mainSubplotID="",nextBestMainSubplotID="",anchorID="";if(anchorAx&&(anchorID=anchorAx._mainAxis._id,mainSubplotID=isX?ax._id+anchorID:anchorID+ax._id),!mainSubplotID||!fullLayout._plots[mainSubplotID]){mainSubplotID="";for(var j=0;j<ids.length;j++){var id=ids[j],yIndex=id.indexOf("y"),idPart=isX?id.substr(0,yIndex):id.substr(yIndex),counterPart=isX?id.substr(yIndex):id.substr(0,yIndex);if(idPart===ax._id){nextBestMainSubplotID||(nextBestMainSubplotID=id);var counterAx=Axes.getFromId(mockGd,counterPart);if(anchorID&&counterAx.overlaying===anchorID){mainSubplotID=id;break}}}}return mainSubplotID||nextBestMainSubplotID}function shouldShowLinesOrTicks(ax,subplot){return(ax.ticks||ax.showline)&&(subplot===ax._mainSubplot||"all"===ax.mirror||"allticks"===ax.mirror)}function shouldShowLineThisSide(ax,side,counterAx){if(!counterAx.showline||!counterAx._lw)return!1;if("all"===counterAx.mirror||"allticks"===counterAx.mirror)return!0;var anchorAx=counterAx._anchorAxis;if(!anchorAx)return!1;var sideIndex=alignmentConstants.FROM_BL[side];return counterAx.side===side?anchorAx.domain[sideIndex]===ax.domain[sideIndex]:counterAx.mirror&&anchorAx.domain[1-sideIndex]===ax.domain[1-sideIndex]}function findCounterAxisLineWidth(ax,side,counterAx,axList){if(shouldShowLineThisSide(ax,side,counterAx))return counterAx._lw;for(var i=0;i<axList.length;i++){var axi=axList[i];if(axi._mainAxis===counterAx._mainAxis&&shouldShowLineThisSide(ax,side,axi))return axi._lw}return 0}exports.layoutStyles=function(gd){return Lib.syncOrAsync([Plots.doAutoMargin,lsInner],gd)},exports.drawMainTitle=function(gd){var fullLayout=gd._fullLayout;Titles.draw(gd,"gtitle",{propContainer:fullLayout,propName:"title",placeholder:fullLayout._dfltTitle.plot,attributes:{x:fullLayout.width/2,y:fullLayout._size.t/2,"text-anchor":"middle"}})},exports.doTraceStyle=function(gd){for(var i=0;i<gd.calcdata.length;i++){var cdi=gd.calcdata[i],arraysToCalcdata=(((cdi[0]||{}).trace||{})._module||{}).arraysToCalcdata;arraysToCalcdata&&arraysToCalcdata(cdi,cdi[0].trace)}return Plots.style(gd),Registry.getComponentMethod("legend","draw")(gd),Plots.previousPromises(gd)},exports.doColorBars=function(gd){for(var i=0;i<gd.calcdata.length;i++){var cdi0=gd.calcdata[i][0];if((cdi0.t||{}).cb){var trace=cdi0.trace,cb=cdi0.t.cb;Registry.traceIs(trace,"contour")&&cb.line({width:!1!==trace.contours.showlines?trace.line.width:0,dash:trace.line.dash,color:"line"===trace.contours.coloring?cb._opts.line.color:trace.line.color});var containerName=trace._module.colorbar.container,opts=(containerName?trace[containerName]:trace).colorbar;cb.options(opts)()}}return Plots.previousPromises(gd)},exports.layoutReplot=function(gd){var layout=gd.layout;return gd.layout=void 0,Registry.call("plot",gd,"",layout)},exports.doLegend=function(gd){return Registry.getComponentMethod("legend","draw")(gd),Plots.previousPromises(gd)},exports.doTicksRelayout=function(gd,rangesAltered){return rangesAltered?Axes.doTicks(gd,Object.keys(rangesAltered),!0):Axes.doTicks(gd,"redraw"),gd._fullLayout._hasOnlyLargeSploms&&(clearGlCanvases(gd),Registry.subplotsRegistry.splom.plot(gd)),exports.drawMainTitle(gd),Plots.previousPromises(gd)},exports.doModeBar=function(gd){var fullLayout=gd._fullLayout;ModeBar.manage(gd);for(var i=0;i<fullLayout._basePlotModules.length;i++){var updateFx=fullLayout._basePlotModules[i].updateFx;updateFx&&updateFx(gd)}return Plots.previousPromises(gd)},exports.doCamera=function(gd){for(var fullLayout=gd._fullLayout,sceneIds=fullLayout._subplots.gl3d,i=0;i<sceneIds.length;i++){var sceneLayout=fullLayout[sceneIds[i]];sceneLayout._scene.setCamera(sceneLayout.camera)}},exports.drawData=function(gd){var i,fullLayout=gd._fullLayout,calcdata=gd.calcdata;for(i=0;i<calcdata.length;i++){var trace=calcdata[i][0].trace;!0===trace.visible&&trace._module.colorbar||fullLayout._infolayer.select(".cb"+trace.uid).remove()}clearGlCanvases(gd);var basePlotModules=fullLayout._basePlotModules;for(i=0;i<basePlotModules.length;i++)basePlotModules[i].plot(gd);return Plots.style(gd),Registry.getComponentMethod("shapes","draw")(gd),Registry.getComponentMethod("annotations","draw")(gd),fullLayout._replotting=!1,Plots.previousPromises(gd)},exports.doAutoRangeAndConstraints=function(gd){for(var axList=Axes.list(gd,"",!0),i=0;i<axList.length;i++){var ax=axList[i];cleanAxisConstraints(gd,ax),doAutoRange(gd,ax)}enforceAxisConstraints(gd)},exports.finalDraw=function(gd){Registry.getComponentMethod("shapes","draw")(gd),Registry.getComponentMethod("images","draw")(gd),Registry.getComponentMethod("annotations","draw")(gd),Registry.getComponentMethod("rangeslider","draw")(gd),Registry.getComponentMethod("rangeselector","draw")(gd)},exports.drawMarginPushers=function(gd){Registry.getComponentMethod("legend","draw")(gd),Registry.getComponentMethod("rangeselector","draw")(gd),Registry.getComponentMethod("sliders","draw")(gd),Registry.getComponentMethod("updatemenus","draw")(gd)}},{"../components/color":567,"../components/drawing":592,"../components/modebar":630,"../components/titles":658,"../constants/alignment":665,"../lib":693,"../lib/clear_gl_canvases":676,"../plots/cartesian/autorange":741,"../plots/cartesian/axes":742,"../plots/cartesian/constraints":749,"../plots/plots":805,"../registry":825,d3:147}],734:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),isPlainObject=Lib.isPlainObject,PlotSchema=_dereq_("./plot_schema"),Plots=_dereq_("../plots/plots"),plotAttributes=_dereq_("../plots/attributes"),Template=_dereq_("./plot_template"),dfltConfig=_dereq_("./plot_config");function mergeTemplates(oldTemplate,newTemplate){oldTemplate=Lib.extendDeep({},oldTemplate);var i,j,oldKeys=Object.keys(oldTemplate).sort();function mergeOne(oldVal,newVal,key){if(isPlainObject(newVal)&&isPlainObject(oldVal))mergeTemplates(oldVal,newVal);else if(Array.isArray(newVal)&&Array.isArray(oldVal)){var templater=Template.arrayTemplater({_template:oldTemplate},key);for(j=0;j<newVal.length;j++){var item=newVal[j],oldItem=templater.newItem(item)._template;oldItem&&mergeTemplates(oldItem,item)}var defaultItems=templater.defaultItems();for(j=0;j<defaultItems.length;j++)newVal.push(defaultItems[j]._template);for(j=0;j<newVal.length;j++)delete newVal[j].templateitemname}}for(i=0;i<oldKeys.length;i++){var key=oldKeys[i],oldVal=oldTemplate[key];if(key in newTemplate?mergeOne(oldVal,newTemplate[key],key):newTemplate[key]=oldVal,getBaseKey(key)===key)for(var key2 in newTemplate){var baseKey2=getBaseKey(key2);key2===baseKey2||baseKey2!==key||key2 in oldTemplate||mergeOne(oldVal,newTemplate[key2],key)}}}function getBaseKey(key){return key.replace(/[0-9]+$/,"")}function walkStyleKeys(parent,templateOut,getAttributeInfo,path,basePath){var pathAttr=basePath&&getAttributeInfo(basePath);for(var key in parent){var child=parent[key],nextPath=getNextPath(parent,key,path),nextBasePath=getNextPath(parent,key,basePath),attr=getAttributeInfo(nextBasePath);if(!attr){var baseKey=getBaseKey(key);baseKey!==key&&(attr=getAttributeInfo(nextBasePath=getNextPath(parent,baseKey,basePath)))}if((!pathAttr||pathAttr!==attr)&&!(!attr||attr._noTemplating||"data_array"===attr.valType||attr.arrayOk&&Array.isArray(child)))if(!attr.valType&&isPlainObject(child))walkStyleKeys(child,templateOut,getAttributeInfo,nextPath,nextBasePath);else if(attr._isLinkedToArray&&Array.isArray(child))for(var dfltDone=!1,namedIndex=0,usedNames={},i=0;i<child.length;i++){var item=child[i];if(isPlainObject(item)){var name=item.name;if(name)usedNames[name]||(walkStyleKeys(item,templateOut,getAttributeInfo,getNextPath(child,namedIndex,nextPath),getNextPath(child,namedIndex,nextBasePath)),namedIndex++,usedNames[name]=1);else if(!dfltDone){var dfltPath=getNextPath(parent,Template.arrayDefaultKey(key),path),pathInArray=getNextPath(child,namedIndex,nextPath);walkStyleKeys(item,templateOut,getAttributeInfo,pathInArray,getNextPath(child,namedIndex,nextBasePath));var itemPropInArray=Lib.nestedProperty(templateOut,pathInArray);Lib.nestedProperty(templateOut,dfltPath).set(itemPropInArray.get()),itemPropInArray.set(null),dfltDone=!0}}}else{Lib.nestedProperty(templateOut,nextPath).set(child)}}}function getNextPath(parent,key,path){return path?Array.isArray(parent)?path+"["+key+"]":path+"."+key:key}function hasPlainObject(arr){for(var i=0;i<arr.length;i++)if(isPlainObject(arr[i]))return!0}function format(opts){var msg;switch(opts.code){case"data":msg="The template has no key data.";break;case"layout":msg="The template has no key layout.";break;case"missing":msg=opts.path?"There are no templates for item "+opts.path+" with name "+opts.templateitemname:"There are no templates for trace "+opts.index+", of type "+opts.traceType+".";break;case"unused":msg=opts.path?"The template item at "+opts.path+" was not used in constructing the plot.":opts.dataCount?"Some of the templates of type "+opts.traceType+" were not used. The template has "+opts.templateCount+" traces, the data only has "+opts.dataCount+" of this type.":"The template has "+opts.templateCount+" traces of type "+opts.traceType+" but there are none in the data.";break;case"reused":msg="Some of the templates of type "+opts.traceType+" were used more than once. The template has "+opts.templateCount+" traces, the data has "+opts.dataCount+" of this type."}return opts.msg=msg,opts}exports.makeTemplate=function(figure){figure=Lib.extendDeep({_context:dfltConfig},figure),Plots.supplyDefaults(figure);var data=figure.data||[],layout=figure.layout||{};layout._basePlotModules=figure._fullLayout._basePlotModules,layout._modules=figure._fullLayout._modules;var template={data:{},layout:{}};data.forEach(function(trace){var traceTemplate={};walkStyleKeys(trace,traceTemplate,function getTraceInfo(trace,path){return PlotSchema.getTraceValObject(trace,Lib.nestedProperty({},path).parts)}.bind(null,trace));var traceType=Lib.coerce(trace,{},plotAttributes,"type"),typeTemplates=template.data[traceType];typeTemplates||(typeTemplates=template.data[traceType]=[]),typeTemplates.push(traceTemplate)}),walkStyleKeys(layout,template.layout,function getLayoutInfo(layout,path){return PlotSchema.getLayoutValObject(layout,Lib.nestedProperty({},path).parts)}.bind(null,layout)),delete template.layout.template;var oldTemplate=layout.template;if(isPlainObject(oldTemplate)){var i,traceType,oldTypeTemplates,oldTypeLen,typeTemplates,typeLen,oldLayoutTemplate=oldTemplate.layout;isPlainObject(oldLayoutTemplate)&&mergeTemplates(oldLayoutTemplate,template.layout);var oldDataTemplate=oldTemplate.data;if(isPlainObject(oldDataTemplate)){for(traceType in template.data)if(oldTypeTemplates=oldDataTemplate[traceType],Array.isArray(oldTypeTemplates)){for(typeLen=(typeTemplates=template.data[traceType]).length,oldTypeLen=oldTypeTemplates.length,i=0;i<typeLen;i++)mergeTemplates(oldTypeTemplates[i%oldTypeLen],typeTemplates[i]);for(i=typeLen;i<oldTypeLen;i++)typeTemplates.push(Lib.extendDeep({},oldTypeTemplates[i]))}for(traceType in oldDataTemplate)traceType in template.data||(template.data[traceType]=Lib.extendDeep([],oldDataTemplate[traceType]))}}return template},exports.validateTemplate=function(figureIn,template){var figure=Lib.extendDeep({},{_context:dfltConfig,data:figureIn.data,layout:figureIn.layout}),layout=figure.layout||{};isPlainObject(template)||(template=layout.template||{});var layoutTemplate=template.layout,dataTemplate=template.data,errorList=[];figure.layout=layout,figure.layout.template=template,Plots.supplyDefaults(figure);var fullLayout=figure._fullLayout,fullData=figure._fullData,layoutPaths={};if(isPlainObject(layoutTemplate)?(!function crawlLayoutForContainers(obj,paths){for(var key in obj)if("_"!==key.charAt(0)&&isPlainObject(obj[key])){var i,baseKey=getBaseKey(key),nextPaths=[];for(i=0;i<paths.length;i++)nextPaths.push(getNextPath(obj,key,paths[i])),baseKey!==key&&nextPaths.push(getNextPath(obj,baseKey,paths[i]));for(i=0;i<nextPaths.length;i++)layoutPaths[nextPaths[i]]=1;crawlLayoutForContainers(obj[key],nextPaths)}}(fullLayout,["layout"]),function crawlLayoutTemplateForContainers(obj,path){for(var key in obj)if(-1===key.indexOf("defaults")&&isPlainObject(obj[key])){var nextPath=getNextPath(obj,key,path);layoutPaths[nextPath]?crawlLayoutTemplateForContainers(obj[key],nextPath):errorList.push({code:"unused",path:nextPath})}}(layoutTemplate,"layout")):errorList.push({code:"layout"}),isPlainObject(dataTemplate)){for(var traceType,typeCount={},i=0;i<fullData.length;i++){var fullTrace=fullData[i];typeCount[traceType=fullTrace.type]=(typeCount[traceType]||0)+1,fullTrace._fullInput._template||errorList.push({code:"missing",index:fullTrace._fullInput.index,traceType:traceType})}for(traceType in dataTemplate){var templateCount=dataTemplate[traceType].length,dataCount=typeCount[traceType]||0;templateCount>dataCount?errorList.push({code:"unused",traceType:traceType,templateCount:templateCount,dataCount:dataCount}):dataCount>templateCount&&errorList.push({code:"reused",traceType:traceType,templateCount:templateCount,dataCount:dataCount})}}else errorList.push({code:"data"});if(function crawlForMissingTemplates(obj,path){for(var key in obj)if("_"!==key.charAt(0)){var val=obj[key],nextPath=getNextPath(obj,key,path);isPlainObject(val)?(Array.isArray(obj)&&!1===val._template&&val.templateitemname&&errorList.push({code:"missing",path:nextPath,templateitemname:val.templateitemname}),crawlForMissingTemplates(val,nextPath)):Array.isArray(val)&&hasPlainObject(val)&&crawlForMissingTemplates(val,nextPath)}}({data:fullData,layout:fullLayout},""),errorList.length)return errorList.map(format)}},{"../lib":693,"../plots/attributes":739,"../plots/plots":805,"./plot_config":730,"./plot_schema":731,"./plot_template":732}],735:[function(_dereq_,module,exports){"use strict";var plotApi=_dereq_("./plot_api"),Lib=_dereq_("../lib"),helpers=_dereq_("../snapshot/helpers"),toSVG=_dereq_("../snapshot/tosvg"),svgToImg=_dereq_("../snapshot/svgtoimg"),attrs={format:{valType:"enumerated",values:["png","jpeg","webp","svg"],dflt:"png"},width:{valType:"number",min:1},height:{valType:"number",min:1},scale:{valType:"number",min:0,dflt:1},setBackground:{valType:"any",dflt:!1},imageDataOnly:{valType:"boolean",dflt:!1}},IMAGE_URL_PREFIX=/^data:image\/\w+;base64,/;module.exports=function toImage(gd,opts){var data,layout,config;function isImpliedOrValid(attr){return!(attr in opts)||Lib.validate(opts[attr],attrs[attr])}if(opts=opts||{},Lib.isPlainObject(gd)?(data=gd.data||[],layout=gd.layout||{},config=gd.config||{}):(gd=Lib.getGraphDiv(gd),data=Lib.extendDeep([],gd.data),layout=Lib.extendDeep({},gd.layout),config=gd._context),!isImpliedOrValid("width")||!isImpliedOrValid("height"))throw new Error("Height and width should be pixel values.");if(!isImpliedOrValid("format"))throw new Error("Image format is not jpeg, png, svg or webp.");var fullOpts={};function coerce(attr,dflt){return Lib.coerce(opts,fullOpts,attrs,attr,dflt)}var format=coerce("format"),width=coerce("width"),height=coerce("height"),scale=coerce("scale"),setBackground=coerce("setBackground"),imageDataOnly=coerce("imageDataOnly"),clonedGd=document.createElement("div");clonedGd.style.position="absolute",clonedGd.style.left="-5000px",document.body.appendChild(clonedGd);var layoutImage=Lib.extendFlat({},layout);width&&(layoutImage.width=width),height&&(layoutImage.height=height);var configImage=Lib.extendFlat({},config,{staticPlot:!0,setBackground:setBackground}),redrawFunc=helpers.getRedrawFunc(clonedGd);function wait(){return new Promise(function(resolve){setTimeout(resolve,helpers.getDelay(clonedGd._fullLayout))})}function convert(){return new Promise(function(resolve,reject){var svg=toSVG(clonedGd,format,scale),width=clonedGd._fullLayout.width,height=clonedGd._fullLayout.height;if(plotApi.purge(clonedGd),document.body.removeChild(clonedGd),"svg"===format)return resolve(imageDataOnly?svg:"data:image/svg+xml,"+encodeURIComponent(svg));var canvas=document.createElement("canvas");canvas.id=Lib.randstr(),svgToImg({format:format,width:width,height:height,scale:scale,canvas:canvas,svg:svg,promise:!0}).then(resolve).catch(reject)})}return new Promise(function(resolve,reject){plotApi.plot(clonedGd,data,layoutImage,configImage).then(redrawFunc).then(wait).then(convert).then(function(url){resolve(function urlToImageData(url){return imageDataOnly?url.replace(IMAGE_URL_PREFIX,""):url}(url))}).catch(function(err){reject(err)})})}},{"../lib":693,"../snapshot/helpers":829,"../snapshot/svgtoimg":831,"../snapshot/tosvg":833,"./plot_api":729}],736:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),Plots=_dereq_("../plots/plots"),PlotSchema=_dereq_("./plot_schema"),dfltConfig=_dereq_("./plot_config"),isPlainObject=Lib.isPlainObject,isArray=Array.isArray,isArrayOrTypedArray=Lib.isArrayOrTypedArray;function crawl(objIn,objOut,schema,list,base,path){path=path||[];for(var keys=Object.keys(objIn),i=0;i<keys.length;i++){var k=keys[i];if("transforms"!==k){var p=path.slice();p.push(k);var valIn=objIn[k],valOut=objOut[k],nestedSchema=getNestedSchema(schema,k),isInfoArray="info_array"===(nestedSchema||{}).valType,isColorscale="colorscale"===(nestedSchema||{}).valType,items=(nestedSchema||{}).items;if(isInSchema(schema,k))if(isPlainObject(valIn)&&isPlainObject(valOut))crawl(valIn,valOut,nestedSchema,list,base,p);else if(isInfoArray&&isArray(valIn)){valIn.length>valOut.length&&list.push(format("unused",base,p.concat(valOut.length)));var m,n,item,valInPart,valOutPart,len=valOut.length,arrayItems=Array.isArray(items);if(arrayItems&&(len=Math.min(len,items.length)),2===nestedSchema.dimensions)for(n=0;n<len;n++)if(isArray(valIn[n])){valIn[n].length>valOut[n].length&&list.push(format("unused",base,p.concat(n,valOut[n].length)));var len2=valOut[n].length;for(m=0;m<(arrayItems?Math.min(len2,items[n].length):len2);m++)item=arrayItems?items[n][m]:items,valInPart=valIn[n][m],valOutPart=valOut[n][m],Lib.validate(valInPart,item)?valOutPart!==valInPart&&valOutPart!==+valInPart&&list.push(format("dynamic",base,p.concat(n,m),valInPart,valOutPart)):list.push(format("value",base,p.concat(n,m),valInPart))}else list.push(format("array",base,p.concat(n),valIn[n]));else for(n=0;n<len;n++)item=arrayItems?items[n]:items,valInPart=valIn[n],valOutPart=valOut[n],Lib.validate(valInPart,item)?valOutPart!==valInPart&&valOutPart!==+valInPart&&list.push(format("dynamic",base,p.concat(n),valInPart,valOutPart)):list.push(format("value",base,p.concat(n),valInPart))}else if(nestedSchema.items&&!isInfoArray&&isArray(valIn)){var j,_p,_nestedSchema=items[Object.keys(items)[0]],indexList=[];for(j=0;j<valOut.length;j++){var _index=valOut[j]._index||j;if((_p=p.slice()).push(_index),isPlainObject(valIn[_index])&&isPlainObject(valOut[j])){indexList.push(_index);var valInj=valIn[_index],valOutj=valOut[j];isPlainObject(valInj)&&!1!==valInj.visible&&!1===valOutj.visible?list.push(format("invisible",base,_p)):crawl(valInj,valOutj,_nestedSchema,list,base,_p)}}for(j=0;j<valIn.length;j++)(_p=p.slice()).push(j),isPlainObject(valIn[j])?-1===indexList.indexOf(j)&&list.push(format("unused",base,_p)):list.push(format("object",base,_p,valIn[j]))}else!isPlainObject(valIn)&&isPlainObject(valOut)?list.push(format("object",base,p,valIn)):isArrayOrTypedArray(valIn)||!isArrayOrTypedArray(valOut)||isInfoArray||isColorscale?k in objOut?Lib.validate(valIn,nestedSchema)?"enumerated"===nestedSchema.valType&&(nestedSchema.coerceNumber&&valIn!==+valOut||valIn!==valOut)&&list.push(format("dynamic",base,p,valIn,valOut)):list.push(format("value",base,p,valIn)):list.push(format("unused",base,p,valIn)):list.push(format("array",base,p,valIn));else list.push(format("schema",base,p))}}return list}module.exports=function validate(data,layout){var dataIn,layoutIn,schema=PlotSchema.get(),errorList=[],gd={_context:Lib.extendFlat({},dfltConfig)};isArray(data)?(gd.data=Lib.extendDeep([],data),dataIn=data):(gd.data=[],dataIn=[],errorList.push(format("array","data"))),isPlainObject(layout)?(gd.layout=Lib.extendDeep({},layout),layoutIn=layout):(gd.layout={},layoutIn={},arguments.length>1&&errorList.push(format("object","layout"))),Plots.supplyDefaults(gd);for(var dataOut=gd._fullData,len=dataIn.length,i=0;i<len;i++){var traceIn=dataIn[i],base=["data",i];if(isPlainObject(traceIn)){var traceOut=dataOut[i],traceType=traceOut.type,traceSchema=schema.traces[traceType].attributes;traceSchema.type={valType:"enumerated",values:[traceType]},!1===traceOut.visible&&!1!==traceIn.visible&&errorList.push(format("invisible",base)),crawl(traceIn,traceOut,traceSchema,errorList,base);var transformsIn=traceIn.transforms,transformsOut=traceOut.transforms;if(transformsIn){isArray(transformsIn)||errorList.push(format("array",base,["transforms"])),base.push("transforms");for(var j=0;j<transformsIn.length;j++){var path=["transforms",j],transformType=transformsIn[j].type;if(isPlainObject(transformsIn[j])){var transformSchema=schema.transforms[transformType]?schema.transforms[transformType].attributes:{};transformSchema.type={valType:"enumerated",values:Object.keys(schema.transforms)},crawl(transformsIn[j],transformsOut[j],transformSchema,errorList,base,path)}else errorList.push(format("object",base,path))}}}else errorList.push(format("object",base))}return crawl(layoutIn,gd._fullLayout,function fillLayoutSchema(schema,dataOut){for(var layoutSchema=schema.layout.layoutAttributes,i=0;i<dataOut.length;i++){var traceOut=dataOut[i],traceSchema=schema.traces[traceOut.type],traceLayoutAttr=traceSchema.layoutAttributes;traceLayoutAttr&&(traceOut.subplot?Lib.extendFlat(layoutSchema[traceSchema.attributes.subplot.dflt],traceLayoutAttr):Lib.extendFlat(layoutSchema,traceLayoutAttr))}return layoutSchema}(schema,dataOut),errorList,"layout"),0===errorList.length?void 0:errorList};var code2msgFunc={object:function(base,astr){return("layout"===base&&""===astr?"The layout argument":"data"===base[0]&&""===astr?"Trace "+base[1]+" in the data argument":inBase(base)+"key "+astr)+" must be linked to an object container"},array:function(base,astr){return("data"===base?"The data argument":inBase(base)+"key "+astr)+" must be linked to an array container"},schema:function(base,astr){return inBase(base)+"key "+astr+" is not part of the schema"},unused:function(base,astr,valIn){var target=isPlainObject(valIn)?"container":"key";return inBase(base)+target+" "+astr+" did not get coerced"},dynamic:function(base,astr,valIn,valOut){return[inBase(base)+"key",astr,"(set to '"+valIn+"')","got reset to","'"+valOut+"'","during defaults."].join(" ")},invisible:function(base,astr){return(astr?inBase(base)+"item "+astr:"Trace "+base[1])+" got defaulted to be not visible"},value:function(base,astr,valIn){return[inBase(base)+"key "+astr,"is set to an invalid value ("+valIn+")"].join(" ")}};function inBase(base){return isArray(base)?"In data trace "+base[1]+", ":"In "+base+", "}function format(code,base,path,valIn,valOut){var container,trace;path=path||"",isArray(base)?(container=base[0],trace=base[1]):(container=base,trace=null);var astr=function convertPathToAttributeString(path){if(!isArray(path))return String(path);for(var astr="",i=0;i<path.length;i++){var p=path[i];"number"==typeof p?astr=astr.substr(0,astr.length-1)+"["+p+"]":astr+=p,i<path.length-1&&(astr+=".")}return astr}(path),msg=code2msgFunc[code](base,astr,valIn,valOut);return Lib.log(msg),{code:code,container:container,trace:trace,path:path,astr:astr,msg:msg}}function isInSchema(schema,key){var parts=splitKey(key),keyMinusId=parts.keyMinusId,id=parts.id;return!!(keyMinusId in schema&&schema[keyMinusId]._isSubplotObj&&id)||key in schema}function getNestedSchema(schema,key){return key in schema?schema[key]:schema[splitKey(key).keyMinusId]}var idRegex=Lib.counterRegex("([a-z]+)");function splitKey(key){var idMatch=key.match(idRegex);return{keyMinusId:idMatch&&idMatch[1],id:idMatch&&idMatch[2]}}},{"../lib":693,"../plots/plots":805,"./plot_config":730,"./plot_schema":731}],737:[function(_dereq_,module,exports){"use strict";module.exports={mode:{valType:"enumerated",dflt:"afterall",values:["immediate","next","afterall"]},direction:{valType:"enumerated",values:["forward","reverse"],dflt:"forward"},fromcurrent:{valType:"boolean",dflt:!1},frame:{duration:{valType:"number",min:0,dflt:500},redraw:{valType:"boolean",dflt:!0}},transition:{duration:{valType:"number",min:0,dflt:500},easing:{valType:"enumerated",dflt:"cubic-in-out",values:["linear","quad","cubic","sin","exp","circle","elastic","back","bounce","linear-in","quad-in","cubic-in","sin-in","exp-in","circle-in","elastic-in","back-in","bounce-in","linear-out","quad-out","cubic-out","sin-out","exp-out","circle-out","elastic-out","back-out","bounce-out","linear-in-out","quad-in-out","cubic-in-out","sin-in-out","exp-in-out","circle-in-out","elastic-in-out","back-in-out","bounce-in-out"]}}}},{}],738:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),Template=_dereq_("../plot_api/plot_template");module.exports=function handleArrayContainerDefaults(parentObjIn,parentObjOut,opts){var i,itemOut,name=opts.name,inclusionAttr=opts.inclusionAttr||"visible",previousContOut=parentObjOut[name],contIn=Lib.isArrayOrTypedArray(parentObjIn[name])?parentObjIn[name]:[],contOut=parentObjOut[name]=[],templater=Template.arrayTemplater(parentObjOut,name,inclusionAttr);for(i=0;i<contIn.length;i++){var itemIn=contIn[i];Lib.isPlainObject(itemIn)?itemOut=templater.newItem(itemIn):(itemOut=templater.newItem({}))[inclusionAttr]=!1,itemOut._index=i,!1!==itemOut[inclusionAttr]&&opts.handleItemDefaults(itemIn,itemOut,parentObjOut,opts),contOut.push(itemOut)}var defaultItems=templater.defaultItems();for(i=0;i<defaultItems.length;i++)(itemOut=defaultItems[i])._index=contOut.length,opts.handleItemDefaults({},itemOut,parentObjOut,opts,{}),contOut.push(itemOut);if(Lib.isArrayOrTypedArray(previousContOut)){var len=Math.min(previousContOut.length,contOut.length);for(i=0;i<len;i++)Lib.relinkPrivateKeys(contOut[i],previousContOut[i])}return contOut}},{"../lib":693,"../plot_api/plot_template":732}],739:[function(_dereq_,module,exports){"use strict";var fxAttrs=_dereq_("../components/fx/attributes");module.exports={type:{valType:"enumerated",values:[],dflt:"scatter",editType:"calc+clearAxisTypes",_noTemplating:!0},visible:{valType:"enumerated",values:[!0,!1,"legendonly"],dflt:!0,editType:"calc"},showlegend:{valType:"boolean",dflt:!0,editType:"style"},legendgroup:{valType:"string",dflt:"",editType:"style"},opacity:{valType:"number",min:0,max:1,dflt:1,editType:"style"},name:{valType:"string",editType:"style"},uid:{valType:"string",editType:"plot"},ids:{valType:"data_array",editType:"calc"},customdata:{valType:"data_array",editType:"calc"},selectedpoints:{valType:"any",editType:"calc"},hoverinfo:{valType:"flaglist",flags:["x","y","z","text","name"],extras:["all","none","skip"],arrayOk:!0,dflt:"all",editType:"none"},hoverlabel:fxAttrs.hoverlabel,stream:{token:{valType:"string",noBlank:!0,strict:!0,editType:"calc"},maxpoints:{valType:"number",min:0,max:1e4,dflt:500,editType:"calc"},editType:"calc"},transforms:{_isLinkedToArray:"transform",editType:"calc"}}},{"../components/fx/attributes":601}],740:[function(_dereq_,module,exports){"use strict";module.exports={xaxis:{valType:"subplotid",dflt:"x",editType:"calc+clearAxisTypes"},yaxis:{valType:"subplotid",dflt:"y",editType:"calc+clearAxisTypes"}}},{}],741:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),FP_SAFE=_dereq_("../../constants/numerical").FP_SAFE;function getAutoRange(gd,ax){var i,j,newRange=[],getPad=makePadFn(ax),extremes=concatExtremes(gd,ax),minArray=extremes.min,maxArray=extremes.max;if(0===minArray.length||0===maxArray.length)return Lib.simpleMap(ax.range,ax.r2l);var minmin=minArray[0].val,maxmax=maxArray[0].val;for(i=1;i<minArray.length&&minmin===maxmax;i++)minmin=Math.min(minmin,minArray[i].val);for(i=1;i<maxArray.length&&minmin===maxmax;i++)maxmax=Math.max(maxmax,maxArray[i].val);var axReverse=!1;if(ax.range){var rng=Lib.simpleMap(ax.range,ax.r2l);axReverse=rng[1]<rng[0]}"reversed"===ax.autorange&&(axReverse=!0,ax.autorange=!0);var minpt,maxpt,minbest,maxbest,dp,dv,rangeMode=ax.rangemode,toZero="tozero"===rangeMode,nonNegative="nonnegative"===rangeMode,axLen=ax._length,minSpan=axLen/10,mbest=0;for(i=0;i<minArray.length;i++)for(minpt=minArray[i],j=0;j<maxArray.length;j++)(dv=(maxpt=maxArray[j]).val-minpt.val)>0&&((dp=axLen-getPad(minpt)-getPad(maxpt))>minSpan?dv/dp>mbest&&(minbest=minpt,maxbest=maxpt,mbest=dv/dp):dv/axLen>mbest&&(minbest={val:minpt.val,pad:0},maxbest={val:maxpt.val,pad:0},mbest=dv/axLen));if(minmin===maxmax){var lower=minmin-1,upper=minmin+1;if(toZero)if(0===minmin)newRange=[0,1];else{var maxPad=(minmin>0?maxArray:minArray).reduce(function getMaxPad(prev,pt){return Math.max(prev,getPad(pt))},0),rangeEnd=minmin/(1-Math.min(.5,maxPad/axLen));newRange=minmin>0?[0,rangeEnd]:[rangeEnd,0]}else newRange=nonNegative?[Math.max(0,lower),Math.max(1,upper)]:[lower,upper]}else toZero?(minbest.val>=0&&(minbest={val:0,pad:0}),maxbest.val<=0&&(maxbest={val:0,pad:0})):nonNegative&&(minbest.val-mbest*getPad(minbest)<0&&(minbest={val:0,pad:0}),maxbest.val<=0&&(maxbest={val:1,pad:0})),mbest=(maxbest.val-minbest.val)/(axLen-getPad(minbest)-getPad(maxbest)),newRange=[minbest.val-mbest*getPad(minbest),maxbest.val+mbest*getPad(maxbest)];return axReverse&&newRange.reverse(),Lib.simpleMap(newRange,ax.l2r||Number)}function makePadFn(ax){var extrappad=ax._length/20;return"domain"===ax.constrain&&ax._inputDomain&&(extrappad*=(ax._inputDomain[1]-ax._inputDomain[0])/(ax.domain[1]-ax.domain[0])),function getPad(pt){return pt.pad+(pt.extrapad?extrappad:0)}}function concatExtremes(gd,ax){var i,j,d,axId=ax._id,fullData=gd._fullData,fullLayout=gd._fullLayout,minArray=[],maxArray=[];function _concat(cont,indices){for(i=0;i<indices.length;i++){var item=cont[indices[i]],extremes=(item._extremes||{})[axId];if(!0===item.visible&&extremes){for(j=0;j<extremes.min.length;j++)d=extremes.min[j],collapseMinArray(minArray,d.val,d.pad,{extrapad:d.extrapad});for(j=0;j<extremes.max.length;j++)d=extremes.max[j],collapseMaxArray(maxArray,d.val,d.pad,{extrapad:d.extrapad})}}}return _concat(fullData,ax._traceIndices),_concat(fullLayout.annotations||[],ax._annIndices||[]),_concat(fullLayout.shapes||[],ax._shapeIndices||[]),{min:minArray,max:maxArray}}function collapseMinArray(array,newVal,newPad,opts){collapseArray(array,newVal,newPad,opts,lessOrEqual)}function collapseMaxArray(array,newVal,newPad,opts){collapseArray(array,newVal,newPad,opts,greaterOrEqual)}function collapseArray(array,newVal,newPad,opts,atLeastAsExtreme){for(var tozero=opts.tozero,extrapad=opts.extrapad,includeThis=!0,j=0;j<array.length&&includeThis;j++){var v=array[j];if(atLeastAsExtreme(v.val,newVal)&&v.pad>=newPad&&(v.extrapad||!extrapad)){includeThis=!1;break}atLeastAsExtreme(newVal,v.val)&&v.pad<=newPad&&(extrapad||!v.extrapad)&&(array.splice(j,1),j--)}if(includeThis){var clipAtZero=tozero&&0===newVal;array.push({val:newVal,pad:clipAtZero?0:newPad,extrapad:!clipAtZero&&extrapad})}}function goodNumber(v){return isNumeric(v)&&Math.abs(v)<FP_SAFE}function lessOrEqual(v0,v1){return v0<=v1}function greaterOrEqual(v0,v1){return v0>=v1}module.exports={getAutoRange:getAutoRange,makePadFn:makePadFn,doAutoRange:function doAutoRange(gd,ax){ax._length||ax.setScale();var axIn;ax.autorange&&(ax.range=getAutoRange(gd,ax),ax._r=ax.range.slice(),ax._rl=Lib.simpleMap(ax._r,ax.r2l),(axIn=ax._input).range=ax.range.slice(),axIn.autorange=ax.autorange);if(ax._anchorAxis&&ax._anchorAxis.rangeslider){var axeRangeOpts=ax._anchorAxis.rangeslider[ax._name];axeRangeOpts&&"auto"===axeRangeOpts.rangemode&&(axeRangeOpts.range=getAutoRange(gd,ax)),(axIn=ax._anchorAxis._input).rangeslider[ax._name]=Lib.extendFlat({},axeRangeOpts)}},findExtremes:function findExtremes(ax,data,options){options||(options={});ax._m||ax.setScale();var i,v,di,dmin,dmax,ppadiplus,ppadiminus,vmin,vmax,minArray=[],maxArray=[],len=data.length,extrapad=options.padded||!1,tozero=options.tozero&&("linear"===ax.type||"-"===ax.type),isLog="log"===ax.type,hasArrayOption=!1;function makePadAccessor(item){if(Array.isArray(item))return hasArrayOption=!0,function(i){return Math.max(Number(item[i]||0),0)};var v=Math.max(Number(item||0),0);return function(){return v}}var ppadplus=makePadAccessor((ax._m>0?options.ppadplus:options.ppadminus)||options.ppad||0),ppadminus=makePadAccessor((ax._m>0?options.ppadminus:options.ppadplus)||options.ppad||0),vpadplus=makePadAccessor(options.vpadplus||options.vpad),vpadminus=makePadAccessor(options.vpadminus||options.vpad);if(!hasArrayOption){if(vmin=1/0,vmax=-1/0,isLog)for(i=0;i<len;i++)(v=data[i])<vmin&&v>0&&(vmin=v),v>vmax&&v<FP_SAFE&&(vmax=v);else for(i=0;i<len;i++)(v=data[i])<vmin&&v>-FP_SAFE&&(vmin=v),v>vmax&&v<FP_SAFE&&(vmax=v);data=[vmin,vmax],len=2}var collapseOpts={tozero:tozero,extrapad:extrapad};function addItem(i){di=data[i],isNumeric(di)&&(ppadiplus=ppadplus(i),ppadiminus=ppadminus(i),vmin=di-vpadminus(i),vmax=di+vpadplus(i),isLog&&vmin<vmax/10&&(vmin=vmax/10),dmin=ax.c2l(vmin),dmax=ax.c2l(vmax),tozero&&(dmin=Math.min(0,dmin),dmax=Math.max(0,dmax)),goodNumber(dmin)&&collapseMinArray(minArray,dmin,ppadiminus,collapseOpts),goodNumber(dmax)&&collapseMaxArray(maxArray,dmax,ppadiplus,collapseOpts))}var iMax=Math.min(6,len);for(i=0;i<iMax;i++)addItem(i);for(i=len-1;i>=iMax;i--)addItem(i);return{min:minArray,max:maxArray}},concatExtremes:concatExtremes}},{"../../constants/numerical":670,"../../lib":693,"fast-isnumeric":213}],742:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Plots=_dereq_("../../plots/plots"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),Titles=_dereq_("../../components/titles"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),axAttrs=_dereq_("./layout_attributes"),constants=_dereq_("../../constants/numerical"),ONEAVGYEAR=constants.ONEAVGYEAR,ONEAVGMONTH=constants.ONEAVGMONTH,ONEDAY=constants.ONEDAY,ONEHOUR=constants.ONEHOUR,ONEMIN=constants.ONEMIN,ONESEC=constants.ONESEC,MINUS_SIGN=constants.MINUS_SIGN,BADNUM=constants.BADNUM,MID_SHIFT=_dereq_("../../constants/alignment").MID_SHIFT,LINE_SPACING=_dereq_("../../constants/alignment").LINE_SPACING,axes=module.exports={};axes.setConvert=_dereq_("./set_convert");var autoType=_dereq_("./axis_autotype"),axisIds=_dereq_("./axis_ids");axes.id2name=axisIds.id2name,axes.name2id=axisIds.name2id,axes.cleanId=axisIds.cleanId,axes.list=axisIds.list,axes.listIds=axisIds.listIds,axes.getFromId=axisIds.getFromId,axes.getFromTrace=axisIds.getFromTrace;var autorange=_dereq_("./autorange");axes.getAutoRange=autorange.getAutoRange,axes.findExtremes=autorange.findExtremes,axes.coerceRef=function(containerIn,containerOut,gd,attr,dflt,extraOption){var axLetter=attr.charAt(attr.length-1),axlist=gd._fullLayout._subplots[axLetter+"axis"],refAttr=attr+"ref",attrDef={};return dflt||(dflt=axlist[0]||extraOption),extraOption||(extraOption=dflt),attrDef[refAttr]={valType:"enumerated",values:axlist.concat(extraOption?[extraOption]:[]),dflt:dflt},Lib.coerce(containerIn,containerOut,attrDef,refAttr)},axes.coercePosition=function(containerOut,gd,coerce,axRef,attr,dflt){var cleanPos,pos;if("paper"===axRef||"pixel"===axRef)cleanPos=Lib.ensureNumber,pos=coerce(attr,dflt);else{var ax=axes.getFromId(gd,axRef);pos=coerce(attr,dflt=ax.fraction2r(dflt)),cleanPos=ax.cleanPos}containerOut[attr]=cleanPos(pos)},axes.cleanPosition=function(pos,gd,axRef){return("paper"===axRef||"pixel"===axRef?Lib.ensureNumber:axes.getFromId(gd,axRef).cleanPos)(pos)};var getDataConversions=axes.getDataConversions=function(gd,trace,target,targetArray){var ax,d2cTarget="x"===target||"y"===target||"z"===target?target:targetArray;if(Array.isArray(d2cTarget)){if(ax={type:autoType(targetArray),_categories:[]},axes.setConvert(ax),"category"===ax.type)for(var i=0;i<targetArray.length;i++)ax.d2c(targetArray[i])}else ax=axes.getFromTrace(gd,trace,d2cTarget);return ax?{d2c:ax.d2c,c2d:ax.c2d}:"ids"===d2cTarget?{d2c:toString,c2d:toString}:{d2c:toNum,c2d:toNum}};function toNum(v){return+v}function toString(v){return String(v)}axes.getDataToCoordFunc=function(gd,trace,target,targetArray){return getDataConversions(gd,trace,target,targetArray).d2c},axes.counterLetter=function(id){var axLetter=id.charAt(0);return"x"===axLetter?"y":"y"===axLetter?"x":void 0},axes.minDtick=function(ax,newDiff,newFirst,allow){-1===["log","category"].indexOf(ax.type)&&allow?void 0===ax._minDtick?(ax._minDtick=newDiff,ax._forceTick0=newFirst):ax._minDtick&&((ax._minDtick/newDiff+1e-6)%1<2e-6&&((newFirst-ax._forceTick0)/newDiff%1+1.000001)%1<2e-6?(ax._minDtick=newDiff,ax._forceTick0=newFirst):((newDiff/ax._minDtick+1e-6)%1>2e-6||((newFirst-ax._forceTick0)/ax._minDtick%1+1.000001)%1>2e-6)&&(ax._minDtick=0)):ax._minDtick=0},axes.saveRangeInitial=function(gd,overwrite){for(var axList=axes.list(gd,"",!0),hasOneAxisChanged=!1,i=0;i<axList.length;i++){var ax=axList[i],isNew=void 0===ax._rangeInitial,hasChanged=isNew||!(ax.range[0]===ax._rangeInitial[0]&&ax.range[1]===ax._rangeInitial[1]);(isNew&&!1===ax.autorange||overwrite&&hasChanged)&&(ax._rangeInitial=ax.range.slice(),hasOneAxisChanged=!0)}return hasOneAxisChanged},axes.saveShowSpikeInitial=function(gd,overwrite){for(var axList=axes.list(gd,"",!0),hasOneAxisChanged=!1,allSpikesEnabled="on",i=0;i<axList.length;i++){var ax=axList[i],isNew=void 0===ax._showSpikeInitial,hasChanged=isNew||!(ax.showspikes===ax._showspikes);(isNew||overwrite&&hasChanged)&&(ax._showSpikeInitial=ax.showspikes,hasOneAxisChanged=!0),"on"!==allSpikesEnabled||ax.showspikes||(allSpikesEnabled="off")}return gd._fullLayout._cartesianSpikesEnabled=allSpikesEnabled,hasOneAxisChanged},axes.autoBin=function(data,ax,nbins,is2d,calendar){var size0,dummyAx,dataMin=Lib.aggNums(Math.min,null,data),dataMax=Lib.aggNums(Math.max,null,data);if(calendar||(calendar=ax.calendar),"category"===ax.type)return{start:dataMin-.5,end:dataMax+.5,size:1,_dataSpan:dataMax-dataMin};if(nbins)size0=(dataMax-dataMin)/nbins;else{var distinctData=Lib.distinctVals(data),msexp=Math.pow(10,Math.floor(Math.log(distinctData.minDiff)/Math.LN10)),minSize=msexp*Lib.roundUp(distinctData.minDiff/msexp,[.9,1.9,4.9,9.9],!0);size0=Math.max(minSize,2*Lib.stdev(data)/Math.pow(data.length,is2d?.25:.4)),isNumeric(size0)||(size0=1)}dummyAx="log"===ax.type?{type:"linear",range:[dataMin,dataMax]}:{type:ax.type,range:Lib.simpleMap([dataMin,dataMax],ax.c2r,0,calendar),calendar:calendar},axes.setConvert(dummyAx),axes.autoTicks(dummyAx,size0);var binEnd,binStart=axes.tickIncrement(axes.tickFirst(dummyAx),dummyAx.dtick,"reverse",calendar);if("number"==typeof dummyAx.dtick)binEnd=(binStart=function autoShiftNumericBins(binStart,data,ax,dataMin,dataMax){var edgecount=0,midcount=0,intcount=0,blankCount=0;function nearEdge(v){return(1+100*(v-binStart)/ax.dtick)%100<2}for(var i=0;i<data.length;i++)data[i]%1==0?intcount++:isNumeric(data[i])||blankCount++,nearEdge(data[i])&&edgecount++,nearEdge(data[i]+ax.dtick/2)&&midcount++;var dataCount=data.length-blankCount;if(intcount===dataCount&&"date"!==ax.type)ax.dtick<1?binStart=dataMin-.5*ax.dtick:(binStart-=.5)+ax.dtick<dataMin&&(binStart+=ax.dtick);else if(midcount<.1*dataCount&&(edgecount>.3*dataCount||nearEdge(dataMin)||nearEdge(dataMax))){var binshift=ax.dtick/2;binStart+=binStart+binshift<dataMin?binshift:-binshift}return binStart}(binStart,data,dummyAx,dataMin,dataMax))+(1+Math.floor((dataMax-binStart)/dummyAx.dtick))*dummyAx.dtick;else for("M"===dummyAx.dtick.charAt(0)&&(binStart=function autoShiftMonthBins(binStart,data,dtick,dataMin,calendar){var stats=Lib.findExactDates(data,calendar);if(stats.exactDays>.8){var numMonths=Number(dtick.substr(1));stats.exactYears>.8&&numMonths%12==0?binStart=axes.tickIncrement(binStart,"M6","reverse")+1.5*ONEDAY:stats.exactMonths>.8?binStart=axes.tickIncrement(binStart,"M1","reverse")+15.5*ONEDAY:binStart-=ONEDAY/2;var nextBinStart=axes.tickIncrement(binStart,dtick);if(nextBinStart<=dataMin)return nextBinStart}return binStart}(binStart,data,dummyAx.dtick,dataMin,calendar)),binEnd=binStart,0;binEnd<=dataMax;)binEnd=axes.tickIncrement(binEnd,dummyAx.dtick,!1,calendar),0;return{start:ax.c2r(binStart,0,calendar),end:ax.c2r(binEnd,0,calendar),size:dummyAx.dtick,_dataSpan:dataMax-dataMin}},axes.prepTicks=function(ax){var rng=Lib.simpleMap(ax.range,ax.r2l);if("auto"===ax.tickmode||!ax.dtick){var minPx,nt=ax.nticks;nt||("category"===ax.type?(minPx=ax.tickfont?1.2*(ax.tickfont.size||12):15,nt=ax._length/minPx):(minPx="y"===ax._id.charAt(0)?40:80,nt=Lib.constrain(ax._length/minPx,4,9)+1),"radialaxis"===ax._name&&(nt*=2)),"array"===ax.tickmode&&(nt*=100),axes.autoTicks(ax,Math.abs(rng[1]-rng[0])/nt),ax._minDtick>0&&ax.dtick<2*ax._minDtick&&(ax.dtick=ax._minDtick,ax.tick0=ax.l2r(ax._forceTick0))}ax.tick0||(ax.tick0="date"===ax.type?"2000-01-01":0),"date"===ax.type&&ax.dtick<.1&&(ax.dtick=.1),autoTickRound(ax)},axes.calcTicks=function calcTicks(ax){axes.prepTicks(ax);var rng=Lib.simpleMap(ax.range,ax.r2l);if("array"===ax.tickmode)return function arrayTicks(ax){var vali,i,vals=ax.tickvals,text=ax.ticktext,ticksOut=new Array(vals.length),rng=Lib.simpleMap(ax.range,ax.r2l),r0expanded=1.0001*rng[0]-1e-4*rng[1],r1expanded=1.0001*rng[1]-1e-4*rng[0],tickMin=Math.min(r0expanded,r1expanded),tickMax=Math.max(r0expanded,r1expanded),j=0;Array.isArray(text)||(text=[]);var tickVal2l="category"===ax.type?ax.d2l_noadd:ax.d2l;"log"===ax.type&&"L"!==String(ax.dtick).charAt(0)&&(ax.dtick="L"+Math.pow(10,Math.floor(Math.min(ax.range[0],ax.range[1]))-1));for(i=0;i<vals.length;i++)(vali=tickVal2l(vals[i]))>tickMin&&vali<tickMax&&(void 0===text[i]?ticksOut[j]=axes.tickText(ax,vali):ticksOut[j]=tickTextObj(ax,vali,String(text[i])),j++);j<vals.length&&ticksOut.splice(j,vals.length-j);return ticksOut}(ax);ax._tmin=axes.tickFirst(ax);var startTick=1.0001*rng[0]-1e-4*rng[1],endTick=1.0001*rng[1]-1e-4*rng[0],axrev=rng[1]<rng[0];if(ax._tmin<startTick!==axrev)return[];var vals=[];"category"===ax.type&&(endTick=axrev?Math.max(-.5,endTick):Math.min(ax._categories.length-.5,endTick));for(var xPrevious=null,maxTicks=Math.max(1e3,ax._length||0),x=ax._tmin;(axrev?x>=endTick:x<=endTick)&&!(vals.length>maxTicks||x===xPrevious);x=axes.tickIncrement(x,ax.dtick,axrev,ax.calendar))xPrevious=x,vals.push(x);isAngular(ax)&&360===Math.abs(rng[1]-rng[0])&&vals.pop(),ax._tmax=vals[vals.length-1],ax._prevDateHead="",ax._inCalcTicks=!0;for(var ticksOut=new Array(vals.length),i=0;i<vals.length;i++)ticksOut[i]=axes.tickText(ax,vals[i]);return ax._inCalcTicks=!1,ticksOut};var roundBase10=[2,5,10],roundBase24=[1,2,3,6,12],roundBase60=[1,2,5,10,15,30],roundDays=[1,2,3,7,14],roundLog1=[-.046,0,.301,.477,.602,.699,.778,.845,.903,.954,1],roundLog2=[-.301,0,.301,.699,1],roundAngles=[15,30,45,90,180];function roundDTick(roughDTick,base,roundingSet){return base*Lib.roundUp(roughDTick/base,roundingSet)}function autoTickRound(ax){var dtick=ax.dtick;if(ax._tickexponent=0,isNumeric(dtick)||"string"==typeof dtick||(dtick=1),"category"===ax.type&&(ax._tickround=null),"date"===ax.type){var tick0ms=ax.r2l(ax.tick0),tick0str=ax.l2r(tick0ms).replace(/(^-|i)/g,""),tick0len=tick0str.length;if("M"===String(dtick).charAt(0))tick0len>10||"01-01"!==tick0str.substr(5)?ax._tickround="d":ax._tickround=+dtick.substr(1)%12==0?"y":"m";else if(dtick>=ONEDAY&&tick0len<=10||dtick>=15*ONEDAY)ax._tickround="d";else if(dtick>=ONEMIN&&tick0len<=16||dtick>=ONEHOUR)ax._tickround="M";else if(dtick>=ONESEC&&tick0len<=19||dtick>=ONEMIN)ax._tickround="S";else{var tick1len=ax.l2r(tick0ms+dtick).replace(/^-/,"").length;ax._tickround=Math.max(tick0len,tick1len)-20,ax._tickround<0&&(ax._tickround=4)}}else if(isNumeric(dtick)||"L"===dtick.charAt(0)){var rng=ax.range.map(ax.r2d||Number);isNumeric(dtick)||(dtick=Number(dtick.substr(1))),ax._tickround=2-Math.floor(Math.log(dtick)/Math.LN10+.01);var maxend=Math.max(Math.abs(rng[0]),Math.abs(rng[1])),rangeexp=Math.floor(Math.log(maxend)/Math.LN10+.01);Math.abs(rangeexp)>3&&(isSIFormat(ax.exponentformat)&&!beyondSI(rangeexp)?ax._tickexponent=3*Math.round((rangeexp-1)/3):ax._tickexponent=rangeexp)}else ax._tickround=null}function tickTextObj(ax,x,text){var tf=ax.tickfont||{};return{x:x,dx:0,dy:0,text:text||"",fontSize:tf.size,font:tf.family,fontColor:tf.color}}axes.autoTicks=function(ax,roughDTick){var base;function getBase(v){return Math.pow(v,Math.floor(Math.log(roughDTick)/Math.LN10))}if("date"===ax.type){ax.tick0=Lib.dateTick0(ax.calendar);var roughX2=2*roughDTick;roughX2>ONEAVGYEAR?(roughDTick/=ONEAVGYEAR,base=getBase(10),ax.dtick="M"+12*roundDTick(roughDTick,base,roundBase10)):roughX2>ONEAVGMONTH?(roughDTick/=ONEAVGMONTH,ax.dtick="M"+roundDTick(roughDTick,1,roundBase24)):roughX2>ONEDAY?(ax.dtick=roundDTick(roughDTick,ONEDAY,roundDays),ax.tick0=Lib.dateTick0(ax.calendar,!0)):roughX2>ONEHOUR?ax.dtick=roundDTick(roughDTick,ONEHOUR,roundBase24):roughX2>ONEMIN?ax.dtick=roundDTick(roughDTick,ONEMIN,roundBase60):roughX2>ONESEC?ax.dtick=roundDTick(roughDTick,ONESEC,roundBase60):(base=getBase(10),ax.dtick=roundDTick(roughDTick,base,roundBase10))}else if("log"===ax.type){ax.tick0=0;var rng=Lib.simpleMap(ax.range,ax.r2l);if(roughDTick>.7)ax.dtick=Math.ceil(roughDTick);else if(Math.abs(rng[1]-rng[0])<1){var nt=1.5*Math.abs((rng[1]-rng[0])/roughDTick);roughDTick=Math.abs(Math.pow(10,rng[1])-Math.pow(10,rng[0]))/nt,base=getBase(10),ax.dtick="L"+roundDTick(roughDTick,base,roundBase10)}else ax.dtick=roughDTick>.3?"D2":"D1"}else"category"===ax.type?(ax.tick0=0,ax.dtick=Math.ceil(Math.max(roughDTick,1))):isAngular(ax)?(ax.tick0=0,base=1,ax.dtick=roundDTick(roughDTick,base,roundAngles)):(ax.tick0=0,base=getBase(10),ax.dtick=roundDTick(roughDTick,base,roundBase10));if(0===ax.dtick&&(ax.dtick=1),!isNumeric(ax.dtick)&&"string"!=typeof ax.dtick){var olddtick=ax.dtick;throw ax.dtick=1,"ax.dtick error: "+String(olddtick)}},axes.tickIncrement=function(x,dtick,axrev,calendar){var axSign=axrev?-1:1;if(isNumeric(dtick))return x+axSign*dtick;var tType=dtick.charAt(0),dtSigned=axSign*Number(dtick.substr(1));if("M"===tType)return Lib.incrementMonth(x,dtSigned,calendar);if("L"===tType)return Math.log(Math.pow(10,x)+dtSigned)/Math.LN10;if("D"===tType){var tickset="D2"===dtick?roundLog2:roundLog1,x2=x+.01*axSign,frac=Lib.roundUp(Lib.mod(x2,1),tickset,axrev);return Math.floor(x2)+Math.log(d3.round(Math.pow(10,frac),1))/Math.LN10}throw"unrecognized dtick "+String(dtick)},axes.tickFirst=function(ax){var r2l=ax.r2l||Number,rng=Lib.simpleMap(ax.range,r2l),axrev=rng[1]<rng[0],sRound=axrev?Math.floor:Math.ceil,r0=1.0001*rng[0]-1e-4*rng[1],dtick=ax.dtick,tick0=r2l(ax.tick0);if(isNumeric(dtick)){var tmin=sRound((r0-tick0)/dtick)*dtick+tick0;return"category"===ax.type&&(tmin=Lib.constrain(tmin,0,ax._categories.length-1)),tmin}var tType=dtick.charAt(0),dtNum=Number(dtick.substr(1));if("M"===tType){for(var t1,mult,newDTick,cnt=0,t0=tick0;cnt<10;){if(((t1=axes.tickIncrement(t0,dtick,axrev,ax.calendar))-r0)*(t0-r0)<=0)return axrev?Math.min(t0,t1):Math.max(t0,t1);mult=(r0-(t0+t1)/2)/(t1-t0),newDTick=tType+(Math.abs(Math.round(mult))||1)*dtNum,t0=axes.tickIncrement(t0,newDTick,mult<0?!axrev:axrev,ax.calendar),cnt++}return Lib.error("tickFirst did not converge",ax),t0}if("L"===tType)return Math.log(sRound((Math.pow(10,r0)-tick0)/dtNum)*dtNum+tick0)/Math.LN10;if("D"===tType){var tickset="D2"===dtick?roundLog2:roundLog1,frac=Lib.roundUp(Lib.mod(r0,1),tickset,axrev);return Math.floor(r0)+Math.log(d3.round(Math.pow(10,frac),1))/Math.LN10}throw"unrecognized dtick "+String(dtick)},axes.tickText=function(ax,x,hover){var hideexp,i,out=tickTextObj(ax,x),arrayMode="array"===ax.tickmode,extraPrecision=hover||arrayMode,tickVal2l="category"===ax.type?ax.d2l_noadd:ax.d2l;if(arrayMode&&Array.isArray(ax.ticktext)){var rng=Lib.simpleMap(ax.range,ax.r2l),minDiff=Math.abs(rng[1]-rng[0])/1e4;for(i=0;i<ax.ticktext.length&&!(Math.abs(x-tickVal2l(ax.tickvals[i]))<minDiff);i++);if(i<ax.ticktext.length)return out.text=String(ax.ticktext[i]),out}function isHidden(showAttr){var first_or_last;return void 0===showAttr||(hover?"none"===showAttr:(first_or_last={first:ax._tmin,last:ax._tmax}[showAttr],"all"!==showAttr&&x!==first_or_last))}return hideexp=hover?"never":"none"!==ax.exponentformat&&isHidden(ax.showexponent)?"hide":"","date"===ax.type?function formatDate(ax,out,hover,extraPrecision){var tr=ax._tickround,fmt=hover&&ax.hoverformat||axes.getTickFormat(ax);extraPrecision&&(tr=isNumeric(tr)?4:{y:"m",m:"d",d:"M",M:"S",S:4}[tr]);var headStr,dateStr=Lib.formatDate(out.x,fmt,tr,ax._dateFormat,ax.calendar,ax._extraFormat),splitIndex=dateStr.indexOf("\n");-1!==splitIndex&&(headStr=dateStr.substr(splitIndex+1),dateStr=dateStr.substr(0,splitIndex));extraPrecision&&("00:00:00"===dateStr||"00:00"===dateStr?(dateStr=headStr,headStr=""):8===dateStr.length&&(dateStr=dateStr.replace(/:00$/,"")));headStr&&(hover?"d"===tr?dateStr+=", "+headStr:dateStr=headStr+(dateStr?", "+dateStr:""):ax._inCalcTicks&&headStr===ax._prevDateHead||(dateStr+="<br>"+headStr,ax._prevDateHead=headStr));out.text=dateStr}(ax,out,hover,extraPrecision):"log"===ax.type?function formatLog(ax,out,hover,extraPrecision,hideexp){var dtick=ax.dtick,x=out.x,tickformat=ax.tickformat,dtChar0="string"==typeof dtick&&dtick.charAt(0);"never"===hideexp&&(hideexp="");extraPrecision&&"L"!==dtChar0&&(dtick="L3",dtChar0="L");if(tickformat||"L"===dtChar0)out.text=numFormat(Math.pow(10,x),ax,hideexp,extraPrecision);else if(isNumeric(dtick)||"D"===dtChar0&&Lib.mod(x+.01,1)<.1){var p=Math.round(x),absP=Math.abs(p),exponentFormat=ax.exponentformat;"power"===exponentFormat||isSIFormat(exponentFormat)&&beyondSI(p)?(out.text=0===p?1:1===p?"10":"10<sup>"+(p>1?"":MINUS_SIGN)+absP+"</sup>",out.fontSize*=1.25):("e"===exponentFormat||"E"===exponentFormat)&&absP>2?out.text="1"+exponentFormat+(p>0?"+":MINUS_SIGN)+absP:(out.text=numFormat(Math.pow(10,x),ax,"","fakehover"),"D1"===dtick&&"y"===ax._id.charAt(0)&&(out.dy-=out.fontSize/6))}else{if("D"!==dtChar0)throw"unrecognized dtick "+String(dtick);out.text=String(Math.round(Math.pow(10,Lib.mod(x,1)))),out.fontSize*=.75}if("D1"===ax.dtick){var firstChar=String(out.text).charAt(0);"0"!==firstChar&&"1"!==firstChar||("y"===ax._id.charAt(0)?out.dx-=out.fontSize/4:(out.dy+=out.fontSize/2,out.dx+=(ax.range[1]>ax.range[0]?1:-1)*out.fontSize*(x<0?.5:.25)))}}(ax,out,0,extraPrecision,hideexp):"category"===ax.type?function formatCategory(ax,out){var tt=ax._categories[Math.round(out.x)];void 0===tt&&(tt="");out.text=String(tt)}(ax,out):isAngular(ax)?function formatAngle(ax,out,hover,extraPrecision,hideexp){if("radians"!==ax.thetaunit||hover)out.text=numFormat(out.x,ax,hideexp,extraPrecision);else{var num=out.x/180;if(0===num)out.text="0";else{var frac=function num2frac(num){function almostEq(a,b){return Math.abs(a-b)<=1e-6}var precision=function findPrecision(n){var e=1;for(;!almostEq(Math.round(n*e)/e,n);)e*=10;return e}(num),number=num*precision,gcd=Math.abs(function findGCD(a,b){return almostEq(b,0)?a:findGCD(b,a%b)}(number,precision));return[Math.round(number/gcd),Math.round(precision/gcd)]}(num);if(frac[1]>=100)out.text=numFormat(Lib.deg2rad(out.x),ax,hideexp,extraPrecision);else{var isNeg=out.x<0;1===frac[1]?1===frac[0]?out.text="":out.text=frac[0]+"":out.text=["<sup>",frac[0],"</sup>","","<sub>",frac[1],"</sub>",""].join(""),isNeg&&(out.text=MINUS_SIGN+out.text)}}}}(ax,out,hover,extraPrecision,hideexp):function formatLinear(ax,out,hover,extraPrecision,hideexp){"never"===hideexp?hideexp="":"all"===ax.showexponent&&Math.abs(out.x/ax.dtick)<1e-6&&(hideexp="hide");out.text=numFormat(out.x,ax,hideexp,extraPrecision)}(ax,out,0,extraPrecision,hideexp),ax.tickprefix&&!isHidden(ax.showtickprefix)&&(out.text=ax.tickprefix+out.text),ax.ticksuffix&&!isHidden(ax.showticksuffix)&&(out.text+=ax.ticksuffix),out},axes.hoverLabelText=function(ax,val,val2){if(val2!==BADNUM&&val2!==val)return axes.hoverLabelText(ax,val)+" - "+axes.hoverLabelText(ax,val2);var logOffScale="log"===ax.type&&val<=0,tx=axes.tickText(ax,ax.c2l(logOffScale?-val:val),"hover").text;return logOffScale?0===val?"0":MINUS_SIGN+tx:tx};var SIPREFIXES=["f","p","n","","m","","k","M","G","T"];function isSIFormat(exponentFormat){return"SI"===exponentFormat||"B"===exponentFormat}function beyondSI(exponent){return exponent>14||exponent<-15}function numFormat(v,ax,fmtoverride,hover){var isNeg=v<0,tickRound=ax._tickround,exponentFormat=fmtoverride||ax.exponentformat||"B",exponent=ax._tickexponent,tickformat=axes.getTickFormat(ax),separatethousands=ax.separatethousands;if(hover){var ah={exponentformat:exponentFormat,dtick:"none"===ax.showexponent?ax.dtick:isNumeric(v)&&Math.abs(v)||1,range:"none"===ax.showexponent?ax.range.map(ax.r2d):[0,v||1]};autoTickRound(ah),tickRound=(Number(ah._tickround)||0)+4,exponent=ah._tickexponent,ax.hoverformat&&(tickformat=ax.hoverformat)}if(tickformat)return ax._numFormat(tickformat)(v).replace(/-/g,MINUS_SIGN);var signedExponent,e=Math.pow(10,-tickRound)/2;if("none"===exponentFormat&&(exponent=0),(v=Math.abs(v))<e)v="0",isNeg=!1;else{if(v+=e,exponent&&(v*=Math.pow(10,-exponent),tickRound+=exponent),0===tickRound)v=String(Math.floor(v));else if(tickRound<0){v=(v=String(Math.round(v))).substr(0,v.length+tickRound);for(var i=tickRound;i<0;i++)v+="0"}else{var dp=(v=String(v)).indexOf(".")+1;dp&&(v=v.substr(0,dp+tickRound).replace(/\.?0+$/,""))}v=Lib.numSeparate(v,ax._separators,separatethousands)}exponent&&"hide"!==exponentFormat&&(isSIFormat(exponentFormat)&&beyondSI(exponent)&&(exponentFormat="power"),signedExponent=exponent<0?MINUS_SIGN+-exponent:"power"!==exponentFormat?"+"+exponent:String(exponent),"e"===exponentFormat||"E"===exponentFormat?v+=exponentFormat+signedExponent:"power"===exponentFormat?v+="10<sup>"+signedExponent+"</sup>":"B"===exponentFormat&&9===exponent?v+="B":isSIFormat(exponentFormat)&&(v+=SIPREFIXES[exponent/3+5]));return isNeg?MINUS_SIGN+v:v}function clipEnds(ax,l){var p=ax.l2p(l);return p>1&&p<ax._length-1}function mergeAxisGroups(intoSet,fromSet){for(var i=0;i<fromSet.length;i++)-1===intoSet.indexOf(fromSet[i])&&intoSet.push(fromSet[i])}function swapAxisGroup(gd,xIds,yIds){var i,j,xFullAxes=[],yFullAxes=[],layout=gd.layout;for(i=0;i<xIds.length;i++)xFullAxes.push(axes.getFromId(gd,xIds[i]));for(i=0;i<yIds.length;i++)yFullAxes.push(axes.getFromId(gd,yIds[i]));var allAxKeys=Object.keys(axAttrs),noSwapAttrs=["anchor","domain","overlaying","position","side","tickangle","editType"],numericTypes=["linear","log"];for(i=0;i<allAxKeys.length;i++){var keyi=allAxKeys[i],xVal=xFullAxes[0][keyi],yVal=yFullAxes[0][keyi],allEqual=!0,coerceLinearX=!1,coerceLinearY=!1;if("_"!==keyi.charAt(0)&&"function"!=typeof xVal&&-1===noSwapAttrs.indexOf(keyi)){for(j=1;j<xFullAxes.length&&allEqual;j++){var xVali=xFullAxes[j][keyi];"type"===keyi&&-1!==numericTypes.indexOf(xVal)&&-1!==numericTypes.indexOf(xVali)&&xVal!==xVali?coerceLinearX=!0:xVali!==xVal&&(allEqual=!1)}for(j=1;j<yFullAxes.length&&allEqual;j++){var yVali=yFullAxes[j][keyi];"type"===keyi&&-1!==numericTypes.indexOf(yVal)&&-1!==numericTypes.indexOf(yVali)&&yVal!==yVali?coerceLinearY=!0:yFullAxes[j][keyi]!==yVal&&(allEqual=!1)}allEqual&&(coerceLinearX&&(layout[xFullAxes[0]._name].type="linear"),coerceLinearY&&(layout[yFullAxes[0]._name].type="linear"),swapAxisAttrs(layout,keyi,xFullAxes,yFullAxes,gd._fullLayout._dfltTitle))}}for(i=0;i<gd._fullLayout.annotations.length;i++){var ann=gd._fullLayout.annotations[i];-1!==xIds.indexOf(ann.xref)&&-1!==yIds.indexOf(ann.yref)&&Lib.swapAttrs(layout.annotations[i],["?"])}}function swapAxisAttrs(layout,key,xFullAxes,yFullAxes,dfltTitle){var i,np=Lib.nestedProperty,xVal=np(layout[xFullAxes[0]._name],key).get(),yVal=np(layout[yFullAxes[0]._name],key).get();for("title"===key&&(xVal===dfltTitle.x&&(xVal=dfltTitle.y),yVal===dfltTitle.y&&(yVal=dfltTitle.x)),i=0;i<xFullAxes.length;i++)np(layout,xFullAxes[i]._name+"."+key).set(yVal);for(i=0;i<yFullAxes.length;i++)np(layout,yFullAxes[i]._name+"."+key).set(xVal)}function isAngular(ax){return"angularaxis"===ax._id}axes.getTickFormat=function(ax){var i,tickstop,stopi,dtick,range,convertFn,leftDtick,rightDtick;function convertToMs(dtick){return"string"!=typeof dtick?dtick:Number(dtick.replace("M",""))*ONEAVGMONTH}function compareLogTicks(left,right){var priority=["L","D"];if(typeof left==typeof right){if("number"==typeof left)return left-right;var leftPriority=priority.indexOf(left.charAt(0)),rightPriority=priority.indexOf(right.charAt(0));return leftPriority===rightPriority?Number(left.replace(/(L|D)/g,""))-Number(right.replace(/(L|D)/g,"")):leftPriority-rightPriority}return"number"==typeof left?1:-1}function isProperLogStop(dtick,range){var isLeftDtickNull=null===range[0],isRightDtickNull=null===range[1],isDtickInRangeLeft=compareLogTicks(dtick,range[0])>=0,isDtickInRangeRight=compareLogTicks(dtick,range[1])<=0;return(isLeftDtickNull||isDtickInRangeLeft)&&(isRightDtickNull||isDtickInRangeRight)}if(ax.tickformatstops&&ax.tickformatstops.length>0)switch(ax.type){case"date":case"linear":for(i=0;i<ax.tickformatstops.length;i++)if((stopi=ax.tickformatstops[i]).enabled&&(dtick=ax.dtick,range=stopi.dtickrange,convertFn=void 0,void 0,void 0,convertFn=convertToMs||function(x){return x},leftDtick=range[0],rightDtick=range[1],(!leftDtick&&"number"!=typeof leftDtick||convertFn(leftDtick)<=convertFn(dtick))&&(!rightDtick&&"number"!=typeof rightDtick||convertFn(rightDtick)>=convertFn(dtick)))){tickstop=stopi;break}break;case"log":for(i=0;i<ax.tickformatstops.length;i++)if((stopi=ax.tickformatstops[i]).enabled&&isProperLogStop(ax.dtick,stopi.dtickrange)){tickstop=stopi;break}}return tickstop?tickstop.value:ax.tickformat},axes.getSubplots=function(gd,ax){var subplotObj=gd._fullLayout._subplots,allSubplots=subplotObj.cartesian.concat(subplotObj.gl2d||[]),out=ax?axes.findSubplotsWithAxis(allSubplots,ax):allSubplots;return out.sort(function(a,b){var aParts=a.substr(1).split("y"),bParts=b.substr(1).split("y");return aParts[0]===bParts[0]?+aParts[1]-+bParts[1]:+aParts[0]-+bParts[0]}),out},axes.findSubplotsWithAxis=function(subplots,ax){for(var axMatch=new RegExp("x"===ax._id.charAt(0)?"^"+ax._id+"y":ax._id+"$"),subplotsWithAxis=[],i=0;i<subplots.length;i++){var sp=subplots[i];axMatch.test(sp)&&subplotsWithAxis.push(sp)}return subplotsWithAxis},axes.makeClipPaths=function(gd){var fullLayout=gd._fullLayout;if(!fullLayout._hasOnlyLargeSploms){var i,j,fullWidth={_offset:0,_length:fullLayout.width,_id:""},fullHeight={_offset:0,_length:fullLayout.height,_id:""},xaList=axes.list(gd,"x",!0),yaList=axes.list(gd,"y",!0),clipList=[];for(i=0;i<xaList.length;i++)for(clipList.push({x:xaList[i],y:fullHeight}),j=0;j<yaList.length;j++)0===i&&clipList.push({x:fullWidth,y:yaList[j]}),clipList.push({x:xaList[i],y:yaList[j]});var axClips=fullLayout._clips.selectAll(".axesclip").data(clipList,function(d){return d.x._id+d.y._id});axClips.enter().append("clipPath").classed("axesclip",!0).attr("id",function(d){return"clip"+fullLayout._uid+d.x._id+d.y._id}).append("rect"),axClips.exit().remove(),axClips.each(function(d){d3.select(this).select("rect").attr({x:d.x._offset||0,y:d.y._offset||0,width:d.x._length||1,height:d.y._length||1})})}},axes.doTicks=function(gd,arg,skipTitle){var fullLayout=gd._fullLayout;"redraw"===arg&&fullLayout._paper.selectAll("g.subplot").each(function(d){var id=d[0],plotinfo=fullLayout._plots[id],xa=plotinfo.xaxis,ya=plotinfo.yaxis;plotinfo.xaxislayer.selectAll("."+xa._id+"tick").remove(),plotinfo.yaxislayer.selectAll("."+ya._id+"tick").remove(),plotinfo.gridlayer&&plotinfo.gridlayer.selectAll("path").remove(),plotinfo.zerolinelayer&&plotinfo.zerolinelayer.selectAll("path").remove(),fullLayout._infolayer.select(".g-"+xa._id+"title").remove(),fullLayout._infolayer.select(".g-"+ya._id+"title").remove()});var axList=arg&&"redraw"!==arg?arg:axes.listIds(gd);Lib.syncOrAsync(axList.map(function(axid){return function(){if(axid){var axDone=axes.doTicksSingle(gd,axid,skipTitle),ax=axes.getFromId(gd,axid);return ax._r=ax.range.slice(),ax._rl=Lib.simpleMap(ax._r,ax.r2l),axDone}}}))},axes.doTicksSingle=function(gd,arg,skipTitle){var ax,fullLayout=gd._fullLayout,independent=!1;Lib.isPlainObject(arg)?(ax=arg,independent=!0):ax=axes.getFromId(gd,arg),ax.setScale();var sides,transfn,tickpathfn,subplots,tickLabels,i,axid=ax._id,axLetter=axid.charAt(0),counterLetter=axes.counterLetter(axid),vals=ax._vals=axes.calcTicks(ax),datafn=function(d){return[d.text,d.x,ax.mirror,d.font,d.fontSize,d.fontColor].join("_")},tcls=axid+"tick",gcls=axid+"grid",zcls=axid+"zl",pad=(ax.linewidth||1)/2,labelStandoff="outside"===ax.ticks?ax.ticklen:0,labelShift=0,gridWidth=Drawing.crispRound(gd,ax.gridwidth,1),zeroLineWidth=Drawing.crispRound(gd,ax.zerolinewidth,gridWidth),tickWidth=Drawing.crispRound(gd,ax.tickwidth,1);if(ax._counterangle&&"outside"===ax.ticks){var caRad=ax._counterangle*Math.PI/180;labelStandoff=ax.ticklen*Math.cos(caRad)+1,labelShift=ax.ticklen*Math.sin(caRad)}if(ax.showticklabels&&("outside"===ax.ticks||ax.showline)&&(labelStandoff+=.2*ax.tickfont.size),"x"===axLetter)sides=["bottom","top"],transfn=ax._transfn||function(d){return"translate("+(ax._offset+ax.l2p(d.x))+",0)"},tickpathfn=function(shift,len){if(ax._counterangle){var caRad=ax._counterangle*Math.PI/180;return"M0,"+shift+"l"+Math.sin(caRad)*len+","+Math.cos(caRad)*len}return"M0,"+shift+"v"+len};else if("y"===axLetter)sides=["left","right"],transfn=ax._transfn||function(d){return"translate(0,"+(ax._offset+ax.l2p(d.x))+")"},tickpathfn=function(shift,len){if(ax._counterangle){var caRad=ax._counterangle*Math.PI/180;return"M"+shift+",0l"+Math.cos(caRad)*len+","+-Math.sin(caRad)*len}return"M"+shift+",0h"+len};else{if(!isAngular(ax))return void Lib.warn("Unrecognized doTicks axis:",axid);sides=["left","right"],transfn=ax._transfn,tickpathfn=function(shift,len){return"M"+shift+",0h"+len}}var axside=ax.side||sides[0],ticksign=[-1,1,axside===sides[1]?1:-1];if("inside"!==ax.ticks==("x"===axLetter)&&(ticksign=ticksign.map(function(v){return-v})),ax.visible){ax._tickFilter&&(vals=vals.filter(ax._tickFilter));var valsClipped=ax._valsClipped=isAngular(ax)?vals:vals.filter(function(d){return clipEnds(ax,d.x)});if(independent){if(drawTicks(ax._axislayer,tickpathfn(ax._pos+pad*ticksign[2],ticksign[2]*ax.ticklen)),ax._counteraxis)drawGrid({gridlayer:ax._gridlayer,zerolinelayer:ax._zerolinelayer},ax._counteraxis);return drawLabels(ax._axislayer,ax._pos)}if(fullLayout._has("cartesian")){var finishedGrids={};(subplots=axes.getSubplots(gd,ax)).map(function(subplot){var plotinfo=fullLayout._plots[subplot],counterAxis=plotinfo[counterLetter+"axis"],mainCounterID=counterAxis._mainAxis._id;finishedGrids[mainCounterID]||(finishedGrids[mainCounterID]=1,drawGrid(plotinfo,counterAxis))});var mainSubplot=ax._mainSubplot,mainPlotinfo=fullLayout._plots[mainSubplot],tickSubplots=[];if(ax.ticks){var mainSign=ticksign[2],tickpath=tickpathfn(ax._mainLinePosition+pad*mainSign,mainSign*ax.ticklen);ax._anchorAxis&&ax.mirror&&!0!==ax.mirror&&(tickpath+=tickpathfn(ax._mainMirrorPosition-pad*mainSign,-mainSign*ax.ticklen)),drawTicks(mainPlotinfo[axLetter+"axislayer"],tickpath),tickSubplots=Object.keys(ax._linepositions||{})}return tickSubplots.map(function(subplot){var container=fullLayout._plots[subplot][axLetter+"axislayer"],linepositions=ax._linepositions[subplot]||[];function tickPathSide(sidei){var tsign=ticksign[sidei];return tickpathfn(linepositions[sidei]+pad*tsign,tsign*ax.ticklen)}drawTicks(container,tickPathSide(0)+tickPathSide(1))}),drawLabels(mainPlotinfo[axLetter+"axislayer"],ax._mainLinePosition)}}function drawTicks(container,tickpath){var ticks=container.selectAll("path."+tcls).data("inside"===ax.ticks?valsClipped:vals,datafn);tickpath&&ax.ticks?(ticks.enter().append("path").classed(tcls,1).classed("ticks",1).classed("crisp",1).call(Color.stroke,ax.tickcolor).style("stroke-width",tickWidth+"px").attr("d",tickpath),ticks.attr("transform",transfn),ticks.exit().remove()):ticks.remove()}function drawLabels(container,position){if(tickLabels=container.selectAll("g."+tcls).data(vals,datafn),!isNumeric(position))return tickLabels.remove(),void drawAxTitle();if(!ax.showticklabels)return tickLabels.remove(),drawAxTitle(),void calcBoundingBox();var labelx,labely,labelanchor,labelpos0,flipit;"x"===axLetter?(labelx=function(d){return d.dx+labelShift*flipit},labelpos0=position+(labelStandoff+pad)*(flipit="bottom"===axside?1:-1),labely=function(d){return d.dy+labelpos0+d.fontSize*("bottom"===axside?1:-.2)},labelanchor=function(angle){return isNumeric(angle)&&0!==angle&&180!==angle?angle*flipit<0?"end":"start":"middle"}):"y"===axLetter?(flipit="right"===axside?1:-1,labely=function(d){return d.dy+d.fontSize*MID_SHIFT-labelShift*flipit},labelx=function(d){return d.dx+position+(labelStandoff+pad+(90===Math.abs(ax.tickangle)?d.fontSize/2:0))*flipit},labelanchor=function(angle){return isNumeric(angle)&&90===Math.abs(angle)?"middle":"right"===axside?"start":"end"}):isAngular(ax)&&(ax._labelShift=labelShift,ax._labelStandoff=labelStandoff,ax._pad=pad,labelx=ax._labelx,labely=ax._labely,labelanchor=ax._labelanchor);var maxFontSize=0,autoangle=0,labelsReady=[];function positionLabels(s,angle){s.each(function(d){var anchor=labelanchor(angle,d),thisLabel=d3.select(this),mathjaxGroup=thisLabel.select(".text-math-group"),transform=transfn.call(thisLabel.node(),d)+(isNumeric(angle)&&0!=+angle?" rotate("+angle+","+labelx(d)+","+(labely(d)-d.fontSize/2)+")":""),anchorHeight=function getAnchorHeight(lineCount,lineHeight,angle){var h=(lineCount-1)*lineHeight;if("x"===axLetter){if(angle<-60||60<angle)return-.5*h;if("top"===axside)return-h}else{if((angle*="left"===axside?1:-1)<-30)return-h;if(angle<30)return-.5*h}return 0}(svgTextUtils.lineCount(thisLabel),LINE_SPACING*d.fontSize,isNumeric(angle)?+angle:0);if(anchorHeight&&(transform+=" translate(0, "+anchorHeight+")"),mathjaxGroup.empty())thisLabel.select("text").attr({transform:transform,"text-anchor":anchor});else{var mjShift=Drawing.bBox(mathjaxGroup.node()).width*{end:-.5,start:.5}[anchor];mathjaxGroup.attr("transform",transform+(mjShift?"translate("+mjShift+",0)":""))}})}function calcBoundingBox(){if(ax.showticklabels){var gdBB=gd.getBoundingClientRect(),bBox=container.node().getBoundingClientRect();ax._boundingBox={width:bBox.width,height:bBox.height,left:bBox.left-gdBB.left,right:bBox.right-gdBB.left,top:bBox.top-gdBB.top,bottom:bBox.bottom-gdBB.top}}else{var pos,gs=fullLayout._size;"x"===axLetter?(pos="free"===ax.anchor?gs.t+gs.h*(1-ax.position):gs.t+gs.h*(1-ax._anchorAxis.domain[{bottom:0,top:1}[ax.side]]),ax._boundingBox={top:pos,bottom:pos,left:ax._offset,right:ax._offset+ax._length,width:ax._length,height:0}):(pos="free"===ax.anchor?gs.l+gs.w*ax.position:gs.l+gs.w*ax._anchorAxis.domain[{left:0,right:1}[ax.side]],ax._boundingBox={left:pos,right:pos,bottom:ax._offset+ax._length,top:ax._offset,height:ax._length,width:0})}if(subplots){var fullRange=ax._counterSpan=[1/0,-1/0];for(i=0;i<subplots.length;i++){var counterAxis=fullLayout._plots[subplots[i]]["x"===axLetter?"yaxis":"xaxis"];extendRange(fullRange,[counterAxis._offset,counterAxis._offset+counterAxis._length])}"free"===ax.anchor&&extendRange(fullRange,"x"===axLetter?[ax._boundingBox.bottom,ax._boundingBox.top]:[ax._boundingBox.right,ax._boundingBox.left])}function extendRange(range,newRange){range[0]=Math.min(range[0],newRange[0]),range[1]=Math.max(range[1],newRange[1])}}tickLabels.enter().append("g").classed(tcls,1).append("text").attr("text-anchor","middle").each(function(d){var thisLabel=d3.select(this),newPromise=gd._promises.length;thisLabel.call(svgTextUtils.positionText,labelx(d),labely(d)).call(Drawing.font,d.font,d.fontSize,d.fontColor).text(d.text).call(svgTextUtils.convertToTspans,gd),(newPromise=gd._promises[newPromise])?labelsReady.push(gd._promises.pop().then(function(){positionLabels(thisLabel,ax.tickangle)})):positionLabels(thisLabel,ax.tickangle)}),tickLabels.exit().remove(),tickLabels.each(function(d){maxFontSize=Math.max(maxFontSize,d.fontSize)}),isAngular(ax)&&tickLabels.each(function(d){d3.select(this).select("text").call(svgTextUtils.positionText,labelx(d),labely(d))}),positionLabels(tickLabels,ax._lastangle||ax.tickangle);var done=Lib.syncOrAsync([function allLabelsReady(){return labelsReady.length&&Promise.all(labelsReady)},function fixLabelOverlaps(){if(positionLabels(tickLabels,ax.tickangle),"x"===axLetter&&!isNumeric(ax.tickangle)&&("log"!==ax.type||"D"!==String(ax.dtick).charAt(0))){var lbbArray=[];for(tickLabels.each(function(d){var s=d3.select(this),thisLabel=s.select(".text-math-group"),x=ax.l2p(d.x);thisLabel.empty()&&(thisLabel=s.select("text"));var bb=Drawing.bBox(thisLabel.node());lbbArray.push({top:0,bottom:10,height:10,left:x-bb.width/2,right:x+bb.width/2+2,width:bb.width+2})}),i=0;i<lbbArray.length-1;i++)if(Lib.bBoxIntersect(lbbArray[i],lbbArray[i+1])){autoangle=30;break}autoangle&&(Math.abs((vals[vals.length-1].x-vals[0].x)*ax._m)/(vals.length-1)<2.5*maxFontSize&&(autoangle=90),positionLabels(tickLabels,autoangle)),ax._lastangle=autoangle}return drawAxTitle(),axid+" done"},calcBoundingBox,function doAutoMargins(){var pushKey=ax._name+".automargin";if("x"===axLetter||"y"===axLetter)if(ax.automargin){var s=ax.side[0],push={x:0,y:0,r:0,l:0,t:0,b:0};"x"===axLetter?(push.y="free"===ax.anchor?ax.position:ax._anchorAxis.domain["t"===s?1:0],push[s]+=ax._boundingBox.height):(push.x="free"===ax.anchor?ax.position:ax._anchorAxis.domain["r"===s?1:0],push[s]+=ax._boundingBox.width),ax.title!==fullLayout._dfltTitle[axLetter]&&(push[s]+=ax.titlefont.size),Plots.autoMargin(gd,pushKey,push)}else Plots.autoMargin(gd,pushKey)}]);return done&&done.then&&gd._promises.push(done),done}function drawAxTitle(){if(!(skipTitle||ax.rangeslider&&ax.rangeslider.visible&&ax._boundingBox&&"bottom"===ax.side)){var transform,counterAxis,x,y,avoid={selection:tickLabels,side:ax.side},axLetter=axid.charAt(0),gs=gd._fullLayout._size,fontSize=ax.titlefont.size;if(tickLabels.size()){var translation=Drawing.getTranslate(tickLabels.node().parentNode);avoid.offsetLeft=translation.x,avoid.offsetTop=translation.y}var titleStandoff=10+1.5*fontSize+(ax.linewidth?ax.linewidth-1:0);"x"===axLetter?(counterAxis="free"===ax.anchor?{_offset:gs.t+(1-(ax.position||0))*gs.h,_length:0}:axisIds.getFromId(gd,ax.anchor),x=ax._offset+ax._length/2,y="top"===ax.side?-titleStandoff-fontSize*(ax.showticklabels?1:0):counterAxis._length+titleStandoff+fontSize*(ax.showticklabels?1.5:.5),y+=counterAxis._offset,avoid.side||(avoid.side="bottom")):(counterAxis="free"===ax.anchor?{_offset:gs.l+(ax.position||0)*gs.w,_length:0}:axisIds.getFromId(gd,ax.anchor),y=ax._offset+ax._length/2,x="right"===ax.side?counterAxis._length+titleStandoff+fontSize*(ax.showticklabels?1:.5):-titleStandoff-fontSize*(ax.showticklabels?.5:0),x+=counterAxis._offset,transform={rotate:"-90",offset:0},avoid.side||(avoid.side="left")),Titles.draw(gd,axid+"title",{propContainer:ax,propName:ax._name+".title",placeholder:fullLayout._dfltTitle[axLetter],avoid:avoid,transform:transform,attributes:{x:x,y:y,"text-anchor":"middle"}})}}function drawGrid(plotinfo,counteraxis){if(!fullLayout._hasOnlyLargeSploms){var gridcontainer=plotinfo.gridlayer.selectAll("."+axid),zlcontainer=plotinfo.zerolinelayer,gridpath=ax._gridpath||("x"===axLetter?"M0,"+counteraxis._offset+"v":"M"+counteraxis._offset+",0h")+counteraxis._length,grid=gridcontainer.selectAll("path."+gcls).data(!1===ax.showgrid?[]:valsClipped,datafn);if(grid.enter().append("path").classed(gcls,1).classed("crisp",1).attr("d",gridpath).each(function(d){ax.zeroline&&("linear"===ax.type||"-"===ax.type)&&Math.abs(d.x)<ax.dtick/100&&d3.select(this).remove()}),grid.attr("transform",transfn).call(Color.stroke,ax.gridcolor||"#ddd").style("stroke-width",gridWidth+"px"),"function"==typeof gridpath&&grid.attr("d",gridpath),grid.exit().remove(),zlcontainer){var zlData={x:0,id:axid},showZl=axes.shouldShowZeroLine(gd,ax,counteraxis),zl=zlcontainer.selectAll("path."+zcls).data(showZl?[zlData]:[]);zl.enter().append("path").classed(zcls,1).classed("zl",1).classed("crisp",1).attr("d",gridpath).each(function(){zlcontainer.selectAll("path").sort(function(da,db){return axisIds.idSort(da.id,db.id)})}),zl.attr("transform",transfn).call(Color.stroke,ax.zerolinecolor||Color.defaultLine).style("stroke-width",zeroLineWidth+"px"),zl.exit().remove()}}}},axes.shouldShowZeroLine=function(gd,ax,counterAxis){var rng=Lib.simpleMap(ax.range,ax.r2l);return rng[0]*rng[1]<=0&&ax.zeroline&&("linear"===ax.type||"-"===ax.type)&&ax._valsClipped.length&&(clipEnds(ax,0)||!function anyCounterAxLineAtZero(gd,ax,counterAxis,rng){var mainCounterAxis=counterAxis._mainAxis;if(!mainCounterAxis)return;var fullLayout=gd._fullLayout,axLetter=ax._id.charAt(0),counterLetter=axes.counterLetter(ax._id),zeroPosition=ax._offset+(Math.abs(rng[0])<Math.abs(rng[1])==("x"===axLetter)?0:ax._length);function lineNearZero(ax2){if(!ax2.showline||!ax2.linewidth)return!1;var tolerance=Math.max((ax2.linewidth+ax.zerolinewidth)/2,1);function closeEnough(pos2){return"number"==typeof pos2&&Math.abs(pos2-zeroPosition)<tolerance}if(closeEnough(ax2._mainLinePosition)||closeEnough(ax2._mainMirrorPosition))return!0;var linePositions=ax2._linepositions||{};for(var k in linePositions)if(closeEnough(linePositions[k][0])||closeEnough(linePositions[k][1]))return!0}var plotinfo=fullLayout._plots[counterAxis._mainSubplot];if(!(plotinfo.mainplotinfo||plotinfo).overlays.length)return lineNearZero(counterAxis);for(var counterLetterAxes=axes.list(gd,counterLetter),i=0;i<counterLetterAxes.length;i++){var counterAxis2=counterLetterAxes[i];if(counterAxis2._mainAxis===mainCounterAxis&&lineNearZero(counterAxis2))return!0}}(gd,ax,counterAxis,rng)||function hasBarsOrFill(gd,ax){for(var fullData=gd._fullData,subplot=ax._mainSubplot,axLetter=ax._id.charAt(0),i=0;i<fullData.length;i++){var trace=fullData[i];if(!0===trace.visible&&trace.xaxis+trace.yaxis===subplot&&(Registry.traceIs(trace,"bar")&&trace.orientation==={x:"h",y:"v"}[axLetter]||trace.fill&&trace.fill.charAt(trace.fill.length-1)===axLetter))return!0}return!1}(gd,ax))},axes.allowAutoMargin=function(gd){for(var axList=axes.list(gd,"",!0),i=0;i<axList.length;i++){var ax=axList[i];ax.automargin&&Plots.allowAutoMargin(gd,ax._name+".automargin"),ax.rangeslider&&ax.rangeslider.visible&&Plots.allowAutoMargin(gd,"rangeslider"+ax._id)}},axes.swap=function(gd,traces){for(var axGroups=function makeAxisGroups(gd,traces){var i,j,groups=[];for(i=0;i<traces.length;i++){var groupsi=[],xi=gd._fullData[traces[i]].xaxis,yi=gd._fullData[traces[i]].yaxis;if(xi&&yi){for(j=0;j<groups.length;j++)-1===groups[j].x.indexOf(xi)&&-1===groups[j].y.indexOf(yi)||groupsi.push(j);if(groupsi.length){var groupj,group0=groups[groupsi[0]];if(groupsi.length>1)for(j=1;j<groupsi.length;j++)groupj=groups[groupsi[j]],mergeAxisGroups(group0.x,groupj.x),mergeAxisGroups(group0.y,groupj.y);mergeAxisGroups(group0.x,[xi]),mergeAxisGroups(group0.y,[yi])}else groups.push({x:[xi],y:[yi]})}}return groups}(gd,traces),i=0;i<axGroups.length;i++)swapAxisGroup(gd,axGroups[i].x,axGroups[i].y)}},{"../../components/color":567,"../../components/drawing":592,"../../components/titles":658,"../../constants/alignment":665,"../../constants/numerical":670,"../../lib":693,"../../lib/svg_text_utils":718,"../../plots/plots":805,"../../registry":825,"./autorange":741,"./axis_autotype":743,"./axis_ids":745,"./layout_attributes":754,"./set_convert":760,d3:147,"fast-isnumeric":213}],743:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function autoType(array,calendar){return function moreDates(a,calendar){for(var ai,dcnt=0,ncnt=0,inc=Math.max(1,(a.length-1)/1e3),i=0;i<a.length;i+=inc)ai=a[Math.round(i)],Lib.isDateTime(ai,calendar)&&(dcnt+=1),isNumeric(ai)&&(ncnt+=1);return dcnt>2*ncnt}(array,calendar)?"date":function category(a){for(var ai,inc=Math.max(1,(a.length-1)/1e3),curvenums=0,curvecats=0,i=0;i<a.length;i+=inc)ai=a[Math.round(i)],Lib.cleanNumber(ai)!==BADNUM?curvenums++:"string"==typeof ai&&""!==ai&&"None"!==ai&&curvecats++;return curvecats>2*curvenums}(array)?"category":function linearOK(array){if(!array)return!1;for(var i=0;i<array.length;i++)if(isNumeric(array[i]))return!0;return!1}(array)?"linear":"-"}},{"../../constants/numerical":670,"../../lib":693,"fast-isnumeric":213}],744:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes"),handleTickValueDefaults=_dereq_("./tick_value_defaults"),handleTickMarkDefaults=_dereq_("./tick_mark_defaults"),handleTickLabelDefaults=_dereq_("./tick_label_defaults"),handleCategoryOrderDefaults=_dereq_("./category_order_defaults"),handleLineGridDefaults=_dereq_("./line_grid_defaults"),setConvert=_dereq_("./set_convert");module.exports=function handleAxisDefaults(containerIn,containerOut,coerce,options,layoutOut){var letter=options.letter,font=options.font||{},splomStash=options.splomStash||{},visible=coerce("visible",!options.cheateronly),axType=containerOut.type;"date"===axType&&Registry.getComponentMethod("calendars","handleDefaults")(containerIn,containerOut,"calendar",options.calendar);if(setConvert(containerOut,layoutOut),!coerce("autorange",!containerOut.isValidRange(containerIn.range))||"linear"!==axType&&"-"!==axType||coerce("rangemode"),coerce("range"),containerOut.cleanRange(),handleCategoryOrderDefaults(containerIn,containerOut,coerce,options),"category"===axType||options.noHover||coerce("hoverformat"),!visible)return containerOut;var dfltColor=coerce("color"),dfltFontColor=dfltColor!==layoutAttributes.color.dflt?dfltColor:font.color;return coerce("title",splomStash.label||layoutOut._dfltTitle[letter]),Lib.coerceFont(coerce,"titlefont",{family:font.family,size:Math.round(1.2*font.size),color:dfltFontColor}),handleTickValueDefaults(containerIn,containerOut,coerce,axType),handleTickLabelDefaults(containerIn,containerOut,coerce,axType,options),handleTickMarkDefaults(containerIn,containerOut,coerce,options),handleLineGridDefaults(containerIn,containerOut,coerce,{dfltColor:dfltColor,bgColor:options.bgColor,showGrid:options.showGrid,attributes:layoutAttributes}),(containerOut.showline||containerOut.ticks)&&coerce("mirror"),options.automargin&&coerce("automargin"),containerOut}},{"../../lib":693,"../../registry":825,"./category_order_defaults":746,"./layout_attributes":754,"./line_grid_defaults":756,"./set_convert":760,"./tick_label_defaults":761,"./tick_mark_defaults":762,"./tick_value_defaults":763}],745:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),constants=_dereq_("./constants");exports.id2name=function id2name(id){if("string"==typeof id&&id.match(constants.AX_ID_PATTERN)){var axNum=id.substr(1);return"1"===axNum&&(axNum=""),id.charAt(0)+"axis"+axNum}},exports.name2id=function name2id(name){if(name.match(constants.AX_NAME_PATTERN)){var axNum=name.substr(5);return"1"===axNum&&(axNum=""),name.charAt(0)+axNum}},exports.cleanId=function cleanId(id,axLetter){if(id.match(constants.AX_ID_PATTERN)&&(!axLetter||id.charAt(0)===axLetter)){var axNum=id.substr(1).replace(/^0+/,"");return"1"===axNum&&(axNum=""),id.charAt(0)+axNum}},exports.list=function(gd,axLetter,only2d){var fullLayout=gd._fullLayout;if(!fullLayout)return[];var i,idList=exports.listIds(gd,axLetter),out=new Array(idList.length);for(i=0;i<idList.length;i++){var idi=idList[i];out[i]=fullLayout[idi.charAt(0)+"axis"+idi.substr(1)]}if(!only2d){var sceneIds3D=fullLayout._subplots.gl3d||[];for(i=0;i<sceneIds3D.length;i++){var scene=fullLayout[sceneIds3D[i]];axLetter?out.push(scene[axLetter+"axis"]):out.push(scene.xaxis,scene.yaxis,scene.zaxis)}}return out},exports.listIds=function(gd,axLetter){var fullLayout=gd._fullLayout;if(!fullLayout)return[];var subplotLists=fullLayout._subplots;return axLetter?subplotLists[axLetter+"axis"]:subplotLists.xaxis.concat(subplotLists.yaxis)},exports.getFromId=function(gd,id,type){var fullLayout=gd._fullLayout;return"x"===type?id=id.replace(/y[0-9]*/,""):"y"===type&&(id=id.replace(/x[0-9]*/,"")),fullLayout[exports.id2name(id)]},exports.getFromTrace=function(gd,fullTrace,type){var fullLayout=gd._fullLayout,ax=null;if(Registry.traceIs(fullTrace,"gl3d")){var scene=fullTrace.scene;"scene"===scene.substr(0,5)&&(ax=fullLayout[scene][type+"axis"])}else ax=exports.getFromId(gd,fullTrace[type+"axis"]||type);return ax},exports.idSort=function(id1,id2){var letter1=id1.charAt(0),letter2=id2.charAt(0);return letter1!==letter2?letter1>letter2?1:-1:+(id1.substr(1)||1)-+(id2.substr(1)||1)}},{"../../registry":825,"./constants":747}],746:[function(_dereq_,module,exports){"use strict";module.exports=function handleCategoryOrderDefaults(containerIn,containerOut,coerce,opts){if("category"===containerOut.type){var orderDefault,arrayIn=containerIn.categoryarray,isValidArray=Array.isArray(arrayIn)&&arrayIn.length>0;isValidArray&&(orderDefault="array");var array,order=coerce("categoryorder",orderDefault);"array"===order&&(array=coerce("categoryarray")),isValidArray||"array"!==order||(order=containerOut.categoryorder="trace"),"trace"===order?containerOut._initialCategories=[]:"array"===order?containerOut._initialCategories=array.slice():(array=function findCategories(ax,opts){var axData,i,j,dataAttr=opts.dataAttr||ax._id.charAt(0),lookup={};if(opts.axData)axData=opts.axData;else for(axData=[],i=0;i<opts.data.length;i++){var trace=opts.data[i];trace[dataAttr+"axis"]===ax._id&&axData.push(trace)}for(i=0;i<axData.length;i++){var vals=axData[i][dataAttr];for(j=0;j<vals.length;j++){var v=vals[j];null!==v&&void 0!==v&&(lookup[v]=1)}}return Object.keys(lookup)}(containerOut,opts).sort(),"category ascending"===order?containerOut._initialCategories=array:"category descending"===order&&(containerOut._initialCategories=array.reverse()))}}},{}],747:[function(_dereq_,module,exports){"use strict";var counterRegex=_dereq_("../../lib/regex").counter;module.exports={idRegex:{x:counterRegex("x"),y:counterRegex("y")},attrRegex:counterRegex("[xy]axis"),xAxisMatch:counterRegex("xaxis"),yAxisMatch:counterRegex("yaxis"),AX_ID_PATTERN:/^[xyz][0-9]*$/,AX_NAME_PATTERN:/^[xyz]axis[0-9]*$/,SUBPLOT_PATTERN:/^x([0-9]*)y([0-9]*)$/,MINDRAG:8,MINSELECT:12,MINZOOM:20,DRAGGERSIZE:20,BENDPX:1.5,REDRAWDELAY:50,SELECTDELAY:100,SELECTID:"-select",DFLTRANGEX:[-1,6],DFLTRANGEY:[-1,4],traceLayerClasses:["heatmaplayer","contourcarpetlayer","contourlayer","barlayer","carpetlayer","violinlayer","boxlayer","ohlclayer","scattercarpetlayer","scatterlayer"],layerValue2layerClass:{"above traces":"above","below traces":"below"}}},{"../../lib/regex":710}],748:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),id2name=_dereq_("./axis_ids").id2name;module.exports=function handleConstraintDefaults(containerIn,containerOut,coerce,allAxisIds,layoutOut){var constraintGroups=layoutOut._axisConstraintGroups,thisID=containerOut._id,letter=thisID.charAt(0);if(!containerOut.fixedrange&&(coerce("constrain"),Lib.coerce(containerIn,containerOut,{constraintoward:{valType:"enumerated",values:"x"===letter?["left","center","right"]:["bottom","middle","top"],dflt:"x"===letter?"center":"middle"}},"constraintoward"),containerIn.scaleanchor)){var constraintOpts=function getConstraintOpts(constraintGroups,thisID,allAxisIds,layoutOut){var i,j,idj,axj,thisType=layoutOut[id2name(thisID)].type,linkableAxes=[];for(j=0;j<allAxisIds.length;j++)(idj=allAxisIds[j])!==thisID&&((axj=layoutOut[id2name(idj)]).type!==thisType||axj.fixedrange||linkableAxes.push(idj));for(i=0;i<constraintGroups.length;i++)if(constraintGroups[i][thisID]){var thisGroup=constraintGroups[i],linkableAxesNoLoops=[];for(j=0;j<linkableAxes.length;j++)idj=linkableAxes[j],thisGroup[idj]||linkableAxesNoLoops.push(idj);return{linkableAxes:linkableAxesNoLoops,thisGroup:thisGroup}}return{linkableAxes:linkableAxes,thisGroup:null}}(constraintGroups,thisID,allAxisIds,layoutOut),scaleanchor=Lib.coerce(containerIn,containerOut,{scaleanchor:{valType:"enumerated",values:constraintOpts.linkableAxes}},"scaleanchor");if(scaleanchor){var scaleratio=coerce("scaleratio");scaleratio||(scaleratio=containerOut.scaleratio=1),function updateConstraintGroups(constraintGroups,thisGroup,thisID,scaleanchor,scaleratio){var i,j,groupi,keyj,thisGroupIndex;null===thisGroup?((thisGroup={})[thisID]=1,thisGroupIndex=constraintGroups.length,constraintGroups.push(thisGroup)):thisGroupIndex=constraintGroups.indexOf(thisGroup);var thisGroupKeys=Object.keys(thisGroup);for(i=0;i<constraintGroups.length;i++)if(groupi=constraintGroups[i],i!==thisGroupIndex&&groupi[scaleanchor]){var baseScale=groupi[scaleanchor];for(j=0;j<thisGroupKeys.length;j++)keyj=thisGroupKeys[j],groupi[keyj]=baseScale*scaleratio*thisGroup[keyj];return void constraintGroups.splice(thisGroupIndex,1)}if(1!==scaleratio)for(j=0;j<thisGroupKeys.length;j++)thisGroup[thisGroupKeys[j]]*=scaleratio;thisGroup[scaleanchor]=1}(constraintGroups,constraintOpts.thisGroup,thisID,scaleanchor,scaleratio)}else-1!==allAxisIds.indexOf(containerIn.scaleanchor)&&Lib.warn("ignored "+containerOut._name+'.scaleanchor: "'+containerIn.scaleanchor+'" to avoid either an infinite loop and possibly inconsistent scaleratios, or because the targetaxis has fixed range.')}}},{"../../lib":693,"./axis_ids":745}],749:[function(_dereq_,module,exports){"use strict";var id2name=_dereq_("./axis_ids").id2name,scaleZoom=_dereq_("./scale_zoom"),makePadFn=_dereq_("./autorange").makePadFn,concatExtremes=_dereq_("./autorange").concatExtremes,ALMOST_EQUAL=_dereq_("../../constants/numerical").ALMOST_EQUAL,FROM_BL=_dereq_("../../constants/alignment").FROM_BL;function updateDomain(ax,factor){var inputDomain=ax._inputDomain,centerFraction=FROM_BL[ax.constraintoward],center=inputDomain[0]+(inputDomain[1]-inputDomain[0])*centerFraction;ax.domain=ax._input.domain=[center+(inputDomain[0]-center)/factor,center+(inputDomain[1]-center)/factor]}exports.enforce=function enforceAxisConstraints(gd){var i,j,axisID,ax,normScale,mode,factor,fullLayout=gd._fullLayout,constraintGroups=fullLayout._axisConstraintGroups||[];for(i=0;i<constraintGroups.length;i++){var group=constraintGroups[i],axisIDs=Object.keys(group),minScale=1/0,maxScale=0,matchScale=1/0,normScales={},axes={},hasAnyDomainConstraint=!1;for(j=0;j<axisIDs.length;j++)axes[axisID=axisIDs[j]]=ax=fullLayout[id2name(axisID)],ax._inputDomain?ax.domain=ax._inputDomain.slice():ax._inputDomain=ax.domain.slice(),ax._inputRange||(ax._inputRange=ax.range.slice()),ax.setScale(),normScales[axisID]=normScale=Math.abs(ax._m)/group[axisID],minScale=Math.min(minScale,normScale),"domain"!==ax.constrain&&ax._constraintShrinkable||(matchScale=Math.min(matchScale,normScale)),delete ax._constraintShrinkable,maxScale=Math.max(maxScale,normScale),"domain"===ax.constrain&&(hasAnyDomainConstraint=!0);if(!(minScale>ALMOST_EQUAL*maxScale)||hasAnyDomainConstraint)for(j=0;j<axisIDs.length;j++)if(normScale=normScales[axisID=axisIDs[j]],mode=(ax=axes[axisID]).constrain,normScale!==matchScale||"domain"===mode)if(factor=normScale/matchScale,"range"===mode)scaleZoom(ax,factor);else{var inputDomain=ax._inputDomain,domainShrunk=(ax.domain[1]-ax.domain[0])/(inputDomain[1]-inputDomain[0]),rangeShrunk=(ax.r2l(ax.range[1])-ax.r2l(ax.range[0]))/(ax.r2l(ax._inputRange[1])-ax.r2l(ax._inputRange[0]));if((factor/=domainShrunk)*rangeShrunk<1){ax.domain=ax._input.domain=inputDomain.slice(),scaleZoom(ax,factor);continue}if(rangeShrunk<1&&(ax.range=ax._input.range=ax._inputRange.slice(),factor*=rangeShrunk),ax.autorange){var rl0=ax.r2l(ax.range[0]),rl1=ax.r2l(ax.range[1]),rangeCenter=(rl0+rl1)/2,rangeMin=rangeCenter,rangeMax=rangeCenter,halfRange=Math.abs(rl1-rangeCenter),outerMin=rangeCenter-halfRange*factor*1.0001,outerMax=rangeCenter+halfRange*factor*1.0001,getPad=makePadFn(ax);updateDomain(ax,factor),ax.setScale();var newVal,k,m=Math.abs(ax._m),extremes=concatExtremes(gd,ax),minArray=extremes.min,maxArray=extremes.max;for(k=0;k<minArray.length;k++)(newVal=minArray[k].val-getPad(minArray[k])/m)>outerMin&&newVal<rangeMin&&(rangeMin=newVal);for(k=0;k<maxArray.length;k++)(newVal=maxArray[k].val+getPad(maxArray[k])/m)<outerMax&&newVal>rangeMax&&(rangeMax=newVal);factor/=(rangeMax-rangeMin)/(2*halfRange),rangeMin=ax.l2r(rangeMin),rangeMax=ax.l2r(rangeMax),ax.range=ax._input.range=rl0<rl1?[rangeMin,rangeMax]:[rangeMax,rangeMin]}updateDomain(ax,factor)}}},exports.clean=function cleanConstraints(gd,ax){if(ax._inputDomain){for(var isConstrained=!1,axId=ax._id,constraintGroups=gd._fullLayout._axisConstraintGroups,j=0;j<constraintGroups.length;j++)if(constraintGroups[j][axId]){isConstrained=!0;break}isConstrained&&"domain"===ax.constrain||(ax._input.domain=ax.domain=ax._inputDomain,delete ax._inputDomain)}}},{"../../constants/alignment":665,"../../constants/numerical":670,"./autorange":741,"./axis_ids":745,"./scale_zoom":758}],750:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),supportsPassive=_dereq_("has-passive-events"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),clearGlCanvases=_dereq_("../../lib/clear_gl_canvases"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Fx=_dereq_("../../components/fx"),setCursor=_dereq_("../../lib/setcursor"),dragElement=_dereq_("../../components/dragelement"),FROM_TL=_dereq_("../../constants/alignment").FROM_TL,Plots=_dereq_("../plots"),doTicksSingle=_dereq_("./axes").doTicksSingle,getFromId=_dereq_("./axis_ids").getFromId,prepSelect=_dereq_("./select").prepSelect,clearSelect=_dereq_("./select").clearSelect,selectOnClick=_dereq_("./select").selectOnClick,scaleZoom=_dereq_("./scale_zoom"),constants=_dereq_("./constants"),MINDRAG=constants.MINDRAG,MINZOOM=constants.MINZOOM,SHOWZOOMOUTTIP=!0;function makeDragger(plotinfo,nodeName,dragClass,cursor){var dragger3=Lib.ensureSingle(plotinfo.draglayer,nodeName,dragClass,function(s){s.classed("drag",!0).style({fill:"transparent","stroke-width":0}).attr("data-subplot",plotinfo.id)});return dragger3.call(setCursor,cursor),dragger3.node()}function makeRectDragger(plotinfo,dragClass,cursor,x,y,w,h){var dragger=makeDragger(plotinfo,"rect",dragClass,cursor);return d3.select(dragger).call(Drawing.setRect,x,y,w,h),dragger}function isDirectionActive(axList,activeVal){for(var i=0;i<axList.length;i++)if(!axList[i].fixedrange)return activeVal;return""}function zoomAxRanges(axList,r0Fraction,r1Fraction,updates,linkedAxes){var i,axi,axRangeLinear0,axRangeLinearSpan;for(i=0;i<axList.length;i++)(axi=axList[i]).fixedrange||(axRangeLinear0=axi._rl[0],axRangeLinearSpan=axi._rl[1]-axRangeLinear0,axi.range=[axi.l2r(axRangeLinear0+axRangeLinearSpan*r0Fraction),axi.l2r(axRangeLinear0+axRangeLinearSpan*r1Fraction)],updates[axi._name+".range[0]"]=axi.range[0],updates[axi._name+".range[1]"]=axi.range[1]);if(linkedAxes&&linkedAxes.length){var linkedR0Fraction=(r0Fraction+(1-r1Fraction))/2;zoomAxRanges(linkedAxes,linkedR0Fraction,1-linkedR0Fraction,updates)}}function dragAxList(axList,pix){for(var i=0;i<axList.length;i++){var axi=axList[i];axi.fixedrange||(axi.range=[axi.l2r(axi._rl[0]-pix/axi._m),axi.l2r(axi._rl[1]-pix/axi._m)])}}function dZoom(d){return 1-(d>=0?Math.min(d,.9):1/(1/Math.max(d,-.3)+3.222))}function makeZoombox(zoomlayer,lum,xs,ys,path0){return zoomlayer.append("path").attr("class","zoombox").style({fill:lum>.2?"rgba(0,0,0,0)":"rgba(255,255,255,0)","stroke-width":0}).attr("transform","translate("+xs+", "+ys+")").attr("d",path0+"Z")}function makeCorners(zoomlayer,xs,ys){return zoomlayer.append("path").attr("class","zoombox-corners").style({fill:Color.background,stroke:Color.defaultLine,"stroke-width":1,opacity:0}).attr("transform","translate("+xs+", "+ys+")").attr("d","M0,0Z")}function updateZoombox(zb,corners,box,path0,dimmed,lum){zb.attr("d",path0+"M"+box.l+","+box.t+"v"+box.h+"h"+box.w+"v-"+box.h+"h-"+box.w+"Z"),transitionZoombox(zb,corners,dimmed,lum)}function transitionZoombox(zb,corners,dimmed,lum){dimmed||(zb.transition().style("fill",lum>.2?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.3)").duration(200),corners.transition().style("opacity",1).duration(200))}function removeZoombox(gd){d3.select(gd).selectAll(".zoombox,.js-zoombox-backdrop,.js-zoombox-menu,.zoombox-corners").remove()}function showDoubleClickNotifier(gd){SHOWZOOMOUTTIP&&gd.data&&gd._context.showTips&&(Lib.notifier(Lib._(gd,"Double-click to zoom back out"),"long"),SHOWZOOMOUTTIP=!1)}function isSelectOrLasso(dragmode){return"lasso"===dragmode||"select"===dragmode}function xyCorners(box){var clen=Math.floor(Math.min(box.b-box.t,box.r-box.l,MINZOOM)/2);return"M"+(box.l-3.5)+","+(box.t-.5+clen)+"h3v"+-clen+"h"+clen+"v-3h-"+(clen+3)+"ZM"+(box.r+3.5)+","+(box.t-.5+clen)+"h-3v"+-clen+"h"+-clen+"v-3h"+(clen+3)+"ZM"+(box.r+3.5)+","+(box.b+.5-clen)+"h-3v"+clen+"h"+-clen+"v3h"+(clen+3)+"ZM"+(box.l-3.5)+","+(box.b+.5-clen)+"h3v"+clen+"h"+clen+"v3h-"+(clen+3)+"Z"}function attachWheelEventHandler(element,handler){if(supportsPassive){var wheelEventName=void 0!==element.onwheel?"wheel":"mousewheel";element._onwheel&&element.removeEventListener(wheelEventName,element._onwheel),element._onwheel=handler,element.addEventListener(wheelEventName,handler,{passive:!1})}else void 0!==element.onwheel?element.onwheel=handler:void 0!==element.onmousewheel&&(element.onmousewheel=handler)}function hashValues(hash){var out=[];for(var k in hash)out.push(hash[k]);return out}module.exports={makeDragBox:function makeDragBox(gd,plotinfo,x,y,w,h,ns,ew){var xa0,ya0,xaHash,yaHash,xaxes,yaxes,xs,ys,pw,ph,links,xActive,yActive,allFixedRanges,isSubplotConstrained,editX,editY,hasScatterGl,hasOnlyLargeSploms,hasSplom,hasSVG,updates,zoomlayer=gd._fullLayout._zoomlayer,isMainDrag=ns+ew==="nsew",singleEnd=1===(ns+ew).length;function recomputeAxisLists(){if(xa0=plotinfo.xaxis,ya0=plotinfo.yaxis,pw=xa0._length,ph=ya0._length,xs=xa0._offset,ys=ya0._offset,(xaHash={})[xa0._id]=xa0,(yaHash={})[ya0._id]=ya0,ns&&ew)for(var overlays=plotinfo.overlays,i=0;i<overlays.length;i++){var xa=overlays[i].xaxis;xaHash[xa._id]=xa;var ya=overlays[i].yaxis;yaHash[ya._id]=ya}xaxes=hashValues(xaHash),yaxes=hashValues(yaHash),xActive=isDirectionActive(xaxes,ew),yActive=isDirectionActive(yaxes,ns),allFixedRanges=!yActive&&!xActive,links=function calcLinks(gd,xaHash,yaHash){for(var xID,yID,xLinkID,yLinkID,constraintGroups=gd._fullLayout._axisConstraintGroups,isSubplotConstrained=!1,xLinks={},yLinks={},i=0;i<constraintGroups.length;i++){var group=constraintGroups[i];for(xID in xaHash)if(group[xID]){for(xLinkID in group)("x"===xLinkID.charAt(0)?xaHash:yaHash)[xLinkID]||(xLinks[xLinkID]=1);for(yID in yaHash)group[yID]&&(isSubplotConstrained=!0)}for(yID in yaHash)if(group[yID])for(yLinkID in group)("x"===yLinkID.charAt(0)?xaHash:yaHash)[yLinkID]||(yLinks[yLinkID]=1)}isSubplotConstrained&&(Lib.extendFlat(xLinks,yLinks),yLinks={});var xaHashLinked={},xaxesLinked=[];for(xLinkID in xLinks){var xa=getFromId(gd,xLinkID);xaxesLinked.push(xa),xaHashLinked[xa._id]=xa}var yaHashLinked={},yaxesLinked=[];for(yLinkID in yLinks){var ya=getFromId(gd,yLinkID);yaxesLinked.push(ya),yaHashLinked[ya._id]=ya}return{xaHash:xaHashLinked,yaHash:yaHashLinked,xaxes:xaxesLinked,yaxes:yaxesLinked,isSubplotConstrained:isSubplotConstrained}}(gd,xaHash,yaHash),isSubplotConstrained=links.isSubplotConstrained,editX=ew||isSubplotConstrained,editY=ns||isSubplotConstrained;var fullLayout=gd._fullLayout;hasScatterGl=fullLayout._has("scattergl"),hasOnlyLargeSploms=fullLayout._hasOnlyLargeSploms,hasSplom=hasOnlyLargeSploms||fullLayout._has("splom"),hasSVG=fullLayout._has("svg")}recomputeAxisLists();var cursor=function getDragCursor(nsew,dragmode,isMainDrag){return nsew?"nsew"===nsew?isMainDrag?"":"pan"===dragmode?"move":"crosshair":nsew.toLowerCase()+"-resize":"pointer"}(yActive+xActive,gd._fullLayout.dragmode,isMainDrag),dragger=makeRectDragger(plotinfo,ns+ew+"drag",cursor,x,y,w,h);if(allFixedRanges&&!isMainDrag)return dragger.onmousedown=null,dragger.style.pointerEvents="none",dragger;var x0,y0,box,lum,path0,dimmed,zoomMode,zb,corners,zoomDragged,dragOptions={element:dragger,gd:gd,plotinfo:plotinfo};function clearAndResetSelect(){dragOptions.plotinfo.selection=!1,clearSelect(zoomlayer)}function clickFn(numClicks,evt){var clickmode=gd._fullLayout.clickmode;if(removeZoombox(gd),2!==numClicks||singleEnd||function doubleClick(){if(!gd._transitioningWithDuration){var ax,i,rangeInitial,doubleClickConfig=gd._context.doubleClick,axList=(xActive?xaxes:[]).concat(yActive?yaxes:[]),attrs={};if("reset+autosize"===doubleClickConfig)for(doubleClickConfig="autosize",i=0;i<axList.length;i++)if((ax=axList[i])._rangeInitial&&(ax.range[0]!==ax._rangeInitial[0]||ax.range[1]!==ax._rangeInitial[1])||!ax._rangeInitial&&!ax.autorange){doubleClickConfig="reset";break}if("autosize"===doubleClickConfig)for(i=0;i<axList.length;i++)(ax=axList[i]).fixedrange||(attrs[ax._name+".autorange"]=!0);else if("reset"===doubleClickConfig)for((xActive||isSubplotConstrained)&&(axList=axList.concat(links.xaxes)),yActive&&!isSubplotConstrained&&(axList=axList.concat(links.yaxes)),isSubplotConstrained&&(xActive?yActive||(axList=axList.concat(yaxes)):axList=axList.concat(xaxes)),i=0;i<axList.length;i++)(ax=axList[i])._rangeInitial?(rangeInitial=ax._rangeInitial,attrs[ax._name+".range[0]"]=rangeInitial[0],attrs[ax._name+".range[1]"]=rangeInitial[1]):attrs[ax._name+".autorange"]=!0;gd.emit("plotly_doubleclick",null),Registry.call("relayout",gd,attrs)}}(),isMainDrag)clickmode.indexOf("select")>-1&&selectOnClick(evt,gd,xaxes,yaxes,plotinfo.id,dragOptions),clickmode.indexOf("event")>-1&&Fx.click(gd,evt,plotinfo.id);else if(1===numClicks&&singleEnd){var ax=ns?ya0:xa0,end="s"===ns||"w"===ew?0:1,attrStr=ax._name+".range["+end+"]",initialText=function getEndText(ax,end){var dig,initialVal=ax.range[end],diff=Math.abs(initialVal-ax.range[1-end]);return"date"===ax.type?initialVal:"log"===ax.type?(dig=Math.ceil(Math.max(0,-Math.log(diff)/Math.LN10))+3,d3.format("."+dig+"g")(Math.pow(10,initialVal))):(dig=Math.floor(Math.log(Math.abs(initialVal))/Math.LN10)-Math.floor(Math.log(diff)/Math.LN10)+4,d3.format("."+String(dig)+"g")(initialVal))}(ax,end),hAlign="left",vAlign="middle";if(ax.fixedrange)return;ns?(vAlign="n"===ns?"top":"bottom","right"===ax.side&&(hAlign="right")):"e"===ew&&(hAlign="right"),gd._context.showAxisRangeEntryBoxes&&d3.select(dragger).call(svgTextUtils.makeEditable,{gd:gd,immediate:!0,background:gd._fullLayout.paper_bgcolor,text:String(initialText),fill:ax.tickfont?ax.tickfont.color:"#444",horizontalAlign:hAlign,verticalAlign:vAlign}).on("edit",function(text){var v=ax.d2r(text);void 0!==v&&Registry.call("relayout",gd,attrStr,v)})}}function zoomMove(dx0,dy0){if(gd._transitioningWithDuration)return!1;var x1=Math.max(0,Math.min(pw,dx0+x0)),y1=Math.max(0,Math.min(ph,dy0+y0)),dx=Math.abs(x1-x0),dy=Math.abs(y1-y0);function noZoom(){zoomMode="",box.r=box.l,box.t=box.b,corners.attr("d","M0,0Z")}box.l=Math.min(x0,x1),box.r=Math.max(x0,x1),box.t=Math.min(y0,y1),box.b=Math.max(y0,y1),isSubplotConstrained?dx>MINZOOM||dy>MINZOOM?(zoomMode="xy",dx/pw>dy/ph?(dy=dx*ph/pw,y0>y1?box.t=y0-dy:box.b=y0+dy):(dx=dy*pw/ph,x0>x1?box.l=x0-dx:box.r=x0+dx),corners.attr("d",xyCorners(box))):noZoom():!yActive||dy<Math.min(Math.max(.6*dx,MINDRAG),MINZOOM)?dx<MINDRAG||!xActive?noZoom():(box.t=0,box.b=ph,zoomMode="x",corners.attr("d",function xCorners(box,y0){return"M"+(box.l-.5)+","+(y0-MINZOOM-.5)+"h-3v"+(2*MINZOOM+1)+"h3ZM"+(box.r+.5)+","+(y0-MINZOOM-.5)+"h3v"+(2*MINZOOM+1)+"h-3Z"}(box,y0))):!xActive||dx<Math.min(.6*dy,MINZOOM)?(box.l=0,box.r=pw,zoomMode="y",corners.attr("d",function yCorners(box,x0){return"M"+(x0-MINZOOM-.5)+","+(box.t-.5)+"v-3h"+(2*MINZOOM+1)+"v3ZM"+(x0-MINZOOM-.5)+","+(box.b+.5)+"v3h"+(2*MINZOOM+1)+"v-3Z"}(box,x0))):(zoomMode="xy",corners.attr("d",xyCorners(box))),box.w=box.r-box.l,box.h=box.b-box.t,zoomMode&&(zoomDragged=!0),gd._dragged=zoomDragged,updateZoombox(zb,corners,box,path0,dimmed,lum),dimmed=!0}function zoomDone(){if(updates={},Math.min(box.h,box.w)<2*MINDRAG)return removeZoombox(gd);"xy"!==zoomMode&&"x"!==zoomMode||zoomAxRanges(xaxes,box.l/pw,box.r/pw,updates,links.xaxes),"xy"!==zoomMode&&"y"!==zoomMode||zoomAxRanges(yaxes,(ph-box.b)/ph,(ph-box.t)/ph,updates,links.yaxes),removeZoombox(gd),dragTail(),showDoubleClickNotifier(gd)}dragOptions.prepFn=function(e,startX,startY){var dragModePrev=dragOptions.dragmode,dragModeNow=gd._fullLayout.dragmode;dragModeNow!==dragModePrev&&(dragOptions.dragmode=dragModeNow),recomputeAxisLists(),allFixedRanges||(isMainDrag?e.shiftKey?"pan"===dragModeNow?dragModeNow="zoom":isSelectOrLasso(dragModeNow)||(dragModeNow="pan"):e.ctrlKey&&(dragModeNow="pan"):dragModeNow="pan"),dragOptions.minDrag="lasso"===dragModeNow?1:void 0,isSelectOrLasso(dragModeNow)?(dragOptions.xaxes=xaxes,dragOptions.yaxes=yaxes,prepSelect(e,startX,startY,dragOptions,dragModeNow)):(dragOptions.clickFn=clickFn,isSelectOrLasso(dragModePrev)&&clearAndResetSelect(),allFixedRanges||("zoom"===dragModeNow?(dragOptions.moveFn=zoomMove,dragOptions.doneFn=zoomDone,dragOptions.minDrag=1,function zoomPrep(e,startX,startY){var dragBBox=dragger.getBoundingClientRect();x0=startX-dragBBox.left,y0=startY-dragBBox.top,box={l:x0,r:x0,w:0,t:y0,b:y0,h:0},lum=gd._hmpixcount?gd._hmlumcount/gd._hmpixcount:tinycolor(gd._fullLayout.plot_bgcolor).getLuminance(),dimmed=!1,zoomMode="xy",zoomDragged=!1,zb=makeZoombox(zoomlayer,lum,xs,ys,path0="M0,0H"+pw+"V"+ph+"H0V0"),corners=makeCorners(zoomlayer,xs,ys)}(0,startX,startY)):"pan"===dragModeNow&&(dragOptions.moveFn=plotDrag,dragOptions.doneFn=dragTail)))},dragElement.init(dragOptions);var xScaleFactorOld,yScaleFactorOld,scrollViewBox=[0,0,pw,ph],redrawTimer=null,REDRAWDELAY=constants.REDRAWDELAY,mainplot=plotinfo.mainplot?gd._fullLayout._plots[plotinfo.mainplot]:plotinfo;function plotDrag(dx,dy){if(!gd._transitioningWithDuration){if("ew"===xActive||"ns"===yActive)return xActive&&dragAxList(xaxes,dx),yActive&&dragAxList(yaxes,dy),updateSubplots([xActive?-dx:0,yActive?-dy:0,pw,ph]),void ticksAndAnnotations(yActive,xActive);if(isSubplotConstrained&&xActive&&yActive){var dxySign="w"===xActive==("n"===yActive)?1:-1,dxyFraction=(dx/pw+dxySign*dy/ph)/2;dx=dxyFraction*pw,dy=dxySign*dxyFraction*ph}"w"===xActive?dx=dz(xaxes,0,dx):"e"===xActive?dx=dz(xaxes,1,-dx):xActive||(dx=0),"n"===yActive?dy=dz(yaxes,1,dy):"s"===yActive?dy=dz(yaxes,0,-dy):yActive||(dy=0);var x0="w"===xActive?dx:0,y0="n"===yActive?dy:0;if(isSubplotConstrained){var i;if(!xActive&&1===yActive.length){for(i=0;i<xaxes.length;i++)xaxes[i].range=xaxes[i]._r.slice(),scaleZoom(xaxes[i],1-dy/ph);x0=(dx=dy*pw/ph)/2}if(!yActive&&1===xActive.length){for(i=0;i<yaxes.length;i++)yaxes[i].range=yaxes[i]._r.slice(),scaleZoom(yaxes[i],1-dx/pw);y0=(dy=dx*ph/pw)/2}}updateSubplots([x0,y0,pw-dx,ph-dy]),ticksAndAnnotations(yActive,xActive)}function dz(axArray,end,d){for(var movedAx,newLinearizedEnd,otherEnd=1-end,i=0;i<axArray.length;i++){var axi=axArray[i];if(!axi.fixedrange){movedAx=axi,newLinearizedEnd=axi._rl[otherEnd]+(axi._rl[end]-axi._rl[otherEnd])/dZoom(d/axi._length);var newEnd=axi.l2r(newLinearizedEnd);!1!==newEnd&&void 0!==newEnd&&(axi.range[end]=newEnd)}}return movedAx._length*(movedAx._rl[end]-newLinearizedEnd)/(movedAx._rl[end]-movedAx._rl[otherEnd])}}function ticksAndAnnotations(ns,ew){var i,activeAxIds=[];function pushActiveAxIds(axList){for(i=0;i<axList.length;i++)axList[i].fixedrange||activeAxIds.push(axList[i]._id)}for(editX&&(pushActiveAxIds(xaxes),pushActiveAxIds(links.xaxes)),editY&&(pushActiveAxIds(yaxes),pushActiveAxIds(links.yaxes)),updates={},i=0;i<activeAxIds.length;i++){var axId=activeAxIds[i];doTicksSingle(gd,axId,!0);var ax=getFromId(gd,axId);updates[ax._name+".range[0]"]=ax.range[0],updates[ax._name+".range[1]"]=ax.range[1]}function redrawObjs(objArray,method,shortCircuit){for(i=0;i<objArray.length;i++){var obji=objArray[i];if((ew&&-1!==activeAxIds.indexOf(obji.xref)||ns&&-1!==activeAxIds.indexOf(obji.yref))&&(method(gd,i),shortCircuit))return}}redrawObjs(gd._fullLayout.annotations||[],Registry.getComponentMethod("annotations","drawOne")),redrawObjs(gd._fullLayout.shapes||[],Registry.getComponentMethod("shapes","drawOne")),redrawObjs(gd._fullLayout.images||[],Registry.getComponentMethod("images","draw"),!0)}function dragTail(){updateSubplots([0,0,pw,ph]),Lib.syncOrAsync([Plots.previousPromises,function(){Registry.call("relayout",gd,updates)}],gd)}function updateSubplots(viewBox){var i,sp,xa,ya,fullLayout=gd._fullLayout,plotinfos=fullLayout._plots,subplots=fullLayout._subplots.cartesian;if((hasSplom||hasScatterGl)&&clearGlCanvases(gd),!hasSplom||(Registry.subplotsRegistry.splom.drag(gd),!hasOnlyLargeSploms)){if(hasScatterGl)for(i=0;i<subplots.length;i++){xa=(sp=plotinfos[subplots[i]]).xaxis,ya=sp.yaxis;var scene=sp._scene;if(scene){var xrng=Lib.simpleMap(xa.range,xa.r2l),yrng=Lib.simpleMap(ya.range,ya.r2l);scene.update({range:[xrng[0],yrng[0],xrng[1],yrng[1]]})}}if(hasSVG){var xScaleFactor=viewBox[2]/xa0._length,yScaleFactor=viewBox[3]/ya0._length;for(i=0;i<subplots.length;i++){xa=(sp=plotinfos[subplots[i]]).xaxis,ya=sp.yaxis;var xScaleFactor2,yScaleFactor2,clipDx,clipDy,editX2=editX&&!xa.fixedrange&&xaHash[xa._id],editY2=editY&&!ya.fixedrange&&yaHash[ya._id];if(editX2?(xScaleFactor2=xScaleFactor,clipDx=ew?viewBox[0]:getShift(xa,xScaleFactor2)):clipDx=scaleAndGetShift(xa,xScaleFactor2=getLinkedScaleFactor(xa,xScaleFactor,yScaleFactor)),editY2?(yScaleFactor2=yScaleFactor,clipDy=ns?viewBox[1]:getShift(ya,yScaleFactor2)):clipDy=scaleAndGetShift(ya,yScaleFactor2=getLinkedScaleFactor(ya,xScaleFactor,yScaleFactor)),xScaleFactor2||yScaleFactor2){xScaleFactor2||(xScaleFactor2=1),yScaleFactor2||(yScaleFactor2=1);var plotDx=xa._offset-clipDx/xScaleFactor2,plotDy=ya._offset-clipDy/yScaleFactor2;sp.clipRect.call(Drawing.setTranslate,clipDx,clipDy).call(Drawing.setScale,xScaleFactor2,yScaleFactor2),sp.plot.call(Drawing.setTranslate,plotDx,plotDy).call(Drawing.setScale,1/xScaleFactor2,1/yScaleFactor2),xScaleFactor2===xScaleFactorOld&&yScaleFactor2===yScaleFactorOld||(Drawing.setPointGroupScale(sp.zoomScalePts,xScaleFactor2,yScaleFactor2),Drawing.setTextPointsScale(sp.zoomScaleTxt,xScaleFactor2,yScaleFactor2)),Drawing.hideOutsideRangePoints(sp.clipOnAxisFalseTraces,sp),xScaleFactorOld=xScaleFactor2,yScaleFactorOld=yScaleFactor2}}}}}function getLinkedScaleFactor(ax,xScaleFactor,yScaleFactor){return ax.fixedrange?0:editX&&links.xaHash[ax._id]?xScaleFactor:editY&&(isSubplotConstrained?links.xaHash:links.yaHash)[ax._id]?yScaleFactor:0}function scaleAndGetShift(ax,scaleFactor){return scaleFactor?(ax.range=ax._r.slice(),scaleZoom(ax,scaleFactor),getShift(ax,scaleFactor)):0}function getShift(ax,scaleFactor){return ax._length*(1-scaleFactor)*FROM_TL[ax.constraintoward||"middle"]}return ns.length*ew.length!=1&&attachWheelEventHandler(dragger,function zoomWheel(e){if(gd._context.scrollZoom||gd._fullLayout._enablescrollzoom){if(clearAndResetSelect(),gd._transitioningWithDuration)return e.preventDefault(),void e.stopPropagation();var pc=gd.querySelector(".plotly");if(recomputeAxisLists(),!(pc.scrollHeight-pc.clientHeight>10||pc.scrollWidth-pc.clientWidth>10)){clearTimeout(redrawTimer);var wheelDelta=-e.deltaY;if(isFinite(wheelDelta)||(wheelDelta=e.wheelDelta/10),isFinite(wheelDelta)){var i,zoom=Math.exp(-Math.min(Math.max(wheelDelta,-20),20)/200),gbb=mainplot.draglayer.select(".nsewdrag").node().getBoundingClientRect(),xfrac=(e.clientX-gbb.left)/gbb.width,yfrac=(gbb.bottom-e.clientY)/gbb.height;if(editX){for(ew||(xfrac=.5),i=0;i<xaxes.length;i++)zoomWheelOneAxis(xaxes[i],xfrac,zoom);scrollViewBox[2]*=zoom,scrollViewBox[0]+=scrollViewBox[2]*xfrac*(1/zoom-1)}if(editY){for(ns||(yfrac=.5),i=0;i<yaxes.length;i++)zoomWheelOneAxis(yaxes[i],yfrac,zoom);scrollViewBox[3]*=zoom,scrollViewBox[1]+=scrollViewBox[3]*(1-yfrac)*(1/zoom-1)}updateSubplots(scrollViewBox),ticksAndAnnotations(ns,ew),redrawTimer=setTimeout(function(){scrollViewBox=[0,0,pw,ph],dragTail()},REDRAWDELAY),e.preventDefault()}else Lib.log("Did not find wheel motion attributes: ",e)}}function zoomWheelOneAxis(ax,centerFraction,zoom){if(!ax.fixedrange){var axRange=Lib.simpleMap(ax.range,ax.r2l),v0=axRange[0]+(axRange[1]-axRange[0])*centerFraction;ax.range=axRange.map(function doZoom(v){return ax.l2r(v0+(v-v0)*zoom)})}}}),dragger},makeDragger:makeDragger,makeRectDragger:makeRectDragger,makeZoombox:makeZoombox,makeCorners:makeCorners,updateZoombox:updateZoombox,xyCorners:xyCorners,transitionZoombox:transitionZoombox,removeZoombox:removeZoombox,showDoubleClickNotifier:showDoubleClickNotifier,attachWheelEventHandler:attachWheelEventHandler}},{"../../components/color":567,"../../components/dragelement":589,"../../components/drawing":592,"../../components/fx":609,"../../constants/alignment":665,"../../lib":693,"../../lib/clear_gl_canvases":676,"../../lib/setcursor":714,"../../lib/svg_text_utils":718,"../../registry":825,"../plots":805,"./axes":742,"./axis_ids":745,"./constants":747,"./scale_zoom":758,"./select":759,d3:147,"has-passive-events":392,tinycolor2:511}],751:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Fx=_dereq_("../../components/fx"),dragElement=_dereq_("../../components/dragelement"),setCursor=_dereq_("../../lib/setcursor"),makeDragBox=_dereq_("./dragbox").makeDragBox,DRAGGERSIZE=_dereq_("./constants").DRAGGERSIZE;exports.initInteractions=function initInteractions(gd){var fullLayout=gd._fullLayout;if(gd._context.staticPlot)d3.select(gd).selectAll(".drag").remove();else if(fullLayout._has("cartesian")||fullLayout._has("splom")){Object.keys(fullLayout._plots||{}).sort(function(a,b){if((fullLayout._plots[a].mainplot&&!0)===(fullLayout._plots[b].mainplot&&!0)){var aParts=a.split("y"),bParts=b.split("y");return aParts[0]===bParts[0]?Number(aParts[1]||1)-Number(bParts[1]||1):Number(aParts[0]||1)-Number(bParts[0]||1)}return fullLayout._plots[a].mainplot?1:-1}).forEach(function(subplot){var plotinfo=fullLayout._plots[subplot],xa=plotinfo.xaxis,ya=plotinfo.yaxis;if(!plotinfo.mainplot){var maindrag=makeDragBox(gd,plotinfo,xa._offset,ya._offset,xa._length,ya._length,"ns","ew");maindrag.onmousemove=function(evt){gd._fullLayout._rehover=function(){gd._fullLayout._hoversubplot===subplot&&Fx.hover(gd,evt,subplot)},Fx.hover(gd,evt,subplot),gd._fullLayout._lasthover=maindrag,gd._fullLayout._hoversubplot=subplot},maindrag.onmouseout=function(evt){gd._dragging||(gd._fullLayout._hoversubplot=null,dragElement.unhover(gd,evt))},gd._context.showAxisDragHandles&&(makeDragBox(gd,plotinfo,xa._offset-DRAGGERSIZE,ya._offset-DRAGGERSIZE,DRAGGERSIZE,DRAGGERSIZE,"n","w"),makeDragBox(gd,plotinfo,xa._offset+xa._length,ya._offset-DRAGGERSIZE,DRAGGERSIZE,DRAGGERSIZE,"n","e"),makeDragBox(gd,plotinfo,xa._offset-DRAGGERSIZE,ya._offset+ya._length,DRAGGERSIZE,DRAGGERSIZE,"s","w"),makeDragBox(gd,plotinfo,xa._offset+xa._length,ya._offset+ya._length,DRAGGERSIZE,DRAGGERSIZE,"s","e"))}if(gd._context.showAxisDragHandles){if(subplot===xa._mainSubplot){var y0=xa._mainLinePosition;"top"===xa.side&&(y0-=DRAGGERSIZE),makeDragBox(gd,plotinfo,xa._offset+.1*xa._length,y0,.8*xa._length,DRAGGERSIZE,"","ew"),makeDragBox(gd,plotinfo,xa._offset,y0,.1*xa._length,DRAGGERSIZE,"","w"),makeDragBox(gd,plotinfo,xa._offset+.9*xa._length,y0,.1*xa._length,DRAGGERSIZE,"","e")}if(subplot===ya._mainSubplot){var x0=ya._mainLinePosition;"right"!==ya.side&&(x0-=DRAGGERSIZE),makeDragBox(gd,plotinfo,x0,ya._offset+.1*ya._length,DRAGGERSIZE,.8*ya._length,"ns",""),makeDragBox(gd,plotinfo,x0,ya._offset+.9*ya._length,DRAGGERSIZE,.1*ya._length,"s",""),makeDragBox(gd,plotinfo,x0,ya._offset,DRAGGERSIZE,.1*ya._length,"n","")}}});var hoverLayer=fullLayout._hoverlayer.node();hoverLayer.onmousemove=function(evt){evt.target=gd._fullLayout._lasthover,Fx.hover(gd,evt,fullLayout._hoversubplot)},hoverLayer.onclick=function(evt){evt.target=gd._fullLayout._lasthover,Fx.click(gd,evt)},hoverLayer.onmousedown=function(evt){gd._fullLayout._lasthover.onmousedown(evt)},exports.updateFx(gd)}},exports.updateFx=function(gd){var fullLayout=gd._fullLayout,cursor="pan"===fullLayout.dragmode?"move":"crosshair";setCursor(fullLayout._draggers,cursor)}},{"../../components/dragelement":589,"../../components/fx":609,"../../lib/setcursor":714,"./constants":747,"./dragbox":750,d3:147}],752:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib");module.exports=function makeIncludeComponents(containerArrayName){return function includeComponents(layoutIn,layoutOut){var array=layoutIn[containerArrayName];if(Array.isArray(array))for(var Cartesian=Registry.subplotsRegistry.cartesian,idRegex=Cartesian.idRegex,subplots=layoutOut._subplots,xaList=subplots.xaxis,yaList=subplots.yaxis,cartesianList=subplots.cartesian,hasCartesianOrGL2D=layoutOut._has("cartesian")||layoutOut._has("gl2d"),i=0;i<array.length;i++){var itemi=array[i];if(Lib.isPlainObject(itemi)){var xref=itemi.xref,yref=itemi.yref,hasXref=idRegex.x.test(xref),hasYref=idRegex.y.test(yref);if(hasXref||hasYref){hasCartesianOrGL2D||Lib.pushUnique(layoutOut._basePlotModules,Cartesian);var newAxis=!1;hasXref&&-1===xaList.indexOf(xref)&&(xaList.push(xref),newAxis=!0),hasYref&&-1===yaList.indexOf(yref)&&(yaList.push(yref),newAxis=!0),newAxis&&hasXref&&hasYref&&cartesianList.push(xref+yref)}}}}}},{"../../lib":693,"../../registry":825}],753:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Plots=_dereq_("../plots"),Drawing=_dereq_("../../components/drawing"),getModuleCalcData=_dereq_("../get_data").getModuleCalcData,axisIds=_dereq_("./axis_ids"),constants=_dereq_("./constants"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces"),ensureSingle=Lib.ensureSingle;function ensureSingleAndAddDatum(parent,nodeType,className){return Lib.ensureSingle(parent,nodeType,className,function(s){s.datum(className)})}function plotOne(gd,plotinfo,cdSubplot,transitionOpts,makeOnCompleteCallback){for(var _module,cdModuleAndOthers,cdModule,traceLayerClasses=constants.traceLayerClasses,fullLayout=gd._fullLayout,modules=fullLayout._modules,layerData=[],zoomScaleQueryParts=[],i=0;i<modules.length;i++){var name=(_module=modules[i]).name,categories=Registry.modules[name].categories;if(categories.svg){var className=_module.layerName||name+"layer",plotMethod=_module.plot;cdModule=(cdModuleAndOthers=getModuleCalcData(cdSubplot,plotMethod))[0],cdSubplot=cdModuleAndOthers[1],cdModule.length&&layerData.push({i:traceLayerClasses.indexOf(className),className:className,plotMethod:plotMethod,cdModule:cdModule}),categories.zoomScale&&zoomScaleQueryParts.push("."+className)}}layerData.sort(function(a,b){return a.i-b.i});var layers=plotinfo.plot.selectAll("g.mlayer").data(layerData,function(d){return d.className});if(layers.enter().append("g").attr("class",function(d){return d.className}).classed("mlayer",!0),layers.exit().remove(),layers.order(),layers.each(function(d){var sel=d3.select(this),className=d.className;d.plotMethod(gd,plotinfo,d.cdModule,sel,transitionOpts,makeOnCompleteCallback),"scatterlayer"!==className&&"barlayer"!==className&&Drawing.setClipUrl(sel,plotinfo.layerClipId)}),fullLayout._has("scattergl")&&(_module=Registry.getModule("scattergl"),cdModule=getModuleCalcData(cdSubplot,_module)[0],_module.plot(gd,plotinfo,cdModule)),!gd._context.staticPlot&&(plotinfo._hasClipOnAxisFalse&&(plotinfo.clipOnAxisFalseTraces=plotinfo.plot.selectAll(".scatterlayer, .barlayer").selectAll(".trace")),zoomScaleQueryParts.length)){var traces=plotinfo.plot.selectAll(zoomScaleQueryParts.join(",")).selectAll(".trace");plotinfo.zoomScalePts=traces.selectAll("path.point"),plotinfo.zoomScaleTxt=traces.selectAll(".textpoint")}}function makeSubplotLayer(gd,plotinfo){var plotgroup=plotinfo.plotgroup,id=plotinfo.id,xLayer=constants.layerValue2layerClass[plotinfo.xaxis.layer],yLayer=constants.layerValue2layerClass[plotinfo.yaxis.layer],hasOnlyLargeSploms=gd._fullLayout._hasOnlyLargeSploms;if(plotinfo.mainplot){var mainplotinfo=plotinfo.mainplotinfo,mainplotgroup=mainplotinfo.plotgroup,xId=id+"-x",yId=id+"-y";plotinfo.gridlayer=mainplotinfo.gridlayer,plotinfo.zerolinelayer=mainplotinfo.zerolinelayer,ensureSingle(mainplotinfo.overlinesBelow,"path",xId),ensureSingle(mainplotinfo.overlinesBelow,"path",yId),ensureSingle(mainplotinfo.overaxesBelow,"g",xId),ensureSingle(mainplotinfo.overaxesBelow,"g",yId),plotinfo.plot=ensureSingle(mainplotinfo.overplot,"g",id),ensureSingle(mainplotinfo.overlinesAbove,"path",xId),ensureSingle(mainplotinfo.overlinesAbove,"path",yId),ensureSingle(mainplotinfo.overaxesAbove,"g",xId),ensureSingle(mainplotinfo.overaxesAbove,"g",yId),plotinfo.xlines=mainplotgroup.select(".overlines-"+xLayer).select("."+xId),plotinfo.ylines=mainplotgroup.select(".overlines-"+yLayer).select("."+yId),plotinfo.xaxislayer=mainplotgroup.select(".overaxes-"+xLayer).select("."+xId),plotinfo.yaxislayer=mainplotgroup.select(".overaxes-"+yLayer).select("."+yId)}else if(hasOnlyLargeSploms)plotinfo.plot=ensureSingle(plotgroup,"g","plot"),plotinfo.xlines=ensureSingle(plotgroup,"path","xlines-above"),plotinfo.ylines=ensureSingle(plotgroup,"path","ylines-above"),plotinfo.xaxislayer=ensureSingle(plotgroup,"g","xaxislayer-above"),plotinfo.yaxislayer=ensureSingle(plotgroup,"g","yaxislayer-above");else{var backLayer=ensureSingle(plotgroup,"g","layer-subplot");plotinfo.shapelayer=ensureSingle(backLayer,"g","shapelayer"),plotinfo.imagelayer=ensureSingle(backLayer,"g","imagelayer"),plotinfo.gridlayer=ensureSingle(plotgroup,"g","gridlayer"),plotinfo.zerolinelayer=ensureSingle(plotgroup,"g","zerolinelayer"),ensureSingle(plotgroup,"path","xlines-below"),ensureSingle(plotgroup,"path","ylines-below"),plotinfo.overlinesBelow=ensureSingle(plotgroup,"g","overlines-below"),ensureSingle(plotgroup,"g","xaxislayer-below"),ensureSingle(plotgroup,"g","yaxislayer-below"),plotinfo.overaxesBelow=ensureSingle(plotgroup,"g","overaxes-below"),plotinfo.plot=ensureSingle(plotgroup,"g","plot"),plotinfo.overplot=ensureSingle(plotgroup,"g","overplot"),plotinfo.xlines=ensureSingle(plotgroup,"path","xlines-above"),plotinfo.ylines=ensureSingle(plotgroup,"path","ylines-above"),plotinfo.overlinesAbove=ensureSingle(plotgroup,"g","overlines-above"),ensureSingle(plotgroup,"g","xaxislayer-above"),ensureSingle(plotgroup,"g","yaxislayer-above"),plotinfo.overaxesAbove=ensureSingle(plotgroup,"g","overaxes-above"),plotinfo.xlines=plotgroup.select(".xlines-"+xLayer),plotinfo.ylines=plotgroup.select(".ylines-"+yLayer),plotinfo.xaxislayer=plotgroup.select(".xaxislayer-"+xLayer),plotinfo.yaxislayer=plotgroup.select(".yaxislayer-"+yLayer)}hasOnlyLargeSploms||(ensureSingleAndAddDatum(plotinfo.gridlayer,"g",plotinfo.xaxis._id),ensureSingleAndAddDatum(plotinfo.gridlayer,"g",plotinfo.yaxis._id),plotinfo.gridlayer.selectAll("g").map(function(d){return d[0]}).sort(axisIds.idSort)),plotinfo.xlines.style("fill","none").classed("crisp",!0),plotinfo.ylines.style("fill","none").classed("crisp",!0)}function purgeSubplotLayers(layers,fullLayout){if(layers){var overlayIdsToRemove={};for(var k in layers.each(function(d){var id=d[0];d3.select(this).remove(),removeSubplotExtras(id,fullLayout),overlayIdsToRemove[id]=!0}),fullLayout._plots)for(var overlays=fullLayout._plots[k].overlays||[],j=0;j<overlays.length;j++){var overlayInfo=overlays[j];overlayIdsToRemove[overlayInfo.id]&&overlayInfo.plot.selectAll(".trace").remove()}}}function removeSubplotExtras(subplotId,fullLayout){fullLayout._draggers.selectAll("g."+subplotId).remove(),fullLayout._defs.select("#clip"+fullLayout._uid+subplotId+"plot").remove()}exports.name="cartesian",exports.attr=["xaxis","yaxis"],exports.idRoot=["x","y"],exports.idRegex=constants.idRegex,exports.attrRegex=constants.attrRegex,exports.attributes=_dereq_("./attributes"),exports.layoutAttributes=_dereq_("./layout_attributes"),exports.supplyLayoutDefaults=_dereq_("./layout_defaults"),exports.transitionAxes=_dereq_("./transition_axes"),exports.finalizeSubplots=function(layoutIn,layoutOut){var i,xi,yi,subplots=layoutOut._subplots,xList=subplots.xaxis,yList=subplots.yaxis,spSVG=subplots.cartesian,spAll=spSVG.concat(subplots.gl2d||[]),allX={},allY={};for(i=0;i<spAll.length;i++){var parts=spAll[i].split("y");allX[parts[0]]=1,allY["y"+parts[1]]=1}for(i=0;i<xList.length;i++)allX[xi=xList[i]]||(yi=(layoutIn[axisIds.id2name(xi)]||{}).anchor,constants.idRegex.y.test(yi)||(yi="y"),spSVG.push(xi+yi),spAll.push(xi+yi),allY[yi]||(allY[yi]=1,Lib.pushUnique(yList,yi)));for(i=0;i<yList.length;i++)allY[yi=yList[i]]||(xi=(layoutIn[axisIds.id2name(yi)]||{}).anchor,constants.idRegex.x.test(xi)||(xi="x"),spSVG.push(xi+yi),spAll.push(xi+yi),allX[xi]||(allX[xi]=1,Lib.pushUnique(xList,xi)));if(!spAll.length){for(var ki in xi="",yi="",layoutIn){if(constants.attrRegex.test(ki))"x"===ki.charAt(0)?(!xi||+ki.substr(5)<+xi.substr(5))&&(xi=ki):(!yi||+ki.substr(5)<+yi.substr(5))&&(yi=ki)}xi=xi?axisIds.name2id(xi):"x",yi=yi?axisIds.name2id(yi):"y",xList.push(xi),yList.push(yi),spSVG.push(xi+yi)}},exports.plot=function(gd,traces,transitionOpts,makeOnCompleteCallback){var i,fullLayout=gd._fullLayout,subplots=fullLayout._subplots.cartesian,calcdata=gd.calcdata;if(null!==traces){if(!Array.isArray(traces))for(traces=[],i=0;i<calcdata.length;i++)traces.push(i);for(i=0;i<subplots.length;i++){for(var pcd,subplot=subplots[i],subplotInfo=fullLayout._plots[subplot],cdSubplot=[],j=0;j<calcdata.length;j++){var cd=calcdata[j],trace=cd[0].trace;trace.xaxis+trace.yaxis===subplot&&((-1!==traces.indexOf(trace.index)||trace.carpet)&&(pcd&&pcd[0].trace.xaxis+pcd[0].trace.yaxis===subplot&&-1!==["tonextx","tonexty","tonext"].indexOf(trace.fill)&&-1===cdSubplot.indexOf(pcd)&&cdSubplot.push(pcd),cdSubplot.push(cd)),pcd=cd)}plotOne(gd,subplotInfo,cdSubplot,transitionOpts,makeOnCompleteCallback)}}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var plotinfo,i,k,oldPlots=oldFullLayout._plots||{},newPlots=newFullLayout._plots||{},oldSubplotList=oldFullLayout._subplots||{};if(oldFullLayout._hasOnlyLargeSploms&&!newFullLayout._hasOnlyLargeSploms)for(k in oldPlots)(plotinfo=oldPlots[k]).plotgroup&&plotinfo.plotgroup.remove();var hadGl=oldFullLayout._has&&oldFullLayout._has("gl"),hasGl=newFullLayout._has&&newFullLayout._has("gl");if(hadGl&&!hasGl)for(k in oldPlots)(plotinfo=oldPlots[k])._scene&&plotinfo._scene.destroy();if(oldSubplotList.xaxis&&oldSubplotList.yaxis){var oldAxIDs=axisIds.listIds({_fullLayout:oldFullLayout});for(i=0;i<oldAxIDs.length;i++){var oldAxId=oldAxIDs[i];newFullLayout[axisIds.id2name(oldAxId)]||oldFullLayout._infolayer.selectAll(".g-"+oldAxId+"title").remove()}}var hadCartesian=oldFullLayout._has&&oldFullLayout._has("cartesian"),hasCartesian=newFullLayout._has&&newFullLayout._has("cartesian");if(hadCartesian&&!hasCartesian)purgeSubplotLayers(oldFullLayout._cartesianlayer.selectAll(".subplot"),oldFullLayout),oldFullLayout._defs.selectAll(".axesclip").remove(),delete oldFullLayout._axisConstraintGroups;else if(oldSubplotList.cartesian)for(i=0;i<oldSubplotList.cartesian.length;i++){var oldSubplotId=oldSubplotList.cartesian[i];if(!newPlots[oldSubplotId]){var selector="."+oldSubplotId+",."+oldSubplotId+"-x,."+oldSubplotId+"-y";oldFullLayout._cartesianlayer.selectAll(selector).remove(),removeSubplotExtras(oldSubplotId,oldFullLayout)}}},exports.drawFramework=function(gd){var fullLayout=gd._fullLayout,subplotData=function makeSubplotData(gd){var i,j,id,plotinfo,xa,ya,fullLayout=gd._fullLayout,ids=fullLayout._subplots.cartesian,len=ids.length,regulars=[],overlays=[];for(i=0;i<len;i++){id=ids[i],plotinfo=fullLayout._plots[id],xa=plotinfo.xaxis,ya=plotinfo.yaxis;var xa2=xa._mainAxis,ya2=ya._mainAxis,mainplot=xa2._id+ya2._id,mainplotinfo=fullLayout._plots[mainplot];plotinfo.overlays=[],mainplot!==id&&mainplotinfo?(plotinfo.mainplot=mainplot,plotinfo.mainplotinfo=mainplotinfo,overlays.push(id)):(plotinfo.mainplot=void 0,plotinfo.mainPlotinfo=void 0,regulars.push(id))}for(i=0;i<overlays.length;i++)id=overlays[i],(plotinfo=fullLayout._plots[id]).mainplotinfo.overlays.push(plotinfo);var subplotIds=regulars.concat(overlays),subplotData=new Array(len);for(i=0;i<len;i++){id=subplotIds[i],plotinfo=fullLayout._plots[id],xa=plotinfo.xaxis,ya=plotinfo.yaxis;var d=[id,xa.layer,ya.layer,xa.overlaying||"",ya.overlaying||""];for(j=0;j<plotinfo.overlays.length;j++)d.push(plotinfo.overlays[j].id);subplotData[i]=d}return subplotData}(gd),subplotLayers=fullLayout._cartesianlayer.selectAll(".subplot").data(subplotData,String);subplotLayers.enter().append("g").attr("class",function(d){return"subplot "+d[0]}),subplotLayers.order(),subplotLayers.exit().call(purgeSubplotLayers,fullLayout),subplotLayers.each(function(d){var id=d[0],plotinfo=fullLayout._plots[id];plotinfo.plotgroup=d3.select(this),makeSubplotLayer(gd,plotinfo),plotinfo.draglayer=ensureSingle(fullLayout._draggers,"g",id)})},exports.rangePlot=function(gd,plotinfo,cdSubplot){makeSubplotLayer(gd,plotinfo),plotOne(gd,plotinfo,cdSubplot),Plots.style(gd)},exports.toSVG=function(gd){var imageRoot=gd._fullLayout._glimages,root=d3.select(gd).selectAll(".svg-container");root.filter(function(d,i){return i===root.size()-1}).selectAll(".gl-canvas-context, .gl-canvas-focus").each(function canvasToImage(){var imageData=this.toDataURL("image/png");imageRoot.append("svg:image").attr({xmlns:xmlnsNamespaces.svg,"xlink:href":imageData,preserveAspectRatio:"none",x:0,y:0,width:this.width,height:this.height})})},exports.updateFx=_dereq_("./graph_interact").updateFx},{"../../components/drawing":592,"../../constants/xmlns_namespaces":671,"../../lib":693,"../../registry":825,"../get_data":778,"../plots":805,"./attributes":740,"./axis_ids":745,"./constants":747,"./graph_interact":751,"./layout_attributes":754,"./layout_defaults":755,"./transition_axes":764,d3:147}],754:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../font_attributes"),colorAttrs=_dereq_("../../components/color/attributes"),dash=_dereq_("../../components/drawing/attributes").dash,extendFlat=_dereq_("../../lib/extend").extendFlat,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray,constants=_dereq_("./constants");module.exports={visible:{valType:"boolean",editType:"plot"},color:{valType:"color",dflt:colorAttrs.defaultLine,editType:"ticks"},title:{valType:"string",editType:"ticks"},titlefont:fontAttrs({editType:"ticks"}),type:{valType:"enumerated",values:["-","linear","log","date","category"],dflt:"-",editType:"calc",_noTemplating:!0},autorange:{valType:"enumerated",values:[!0,!1,"reversed"],dflt:!0,editType:"axrange",impliedEdits:{"range[0]":void 0,"range[1]":void 0}},rangemode:{valType:"enumerated",values:["normal","tozero","nonnegative"],dflt:"normal",editType:"plot"},range:{valType:"info_array",items:[{valType:"any",editType:"axrange",impliedEdits:{"^autorange":!1}},{valType:"any",editType:"axrange",impliedEdits:{"^autorange":!1}}],editType:"axrange",impliedEdits:{autorange:!1}},fixedrange:{valType:"boolean",dflt:!1,editType:"calc"},scaleanchor:{valType:"enumerated",values:[constants.idRegex.x.toString(),constants.idRegex.y.toString()],editType:"plot"},scaleratio:{valType:"number",min:0,dflt:1,editType:"plot"},constrain:{valType:"enumerated",values:["range","domain"],dflt:"range",editType:"plot"},constraintoward:{valType:"enumerated",values:["left","center","right","top","middle","bottom"],editType:"plot"},tickmode:{valType:"enumerated",values:["auto","linear","array"],editType:"ticks",impliedEdits:{tick0:void 0,dtick:void 0}},nticks:{valType:"integer",min:0,dflt:0,editType:"ticks"},tick0:{valType:"any",editType:"ticks",impliedEdits:{tickmode:"linear"}},dtick:{valType:"any",editType:"ticks",impliedEdits:{tickmode:"linear"}},tickvals:{valType:"data_array",editType:"ticks"},ticktext:{valType:"data_array",editType:"ticks"},ticks:{valType:"enumerated",values:["outside","inside",""],editType:"ticks"},mirror:{valType:"enumerated",values:[!0,"ticks",!1,"all","allticks"],dflt:!1,editType:"ticks+layoutstyle"},ticklen:{valType:"number",min:0,dflt:5,editType:"ticks"},tickwidth:{valType:"number",min:0,dflt:1,editType:"ticks"},tickcolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"ticks"},showticklabels:{valType:"boolean",dflt:!0,editType:"ticks"},automargin:{valType:"boolean",dflt:!1,editType:"ticks"},showspikes:{valType:"boolean",dflt:!1,editType:"modebar"},spikecolor:{valType:"color",dflt:null,editType:"none"},spikethickness:{valType:"number",dflt:3,editType:"none"},spikedash:extendFlat({},dash,{dflt:"dash",editType:"none"}),spikemode:{valType:"flaglist",flags:["toaxis","across","marker"],dflt:"toaxis",editType:"none"},spikesnap:{valType:"enumerated",values:["data","cursor"],dflt:"data",editType:"none"},tickfont:fontAttrs({editType:"ticks"}),tickangle:{valType:"angle",dflt:"auto",editType:"ticks"},tickprefix:{valType:"string",dflt:"",editType:"ticks"},showtickprefix:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"ticks"},ticksuffix:{valType:"string",dflt:"",editType:"ticks"},showticksuffix:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"ticks"},showexponent:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"ticks"},exponentformat:{valType:"enumerated",values:["none","e","E","power","SI","B"],dflt:"B",editType:"ticks"},separatethousands:{valType:"boolean",dflt:!1,editType:"ticks"},tickformat:{valType:"string",dflt:"",editType:"ticks"},tickformatstops:templatedArray("tickformatstop",{enabled:{valType:"boolean",dflt:!0,editType:"ticks"},dtickrange:{valType:"info_array",items:[{valType:"any",editType:"ticks"},{valType:"any",editType:"ticks"}],editType:"ticks"},value:{valType:"string",dflt:"",editType:"ticks"},editType:"ticks"}),hoverformat:{valType:"string",dflt:"",editType:"none"},showline:{valType:"boolean",dflt:!1,editType:"ticks+layoutstyle"},linecolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"layoutstyle"},linewidth:{valType:"number",min:0,dflt:1,editType:"ticks+layoutstyle"},showgrid:{valType:"boolean",editType:"ticks"},gridcolor:{valType:"color",dflt:colorAttrs.lightLine,editType:"ticks"},gridwidth:{valType:"number",min:0,dflt:1,editType:"ticks"},zeroline:{valType:"boolean",editType:"ticks"},zerolinecolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"ticks"},zerolinewidth:{valType:"number",dflt:1,editType:"ticks"},anchor:{valType:"enumerated",values:["free",constants.idRegex.x.toString(),constants.idRegex.y.toString()],editType:"plot"},side:{valType:"enumerated",values:["top","bottom","left","right"],editType:"plot"},overlaying:{valType:"enumerated",values:["free",constants.idRegex.x.toString(),constants.idRegex.y.toString()],editType:"plot"},layer:{valType:"enumerated",values:["above traces","below traces"],dflt:"above traces",editType:"plot"},domain:{valType:"info_array",items:[{valType:"number",min:0,max:1,editType:"plot"},{valType:"number",min:0,max:1,editType:"plot"}],dflt:[0,1],editType:"plot"},position:{valType:"number",min:0,max:1,dflt:0,editType:"plot"},categoryorder:{valType:"enumerated",values:["trace","category ascending","category descending","array"],dflt:"trace",editType:"calc"},categoryarray:{valType:"data_array",editType:"calc"},editType:"calc",_deprecated:{autotick:{valType:"boolean",editType:"ticks"}}}},{"../../components/color/attributes":566,"../../components/drawing/attributes":591,"../../lib/extend":682,"../../plot_api/plot_template":732,"../font_attributes":768,"./constants":747}],755:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),Template=_dereq_("../../plot_api/plot_template"),basePlotLayoutAttributes=_dereq_("../layout_attributes"),layoutAttributes=_dereq_("./layout_attributes"),handleTypeDefaults=_dereq_("./type_defaults"),handleAxisDefaults=_dereq_("./axis_defaults"),handleConstraintDefaults=_dereq_("./constraint_defaults"),handlePositionDefaults=_dereq_("./position_defaults"),axisIds=_dereq_("./axis_ids"),id2name=axisIds.id2name,name2id=axisIds.name2id,Registry=_dereq_("../../registry"),traceIs=Registry.traceIs,getComponentMethod=Registry.getComponentMethod;function appendList(cont,k,item){Array.isArray(cont[k])?cont[k].push(item):cont[k]=[item]}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){var i,j,ax2traces={},xaCheater={},xaNonCheater={},outerTicks={},noGrids={};for(i=0;i<fullData.length;i++){var trace=fullData[i];if(traceIs(trace,"cartesian")||traceIs(trace,"gl2d")){var xaName,yaName;if(trace.xaxis)appendList(ax2traces,xaName=id2name(trace.xaxis),trace);else if(trace.xaxes)for(j=0;j<trace.xaxes.length;j++)appendList(ax2traces,id2name(trace.xaxes[j]),trace);if(trace.yaxis)appendList(ax2traces,yaName=id2name(trace.yaxis),trace);else if(trace.yaxes)for(j=0;j<trace.yaxes.length;j++)appendList(ax2traces,id2name(trace.yaxes[j]),trace);if(traceIs(trace,"carpet")&&("carpet"!==trace.type||trace._cheater)||xaName&&(xaNonCheater[xaName]=1),"carpet"===trace.type&&trace._cheater&&xaName&&(xaCheater[xaName]=1),traceIs(trace,"2dMap")&&(outerTicks[xaName]=1,outerTicks[yaName]=1),traceIs(trace,"oriented"))noGrids["h"===trace.orientation?yaName:xaName]=1}}var subplots=layoutOut._subplots,xIds=subplots.xaxis,yIds=subplots.yaxis,xNames=Lib.simpleMap(xIds,id2name),yNames=Lib.simpleMap(yIds,id2name),axNames=xNames.concat(yNames),plot_bgcolor=Color.background;xIds.length&&yIds.length&&(plot_bgcolor=Lib.coerce(layoutIn,layoutOut,basePlotLayoutAttributes,"plot_bgcolor"));var axName,axLetter,axLayoutIn,axLayoutOut,bgColor=Color.combine(plot_bgcolor,layoutOut.paper_bgcolor);function coerce(attr,dflt){return Lib.coerce(axLayoutIn,axLayoutOut,layoutAttributes,attr,dflt)}function coerce2(attr,dflt){return Lib.coerce2(axLayoutIn,axLayoutOut,layoutAttributes,attr,dflt)}function getCounterAxes(axLetter){return"x"===axLetter?yIds:xIds}var counterAxes={x:getCounterAxes("x"),y:getCounterAxes("y")};function getOverlayableAxes(axLetter,axName){for(var list="x"===axLetter?xNames:yNames,out=[],j=0;j<list.length;j++){var axName2=list[j];axName2===axName||(layoutIn[axName2]||{}).overlaying||out.push(name2id(axName2))}return out}for(i=0;i<axNames.length;i++){axLetter=(axName=axNames[i]).charAt(0),Lib.isPlainObject(layoutIn[axName])||(layoutIn[axName]={}),axLayoutIn=layoutIn[axName],axLayoutOut=Template.newContainer(layoutOut,axName,axLetter+"axis");var traces=ax2traces[axName]||[];axLayoutOut._traceIndices=traces.map(function(t){return t._expandedIndex}),axLayoutOut._annIndices=[],axLayoutOut._shapeIndices=[],axLayoutOut._name=axName;var id=axLayoutOut._id=name2id(axName),overlayableAxes=getOverlayableAxes(axLetter,axName),defaultOptions={letter:axLetter,font:layoutOut.font,outerTicks:outerTicks[axName],showGrid:!noGrids[axName],data:traces,bgColor:bgColor,calendar:layoutOut.calendar,automargin:!0,cheateronly:"x"===axLetter&&xaCheater[axName]&&!xaNonCheater[axName],splomStash:((layoutOut._splomAxes||{})[axLetter]||{})[id]};handleTypeDefaults(axLayoutIn,axLayoutOut,coerce,defaultOptions),handleAxisDefaults(axLayoutIn,axLayoutOut,coerce,defaultOptions,layoutOut);var spikecolor=coerce2("spikecolor"),spikethickness=coerce2("spikethickness"),spikedash=coerce2("spikedash"),spikemode=coerce2("spikemode"),spikesnap=coerce2("spikesnap");coerce("showspikes",!!(spikecolor||spikethickness||spikedash||spikemode||spikesnap))||(delete axLayoutOut.spikecolor,delete axLayoutOut.spikethickness,delete axLayoutOut.spikedash,delete axLayoutOut.spikemode,delete axLayoutOut.spikesnap);var positioningOptions={letter:axLetter,counterAxes:counterAxes[axLetter],overlayableAxes:overlayableAxes,grid:layoutOut.grid};handlePositionDefaults(axLayoutIn,axLayoutOut,coerce,positioningOptions),axLayoutOut._input=axLayoutIn}var rangeSliderDefaults=getComponentMethod("rangeslider","handleDefaults"),rangeSelectorDefaults=getComponentMethod("rangeselector","handleDefaults");for(i=0;i<xNames.length;i++)axName=xNames[i],axLayoutIn=layoutIn[axName],axLayoutOut=layoutOut[axName],rangeSliderDefaults(layoutIn,layoutOut,axName),"date"===axLayoutOut.type&&rangeSelectorDefaults(axLayoutIn,axLayoutOut,layoutOut,yNames,axLayoutOut.calendar),coerce("fixedrange");for(i=0;i<yNames.length;i++){axName=yNames[i],axLayoutIn=layoutIn[axName],axLayoutOut=layoutOut[axName];var anchoredAxis=layoutOut[id2name(axLayoutOut.anchor)];coerce("fixedrange",anchoredAxis&&anchoredAxis.rangeslider&&anchoredAxis.rangeslider.visible)}layoutOut._axisConstraintGroups=[];var allAxisIds=counterAxes.x.concat(counterAxes.y);for(i=0;i<axNames.length;i++)axLetter=(axName=axNames[i]).charAt(0),axLayoutIn=layoutIn[axName],axLayoutOut=layoutOut[axName],handleConstraintDefaults(axLayoutIn,axLayoutOut,coerce,allAxisIds,layoutOut)}},{"../../components/color":567,"../../lib":693,"../../plot_api/plot_template":732,"../../registry":825,"../layout_attributes":796,"./axis_defaults":744,"./axis_ids":745,"./constraint_defaults":748,"./layout_attributes":754,"./position_defaults":757,"./type_defaults":765}],756:[function(_dereq_,module,exports){"use strict";var colorMix=_dereq_("tinycolor2").mix,lightFraction=_dereq_("../../components/color/attributes").lightFraction,Lib=_dereq_("../../lib");module.exports=function handleLineGridDefaults(containerIn,containerOut,coerce,opts){var dfltColor=(opts=opts||{}).dfltColor;function coerce2(attr,dflt){return Lib.coerce2(containerIn,containerOut,opts.attributes,attr,dflt)}var lineColor=coerce2("linecolor",dfltColor),lineWidth=coerce2("linewidth");coerce("showline",opts.showLine||!!lineColor||!!lineWidth)||(delete containerOut.linecolor,delete containerOut.linewidth);var gridColor=coerce2("gridcolor",colorMix(dfltColor,opts.bgColor,opts.blend||lightFraction).toRgbString()),gridWidth=coerce2("gridwidth");if(coerce("showgrid",opts.showGrid||!!gridColor||!!gridWidth)||(delete containerOut.gridcolor,delete containerOut.gridwidth),!opts.noZeroLine){var zeroLineColor=coerce2("zerolinecolor",dfltColor),zeroLineWidth=coerce2("zerolinewidth");coerce("zeroline",opts.showGrid||!!zeroLineColor||!!zeroLineWidth)||(delete containerOut.zerolinecolor,delete containerOut.zerolinewidth)}}},{"../../components/color/attributes":566,"../../lib":693,tinycolor2:511}],757:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib");module.exports=function handlePositionDefaults(containerIn,containerOut,coerce,options){var dfltAnchor,dfltDomain,dfltSide,dfltPosition,counterAxes=options.counterAxes||[],overlayableAxes=options.overlayableAxes||[],letter=options.letter,grid=options.grid;grid&&(dfltDomain=grid._domains[letter][grid._axisMap[containerOut._id]],dfltAnchor=grid._anchors[containerOut._id],dfltDomain&&(dfltSide=grid[letter+"side"].split(" ")[0],dfltPosition=grid.domain[letter]["right"===dfltSide||"top"===dfltSide?1:0])),dfltDomain=dfltDomain||[0,1],dfltAnchor=dfltAnchor||(isNumeric(containerIn.position)?"free":counterAxes[0]||"free"),dfltSide=dfltSide||("x"===letter?"bottom":"left"),dfltPosition=dfltPosition||0,"free"===Lib.coerce(containerIn,containerOut,{anchor:{valType:"enumerated",values:["free"].concat(counterAxes),dflt:dfltAnchor}},"anchor")&&coerce("position",dfltPosition),Lib.coerce(containerIn,containerOut,{side:{valType:"enumerated",values:"x"===letter?["bottom","top"]:["left","right"],dflt:dfltSide}},"side");var overlaying=!1;if(overlayableAxes.length&&(overlaying=Lib.coerce(containerIn,containerOut,{overlaying:{valType:"enumerated",values:[!1].concat(overlayableAxes),dflt:!1}},"overlaying")),!overlaying){var domain=coerce("domain",dfltDomain);domain[0]>domain[1]-.01&&(containerOut.domain=dfltDomain),Lib.noneOrAll(containerIn.domain,containerOut.domain,dfltDomain)}return coerce("layer"),containerOut}},{"../../lib":693,"fast-isnumeric":213}],758:[function(_dereq_,module,exports){"use strict";var FROM_BL=_dereq_("../../constants/alignment").FROM_BL;module.exports=function scaleZoom(ax,factor,centerFraction){void 0===centerFraction&&(centerFraction=FROM_BL[ax.constraintoward||"center"]);var rangeLinear=[ax.r2l(ax.range[0]),ax.r2l(ax.range[1])],center=rangeLinear[0]+(rangeLinear[1]-rangeLinear[0])*centerFraction;ax.range=ax._input.range=[ax.l2r(center+(rangeLinear[0]-center)*factor),ax.l2r(center+(rangeLinear[1]-center)*factor)]}},{"../../constants/alignment":665}],759:[function(_dereq_,module,exports){"use strict";var polybool=_dereq_("polybooljs"),Registry=_dereq_("../../registry"),Color=_dereq_("../../components/color"),Fx=_dereq_("../../components/fx"),polygon=_dereq_("../../lib/polygon"),throttle=_dereq_("../../lib/throttle"),makeEventData=_dereq_("../../components/fx/helpers").makeEventData,getFromId=_dereq_("./axis_ids").getFromId,sortModules=_dereq_("../sort_modules").sortModules,constants=_dereq_("./constants"),MINSELECT=constants.MINSELECT,filteredPolygon=polygon.filter,polygonTester=polygon.tester;function getAxId(ax){return ax._id}function selectOnClick(evt,gd,xAxes,yAxes,subplot,dragOptions,polygonOutlines){var searchTraces,searchInfo,currentSelectionDef,selectionTester,thisTracesSelection,pointOrBinSelected,subtract,eventData,i,hoverData=gd._hoverdata,sendEvents=gd._fullLayout.clickmode.indexOf("event")>-1,selection=[];if(function isHoverDataSet(hoverData){return hoverData&&Array.isArray(hoverData)&&!0!==hoverData[0].hoverOnBox}(hoverData)){coerceSelectionsCache(evt,gd,dragOptions);var clickedPtInfo=function extractClickedPtInfo(hoverData,searchTraces){var searchInfo,i,hoverDatum=hoverData[0],pointNumber=-1,pointNumbers=[];for(i=0;i<searchTraces.length;i++)if(searchInfo=searchTraces[i],hoverDatum.fullData._expandedIndex===searchInfo.cd[0].trace._expandedIndex){if(!0===hoverDatum.hoverOnBox)break;void 0!==hoverDatum.pointNumber?pointNumber=hoverDatum.pointNumber:void 0!==hoverDatum.binNumber&&(pointNumber=hoverDatum.binNumber,pointNumbers=hoverDatum.pointNumbers);break}return{pointNumber:pointNumber,pointNumbers:pointNumbers,searchInfo:searchInfo}}(hoverData,searchTraces=determineSearchTraces(gd,xAxes,yAxes,subplot));if(clickedPtInfo.pointNumbers.length>0?function isOnlyThisBinSelected(searchTraces,clickedPtInfo){var searchInfo,trace,i,tracesWithSelectedPts=[];for(i=0;i<searchTraces.length;i++)(searchInfo=searchTraces[i]).cd[0].trace.selectedpoints&&searchInfo.cd[0].trace.selectedpoints.length>0&&tracesWithSelectedPts.push(searchInfo);if(1===tracesWithSelectedPts.length&&tracesWithSelectedPts[0]===clickedPtInfo.searchInfo&&(trace=clickedPtInfo.searchInfo.cd[0].trace).selectedpoints.length===clickedPtInfo.pointNumbers.length){for(i=0;i<clickedPtInfo.pointNumbers.length;i++)if(trace.selectedpoints.indexOf(clickedPtInfo.pointNumbers[i])<0)return!1;return!0}return!1}(searchTraces,clickedPtInfo):function isOnlyOnePointSelected(searchTraces){var searchInfo,trace,i,len=0;for(i=0;i<searchTraces.length;i++)if(searchInfo=searchTraces[i],(trace=searchInfo.cd[0].trace).selectedpoints){if(trace.selectedpoints.length>1)return!1;if((len+=trace.selectedpoints.length)>1)return!1}return 1===len}(searchTraces)&&(pointOrBinSelected=isPointOrBinSelected(clickedPtInfo))){for(polygonOutlines&&polygonOutlines.remove(),i=0;i<searchTraces.length;i++)(searchInfo=searchTraces[i])._module.selectPoints(searchInfo,!1);updateSelectedState(gd,searchTraces),clearSelectionsCache(dragOptions),sendEvents&&gd.emit("plotly_deselect",null)}else{for(subtract=evt.shiftKey&&(void 0!==pointOrBinSelected?pointOrBinSelected:isPointOrBinSelected(clickedPtInfo)),currentSelectionDef=function newPointSelectionDef(pointNumber,searchInfo,subtract){return{pointNumber:pointNumber,searchInfo:searchInfo,subtract:subtract}}(clickedPtInfo.pointNumber,clickedPtInfo.searchInfo,subtract),selectionTester=multiTester(dragOptions.selectionDefs.concat([currentSelectionDef])),i=0;i<searchTraces.length;i++)if(thisTracesSelection=fillSelectionItem(searchTraces[i]._module.selectPoints(searchTraces[i],selectionTester),searchTraces[i]),selection.length)for(var j=0;j<thisTracesSelection.length;j++)selection.push(thisTracesSelection[j]);else selection=thisTracesSelection;updateSelectedState(gd,searchTraces,eventData={points:selection}),currentSelectionDef&&dragOptions&&dragOptions.selectionDefs.push(currentSelectionDef),polygonOutlines&&drawSelection(dragOptions.mergedPolygons,polygonOutlines),sendEvents&&gd.emit("plotly_selected",eventData)}}}function isPointSelectionDef(o){return"pointNumber"in o&&"searchInfo"in o}function newPointNumTester(pointSelectionDef){return{xmin:0,xmax:0,ymin:0,ymax:0,pts:[],contains:function(pt,omitFirstEdge,pointNumber,searchInfo){var idxWantedTrace=pointSelectionDef.searchInfo.cd[0].trace._expandedIndex;return searchInfo.cd[0].trace._expandedIndex===idxWantedTrace&&pointNumber===pointSelectionDef.pointNumber},isRect:!1,degenerate:!1,subtract:pointSelectionDef.subtract}}function multiTester(list){for(var testers=[],xmin=isPointSelectionDef(list[0])?0:list[0][0][0],xmax=xmin,ymin=isPointSelectionDef(list[0])?0:list[0][0][1],ymax=ymin,i=0;i<list.length;i++)if(isPointSelectionDef(list[i]))testers.push(newPointNumTester(list[i]));else{var tester=polygon.tester(list[i]);tester.subtract=list[i].subtract,testers.push(tester),xmin=Math.min(xmin,tester.xmin),xmax=Math.max(xmax,tester.xmax),ymin=Math.min(ymin,tester.ymin),ymax=Math.max(ymax,tester.ymax)}return{xmin:xmin,xmax:xmax,ymin:ymin,ymax:ymax,pts:[],contains:function contains(pt,arg,pointNumber,searchInfo){for(var contained=!1,i=0;i<testers.length;i++)testers[i].contains(pt,arg,pointNumber,searchInfo)&&(contained=!1===testers[i].subtract);return contained},isRect:!1,degenerate:!1}}function coerceSelectionsCache(evt,gd,dragOptions){var fullLayout=gd._fullLayout,zoomLayer=fullLayout._zoomlayer,plotinfo=dragOptions.plotinfo,selectingOnSameSubplot=fullLayout._lastSelectedSubplot&&fullLayout._lastSelectedSubplot===plotinfo.id,hasModifierKey=evt.shiftKey||evt.altKey;selectingOnSameSubplot&&hasModifierKey&&plotinfo.selection&&plotinfo.selection.selectionDefs&&!dragOptions.selectionDefs?(dragOptions.selectionDefs=plotinfo.selection.selectionDefs,dragOptions.mergedPolygons=plotinfo.selection.mergedPolygons):hasModifierKey&&plotinfo.selection||clearSelectionsCache(dragOptions),selectingOnSameSubplot||(clearSelect(zoomLayer),fullLayout._lastSelectedSubplot=plotinfo.id)}function clearSelectionsCache(dragOptions){var plotinfo=dragOptions.plotinfo;plotinfo.selection={},plotinfo.selection.selectionDefs=dragOptions.selectionDefs=[],plotinfo.selection.mergedPolygons=dragOptions.mergedPolygons=[]}function determineSearchTraces(gd,xAxes,yAxes,subplot){var cd,trace,i,searchTraces=[],xAxisIds=xAxes.map(getAxId),yAxisIds=yAxes.map(getAxId);for(i=0;i<gd.calcdata.length;i++)if(!0===(trace=(cd=gd.calcdata[i])[0].trace).visible&&trace._module&&trace._module.selectPoints)if(!subplot||trace.subplot!==subplot&&trace.geo!==subplot)if("splom"===trace.type&&trace._xaxes[xAxisIds[0]]&&trace._yaxes[yAxisIds[0]])searchTraces.push(createSearchInfo(trace._module,cd,xAxes[0],yAxes[0]));else{if(-1===xAxisIds.indexOf(trace.xaxis))continue;if(-1===yAxisIds.indexOf(trace.yaxis))continue;searchTraces.push(createSearchInfo(trace._module,cd,getFromId(gd,trace.xaxis),getFromId(gd,trace.yaxis)))}else searchTraces.push(createSearchInfo(trace._module,cd,xAxes[0],yAxes[0]));return searchTraces;function createSearchInfo(module,calcData,xaxis,yaxis){return{_module:module,cd:calcData,xaxis:xaxis,yaxis:yaxis}}}function drawSelection(polygons,outlines){var i,d,paths=[];for(i=0;i<polygons.length;i++){var ppts=polygons[i];paths.push(ppts.join("L")+"L"+ppts[0])}d=polygons.length>0?"M"+paths.join("M")+"Z":"M0,0Z",outlines.attr("d",d)}function isPointOrBinSelected(clickedPtInfo){var trace=clickedPtInfo.searchInfo.cd[0].trace,ptNum=clickedPtInfo.pointNumber,ptNums=clickedPtInfo.pointNumbers,ptNumToTest=ptNums.length>0?ptNums[0]:ptNum;return!!trace.selectedpoints&&trace.selectedpoints.indexOf(ptNumToTest)>-1}function updateSelectedState(gd,searchTraces,eventData){var i,j,searchInfo,trace;if(eventData){var pts=eventData.points||[];for(i=0;i<searchTraces.length;i++)(trace=searchTraces[i].cd[0].trace).selectedpoints=[],trace._input.selectedpoints=[];for(i=0;i<pts.length;i++){var pt=pts[i],data=pt.data,fullData=pt.fullData;pt.pointIndices?([].push.apply(data.selectedpoints,pt.pointIndices),[].push.apply(fullData.selectedpoints,pt.pointIndices)):(data.selectedpoints.push(pt.pointIndex),fullData.selectedpoints.push(pt.pointIndex))}}else for(i=0;i<searchTraces.length;i++)delete(trace=searchTraces[i].cd[0].trace).selectedpoints,delete trace._input.selectedpoints;var lookup={};for(i=0;i<searchTraces.length;i++){var name=(searchInfo=searchTraces[i])._module.name;lookup[name]?lookup[name].push(searchInfo):lookup[name]=[searchInfo]}var keys=Object.keys(lookup).sort(sortModules);for(i=0;i<keys.length;i++){var items=lookup[keys[i]],len=items.length,item0=items[0],trace0=item0.cd[0].trace,_module=item0._module,styleSelection=_module.styleOnSelect||_module.style;if(Registry.traceIs(trace0,"regl")){var cds=new Array(len);for(j=0;j<len;j++)cds[j]=items[j].cd;styleSelection(gd,cds)}else for(j=0;j<len;j++)styleSelection(gd,items[j].cd)}}function fillSelectionItem(selection,searchInfo){if(Array.isArray(selection))for(var cd=searchInfo.cd,trace=searchInfo.cd[0].trace,i=0;i<selection.length;i++)selection[i]=makeEventData(selection[i],trace,cd);return selection}function clearSelect(zoomlayer){zoomlayer.selectAll(".select-outline").remove()}module.exports={prepSelect:function prepSelect(e,startX,startY,dragOptions,mode){var filterPoly,selectionTester,mergedPolygons,currentPolygon,i,searchInfo,eventData,gd=dragOptions.gd,fullLayout=gd._fullLayout,zoomLayer=fullLayout._zoomlayer,dragBBox=dragOptions.element.getBoundingClientRect(),plotinfo=dragOptions.plotinfo,xs=plotinfo.xaxis._offset,ys=plotinfo.yaxis._offset,x0=startX-dragBBox.left,y0=startY-dragBBox.top,x1=x0,y1=y0,path0="M"+x0+","+y0,pw=dragOptions.xaxes[0]._length,ph=dragOptions.yaxes[0]._length,allAxes=dragOptions.xaxes.concat(dragOptions.yaxes),subtract=e.altKey;coerceSelectionsCache(e,gd,dragOptions),"lasso"===mode&&(filterPoly=filteredPolygon([[x0,y0]],constants.BENDPX));var outlines=zoomLayer.selectAll("path.select-outline-"+plotinfo.id).data([1,2]);outlines.enter().append("path").attr("class",function(d){return"select-outline select-outline-"+d+" select-outline-"+plotinfo.id}).attr("transform","translate("+xs+", "+ys+")").attr("d",path0+"Z");var fillRangeItems,corners=zoomLayer.append("path").attr("class","zoombox-corners").style({fill:Color.background,stroke:Color.defaultLine,"stroke-width":1}).attr("transform","translate("+xs+", "+ys+")").attr("d","M0,0Z"),throttleID=fullLayout._uid+constants.SELECTID,selection=[],searchTraces=determineSearchTraces(gd,dragOptions.xaxes,dragOptions.yaxes,dragOptions.subplot);function axValue(ax){var index="y"===ax._id.charAt(0)?1:0;return function(v){return ax.p2d(v[index])}}function ascending(a,b){return a-b}fillRangeItems=plotinfo.fillRangeItems?plotinfo.fillRangeItems:"select"===mode?function(eventData,poly){var ranges=eventData.range={};for(i=0;i<allAxes.length;i++){var ax=allAxes[i],axLetter=ax._id.charAt(0);ranges[ax._id]=[ax.p2d(poly[axLetter+"min"]),ax.p2d(poly[axLetter+"max"])].sort(ascending)}}:function(eventData,poly,filterPoly){var dataPts=eventData.lassoPoints={};for(i=0;i<allAxes.length;i++){var ax=allAxes[i];dataPts[ax._id]=filterPoly.filtered.map(axValue(ax))}},dragOptions.moveFn=function(dx0,dy0){x1=Math.max(0,Math.min(pw,dx0+x0)),y1=Math.max(0,Math.min(ph,dy0+y0));var dx=Math.abs(x1-x0),dy=Math.abs(y1-y0);if("select"===mode){var direction=fullLayout.selectdirection;"h"===(direction="any"===fullLayout.selectdirection?dy<Math.min(.6*dx,MINSELECT)?"h":dx<Math.min(.6*dy,MINSELECT)?"v":"d":fullLayout.selectdirection)?((currentPolygon=[[x0,0],[x0,ph],[x1,ph],[x1,0]]).xmin=Math.min(x0,x1),currentPolygon.xmax=Math.max(x0,x1),currentPolygon.ymin=Math.min(0,ph),currentPolygon.ymax=Math.max(0,ph),corners.attr("d","M"+currentPolygon.xmin+","+(y0-MINSELECT)+"h-4v"+2*MINSELECT+"h4ZM"+(currentPolygon.xmax-1)+","+(y0-MINSELECT)+"h4v"+2*MINSELECT+"h-4Z")):"v"===direction?((currentPolygon=[[0,y0],[0,y1],[pw,y1],[pw,y0]]).xmin=Math.min(0,pw),currentPolygon.xmax=Math.max(0,pw),currentPolygon.ymin=Math.min(y0,y1),currentPolygon.ymax=Math.max(y0,y1),corners.attr("d","M"+(x0-MINSELECT)+","+currentPolygon.ymin+"v-4h"+2*MINSELECT+"v4ZM"+(x0-MINSELECT)+","+(currentPolygon.ymax-1)+"v4h"+2*MINSELECT+"v-4Z")):"d"===direction&&((currentPolygon=[[x0,y0],[x0,y1],[x1,y1],[x1,y0]]).xmin=Math.min(x0,x1),currentPolygon.xmax=Math.max(x0,x1),currentPolygon.ymin=Math.min(y0,y1),currentPolygon.ymax=Math.max(y0,y1),corners.attr("d","M0,0Z"))}else"lasso"===mode&&(filterPoly.addPt([x1,y1]),currentPolygon=filterPoly.filtered);dragOptions.selectionDefs&&dragOptions.selectionDefs.length?(mergedPolygons=function mergePolygons(list,poly,subtract){return subtract?polybool.difference({regions:list,inverted:!1},{regions:[poly],inverted:!1}).regions:polybool.union({regions:list,inverted:!1},{regions:[poly],inverted:!1}).regions}(dragOptions.mergedPolygons,currentPolygon,subtract),currentPolygon.subtract=subtract,selectionTester=multiTester(dragOptions.selectionDefs.concat([currentPolygon]))):(mergedPolygons=[currentPolygon],selectionTester=polygonTester(currentPolygon)),drawSelection(mergedPolygons,outlines),throttle.throttle(throttleID,constants.SELECTDELAY,function(){selection=[];var thisSelection,traceSelection,traceSelections=[];for(i=0;i<searchTraces.length;i++)if(traceSelection=(searchInfo=searchTraces[i])._module.selectPoints(searchInfo,selectionTester),traceSelections.push(traceSelection),thisSelection=fillSelectionItem(traceSelection,searchInfo),selection.length)for(var j=0;j<thisSelection.length;j++)selection.push(thisSelection[j]);else selection=thisSelection;updateSelectedState(gd,searchTraces,eventData={points:selection}),fillRangeItems(eventData,currentPolygon,filterPoly),dragOptions.gd.emit("plotly_selecting",eventData)})},dragOptions.clickFn=function(numClicks,evt){var clickmode=fullLayout.clickmode;corners.remove(),throttle.done(throttleID).then(function(){if(throttle.clear(throttleID),2===numClicks){for(outlines.remove(),i=0;i<searchTraces.length;i++)(searchInfo=searchTraces[i])._module.selectPoints(searchInfo,!1);updateSelectedState(gd,searchTraces),clearSelectionsCache(dragOptions),gd.emit("plotly_deselect",null)}else clickmode.indexOf("select")>-1&&selectOnClick(evt,gd,dragOptions.xaxes,dragOptions.yaxes,dragOptions.subplot,dragOptions,outlines),"event"===clickmode&&gd.emit("plotly_selected",void 0);Fx.click(gd,evt)})},dragOptions.doneFn=function(){corners.remove(),throttle.done(throttleID).then(function(){throttle.clear(throttleID),dragOptions.gd.emit("plotly_selected",eventData),currentPolygon&&dragOptions.selectionDefs&&(currentPolygon.subtract=subtract,dragOptions.selectionDefs.push(currentPolygon),dragOptions.mergedPolygons.length=0,[].push.apply(dragOptions.mergedPolygons,mergedPolygons))})}},clearSelect:clearSelect,selectOnClick:selectOnClick}},{"../../components/color":567,"../../components/fx":609,"../../components/fx/helpers":606,"../../lib/polygon":706,"../../lib/throttle":719,"../../registry":825,"../sort_modules":819,"./axis_ids":745,"./constants":747,polybooljs:453}],760:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),cleanNumber=Lib.cleanNumber,ms2DateTime=Lib.ms2DateTime,dateTime2ms=Lib.dateTime2ms,ensureNumber=Lib.ensureNumber,numConstants=_dereq_("../../constants/numerical"),FP_SAFE=numConstants.FP_SAFE,BADNUM=numConstants.BADNUM,LOG_CLIP=numConstants.LOG_CLIP,constants=_dereq_("./constants"),axisIds=_dereq_("./axis_ids");function fromLog(v){return Math.pow(10,v)}module.exports=function setConvert(ax,fullLayout){fullLayout=fullLayout||{};var axLetter=(ax._id||"x").charAt(0);function toLog(v,clip){if(v>0)return Math.log(v)/Math.LN10;if(v<=0&&clip&&ax.range&&2===ax.range.length){var r0=ax.range[0],r1=ax.range[1];return.5*(r0+r1-2*LOG_CLIP*Math.abs(r0-r1))}return BADNUM}function dt2ms(v,_,calendar){var ms=dateTime2ms(v,calendar||ax.calendar);if(ms===BADNUM){if(!isNumeric(v))return BADNUM;v=+v;var msecTenths=Math.floor(10*Lib.mod(v+.05,1)),msRounded=Math.round(v-msecTenths/10);ms=dateTime2ms(new Date(msRounded))+msecTenths/10}return ms}function ms2dt(v,r,calendar){return ms2DateTime(v,r,calendar||ax.calendar)}function getCategoryName(v){return ax._categories[Math.round(v)]}function getCategoryIndex(v){if(ax._categoriesMap){var index=ax._categoriesMap[v];if(void 0!==index)return index}if(isNumeric(v))return+v}function l2p(v){return isNumeric(v)?d3.round(ax._b+ax._m*v,2):BADNUM}function p2l(px){return(px-ax._b)/ax._m}ax.c2l="log"===ax.type?toLog:ensureNumber,ax.l2c="log"===ax.type?fromLog:ensureNumber,ax.l2p=l2p,ax.p2l=p2l,ax.c2p="log"===ax.type?function(v,clip){return l2p(toLog(v,clip))}:l2p,ax.p2c="log"===ax.type?function(px){return fromLog(p2l(px))}:p2l,-1!==["linear","-"].indexOf(ax.type)?(ax.d2r=ax.r2d=ax.d2c=ax.r2c=ax.d2l=ax.r2l=cleanNumber,ax.c2d=ax.c2r=ax.l2d=ax.l2r=ensureNumber,ax.d2p=ax.r2p=function(v){return ax.l2p(cleanNumber(v))},ax.p2d=ax.p2r=p2l,ax.cleanPos=ensureNumber):"log"===ax.type?(ax.d2r=ax.d2l=function(v,clip){return toLog(cleanNumber(v),clip)},ax.r2d=ax.r2c=function(v){return fromLog(cleanNumber(v))},ax.d2c=ax.r2l=cleanNumber,ax.c2d=ax.l2r=ensureNumber,ax.c2r=toLog,ax.l2d=fromLog,ax.d2p=function(v,clip){return ax.l2p(ax.d2r(v,clip))},ax.p2d=function(px){return fromLog(p2l(px))},ax.r2p=function(v){return ax.l2p(cleanNumber(v))},ax.p2r=p2l,ax.cleanPos=ensureNumber):"date"===ax.type?(ax.d2r=ax.r2d=Lib.identity,ax.d2c=ax.r2c=ax.d2l=ax.r2l=dt2ms,ax.c2d=ax.c2r=ax.l2d=ax.l2r=ms2dt,ax.d2p=ax.r2p=function(v,_,calendar){return ax.l2p(dt2ms(v,0,calendar))},ax.p2d=ax.p2r=function(px,r,calendar){return ms2dt(p2l(px),r,calendar)},ax.cleanPos=function(v){return Lib.cleanDate(v,BADNUM,ax.calendar)}):"category"===ax.type&&(ax.d2c=ax.d2l=function setCategoryIndex(v){if(null!==v&&void 0!==v){if(void 0===ax._categoriesMap&&(ax._categoriesMap={}),void 0!==ax._categoriesMap[v])return ax._categoriesMap[v];ax._categories.push(v);var curLength=ax._categories.length-1;return ax._categoriesMap[v]=curLength,curLength}return BADNUM},ax.r2d=ax.c2d=ax.l2d=getCategoryName,ax.d2r=ax.d2l_noadd=getCategoryIndex,ax.r2c=function(v){var index=getCategoryIndex(v);return void 0!==index?index:ax.fraction2r(.5)},ax.l2r=ax.c2r=ensureNumber,ax.r2l=getCategoryIndex,ax.d2p=function(v){return ax.l2p(ax.r2c(v))},ax.p2d=function(px){return getCategoryName(p2l(px))},ax.r2p=ax.d2p,ax.p2r=p2l,ax.cleanPos=function(v){return"string"==typeof v&&""!==v?v:ensureNumber(v)}),ax.fraction2r=function(v){var rl0=ax.r2l(ax.range[0]),rl1=ax.r2l(ax.range[1]);return ax.l2r(rl0+v*(rl1-rl0))},ax.r2fraction=function(v){var rl0=ax.r2l(ax.range[0]),rl1=ax.r2l(ax.range[1]);return(ax.r2l(v)-rl0)/(rl1-rl0)},ax.cleanRange=function(rangeAttr,opts){opts||(opts={}),rangeAttr||(rangeAttr="range");var i,dflt,range=Lib.nestedProperty(ax,rangeAttr).get();if(dflt=(dflt="date"===ax.type?Lib.dfltRange(ax.calendar):"y"===axLetter?constants.DFLTRANGEY:opts.dfltRange||constants.DFLTRANGEX).slice(),range&&2===range.length)for("date"===ax.type&&(range[0]=Lib.cleanDate(range[0],BADNUM,ax.calendar),range[1]=Lib.cleanDate(range[1],BADNUM,ax.calendar)),i=0;i<2;i++)if("date"===ax.type){if(!Lib.isDateTime(range[i],ax.calendar)){ax[rangeAttr]=dflt;break}if(ax.r2l(range[0])===ax.r2l(range[1])){var linCenter=Lib.constrain(ax.r2l(range[0]),Lib.MIN_MS+1e3,Lib.MAX_MS-1e3);range[0]=ax.l2r(linCenter-1e3),range[1]=ax.l2r(linCenter+1e3);break}}else{if(!isNumeric(range[i])){if(!isNumeric(range[1-i])){ax[rangeAttr]=dflt;break}range[i]=range[1-i]*(i?10:.1)}if(range[i]<-FP_SAFE?range[i]=-FP_SAFE:range[i]>FP_SAFE&&(range[i]=FP_SAFE),range[0]===range[1]){var inc=Math.max(1,Math.abs(1e-6*range[0]));range[0]-=inc,range[1]+=inc}}else Lib.nestedProperty(ax,rangeAttr).set(dflt)},ax.setScale=function(usePrivateRange){var gs=fullLayout._size;if(ax._categories||(ax._categories=[]),ax._categoriesMap||(ax._categoriesMap={}),ax.overlaying){var ax2=axisIds.getFromId({_fullLayout:fullLayout},ax.overlaying);ax.domain=ax2.domain}var rangeAttr=usePrivateRange&&ax._r?"_r":"range",calendar=ax.calendar;ax.cleanRange(rangeAttr);var rl0=ax.r2l(ax[rangeAttr][0],calendar),rl1=ax.r2l(ax[rangeAttr][1],calendar);if("y"===axLetter?(ax._offset=gs.t+(1-ax.domain[1])*gs.h,ax._length=gs.h*(ax.domain[1]-ax.domain[0]),ax._m=ax._length/(rl0-rl1),ax._b=-ax._m*rl1):(ax._offset=gs.l+ax.domain[0]*gs.w,ax._length=gs.w*(ax.domain[1]-ax.domain[0]),ax._m=ax._length/(rl1-rl0),ax._b=-ax._m*rl0),!isFinite(ax._m)||!isFinite(ax._b))throw fullLayout._replotting=!1,new Error("Something went wrong with axis scaling")},ax.makeCalcdata=function(trace,axLetter){var arrayIn,arrayOut,i,len,axType=ax.type,cal="date"===axType&&trace[axLetter+"calendar"];if(axLetter in trace){if(arrayIn=trace[axLetter],len=trace._length||arrayIn.length,Lib.isTypedArray(arrayIn)&&("linear"===axType||"log"===axType)){if(len===arrayIn.length)return arrayIn;if(arrayIn.subarray)return arrayIn.subarray(0,len)}for(arrayOut=new Array(len),i=0;i<len;i++)arrayOut[i]=ax.d2c(arrayIn[i],0,cal)}else{var v0=axLetter+"0"in trace?ax.d2c(trace[axLetter+"0"],0,cal):0,dv=trace["d"+axLetter]?Number(trace["d"+axLetter]):1;for(arrayIn=trace[{x:"y",y:"x"}[axLetter]],len=trace._length||arrayIn.length,arrayOut=new Array(len),i=0;i<len;i++)arrayOut[i]=v0+i*dv}return arrayOut},ax.isValidRange=function(range){return Array.isArray(range)&&2===range.length&&isNumeric(ax.r2l(range[0]))&&isNumeric(ax.r2l(range[1]))},ax.isPtWithinRange=function(d,calendar){var coord=ax.c2l(d[axLetter],null,calendar),r0=ax.r2l(ax.range[0]),r1=ax.r2l(ax.range[1]);return r0<r1?r0<=coord&&coord<=r1:r1<=coord&&coord<=r0},ax.clearCalc=function(){ax._categories=(ax._initialCategories||[]).slice(),ax._categoriesMap={};for(var j=0;j<ax._categories.length;j++)ax._categoriesMap[ax._categories[j]]=j};var locale=fullLayout._d3locale;"date"===ax.type&&(ax._dateFormat=locale?locale.timeFormat.utc:d3.time.format.utc,ax._extraFormat=fullLayout._extraFormat),ax._separators=fullLayout.separators,ax._numFormat=locale?locale.numberFormat:d3.format,delete ax._minDtick,delete ax._forceTick0}},{"../../constants/numerical":670,"../../lib":693,"./axis_ids":745,"./constants":747,d3:147,"fast-isnumeric":213}],761:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes"),handleArrayContainerDefaults=_dereq_("../array_container_defaults");function tickformatstopDefaults(valueIn,valueOut){function coerce(attr,dflt){return Lib.coerce(valueIn,valueOut,layoutAttributes.tickformatstops,attr,dflt)}coerce("enabled")&&(coerce("dtickrange"),coerce("value"))}module.exports=function handleTickLabelDefaults(containerIn,containerOut,coerce,axType,options){var showAttrDflt=function getShowAttrDflt(containerIn){var showAttrs=["showexponent","showtickprefix","showticksuffix"].filter(function(a){return void 0!==containerIn[a]});if(showAttrs.every(function(a){return containerIn[a]===containerIn[showAttrs[0]]})||1===showAttrs.length)return containerIn[showAttrs[0]]}(containerIn);if(coerce("tickprefix")&&coerce("showtickprefix",showAttrDflt),coerce("ticksuffix",options.tickSuffixDflt)&&coerce("showticksuffix",showAttrDflt),coerce("showticklabels")){var font=options.font||{},contColor=containerOut.color,dfltFontColor=contColor&&contColor!==layoutAttributes.color.dflt?contColor:font.color;if(Lib.coerceFont(coerce,"tickfont",{family:font.family,size:font.size,color:dfltFontColor}),coerce("tickangle"),"category"!==axType){var tickFormat=coerce("tickformat"),tickformatStops=containerIn.tickformatstops;Array.isArray(tickformatStops)&&tickformatStops.length&&handleArrayContainerDefaults(containerIn,containerOut,{name:"tickformatstops",inclusionAttr:"enabled",handleItemDefaults:tickformatstopDefaults}),tickFormat||"date"===axType||(coerce("showexponent",showAttrDflt),coerce("exponentformat"),coerce("separatethousands"))}}}},{"../../lib":693,"../array_container_defaults":738,"./layout_attributes":754}],762:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes");module.exports=function handleTickDefaults(containerIn,containerOut,coerce,options){var tickLen=Lib.coerce2(containerIn,containerOut,layoutAttributes,"ticklen"),tickWidth=Lib.coerce2(containerIn,containerOut,layoutAttributes,"tickwidth"),tickColor=Lib.coerce2(containerIn,containerOut,layoutAttributes,"tickcolor",containerOut.color);coerce("ticks",options.outerTicks||tickLen||tickWidth||tickColor?"outside":"")||(delete containerOut.ticklen,delete containerOut.tickwidth,delete containerOut.tickcolor)}},{"../../lib":693,"./layout_attributes":754}],763:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),ONEDAY=_dereq_("../../constants/numerical").ONEDAY;module.exports=function handleTickValueDefaults(containerIn,containerOut,coerce,axType){var tickmode;"array"!==containerIn.tickmode||"log"!==axType&&"date"!==axType?tickmode=coerce("tickmode",Array.isArray(containerIn.tickvals)?"array":containerIn.dtick?"linear":"auto"):tickmode=containerOut.tickmode="auto";if("auto"===tickmode)coerce("nticks");else if("linear"===tickmode){var dtickDflt="date"===axType?ONEDAY:1,dtick=coerce("dtick",dtickDflt);if(isNumeric(dtick))containerOut.dtick=dtick>0?Number(dtick):dtickDflt;else if("string"!=typeof dtick)containerOut.dtick=dtickDflt;else{var prefix=dtick.charAt(0),dtickNum=dtick.substr(1);((dtickNum=isNumeric(dtickNum)?Number(dtickNum):0)<=0||!("date"===axType&&"M"===prefix&&dtickNum===Math.round(dtickNum)||"log"===axType&&"L"===prefix||"log"===axType&&"D"===prefix&&(1===dtickNum||2===dtickNum)))&&(containerOut.dtick=dtickDflt)}var tick0Dflt="date"===axType?Lib.dateTick0(containerOut.calendar):0,tick0=coerce("tick0",tick0Dflt);"date"===axType?containerOut.tick0=Lib.cleanDate(tick0,tick0Dflt):isNumeric(tick0)&&"D1"!==dtick&&"D2"!==dtick?containerOut.tick0=Number(tick0):containerOut.tick0=tick0Dflt}else{void 0===coerce("tickvals")?containerOut.tickmode="auto":coerce("ticktext")}}},{"../../constants/numerical":670,"../../lib":693,"fast-isnumeric":213}],764:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Drawing=_dereq_("../../components/drawing"),Axes=_dereq_("./axes"),axisRegex=_dereq_("./constants").attrRegex;module.exports=function transitionAxes(gd,newLayout,transitionOpts,makeOnCompleteCallback){var fullLayout=gd._fullLayout,axes=[];var onComplete,t1,t2,raf,updates=function computeUpdates(layout){var ai,attrList,axis,update,updates={};for(ai in layout)if((attrList=ai.split("."))[0].match(axisRegex)){var axisLetter=ai.charAt(0),axisName=attrList[0];if(axis=fullLayout[axisName],update={},Array.isArray(layout[ai])?update.to=layout[ai].slice(0):Array.isArray(layout[ai].range)&&(update.to=layout[ai].range.slice(0)),!update.to)continue;update.axisName=axisName,update.length=axis._length,axes.push(axisLetter),updates[axisLetter]=update}return updates}(newLayout),updatedAxisIds=Object.keys(updates),affectedSubplots=function computeAffectedSubplots(fullLayout,updatedAxisIds,updates){var plotName,toX,toY,plotinfos=fullLayout._plots,affectedSubplots=[];for(plotName in plotinfos){var plotinfo=plotinfos[plotName];if(-1===affectedSubplots.indexOf(plotinfo)){var x=plotinfo.xaxis._id,y=plotinfo.yaxis._id,fromX=plotinfo.xaxis.range,fromY=plotinfo.yaxis.range;plotinfo.xaxis._r=plotinfo.xaxis.range.slice(),plotinfo.yaxis._r=plotinfo.yaxis.range.slice(),toX=updates[x]?updates[x].to:fromX,toY=updates[y]?updates[y].to:fromY,fromX[0]===toX[0]&&fromX[1]===toX[1]&&fromY[0]===toY[0]&&fromY[1]===toY[1]||-1===updatedAxisIds.indexOf(x)&&-1===updatedAxisIds.indexOf(y)||affectedSubplots.push(plotinfo)}}return affectedSubplots}(fullLayout,updatedAxisIds,updates);if(!affectedSubplots.length)return function updateLayoutObjs(){function redrawObjs(objArray,method,shortCircuit){for(var i=0;i<objArray.length;i++)if(method(gd,i),shortCircuit)return}redrawObjs(fullLayout.annotations||[],Registry.getComponentMethod("annotations","drawOne")),redrawObjs(fullLayout.shapes||[],Registry.getComponentMethod("shapes","drawOne")),redrawObjs(fullLayout.images||[],Registry.getComponentMethod("images","draw"),!0)}(),!1;function unsetSubplotTransform(subplot){var xa2=subplot.xaxis,ya2=subplot.yaxis;fullLayout._defs.select("#"+subplot.clipId+"> rect").call(Drawing.setTranslate,0,0).call(Drawing.setScale,1,1),subplot.plot.call(Drawing.setTranslate,xa2._offset,ya2._offset).call(Drawing.setScale,1,1);var traceGroups=subplot.plot.selectAll(".scatterlayer .trace");traceGroups.selectAll(".point").call(Drawing.setPointGroupScale,1,1),traceGroups.selectAll(".textpoint").call(Drawing.setTextPointsScale,1,1),traceGroups.call(Drawing.hideOutsideRangePoints,subplot)}function updateSubplot(subplot,progress){var axis,r0,r1,xUpdate=updates[subplot.xaxis._id],yUpdate=updates[subplot.yaxis._id],viewBox=[];if(xUpdate){r0=(axis=gd._fullLayout[xUpdate.axisName])._r,r1=xUpdate.to,viewBox[0]=(r0[0]*(1-progress)+progress*r1[0]-r0[0])/(r0[1]-r0[0])*subplot.xaxis._length;var dx1=r0[1]-r0[0],dx2=r1[1]-r1[0];axis.range[0]=r0[0]*(1-progress)+progress*r1[0],axis.range[1]=r0[1]*(1-progress)+progress*r1[1],viewBox[2]=subplot.xaxis._length*(1-progress+progress*dx2/dx1)}else viewBox[0]=0,viewBox[2]=subplot.xaxis._length;if(yUpdate){r0=(axis=gd._fullLayout[yUpdate.axisName])._r,r1=yUpdate.to,viewBox[1]=(r0[1]*(1-progress)+progress*r1[1]-r0[1])/(r0[0]-r0[1])*subplot.yaxis._length;var dy1=r0[1]-r0[0],dy2=r1[1]-r1[0];axis.range[0]=r0[0]*(1-progress)+progress*r1[0],axis.range[1]=r0[1]*(1-progress)+progress*r1[1],viewBox[3]=subplot.yaxis._length*(1-progress+progress*dy2/dy1)}else viewBox[1]=0,viewBox[3]=subplot.yaxis._length;!function ticksAndAnnotations(xa,ya){var i,activeAxIds=[];for(activeAxIds=[xa._id,ya._id],i=0;i<activeAxIds.length;i++)Axes.doTicksSingle(gd,activeAxIds[i],!0);function redrawObjs(objArray,method,shortCircuit){for(i=0;i<objArray.length;i++){var obji=objArray[i];if(-1===activeAxIds.indexOf(obji.xref)&&-1===activeAxIds.indexOf(obji.yref)||method(gd,i),shortCircuit)return}}redrawObjs(fullLayout.annotations||[],Registry.getComponentMethod("annotations","drawOne")),redrawObjs(fullLayout.shapes||[],Registry.getComponentMethod("shapes","drawOne")),redrawObjs(fullLayout.images||[],Registry.getComponentMethod("images","draw"),!0)}(subplot.xaxis,subplot.yaxis);var xa2=subplot.xaxis,ya2=subplot.yaxis,editX=!!xUpdate,editY=!!yUpdate,xScaleFactor=editX?xa2._length/viewBox[2]:1,yScaleFactor=editY?ya2._length/viewBox[3]:1,clipDx=editX?viewBox[0]:0,clipDy=editY?viewBox[1]:0,fracDx=editX?viewBox[0]/viewBox[2]*xa2._length:0,fracDy=editY?viewBox[1]/viewBox[3]*ya2._length:0,plotDx=xa2._offset-fracDx,plotDy=ya2._offset-fracDy;subplot.clipRect.call(Drawing.setTranslate,clipDx,clipDy).call(Drawing.setScale,1/xScaleFactor,1/yScaleFactor),subplot.plot.call(Drawing.setTranslate,plotDx,plotDy).call(Drawing.setScale,xScaleFactor,yScaleFactor),Drawing.setPointGroupScale(subplot.zoomScalePts,1/xScaleFactor,1/yScaleFactor),Drawing.setTextPointsScale(subplot.zoomScaleTxt,1/xScaleFactor,1/yScaleFactor)}makeOnCompleteCallback&&(onComplete=makeOnCompleteCallback());var easeFn=d3.ease(transitionOpts.easing);return gd._transitionData._interruptCallbacks.push(function(){return window.cancelAnimationFrame(raf),raf=null,function transitionInterrupt(){for(var aobj={},i=0;i<updatedAxisIds.length;i++){var axi=gd._fullLayout[updatedAxisIds[i]+"axis"];aobj[axi._name+".range[0]"]=axi.range[0],aobj[axi._name+".range[1]"]=axi.range[1],axi.range=axi._r.slice()}return Registry.call("relayout",gd,aobj).then(function(){for(var i=0;i<affectedSubplots.length;i++)unsetSubplotTransform(affectedSubplots[i])})}()}),t1=Date.now(),raf=window.requestAnimationFrame(function doFrame(){t2=Date.now();for(var tInterp=Math.min(1,(t2-t1)/transitionOpts.duration),progress=easeFn(tInterp),i=0;i<affectedSubplots.length;i++)updateSubplot(affectedSubplots[i],progress);t2-t1>transitionOpts.duration?(function transitionComplete(){for(var aobj={},i=0;i<updatedAxisIds.length;i++){var axi=gd._fullLayout[updates[updatedAxisIds[i]].axisName],to=updates[updatedAxisIds[i]].to;aobj[axi._name+".range[0]"]=to[0],aobj[axi._name+".range[1]"]=to[1],axi.range=to.slice()}return onComplete&&onComplete(),Registry.call("relayout",gd,aobj).then(function(){for(var i=0;i<affectedSubplots.length;i++)unsetSubplotTransform(affectedSubplots[i])})}(),raf=window.cancelAnimationFrame(doFrame)):raf=window.requestAnimationFrame(doFrame)}),Promise.resolve()}},{"../../components/drawing":592,"../../registry":825,"./axes":742,"./constants":747,d3:147}],765:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),autoType=_dereq_("./axis_autotype");function getBoxPosLetter(trace){return{v:"x",h:"y"}[trace.orientation||"v"]}function isBoxWithoutPositionCoords(trace,axLetter){var posLetter=getBoxPosLetter(trace),isBox=Registry.traceIs(trace,"box-violin"),isCandlestick=Registry.traceIs(trace._fullInput||{},"candlestick");return isBox&&!isCandlestick&&axLetter===posLetter&&void 0===trace[posLetter]&&void 0===trace[posLetter+"0"]}module.exports=function handleTypeDefaults(containerIn,containerOut,coerce,options){"-"===coerce("type",(options.splomStash||{}).type)&&(!function setAutoType(ax,data){if("-"!==ax.type)return;var id=ax._id,axLetter=id.charAt(0);-1!==id.indexOf("scene")&&(id=axLetter);var d0=function getFirstNonEmptyTrace(data,id,axLetter){for(var i=0;i<data.length;i++){var trace=data[i];if("splom"===trace.type&&trace._length>0&&(trace["_"+axLetter+"axes"]||{})[id])return trace;if((trace[axLetter+"axis"]||axLetter)===id){if(isBoxWithoutPositionCoords(trace,axLetter))return trace;if((trace[axLetter]||[]).length||trace[axLetter+"0"])return trace}}}(data,id,axLetter);if(!d0)return;if("histogram"===d0.type&&axLetter==={v:"y",h:"x"}[d0.orientation||"v"])return void(ax.type="linear");var i,calAttr=axLetter+"calendar",calendar=d0[calAttr];if(isBoxWithoutPositionCoords(d0,axLetter)){var posLetter=getBoxPosLetter(d0),boxPositions=[];for(i=0;i<data.length;i++){var trace=data[i];Registry.traceIs(trace,"box-violin")&&(trace[axLetter+"axis"]||axLetter)===id&&(void 0!==trace[posLetter]?boxPositions.push(trace[posLetter][0]):void 0!==trace.name?boxPositions.push(trace.name):boxPositions.push("text"),trace[calAttr]!==calendar&&(calendar=void 0))}ax.type=autoType(boxPositions,calendar)}else if("splom"===d0.type){var dimensions=d0.dimensions,diag=d0._diag;for(i=0;i<dimensions.length;i++){var dim=dimensions[i];if(dim.visible&&(diag[i][0]===id||diag[i][1]===id)){ax.type=autoType(dim.values,calendar);break}}}else ax.type=autoType(d0[axLetter]||[d0[axLetter+"0"]],calendar)}(containerOut,options.data),"-"===containerOut.type?containerOut.type="linear":containerIn.type=containerOut.type)}},{"../../registry":825,"./axis_autotype":743}],766:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../registry"),Lib=_dereq_("../lib");function bindingValueHasChanged(gd,binding,cache){var container,value,obj,changed=!1;if("data"===binding.type)container=gd._fullData[null!==binding.traces?binding.traces[0]:0];else{if("layout"!==binding.type)return!1;container=gd._fullLayout}return value=Lib.nestedProperty(container,binding.prop).get(),(obj=cache[binding.type]=cache[binding.type]||{}).hasOwnProperty(binding.prop)&&obj[binding.prop]!==value&&(changed=!0),obj[binding.prop]=value,{changed:changed,value:value}}function computeLayoutBindings(gd,args){var bindings=[],astr=args[0],aobj={};if("string"==typeof astr)aobj[astr]=args[1];else{if(!Lib.isPlainObject(astr))return bindings;aobj=astr}return crawl(aobj,function(path,attrName,attr){bindings.push({type:"layout",prop:path,value:attr})},"",0),bindings}function computeDataBindings(gd,args){var traces,astr,val,aobj,bindings=[];if(astr=args[0],val=args[1],traces=args[2],aobj={},"string"==typeof astr)aobj[astr]=val;else{if(!Lib.isPlainObject(astr))return bindings;aobj=astr,void 0===traces&&(traces=val)}return void 0===traces&&(traces=null),crawl(aobj,function(path,attrName,attr){var thisTraces;if(Array.isArray(attr)){var nAttr=Math.min(attr.length,gd.data.length);traces&&(nAttr=Math.min(nAttr,traces.length)),thisTraces=[];for(var j=0;j<nAttr;j++)thisTraces[j]=traces?traces[j]:j}else thisTraces=traces?traces.slice(0):null;if(null===thisTraces)Array.isArray(attr)&&(attr=attr[0]);else if(Array.isArray(thisTraces)){if(!Array.isArray(attr)){var tmp=attr;attr=[];for(var i=0;i<thisTraces.length;i++)attr[i]=tmp}attr.length=Math.min(thisTraces.length,attr.length)}bindings.push({type:"data",prop:path,traces:thisTraces,value:attr})},"",0),bindings}function crawl(attrs,callback,path,depth){Object.keys(attrs).forEach(function(attrName){var attr=attrs[attrName];if("_"!==attrName[0]){var thisPath=path+(depth>0?".":"")+attrName;Lib.isPlainObject(attr)?crawl(attr,callback,thisPath,depth+1):callback(thisPath,attrName,attr)}})}exports.manageCommandObserver=function(gd,container,commandList,onchange){var ret={},enabled=!0;container&&container._commandObserver&&(ret=container._commandObserver),ret.cache||(ret.cache={}),ret.lookupTable={};var binding=exports.hasSimpleAPICommandBindings(gd,commandList,ret.lookupTable);if(container&&container._commandObserver){if(binding)return ret;if(container._commandObserver.remove)return container._commandObserver.remove(),container._commandObserver=null,ret}if(binding){bindingValueHasChanged(gd,binding,ret.cache),ret.check=function check(){if(enabled){var update=bindingValueHasChanged(gd,binding,ret.cache);return update.changed&&onchange&&void 0!==ret.lookupTable[update.value]&&(ret.disable(),Promise.resolve(onchange({value:update.value,type:binding.type,prop:binding.prop,traces:binding.traces,index:ret.lookupTable[update.value]})).then(ret.enable,ret.enable)),update.changed}};for(var checkEvents=["plotly_relayout","plotly_redraw","plotly_restyle","plotly_update","plotly_animatingframe","plotly_afterplot"],i=0;i<checkEvents.length;i++)gd._internalOn(checkEvents[i],ret.check);ret.remove=function(){for(var i=0;i<checkEvents.length;i++)gd._removeInternalListener(checkEvents[i],ret.check)}}else Lib.log("Unable to automatically bind plot updates to API command"),ret.lookupTable={},ret.remove=function(){};return ret.disable=function disable(){enabled=!1},ret.enable=function enable(){enabled=!0},container&&(container._commandObserver=ret),ret},exports.hasSimpleAPICommandBindings=function(gd,commandList,bindingsByValue){var i,refBinding,n=commandList.length;for(i=0;i<n;i++){var binding,command=commandList[i],method=command.method,args=command.args;if(Array.isArray(args)||(args=[]),!method)return!1;var bindings=exports.computeAPICommandBindings(gd,method,args);if(1!==bindings.length)return!1;if(refBinding){if((binding=bindings[0]).type!==refBinding.type)return!1;if(binding.prop!==refBinding.prop)return!1;if(Array.isArray(refBinding.traces)){if(!Array.isArray(binding.traces))return!1;binding.traces.sort();for(var j=0;j<refBinding.traces.length;j++)if(refBinding.traces[j]!==binding.traces[j])return!1}else if(binding.prop!==refBinding.prop)return!1}else refBinding=bindings[0],Array.isArray(refBinding.traces)&&refBinding.traces.sort();var value=(binding=bindings[0]).value;if(Array.isArray(value)){if(1!==value.length)return!1;value=value[0]}bindingsByValue&&(bindingsByValue[value]=i)}return refBinding},exports.executeAPICommand=function(gd,method,args){if("skip"===method)return Promise.resolve();var _method=Registry.apiMethodRegistry[method],allArgs=[gd];Array.isArray(args)||(args=[]);for(var i=0;i<args.length;i++)allArgs.push(args[i]);return _method.apply(null,allArgs).catch(function(err){return Lib.warn("API call to Plotly."+method+" rejected.",err),Promise.reject(err)})},exports.computeAPICommandBindings=function(gd,method,args){var bindings;switch(Array.isArray(args)||(args=[]),method){case"restyle":bindings=computeDataBindings(gd,args);break;case"relayout":bindings=computeLayoutBindings(gd,args);break;case"update":bindings=computeDataBindings(gd,[args[0],args[2]]).concat(computeLayoutBindings(gd,[args[1]]));break;case"animate":bindings=function computeAnimateBindings(gd,args){return Array.isArray(args[0])&&1===args[0].length&&-1!==["string","number"].indexOf(typeof args[0][0])?[{type:"layout",prop:"_currentFrame",value:args[0][0].toString()}]:[]}(0,args);break;default:bindings=[]}return bindings}},{"../lib":693,"../registry":825}],767:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../lib/extend").extendFlat;exports.attributes=function(opts,extra){opts=opts||{},extra=extra||{};var base={valType:"info_array",editType:opts.editType,items:[{valType:"number",min:0,max:1,editType:opts.editType},{valType:"number",min:0,max:1,editType:opts.editType}],dflt:[0,1]},out=(opts.name&&opts.name,opts.trace,extra.description&&extra.description,{x:extendFlat({},base,{}),y:extendFlat({},base,{}),editType:opts.editType});return opts.noGridCell||(out.row={valType:"integer",min:0,dflt:0,editType:opts.editType},out.column={valType:"integer",min:0,dflt:0,editType:opts.editType}),out},exports.defaults=function(containerOut,layout,coerce,dfltDomains){var dfltX=dfltDomains&&dfltDomains.x||[0,1],dfltY=dfltDomains&&dfltDomains.y||[0,1],grid=layout.grid;if(grid){var column=coerce("domain.column");void 0!==column&&(column<grid.columns?dfltX=grid._domains.x[column]:delete containerOut.domain.column);var row=coerce("domain.row");void 0!==row&&(row<grid.rows?dfltY=grid._domains.y[row]:delete containerOut.domain.row)}coerce("domain.x",dfltX),coerce("domain.y",dfltY)}},{"../lib/extend":682}],768:[function(_dereq_,module,exports){"use strict";module.exports=function(opts){var editType=opts.editType,colorEditType=opts.colorEditType;void 0===colorEditType&&(colorEditType=editType);var attrs={family:{valType:"string",noBlank:!0,strict:!0,editType:editType},size:{valType:"number",min:1,editType:editType},color:{valType:"color",editType:colorEditType},editType:editType};return opts.arrayOk&&(attrs.family.arrayOk=!0,attrs.size.arrayOk=!0,attrs.color.arrayOk=!0),attrs}},{}],769:[function(_dereq_,module,exports){"use strict";module.exports={_isLinkedToArray:"frames_entry",group:{valType:"string"},name:{valType:"string"},traces:{valType:"any"},baseframe:{valType:"string"},data:{valType:"any"},layout:{valType:"any"}}},{}],770:[function(_dereq_,module,exports){"use strict";exports.projNames={equirectangular:"equirectangular",mercator:"mercator",orthographic:"orthographic","natural earth":"naturalEarth",kavrayskiy7:"kavrayskiy7",miller:"miller",robinson:"robinson",eckert4:"eckert4","azimuthal equal area":"azimuthalEqualArea","azimuthal equidistant":"azimuthalEquidistant","conic equal area":"conicEqualArea","conic conformal":"conicConformal","conic equidistant":"conicEquidistant",gnomonic:"gnomonic",stereographic:"stereographic",mollweide:"mollweide",hammer:"hammer","transverse mercator":"transverseMercator","albers usa":"albersUsa","winkel tripel":"winkel3",aitoff:"aitoff",sinusoidal:"sinusoidal"},exports.axesNames=["lonaxis","lataxis"],exports.lonaxisSpan={orthographic:180,"azimuthal equal area":360,"azimuthal equidistant":360,"conic conformal":180,gnomonic:160,stereographic:180,"transverse mercator":180,"*":360},exports.lataxisSpan={"conic conformal":150,stereographic:179.5,"*":180},exports.scopeDefaults={world:{lonaxisRange:[-180,180],lataxisRange:[-90,90],projType:"equirectangular",projRotate:[0,0,0]},usa:{lonaxisRange:[-180,-50],lataxisRange:[15,80],projType:"albers usa"},europe:{lonaxisRange:[-30,60],lataxisRange:[30,85],projType:"conic conformal",projRotate:[15,0,0],projParallels:[0,60]},asia:{lonaxisRange:[22,160],lataxisRange:[-15,55],projType:"mercator",projRotate:[0,0,0]},africa:{lonaxisRange:[-30,60],lataxisRange:[-40,40],projType:"mercator",projRotate:[0,0,0]},"north america":{lonaxisRange:[-180,-45],lataxisRange:[5,85],projType:"conic conformal",projRotate:[-100,0,0],projParallels:[29.5,45.5]},"south america":{lonaxisRange:[-100,-30],lataxisRange:[-60,15],projType:"mercator",projRotate:[0,0,0]}},exports.clipPad=.001,exports.precision=.1,exports.landColor="#F0DC82",exports.waterColor="#3399FF",exports.locationmodeToLayer={"ISO-3":"countries","USA-states":"subunits","country names":"countries"},exports.sphereSVG={type:"Sphere"},exports.fillLayers={ocean:1,land:1,lakes:1},exports.lineLayers={subunits:1,countries:1,coastlines:1,rivers:1,frame:1},exports.layers=["bg","ocean","land","lakes","subunits","countries","coastlines","rivers","lataxis","lonaxis","frame","backplot","frontplot"],exports.layersForChoropleth=["bg","ocean","land","subunits","countries","coastlines","lataxis","lonaxis","frame","backplot","rivers","lakes","frontplot"],exports.layerNameToAdjective={ocean:"ocean",land:"land",lakes:"lake",subunits:"subunit",countries:"country",coastlines:"coastline",rivers:"river",frame:"frame"}},{}],771:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Fx=_dereq_("../../components/fx"),Plots=_dereq_("../plots"),Axes=_dereq_("../cartesian/axes"),dragElement=_dereq_("../../components/dragelement"),prepSelect=_dereq_("../cartesian/select").prepSelect,selectOnClick=_dereq_("../cartesian/select").selectOnClick,createGeoZoom=_dereq_("./zoom"),constants=_dereq_("./constants"),topojsonUtils=_dereq_("../../lib/topojson_utils"),topojsonFeature=_dereq_("topojson-client").feature;function Geo(opts){this.id=opts.id,this.graphDiv=opts.graphDiv,this.container=opts.container,this.topojsonURL=opts.topojsonURL,this.isStatic=opts.staticPlot,this.topojsonName=null,this.topojson=null,this.projection=null,this.viewInitial=null,this.fitScale=null,this.bounds=null,this.midPt=null,this.hasChoropleth=!1,this.traceHash={},this.layers={},this.basePaths={},this.dataPaths={},this.dataPoints={},this.clipDef=null,this.clipRect=null,this.bgRect=null,this.makeFramework()}_dereq_("./projections")(d3);var proto=Geo.prototype;module.exports=function createGeo(opts){return new Geo(opts)},proto.plot=function(geoCalcData,fullLayout,promises){var _this=this,geoLayout=fullLayout[this.id],topojsonNameNew=topojsonUtils.getTopojsonName(geoLayout);null===_this.topojson||topojsonNameNew!==_this.topojsonName?(_this.topojsonName=topojsonNameNew,void 0===PlotlyGeoAssets.topojson[_this.topojsonName]?promises.push(_this.fetchTopojson().then(function(topojson){PlotlyGeoAssets.topojson[_this.topojsonName]=topojson,_this.topojson=topojson,_this.update(geoCalcData,fullLayout)})):(_this.topojson=PlotlyGeoAssets.topojson[_this.topojsonName],_this.update(geoCalcData,fullLayout))):_this.update(geoCalcData,fullLayout)},proto.fetchTopojson=function(){var topojsonPath=topojsonUtils.getTopojsonPath(this.topojsonURL,this.topojsonName);return new Promise(function(resolve,reject){d3.json(topojsonPath,function(err,topojson){if(err)return 404===err.status?reject(new Error(["plotly.js could not find topojson file at",topojsonPath,".","Make sure the *topojsonURL* plot config option","is set properly."].join(" "))):reject(new Error(["unexpected error while fetching topojson file at",topojsonPath].join(" ")));resolve(topojson)})})},proto.update=function(geoCalcData,fullLayout){var geoLayout=fullLayout[this.id];if(!this.updateProjection(fullLayout,geoLayout)){this.hasChoropleth=!1;for(var i=0;i<geoCalcData.length;i++)if("choropleth"===geoCalcData[i][0].trace.type){this.hasChoropleth=!0;break}this.viewInitial||this.saveViewInitial(geoLayout),this.updateBaseLayers(fullLayout,geoLayout),this.updateDims(fullLayout,geoLayout),this.updateFx(fullLayout,geoLayout),Plots.generalUpdatePerTraceModule(this.graphDiv,this,geoCalcData,geoLayout);var scatterLayer=this.layers.frontplot.select(".scatterlayer");this.dataPoints.point=scatterLayer.selectAll(".point"),this.dataPoints.text=scatterLayer.selectAll("text"),this.dataPaths.line=scatterLayer.selectAll(".js-line");var choroplethLayer=this.layers.backplot.select(".choroplethlayer");this.dataPaths.choropleth=choroplethLayer.selectAll("path"),this.render()}},proto.updateProjection=function(fullLayout,geoLayout){var gs=fullLayout._size,domain=geoLayout.domain,projLayout=geoLayout.projection,rotation=projLayout.rotation||{},center=geoLayout.center||{},projection=this.projection=function getProjection(geoLayout){for(var projType=geoLayout.projection.type,projection=d3.geo[constants.projNames[projType]](),clipAngle=geoLayout._isClipped?constants.lonaxisSpan[projType]/2:null,methods=["center","rotate","parallels","clipExtent"],dummyFn=function(_){return _?projection:[]},i=0;i<methods.length;i++){var m=methods[i];"function"!=typeof projection[m]&&(projection[m]=dummyFn)}projection.isLonLatOverEdges=function(lonlat){if(null===projection(lonlat))return!0;if(clipAngle){var r=projection.rotate();return d3.geo.distance(lonlat,[-r[0],-r[1]])>clipAngle*Math.PI/180}return!1},projection.getPath=function(){return d3.geo.path().projection(projection)},projection.getBounds=function(object){return projection.getPath().bounds(object)},projection.fitExtent=function(extent,object){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],clip=projection.clipExtent&&projection.clipExtent();projection.scale(150).translate([0,0]),clip&&projection.clipExtent(null);var b=projection.getBounds(object),k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x=+extent[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y=+extent[0][1]+(h-k*(b[1][1]+b[0][1]))/2;return clip&&projection.clipExtent(clip),projection.scale(150*k).translate([x,y])},projection.precision(constants.precision),clipAngle&&projection.clipAngle(clipAngle-constants.clipPad);return projection}(geoLayout);projection.center([center.lon-rotation.lon,center.lat-rotation.lat]).rotate([-rotation.lon,-rotation.lat,rotation.roll]).parallels(projLayout.parallels);var extent=[[gs.l+gs.w*domain.x[0],gs.t+gs.h*(1-domain.y[1])],[gs.l+gs.w*domain.x[1],gs.t+gs.h*(1-domain.y[0])]],lonaxis=geoLayout.lonaxis,lataxis=geoLayout.lataxis,rangeBox=function makeRangeBox(lon,lat){var clipPad=constants.clipPad,lon0=lon[0]+clipPad,lon1=lon[1]-clipPad,lat0=lat[0]+clipPad,lat1=lat[1]-clipPad;lon0>0&&lon1<0&&(lon1+=360);var dlon4=(lon1-lon0)/4;return{type:"Polygon",coordinates:[[[lon0,lat0],[lon0,lat1],[lon0+dlon4,lat1],[lon0+2*dlon4,lat1],[lon0+3*dlon4,lat1],[lon1,lat1],[lon1,lat0],[lon1-dlon4,lat0],[lon1-2*dlon4,lat0],[lon1-3*dlon4,lat0],[lon0,lat0]]]}}(lonaxis.range,lataxis.range);projection.fitExtent(extent,rangeBox);var b=this.bounds=projection.getBounds(rangeBox),s=this.fitScale=projection.scale(),t=projection.translate();if(!isFinite(b[0][0])||!isFinite(b[0][1])||!isFinite(b[1][0])||!isFinite(b[1][1])||isNaN(t[0])||isNaN(t[0])){for(var gd=this.graphDiv,attrToUnset=["projection.rotation","center","lonaxis.range","lataxis.range"],msg="Invalid geo settings, relayout'ing to default view.",updateObj={},i=0;i<attrToUnset.length;i++)updateObj[this.id+"."+attrToUnset[i]]=null;return this.viewInitial=null,Lib.warn(msg),gd._promises.push(Registry.call("relayout",gd,updateObj)),msg}var midPt=this.midPt=[(b[0][0]+b[1][0])/2,(b[0][1]+b[1][1])/2];if(projection.scale(projLayout.scale*s).translate([t[0]+(midPt[0]-t[0]),t[1]+(midPt[1]-t[1])]).clipExtent(b),geoLayout._isAlbersUsa){var centerPx=projection([center.lon,center.lat]),tt=projection.translate();projection.translate([tt[0]-(centerPx[0]-tt[0]),tt[1]-(centerPx[1]-tt[1])])}},proto.updateBaseLayers=function(fullLayout,geoLayout){var _this=this,topojson=_this.topojson,layers=_this.layers,basePaths=_this.basePaths;function isAxisLayer(d){return"lonaxis"===d||"lataxis"===d}function isLineLayer(d){return Boolean(constants.lineLayers[d])}function isFillLayer(d){return Boolean(constants.fillLayers[d])}var layerData=(this.hasChoropleth?constants.layersForChoropleth:constants.layers).filter(function(d){return isLineLayer(d)||isFillLayer(d)?geoLayout["show"+d]:!isAxisLayer(d)||geoLayout[d].showgrid}),join=_this.framework.selectAll(".layer").data(layerData,String);join.exit().each(function(d){delete layers[d],delete basePaths[d],d3.select(this).remove()}),join.enter().append("g").attr("class",function(d){return"layer "+d}).each(function(d){var layer=layers[d]=d3.select(this);"bg"===d?_this.bgRect=layer.append("rect").style("pointer-events","all"):isAxisLayer(d)?basePaths[d]=layer.append("path").style("fill","none"):"backplot"===d?layer.append("g").classed("choroplethlayer",!0):"frontplot"===d?layer.append("g").classed("scatterlayer",!0):isLineLayer(d)?basePaths[d]=layer.append("path").style("fill","none").style("stroke-miterlimit",2):isFillLayer(d)&&(basePaths[d]=layer.append("path").style("stroke","none"))}),join.order(),join.each(function(d){var path=basePaths[d],adj=constants.layerNameToAdjective[d];"frame"===d?path.datum(constants.sphereSVG):isLineLayer(d)||isFillLayer(d)?path.datum(topojsonFeature(topojson,topojson.objects[d])):isAxisLayer(d)&&path.datum(function makeGraticule(axisName,geoLayout){var dtick=geoLayout[axisName].dtick,scopeDefaults=constants.scopeDefaults[geoLayout.scope],lonaxisRange=scopeDefaults.lonaxisRange,lataxisRange=scopeDefaults.lataxisRange,step="lonaxis"===axisName?[dtick]:[0,dtick];return d3.geo.graticule().extent([[lonaxisRange[0],lataxisRange[0]],[lonaxisRange[1],lataxisRange[1]]]).step(step)}(d,geoLayout)).call(Color.stroke,geoLayout[d].gridcolor).call(Drawing.dashLine,"",geoLayout[d].gridwidth),isLineLayer(d)?path.call(Color.stroke,geoLayout[adj+"color"]).call(Drawing.dashLine,"",geoLayout[adj+"width"]):isFillLayer(d)&&path.call(Color.fill,geoLayout[adj+"color"])})},proto.updateDims=function(fullLayout,geoLayout){var b=this.bounds,hFrameWidth=(geoLayout.framewidth||0)/2,l=b[0][0]-hFrameWidth,t=b[0][1]-hFrameWidth,w=b[1][0]-l+hFrameWidth,h=b[1][1]-t+hFrameWidth;Drawing.setRect(this.clipRect,l,t,w,h),this.bgRect.call(Drawing.setRect,l,t,w,h).call(Color.fill,geoLayout.bgcolor),this.xaxis._offset=l,this.xaxis._length=w,this.yaxis._offset=t,this.yaxis._length=h},proto.updateFx=function(fullLayout,geoLayout){var _this=this,gd=_this.graphDiv,bgRect=_this.bgRect,dragMode=fullLayout.dragmode,clickMode=fullLayout.clickmode;if(!_this.isStatic){var fillRangeItems;"select"===dragMode?fillRangeItems=function(eventData,poly){(eventData.range={})[_this.id]=[invert([poly.xmin,poly.ymin]),invert([poly.xmax,poly.ymax])]}:"lasso"===dragMode&&(fillRangeItems=function(eventData,poly,pts){(eventData.lassoPoints={})[_this.id]=pts.filtered.map(invert)});var dragOptions={element:_this.bgRect.node(),gd:gd,plotinfo:{id:_this.id,xaxis:_this.xaxis,yaxis:_this.yaxis,fillRangeItems:fillRangeItems},xaxes:[_this.xaxis],yaxes:[_this.yaxis],subplot:_this.id,clickFn:function(numClicks){2===numClicks&&fullLayout._zoomlayer.selectAll(".select-outline").remove()}};"pan"===dragMode?(bgRect.node().onmousedown=null,bgRect.call(createGeoZoom(_this,geoLayout)),bgRect.on("dblclick.zoom",function zoomReset(){var viewInitial=_this.viewInitial,updateObj={};for(var k in viewInitial)updateObj[_this.id+"."+k]=viewInitial[k];Registry.call("relayout",gd,updateObj),gd.emit("plotly_doubleclick",null)})):"select"!==dragMode&&"lasso"!==dragMode||(bgRect.on(".zoom",null),dragOptions.prepFn=function(e,startX,startY){prepSelect(e,startX,startY,dragOptions,dragMode)},dragElement.init(dragOptions)),bgRect.on("mousemove",function(){var lonlat=_this.projection.invert(d3.mouse(this));if(!lonlat||isNaN(lonlat[0])||isNaN(lonlat[1]))return dragElement.unhover(gd,d3.event);_this.xaxis.p2c=function(){return lonlat[0]},_this.yaxis.p2c=function(){return lonlat[1]},Fx.hover(gd,d3.event,_this.id)}),bgRect.on("mouseout",function(){gd._dragging||dragElement.unhover(gd,d3.event)}),bgRect.on("click",function(){"select"!==dragMode&&"lasso"!==dragMode&&(clickMode.indexOf("select")>-1&&selectOnClick(d3.event,gd,[_this.xaxis],[_this.yaxis],_this.id,dragOptions),clickMode.indexOf("event")>-1&&Fx.click(gd,d3.event))})}function invert(lonlat){return _this.projection.invert([lonlat[0]+_this.xaxis._offset,lonlat[1]+_this.yaxis._offset])}},proto.makeFramework=function(){var _this=this,fullLayout=_this.graphDiv._fullLayout,clipId="clip"+fullLayout._uid+_this.id;_this.clipDef=fullLayout._clips.append("clipPath").attr("id",clipId),_this.clipRect=_this.clipDef.append("rect"),_this.framework=d3.select(_this.container).append("g").attr("class","geo "+_this.id).call(Drawing.setClipUrl,clipId),_this.project=function(v){var px=_this.projection(v);return px?[px[0]-_this.xaxis._offset,px[1]-_this.yaxis._offset]:[null,null]},_this.xaxis={_id:"x",c2p:function(v){return _this.project(v)[0]}},_this.yaxis={_id:"y",c2p:function(v){return _this.project(v)[1]}},_this.mockAxis={type:"linear",showexponent:"all",exponentformat:"B"},Axes.setConvert(_this.mockAxis,fullLayout)},proto.saveViewInitial=function(geoLayout){var center=geoLayout.center||{},projLayout=geoLayout.projection,rotation=projLayout.rotation||{};geoLayout._isScoped?this.viewInitial={"center.lon":center.lon,"center.lat":center.lat,"projection.scale":projLayout.scale}:geoLayout._isClipped?this.viewInitial={"projection.scale":projLayout.scale,"projection.rotation.lon":rotation.lon,"projection.rotation.lat":rotation.lat}:this.viewInitial={"center.lon":center.lon,"center.lat":center.lat,"projection.scale":projLayout.scale,"projection.rotation.lon":rotation.lon}},proto.render=function(){var k,projection=this.projection,pathFn=projection.getPath();function translatePoints(d){var lonlatPx=projection(d.lonlat);return lonlatPx?"translate("+lonlatPx[0]+","+lonlatPx[1]+")":null}function hideShowPoints(d){return projection.isLonLatOverEdges(d.lonlat)?"none":null}for(k in this.basePaths)this.basePaths[k].attr("d",pathFn);for(k in this.dataPaths)this.dataPaths[k].attr("d",function(d){return pathFn(d.geojson)});for(k in this.dataPoints)this.dataPoints[k].attr("display",hideShowPoints).attr("transform",translatePoints)}},{"../../components/color":567,"../../components/dragelement":589,"../../components/drawing":592,"../../components/fx":609,"../../lib":693,"../../lib/topojson_utils":721,"../../registry":825,"../cartesian/axes":742,"../cartesian/select":759,"../plots":805,"./constants":770,"./projections":776,"./zoom":777,d3:147,"topojson-client":514}],772:[function(_dereq_,module,exports){"use strict";var createGeo=_dereq_("./geo"),getSubplotCalcData=_dereq_("../../plots/get_data").getSubplotCalcData,counterRegex=_dereq_("../../lib").counterRegex,GEO="geo";exports.name=GEO,exports.attr=GEO,exports.idRoot=GEO,exports.idRegex=exports.attrRegex=counterRegex(GEO),exports.attributes=_dereq_("./layout/attributes"),exports.layoutAttributes=_dereq_("./layout/layout_attributes"),exports.supplyLayoutDefaults=_dereq_("./layout/defaults"),exports.plot=function plotGeo(gd){var fullLayout=gd._fullLayout,calcData=gd.calcdata,geoIds=fullLayout._subplots.geo;void 0===window.PlotlyGeoAssets&&(window.PlotlyGeoAssets={topojson:{}});for(var i=0;i<geoIds.length;i++){var geoId=geoIds[i],geoCalcData=getSubplotCalcData(calcData,GEO,geoId),geo=fullLayout[geoId]._subplot;geo||(geo=createGeo({id:geoId,graphDiv:gd,container:fullLayout._geolayer.node(),topojsonURL:gd._context.topojsonURL,staticPlot:gd._context.staticPlot}),fullLayout[geoId]._subplot=geo),geo.plot(geoCalcData,fullLayout,gd._promises)}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldGeoKeys=oldFullLayout._subplots.geo||[],i=0;i<oldGeoKeys.length;i++){var oldGeoKey=oldGeoKeys[i],oldGeo=oldFullLayout[oldGeoKey]._subplot;!newFullLayout[oldGeoKey]&&oldGeo&&(oldGeo.framework.remove(),oldGeo.clipDef.remove())}},exports.updateFx=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.geo,i=0;i<subplotIds.length;i++){var subplotLayout=fullLayout[subplotIds[i]];subplotLayout._subplot.updateFx(fullLayout,subplotLayout)}}},{"../../lib":693,"../../plots/get_data":778,"./geo":771,"./layout/attributes":773,"./layout/defaults":774,"./layout/layout_attributes":775}],773:[function(_dereq_,module,exports){"use strict";module.exports={geo:{valType:"subplotid",dflt:"geo",editType:"calc"}}},{}],774:[function(_dereq_,module,exports){"use strict";var handleSubplotDefaults=_dereq_("../../subplot_defaults"),constants=_dereq_("../constants"),layoutAttributes=_dereq_("./layout_attributes"),axesNames=constants.axesNames;function handleGeoDefaults(geoLayoutIn,geoLayoutOut,coerce){var resolution=coerce("resolution"),scope=coerce("scope"),scopeParams=constants.scopeDefaults[scope],projType=coerce("projection.type",scopeParams.projType),isAlbersUsa=geoLayoutOut._isAlbersUsa="albers usa"===projType;isAlbersUsa&&(scope=geoLayoutOut.scope="usa");var isScoped=geoLayoutOut._isScoped="world"!==scope,isConic=geoLayoutOut._isConic=-1!==projType.indexOf("conic");geoLayoutOut._isClipped=!!constants.lonaxisSpan[projType];for(var i=0;i<axesNames.length;i++){var rangeDflt,axisName=axesNames[i],dtickDflt=[30,10][i];if(isScoped)rangeDflt=scopeParams[axisName+"Range"];else{var dfltSpans=constants[axisName+"Span"],hSpan=(dfltSpans[projType]||dfltSpans["*"])/2,rot=coerce("projection.rotation."+axisName.substr(0,3),scopeParams.projRotate[i]);rangeDflt=[rot-hSpan,rot+hSpan]}coerce(axisName+".tick0",coerce(axisName+".range",rangeDflt)[0]),coerce(axisName+".dtick",dtickDflt),coerce(axisName+".showgrid")&&(coerce(axisName+".gridcolor"),coerce(axisName+".gridwidth"))}var lonRange=geoLayoutOut.lonaxis.range,latRange=geoLayoutOut.lataxis.range,lon0=lonRange[0],lon1=lonRange[1];lon0>0&&lon1<0&&(lon1+=360);var projLon,centerLonDflt,centerLatDflt,centerLon=(lon0+lon1)/2;if(!isAlbersUsa){var dfltProjRotate=isScoped?scopeParams.projRotate:[centerLon,0,0];projLon=coerce("projection.rotation.lon",dfltProjRotate[0]),coerce("projection.rotation.lat",dfltProjRotate[1]),coerce("projection.rotation.roll",dfltProjRotate[2]),coerce("showcoastlines",!isScoped)&&(coerce("coastlinecolor"),coerce("coastlinewidth")),coerce("showocean")&&coerce("oceancolor")}(isAlbersUsa?(centerLonDflt=-96.6,centerLatDflt=38.7):(centerLonDflt=isScoped?centerLon:projLon,centerLatDflt=(latRange[0]+latRange[1])/2),coerce("center.lon",centerLonDflt),coerce("center.lat",centerLatDflt),isConic)&&coerce("projection.parallels",scopeParams.projParallels||[0,60]);coerce("projection.scale"),coerce("showland")&&coerce("landcolor"),coerce("showlakes")&&coerce("lakecolor"),coerce("showrivers")&&(coerce("rivercolor"),coerce("riverwidth")),coerce("showcountries",isScoped&&"usa"!==scope)&&(coerce("countrycolor"),coerce("countrywidth")),("usa"===scope||"north america"===scope&&50===resolution)&&(coerce("showsubunits",!0),coerce("subunitcolor"),coerce("subunitwidth")),isScoped||coerce("showframe",!0)&&(coerce("framecolor"),coerce("framewidth")),coerce("bgcolor")}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){handleSubplotDefaults(layoutIn,layoutOut,fullData,{type:"geo",attributes:layoutAttributes,handleDefaults:handleGeoDefaults,partition:"y"})}},{"../../subplot_defaults":820,"../constants":770,"./layout_attributes":775}],775:[function(_dereq_,module,exports){"use strict";var colorAttrs=_dereq_("../../../components/color/attributes"),domainAttrs=_dereq_("../../domain").attributes,constants=_dereq_("../constants"),overrideAll=_dereq_("../../../plot_api/edit_types").overrideAll,geoAxesAttrs={range:{valType:"info_array",items:[{valType:"number"},{valType:"number"}]},showgrid:{valType:"boolean",dflt:!1},tick0:{valType:"number"},dtick:{valType:"number"},gridcolor:{valType:"color",dflt:colorAttrs.lightLine},gridwidth:{valType:"number",min:0,dflt:1}};module.exports=overrideAll({domain:domainAttrs({name:"geo"},{}),resolution:{valType:"enumerated",values:[110,50],dflt:110,coerceNumber:!0},scope:{valType:"enumerated",values:Object.keys(constants.scopeDefaults),dflt:"world"},projection:{type:{valType:"enumerated",values:Object.keys(constants.projNames)},rotation:{lon:{valType:"number"},lat:{valType:"number"},roll:{valType:"number"}},parallels:{valType:"info_array",items:[{valType:"number"},{valType:"number"}]},scale:{valType:"number",min:0,dflt:1}},center:{lon:{valType:"number"},lat:{valType:"number"}},showcoastlines:{valType:"boolean"},coastlinecolor:{valType:"color",dflt:colorAttrs.defaultLine},coastlinewidth:{valType:"number",min:0,dflt:1},showland:{valType:"boolean",dflt:!1},landcolor:{valType:"color",dflt:constants.landColor},showocean:{valType:"boolean",dflt:!1},oceancolor:{valType:"color",dflt:constants.waterColor},showlakes:{valType:"boolean",dflt:!1},lakecolor:{valType:"color",dflt:constants.waterColor},showrivers:{valType:"boolean",dflt:!1},rivercolor:{valType:"color",dflt:constants.waterColor},riverwidth:{valType:"number",min:0,dflt:1},showcountries:{valType:"boolean"},countrycolor:{valType:"color",dflt:colorAttrs.defaultLine},countrywidth:{valType:"number",min:0,dflt:1},showsubunits:{valType:"boolean"},subunitcolor:{valType:"color",dflt:colorAttrs.defaultLine},subunitwidth:{valType:"number",min:0,dflt:1},showframe:{valType:"boolean"},framecolor:{valType:"color",dflt:colorAttrs.defaultLine},framewidth:{valType:"number",min:0,dflt:1},bgcolor:{valType:"color",dflt:colorAttrs.background},lonaxis:geoAxesAttrs,lataxis:geoAxesAttrs},"plot","from-root")},{"../../../components/color/attributes":566,"../../../plot_api/edit_types":725,"../../domain":767,"../constants":770}],776:[function(_dereq_,module,exports){"use strict";module.exports=function addProjectionsToD3(d3){function d3_geo_projectFeature(object,stream){return{type:"Feature",id:object.id,properties:object.properties,geometry:d3_geo_projectGeometry(object.geometry,stream)}}function d3_geo_projectGeometry(geometry,stream){if(!geometry)return null;if("GeometryCollection"===geometry.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(geometry){return d3_geo_projectGeometry(geometry,stream)})};if(!d3_geo_projectGeometryType.hasOwnProperty(geometry.type))return null;var sink=d3_geo_projectGeometryType[geometry.type];return d3.geo.stream(geometry,stream(sink)),sink.result()}d3.geo.project=function(object,projection){var stream=projection.stream;if(!stream)throw new Error("not yet supported");return(object&&d3_geo_projectObjectType.hasOwnProperty(object.type)?d3_geo_projectObjectType[object.type]:d3_geo_projectGeometry)(object,stream)};var d3_geo_projectObjectType={Feature:d3_geo_projectFeature,FeatureCollection:function(object,stream){return{type:"FeatureCollection",features:object.features.map(function(feature){return d3_geo_projectFeature(feature,stream)})}}},d3_geo_projectPoints=[],d3_geo_projectLines=[],d3_geo_projectPoint={point:function(x,y){d3_geo_projectPoints.push([x,y])},result:function(){var result=d3_geo_projectPoints.length?d3_geo_projectPoints.length<2?{type:"Point",coordinates:d3_geo_projectPoints[0]}:{type:"MultiPoint",coordinates:d3_geo_projectPoints}:null;return d3_geo_projectPoints=[],result}},d3_geo_projectLine={lineStart:d3_geo_projectNoop,point:function(x,y){d3_geo_projectPoints.push([x,y])},lineEnd:function(){d3_geo_projectPoints.length&&(d3_geo_projectLines.push(d3_geo_projectPoints),d3_geo_projectPoints=[])},result:function(){var result=d3_geo_projectLines.length?d3_geo_projectLines.length<2?{type:"LineString",coordinates:d3_geo_projectLines[0]}:{type:"MultiLineString",coordinates:d3_geo_projectLines}:null;return d3_geo_projectLines=[],result}},d3_geo_projectPolygon={polygonStart:d3_geo_projectNoop,lineStart:d3_geo_projectNoop,point:function(x,y){d3_geo_projectPoints.push([x,y])},lineEnd:function(){var n=d3_geo_projectPoints.length;if(n){do{d3_geo_projectPoints.push(d3_geo_projectPoints[0].slice())}while(++n<4);d3_geo_projectLines.push(d3_geo_projectPoints),d3_geo_projectPoints=[]}},polygonEnd:d3_geo_projectNoop,result:function(){if(!d3_geo_projectLines.length)return null;var polygons=[],holes=[];return d3_geo_projectLines.forEach(function(ring){!function d3_geo_projectClockwise(ring){if((n=ring.length)<4)return!1;for(var n,i=0,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];++i<n;)area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];return area<=0}(ring)?holes.push(ring):polygons.push([ring])}),holes.forEach(function(hole){var point=hole[0];polygons.some(function(polygon){if(function d3_geo_projectContains(ring,point){for(var x=point[0],y=point[1],contains=!1,i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];yi>y^yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(contains=!contains)}return contains}(polygon[0],point))return polygon.push(hole),!0})||polygons.push([hole])}),d3_geo_projectLines=[],polygons.length?polygons.length>1?{type:"MultiPolygon",coordinates:polygons}:{type:"Polygon",coordinates:polygons[0]}:null}},d3_geo_projectGeometryType={Point:d3_geo_projectPoint,MultiPoint:d3_geo_projectPoint,LineString:d3_geo_projectLine,MultiLineString:d3_geo_projectLine,Polygon:d3_geo_projectPolygon,MultiPolygon:d3_geo_projectPolygon,Sphere:d3_geo_projectPolygon};function d3_geo_projectNoop(){}var =1e-6,2=*,=Math.PI,half=/2,radians=(Math.sqrt(),/180),degrees=180/;function asin(x){return x>1?half:x<-1?-half:Math.asin(x)}function acos(x){return x>1?0:x<-1?:Math.acos(x)}var projection=d3.geo.projection,projectionMutator=d3.geo.projectionMutator;function eckert4(,){var k=(2+half)*Math.sin();/=2;for(var i=0,=1/0;i<10&&Math.abs()>;i++){var cos=Math.cos();-==(+Math.sin()*(cos+2)-k)/(2*cos*(1+cos))}return[2/Math.sqrt(*(4+))**(1+Math.cos()),2*Math.sqrt(/(4+))*Math.sin()]}d3.geo.interrupt=function(project){var bounds,lobes=[[[[-,0],[0,half],[,0]]],[[[-,0],[0,-half],[,0]]]];function forward(,){for(var sign=<0?-1:1,hemilobes=lobes[+(<0)],i=0,n=hemilobes.length-1;i<n&&>hemilobes[i][2][0];++i);var coordinates=project(-hemilobes[i][1][0],);return coordinates[0]+=project(hemilobes[i][1][0],sign*>sign*hemilobes[i][0][1]?hemilobes[i][0][1]:)[0],coordinates}project.invert&&(forward.invert=function(x,y){for(var hemibounds=bounds[+(y<0)],hemilobes=lobes[+(y<0)],i=0,n=hemibounds.length;i<n;++i){var b=hemibounds[i];if(b[0][0]<=x&&x<b[1][0]&&b[0][1]<=y&&y<b[1][1]){var coordinates=project.invert(x-project(hemilobes[i][1][0],0)[0],y);return coordinates[0]+=hemilobes[i][1][0],pointEqual(forward(coordinates[0],coordinates[1]),[x,y])?coordinates:null}}});var projection=d3.geo.projection(forward),stream_=projection.stream;function resample(coordinates,m){for(var p1,dx,dy,i=-1,n=coordinates.length,p0=coordinates[0],resampled=[];++i<n;){dx=((p1=coordinates[i])[0]-p0[0])/m,dy=(p1[1]-p0[1])/m;for(var j=0;j<m;++j)resampled.push([p0[0]+j*dx,p0[1]+j*dy]);p0=p1}return resampled.push(p1),resampled}function pointEqual(a,b){return Math.abs(a[0]-b[0])<&&Math.abs(a[1]-b[1])<}return projection.stream=function(stream){var rotate=projection.rotate(),rotateStream=stream_(stream),sphereStream=(projection.rotate([0,0]),stream_(stream));return projection.rotate(rotate),rotateStream.sphere=function(){d3.geo.stream(function sphere(){for(var =1e-6,coordinates=[],i=0,n=lobes[0].length;i<n;++i){var lobe=lobes[0][i],0=180*lobe[0][0]/,0=180*lobe[0][1]/,1=180*lobe[1][1]/,2=180*lobe[2][0]/,2=180*lobe[2][1]/;coordinates.push(resample([[0+,0+],[0+,1-],[2-,1-],[2-,2+]],30))}for(var i=lobes[1].length-1;i>=0;--i){var lobe=lobes[1][i],0=180*lobe[0][0]/,0=180*lobe[0][1]/,1=180*lobe[1][1]/,2=180*lobe[2][0]/,2=180*lobe[2][1]/;coordinates.push(resample([[2-,2-],[2-,1+],[0+,1+],[0+,0-]],30))}return{type:"Polygon",coordinates:[d3.merge(coordinates)]}}(),sphereStream)},rotateStream},projection.lobes=function(_){return arguments.length?(lobes=_.map(function(lobes){return lobes.map(function(lobe){return[[lobe[0][0]*/180,lobe[0][1]*/180],[lobe[1][0]*/180,lobe[1][1]*/180],[lobe[2][0]*/180,lobe[2][1]*/180]]})}),function reset(){bounds=lobes.map(function(hemilobes){return hemilobes.map(function(lobe){var t,x0=project(lobe[0][0],lobe[0][1])[0],x1=project(lobe[2][0],lobe[2][1])[0],y0=project(lobe[1][0],lobe[0][1])[1],y1=project(lobe[1][0],lobe[1][1])[1];return y0>y1&&(t=y0,y0=y1,y1=t),[[x0,y0],[x1,y1]]})})}(),projection):lobes.map(function(lobes){return lobes.map(function(lobe){return[[180*lobe[0][0]/,180*lobe[0][1]/],[180*lobe[1][0]/,180*lobe[1][1]/],[180*lobe[2][0]/,180*lobe[2][1]/]]})})},projection},eckert4.invert=function(x,y){var A=.5*y*Math.sqrt((4+)/),k=asin(A),c=Math.cos(k);return[x/(2/Math.sqrt(*(4+))*(1+c)),asin((k+A*(c+2))/(2+half))]},(d3.geo.eckert4=function(){return projection(eckert4)}).raw=eckert4;var hammerAzimuthalEqualArea=d3.geo.azimuthalEqualArea.raw;function hammer(A,B){if(arguments.length<2&&(B=A),1===B)return hammerAzimuthalEqualArea;if(B===1/0)return hammerQuarticAuthalic;function forward(,){var coordinates=hammerAzimuthalEqualArea(/B,);return coordinates[0]*=A,coordinates}return forward.invert=function(x,y){var coordinates=hammerAzimuthalEqualArea.invert(x/A,y);return coordinates[0]*=B,coordinates},forward}function hammerQuarticAuthalic(,){return[*Math.cos()/Math.cos(/=2),2*Math.sin()]}function kavrayskiy7(,){return[3*/(2*)*Math.sqrt(*/3-*),]}function miller(,){return[,1.25*Math.log(Math.tan(/4+.4*))]}function mollweideBromley(Cp){return function(){var ,Cpsin=Cp*Math.sin(),i=30;do{-==(+Math.sin()-Cpsin)/(1+Math.cos())}while(Math.abs()>&&--i>0);return /2}}hammerQuarticAuthalic.invert=function(x,y){var =2*asin(y/2);return[x*Math.cos(/2)/Math.cos(),]},(d3.geo.hammer=function hammerProjection(){var B=2,m=projectionMutator(hammer),p=m(B);return p.coefficient=function(_){return arguments.length?m(B=+_):B},p}).raw=hammer,kavrayskiy7.invert=function(x,y){return[2/3**x/Math.sqrt(*/3-y*y),y]},(d3.geo.kavrayskiy7=function(){return projection(kavrayskiy7)}).raw=kavrayskiy7,miller.invert=function(x,y){return[x,2.5*Math.atan(Math.exp(.8*y))-.625*]},(d3.geo.miller=function(){return projection(miller)}).raw=miller,mollweideBromley();var mollweide=function mollweideBromley(Cx,Cy,Cp){var =mollweideBromley(Cp);function forward(,){return[Cx**Math.cos(=()),Cy*Math.sin()]}return forward.invert=function(x,y){var =asin(y/Cy);return[x/(Cx*Math.cos()),asin((2*+Math.sin(2*))/Cp)]},forward}(Math.SQRT2/half,Math.SQRT2,);function naturalEarth(,){var 2=*,4=2*2;return[*(.8707-.131979*2+4*(4*(.003971*2-.001529*4)-.013791)),*(1.007226+2*(.015085+4*(.028874*2-.044475-.005916*4)))]}(d3.geo.mollweide=function(){return projection(mollweide)}).raw=mollweide,naturalEarth.invert=function(x,y){var ,=y,i=25;do{var 2=*,4=2*2;-==(*(1.007226+2*(.015085+4*(.028874*2-.044475-.005916*4)))-y)/(1.007226+2*(.045255+4*(.259866*2-.311325-.005916*11*4)))}while(Math.abs()>&&--i>0);return[x/(.8707+(2=*)*(2*(2*2*2*(.003971-.001529*2)-.013791)-.131979)),]},(d3.geo.naturalEarth=function(){return projection(naturalEarth)}).raw=naturalEarth;var robinsonConstants=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function robinson(,){var k,i=Math.min(18,36*Math.abs()/),i0=Math.floor(i),di=i-i0,ax=(k=robinsonConstants[i0])[0],ay=k[1],bx=(k=robinsonConstants[++i0])[0],by=k[1],cx=(k=robinsonConstants[Math.min(19,++i0)])[0],cy=k[1];return[*(bx+di*(cx-ax)/2+di*di*(cx-2*bx+ax)/2),(>0?half:-half)*(by+di*(cy-ay)/2+di*di*(cy-2*by+ay)/2)]}function sinusoidal(,){return[*Math.cos(),]}function aitoff(,){var cos=Math.cos(),sinci=function sinci(x){return x?x/Math.sin(x):1}(acos(cos*Math.cos(/=2)));return[2*cos*Math.sin()*sinci,Math.sin()*sinci]}function winkel3(,){var coordinates=aitoff(,);return[(coordinates[0]+/half)/2,(coordinates[1]+)/2]}robinsonConstants.forEach(function(d){d[1]*=1.0144}),robinson.invert=function(x,y){var yy=y/half,=90*yy,i=Math.min(18,Math.abs(/5)),i0=Math.max(0,Math.floor(i));do{var ay=robinsonConstants[i0][1],by=robinsonConstants[i0+1][1],cy=robinsonConstants[Math.min(19,i0+2)][1],u=cy-ay,v=cy-2*by+ay,t=2*(Math.abs(yy)-by)/u,c=v/u,di=t*(1-c*t*(1-2*c*t));if(di>=0||1===i0){=(y>=0?5:-5)*(di+i);var ,j=50;do{di=(i=Math.min(18,Math.abs()/5))-(i0=Math.floor(i)),ay=robinsonConstants[i0][1],by=robinsonConstants[i0+1][1],cy=robinsonConstants[Math.min(19,i0+2)][1],-=(=(y>=0?half:-half)*(by+di*(cy-ay)/2+di*di*(cy-2*by+ay)/2)-y)*degrees}while(Math.abs()>2&&--j>0);break}}while(--i0>=0);var ax=robinsonConstants[i0][0],bx=robinsonConstants[i0+1][0],cx=robinsonConstants[Math.min(19,i0+2)][0];return[x/(bx+di*(cx-ax)/2+di*di*(cx-2*bx+ax)/2),*radians]},(d3.geo.robinson=function(){return projection(robinson)}).raw=robinson,sinusoidal.invert=function(x,y){return[x/Math.cos(y),y]},(d3.geo.sinusoidal=function(){return projection(sinusoidal)}).raw=sinusoidal,aitoff.invert=function(x,y){if(!(x*x+4*y*y>*+)){var =x,=y,i=25;do{var F,sin=Math.sin(),sin_2=Math.sin(/2),cos_2=Math.cos(/2),sin=Math.sin(),cos=Math.cos(),sin_2=Math.sin(2*),sin2=sin*sin,cos2=cos*cos,sin2_2=sin_2*sin_2,C=1-cos2*cos_2*cos_2,E=C?acos(cos*cos_2)*Math.sqrt(F=1/C):F=0,fx=2*E*cos*sin_2-x,fy=E*sin-y,x=F*(cos2*sin2_2+E*cos*cos_2*sin2),x=F*(.5*sin*sin_2-2*E*sin*sin_2),y=.25*F*(sin_2*sin_2-E*sin*cos2*sin),y=F*(sin2*cos_2+E*sin2_2*cos),denominator=x*y-y*x;if(!denominator)break;var =(fy*x-fx*y)/denominator,=(fx*y-fy*x)/denominator;-=,-=}while((Math.abs()>||Math.abs()>)&&--i>0);return[,]}},(d3.geo.aitoff=function(){return projection(aitoff)}).raw=aitoff,winkel3.invert=function(x,y){var =x,=y,i=25;do{var F,cos=Math.cos(),sin=Math.sin(),sin_2=Math.sin(2*),sin2=sin*sin,cos2=cos*cos,sin=Math.sin(),cos_2=Math.cos(/2),sin_2=Math.sin(/2),sin2_2=sin_2*sin_2,C=1-cos2*cos_2*cos_2,E=C?acos(cos*cos_2)*Math.sqrt(F=1/C):F=0,fx=.5*(2*E*cos*sin_2+/half)-x,fy=.5*(E*sin+)-y,x=.5*F*(cos2*sin2_2+E*cos*cos_2*sin2)+.5/half,x=F*(sin*sin_2/4-E*sin*sin_2),y=.125*F*(sin_2*sin_2-E*sin*cos2*sin),y=.5*F*(sin2*cos_2+E*sin2_2*cos)+.5,denominator=x*y-y*x,=(fy*x-fx*y)/denominator,=(fx*y-fy*x)/denominator;-=,-=}while((Math.abs()>||Math.abs()>)&&--i>0);return[,]},(d3.geo.winkel3=function(){return projection(winkel3)}).raw=winkel3}},{}],777:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),radians=Math.PI/180,degrees=180/Math.PI,zoomstartStyle={cursor:"pointer"},zoomendStyle={cursor:"auto"};function initZoom(geo,projection){return d3.behavior.zoom().translate(projection.translate()).scale(projection.scale())}function sync(geo,projection,cb){var id=geo.id,gd=geo.graphDiv,userOpts=gd.layout[id],fullOpts=gd._fullLayout[id],eventData={};function set(propStr,val){var fullNp=Lib.nestedProperty(fullOpts,propStr);fullNp.get()!==val&&(fullNp.set(val),Lib.nestedProperty(userOpts,propStr).set(val),eventData[id+"."+propStr]=val)}cb(set),set("projection.scale",projection.scale()/geo.fitScale),gd.emit("plotly_relayout",eventData)}function zoomScoped(geo,projection){var zoom=initZoom(0,projection);function syncCb(set){var center=projection.invert(geo.midPt);set("center.lon",center[0]),set("center.lat",center[1])}return zoom.on("zoomstart",function handleZoomstart(){d3.select(this).style(zoomstartStyle)}).on("zoom",function handleZoom(){projection.scale(d3.event.scale).translate(d3.event.translate),geo.render()}).on("zoomend",function handleZoomend(){d3.select(this).style(zoomendStyle),sync(geo,projection,syncCb)}),zoom}function zoomNonClipped(geo,projection){var mouse0,rotate0,translate0,lastRotate,zoomPoint,mouse1,rotate1,point1,didZoom,zoom=initZoom(0,projection),INSIDETOLORANCEPXS=2;function position(x){return projection.invert(x)}function syncCb(set){var rotate=projection.rotate(),center=projection.invert(geo.midPt);set("projection.rotation.lon",-rotate[0]),set("center.lon",center[0]),set("center.lat",center[1])}return zoom.on("zoomstart",function handleZoomstart(){d3.select(this).style(zoomstartStyle),mouse0=d3.mouse(this),rotate0=projection.rotate(),translate0=projection.translate(),lastRotate=rotate0,zoomPoint=position(mouse0)}).on("zoom",function handleZoom(){if(mouse1=d3.mouse(this),function outside(x){var pos=position(x);if(!pos)return!0;var pt=projection(pos);return Math.abs(pt[0]-x[0])>INSIDETOLORANCEPXS||Math.abs(pt[1]-x[1])>INSIDETOLORANCEPXS}(mouse0))return zoom.scale(projection.scale()),void zoom.translate(projection.translate());projection.scale(d3.event.scale),projection.translate([translate0[0],d3.event.translate[1]]),zoomPoint?position(mouse1)&&(point1=position(mouse1),rotate1=[lastRotate[0]+(point1[0]-zoomPoint[0]),rotate0[1],rotate0[2]],projection.rotate(rotate1),lastRotate=rotate1):zoomPoint=position(mouse0=mouse1),didZoom=!0,geo.render()}).on("zoomend",function handleZoomend(){d3.select(this).style(zoomendStyle),didZoom&&sync(geo,projection,syncCb)}),zoom}function zoomClipped(geo,projection){var zoomPoint,view={r:projection.rotate(),k:projection.scale()},zoom=initZoom(0,projection),event=function d3_eventDispatch(target){var i=0,n=arguments.length,argumentz=[];for(;++i<n;)argumentz.push(arguments[i]);var dispatch=d3.dispatch.apply(null,argumentz);return dispatch.of=function(thiz,argumentz){return function(e1){var e0;try{e0=e1.sourceEvent=d3.event,e1.target=target,d3.event=e1,dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}},dispatch}(zoom,"zoomstart","zoom","zoomend"),zooming=0,zoomOn=zoom.on;function syncCb(set){var _rotate=projection.rotate();set("projection.rotation.lon",-_rotate[0]),set("projection.rotation.lat",-_rotate[1])}return zoom.on("zoomstart",function(){d3.select(this).style(zoomstartStyle);var mouse0=d3.mouse(this),rotate0=projection.rotate(),lastRotate=rotate0,translate0=projection.translate(),q=function quaternionFromEuler(euler){var lambda=.5*euler[0]*radians,phi=.5*euler[1]*radians,gamma=.5*euler[2]*radians,sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda),sinPhi=Math.sin(phi),cosPhi=Math.cos(phi),sinGamma=Math.sin(gamma),cosGamma=Math.cos(gamma);return[cosLambda*cosPhi*cosGamma+sinLambda*sinPhi*sinGamma,sinLambda*cosPhi*cosGamma-cosLambda*sinPhi*sinGamma,cosLambda*sinPhi*cosGamma+sinLambda*cosPhi*sinGamma,cosLambda*cosPhi*sinGamma-sinLambda*sinPhi*cosGamma]}(rotate0);zoomPoint=position(projection,mouse0),zoomOn.call(zoom,"zoom",function(){var mouse1=d3.mouse(this);if(projection.scale(view.k=d3.event.scale),zoomPoint){if(position(projection,mouse1)){projection.rotate(rotate0).translate(translate0);var point1=position(projection,mouse1),between=function rotateBetween(a,b){if(!a||!b)return;var axis=function cross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}(a,b),norm=Math.sqrt(dot(axis,axis)),halfgamma=.5*Math.acos(Math.max(-1,Math.min(1,dot(a,b)))),k=Math.sin(halfgamma)/norm;return norm&&[Math.cos(halfgamma),axis[2]*k,-axis[1]*k,axis[0]*k]}(zoomPoint,point1),newEuler=function eulerFromQuaternion(q){return[Math.atan2(2*(q[0]*q[1]+q[2]*q[3]),1-2*(q[1]*q[1]+q[2]*q[2]))*degrees,Math.asin(Math.max(-1,Math.min(1,2*(q[0]*q[2]-q[3]*q[1]))))*degrees,Math.atan2(2*(q[0]*q[3]+q[1]*q[2]),1-2*(q[2]*q[2]+q[3]*q[3]))*degrees]}(function multiply(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return[a0*b0-a1*b1-a2*b2-a3*b3,a0*b1+a1*b0+a2*b3-a3*b2,a0*b2-a1*b3+a2*b0+a3*b1,a0*b3+a1*b2-a2*b1+a3*b0]}(q,between)),rotateAngles=view.r=function unRoll(rotateAngles,pt,lastRotate){var ptRotated=rotateCartesian(pt,2,rotateAngles[0]);ptRotated=rotateCartesian(ptRotated=rotateCartesian(ptRotated,1,rotateAngles[1]),0,rotateAngles[2]-lastRotate[2]);var b,newYaw1,x=pt[0],y=pt[1],z=pt[2],f=ptRotated[0],g=ptRotated[1],h=ptRotated[2],theta=Math.atan2(y,x)*degrees,a=Math.sqrt(x*x+y*y);Math.abs(g)>a?(newYaw1=(g>0?90:-90)-theta,b=0):(newYaw1=Math.asin(g/a)*degrees-theta,b=Math.sqrt(a*a-g*g));var newYaw2=180-newYaw1-2*theta,newPitch1=(Math.atan2(h,f)-Math.atan2(z,b))*degrees,newPitch2=(Math.atan2(h,f)-Math.atan2(z,-b))*degrees,dist1=angleDistance(lastRotate[0],lastRotate[1],newYaw1,newPitch1),dist2=angleDistance(lastRotate[0],lastRotate[1],newYaw2,newPitch2);return dist1<=dist2?[newYaw1,newPitch1,lastRotate[2]]:[newYaw2,newPitch2,lastRotate[2]]}(newEuler,zoomPoint,lastRotate);isFinite(rotateAngles[0])&&isFinite(rotateAngles[1])&&isFinite(rotateAngles[2])||(rotateAngles=lastRotate),projection.rotate(rotateAngles),lastRotate=rotateAngles}}else zoomPoint=position(projection,mouse0=mouse1);!function zoomed(dispatch){dispatch({type:"zoom"})}(event.of(this,arguments))}),function zoomstarted(dispatch){zooming++||dispatch({type:"zoomstart"})}(event.of(this,arguments))}).on("zoomend",function(){d3.select(this).style(zoomendStyle),zoomOn.call(zoom,"zoom",null),function zoomended(dispatch){--zooming||dispatch({type:"zoomend"})}(event.of(this,arguments)),sync(geo,projection,syncCb)}).on("zoom.redraw",function(){geo.render()}),d3.rebind(zoom,event,"on")}function position(projection,point){var spherical=projection.invert(point);return spherical&&isFinite(spherical[0])&&isFinite(spherical[1])&&function cartesian(spherical){var lambda=spherical[0]*radians,phi=spherical[1]*radians,cosPhi=Math.cos(phi);return[cosPhi*Math.cos(lambda),cosPhi*Math.sin(lambda),Math.sin(phi)]}(spherical)}function angleDistance(yaw0,pitch0,yaw1,pitch1){var dYaw=angleMod(yaw1-yaw0),dPitch=angleMod(pitch1-pitch0);return Math.sqrt(dYaw*dYaw+dPitch*dPitch)}function angleMod(angle){return(angle%360+540)%360-180}function rotateCartesian(vector,axis,angle){var angleRads=angle*radians,vectorOut=vector.slice(),ax1=0===axis?1:0,ax2=2===axis?1:2,cosa=Math.cos(angleRads),sina=Math.sin(angleRads);return vectorOut[ax1]=vector[ax1]*cosa-vector[ax2]*sina,vectorOut[ax2]=vector[ax2]*cosa+vector[ax1]*sina,vectorOut}function dot(a,b){for(var s=0,i=0,n=a.length;i<n;++i)s+=a[i]*b[i];return s}module.exports=function createGeoZoom(geo,geoLayout){var projection=geo.projection;return(geoLayout._isScoped?zoomScoped:geoLayout._isClipped?zoomClipped:zoomNonClipped)(geo,projection)}},{"../../lib":693,d3:147}],778:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../registry"),SUBPLOT_PATTERN=_dereq_("./cartesian/constants").SUBPLOT_PATTERN;exports.getSubplotCalcData=function(calcData,type,subplotId){var basePlotModule=Registry.subplotsRegistry[type];if(!basePlotModule)return[];for(var attr=basePlotModule.attr,subplotCalcData=[],i=0;i<calcData.length;i++){var calcTrace=calcData[i];calcTrace[0].trace[attr]===subplotId&&subplotCalcData.push(calcTrace)}return subplotCalcData},exports.getModuleCalcData=function(calcdata,arg1){var plotMethod,moduleCalcData=[],remainingCalcData=[];if(!(plotMethod="string"==typeof arg1?Registry.getModule(arg1).plot:"function"==typeof arg1?arg1:arg1.plot))return[moduleCalcData,calcdata];for(var i=0;i<calcdata.length;i++){var cd=calcdata[i],trace=cd[0].trace;!0===trace.visible&&(trace._module.plot===plotMethod?moduleCalcData.push(cd):remainingCalcData.push(cd))}return[moduleCalcData,remainingCalcData]},exports.getSubplotData=function getSubplotData(data,type,subplotId){if(!Registry.subplotsRegistry[type])return[];var trace,subplotX,subplotY,attr=Registry.subplotsRegistry[type].attr,subplotData=[];if("gl2d"===type){var spmatch=subplotId.match(SUBPLOT_PATTERN);subplotX="x"+spmatch[1],subplotY="y"+spmatch[2]}for(var i=0;i<data.length;i++)trace=data[i],"gl2d"===type&&Registry.traceIs(trace,"gl2d")?trace[attr[0]]===subplotX&&trace[attr[1]]===subplotY&&subplotData.push(trace):trace[attr]===subplotId&&subplotData.push(trace);return subplotData}},{"../registry":825,"./cartesian/constants":747}],779:[function(_dereq_,module,exports){"use strict";var mouseChange=_dereq_("mouse-change"),mouseWheel=_dereq_("mouse-wheel"),mouseOffset=_dereq_("mouse-event-offset"),cartesianConstants=_dereq_("../cartesian/constants"),hasPassive=_dereq_("has-passive-events");module.exports=function createCamera(scene){var element=scene.mouseContainer,plot=scene.glplot,result=new function Camera2D(element,plot){this.element=element,this.plot=plot,this.mouseListener=null,this.wheelListener=null,this.lastInputTime=Date.now(),this.lastPos=[0,0],this.boxEnabled=!1,this.boxInited=!1,this.boxStart=[0,0],this.boxEnd=[0,0],this.dragStart=[0,0]}(element,plot);function unSetAutoRange(){scene.xaxis.autorange=!1,scene.yaxis.autorange=!1}function handleInteraction(buttons,x,y){var dx,dy,dataBox=scene.calcDataBox(),viewBox=plot.viewBox,lastX=result.lastPos[0],lastY=result.lastPos[1],MINDRAG=cartesianConstants.MINDRAG*plot.pixelRatio,MINZOOM=cartesianConstants.MINZOOM*plot.pixelRatio;function updateRange(i0,start,end){var range0=Math.min(start,end),range1=Math.max(start,end);range0!==range1?(dataBox[i0]=range0,dataBox[i0+2]=range1,result.dataBox=dataBox,scene.setRanges(dataBox)):(scene.selectBox.selectBox=[0,0,1,1],scene.glplot.setDirty())}switch(x*=plot.pixelRatio,y*=plot.pixelRatio,y=viewBox[3]-viewBox[1]-y,scene.fullLayout.dragmode){case"zoom":if(buttons){var dataX=x/(viewBox[2]-viewBox[0])*(dataBox[2]-dataBox[0])+dataBox[0],dataY=y/(viewBox[3]-viewBox[1])*(dataBox[3]-dataBox[1])+dataBox[1];result.boxInited||(result.boxStart[0]=dataX,result.boxStart[1]=dataY,result.dragStart[0]=x,result.dragStart[1]=y),result.boxEnd[0]=dataX,result.boxEnd[1]=dataY,result.boxInited=!0,result.boxEnabled||result.boxStart[0]===result.boxEnd[0]&&result.boxStart[1]===result.boxEnd[1]||(result.boxEnabled=!0);var smallDx=Math.abs(result.dragStart[0]-x)<MINZOOM,smallDy=Math.abs(result.dragStart[1]-y)<MINZOOM;if(!function getSubplotConstraint(){for(var constraints=scene.graphDiv._fullLayout._axisConstraintGroups,xaId=scene.xaxis._id,yaId=scene.yaxis._id,i=0;i<constraints.length;i++)if(-1!==constraints[i][xaId]){if(-1!==constraints[i][yaId])return!0;break}return!1}()||smallDx&&smallDy)smallDx&&(result.boxEnd[0]=result.boxStart[0]),smallDy&&(result.boxEnd[1]=result.boxStart[1]);else{dx=result.boxEnd[0]-result.boxStart[0],dy=result.boxEnd[1]-result.boxStart[1];var dydx=(dataBox[3]-dataBox[1])/(dataBox[2]-dataBox[0]);Math.abs(dx*dydx)>Math.abs(dy)?(result.boxEnd[1]=result.boxStart[1]+Math.abs(dx)*dydx*(dy>=0?1:-1),result.boxEnd[1]<dataBox[1]?(result.boxEnd[1]=dataBox[1],result.boxEnd[0]=result.boxStart[0]+(dataBox[1]-result.boxStart[1])/Math.abs(dydx)):result.boxEnd[1]>dataBox[3]&&(result.boxEnd[1]=dataBox[3],result.boxEnd[0]=result.boxStart[0]+(dataBox[3]-result.boxStart[1])/Math.abs(dydx))):(result.boxEnd[0]=result.boxStart[0]+Math.abs(dy)/dydx*(dx>=0?1:-1),result.boxEnd[0]<dataBox[0]?(result.boxEnd[0]=dataBox[0],result.boxEnd[1]=result.boxStart[1]+(dataBox[0]-result.boxStart[0])*Math.abs(dydx)):result.boxEnd[0]>dataBox[2]&&(result.boxEnd[0]=dataBox[2],result.boxEnd[1]=result.boxStart[1]+(dataBox[2]-result.boxStart[0])*Math.abs(dydx)))}}else result.boxEnabled?(dx=result.boxStart[0]!==result.boxEnd[0],dy=result.boxStart[1]!==result.boxEnd[1],dx||dy?(dx&&(updateRange(0,result.boxStart[0],result.boxEnd[0]),scene.xaxis.autorange=!1),dy&&(updateRange(1,result.boxStart[1],result.boxEnd[1]),scene.yaxis.autorange=!1),scene.relayoutCallback()):scene.glplot.setDirty(),result.boxEnabled=!1,result.boxInited=!1):result.boxInited&&(result.boxInited=!1);break;case"pan":result.boxEnabled=!1,result.boxInited=!1,buttons?(result.panning||(result.dragStart[0]=x,result.dragStart[1]=y),Math.abs(result.dragStart[0]-x)<MINDRAG&&(x=result.dragStart[0]),Math.abs(result.dragStart[1]-y)<MINDRAG&&(y=result.dragStart[1]),dx=(lastX-x)*(dataBox[2]-dataBox[0])/(plot.viewBox[2]-plot.viewBox[0]),dy=(lastY-y)*(dataBox[3]-dataBox[1])/(plot.viewBox[3]-plot.viewBox[1]),dataBox[0]+=dx,dataBox[2]+=dx,dataBox[1]+=dy,dataBox[3]+=dy,scene.setRanges(dataBox),result.panning=!0,result.lastInputTime=Date.now(),unSetAutoRange(),scene.cameraChanged(),scene.handleAnnotations()):result.panning&&(result.panning=!1,scene.relayoutCallback())}result.lastPos[0]=x,result.lastPos[1]=y}return result.mouseListener=mouseChange(element,handleInteraction),element.addEventListener("touchstart",function(ev){var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(0,xy[0],xy[1]),handleInteraction(1,xy[0],xy[1]),ev.preventDefault()},!!hasPassive&&{passive:!1}),element.addEventListener("touchmove",function(ev){ev.preventDefault();var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(1,xy[0],xy[1]),ev.preventDefault()},!!hasPassive&&{passive:!1}),element.addEventListener("touchend",function(ev){handleInteraction(0,result.lastPos[0],result.lastPos[1]),ev.preventDefault()},!!hasPassive&&{passive:!1}),result.wheelListener=mouseWheel(element,function(dx,dy){if(!scene.scrollZoom)return!1;var dataBox=scene.calcDataBox(),viewBox=plot.viewBox,lastX=result.lastPos[0],lastY=result.lastPos[1],scale=Math.exp(5*dy/(viewBox[3]-viewBox[1])),cx=lastX/(viewBox[2]-viewBox[0])*(dataBox[2]-dataBox[0])+dataBox[0],cy=lastY/(viewBox[3]-viewBox[1])*(dataBox[3]-dataBox[1])+dataBox[1];return dataBox[0]=(dataBox[0]-cx)*scale+cx,dataBox[2]=(dataBox[2]-cx)*scale+cx,dataBox[1]=(dataBox[1]-cy)*scale+cy,dataBox[3]=(dataBox[3]-cy)*scale+cy,scene.setRanges(dataBox),result.lastInputTime=Date.now(),unSetAutoRange(),scene.cameraChanged(),scene.handleAnnotations(),scene.relayoutCallback(),!0},!0),result}},{"../cartesian/constants":747,"has-passive-events":392,"mouse-change":415,"mouse-event-offset":416,"mouse-wheel":418}],780:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../cartesian/axes"),convertHTMLToUnicode=_dereq_("../../lib/html2unicode"),str2RGBArray=_dereq_("../../lib/str2rgbarray");function Axes2DOptions(scene){this.scene=scene,this.gl=scene.gl,this.pixelRatio=scene.pixelRatio,this.screenBox=[0,0,1,1],this.viewBox=[0,0,1,1],this.dataBox=[-1,-1,1,1],this.borderLineEnable=[!1,!1,!1,!1],this.borderLineWidth=[1,1,1,1],this.borderLineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.ticks=[[],[]],this.tickEnable=[!0,!0,!1,!1],this.tickPad=[15,15,15,15],this.tickAngle=[0,0,0,0],this.tickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.tickMarkLength=[0,0,0,0],this.tickMarkWidth=[0,0,0,0],this.tickMarkColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.labels=["x","y"],this.labelEnable=[!0,!0,!1,!1],this.labelAngle=[0,Math.PI/2,0,3*Math.PI/2],this.labelPad=[15,15,15,15],this.labelSize=[12,12],this.labelFont=["sans-serif","sans-serif"],this.labelColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.title="",this.titleEnable=!0,this.titleCenter=[0,0,0,0],this.titleAngle=0,this.titleColor=[0,0,0,1],this.titleFont="sans-serif",this.titleSize=18,this.gridLineEnable=[!0,!0],this.gridLineColor=[[0,0,0,.5],[0,0,0,.5]],this.gridLineWidth=[1,1],this.zeroLineEnable=[!0,!0],this.zeroLineWidth=[1,1],this.zeroLineColor=[[0,0,0,1],[0,0,0,1]],this.borderColor=!1,this.backgroundColor=[0,0,0,0],this.static=this.scene.staticPlot}var proto=Axes2DOptions.prototype,AXES=["xaxis","yaxis"];proto.merge=function(options){var axisName,ax,axTitle,axMirror,hasAxisInDfltPos,hasAxisInAltrPos,hasSharedAxis,mirrorLines,mirrorTicks,i,j;for(this.titleEnable=!1,this.backgroundColor=str2RGBArray(options.plot_bgcolor),i=0;i<2;++i){var axisLetter=(axisName=AXES[i]).charAt(0);for(axTitle=(ax=options[this.scene[axisName]._name]).title===this.scene.fullLayout._dfltTitle[axisLetter]?"":ax.title,j=0;j<=2;j+=2)this.labelEnable[i+j]=!1,this.labels[i+j]=convertHTMLToUnicode(axTitle),this.labelColor[i+j]=str2RGBArray(ax.titlefont.color),this.labelFont[i+j]=ax.titlefont.family,this.labelSize[i+j]=ax.titlefont.size,this.labelPad[i+j]=this.getLabelPad(axisName,ax),this.tickEnable[i+j]=!1,this.tickColor[i+j]=str2RGBArray((ax.tickfont||{}).color),this.tickAngle[i+j]="auto"===ax.tickangle?0:Math.PI*-ax.tickangle/180,this.tickPad[i+j]=this.getTickPad(ax),this.tickMarkLength[i+j]=0,this.tickMarkWidth[i+j]=ax.tickwidth||0,this.tickMarkColor[i+j]=str2RGBArray(ax.tickcolor),this.borderLineEnable[i+j]=!1,this.borderLineColor[i+j]=str2RGBArray(ax.linecolor),this.borderLineWidth[i+j]=ax.linewidth||0;hasSharedAxis=this.hasSharedAxis(ax),hasAxisInDfltPos=this.hasAxisInDfltPos(axisName,ax)&&!hasSharedAxis,hasAxisInAltrPos=this.hasAxisInAltrPos(axisName,ax)&&!hasSharedAxis,axMirror=ax.mirror||!1,mirrorLines=hasSharedAxis?-1!==String(axMirror).indexOf("all"):!!axMirror,mirrorTicks=hasSharedAxis?"allticks"===axMirror:-1!==String(axMirror).indexOf("ticks"),hasAxisInDfltPos?this.labelEnable[i]=!0:hasAxisInAltrPos&&(this.labelEnable[i+2]=!0),hasAxisInDfltPos?this.tickEnable[i]=ax.showticklabels:hasAxisInAltrPos&&(this.tickEnable[i+2]=ax.showticklabels),(hasAxisInDfltPos||mirrorLines)&&(this.borderLineEnable[i]=ax.showline),(hasAxisInAltrPos||mirrorLines)&&(this.borderLineEnable[i+2]=ax.showline),(hasAxisInDfltPos||mirrorTicks)&&(this.tickMarkLength[i]=this.getTickMarkLength(ax)),(hasAxisInAltrPos||mirrorTicks)&&(this.tickMarkLength[i+2]=this.getTickMarkLength(ax)),this.gridLineEnable[i]=ax.showgrid,this.gridLineColor[i]=str2RGBArray(ax.gridcolor),this.gridLineWidth[i]=ax.gridwidth,this.zeroLineEnable[i]=ax.zeroline,this.zeroLineColor[i]=str2RGBArray(ax.zerolinecolor),this.zeroLineWidth[i]=ax.zerolinewidth}},proto.hasSharedAxis=function(ax){var scene=this.scene,subplotIds=scene.fullLayout._subplots.gl2d;return 0!==Axes.findSubplotsWithAxis(subplotIds,ax).indexOf(scene.id)},proto.hasAxisInDfltPos=function(axisName,ax){var axSide=ax.side;return"xaxis"===axisName?"bottom"===axSide:"yaxis"===axisName?"left"===axSide:void 0},proto.hasAxisInAltrPos=function(axisName,ax){var axSide=ax.side;return"xaxis"===axisName?"top"===axSide:"yaxis"===axisName?"right"===axSide:void 0},proto.getLabelPad=function(axisName,ax){var fontSize=ax.titlefont.size,showticklabels=ax.showticklabels;return"xaxis"===axisName?"top"===ax.side?fontSize*(1.5+(showticklabels?1:0))-10:fontSize*(1.5+(showticklabels?.5:0))-10:"yaxis"===axisName?"right"===ax.side?10+fontSize*(1.5+(showticklabels?1:.5)):10+fontSize*(1.5+(showticklabels?.5:0)):void 0},proto.getTickPad=function(ax){return"outside"===ax.ticks?10+ax.ticklen:15},proto.getTickMarkLength=function(ax){if(!ax.ticks)return 0;var ticklen=ax.ticklen;return"inside"===ax.ticks?-ticklen:ticklen},module.exports=function createAxes2D(scene){return new Axes2DOptions(scene)}},{"../../lib/html2unicode":691,"../../lib/str2rgbarray":717,"../cartesian/axes":742}],781:[function(_dereq_,module,exports){"use strict";var overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,Scene2D=_dereq_("./scene2d"),layoutGlobalAttrs=_dereq_("../layout_attributes"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces"),constants=_dereq_("../cartesian/constants"),Cartesian=_dereq_("../cartesian"),fxAttrs=_dereq_("../../components/fx/layout_attributes"),getSubplotData=_dereq_("../get_data").getSubplotData;exports.name="gl2d",exports.attr=["xaxis","yaxis"],exports.idRoot=["x","y"],exports.idRegex=constants.idRegex,exports.attrRegex=constants.attrRegex,exports.attributes=_dereq_("../cartesian/attributes"),exports.supplyLayoutDefaults=function(layoutIn,layoutOut,fullData){layoutOut._has("cartesian")||Cartesian.supplyLayoutDefaults(layoutIn,layoutOut,fullData)},exports.layoutAttrOverrides=overrideAll(Cartesian.layoutAttributes,"plot","from-root"),exports.baseLayoutAttrOverrides=overrideAll({plot_bgcolor:layoutGlobalAttrs.plot_bgcolor,hoverlabel:fxAttrs.hoverlabel},"plot","nested"),exports.plot=function plotGl2d(gd){for(var fullLayout=gd._fullLayout,fullData=gd._fullData,subplotIds=fullLayout._subplots.gl2d,i=0;i<subplotIds.length;i++){var subplotId=subplotIds[i],subplotObj=fullLayout._plots[subplotId],fullSubplotData=getSubplotData(fullData,"gl2d",subplotId),scene=subplotObj._scene2d;void 0===scene&&(scene=new Scene2D({id:subplotId,graphDiv:gd,container:gd.querySelector(".gl-container"),staticPlot:gd._context.staticPlot,plotGlPixelRatio:gd._context.plotGlPixelRatio},fullLayout),subplotObj._scene2d=scene),scene.plot(fullSubplotData,gd.calcdata,fullLayout,gd.layout)}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldSceneKeys=oldFullLayout._subplots.gl2d||[],i=0;i<oldSceneKeys.length;i++){var id=oldSceneKeys[i],oldSubplot=oldFullLayout._plots[id];if(oldSubplot._scene2d)0===getSubplotData(newFullData,"gl2d",id).length&&(oldSubplot._scene2d.destroy(),delete oldFullLayout._plots[id])}Cartesian.clean.apply(this,arguments)},exports.drawFramework=function(gd){gd._context.staticPlot||Cartesian.drawFramework(gd)},exports.toSVG=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.gl2d,i=0;i<subplotIds.length;i++){var scene=fullLayout._plots[subplotIds[i]]._scene2d,imageData=scene.toImage("png");fullLayout._glimages.append("svg:image").attr({xmlns:xmlnsNamespaces.svg,"xlink:href":imageData,x:0,y:0,width:"100%",height:"100%",preserveAspectRatio:"none"}),scene.destroy()}},exports.updateFx=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.gl2d,i=0;i<subplotIds.length;i++){fullLayout._plots[subplotIds[i]]._scene2d.updateFx(fullLayout.dragmode)}}},{"../../components/fx/layout_attributes":610,"../../constants/xmlns_namespaces":671,"../../plot_api/edit_types":725,"../cartesian":753,"../cartesian/attributes":740,"../cartesian/constants":747,"../get_data":778,"../layout_attributes":796,"./scene2d":782}],782:[function(_dereq_,module,exports){"use strict";var STATIC_CANVAS,STATIC_CONTEXT,Registry=_dereq_("../../registry"),Axes=_dereq_("../../plots/cartesian/axes"),Fx=_dereq_("../../components/fx"),createPlot2D=_dereq_("gl-plot2d"),createSpikes=_dereq_("gl-spikes2d"),createSelectBox=_dereq_("gl-select-box"),getContext=_dereq_("webgl-context"),createOptions=_dereq_("./convert"),createCamera=_dereq_("./camera"),convertHTMLToUnicode=_dereq_("../../lib/html2unicode"),showNoWebGlMsg=_dereq_("../../lib/show_no_webgl_msg"),axisConstraints=_dereq_("../cartesian/constraints"),enforceAxisConstraints=axisConstraints.enforce,cleanAxisConstraints=axisConstraints.clean,doAutoRange=_dereq_("../cartesian/autorange").doAutoRange,AXES=["xaxis","yaxis"],SUBPLOT_PATTERN=_dereq_("../cartesian/constants").SUBPLOT_PATTERN;function Scene2D(options,fullLayout){this.container=options.container,this.graphDiv=options.graphDiv,this.pixelRatio=options.plotGlPixelRatio||window.devicePixelRatio,this.id=options.id,this.staticPlot=!!options.staticPlot,this.scrollZoom=this.graphDiv._context.scrollZoom,this.fullData=null,this.updateRefs(fullLayout),this.makeFramework(),this.stopped||(this.glplotOptions=createOptions(this),this.glplotOptions.merge(fullLayout),this.glplot=createPlot2D(this.glplotOptions),this.camera=createCamera(this),this.traces={},this.spikes=createSpikes(this.glplot),this.selectBox=createSelectBox(this.glplot,{innerFill:!1,outerFill:!0}),this.lastButtonState=0,this.pickResult=null,this.isMouseOver=!0,this.stopped=!1,this.redraw=this.draw.bind(this),this.redraw())}module.exports=Scene2D;var proto=Scene2D.prototype;proto.makeFramework=function(){if(this.staticPlot){if(!(STATIC_CONTEXT||(STATIC_CANVAS=document.createElement("canvas"),STATIC_CONTEXT=getContext({canvas:STATIC_CANVAS,preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0}))))throw new Error("Error creating static canvas/context for image server");this.canvas=STATIC_CANVAS,this.gl=STATIC_CONTEXT}else{var liveCanvas=this.container.querySelector(".gl-canvas-focus"),gl=getContext({canvas:liveCanvas,preserveDrawingBuffer:!0,premultipliedAlpha:!0});if(!gl)return showNoWebGlMsg(this),void(this.stopped=!0);this.canvas=liveCanvas,this.gl=gl}var canvas=this.canvas;canvas.style.width="100%",canvas.style.height="100%",canvas.style.position="absolute",canvas.style.top="0px",canvas.style.left="0px",canvas.style["pointer-events"]="none",this.updateSize(canvas),canvas.className+=" user-select-none";var svgContainer=this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg");svgContainer.style.position="absolute",svgContainer.style.top=svgContainer.style.left="0px",svgContainer.style.width=svgContainer.style.height="100%",svgContainer.style["z-index"]=20,svgContainer.style["pointer-events"]="none";var mouseContainer=this.mouseContainer=document.createElement("div");mouseContainer.style.position="absolute",mouseContainer.style["pointer-events"]="auto",this.pickCanvas=this.container.querySelector(".gl-canvas-pick");var container=this.container;container.appendChild(svgContainer),container.appendChild(mouseContainer);var self=this;mouseContainer.addEventListener("mouseout",function(){self.isMouseOver=!1,self.unhover()}),mouseContainer.addEventListener("mouseover",function(){self.isMouseOver=!0})},proto.toImage=function(format){format||(format="png"),this.stopped=!0,this.staticPlot&&this.container.appendChild(STATIC_CANVAS),this.updateSize(this.canvas);var gl=this.glplot.gl,w=gl.drawingBufferWidth,h=gl.drawingBufferHeight;gl.clearColor(1,1,1,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.glplot.setDirty(),this.glplot.draw(),gl.bindFramebuffer(gl.FRAMEBUFFER,null);var pixels=new Uint8Array(w*h*4);gl.readPixels(0,0,w,h,gl.RGBA,gl.UNSIGNED_BYTE,pixels);for(var j=0,k=h-1;j<k;++j,--k)for(var i=0;i<w;++i)for(var l=0;l<4;++l){var tmp=pixels[4*(w*j+i)+l];pixels[4*(w*j+i)+l]=pixels[4*(w*k+i)+l],pixels[4*(w*k+i)+l]=tmp}var canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;var dataURL,context=canvas.getContext("2d"),imageData=context.createImageData(w,h);switch(imageData.data.set(pixels),context.putImageData(imageData,0,0),format){case"jpeg":dataURL=canvas.toDataURL("image/jpeg");break;case"webp":dataURL=canvas.toDataURL("image/webp");break;default:dataURL=canvas.toDataURL("image/png")}return this.staticPlot&&this.container.removeChild(STATIC_CANVAS),dataURL},proto.updateSize=function(canvas){canvas||(canvas=this.canvas);var pixelRatio=this.pixelRatio,fullLayout=this.fullLayout,width=fullLayout.width,height=fullLayout.height,pixelWidth=0|Math.ceil(pixelRatio*width),pixelHeight=0|Math.ceil(pixelRatio*height);return canvas.width===pixelWidth&&canvas.height===pixelHeight||(canvas.width=pixelWidth,canvas.height=pixelHeight),canvas},proto.computeTickMarks=function(){this.xaxis.setScale(),this.yaxis.setScale();for(var nextTicks=[Axes.calcTicks(this.xaxis),Axes.calcTicks(this.yaxis)],j=0;j<2;++j)for(var i=0;i<nextTicks[j].length;++i)nextTicks[j][i].text=convertHTMLToUnicode(nextTicks[j][i].text+"");return nextTicks},proto.updateRefs=function(newFullLayout){this.fullLayout=newFullLayout;var spmatch=this.id.match(SUBPLOT_PATTERN),xaxisName="xaxis"+spmatch[1],yaxisName="yaxis"+spmatch[2];this.xaxis=this.fullLayout[xaxisName],this.yaxis=this.fullLayout[yaxisName]},proto.relayoutCallback=function(){var graphDiv=this.graphDiv,xaxis=this.xaxis,yaxis=this.yaxis,layout=graphDiv.layout;layout.xaxis.autorange=xaxis.autorange,layout.xaxis.range=xaxis.range.slice(0),layout.yaxis.autorange=yaxis.autorange,layout.yaxis.range=yaxis.range.slice(0);var update={lastInputTime:this.camera.lastInputTime};update[xaxis._name]=xaxis.range.slice(0),update[yaxis._name]=yaxis.range.slice(0),graphDiv.emit("plotly_relayout",update)},proto.cameraChanged=function(){var camera=this.camera;this.glplot.setDataBox(this.calcDataBox());var nextTicks=this.computeTickMarks();(function compareTicks(a,b){for(var i=0;i<2;++i){var aticks=a[i],bticks=b[i];if(aticks.length!==bticks.length)return!0;for(var j=0;j<aticks.length;++j)if(aticks[j].x!==bticks[j].x)return!0}return!1})(nextTicks,this.glplotOptions.ticks)&&(this.glplotOptions.ticks=nextTicks,this.glplotOptions.dataBox=camera.dataBox,this.glplot.update(this.glplotOptions),this.handleAnnotations())},proto.handleAnnotations=function(){for(var gd=this.graphDiv,annotations=this.fullLayout.annotations,i=0;i<annotations.length;i++){var ann=annotations[i];ann.xref===this.xaxis._id&&ann.yref===this.yaxis._id&&Registry.getComponentMethod("annotations","drawOne")(gd,i)}},proto.destroy=function(){if(this.glplot){var traces=this.traces;traces&&Object.keys(traces).map(function(key){traces[key].dispose(),delete traces[key]}),this.glplot.dispose(),this.container.removeChild(this.svgContainer),this.container.removeChild(this.mouseContainer),this.fullData=null,this.glplot=null,this.stopped=!0,this.camera.mouseListener.enabled=!1,this.mouseContainer.removeEventListener("wheel",this.camera.wheelListener),this.camera=null}},proto.plot=function(fullData,calcData,fullLayout){var glplot=this.glplot;this.updateRefs(fullLayout),this.xaxis.clearCalc(),this.yaxis.clearCalc(),this.updateTraces(fullData,calcData),this.updateFx(fullLayout.dragmode);var width=fullLayout.width,height=fullLayout.height;this.updateSize(this.canvas);var options=this.glplotOptions;options.merge(fullLayout),options.screenBox=[0,0,width,height];var mockGraphDiv={_fullLayout:{_axisConstraintGroups:this.graphDiv._fullLayout._axisConstraintGroups,xaxis:this.xaxis,yaxis:this.yaxis}};cleanAxisConstraints(mockGraphDiv,this.xaxis),cleanAxisConstraints(mockGraphDiv,this.yaxis);var ax,i,size=fullLayout._size,domainX=this.xaxis.domain,domainY=this.yaxis.domain;for(options.viewBox=[size.l+domainX[0]*size.w,size.b+domainY[0]*size.h,width-size.r-(1-domainX[1])*size.w,height-size.t-(1-domainY[1])*size.h],this.mouseContainer.style.width=size.w*(domainX[1]-domainX[0])+"px",this.mouseContainer.style.height=size.h*(domainY[1]-domainY[0])+"px",this.mouseContainer.height=size.h*(domainY[1]-domainY[0]),this.mouseContainer.style.left=size.l+domainX[0]*size.w+"px",this.mouseContainer.style.top=size.t+(1-domainY[1])*size.h+"px",i=0;i<2;++i)(ax=this[AXES[i]])._length=options.viewBox[i+2]-options.viewBox[i],doAutoRange(this.graphDiv,ax),ax.setScale();enforceAxisConstraints(mockGraphDiv),options.ticks=this.computeTickMarks(),options.dataBox=this.calcDataBox(),options.merge(fullLayout),glplot.update(options),this.glplot.draw()},proto.calcDataBox=function(){var xaxis=this.xaxis,yaxis=this.yaxis,xrange=xaxis.range,yrange=yaxis.range,xr2l=xaxis.r2l,yr2l=yaxis.r2l;return[xr2l(xrange[0]),yr2l(yrange[0]),xr2l(xrange[1]),yr2l(yrange[1])]},proto.setRanges=function(dataBox){var xaxis=this.xaxis,yaxis=this.yaxis,xl2r=xaxis.l2r,yl2r=yaxis.l2r;xaxis.range=[xl2r(dataBox[0]),xl2r(dataBox[2])],yaxis.range=[yl2r(dataBox[1]),yl2r(dataBox[3])]},proto.updateTraces=function(fullData,calcData){var i,j,fullTrace,traceIds=Object.keys(this.traces);this.fullData=fullData;trace_id_loop:for(i=0;i<traceIds.length;i++){var oldUid=traceIds[i],oldTrace=this.traces[oldUid];for(j=0;j<fullData.length;j++)if((fullTrace=fullData[j]).uid===oldUid&&fullTrace.type===oldTrace.type)continue trace_id_loop;oldTrace.dispose(),delete this.traces[oldUid]}for(i=0;i<fullData.length;i++){fullTrace=fullData[i];var calcTrace=calcData[i],traceObj=this.traces[fullTrace.uid];traceObj?traceObj.update(fullTrace,calcTrace):(traceObj=fullTrace._module.plot(this,fullTrace,calcTrace),this.traces[fullTrace.uid]=traceObj)}this.glplot.objects.sort(function(a,b){return a._trace.index-b._trace.index})},proto.updateFx=function(dragmode){"lasso"===dragmode||"select"===dragmode?(this.pickCanvas.style["pointer-events"]="none",this.mouseContainer.style["pointer-events"]="none"):(this.pickCanvas.style["pointer-events"]="auto",this.mouseContainer.style["pointer-events"]="auto"),this.mouseContainer.style.cursor="pan"===dragmode?"move":"zoom"===dragmode?"crosshair":null},proto.emitPointAction=function(nextSelection,eventType){for(var trace,uid=nextSelection.trace.uid,ptNumber=nextSelection.pointIndex,i=0;i<this.fullData.length;i++)this.fullData[i].uid===uid&&(trace=this.fullData[i]);var pointData={x:nextSelection.traceCoord[0],y:nextSelection.traceCoord[1],curveNumber:trace.index,pointNumber:ptNumber,data:trace._input,fullData:this.fullData,xaxis:this.xaxis,yaxis:this.yaxis};Fx.appendArrayPointValue(pointData,trace,ptNumber),this.graphDiv.emit(eventType,{points:[pointData]})},proto.draw=function(){if(!this.stopped){requestAnimationFrame(this.redraw);var glplot=this.glplot,camera=this.camera,mouseListener=camera.mouseListener,mouseUp=1===this.lastButtonState&&0===mouseListener.buttons,fullLayout=this.fullLayout;this.lastButtonState=mouseListener.buttons,this.cameraChanged();var result,x=mouseListener.x*glplot.pixelRatio,y=this.canvas.height-glplot.pixelRatio*mouseListener.y;if(camera.boxEnabled&&"zoom"===fullLayout.dragmode){this.selectBox.enabled=!0;for(var selectBox=this.selectBox.selectBox=[Math.min(camera.boxStart[0],camera.boxEnd[0]),Math.min(camera.boxStart[1],camera.boxEnd[1]),Math.max(camera.boxStart[0],camera.boxEnd[0]),Math.max(camera.boxStart[1],camera.boxEnd[1])],i=0;i<2;i++)camera.boxStart[i]===camera.boxEnd[i]&&(selectBox[i]=glplot.dataBox[i],selectBox[i+2]=glplot.dataBox[i+2]);glplot.setDirty()}else if(!camera.panning&&this.isMouseOver){this.selectBox.enabled=!1;var size=fullLayout._size,domainX=this.xaxis.domain,domainY=this.yaxis.domain,nextSelection=(result=glplot.pick(x/glplot.pixelRatio+size.l+domainX[0]*size.w,y/glplot.pixelRatio-(size.t+(1-domainY[1])*size.h)))&&result.object._trace.handlePick(result);if(nextSelection&&mouseUp&&this.emitPointAction(nextSelection,"plotly_click"),result&&"skip"!==result.object._trace.hoverinfo&&fullLayout.hovermode&&nextSelection&&(!this.lastPickResult||this.lastPickResult.traceUid!==nextSelection.trace.uid||this.lastPickResult.dataCoord[0]!==nextSelection.dataCoord[0]||this.lastPickResult.dataCoord[1]!==nextSelection.dataCoord[1])){var selection=nextSelection;this.lastPickResult={traceUid:nextSelection.trace?nextSelection.trace.uid:null,dataCoord:nextSelection.dataCoord.slice()},this.spikes.update({center:result.dataCoord}),selection.screenCoord=[((glplot.viewBox[2]-glplot.viewBox[0])*(result.dataCoord[0]-glplot.dataBox[0])/(glplot.dataBox[2]-glplot.dataBox[0])+glplot.viewBox[0])/glplot.pixelRatio,(this.canvas.height-(glplot.viewBox[3]-glplot.viewBox[1])*(result.dataCoord[1]-glplot.dataBox[1])/(glplot.dataBox[3]-glplot.dataBox[1])-glplot.viewBox[1])/glplot.pixelRatio],this.emitPointAction(nextSelection,"plotly_hover");var trace=this.fullData[selection.trace.index]||{},ptNumber=selection.pointIndex,hoverinfo=Fx.castHoverinfo(trace,fullLayout,ptNumber);if(hoverinfo&&"all"!==hoverinfo){var parts=hoverinfo.split("+");-1===parts.indexOf("x")&&(selection.traceCoord[0]=void 0),-1===parts.indexOf("y")&&(selection.traceCoord[1]=void 0),-1===parts.indexOf("z")&&(selection.traceCoord[2]=void 0),-1===parts.indexOf("text")&&(selection.textLabel=void 0),-1===parts.indexOf("name")&&(selection.name=void 0)}Fx.loneHover({x:selection.screenCoord[0],y:selection.screenCoord[1],xLabel:this.hoverFormatter("xaxis",selection.traceCoord[0]),yLabel:this.hoverFormatter("yaxis",selection.traceCoord[1]),zLabel:selection.traceCoord[2],text:selection.textLabel,name:selection.name,color:Fx.castHoverOption(trace,ptNumber,"bgcolor")||selection.color,borderColor:Fx.castHoverOption(trace,ptNumber,"bordercolor"),fontFamily:Fx.castHoverOption(trace,ptNumber,"font.family"),fontSize:Fx.castHoverOption(trace,ptNumber,"font.size"),fontColor:Fx.castHoverOption(trace,ptNumber,"font.color")},{container:this.svgContainer,gd:this.graphDiv})}}result||this.unhover(),glplot.draw()}},proto.unhover=function(){this.lastPickResult&&(this.spikes.update({}),this.lastPickResult=null,this.graphDiv.emit("plotly_unhover"),Fx.loneUnhover(this.svgContainer))},proto.hoverFormatter=function(axisName,val){if(void 0!==val){var axis=this[axisName];return Axes.tickText(axis,axis.c2l(val),"hover").text}}},{"../../components/fx":609,"../../lib/html2unicode":691,"../../lib/show_no_webgl_msg":715,"../../plots/cartesian/axes":742,"../../registry":825,"../cartesian/autorange":741,"../cartesian/constants":747,"../cartesian/constraints":749,"./camera":779,"./convert":780,"gl-plot2d":274,"gl-select-box":284,"gl-spikes2d":293,"webgl-context":530}],783:[function(_dereq_,module,exports){"use strict";module.exports=function createCamera(element,options){element=element||document.body,options=options||{};var limits=[.01,1/0];"distanceLimits"in options&&(limits[0]=options.distanceLimits[0],limits[1]=options.distanceLimits[1]);"zoomMin"in options&&(limits[0]=options.zoomMin);"zoomMax"in options&&(limits[1]=options.zoomMax);var view=createView({center:options.center||[0,0,0],up:options.up||[0,1,0],eye:options.eye||[0,0,10],mode:options.mode||"orbit",distanceLimits:limits}),pmatrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],distance=0,width=element.clientWidth,height=element.clientHeight,camera={keyBindingMode:"rotate",view:view,element:element,delay:options.delay||16,rotateSpeed:options.rotateSpeed||1,zoomSpeed:options.zoomSpeed||1,translateSpeed:options.translateSpeed||1,flipX:!!options.flipX,flipY:!!options.flipY,modes:view.modes,tick:function(){var t=now(),delay=this.delay,ctime=t-2*delay;view.idle(t-delay),view.recalcMatrix(ctime),view.flush(t-(100+2*delay));for(var allEqual=!0,matrix=view.computedMatrix,i=0;i<16;++i)allEqual=allEqual&&pmatrix[i]===matrix[i],pmatrix[i]=matrix[i];var sizeChanged=element.clientWidth===width&&element.clientHeight===height;return width=element.clientWidth,height=element.clientHeight,allEqual?!sizeChanged:(distance=Math.exp(view.computedRadius[0]),!0)},lookAt:function(center,eye,up){view.lookAt(view.lastT(),center,eye,up)},rotate:function(pitch,yaw,roll){view.rotate(view.lastT(),pitch,yaw,roll)},pan:function(dx,dy,dz){view.pan(view.lastT(),dx,dy,dz)},translate:function(dx,dy,dz){view.translate(view.lastT(),dx,dy,dz)}};Object.defineProperties(camera,{matrix:{get:function(){return view.computedMatrix},set:function(mat){return view.setMatrix(view.lastT(),mat),view.computedMatrix},enumerable:!0},mode:{get:function(){return view.getMode()},set:function(mode){var curUp=view.computedUp.slice(),curEye=view.computedEye.slice(),curCenter=view.computedCenter.slice();if(view.setMode(mode),"turntable"===mode){var t0=now();view._active.lookAt(t0,curEye,curCenter,curUp),view._active.lookAt(t0+500,curEye,curCenter,[0,0,1]),view._active.flush(t0)}return view.getMode()},enumerable:!0},center:{get:function(){return view.computedCenter},set:function(ncenter){return view.lookAt(view.lastT(),null,ncenter),view.computedCenter},enumerable:!0},eye:{get:function(){return view.computedEye},set:function(neye){return view.lookAt(view.lastT(),neye),view.computedEye},enumerable:!0},up:{get:function(){return view.computedUp},set:function(nup){return view.lookAt(view.lastT(),null,null,nup),view.computedUp},enumerable:!0},distance:{get:function(){return distance},set:function(d){return view.setDistance(view.lastT(),d),d},enumerable:!0},distanceLimits:{get:function(){return view.getDistanceLimits(limits)},set:function(v){return view.setDistanceLimits(v),v},enumerable:!0}}),element.addEventListener("contextmenu",function(ev){return ev.preventDefault(),!1});var lastX=0,lastY=0,lastMods={shift:!1,control:!1,alt:!1,meta:!1};function handleInteraction(buttons,x,y,mods){var keyBindingMode=camera.keyBindingMode;if(!1!==keyBindingMode){var rotate="rotate"===keyBindingMode,pan="pan"===keyBindingMode,zoom="zoom"===keyBindingMode,ctrl=!!mods.control,alt=!!mods.alt,shift=!!mods.shift,left=!!(1&buttons),right=!!(2&buttons),middle=!!(4&buttons),scale=1/element.clientHeight,dx=scale*(x-lastX),dy=scale*(y-lastY),flipX=camera.flipX?1:-1,flipY=camera.flipY?1:-1,t=now(),drot=Math.PI*camera.rotateSpeed;if((rotate&&left&&!ctrl&&!alt&&!shift||left&&!ctrl&&!alt&&shift)&&view.rotate(t,flipX*drot*dx,-flipY*drot*dy,0),(pan&&left&&!ctrl&&!alt&&!shift||right||left&&ctrl&&!alt&&!shift)&&view.pan(t,-camera.translateSpeed*dx*distance,camera.translateSpeed*dy*distance,0),zoom&&left&&!ctrl&&!alt&&!shift||middle||left&&!ctrl&&alt&&!shift){var kzoom=-camera.zoomSpeed*dy/window.innerHeight*(t-view.lastT())*100;view.pan(t,0,0,distance*(Math.exp(kzoom)-1))}return lastX=x,lastY=y,lastMods=mods,!0}}return camera.mouseListener=mouseChange(element,handleInteraction),element.addEventListener("touchstart",function(ev){var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(0,xy[0],xy[1],lastMods),handleInteraction(1,xy[0],xy[1],lastMods),ev.preventDefault()},!!supportsPassive&&{passive:!1}),element.addEventListener("touchmove",function(ev){var xy=mouseOffset(ev.changedTouches[0],element);handleInteraction(1,xy[0],xy[1],lastMods),ev.preventDefault()},!!supportsPassive&&{passive:!1}),element.addEventListener("touchend",function(ev){handleInteraction(0,lastX,lastY,lastMods),ev.preventDefault()},!!supportsPassive&&{passive:!1}),camera.wheelListener=mouseWheel(element,function(dx,dy){if(!1!==camera.keyBindingMode){var flipX=camera.flipX?1:-1,flipY=camera.flipY?1:-1,t=now();if(Math.abs(dx)>Math.abs(dy))view.rotate(t,0,0,-dx*flipX*Math.PI*camera.rotateSpeed/window.innerWidth);else{var kzoom=-camera.zoomSpeed*flipY*dy/window.innerHeight*(t-view.lastT())/20;view.pan(t,0,0,distance*(Math.exp(kzoom)-1))}}},!0),camera};var now=_dereq_("right-now"),createView=_dereq_("3d-view"),mouseChange=_dereq_("mouse-change"),mouseWheel=_dereq_("mouse-wheel"),mouseOffset=_dereq_("mouse-event-offset"),supportsPassive=_dereq_("has-passive-events")},{"3d-view":44,"has-passive-events":392,"mouse-change":415,"mouse-event-offset":416,"mouse-wheel":418,"right-now":477}],784:[function(_dereq_,module,exports){"use strict";var overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,fxAttrs=_dereq_("../../components/fx/layout_attributes"),Scene=_dereq_("./scene"),getSubplotData=_dereq_("../get_data").getSubplotData,Lib=_dereq_("../../lib"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces");exports.name="gl3d",exports.attr="scene",exports.idRoot="scene",exports.idRegex=exports.attrRegex=Lib.counterRegex("scene"),exports.attributes=_dereq_("./layout/attributes"),exports.layoutAttributes=_dereq_("./layout/layout_attributes"),exports.baseLayoutAttrOverrides=overrideAll({hoverlabel:fxAttrs.hoverlabel},"plot","nested"),exports.supplyLayoutDefaults=_dereq_("./layout/defaults"),exports.plot=function plotGl3d(gd){for(var fullLayout=gd._fullLayout,fullData=gd._fullData,sceneIds=fullLayout._subplots.gl3d,i=0;i<sceneIds.length;i++){var sceneId=sceneIds[i],fullSceneData=getSubplotData(fullData,"gl3d",sceneId),sceneLayout=fullLayout[sceneId],scene=sceneLayout._scene;scene||(scene=new Scene({id:sceneId,graphDiv:gd,container:gd.querySelector(".gl-container"),staticPlot:gd._context.staticPlot,plotGlPixelRatio:gd._context.plotGlPixelRatio},fullLayout),sceneLayout._scene=scene),scene.cameraInitial||(scene.cameraInitial=Lib.extendDeep({},sceneLayout.camera)),scene.plot(fullSceneData,fullLayout,gd.layout)}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldSceneKeys=oldFullLayout._subplots.gl3d||[],i=0;i<oldSceneKeys.length;i++){var oldSceneKey=oldSceneKeys[i];!newFullLayout[oldSceneKey]&&oldFullLayout[oldSceneKey]._scene&&(oldFullLayout[oldSceneKey]._scene.destroy(),oldFullLayout._infolayer&&oldFullLayout._infolayer.selectAll(".annotation-"+oldSceneKey).remove())}},exports.toSVG=function(gd){for(var fullLayout=gd._fullLayout,sceneIds=fullLayout._subplots.gl3d,size=fullLayout._size,i=0;i<sceneIds.length;i++){var sceneLayout=fullLayout[sceneIds[i]],domain=sceneLayout.domain,scene=sceneLayout._scene,imageData=scene.toImage("png");fullLayout._glimages.append("svg:image").attr({xmlns:xmlnsNamespaces.svg,"xlink:href":imageData,x:size.l+size.w*domain.x[0],y:size.t+size.h*(1-domain.y[1]),width:size.w*(domain.x[1]-domain.x[0]),height:size.h*(domain.y[1]-domain.y[0]),preserveAspectRatio:"none"}),scene.destroy()}},exports.cleanId=function cleanId(id){if(id.match(/^scene[0-9]*$/)){var sceneNum=id.substr(5);return"1"===sceneNum&&(sceneNum=""),"scene"+sceneNum}},exports.updateFx=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.gl3d,i=0;i<subplotIds.length;i++){fullLayout[subplotIds[i]]._scene.updateFx(fullLayout.dragmode,fullLayout.hovermode)}}},{"../../components/fx/layout_attributes":610,"../../constants/xmlns_namespaces":671,"../../lib":693,"../../plot_api/edit_types":725,"../get_data":778,"./layout/attributes":785,"./layout/defaults":789,"./layout/layout_attributes":790,"./scene":794}],785:[function(_dereq_,module,exports){"use strict";module.exports={scene:{valType:"subplotid",dflt:"scene",editType:"calc+clearAxisTypes"}}},{}],786:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../../components/color"),axesAttrs=_dereq_("../../cartesian/layout_attributes"),extendFlat=_dereq_("../../../lib/extend").extendFlat,overrideAll=_dereq_("../../../plot_api/edit_types").overrideAll;module.exports=overrideAll({visible:axesAttrs.visible,showspikes:{valType:"boolean",dflt:!0},spikesides:{valType:"boolean",dflt:!0},spikethickness:{valType:"number",min:0,dflt:2},spikecolor:{valType:"color",dflt:Color.defaultLine},showbackground:{valType:"boolean",dflt:!1},backgroundcolor:{valType:"color",dflt:"rgba(204, 204, 204, 0.5)"},showaxeslabels:{valType:"boolean",dflt:!0},color:axesAttrs.color,categoryorder:axesAttrs.categoryorder,categoryarray:axesAttrs.categoryarray,title:axesAttrs.title,titlefont:axesAttrs.titlefont,type:axesAttrs.type,autorange:axesAttrs.autorange,rangemode:axesAttrs.rangemode,range:axesAttrs.range,tickmode:axesAttrs.tickmode,nticks:axesAttrs.nticks,tick0:axesAttrs.tick0,dtick:axesAttrs.dtick,tickvals:axesAttrs.tickvals,ticktext:axesAttrs.ticktext,ticks:axesAttrs.ticks,mirror:axesAttrs.mirror,ticklen:axesAttrs.ticklen,tickwidth:axesAttrs.tickwidth,tickcolor:axesAttrs.tickcolor,showticklabels:axesAttrs.showticklabels,tickfont:axesAttrs.tickfont,tickangle:axesAttrs.tickangle,tickprefix:axesAttrs.tickprefix,showtickprefix:axesAttrs.showtickprefix,ticksuffix:axesAttrs.ticksuffix,showticksuffix:axesAttrs.showticksuffix,showexponent:axesAttrs.showexponent,exponentformat:axesAttrs.exponentformat,separatethousands:axesAttrs.separatethousands,tickformat:axesAttrs.tickformat,tickformatstops:axesAttrs.tickformatstops,hoverformat:axesAttrs.hoverformat,showline:axesAttrs.showline,linecolor:axesAttrs.linecolor,linewidth:axesAttrs.linewidth,showgrid:axesAttrs.showgrid,gridcolor:extendFlat({},axesAttrs.gridcolor,{dflt:"rgb(204, 204, 204)"}),gridwidth:axesAttrs.gridwidth,zeroline:axesAttrs.zeroline,zerolinecolor:axesAttrs.zerolinecolor,zerolinewidth:axesAttrs.zerolinewidth},"plot","from-root")},{"../../../components/color":567,"../../../lib/extend":682,"../../../plot_api/edit_types":725,"../../cartesian/layout_attributes":754}],787:[function(_dereq_,module,exports){"use strict";var colorMix=_dereq_("tinycolor2").mix,Lib=_dereq_("../../../lib"),Template=_dereq_("../../../plot_api/plot_template"),layoutAttributes=_dereq_("./axis_attributes"),handleTypeDefaults=_dereq_("../../cartesian/type_defaults"),handleAxisDefaults=_dereq_("../../cartesian/axis_defaults"),axesNames=["xaxis","yaxis","zaxis"];module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,options){var containerIn,containerOut;function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,layoutAttributes,attr,dflt)}for(var j=0;j<axesNames.length;j++){var axName=axesNames[j];containerIn=layoutIn[axName]||{},(containerOut=Template.newContainer(layoutOut,axName))._id=axName[0]+options.scene,containerOut._name=axName,handleTypeDefaults(containerIn,containerOut,coerce,options),handleAxisDefaults(containerIn,containerOut,coerce,{font:options.font,letter:axName[0],data:options.data,showGrid:!0,bgColor:options.bgColor,calendar:options.calendar},options.fullLayout),coerce("gridcolor",colorMix(containerOut.color,options.bgColor,13600/187).toRgbString()),coerce("title",axName[0]),containerOut.setScale=Lib.noop,coerce("showspikes")&&(coerce("spikesides"),coerce("spikethickness"),coerce("spikecolor",containerOut.color)),coerce("showaxeslabels"),coerce("showbackground")&&coerce("backgroundcolor")}}},{"../../../lib":693,"../../../plot_api/plot_template":732,"../../cartesian/axis_defaults":744,"../../cartesian/type_defaults":765,"./axis_attributes":786,tinycolor2:511}],788:[function(_dereq_,module,exports){"use strict";var convertHTMLToUnicode=_dereq_("../../../lib/html2unicode"),str2RgbaArray=_dereq_("../../../lib/str2rgbarray"),AXES_NAMES=["xaxis","yaxis","zaxis"];function AxesOptions(){this.bounds=[[-10,-10,-10],[10,10,10]],this.ticks=[[],[],[]],this.tickEnable=[!0,!0,!0],this.tickFont=["sans-serif","sans-serif","sans-serif"],this.tickSize=[12,12,12],this.tickAngle=[0,0,0],this.tickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.tickPad=[18,18,18],this.labels=["x","y","z"],this.labelEnable=[!0,!0,!0],this.labelFont=["Open Sans","Open Sans","Open Sans"],this.labelSize=[20,20,20],this.labelAngle=[0,0,0],this.labelColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.labelPad=[30,30,30],this.lineEnable=[!0,!0,!0],this.lineMirror=[!1,!1,!1],this.lineWidth=[1,1,1],this.lineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.lineTickEnable=[!0,!0,!0],this.lineTickMirror=[!1,!1,!1],this.lineTickLength=[10,10,10],this.lineTickWidth=[1,1,1],this.lineTickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.gridEnable=[!0,!0,!0],this.gridWidth=[1,1,1],this.gridColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroEnable=[!0,!0,!0],this.zeroLineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroLineWidth=[2,2,2],this.backgroundEnable=[!0,!0,!0],this.backgroundColor=[[.8,.8,.8,.5],[.8,.8,.8,.5],[.8,.8,.8,.5]],this._defaultTickPad=this.tickPad.slice(),this._defaultLabelPad=this.labelPad.slice(),this._defaultLineTickLength=this.lineTickLength.slice()}AxesOptions.prototype.merge=function(sceneLayout){for(var i=0;i<3;++i){var axes=sceneLayout[AXES_NAMES[i]];axes.visible?(this.labels[i]=convertHTMLToUnicode(axes.title),"titlefont"in axes&&(axes.titlefont.color&&(this.labelColor[i]=str2RgbaArray(axes.titlefont.color)),axes.titlefont.family&&(this.labelFont[i]=axes.titlefont.family),axes.titlefont.size&&(this.labelSize[i]=axes.titlefont.size)),"showline"in axes&&(this.lineEnable[i]=axes.showline),"linecolor"in axes&&(this.lineColor[i]=str2RgbaArray(axes.linecolor)),"linewidth"in axes&&(this.lineWidth[i]=axes.linewidth),"showgrid"in axes&&(this.gridEnable[i]=axes.showgrid),"gridcolor"in axes&&(this.gridColor[i]=str2RgbaArray(axes.gridcolor)),"gridwidth"in axes&&(this.gridWidth[i]=axes.gridwidth),"log"===axes.type?this.zeroEnable[i]=!1:"zeroline"in axes&&(this.zeroEnable[i]=axes.zeroline),"zerolinecolor"in axes&&(this.zeroLineColor[i]=str2RgbaArray(axes.zerolinecolor)),"zerolinewidth"in axes&&(this.zeroLineWidth[i]=axes.zerolinewidth),"ticks"in axes&&axes.ticks?this.lineTickEnable[i]=!0:this.lineTickEnable[i]=!1,"ticklen"in axes&&(this.lineTickLength[i]=this._defaultLineTickLength[i]=axes.ticklen),"tickcolor"in axes&&(this.lineTickColor[i]=str2RgbaArray(axes.tickcolor)),"tickwidth"in axes&&(this.lineTickWidth[i]=axes.tickwidth),"tickangle"in axes&&(this.tickAngle[i]="auto"===axes.tickangle?0:Math.PI*-axes.tickangle/180),"showticklabels"in axes&&(this.tickEnable[i]=axes.showticklabels),"tickfont"in axes&&(axes.tickfont.color&&(this.tickColor[i]=str2RgbaArray(axes.tickfont.color)),axes.tickfont.family&&(this.tickFont[i]=axes.tickfont.family),axes.tickfont.size&&(this.tickSize[i]=axes.tickfont.size)),"mirror"in axes?-1!==["ticks","all","allticks"].indexOf(axes.mirror)?(this.lineTickMirror[i]=!0,this.lineMirror[i]=!0):!0===axes.mirror?(this.lineTickMirror[i]=!1,this.lineMirror[i]=!0):(this.lineTickMirror[i]=!1,this.lineMirror[i]=!1):this.lineMirror[i]=!1,"showbackground"in axes&&!1!==axes.showbackground?(this.backgroundEnable[i]=!0,this.backgroundColor[i]=str2RgbaArray(axes.backgroundcolor)):this.backgroundEnable[i]=!1):(this.tickEnable[i]=!1,this.labelEnable[i]=!1,this.lineEnable[i]=!1,this.lineTickEnable[i]=!1,this.gridEnable[i]=!1,this.zeroEnable[i]=!1,this.backgroundEnable[i]=!1)}},module.exports=function createAxesOptions(plotlyOptions){var result=new AxesOptions;return result.merge(plotlyOptions),result}},{"../../../lib/html2unicode":691,"../../../lib/str2rgbarray":717}],789:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../../lib"),Color=_dereq_("../../../components/color"),Registry=_dereq_("../../../registry"),handleSubplotDefaults=_dereq_("../../subplot_defaults"),supplyGl3dAxisLayoutDefaults=_dereq_("./axis_defaults"),layoutAttributes=_dereq_("./layout_attributes");function handleGl3dDefaults(sceneLayoutIn,sceneLayoutOut,coerce,opts){for(var bgcolor=coerce("bgcolor"),bgColorCombined=Color.combine(bgcolor,opts.paper_bgcolor),cameraKeys=["up","center","eye"],j=0;j<cameraKeys.length;j++)coerce("camera."+cameraKeys[j]+".x"),coerce("camera."+cameraKeys[j]+".y"),coerce("camera."+cameraKeys[j]+".z");var hasAspect=!!coerce("aspectratio.x")&&!!coerce("aspectratio.y")&&!!coerce("aspectratio.z"),aspectMode=coerce("aspectmode",hasAspect?"manual":"auto");hasAspect||(sceneLayoutIn.aspectratio=sceneLayoutOut.aspectratio={x:1,y:1,z:1},"manual"===aspectMode&&(sceneLayoutOut.aspectmode="auto"),sceneLayoutIn.aspectmode=sceneLayoutOut.aspectmode),supplyGl3dAxisLayoutDefaults(sceneLayoutIn,sceneLayoutOut,{font:opts.font,scene:opts.id,data:opts.fullData,bgColor:bgColorCombined,calendar:opts.calendar,fullLayout:opts.fullLayout}),Registry.getComponentMethod("annotations3d","handleDefaults")(sceneLayoutIn,sceneLayoutOut,opts),coerce("dragmode",opts.getDfltFromLayout("dragmode")),coerce("hovermode",opts.getDfltFromLayout("hovermode"))}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){var hasNon3D=layoutOut._basePlotModules.length>1;handleSubplotDefaults(layoutIn,layoutOut,fullData,{type:"gl3d",attributes:layoutAttributes,handleDefaults:handleGl3dDefaults,fullLayout:layoutOut,font:layoutOut.font,fullData:fullData,getDfltFromLayout:function getDfltFromLayout(attr){if(!hasNon3D)return Lib.validate(layoutIn[attr],layoutAttributes[attr])?layoutIn[attr]:void 0},paper_bgcolor:layoutOut.paper_bgcolor,calendar:layoutOut.calendar})}},{"../../../components/color":567,"../../../lib":693,"../../../registry":825,"../../subplot_defaults":820,"./axis_defaults":787,"./layout_attributes":790}],790:[function(_dereq_,module,exports){"use strict";var gl3dAxisAttrs=_dereq_("./axis_attributes"),domainAttrs=_dereq_("../../domain").attributes,extendFlat=_dereq_("../../../lib/extend").extendFlat,counterRegex=_dereq_("../../../lib").counterRegex;function makeCameraVector(x,y,z){return{x:{valType:"number",dflt:x,editType:"camera"},y:{valType:"number",dflt:y,editType:"camera"},z:{valType:"number",dflt:z,editType:"camera"},editType:"camera"}}module.exports={_arrayAttrRegexps:[counterRegex("scene",".annotations",!0)],bgcolor:{valType:"color",dflt:"rgba(0,0,0,0)",editType:"plot"},camera:{up:extendFlat(makeCameraVector(0,0,1),{}),center:extendFlat(makeCameraVector(0,0,0),{}),eye:extendFlat(makeCameraVector(1.25,1.25,1.25),{}),editType:"camera"},domain:domainAttrs({name:"scene",editType:"plot"}),aspectmode:{valType:"enumerated",values:["auto","cube","data","manual"],dflt:"auto",editType:"plot",impliedEdits:{"aspectratio.x":void 0,"aspectratio.y":void 0,"aspectratio.z":void 0}},aspectratio:{x:{valType:"number",min:0,editType:"plot",impliedEdits:{"^aspectmode":"manual"}},y:{valType:"number",min:0,editType:"plot",impliedEdits:{"^aspectmode":"manual"}},z:{valType:"number",min:0,editType:"plot",impliedEdits:{"^aspectmode":"manual"}},editType:"plot",impliedEdits:{aspectmode:"manual"}},xaxis:gl3dAxisAttrs,yaxis:gl3dAxisAttrs,zaxis:gl3dAxisAttrs,dragmode:{valType:"enumerated",values:["orbit","turntable","zoom","pan",!1],dflt:"turntable",editType:"plot"},hovermode:{valType:"enumerated",values:["closest",!1],dflt:"closest",editType:"modebar"},editType:"plot",_deprecated:{cameraposition:{valType:"info_array",editType:"camera"}}}},{"../../../lib":693,"../../../lib/extend":682,"../../domain":767,"./axis_attributes":786}],791:[function(_dereq_,module,exports){"use strict";var str2RGBArray=_dereq_("../../../lib/str2rgbarray"),AXES_NAMES=["xaxis","yaxis","zaxis"];function SpikeOptions(){this.enabled=[!0,!0,!0],this.colors=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.drawSides=[!0,!0,!0],this.lineWidth=[1,1,1]}SpikeOptions.prototype.merge=function(sceneLayout){for(var i=0;i<3;++i){var axes=sceneLayout[AXES_NAMES[i]];axes.visible?(this.enabled[i]=axes.showspikes,this.colors[i]=str2RGBArray(axes.spikecolor),this.drawSides[i]=axes.spikesides,this.lineWidth[i]=axes.spikethickness):(this.enabled[i]=!1,this.drawSides[i]=!1)}},module.exports=function createSpikeOptions(layout){var result=new SpikeOptions;return result.merge(layout),result}},{"../../../lib/str2rgbarray":717}],792:[function(_dereq_,module,exports){"use strict";module.exports=function computeTickMarks(scene){for(var axesOptions=scene.axesOptions,glRange=scene.glplot.axesPixels,sceneLayout=scene.fullSceneLayout,ticks=[[],[],[]],i=0;i<3;++i){var axes=sceneLayout[AXES_NAMES[i]];if(axes._length=(glRange[i].hi-glRange[i].lo)*glRange[i].pixelsPerDataUnit/scene.dataScale[i],Math.abs(axes._length)===1/0)ticks[i]=[];else{axes._input_range=axes.range.slice(),axes.range[0]=glRange[i].lo/scene.dataScale[i],axes.range[1]=glRange[i].hi/scene.dataScale[i],axes._m=1/(scene.dataScale[i]*glRange[i].pixelsPerDataUnit),axes.range[0]===axes.range[1]&&(axes.range[0]-=1,axes.range[1]+=1);var tickModeCached=axes.tickmode;if("auto"===axes.tickmode){axes.tickmode="linear";var nticks=axes.nticks||Lib.constrain(axes._length/40,4,9);Axes.autoTicks(axes,Math.abs(axes.range[1]-axes.range[0])/nticks)}for(var dataTicks=Axes.calcTicks(axes),j=0;j<dataTicks.length;++j)dataTicks[j].x=dataTicks[j].x*scene.dataScale[i],dataTicks[j].text=convertHTMLToUnicode(dataTicks[j].text);ticks[i]=dataTicks,axes.tickmode=tickModeCached}}axesOptions.ticks=ticks;for(var i=0;i<3;++i){centerPoint[i]=.5*(scene.glplot.bounds[0][i]+scene.glplot.bounds[1][i]);for(var j=0;j<2;++j)axesOptions.bounds[j][i]=scene.glplot.bounds[j][i]}scene.contourLevels=function contourLevelsFromTicks(ticks){for(var result=new Array(3),i=0;i<3;++i){for(var tlevel=ticks[i],clevel=new Array(tlevel.length),j=0;j<tlevel.length;++j)clevel[j]=tlevel[j].x;result[i]=clevel}return result}(ticks)};var Axes=_dereq_("../../cartesian/axes"),Lib=_dereq_("../../../lib"),convertHTMLToUnicode=_dereq_("../../../lib/html2unicode"),AXES_NAMES=["xaxis","yaxis","zaxis"],centerPoint=[0,0,0]},{"../../../lib":693,"../../../lib/html2unicode":691,"../../cartesian/axes":742}],793:[function(_dereq_,module,exports){"use strict";function xformMatrix(m,v){var i,j,out=[0,0,0,0];for(i=0;i<4;++i)for(j=0;j<4;++j)out[j]+=m[4*i+j]*v[i];return out}module.exports=function project(camera,v){return xformMatrix(camera.projection,xformMatrix(camera.view,xformMatrix(camera.model,[v[0],v[1],v[2],1])))}},{}],794:[function(_dereq_,module,exports){"use strict";var STATIC_CANVAS,STATIC_CONTEXT,createPlot=_dereq_("gl-plot3d"),getContext=_dereq_("webgl-context"),passiveSupported=_dereq_("has-passive-events"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),Fx=_dereq_("../../components/fx"),str2RGBAarray=_dereq_("../../lib/str2rgbarray"),showNoWebGlMsg=_dereq_("../../lib/show_no_webgl_msg"),createCamera=_dereq_("./camera"),project=_dereq_("./project"),createAxesOptions=_dereq_("./layout/convert"),createSpikeOptions=_dereq_("./layout/spikes"),computeTickMarks=_dereq_("./layout/tick_marks");function initializeGLPlot(scene,fullLayout,canvas,gl){var gd=scene.graphDiv,glplotOptions={canvas:canvas,gl:gl,container:scene.container,axes:scene.axesOptions,spikes:scene.spikeOptions,pickRadius:10,snapToData:!0,autoScale:!0,autoBounds:!1};if(scene.staticMode){if(!(STATIC_CONTEXT||(STATIC_CANVAS=document.createElement("canvas"),STATIC_CONTEXT=getContext({canvas:STATIC_CANVAS,preserveDrawingBuffer:!0,premultipliedAlpha:!0,antialias:!0}))))throw new Error("error creating static canvas/context for image server");glplotOptions.pixelRatio=scene.pixelRatio,glplotOptions.gl=STATIC_CONTEXT,glplotOptions.canvas=STATIC_CANVAS}try{scene.glplot=createPlot(glplotOptions)}catch(e){return showNoWebGlMsg(scene)}var relayoutCallback=function(scene){if(!1!==scene.fullSceneLayout.dragmode){var update={};update[scene.id+".camera"]=getLayoutCamera(scene.camera),scene.saveCamera(gd.layout),scene.graphDiv.emit("plotly_relayout",update)}};if(scene.glplot.canvas.addEventListener("mouseup",relayoutCallback.bind(null,scene)),scene.glplot.canvas.addEventListener("wheel",relayoutCallback.bind(null,scene),!!passiveSupported&&{passive:!1}),scene.staticMode||scene.glplot.canvas.addEventListener("webglcontextlost",function(event){gd&&gd.emit&&gd.emit("plotly_webglcontextlost",{event:event,layer:scene.id})},!1),!scene.camera){var cameraData=scene.fullSceneLayout.camera;scene.camera=createCamera(scene.container,{center:[cameraData.center.x,cameraData.center.y,cameraData.center.z],eye:[cameraData.eye.x,cameraData.eye.y,cameraData.eye.z],up:[cameraData.up.x,cameraData.up.y,cameraData.up.z],zoomMin:.1,zoomMax:100,mode:"orbit"})}return scene.glplot.camera=scene.camera,scene.glplot.oncontextloss=function(){scene.recoverContext()},scene.glplot.onrender=function render(scene){var trace,svgContainer=scene.svgContainer,clientRect=scene.container.getBoundingClientRect(),width=clientRect.width,height=clientRect.height;svgContainer.setAttributeNS(null,"viewBox","0 0 "+width+" "+height),svgContainer.setAttributeNS(null,"width",width),svgContainer.setAttributeNS(null,"height",height),computeTickMarks(scene),scene.glplot.axes.update(scene.axesOptions);for(var oldEventData,keys=Object.keys(scene.traces),lastPicked=null,selection=scene.glplot.selection,i=0;i<keys.length;++i)"skip"!==(trace=scene.traces[keys[i]]).data.hoverinfo&&trace.handlePick(selection)&&(lastPicked=trace),trace.setContourLevels&&trace.setContourLevels();function formatter(axisName,val){var axis=scene.fullSceneLayout[axisName];return Axes.tickText(axis,axis.d2l(val),"hover").text}if(null!==lastPicked){var pdata=project(scene.glplot.cameraParams,selection.dataCoordinate);trace=lastPicked.data;var tx,ptNumber=selection.index,hoverinfo=Fx.castHoverinfo(trace,scene.fullLayout,ptNumber),hoverinfoParts=hoverinfo.split("+"),isHoverinfoAll="all"===hoverinfo,xVal=formatter("xaxis",selection.traceCoordinate[0]),yVal=formatter("yaxis",selection.traceCoordinate[1]),zVal=formatter("zaxis",selection.traceCoordinate[2]);if(isHoverinfoAll||(-1===hoverinfoParts.indexOf("x")&&(xVal=void 0),-1===hoverinfoParts.indexOf("y")&&(yVal=void 0),-1===hoverinfoParts.indexOf("z")&&(zVal=void 0),-1===hoverinfoParts.indexOf("text")&&(selection.textLabel=void 0),-1===hoverinfoParts.indexOf("name")&&(lastPicked.name=void 0)),"cone"===trace.type||"streamtube"===trace.type){var vectorTx=[];(isHoverinfoAll||-1!==hoverinfoParts.indexOf("u"))&&vectorTx.push("u: "+formatter("xaxis",selection.traceCoordinate[3])),(isHoverinfoAll||-1!==hoverinfoParts.indexOf("v"))&&vectorTx.push("v: "+formatter("yaxis",selection.traceCoordinate[4])),(isHoverinfoAll||-1!==hoverinfoParts.indexOf("w"))&&vectorTx.push("w: "+formatter("zaxis",selection.traceCoordinate[5])),(isHoverinfoAll||-1!==hoverinfoParts.indexOf("norm"))&&vectorTx.push("norm: "+selection.traceCoordinate[6].toPrecision(3)),"streamtube"!==trace.type||!isHoverinfoAll&&-1===hoverinfoParts.indexOf("divergence")||vectorTx.push("divergence: "+selection.traceCoordinate[7].toPrecision(3)),selection.textLabel&&vectorTx.push(selection.textLabel),tx=vectorTx.join("<br>")}else tx=selection.textLabel;scene.fullSceneLayout.hovermode&&Fx.loneHover({x:(.5+.5*pdata[0]/pdata[3])*width,y:(.5-.5*pdata[1]/pdata[3])*height,xLabel:xVal,yLabel:yVal,zLabel:zVal,text:tx,name:lastPicked.name,color:Fx.castHoverOption(trace,ptNumber,"bgcolor")||lastPicked.color,borderColor:Fx.castHoverOption(trace,ptNumber,"bordercolor"),fontFamily:Fx.castHoverOption(trace,ptNumber,"font.family"),fontSize:Fx.castHoverOption(trace,ptNumber,"font.size"),fontColor:Fx.castHoverOption(trace,ptNumber,"font.color")},{container:svgContainer,gd:scene.graphDiv});var pointData={x:selection.traceCoordinate[0],y:selection.traceCoordinate[1],z:selection.traceCoordinate[2],data:trace._input,fullData:trace,curveNumber:trace.index,pointNumber:ptNumber};trace._module.eventData&&(pointData=trace._module.eventData(pointData,selection,trace,{},ptNumber)),Fx.appendArrayPointValue(pointData,trace,ptNumber);var eventData={points:[pointData]};selection.buttons&&selection.distance<5?scene.graphDiv.emit("plotly_click",eventData):scene.graphDiv.emit("plotly_hover",eventData),oldEventData=eventData}else Fx.loneUnhover(svgContainer),scene.graphDiv.emit("plotly_unhover",oldEventData);scene.drawAnnotations(scene)}.bind(null,scene),scene.traces={},!0}function Scene(options,fullLayout){var sceneContainer=document.createElement("div"),plotContainer=options.container;this.graphDiv=options.graphDiv;var svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg");svgContainer.style.position="absolute",svgContainer.style.top=svgContainer.style.left="0px",svgContainer.style.width=svgContainer.style.height="100%",svgContainer.style["z-index"]=20,svgContainer.style["pointer-events"]="none",sceneContainer.appendChild(svgContainer),this.svgContainer=svgContainer,sceneContainer.id=options.id,sceneContainer.style.position="absolute",sceneContainer.style.top=sceneContainer.style.left="0px",sceneContainer.style.width=sceneContainer.style.height="100%",plotContainer.appendChild(sceneContainer),this.fullLayout=fullLayout,this.id=options.id||"scene",this.fullSceneLayout=fullLayout[this.id],this.plotArgs=[[],{},{}],this.axesOptions=createAxesOptions(fullLayout[this.id]),this.spikeOptions=createSpikeOptions(fullLayout[this.id]),this.container=sceneContainer,this.staticMode=!!options.staticPlot,this.pixelRatio=options.plotGlPixelRatio||2,this.dataScale=[1,1,1],this.contourLevels=[[],[],[]],this.convertAnnotations=Registry.getComponentMethod("annotations3d","convert"),this.drawAnnotations=Registry.getComponentMethod("annotations3d","draw"),initializeGLPlot(this)}var proto=Scene.prototype;proto.recoverContext=function(){var scene=this,gl=this.glplot.gl,canvas=this.glplot.canvas;this.glplot.dispose(),requestAnimationFrame(function tryRecover(){gl.isContextLost()?requestAnimationFrame(tryRecover):initializeGLPlot(scene,scene.fullLayout,canvas,gl)?scene.plot.apply(scene,scene.plotArgs):Lib.error("Catastrophic and unrecoverable WebGL error. Context lost.")})};var axisProperties=["xaxis","yaxis","zaxis"];function computeTraceBounds(scene,trace,bounds){for(var sceneLayout=scene.fullSceneLayout,d=0;d<3;d++){var axisName=axisProperties[d],axLetter=axisName.charAt(0),ax=sceneLayout[axisName],coords=trace[axLetter],calendar=trace[axLetter+"calendar"],len=trace["_"+axLetter+"length"];if(Lib.isArrayOrTypedArray(coords))for(var v,i=0;i<(len||coords.length);i++)if(Lib.isArrayOrTypedArray(coords[i]))for(var j=0;j<coords[i].length;++j)v=ax.d2l(coords[i][j],0,calendar),!isNaN(v)&&isFinite(v)&&(bounds[0][d]=Math.min(bounds[0][d],v),bounds[1][d]=Math.max(bounds[1][d],v));else v=ax.d2l(coords[i],0,calendar),!isNaN(v)&&isFinite(v)&&(bounds[0][d]=Math.min(bounds[0][d],v),bounds[1][d]=Math.max(bounds[1][d],v));else bounds[0][d]=Math.min(bounds[0][d],0),bounds[1][d]=Math.max(bounds[1][d],len-1)}}function getLayoutCamera(camera){return{up:{x:camera.up[0],y:camera.up[1],z:camera.up[2]},center:{x:camera.center[0],y:camera.center[1],z:camera.center[2]},eye:{x:camera.eye[0],y:camera.eye[1],z:camera.eye[2]}}}proto.plot=function(sceneData,fullLayout,layout){if(this.plotArgs=[sceneData,fullLayout,layout],!this.glplot.contextLost){var data,trace,i,j,axis,axisType,fullSceneLayout=fullLayout[this.id],sceneLayout=layout[this.id];fullSceneLayout.bgcolor?this.glplot.clearColor=str2RGBAarray(fullSceneLayout.bgcolor):this.glplot.clearColor=[0,0,0,0],this.glplot.snapToData=!0,this.fullLayout=fullLayout,this.fullSceneLayout=fullSceneLayout,this.glplotLayout=fullSceneLayout,this.axesOptions.merge(fullSceneLayout),this.spikeOptions.merge(fullSceneLayout),this.setCamera(fullSceneLayout.camera),this.updateFx(fullSceneLayout.dragmode,fullSceneLayout.hovermode),this.glplot.update({}),this.setConvert(axis),sceneData?Array.isArray(sceneData)||(sceneData=[sceneData]):sceneData=[];var dataBounds=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];for(i=0;i<sceneData.length;++i)!0===(data=sceneData[i]).visible&&computeTraceBounds(this,data,dataBounds);var dataScale=[1,1,1];for(j=0;j<3;++j)dataBounds[0][j]>dataBounds[1][j]?dataScale[j]=1:dataBounds[1][j]===dataBounds[0][j]?dataScale[j]=1:dataScale[j]=1/(dataBounds[1][j]-dataBounds[0][j]);for(this.dataScale=dataScale,this.convertAnnotations(this),i=0;i<sceneData.length;++i)!0===(data=sceneData[i]).visible&&((trace=this.traces[data.uid])?trace.data.type===data.type?trace.update(data):(trace.dispose(),trace=data._module.plot(this,data),this.traces[data.uid]=trace):(trace=data._module.plot(this,data),this.traces[data.uid]=trace),trace.name=data.name);var traceIds=Object.keys(this.traces);trace_id_loop:for(i=0;i<traceIds.length;++i){for(j=0;j<sceneData.length;++j)if(sceneData[j].uid===traceIds[i]&&!0===sceneData[j].visible)continue trace_id_loop;(trace=this.traces[traceIds[i]]).dispose(),delete this.traces[traceIds[i]]}this.glplot.objects.sort(function(a,b){return a._trace.data.index-b._trace.data.index});var sceneBounds=[[0,0,0],[0,0,0]],axisDataRange=[],axisTypeRatios={};for(i=0;i<3;++i){if((axisType=(axis=fullSceneLayout[axisProperties[i]]).type)in axisTypeRatios?(axisTypeRatios[axisType].acc*=dataScale[i],axisTypeRatios[axisType].count+=1):axisTypeRatios[axisType]={acc:dataScale[i],count:1},axis.autorange){sceneBounds[0][i]=1/0,sceneBounds[1][i]=-1/0;var objects=this.glplot.objects,annotations=this.fullSceneLayout.annotations||[],axLetter=axis._name.charAt(0);for(j=0;j<objects.length;j++){var obj=objects[j],objBounds=obj.bounds,pad=obj._trace.data._pad||0;"ErrorBars"===obj.constructor.name&&axis._lowerLogErrorBound?sceneBounds[0][i]=Math.min(sceneBounds[0][i],axis._lowerLogErrorBound):sceneBounds[0][i]=Math.min(sceneBounds[0][i],objBounds[0][i]/dataScale[i]-pad),sceneBounds[1][i]=Math.max(sceneBounds[1][i],objBounds[1][i]/dataScale[i]+pad)}for(j=0;j<annotations.length;j++){var ann=annotations[j];if(ann.visible){var pos=axis.r2l(ann[axLetter]);sceneBounds[0][i]=Math.min(sceneBounds[0][i],pos),sceneBounds[1][i]=Math.max(sceneBounds[1][i],pos)}}if("rangemode"in axis&&"tozero"===axis.rangemode&&(sceneBounds[0][i]=Math.min(sceneBounds[0][i],0),sceneBounds[1][i]=Math.max(sceneBounds[1][i],0)),sceneBounds[0][i]>sceneBounds[1][i])sceneBounds[0][i]=-1,sceneBounds[1][i]=1;else{var d=sceneBounds[1][i]-sceneBounds[0][i];sceneBounds[0][i]-=d/32,sceneBounds[1][i]+=d/32}}else{var range=axis.range;sceneBounds[0][i]=axis.r2l(range[0]),sceneBounds[1][i]=axis.r2l(range[1])}sceneBounds[0][i]===sceneBounds[1][i]&&(sceneBounds[0][i]-=1,sceneBounds[1][i]+=1),axisDataRange[i]=sceneBounds[1][i]-sceneBounds[0][i],this.glplot.bounds[0][i]=sceneBounds[0][i]*dataScale[i],this.glplot.bounds[1][i]=sceneBounds[1][i]*dataScale[i]}var axesScaleRatio=[1,1,1];for(i=0;i<3;++i){var axisRatio=axisTypeRatios[axisType=(axis=fullSceneLayout[axisProperties[i]]).type];axesScaleRatio[i]=Math.pow(axisRatio.acc,1/axisRatio.count)/dataScale[i]}var aspectRatio;if("auto"===fullSceneLayout.aspectmode)aspectRatio=Math.max.apply(null,axesScaleRatio)/Math.min.apply(null,axesScaleRatio)<=4?axesScaleRatio:[1,1,1];else if("cube"===fullSceneLayout.aspectmode)aspectRatio=[1,1,1];else if("data"===fullSceneLayout.aspectmode)aspectRatio=axesScaleRatio;else{if("manual"!==fullSceneLayout.aspectmode)throw new Error("scene.js aspectRatio was not one of the enumerated types");var userRatio=fullSceneLayout.aspectratio;aspectRatio=[userRatio.x,userRatio.y,userRatio.z]}fullSceneLayout.aspectratio.x=sceneLayout.aspectratio.x=aspectRatio[0],fullSceneLayout.aspectratio.y=sceneLayout.aspectratio.y=aspectRatio[1],fullSceneLayout.aspectratio.z=sceneLayout.aspectratio.z=aspectRatio[2],this.glplot.aspect=aspectRatio;var domain=fullSceneLayout.domain||null,size=fullLayout._size||null;if(domain&&size){var containerStyle=this.container.style;containerStyle.position="absolute",containerStyle.left=size.l+domain.x[0]*size.w+"px",containerStyle.top=size.t+(1-domain.y[1])*size.h+"px",containerStyle.width=size.w*(domain.x[1]-domain.x[0])+"px",containerStyle.height=size.h*(domain.y[1]-domain.y[0])+"px"}this.glplot.redraw()}},proto.destroy=function(){this.glplot&&(this.camera.mouseListener.enabled=!1,this.container.removeEventListener("wheel",this.camera.wheelListener),this.camera=this.glplot.camera=null,this.glplot.dispose(),this.container.parentNode.removeChild(this.container),this.glplot=null)},proto.getCamera=function getCamera(){return this.glplot.camera.view.recalcMatrix(this.camera.view.lastT()),getLayoutCamera(this.glplot.camera)},proto.setCamera=function setCamera(cameraData){this.glplot.camera.lookAt.apply(this,function getOrbitCamera(camera){return[[camera.eye.x,camera.eye.y,camera.eye.z],[camera.center.x,camera.center.y,camera.center.z],[camera.up.x,camera.up.y,camera.up.z]]}(cameraData))},proto.saveCamera=function saveCamera(layout){var cameraData=this.getCamera(),cameraNestedProp=Lib.nestedProperty(layout,this.id+".camera"),cameraDataLastSave=cameraNestedProp.get(),hasChanged=!1;function same(x,y,i,j){var vectors=["up","center","eye"],components=["x","y","z"];return y[vectors[i]]&&x[vectors[i]][components[j]]===y[vectors[i]][components[j]]}if(void 0===cameraDataLastSave)hasChanged=!0;else for(var i=0;i<3;i++)for(var j=0;j<3;j++)if(!same(cameraData,cameraDataLastSave,i,j)){hasChanged=!0;break}return hasChanged&&cameraNestedProp.set(cameraData),hasChanged},proto.updateFx=function(dragmode,hovermode){var camera=this.camera;camera&&("orbit"===dragmode?(camera.mode="orbit",camera.keyBindingMode="rotate"):"turntable"===dragmode?(camera.up=[0,0,1],camera.mode="turntable",camera.keyBindingMode="rotate"):camera.keyBindingMode=dragmode),this.fullSceneLayout.hovermode=hovermode},proto.toImage=function(format){format||(format="png"),this.staticMode&&this.container.appendChild(STATIC_CANVAS),this.glplot.redraw();var gl=this.glplot.gl,w=gl.drawingBufferWidth,h=gl.drawingBufferHeight;gl.bindFramebuffer(gl.FRAMEBUFFER,null);var pixels=new Uint8Array(w*h*4);gl.readPixels(0,0,w,h,gl.RGBA,gl.UNSIGNED_BYTE,pixels);for(var j=0,k=h-1;j<k;++j,--k)for(var i=0;i<w;++i)for(var l=0;l<4;++l){var tmp=pixels[4*(w*j+i)+l];pixels[4*(w*j+i)+l]=pixels[4*(w*k+i)+l],pixels[4*(w*k+i)+l]=tmp}var canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;var dataURL,context=canvas.getContext("2d"),imageData=context.createImageData(w,h);switch(imageData.data.set(pixels),context.putImageData(imageData,0,0),format){case"jpeg":dataURL=canvas.toDataURL("image/jpeg");break;case"webp":dataURL=canvas.toDataURL("image/webp");break;default:dataURL=canvas.toDataURL("image/png")}return this.staticMode&&this.container.removeChild(STATIC_CANVAS),dataURL},proto.setConvert=function(){for(var i=0;i<3;i++){var ax=this.fullSceneLayout[axisProperties[i]];Axes.setConvert(ax,this.fullLayout),ax.setScale=Lib.noop}},module.exports=Scene},{"../../components/fx":609,"../../lib":693,"../../lib/show_no_webgl_msg":715,"../../lib/str2rgbarray":717,"../../plots/cartesian/axes":742,"../../registry":825,"./camera":783,"./layout/convert":788,"./layout/spikes":791,"./layout/tick_marks":792,"./project":793,"gl-plot3d":276,"has-passive-events":392,"webgl-context":530}],795:[function(_dereq_,module,exports){"use strict";module.exports=function zip3(x,y,z,len){len=len||x.length;for(var result=new Array(len),i=0;i<len;i++)result[i]=[x[i],y[i],z[i]];return result}},{}],796:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("./font_attributes"),colorAttrs=_dereq_("../components/color/attributes"),globalFont=fontAttrs({editType:"calc"});globalFont.family.dflt='"Open Sans", verdana, arial, sans-serif',globalFont.size.dflt=12,globalFont.color.dflt=colorAttrs.defaultLine,module.exports={font:globalFont,title:{valType:"string",editType:"layoutstyle"},titlefont:fontAttrs({editType:"layoutstyle"}),autosize:{valType:"boolean",dflt:!1,editType:"none"},width:{valType:"number",min:10,dflt:700,editType:"plot"},height:{valType:"number",min:10,dflt:450,editType:"plot"},margin:{l:{valType:"number",min:0,dflt:80,editType:"plot"},r:{valType:"number",min:0,dflt:80,editType:"plot"},t:{valType:"number",min:0,dflt:100,editType:"plot"},b:{valType:"number",min:0,dflt:80,editType:"plot"},pad:{valType:"number",min:0,dflt:0,editType:"plot"},autoexpand:{valType:"boolean",dflt:!0,editType:"plot"},editType:"plot"},paper_bgcolor:{valType:"color",dflt:colorAttrs.background,editType:"plot"},plot_bgcolor:{valType:"color",dflt:colorAttrs.background,editType:"layoutstyle"},separators:{valType:"string",editType:"plot"},hidesources:{valType:"boolean",dflt:!1,editType:"plot"},showlegend:{valType:"boolean",editType:"legend"},colorway:{valType:"colorlist",dflt:colorAttrs.defaults,editType:"calc"},datarevision:{valType:"any",editType:"calc"},template:{valType:"any",editType:"calc"}}},{"../components/color/attributes":566,"./font_attributes":768}],797:[function(_dereq_,module,exports){"use strict";module.exports={requiredVersion:"0.45.0",styleUrlPrefix:"mapbox://styles/mapbox/",styleUrlSuffix:"v9",controlContainerClassName:"mapboxgl-control-container",wrongVersionErrorMsg:["Your custom plotly.js bundle is not using the correct mapbox-gl version","Please install mapbox-gl@0.45.0."].join("\n"),noAccessTokenErrorMsg:["Missing Mapbox access token.","Mapbox trace type require a Mapbox access token to be registered.","For example:","  Plotly.plot(gd, data, layout, { mapboxAccessToken: 'my-access-token' });","More info here: https://www.mapbox.com/help/define-access-token/"].join("\n"),mapOnErrorMsg:"Mapbox error.",styleRules:{map:"overflow:hidden;position:relative;","missing-css":"display:none"}}},{}],798:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function convertTextOpts(textposition,iconSize){var parts=textposition.split(" "),vPos=parts[0],hPos=parts[1],factor=Lib.isArrayOrTypedArray(iconSize)?Lib.mean(iconSize):iconSize,xInc=.5+factor/100,yInc=1.5+factor/100,anchorVals=["",""],offset=[0,0];switch(vPos){case"top":anchorVals[0]="top",offset[1]=-yInc;break;case"bottom":anchorVals[0]="bottom",offset[1]=yInc}switch(hPos){case"left":anchorVals[1]="right",offset[0]=-xInc;break;case"right":anchorVals[1]="left",offset[0]=xInc}return{anchor:anchorVals[0]&&anchorVals[1]?anchorVals.join("-"):anchorVals[0]?anchorVals[0]:anchorVals[1]?anchorVals[1]:"center",offset:offset}}},{"../../lib":693}],799:[function(_dereq_,module,exports){"use strict";var mapboxgl=_dereq_("mapbox-gl"),Lib=_dereq_("../../lib"),getSubplotCalcData=_dereq_("../../plots/get_data").getSubplotCalcData,xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces"),createMapbox=_dereq_("./mapbox"),constants=_dereq_("./constants");for(var k in constants.styleRules)Lib.addStyleRule(".mapboxgl-"+k,constants.styleRules[k]);exports.name="mapbox",exports.attr="subplot",exports.idRoot="mapbox",exports.idRegex=exports.attrRegex=Lib.counterRegex("mapbox"),exports.attributes={subplot:{valType:"subplotid",dflt:"mapbox",editType:"calc"}},exports.layoutAttributes=_dereq_("./layout_attributes"),exports.supplyLayoutDefaults=_dereq_("./layout_defaults"),exports.plot=function plotMapbox(gd){var fullLayout=gd._fullLayout,calcData=gd.calcdata,mapboxIds=fullLayout._subplots.mapbox;if(mapboxgl.version!==constants.requiredVersion)throw new Error(constants.wrongVersionErrorMsg);var accessToken=function findAccessToken(gd,mapboxIds){var fullLayout=gd._fullLayout;if(""===gd._context.mapboxAccessToken)return"";for(var i=0;i<mapboxIds.length;i++){var opts=fullLayout[mapboxIds[i]];if(opts.accesstoken)return opts.accesstoken}throw new Error(constants.noAccessTokenErrorMsg)}(gd,mapboxIds);mapboxgl.accessToken=accessToken;for(var i=0;i<mapboxIds.length;i++){var id=mapboxIds[i],subplotCalcData=getSubplotCalcData(calcData,"mapbox",id),opts=fullLayout[id],mapbox=opts._subplot;mapbox||(mapbox=createMapbox({gd:gd,container:fullLayout._glcontainer.node(),id:id,fullLayout:fullLayout,staticPlot:gd._context.staticPlot}),fullLayout[id]._subplot=mapbox),mapbox.viewInitial||(mapbox.viewInitial={center:Lib.extendFlat({},opts.center),zoom:opts.zoom,bearing:opts.bearing,pitch:opts.pitch}),mapbox.plot(subplotCalcData,fullLayout,gd._promises)}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldMapboxKeys=oldFullLayout._subplots.mapbox||[],i=0;i<oldMapboxKeys.length;i++){var oldMapboxKey=oldMapboxKeys[i];!newFullLayout[oldMapboxKey]&&oldFullLayout[oldMapboxKey]._subplot&&oldFullLayout[oldMapboxKey]._subplot.destroy()}},exports.toSVG=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.mapbox,size=fullLayout._size,i=0;i<subplotIds.length;i++){var opts=fullLayout[subplotIds[i]],domain=opts.domain,mapbox=opts._subplot,imageData=mapbox.toImage("png");fullLayout._glimages.append("svg:image").attr({xmlns:xmlnsNamespaces.svg,"xlink:href":imageData,x:size.l+size.w*domain.x[0],y:size.t+size.h*(1-domain.y[1]),width:size.w*(domain.x[1]-domain.x[0]),height:size.h*(domain.y[1]-domain.y[0]),preserveAspectRatio:"none"}),mapbox.destroy()}},exports.updateFx=function(gd){for(var fullLayout=gd._fullLayout,subplotIds=fullLayout._subplots.mapbox,i=0;i<subplotIds.length;i++){fullLayout[subplotIds[i]]._subplot.updateFx(fullLayout)}}},{"../../constants/xmlns_namespaces":671,"../../lib":693,"../../plots/get_data":778,"./constants":797,"./layout_attributes":801,"./layout_defaults":802,"./mapbox":803,"mapbox-gl":406}],800:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),convertTextOpts=_dereq_("./convert_text_opts");function MapboxLayer(mapbox,index){this.mapbox=mapbox,this.map=mapbox.map,this.uid=mapbox.uid+"-layer"+index,this.idSource=this.uid+"-source",this.idLayer=this.uid+"-layer",this.sourceType=null,this.source=null,this.layerType=null,this.below=null,this.visible=!1}var proto=MapboxLayer.prototype;function isVisible(opts){var source=opts.source;return opts.visible&&(Lib.isPlainObject(source)||"string"==typeof source&&source.length>0)}function convertOpts(opts){var layout={},paint={};switch(opts.type){case"circle":Lib.extendFlat(paint,{"circle-radius":opts.circle.radius,"circle-color":opts.color,"circle-opacity":opts.opacity});break;case"line":Lib.extendFlat(paint,{"line-width":opts.line.width,"line-color":opts.color,"line-opacity":opts.opacity});break;case"fill":Lib.extendFlat(paint,{"fill-color":opts.color,"fill-outline-color":opts.fill.outlinecolor,"fill-opacity":opts.opacity});break;case"symbol":var symbol=opts.symbol,textOpts=convertTextOpts(symbol.textposition,symbol.iconsize);Lib.extendFlat(layout,{"icon-image":symbol.icon+"-15","icon-size":symbol.iconsize/10,"text-field":symbol.text,"text-size":symbol.textfont.size,"text-anchor":textOpts.anchor,"text-offset":textOpts.offset}),Lib.extendFlat(paint,{"icon-color":opts.color,"text-color":symbol.textfont.color,"text-opacity":opts.opacity})}return{layout:layout,paint:paint}}proto.update=function update(opts){this.visible?this.needsNewSource(opts)?(this.removeLayer(),this.updateSource(opts),this.updateLayer(opts)):this.needsNewLayer(opts)?this.updateLayer(opts):this.updateStyle(opts):(this.updateSource(opts),this.updateLayer(opts)),this.visible=isVisible(opts)},proto.needsNewSource=function(opts){return this.sourceType!==opts.sourcetype||this.source!==opts.source||this.layerType!==opts.type},proto.needsNewLayer=function(opts){return this.layerType!==opts.type||this.below!==opts.below},proto.updateSource=function(opts){var map=this.map;if(map.getSource(this.idSource)&&map.removeSource(this.idSource),this.sourceType=opts.sourcetype,this.source=opts.source,isVisible(opts)){var sourceOpts=function convertSourceOpts(opts){var field,sourceType=opts.sourcetype,source=opts.source,sourceOpts={type:sourceType};"geojson"===sourceType?field="data":"vector"===sourceType&&(field="string"==typeof source?"url":"tiles");return sourceOpts[field]=source,sourceOpts}(opts);map.addSource(this.idSource,sourceOpts)}},proto.updateLayer=function(opts){var map=this.map,convertedOpts=convertOpts(opts);this.removeLayer(),this.layerType=opts.type,isVisible(opts)&&map.addLayer({id:this.idLayer,source:this.idSource,"source-layer":opts.sourcelayer||"",type:opts.type,layout:convertedOpts.layout,paint:convertedOpts.paint},opts.below)},proto.updateStyle=function(opts){if(isVisible(opts)){var convertedOpts=convertOpts(opts);this.mapbox.setOptions(this.idLayer,"setLayoutProperty",convertedOpts.layout),this.mapbox.setOptions(this.idLayer,"setPaintProperty",convertedOpts.paint)}},proto.removeLayer=function(){var map=this.map;map.getLayer(this.idLayer)&&map.removeLayer(this.idLayer)},proto.dispose=function dispose(){var map=this.map;map.removeLayer(this.idLayer),map.removeSource(this.idSource)},module.exports=function createMapboxLayer(mapbox,index,opts){var mapboxLayer=new MapboxLayer(mapbox,index);return mapboxLayer.update(opts),mapboxLayer}},{"../../lib":693,"./convert_text_opts":798}],801:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),defaultLine=_dereq_("../../components/color").defaultLine,domainAttrs=_dereq_("../domain").attributes,fontAttrs=_dereq_("../font_attributes"),textposition=_dereq_("../../traces/scatter/attributes").textposition,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray,fontAttr=fontAttrs({});fontAttr.family.dflt="Open Sans Regular, Arial Unicode MS Regular",module.exports=overrideAll({_arrayAttrRegexps:[Lib.counterRegex("mapbox",".layers",!0)],domain:domainAttrs({name:"mapbox"}),accesstoken:{valType:"string",noBlank:!0,strict:!0},style:{valType:"any",values:["basic","streets","outdoors","light","dark","satellite","satellite-streets"],dflt:"basic"},center:{lon:{valType:"number",dflt:0},lat:{valType:"number",dflt:0}},zoom:{valType:"number",dflt:1},bearing:{valType:"number",dflt:0},pitch:{valType:"number",dflt:0},layers:templatedArray("layer",{visible:{valType:"boolean",dflt:!0},sourcetype:{valType:"enumerated",values:["geojson","vector"],dflt:"geojson"},source:{valType:"any"},sourcelayer:{valType:"string",dflt:""},type:{valType:"enumerated",values:["circle","line","fill","symbol"],dflt:"circle"},below:{valType:"string",dflt:""},color:{valType:"color",dflt:defaultLine},opacity:{valType:"number",min:0,max:1,dflt:1},circle:{radius:{valType:"number",dflt:15}},line:{width:{valType:"number",dflt:2}},fill:{outlinecolor:{valType:"color",dflt:defaultLine}},symbol:{icon:{valType:"string",dflt:"marker"},iconsize:{valType:"number",dflt:10},text:{valType:"string",dflt:""},textfont:fontAttr,textposition:Lib.extendFlat({},textposition,{arrayOk:!1})}})},"plot","from-root")},{"../../components/color":567,"../../lib":693,"../../plot_api/edit_types":725,"../../plot_api/plot_template":732,"../../traces/scatter/attributes":1032,"../domain":767,"../font_attributes":768}],802:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleSubplotDefaults=_dereq_("../subplot_defaults"),handleArrayContainerDefaults=_dereq_("../array_container_defaults"),layoutAttributes=_dereq_("./layout_attributes");function handleDefaults(containerIn,containerOut,coerce,opts){coerce("accesstoken",opts.accessToken),coerce("style"),coerce("center.lon"),coerce("center.lat"),coerce("zoom"),coerce("bearing"),coerce("pitch"),handleArrayContainerDefaults(containerIn,containerOut,{name:"layers",handleItemDefaults:handleLayerDefaults}),containerOut._input=containerIn}function handleLayerDefaults(layerIn,layerOut){function coerce(attr,dflt){return Lib.coerce(layerIn,layerOut,layoutAttributes.layers,attr,dflt)}if(coerce("visible")){var sourceType=coerce("sourcetype");coerce("source"),"vector"===sourceType&&coerce("sourcelayer");var type=coerce("type");coerce("below"),coerce("color"),coerce("opacity"),"circle"===type&&coerce("circle.radius"),"line"===type&&coerce("line.width"),"fill"===type&&coerce("fill.outlinecolor"),"symbol"===type&&(coerce("symbol.icon"),coerce("symbol.iconsize"),coerce("symbol.text"),Lib.coerceFont(coerce,"symbol.textfont"),coerce("symbol.textposition"))}}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){handleSubplotDefaults(layoutIn,layoutOut,fullData,{type:"mapbox",attributes:layoutAttributes,handleDefaults:handleDefaults,partition:"y",accessToken:layoutOut._mapboxAccessToken})}},{"../../lib":693,"../array_container_defaults":738,"../subplot_defaults":820,"./layout_attributes":801}],803:[function(_dereq_,module,exports){"use strict";var mapboxgl=_dereq_("mapbox-gl"),Fx=_dereq_("../../components/fx"),Lib=_dereq_("../../lib"),dragElement=_dereq_("../../components/dragelement"),prepSelect=_dereq_("../cartesian/select").prepSelect,selectOnClick=_dereq_("../cartesian/select").selectOnClick,constants=_dereq_("./constants"),layoutAttributes=_dereq_("./layout_attributes"),createMapboxLayer=_dereq_("./layers");function Mapbox(opts){this.id=opts.id,this.gd=opts.gd,this.container=opts.container,this.isStatic=opts.staticPlot;var fullLayout=opts.fullLayout;this.uid=fullLayout._uid+"-"+this.id,this.opts=fullLayout[this.id],this.div=null,this.xaxis=null,this.yaxis=null,this.createFramework(fullLayout),this.map=null,this.accessToken=null,this.styleObj=null,this.traceHash={},this.layerList=[]}var proto=Mapbox.prototype;function getStyleObj(val){var styleValues=layoutAttributes.style.values,styleDflt=layoutAttributes.style.dflt,styleObj={};return Lib.isPlainObject(val)?(styleObj.id=val.id,styleObj.style=val):"string"==typeof val?(styleObj.id=val,styleObj.style=-1!==styleValues.indexOf(val)?convertStyleVal(val):val):(styleObj.id=styleDflt,styleObj.style=convertStyleVal(styleDflt)),styleObj.transition={duration:0,delay:0},styleObj}function convertStyleVal(val){return constants.styleUrlPrefix+val+"-"+constants.styleUrlSuffix}function convertCenter(center){return[center.lon,center.lat]}module.exports=function createMapbox(opts){return new Mapbox(opts)},proto.plot=function(calcData,fullLayout,promises){var promise,self=this,opts=self.opts=fullLayout[this.id];self.map&&opts.accesstoken!==self.accessToken&&(self.map.remove(),self.map=null,self.styleObj=null,self.traceHash=[],self.layerList={}),promise=self.map?new Promise(function(resolve,reject){self.updateMap(calcData,fullLayout,resolve,reject)}):new Promise(function(resolve,reject){self.createMap(calcData,fullLayout,resolve,reject)}),promises.push(promise)},proto.createMap=function(calcData,fullLayout,resolve,reject){var self=this,gd=self.gd,opts=self.opts,styleObj=self.styleObj=getStyleObj(opts.style);self.accessToken=opts.accesstoken;var map=self.map=new mapboxgl.Map({container:self.div,style:styleObj.style,center:convertCenter(opts.center),zoom:opts.zoom,bearing:opts.bearing,pitch:opts.pitch,interactive:!self.isStatic,preserveDrawingBuffer:self.isStatic,doubleClickZoom:!1,boxZoom:!1}),className=constants.controlContainerClassName,controlContainer=self.div.getElementsByClassName(className)[0];if(self.div.removeChild(controlContainer),map._canvas.style.left="0px",map._canvas.style.top="0px",self.rejectOnError(reject),map.once("load",function(){self.updateData(calcData),self.updateLayout(fullLayout),self.resolveOnRender(resolve)}),!self.isStatic){var wheeling=!1;map.on("moveend",function(eventData){if(self.map){var view=self.getView();opts._input.center=opts.center=view.center,opts._input.zoom=opts.zoom=view.zoom,opts._input.bearing=opts.bearing=view.bearing,opts._input.pitch=opts.pitch=view.pitch,(eventData.originalEvent||wheeling)&&emitRelayoutFromView(view),wheeling=!1}}),map.on("wheel",function(){wheeling=!0}),map.on("mousemove",function(evt){var bb=self.div.getBoundingClientRect();evt.clientX=evt.point.x+bb.left,evt.clientY=evt.point.y+bb.top,evt.target.getBoundingClientRect=function(){return bb},self.xaxis.p2c=function(){return evt.lngLat.lng},self.yaxis.p2c=function(){return evt.lngLat.lat},Fx.hover(gd,evt,self.id)}),map.on("dragstart",unhover),map.on("zoomstart",unhover),map.on("dblclick",function(){gd.emit("plotly_doubleclick",null);var viewInitial=self.viewInitial;map.setCenter(convertCenter(viewInitial.center)),map.setZoom(viewInitial.zoom),map.setBearing(viewInitial.bearing),map.setPitch(viewInitial.pitch);var viewNow=self.getView();opts._input.center=opts.center=viewNow.center,opts._input.zoom=opts.zoom=viewNow.zoom,opts._input.bearing=opts.bearing=viewNow.bearing,opts._input.pitch=opts.pitch=viewNow.pitch,emitRelayoutFromView(viewNow)}),self.clearSelect=function(){gd._fullLayout._zoomlayer.selectAll(".select-outline").remove()},self.onClickInPanFn=function(dragOptions){return function(evt){var clickMode=gd._fullLayout.clickmode;clickMode.indexOf("select")>-1&&selectOnClick(evt.originalEvent,gd,[self.xaxis],[self.yaxis],self.id,dragOptions),clickMode.indexOf("event")>-1&&Fx.click(gd,evt.originalEvent)}}}function unhover(){Fx.loneUnhover(fullLayout._toppaper)}function emitRelayoutFromView(view){var id=self.id,evtData={};for(var k in view)evtData[id+"."+k]=view[k];gd.emit("plotly_relayout",evtData)}},proto.updateMap=function(calcData,fullLayout,resolve,reject){var self=this,map=self.map;self.rejectOnError(reject);var styleObj=getStyleObj(self.opts.style);self.styleObj.id!==styleObj.id?(self.styleObj=styleObj,map.setStyle(styleObj.style),map.once("styledata",function(){self.traceHash={},self.updateData(calcData),self.updateLayout(fullLayout),self.resolveOnRender(resolve)})):(self.updateData(calcData),self.updateLayout(fullLayout),self.resolveOnRender(resolve))},proto.updateData=function(calcData){var traceObj,trace,i,j,traceHash=this.traceHash;for(i=0;i<calcData.length;i++){var calcTrace=calcData[i];(traceObj=traceHash[(trace=calcTrace[0].trace).uid])?traceObj.update(calcTrace):trace._module&&(traceHash[trace.uid]=trace._module.plot(this,calcTrace))}var ids=Object.keys(traceHash);id_loop:for(i=0;i<ids.length;i++){var id=ids[i];for(j=0;j<calcData.length;j++)if(id===(trace=calcData[j][0].trace).uid)continue id_loop;(traceObj=traceHash[id]).dispose(),delete traceHash[id]}},proto.updateLayout=function(fullLayout){var map=this.map,opts=this.opts;map.setCenter(convertCenter(opts.center)),map.setZoom(opts.zoom),map.setBearing(opts.bearing),map.setPitch(opts.pitch),this.updateLayers(),this.updateFramework(fullLayout),this.updateFx(fullLayout),this.map.resize()},proto.resolveOnRender=function(resolve){var map=this.map;map.on("render",function onRender(){map.loaded()&&(map.off("render",onRender),setTimeout(resolve,0))})},proto.rejectOnError=function(reject){var map=this.map;function handler(){reject(new Error(constants.mapOnErrorMsg))}map.once("error",handler),map.once("style.error",handler),map.once("source.error",handler),map.once("tile.error",handler),map.once("layer.error",handler)},proto.createFramework=function(fullLayout){var self=this,div=self.div=document.createElement("div");div.id=self.uid,div.style.position="absolute",self.container.appendChild(div),self.xaxis={_id:"x",c2p:function(v){return self.project(v).x}},self.yaxis={_id:"y",c2p:function(v){return self.project(v).y}},self.updateFramework(fullLayout)},proto.updateFx=function(fullLayout){var self=this,map=self.map,gd=self.gd;if(!self.isStatic){var fillRangeItems,dragMode=fullLayout.dragmode;fillRangeItems="select"===dragMode?function(eventData,poly){(eventData.range={})[self.id]=[invert([poly.xmin,poly.ymin]),invert([poly.xmax,poly.ymax])]}:function(eventData,poly,pts){(eventData.lassoPoints={})[self.id]=pts.filtered.map(invert)};var oldDragOptions=self.dragOptions;self.dragOptions=Lib.extendDeep(oldDragOptions||{},{element:self.div,gd:gd,plotinfo:{id:self.id,xaxis:self.xaxis,yaxis:self.yaxis,fillRangeItems:fillRangeItems},xaxes:[self.xaxis],yaxes:[self.yaxis],subplot:self.id}),map.off("click",self.onClickInPanHandler),"select"===dragMode||"lasso"===dragMode?(map.dragPan.disable(),map.on("zoomstart",self.clearSelect),self.dragOptions.prepFn=function(e,startX,startY){prepSelect(e,startX,startY,self.dragOptions,dragMode)},dragElement.init(self.dragOptions)):(map.dragPan.enable(),map.off("zoomstart",self.clearSelect),self.div.onmousedown=null,self.onClickInPanHandler=self.onClickInPanFn(self.dragOptions),map.on("click",self.onClickInPanHandler))}function invert(pxpy){var obj=self.map.unproject(pxpy);return[obj.lng,obj.lat]}},proto.updateFramework=function(fullLayout){var domain=fullLayout[this.id].domain,size=fullLayout._size,style=this.div.style;style.width=size.w*(domain.x[1]-domain.x[0])+"px",style.height=size.h*(domain.y[1]-domain.y[0])+"px",style.left=size.l+domain.x[0]*size.w+"px",style.top=size.t+(1-domain.y[1])*size.h+"px",this.xaxis._offset=size.l+domain.x[0]*size.w,this.xaxis._length=size.w*(domain.x[1]-domain.x[0]),this.yaxis._offset=size.t+(1-domain.y[1])*size.h,this.yaxis._length=size.h*(domain.y[1]-domain.y[0])},proto.updateLayers=function(){var i,layers=this.opts.layers,layerList=this.layerList;if(layers.length!==layerList.length){for(i=0;i<layerList.length;i++)layerList[i].dispose();for(layerList=this.layerList=[],i=0;i<layers.length;i++)layerList.push(createMapboxLayer(this,i,layers[i]))}else for(i=0;i<layers.length;i++)layerList[i].update(layers[i])},proto.destroy=function(){this.map&&(this.map.remove(),this.map=null,this.container.removeChild(this.div))},proto.toImage=function(){return this.map.stop(),this.map.getCanvas().toDataURL()},proto.setOptions=function(id,methodName,opts){for(var k in opts)this.map[methodName](id,k,opts[k])},proto.project=function(v){return this.map.project(new mapboxgl.LngLat(v[0],v[1]))},proto.getView=function(){var map=this.map,mapCenter=map.getCenter();return{center:{lon:mapCenter.lng,lat:mapCenter.lat},zoom:map.getZoom(),bearing:map.getBearing(),pitch:map.getPitch()}}},{"../../components/dragelement":589,"../../components/fx":609,"../../lib":693,"../cartesian/select":759,"./constants":797,"./layers":800,"./layout_attributes":801,"mapbox-gl":406}],804:[function(_dereq_,module,exports){"use strict";module.exports={t:{valType:"number",dflt:0,editType:"arraydraw"},r:{valType:"number",dflt:0,editType:"arraydraw"},b:{valType:"number",dflt:0,editType:"arraydraw"},l:{valType:"number",dflt:0,editType:"arraydraw"},editType:"arraydraw"}},{}],805:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Registry=_dereq_("../registry"),PlotSchema=_dereq_("../plot_api/plot_schema"),Template=_dereq_("../plot_api/plot_template"),Lib=_dereq_("../lib"),Color=_dereq_("../components/color"),BADNUM=_dereq_("../constants/numerical").BADNUM,axisIDs=_dereq_("../plots/cartesian/axis_ids"),sortBasePlotModules=_dereq_("./sort_modules").sortBasePlotModules,animationAttrs=_dereq_("./animation_attributes"),frameAttrs=_dereq_("./frame_attributes"),relinkPrivateKeys=Lib.relinkPrivateKeys,_=Lib._,plots=module.exports={};Lib.extendFlat(plots,Registry),plots.attributes=_dereq_("./attributes"),plots.attributes.type.values=plots.allTypes,plots.fontAttrs=_dereq_("./font_attributes"),plots.layoutAttributes=_dereq_("./layout_attributes"),plots.fontWeight="normal";var transformsRegistry=plots.transformsRegistry,commandModule=_dereq_("./command");plots.executeAPICommand=commandModule.executeAPICommand,plots.computeAPICommandBindings=commandModule.computeAPICommandBindings,plots.manageCommandObserver=commandModule.manageCommandObserver,plots.hasSimpleAPICommandBindings=commandModule.hasSimpleAPICommandBindings,plots.redrawText=function(gd){if(!((gd=Lib.getGraphDiv(gd)).data&&gd.data[0]&&gd.data[0].r))return new Promise(function(resolve){setTimeout(function(){Registry.getComponentMethod("annotations","draw")(gd),Registry.getComponentMethod("legend","draw")(gd),(gd.calcdata||[]).forEach(function(d){d[0]&&d[0].t&&d[0].t.cb&&d[0].t.cb()}),resolve(plots.previousPromises(gd))},300)})},plots.resize=function(gd){return gd=Lib.getGraphDiv(gd),new Promise(function(resolve,reject){function isHidden(gd){var display=window.getComputedStyle(gd).display;return!display||"none"===display}gd&&!isHidden(gd)||reject(new Error("Resize must be passed a displayed plot div element.")),gd._redrawTimer&&clearTimeout(gd._redrawTimer),gd._redrawTimer=setTimeout(function(){if(!gd.layout||gd.layout.width&&gd.layout.height||isHidden(gd))resolve(gd);else{delete gd.layout.width,delete gd.layout.height;var oldchanged=gd.changed;gd.autoplay=!0,Registry.call("relayout",gd,{autosize:!0}).then(function(){gd.changed=oldchanged,resolve(gd)})}},100)})},plots.previousPromises=function(gd){if((gd._promises||[]).length)return Promise.all(gd._promises).then(function(){gd._promises=[]})},plots.addLinks=function(gd){if(gd._context.showLink||gd._context.showSources){var fullLayout=gd._fullLayout,linkContainer=Lib.ensureSingle(fullLayout._paper,"text","js-plot-link-container",function(s){s.style({"font-family":'"Open Sans", Arial, sans-serif',"font-size":"12px",fill:Color.defaultLine,"pointer-events":"all"}).each(function(){var links=d3.select(this);links.append("tspan").classed("js-link-to-tool",!0),links.append("tspan").classed("js-link-spacer",!0),links.append("tspan").classed("js-sourcelinks",!0)})}),text=linkContainer.node(),attrs={y:fullLayout._paper.attr("height")-9};document.body.contains(text)&&text.getComputedTextLength()>=fullLayout.width-20?(attrs["text-anchor"]="start",attrs.x=5):(attrs["text-anchor"]="end",attrs.x=fullLayout._paper.attr("width")-7),linkContainer.attr(attrs);var toolspan=linkContainer.select(".js-link-to-tool"),spacespan=linkContainer.select(".js-link-spacer"),sourcespan=linkContainer.select(".js-sourcelinks");gd._context.showSources&&gd._context.showSources(gd),gd._context.showLink&&function positionPlayWithData(gd,container){container.text("");var link=container.append("a").attr({"xlink:xlink:href":"#",class:"link--impt link--embedview","font-weight":"bold"}).text(gd._context.linkText+" "+String.fromCharCode(187));if(gd._context.sendData)link.on("click",function(){plots.sendDataToCloud(gd)});else{var path=window.location.pathname.split("/"),query=window.location.search;link.attr({"xlink:xlink:show":"new","xlink:xlink:href":"/"+path[2].split(".")[0]+"/"+path[1]+query})}}(gd,toolspan),spacespan.text(toolspan.text()&&sourcespan.text()?" - ":"")}},plots.sendDataToCloud=function(gd){gd.emit("plotly_beforeexport");var baseUrl=(window.PLOTLYENV||{}).BASE_URL||gd._context.plotlyServerURL,hiddenformDiv=d3.select(gd).append("div").attr("id","hiddenform").style("display","none"),hiddenform=hiddenformDiv.append("form").attr({action:baseUrl+"/external",method:"post",target:"_blank"});return hiddenform.append("input").attr({type:"text",name:"data"}).node().value=plots.graphJson(gd,!1,"keepdata"),hiddenform.node().submit(),hiddenformDiv.remove(),gd.emit("plotly_afterexport"),!1};var collectableSubplotTypes,d3FormatKeys=["days","shortDays","months","shortMonths","periods","dateTime","date","time","decimal","thousands","grouping","currency"],extraFormatKeys=["year","month","dayMonth","dayMonthYear"];function getFormatObj(gd,formatKeys){var locale=gd._context.locale,formatDone=!1,formatObj={};function includeFormat(newFormat){for(var formatFinished=!0,i=0;i<formatKeys.length;i++){var formatKey=formatKeys[i];formatObj[formatKey]||(newFormat[formatKey]?formatObj[formatKey]=newFormat[formatKey]:formatFinished=!1)}formatFinished&&(formatDone=!0)}for(var i=0;i<2;i++){for(var locales=gd._context.locales,j=0;j<2;j++){var formatj=(locales[locale]||{}).format;if(formatj&&(includeFormat(formatj),formatDone))break;locales=Registry.localeRegistry}var baseLocale=locale.split("-")[0];if(formatDone||baseLocale===locale)break;locale=baseLocale}return formatDone||includeFormat(Registry.localeRegistry.en.format),formatObj}function hasMakesDataTransform(trace){var transforms=trace.transforms;if(Array.isArray(transforms)&&transforms.length)for(var i=0;i<transforms.length;i++){var ti=transforms[i],_module=ti._module||transformsRegistry[ti.type];if(_module&&_module.makesData)return!0}return!1}function applyTransforms(fullTrace,fullData,layout,fullLayout){for(var container=fullTrace.transforms,dataOut=[fullTrace],i=0;i<container.length;i++){var transform=container[i],_module=transformsRegistry[transform.type];_module&&_module.transform&&(dataOut=_module.transform(dataOut,{transform:transform,fullTrace:fullTrace,fullData:fullData,layout:layout,fullLayout:fullLayout,transformIndex:i}))}return dataOut}function setupAutoMargin(fullLayout){fullLayout._pushmargin||(fullLayout._pushmargin={}),fullLayout._pushmarginIds||(fullLayout._pushmarginIds={})}function clearAxesCalc(axList){for(var i=0;i<axList.length;i++)axList[i].clearCalc()}plots.supplyDefaults=function(gd,opts){var skipUpdateCalc=opts&&opts.skipUpdateCalc,oldFullLayout=gd._fullLayout||{};if(oldFullLayout._skipDefaults)delete oldFullLayout._skipDefaults;else{var i,newFullLayout=gd._fullLayout={},newLayout=gd.layout||{},oldFullData=gd._fullData||[],newFullData=gd._fullData=[],newData=gd.data||[],oldCalcdata=gd.calcdata||[],context=gd._context||{};gd._transitionData||plots.createTransitionData(gd),newFullLayout._dfltTitle={plot:_(gd,"Click to enter Plot title"),x:_(gd,"Click to enter X axis title"),y:_(gd,"Click to enter Y axis title"),colorbar:_(gd,"Click to enter Colorscale title"),annotation:_(gd,"new text")},newFullLayout._traceWord=_(gd,"trace");var formatObj=getFormatObj(gd,d3FormatKeys);if(newFullLayout._mapboxAccessToken=context.mapboxAccessToken,oldFullLayout._initialAutoSizeIsDone){var oldWidth=oldFullLayout.width,oldHeight=oldFullLayout.height;plots.supplyLayoutGlobalDefaults(newLayout,newFullLayout,formatObj),newLayout.width||(newFullLayout.width=oldWidth),newLayout.height||(newFullLayout.height=oldHeight),plots.sanitizeMargins(newFullLayout)}else{plots.supplyLayoutGlobalDefaults(newLayout,newFullLayout,formatObj);var missingWidthOrHeight=!newLayout.width||!newLayout.height,autosize=newFullLayout.autosize,autosizable=context.autosizable;missingWidthOrHeight&&(autosize||autosizable)?plots.plotAutoSize(gd,newLayout,newFullLayout):missingWidthOrHeight&&plots.sanitizeMargins(newFullLayout),!autosize&&missingWidthOrHeight&&(newLayout.width=newFullLayout.width,newLayout.height=newFullLayout.height)}newFullLayout._d3locale=function getFormatter(formatObj,separators){return formatObj.decimal=separators.charAt(0),formatObj.thousands=separators.charAt(1),d3.locale(formatObj)}(formatObj,newFullLayout.separators),newFullLayout._extraFormat=getFormatObj(gd,extraFormatKeys),newFullLayout._initialAutoSizeIsDone=!0,newFullLayout._dataLength=newData.length,newFullLayout._modules=[],newFullLayout._visibleModules=[],newFullLayout._basePlotModules=[];var subplots=newFullLayout._subplots=function emptySubplotLists(){var i,j,out={};if(!collectableSubplotTypes){collectableSubplotTypes=[];var subplotsRegistry=Registry.subplotsRegistry;for(var subplotType in subplotsRegistry){var subplotModule=subplotsRegistry[subplotType],subplotAttr=subplotModule.attr;if(subplotAttr&&(collectableSubplotTypes.push(subplotType),Array.isArray(subplotAttr)))for(j=0;j<subplotAttr.length;j++)Lib.pushUnique(collectableSubplotTypes,subplotAttr[j])}}for(i=0;i<collectableSubplotTypes.length;i++)out[collectableSubplotTypes[i]]=[];return out}(),splomAxes=newFullLayout._splomAxes={x:{},y:{}},splomSubplots=newFullLayout._splomSubplots={};newFullLayout._splomGridDflt={},newFullLayout._scatterStackOpts={},newFullLayout._firstScatter={},newFullLayout._requestRangeslider={},newFullLayout._traceUids=function getTraceUids(oldFullData,newData){var i,prevFullInput,len=newData.length,oldFullInput=[];for(i=0;i<oldFullData.length;i++){var thisFullInput=oldFullData[i]._fullInput;thisFullInput!==prevFullInput&&oldFullInput.push(thisFullInput),prevFullInput=thisFullInput}var oldLen=oldFullInput.length,out=new Array(len),seenUids={};function setUid(uid,i){out[i]=uid,seenUids[uid]=1}function tryUid(uid,i){if(uid&&"string"==typeof uid&&!seenUids[uid])return setUid(uid,i),!0}for(i=0;i<len;i++)tryUid(newData[i].uid,i)||i<oldLen&&tryUid(oldFullInput[i].uid,i)||setUid(Lib.randstr(seenUids),i);return out}(oldFullData,newData),newFullLayout._globalTransforms=(gd._context||{}).globalTransforms,plots.supplyDataDefaults(newData,newFullData,newLayout,newFullLayout);var splomXa=Object.keys(splomAxes.x),splomYa=Object.keys(splomAxes.y);if(splomXa.length>1&&splomYa.length>1){for(Registry.getComponentMethod("grid","sizeDefaults")(newLayout,newFullLayout),i=0;i<splomXa.length;i++)Lib.pushUnique(subplots.xaxis,splomXa[i]);for(i=0;i<splomYa.length;i++)Lib.pushUnique(subplots.yaxis,splomYa[i]);for(var k in splomSubplots)Lib.pushUnique(subplots.cartesian,k)}newFullLayout._has=plots._hasPlotType.bind(newFullLayout);var _modules=newFullLayout._visibleModules;for(i=0;i<_modules.length;i++){var _module=_modules[i];_module.cleanData&&_module.cleanData(newFullData)}if(oldFullData.length===newFullData.length)for(i=0;i<newFullData.length;i++)relinkPrivateKeys(newFullData[i],oldFullData[i]);plots.supplyLayoutModuleDefaults(newLayout,newFullLayout,newFullData,gd._transitionData),newFullLayout._hasOnlyLargeSploms=1===newFullLayout._basePlotModules.length&&"splom"===newFullLayout._basePlotModules[0].name&&splomXa.length>15&&splomYa.length>15&&0===newFullLayout.shapes.length&&0===newFullLayout.images.length,newFullLayout._hasCartesian=newFullLayout._has("cartesian"),newFullLayout._hasGeo=newFullLayout._has("geo"),newFullLayout._hasGL3D=newFullLayout._has("gl3d"),newFullLayout._hasGL2D=newFullLayout._has("gl2d"),newFullLayout._hasTernary=newFullLayout._has("ternary"),newFullLayout._hasPie=newFullLayout._has("pie"),plots.linkSubplots(newFullData,newFullLayout,oldFullData,oldFullLayout),plots.cleanPlot(newFullData,newFullLayout,oldFullData,oldFullLayout,oldCalcdata),relinkPrivateKeys(newFullLayout,oldFullLayout),plots.doAutoMargin(gd);var axList=axisIDs.list(gd);for(i=0;i<axList.length;i++){axList[i].setScale()}skipUpdateCalc||oldCalcdata.length!==newFullData.length||plots.supplyDefaultsUpdateCalc(oldCalcdata,newFullData),newFullLayout._basePlotModules.sort(sortBasePlotModules)}},plots.supplyDefaultsUpdateCalc=function(oldCalcdata,newFullData){for(var i=0;i<newFullData.length;i++){var newTrace=newFullData[i],cd0=oldCalcdata[i][0];if(cd0&&cd0.trace){var oldTrace=cd0.trace;if(oldTrace._hasCalcTransform){var j,astr,oldArrayVal,arrayAttrs=oldTrace._arrayAttrs;for(j=0;j<arrayAttrs.length;j++)astr=arrayAttrs[j],oldArrayVal=Lib.nestedProperty(oldTrace,astr).get().slice(),Lib.nestedProperty(newTrace,astr).set(oldArrayVal)}cd0.trace=newTrace}}},plots.createTransitionData=function(gd){gd._transitionData||(gd._transitionData={}),gd._transitionData._frames||(gd._transitionData._frames=[]),gd._transitionData._frameHash||(gd._transitionData._frameHash={}),gd._transitionData._counter||(gd._transitionData._counter=0),gd._transitionData._interruptCallbacks||(gd._transitionData._interruptCallbacks=[])},plots._hasPlotType=function(category){var i,basePlotModules=this._basePlotModules||[];for(i=0;i<basePlotModules.length;i++)if(basePlotModules[i].name===category)return!0;var modules=this._modules||[];for(i=0;i<modules.length;i++){var name=modules[i].name;if(name===category)return!0;var _module=Registry.modules[name];if(_module&&_module.categories[category])return!0}return!1},plots.cleanPlot=function(newFullData,newFullLayout,oldFullData,oldFullLayout,oldCalcdata){var i,j,basePlotModules=oldFullLayout._basePlotModules||[];for(i=0;i<basePlotModules.length;i++){var _module=basePlotModules[i];_module.clean&&_module.clean(newFullData,newFullLayout,oldFullData,oldFullLayout,oldCalcdata)}var hadGl=oldFullLayout._has&&oldFullLayout._has("gl"),hasGl=newFullLayout._has&&newFullLayout._has("gl");hadGl&&!hasGl&&void 0!==oldFullLayout._glcontainer&&(oldFullLayout._glcontainer.selectAll(".gl-canvas").remove(),oldFullLayout._glcontainer.selectAll(".no-webgl").remove(),oldFullLayout._glcanvas=null);var hasInfoLayer=!!oldFullLayout._infolayer;oldLoop:for(i=0;i<oldFullData.length;i++){var oldUid=oldFullData[i].uid;for(j=0;j<newFullData.length;j++){if(oldUid===newFullData[j].uid)continue oldLoop}hasInfoLayer&&oldFullLayout._infolayer.select(".cb"+oldUid).remove()}oldFullLayout._zoomlayer&&oldFullLayout._zoomlayer.selectAll(".select-outline").remove()},plots.linkSubplots=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var i,j,oldSubplots=oldFullLayout._plots||{},newSubplots=newFullLayout._plots={},newSubplotList=newFullLayout._subplots,mockGd={_fullData:newFullData,_fullLayout:newFullLayout},ids=newSubplotList.cartesian.concat(newSubplotList.gl2d||[]);for(i=0;i<ids.length;i++){var plotinfo,id=ids[i],oldSubplot=oldSubplots[id],xaxis=axisIDs.getFromId(mockGd,id,"x"),yaxis=axisIDs.getFromId(mockGd,id,"y");for(oldSubplot?plotinfo=newSubplots[id]=oldSubplot:(plotinfo=newSubplots[id]={}).id=id,plotinfo.xaxis=xaxis,plotinfo.yaxis=yaxis,plotinfo._hasClipOnAxisFalse=!1,j=0;j<newFullData.length;j++){var trace=newFullData[j];if(trace.xaxis===plotinfo.xaxis._id&&trace.yaxis===plotinfo.yaxis._id&&!1===trace.cliponaxis){plotinfo._hasClipOnAxisFalse=!0;break}}}var axList=axisIDs.list(mockGd,null,!0);for(i=0;i<axList.length;i++){var ax=axList[i],mainAx=null;ax.overlaying&&(mainAx=axisIDs.getFromId(mockGd,ax.overlaying))&&mainAx.overlaying&&(ax.overlaying=!1,mainAx=null),ax._mainAxis=mainAx||ax,mainAx&&(ax.domain=mainAx.domain.slice()),ax._anchorAxis="free"===ax.anchor?null:axisIDs.getFromId(mockGd,ax.anchor)}},plots.clearExpandedTraceDefaultColors=function(trace){var colorAttrs,path,i;for(path=[],(colorAttrs=trace._module._colorAttrs)||(trace._module._colorAttrs=colorAttrs=[],PlotSchema.crawl(trace._module.attributes,function locateColorAttrs(attr,attrName,attrs,level){path[level]=attrName,path.length=level+1,"color"===attr.valType&&void 0===attr.dflt&&colorAttrs.push(path.join("."))})),i=0;i<colorAttrs.length;i++){Lib.nestedProperty(trace,"_input."+colorAttrs[i]).get()||Lib.nestedProperty(trace,colorAttrs[i]).set(null)}},plots.supplyDataDefaults=function(dataIn,dataOut,layout,fullLayout){var i,fullTrace,trace,modules=fullLayout._modules,visibleModules=fullLayout._visibleModules,basePlotModules=fullLayout._basePlotModules,cnt=0,colorCnt=0;function pushModule(fullTrace){dataOut.push(fullTrace);var _module=fullTrace._module;_module&&(Lib.pushUnique(modules,_module),!0===fullTrace.visible&&Lib.pushUnique(visibleModules,_module),Lib.pushUnique(basePlotModules,fullTrace._module.basePlotModule),cnt++,!1!==fullTrace._input.visible&&colorCnt++)}fullLayout._transformModules=[];var carpetIndex={},carpetDependents=[],dataTemplate=(layout.template||{}).data||{},templater=Template.traceTemplater(dataTemplate);for(i=0;i<dataIn.length;i++){if(trace=dataIn[i],(fullTrace=templater.newTrace(trace)).uid=fullLayout._traceUids[i],plots.supplyTraceDefaults(trace,fullTrace,colorCnt,fullLayout,i),fullTrace.index=i,fullTrace._input=trace,fullTrace._expandedIndex=cnt,fullTrace.transforms&&fullTrace.transforms.length)for(var expandedTraces=applyTransforms(fullTrace,dataOut,layout,fullLayout),j=0;j<expandedTraces.length;j++){var expandedTrace=expandedTraces[j],fullExpandedTrace={_template:fullTrace._template,type:fullTrace.type,uid:fullTrace.uid+j};plots.supplyTraceDefaults(expandedTrace,fullExpandedTrace,cnt,fullLayout,i),relinkPrivateKeys(fullExpandedTrace,expandedTrace),fullExpandedTrace.index=i,fullExpandedTrace._input=trace,fullExpandedTrace._fullInput=fullTrace,fullExpandedTrace._expandedIndex=cnt,fullExpandedTrace._expandedInput=expandedTrace,pushModule(fullExpandedTrace)}else fullTrace._fullInput=fullTrace,fullTrace._expandedInput=fullTrace,pushModule(fullTrace);Registry.traceIs(fullTrace,"carpetAxis")&&(carpetIndex[fullTrace.carpet]=fullTrace),Registry.traceIs(fullTrace,"carpetDependent")&&carpetDependents.push(i)}for(i=0;i<carpetDependents.length;i++)if((fullTrace=dataOut[carpetDependents[i]]).visible){var carpetAxis=carpetIndex[fullTrace.carpet];fullTrace._carpet=carpetAxis,carpetAxis&&carpetAxis.visible?(fullTrace.xaxis=carpetAxis.xaxis,fullTrace.yaxis=carpetAxis.yaxis):fullTrace.visible=!1}},plots.supplyAnimationDefaults=function(opts){var i;opts=opts||{};var optsOut={};function coerce(attr,dflt){return Lib.coerce(opts||{},optsOut,animationAttrs,attr,dflt)}if(coerce("mode"),coerce("direction"),coerce("fromcurrent"),Array.isArray(opts.frame))for(optsOut.frame=[],i=0;i<opts.frame.length;i++)optsOut.frame[i]=plots.supplyAnimationFrameDefaults(opts.frame[i]||{});else optsOut.frame=plots.supplyAnimationFrameDefaults(opts.frame||{});if(Array.isArray(opts.transition))for(optsOut.transition=[],i=0;i<opts.transition.length;i++)optsOut.transition[i]=plots.supplyAnimationTransitionDefaults(opts.transition[i]||{});else optsOut.transition=plots.supplyAnimationTransitionDefaults(opts.transition||{});return optsOut},plots.supplyAnimationFrameDefaults=function(opts){var optsOut={};function coerce(attr,dflt){return Lib.coerce(opts||{},optsOut,animationAttrs.frame,attr,dflt)}return coerce("duration"),coerce("redraw"),optsOut},plots.supplyAnimationTransitionDefaults=function(opts){var optsOut={};function coerce(attr,dflt){return Lib.coerce(opts||{},optsOut,animationAttrs.transition,attr,dflt)}return coerce("duration"),coerce("easing"),optsOut},plots.supplyFrameDefaults=function(frameIn){var frameOut={};function coerce(attr,dflt){return Lib.coerce(frameIn,frameOut,frameAttrs,attr,dflt)}return coerce("group"),coerce("name"),coerce("traces"),coerce("baseframe"),coerce("data"),coerce("layout"),frameOut},plots.supplyTraceDefaults=function(traceIn,traceOut,colorIndex,layout,traceInIndex){var i,colorway=layout.colorway||Color.defaults,defaultColor=colorway[colorIndex%colorway.length];function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,plots.attributes,attr,dflt)}var visible=coerce("visible");coerce("type"),coerce("name",layout._traceWord+" "+traceInIndex);var _module=plots.getModule(traceOut);if(traceOut._module=_module,_module){var basePlotModule=_module.basePlotModule,subplotAttr=basePlotModule.attr,subplotAttrs=basePlotModule.attributes;if(subplotAttr&&subplotAttrs){var subplots=layout._subplots,subplotId="";if("gl2d"!==basePlotModule.name||visible){if(Array.isArray(subplotAttr))for(i=0;i<subplotAttr.length;i++){var attri=subplotAttr[i],vali=Lib.coerce(traceIn,traceOut,subplotAttrs,attri);subplots[attri]&&Lib.pushUnique(subplots[attri],vali),subplotId+=vali}else subplotId=Lib.coerce(traceIn,traceOut,subplotAttrs,subplotAttr);subplots[basePlotModule.name]&&Lib.pushUnique(subplots[basePlotModule.name],subplotId)}}}return visible&&(coerce("customdata"),coerce("ids"),Registry.traceIs(traceOut,"showLegend")?(traceOut._dfltShowLegend=!0,coerce("showlegend"),coerce("legendgroup")):traceOut._dfltShowLegend=!1,Registry.getComponentMethod("fx","supplyDefaults")(traceIn,traceOut,defaultColor,layout),_module&&(_module.supplyDefaults(traceIn,traceOut,defaultColor,layout),Lib.coerceHoverinfo(traceIn,traceOut,layout)),Registry.traceIs(traceOut,"noOpacity")||coerce("opacity"),Registry.traceIs(traceOut,"notLegendIsolatable")&&(traceOut.visible=!!traceOut.visible),_module&&_module.selectPoints&&coerce("selectedpoints"),plots.supplyTransformDefaults(traceIn,traceOut,layout)),traceOut},plots.hasMakesDataTransform=hasMakesDataTransform,plots.supplyTransformDefaults=function(traceIn,traceOut,layout){if(traceOut._length||hasMakesDataTransform(traceIn)){var globalTransforms=layout._globalTransforms||[],transformModules=layout._transformModules||[];if(Array.isArray(traceIn.transforms)||0!==globalTransforms.length)for(var containerIn=traceIn.transforms||[],transformList=globalTransforms.concat(containerIn),containerOut=traceOut.transforms=[],i=0;i<transformList.length;i++){var transformOut,transformIn=transformList[i],type=transformIn.type,_module=transformsRegistry[type],isFirstStage=!(transformIn._module&&transformIn._module===_module),doLaterStages=_module&&"function"==typeof _module.transform;_module||Lib.warn("Unrecognized transform type "+type+"."),_module&&_module.supplyDefaults&&(isFirstStage||doLaterStages)?((transformOut=_module.supplyDefaults(transformIn,traceOut,layout,traceIn)).type=type,transformOut._module=_module,Lib.pushUnique(transformModules,_module)):transformOut=Lib.extendFlat({},transformIn),containerOut.push(transformOut)}}},plots.supplyLayoutGlobalDefaults=function(layoutIn,layoutOut,formatObj){function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,plots.layoutAttributes,attr,dflt)}var template=layoutIn.template;Lib.isPlainObject(template)&&(layoutOut.template=template,layoutOut._template=template.layout,layoutOut._dataTemplate=template.data);var globalFont=Lib.coerceFont(coerce,"font");coerce("title",layoutOut._dfltTitle.plot),Lib.coerceFont(coerce,"titlefont",{family:globalFont.family,size:Math.round(1.4*globalFont.size),color:globalFont.color}),coerce("autosize",!(layoutIn.width&&layoutIn.height)),coerce("width"),coerce("height"),coerce("margin.l"),coerce("margin.r"),coerce("margin.t"),coerce("margin.b"),coerce("margin.pad"),coerce("margin.autoexpand"),layoutIn.width&&layoutIn.height&&plots.sanitizeMargins(layoutOut),Registry.getComponentMethod("grid","sizeDefaults")(layoutIn,layoutOut),coerce("paper_bgcolor"),coerce("separators",formatObj.decimal+formatObj.thousands),coerce("hidesources"),coerce("colorway"),coerce("datarevision"),Registry.getComponentMethod("calendars","handleDefaults")(layoutIn,layoutOut,"calendar"),Registry.getComponentMethod("fx","supplyLayoutGlobalDefaults")(layoutIn,layoutOut,coerce)},plots.plotAutoSize=function plotAutoSize(gd,layout,fullLayout){var newWidth,newHeight,context=gd._context||{},frameMargins=context.frameMargins,isPlotDiv=Lib.isPlotDiv(gd);if(isPlotDiv&&gd.emit("plotly_autosize"),context.fillFrame)newWidth=window.innerWidth,newHeight=window.innerHeight,document.body.style.overflow="hidden";else if(isNumeric(frameMargins)&&frameMargins>0){var reservedMargins=function calculateReservedMargins(margins){var marginName,resultingMargin={left:0,right:0,bottom:0,top:0};if(margins)for(marginName in margins)margins.hasOwnProperty(marginName)&&(resultingMargin.left+=margins[marginName].left||0,resultingMargin.right+=margins[marginName].right||0,resultingMargin.bottom+=margins[marginName].bottom||0,resultingMargin.top+=margins[marginName].top||0);return resultingMargin}(gd._boundingBoxMargins),reservedWidth=reservedMargins.left+reservedMargins.right,reservedHeight=reservedMargins.bottom+reservedMargins.top,factor=1-2*frameMargins,gdBB=fullLayout._container&&fullLayout._container.node?fullLayout._container.node().getBoundingClientRect():{width:fullLayout.width,height:fullLayout.height};newWidth=Math.round(factor*(gdBB.width-reservedWidth)),newHeight=Math.round(factor*(gdBB.height-reservedHeight))}else{var computedStyle=isPlotDiv?window.getComputedStyle(gd):{};newWidth=parseFloat(computedStyle.width)||parseFloat(computedStyle.maxWidth)||fullLayout.width,newHeight=parseFloat(computedStyle.height)||parseFloat(computedStyle.maxHeight)||fullLayout.height}var minWidth=plots.layoutAttributes.width.min,minHeight=plots.layoutAttributes.height.min;newWidth<minWidth&&(newWidth=minWidth),newHeight<minHeight&&(newHeight=minHeight);var widthHasChanged=!layout.width&&Math.abs(fullLayout.width-newWidth)>1,heightHasChanged=!layout.height&&Math.abs(fullLayout.height-newHeight)>1;(heightHasChanged||widthHasChanged)&&(widthHasChanged&&(fullLayout.width=newWidth),heightHasChanged&&(fullLayout.height=newHeight)),gd._initialAutoSize||(gd._initialAutoSize={width:newWidth,height:newHeight}),plots.sanitizeMargins(fullLayout)},plots.supplyLayoutModuleDefaults=function(layoutIn,layoutOut,fullData,transitionData){var component,i,_module,componentsRegistry=Registry.componentsRegistry,basePlotModules=layoutOut._basePlotModules,Cartesian=Registry.subplotsRegistry.cartesian;for(component in componentsRegistry)(_module=componentsRegistry[component]).includeBasePlot&&_module.includeBasePlot(layoutIn,layoutOut);for(var subplotType in basePlotModules.length||basePlotModules.push(Cartesian),layoutOut._has("cartesian")&&(Registry.getComponentMethod("grid","contentDefaults")(layoutIn,layoutOut),Cartesian.finalizeSubplots(layoutIn,layoutOut)),layoutOut._subplots)layoutOut._subplots[subplotType].sort(Lib.subplotSort);for(i=0;i<basePlotModules.length;i++)(_module=basePlotModules[i]).supplyLayoutDefaults&&_module.supplyLayoutDefaults(layoutIn,layoutOut,fullData);var modules=layoutOut._visibleModules;for(i=0;i<modules.length;i++)(_module=modules[i]).supplyLayoutDefaults&&_module.supplyLayoutDefaults(layoutIn,layoutOut,fullData);var transformModules=layoutOut._transformModules;for(i=0;i<transformModules.length;i++)(_module=transformModules[i]).supplyLayoutDefaults&&_module.supplyLayoutDefaults(layoutIn,layoutOut,fullData,transitionData);for(component in componentsRegistry)(_module=componentsRegistry[component]).supplyLayoutDefaults&&_module.supplyLayoutDefaults(layoutIn,layoutOut,fullData)},plots.purge=function(gd){var fullLayout=gd._fullLayout||{};void 0!==fullLayout._glcontainer&&(fullLayout._glcontainer.selectAll(".gl-canvas").remove(),fullLayout._glcontainer.remove(),fullLayout._glcanvas=null),void 0!==fullLayout._geocontainer&&fullLayout._geocontainer.remove(),fullLayout._modeBar&&fullLayout._modeBar.destroy(),gd._transitionData&&(gd._transitionData._interruptCallbacks&&(gd._transitionData._interruptCallbacks.length=0),gd._transitionData._animationRaf&&window.cancelAnimationFrame(gd._transitionData._animationRaf)),Lib.clearThrottle(),Lib.clearResponsive(gd),delete gd.data,delete gd.layout,delete gd._fullData,delete gd._fullLayout,delete gd.calcdata,delete gd.framework,delete gd.empty,delete gd.fid,delete gd.undoqueue,delete gd.undonum,delete gd.autoplay,delete gd.changed,delete gd._promises,delete gd._redrawTimer,delete gd._hmlumcount,delete gd._hmpixcount,delete gd._transitionData,delete gd._transitioning,delete gd._initialAutoSize,delete gd._transitioningWithDuration,delete gd._dragging,delete gd._dragged,delete gd._hoverdata,delete gd._snapshotInProgress,delete gd._editing,delete gd._replotPending,delete gd._mouseDownTime,delete gd._legendMouseDownTime,gd.removeAllListeners&&gd.removeAllListeners()},plots.style=function(gd){var i,_modules=gd._fullLayout._visibleModules,styleModules=[];for(i=0;i<_modules.length;i++){var _module=_modules[i];_module.style&&Lib.pushUnique(styleModules,_module.style)}for(i=0;i<styleModules.length;i++)styleModules[i](gd)},plots.sanitizeMargins=function(fullLayout){if(fullLayout&&fullLayout.margin){var correction,width=fullLayout.width,height=fullLayout.height,margin=fullLayout.margin,plotWidth=width-(margin.l+margin.r),plotHeight=height-(margin.t+margin.b);plotWidth<0&&(correction=(width-1)/(margin.l+margin.r),margin.l=Math.floor(correction*margin.l),margin.r=Math.floor(correction*margin.r)),plotHeight<0&&(correction=(height-1)/(margin.t+margin.b),margin.t=Math.floor(correction*margin.t),margin.b=Math.floor(correction*margin.b))}},plots.clearAutoMarginIds=function(gd){gd._fullLayout._pushmarginIds={}},plots.allowAutoMargin=function(gd,id){gd._fullLayout._pushmarginIds[id]=1},plots.autoMargin=function(gd,id,o){var fullLayout=gd._fullLayout;setupAutoMargin(fullLayout);var pushMargin=fullLayout._pushmargin,pushMarginIds=fullLayout._pushmarginIds;if(!1!==fullLayout.margin.autoexpand){if(o){var pad=o.pad;if(void 0===pad){var margin=fullLayout.margin;pad=Math.min(12,margin.l,margin.r,margin.t,margin.b)}o.l+o.r>.5*fullLayout.width&&(o.l=o.r=0),o.b+o.t>.5*fullLayout.height&&(o.b=o.t=0);var xl=void 0!==o.xl?o.xl:o.x,xr=void 0!==o.xr?o.xr:o.x,yt=void 0!==o.yt?o.yt:o.y,yb=void 0!==o.yb?o.yb:o.y;pushMargin[id]={l:{val:xl,size:o.l+pad},r:{val:xr,size:o.r+pad},b:{val:yb,size:o.b+pad},t:{val:yt,size:o.t+pad}},pushMarginIds[id]=1}else delete pushMargin[id],delete pushMarginIds[id];fullLayout._replotting||plots.doAutoMargin(gd)}},plots.doAutoMargin=function(gd){var fullLayout=gd._fullLayout;fullLayout._size||(fullLayout._size={}),setupAutoMargin(fullLayout);var gs=fullLayout._size,oldmargins=JSON.stringify(gs),ml=Math.max(fullLayout.margin.l||0,0),mr=Math.max(fullLayout.margin.r||0,0),mt=Math.max(fullLayout.margin.t||0,0),mb=Math.max(fullLayout.margin.b||0,0),pushMargin=fullLayout._pushmargin,pushMarginIds=fullLayout._pushmarginIds;if(!1!==fullLayout.margin.autoexpand){for(var k in pushMargin)pushMarginIds[k]||delete pushMargin[k];for(var k1 in pushMargin.base={l:{val:0,size:ml},r:{val:1,size:mr},t:{val:1,size:mt},b:{val:0,size:mb}},pushMargin){var pushleft=pushMargin[k1].l||{},pushbottom=pushMargin[k1].b||{},fl=pushleft.val,pl=pushleft.size,fb=pushbottom.val,pb=pushbottom.size;for(var k2 in pushMargin){if(isNumeric(pl)&&pushMargin[k2].r){var fr=pushMargin[k2].r.val,pr=pushMargin[k2].r.size;if(fr>fl){var newl=(pl*fr+(pr-fullLayout.width)*fl)/(fr-fl),newr=(pr*(1-fl)+(pl-fullLayout.width)*(1-fr))/(fr-fl);newl>=0&&newr>=0&&newl+newr>ml+mr&&(ml=newl,mr=newr)}}if(isNumeric(pb)&&pushMargin[k2].t){var ft=pushMargin[k2].t.val,pt=pushMargin[k2].t.size;if(ft>fb){var newb=(pb*ft+(pt-fullLayout.height)*fb)/(ft-fb),newt=(pt*(1-fb)+(pb-fullLayout.height)*(1-ft))/(ft-fb);newb>=0&&newt>=0&&newb+newt>mb+mt&&(mb=newb,mt=newt)}}}}}if(gs.l=Math.round(ml),gs.r=Math.round(mr),gs.t=Math.round(mt),gs.b=Math.round(mb),gs.p=Math.round(fullLayout.margin.pad),gs.w=Math.round(fullLayout.width)-gs.l-gs.r,gs.h=Math.round(fullLayout.height)-gs.t-gs.b,!fullLayout._replotting&&"{}"!==oldmargins&&oldmargins!==JSON.stringify(fullLayout._size))return"_redrawFromAutoMarginCount"in fullLayout?fullLayout._redrawFromAutoMarginCount++:fullLayout._redrawFromAutoMarginCount=1,Registry.call("plot",gd)},plots.graphJson=function(gd,dataonly,mode,output,useDefaults){(useDefaults&&dataonly&&!gd._fullData||useDefaults&&!dataonly&&!gd._fullLayout)&&plots.supplyDefaults(gd);var data=useDefaults?gd._fullData:gd.data,layout=useDefaults?gd._fullLayout:gd.layout,frames=(gd._transitionData||{})._frames;function stripObj(d){if("function"==typeof d)return null;if(Lib.isPlainObject(d)){var v,src,o={};for(v in d)if("function"!=typeof d[v]&&-1===["_","["].indexOf(v.charAt(0))){if("keepdata"===mode){if("src"===v.substr(v.length-3))continue}else if("keepstream"===mode){if("string"==typeof(src=d[v+"src"])&&src.indexOf(":")>0&&!Lib.isPlainObject(d.stream))continue}else if("keepall"!==mode&&"string"==typeof(src=d[v+"src"])&&src.indexOf(":")>0)continue;o[v]=stripObj(d[v])}return o}return Array.isArray(d)?d.map(stripObj):Lib.isTypedArray(d)?Lib.simpleMap(d,Lib.identity):Lib.isJSDate(d)?Lib.ms2DateTimeLocal(+d):d}var obj={data:(data||[]).map(function(v){var d=stripObj(v);return dataonly&&delete d.fit,d})};return dataonly||(obj.layout=stripObj(layout)),gd.framework&&gd.framework.isPolar&&(obj=gd.framework.getConfig()),frames&&(obj.frames=stripObj(frames)),"object"===output?obj:JSON.stringify(obj)},plots.modifyFrames=function(gd,operations){var i,op,frame,_frames=gd._transitionData._frames,_frameHash=gd._transitionData._frameHash;for(i=0;i<operations.length;i++)switch((op=operations[i]).type){case"replace":frame=op.value;var oldName=(_frames[op.index]||{}).name,newName=frame.name;_frames[op.index]=_frameHash[newName]=frame,newName!==oldName&&(delete _frameHash[oldName],_frameHash[newName]=frame);break;case"insert":_frameHash[(frame=op.value).name]=frame,_frames.splice(op.index,0,frame);break;case"delete":delete _frameHash[(frame=_frames[op.index]).name],_frames.splice(op.index,1)}return Promise.resolve()},plots.computeFrame=function(gd,frameName){var i,traceIndices,traceIndex,destIndex,frameLookup=gd._transitionData._frameHash;if(!frameName)throw new Error("computeFrame must be given a string frame name");var framePtr=frameLookup[frameName.toString()];if(!framePtr)return!1;for(var frameStack=[framePtr],frameNameStack=[framePtr.name];framePtr.baseframe&&(framePtr=frameLookup[framePtr.baseframe.toString()])&&-1===frameNameStack.indexOf(framePtr.name);)frameStack.push(framePtr),frameNameStack.push(framePtr.name);for(var result={};framePtr=frameStack.pop();)if(framePtr.layout&&(result.layout=plots.extendLayout(result.layout,framePtr.layout)),framePtr.data){if(result.data||(result.data=[]),!(traceIndices=framePtr.traces))for(traceIndices=[],i=0;i<framePtr.data.length;i++)traceIndices[i]=i;for(result.traces||(result.traces=[]),i=0;i<framePtr.data.length;i++)void 0!==(traceIndex=traceIndices[i])&&null!==traceIndex&&(-1===(destIndex=result.traces.indexOf(traceIndex))&&(destIndex=result.data.length,result.traces[destIndex]=traceIndex),result.data[destIndex]=plots.extendTrace(result.data[destIndex],framePtr.data[i]))}return result},plots.recomputeFrameHash=function(gd){for(var hash=gd._transitionData._frameHash={},frames=gd._transitionData._frames,i=0;i<frames.length;i++){var frame=frames[i];frame&&frame.name&&(hash[frame.name]=frame)}},plots.extendObjectWithContainers=function(dest,src,containerPaths){var containerProp,containerVal,i,j,destProp,srcContainer,destContainer,copy=Lib.extendDeepNoArrays({},src||{}),expandedObj=Lib.expandObjectPaths(copy),containerObj={};if(containerPaths&&containerPaths.length)for(i=0;i<containerPaths.length;i++)void 0===(containerVal=(containerProp=Lib.nestedProperty(expandedObj,containerPaths[i])).get())?Lib.nestedProperty(containerObj,containerPaths[i]).set(null):(containerProp.set(null),Lib.nestedProperty(containerObj,containerPaths[i]).set(containerVal));if(dest=Lib.extendDeepNoArrays(dest||{},expandedObj),containerPaths&&containerPaths.length)for(i=0;i<containerPaths.length;i++)if(srcContainer=Lib.nestedProperty(containerObj,containerPaths[i]).get()){for(destContainer=(destProp=Lib.nestedProperty(dest,containerPaths[i])).get(),Array.isArray(destContainer)||(destContainer=[],destProp.set(destContainer)),j=0;j<srcContainer.length;j++){var srcObj=srcContainer[j];destContainer[j]=null===srcObj?null:plots.extendObjectWithContainers(destContainer[j],srcObj)}destProp.set(destContainer)}return dest},plots.dataArrayContainers=["transforms","dimensions"],plots.layoutArrayContainers=Registry.layoutArrayContainers,plots.extendTrace=function(destTrace,srcTrace){return plots.extendObjectWithContainers(destTrace,srcTrace,plots.dataArrayContainers)},plots.extendLayout=function(destLayout,srcLayout){return plots.extendObjectWithContainers(destLayout,srcLayout,plots.layoutArrayContainers)},plots.transition=function(gd,data,layout,traces,frameOpts,transitionOpts){var i,traceIdx,dataLength=Array.isArray(data)?data.length:0,traceIndices=traces.slice(0,dataLength),transitionedTraces=[];var aborted=!1;for(i=0;i<traceIndices.length;i++){traceIdx=traceIndices[i];gd._fullData[traceIdx]._module}var seq=[plots.previousPromises,function interruptPreviousTransitions(){if(gd._transitionData)return gd._transitioning=!1,function executeCallbacks(list){var p=Promise.resolve();if(!list)return p;for(;list.length;)p=p.then(list.shift());return p}(gd._transitionData._interruptCallbacks)},function prepareTransitions(){var i;for(i=0;i<traceIndices.length;i++){var traceIdx=traceIndices[i],module=gd._fullData[traceIdx]._module;module&&(module.animatable&&transitionedTraces.push(traceIdx),gd.data[traceIndices[i]]=plots.extendTrace(gd.data[traceIndices[i]],data[i]))}var layoutUpdate=Lib.expandObjectPaths(Lib.extendDeepNoArrays({},layout)),axisAttrRe=/^[xy]axis[0-9]*$/;for(var attr in layoutUpdate)axisAttrRe.test(attr)&&delete layoutUpdate[attr].range;return plots.extendLayout(gd.layout,layoutUpdate),delete gd.calcdata,plots.supplyDefaults(gd),plots.doCalcdata(gd),Promise.resolve()},plots.rehover,function executeTransitions(){return gd.emit("plotly_transitioning",[]),new Promise(function(resolve){gd._transitioning=!0,transitionOpts.duration>0&&(gd._transitioningWithDuration=!0),gd._transitionData._interruptCallbacks.push(function(){aborted=!0}),frameOpts.redraw&&gd._transitionData._interruptCallbacks.push(function(){return Registry.call("redraw",gd)}),gd._transitionData._interruptCallbacks.push(function(){gd.emit("plotly_transitioninterrupted",[])});var traceTransitionOpts,j,numCallbacks=0,numCompleted=0;function makeCallback(){return numCallbacks++,function(){aborted||++numCompleted!==numCallbacks||function completeTransition(callback){if(gd._transitionData)return function flushCallbacks(list){if(list)for(;list.length;)list.shift()}(gd._transitionData._interruptCallbacks),Promise.resolve().then(function(){if(frameOpts.redraw)return Registry.call("redraw",gd)}).then(function(){gd._transitioning=!1,gd._transitioningWithDuration=!1,gd.emit("plotly_transitioned",[])}).then(callback)}(resolve)}}var basePlotModules=gd._fullLayout._basePlotModules,hasAxisTransition=!1;if(layout)for(j=0;j<basePlotModules.length;j++)if(basePlotModules[j].transitionAxes){var newLayout=Lib.expandObjectPaths(layout);hasAxisTransition=basePlotModules[j].transitionAxes(gd,newLayout,transitionOpts,makeCallback)||hasAxisTransition}for(hasAxisTransition?((traceTransitionOpts=Lib.extendFlat({},transitionOpts)).duration=0,transitionedTraces=null):traceTransitionOpts=transitionOpts,j=0;j<basePlotModules.length;j++)basePlotModules[j].plot(gd,transitionedTraces,traceTransitionOpts,makeCallback);setTimeout(makeCallback())})}],transitionStarting=Lib.syncOrAsync(seq,gd);return transitionStarting&&transitionStarting.then||(transitionStarting=Promise.resolve()),transitionStarting.then(function(){return gd})},plots.doCalcdata=function(gd,traces){var trace,_module,i,j,axList=axisIDs.list(gd),fullData=gd._fullData,fullLayout=gd._fullLayout,calcdata=new Array(fullData.length),oldCalcdata=(gd.calcdata||[]).slice(0);for(gd.calcdata=calcdata,fullLayout._numBoxes=0,fullLayout._numViolins=0,fullLayout._violinScaleGroupStats={},gd._hmpixcount=0,gd._hmlumcount=0,fullLayout._piecolormap={},i=0;i<fullData.length;i++)Array.isArray(traces)&&-1===traces.indexOf(i)&&(calcdata[i]=oldCalcdata[i]);for(i=0;i<fullData.length;i++)(trace=fullData[i])._arrayAttrs=PlotSchema.findArrayAttributes(trace),trace._extremes={};var polarIds=fullLayout._subplots.polar||[];for(i=0;i<polarIds.length;i++)axList.push(fullLayout[polarIds[i]].radialaxis,fullLayout[polarIds[i]].angularaxis);clearAxesCalc(axList);var hasCalcTransform=!1;for(i=0;i<fullData.length;i++)if(!0===(trace=fullData[i]).visible&&trace.transforms){if((_module=trace._module)&&_module.calc){var cdi=_module.calc(gd,trace);cdi[0]&&cdi[0].t&&cdi[0].t._scene&&delete cdi[0].t._scene.dirty}for(j=0;j<trace.transforms.length;j++){var transform=trace.transforms[j];(_module=transformsRegistry[transform.type])&&_module.calcTransform&&(trace._hasCalcTransform=!0,hasCalcTransform=!0,_module.calcTransform(gd,trace,transform))}}function calci(i,isContainer){if(trace=fullData[i],!!(_module=trace._module).isContainer===isContainer){var cd=[];if(!0===trace.visible){delete trace._indexToPoints;var transforms=trace.transforms||[];for(j=transforms.length-1;j>=0;j--)if(transforms[j].enabled){trace._indexToPoints=transforms[j]._indexToPoints;break}_module&&_module.calc&&(cd=_module.calc(gd,trace))}Array.isArray(cd)&&cd[0]||(cd=[{x:BADNUM,y:BADNUM}]),cd[0].t||(cd[0].t={}),cd[0].trace=trace,calcdata[i]=cd}}for(hasCalcTransform&&clearAxesCalc(axList),i=0;i<fullData.length;i++)calci(i,!0);for(i=0;i<fullData.length;i++)calci(i,!1);!function doCrossTraceCalc(gd){var i,j,k,fullLayout=gd._fullLayout,modules=fullLayout._visibleModules,hash={};for(j=0;j<modules.length;j++){var _module=modules[j],fn=_module.crossTraceCalc;if(fn){var spType=_module.basePlotModule.name;hash[spType]?Lib.pushUnique(hash[spType],fn):hash[spType]=[fn]}}for(k in hash){var methods=hash[k],subplots=fullLayout._subplots[k];if(Array.isArray(subplots))for(i=0;i<subplots.length;i++){var sp=subplots[i],spInfo="cartesian"===k?fullLayout._plots[sp]:fullLayout[sp];for(j=0;j<methods.length;j++)methods[j](gd,spInfo,sp)}else for(j=0;j<methods.length;j++)methods[j](gd)}}(gd),Registry.getComponentMethod("fx","calc")(gd),Registry.getComponentMethod("errorbars","calc")(gd)},plots.rehover=function(gd){gd._fullLayout._rehover&&gd._fullLayout._rehover()},plots.generalUpdatePerTraceModule=function(gd,subplot,subplotCalcData,subplotLayout){var i,traceHashOld=subplot.traceHash,traceHash={};for(i=0;i<subplotCalcData.length;i++){var calcTraces=subplotCalcData[i],trace=calcTraces[0].trace;trace.visible&&(traceHash[trace.type]=traceHash[trace.type]||[],traceHash[trace.type].push(calcTraces))}for(var moduleNameOld in traceHashOld)if(!traceHash[moduleNameOld]){var fakeCalcTrace=traceHashOld[moduleNameOld][0];fakeCalcTrace[0].trace.visible=!1,traceHash[moduleNameOld]=[fakeCalcTrace]}for(var moduleName in traceHash){var moduleCalcData=traceHash[moduleName];moduleCalcData[0][0].trace._module.plot(gd,subplot,Lib.filterVisible(moduleCalcData),subplotLayout)}subplot.traceHash=traceHash}},{"../components/color":567,"../constants/numerical":670,"../lib":693,"../plot_api/plot_schema":731,"../plot_api/plot_template":732,"../plots/cartesian/axis_ids":745,"../registry":825,"./animation_attributes":737,"./attributes":739,"./command":766,"./font_attributes":768,"./frame_attributes":769,"./layout_attributes":796,"./sort_modules":819,d3:147,"fast-isnumeric":213}],806:[function(_dereq_,module,exports){"use strict";module.exports={attr:"subplot",name:"polar",axisNames:["angularaxis","radialaxis"],axisName2dataArray:{angularaxis:"theta",radialaxis:"r"},layerNames:["draglayer","plotbg","backplot","angular-grid","radial-grid","frontplot","angular-line","radial-line","angular-axis","radial-axis"],radialDragBoxSize:50,angularDragBoxSize:30,cornerLen:25,cornerHalfWidth:2,MINDRAG:8,MINZOOM:20,OFFEDGE:20}},{}],807:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),polygonTester=_dereq_("../../lib/polygon").tester,findIndexOfMin=Lib.findIndexOfMin,isAngleInsideSector=Lib.isAngleInsideSector,angleDelta=Lib.angleDelta,angleDist=Lib.angleDist;function findIntersectionXY(v0,v1,a,xpyp){var xstar,ystar,xp=xpyp[0],yp=xpyp[1],dsin=clampTiny(Math.sin(v1)-Math.sin(v0)),dcos=clampTiny(Math.cos(v1)-Math.cos(v0)),tanA=Math.tan(a),cotanA=clampTiny(1/tanA),m=dsin/dcos,b=yp-m*xp;return cotanA?dsin&&dcos?ystar=tanA*(xstar=b/(tanA-m)):dcos?(xstar=yp*cotanA,ystar=yp):(xstar=xp,ystar=xp*tanA):dsin&&dcos?(xstar=0,ystar=b):dcos?(xstar=0,ystar=yp):xstar=ystar=NaN,[xstar,ystar]}function makePolygon(r,a0,a1,vangles){return Lib.isFullCircle([a0,a1])?function makeRegularPolygon(r,vangles){var i,len=vangles.length,vertices=new Array(len+1);for(i=0;i<len;i++){var va=vangles[i];vertices[i]=[r*Math.cos(va),r*Math.sin(va)]}return vertices[i]=vertices[0].slice(),vertices}(r,vangles):function makeClippedPolygon(r,a0,a1,vangles){var i,j,len=vangles.length,vertices=[];function a2xy(a){return[r*Math.cos(a),r*Math.sin(a)]}function findXY(va0,va1,s){return findIntersectionXY(va0,va1,s,a2xy(va0))}function cycleIndex(ind){return Lib.mod(ind,len)}function isInside(v){return isAngleInsideSector(v,[a0,a1])}var i0=findIndexOfMin(vangles,function(v){return isInside(v)?angleDist(v,a0):1/0}),xy0=findXY(vangles[i0],vangles[cycleIndex(i0-1)],a0);for(vertices.push(xy0),i=i0,j=0;j<len;i++,j++){var va=vangles[cycleIndex(i)];if(!isInside(va))break;vertices.push(a2xy(va))}var iN=findIndexOfMin(vangles,function(v){return isInside(v)?angleDist(v,a1):1/0}),xyN=findXY(vangles[iN],vangles[cycleIndex(iN+1)],a1);return vertices.push(xyN),vertices.push([0,0]),vertices.push(vertices[0].slice()),vertices}(r,a0,a1,vangles)}function clampTiny(v){return Math.abs(v)>1e-10?v:0}function transformForSVG(pts0,cx,cy){cx=cx||0,cy=cy||0;for(var len=pts0.length,pts1=new Array(len),i=0;i<len;i++){var pt=pts0[i];pts1[i]=[cx+pt[0],cy-pt[1]]}return pts1}module.exports={isPtInsidePolygon:function isPtInsidePolygon(r,a,rBnds,aBnds,vangles){if(!isAngleInsideSector(a,aBnds))return!1;var r0,r1;rBnds[0]<rBnds[1]?(r0=rBnds[0],r1=rBnds[1]):(r0=rBnds[1],r1=rBnds[0]);var polygonIn=polygonTester(makePolygon(r0,aBnds[0],aBnds[1],vangles)),polygonOut=polygonTester(makePolygon(r1,aBnds[0],aBnds[1],vangles)),xy=[r*Math.cos(a),r*Math.sin(a)];return polygonOut.contains(xy)&&!polygonIn.contains(xy)},findPolygonOffset:function findPolygonOffset(r,a0,a1,vangles){for(var minX=1/0,minY=1/0,vertices=makePolygon(r,a0,a1,vangles),i=0;i<vertices.length;i++){var v=vertices[i];minX=Math.min(minX,v[0]),minY=Math.min(minY,-v[1])}return[minX,minY]},findEnclosingVertexAngles:function findEnclosingVertexAngles(a,vangles){var i0=findIndexOfMin(vangles,function(v){var adelta=angleDelta(v,a);return adelta>0?adelta:1/0}),i1=Lib.mod(i0+1,vangles.length);return[vangles[i0],vangles[i1]]},findIntersectionXY:findIntersectionXY,findXYatLength:function findXYatLength(l,m,xp,yp){var t=-m*xp,a=m*m+1,b=2*(m*t-xp),c=t*t+xp*xp-l*l,del=Math.sqrt(b*b-4*a*c),x0=(-b+del)/(2*a),x1=(-b-del)/(2*a);return[[x0,m*x0+t+yp],[x1,m*x1+t+yp]]},clampTiny:clampTiny,pathPolygon:function pathPolygon(r,a0,a1,vangles,cx,cy){return"M"+transformForSVG(makePolygon(r,a0,a1,vangles),cx,cy).join("L")},pathPolygonAnnulus:function pathPolygonAnnulus(r0,r1,a0,a1,vangles,cx,cy){var rStart,rEnd;r0<r1?(rStart=r0,rEnd=r1):(rStart=r1,rEnd=r0);var inner=transformForSVG(makePolygon(rStart,a0,a1,vangles),cx,cy);return"M"+transformForSVG(makePolygon(rEnd,a0,a1,vangles),cx,cy).reverse().join("L")+"M"+inner.join("L")}}},{"../../lib":693,"../../lib/polygon":706}],808:[function(_dereq_,module,exports){"use strict";var getSubplotCalcData=_dereq_("../get_data").getSubplotCalcData,counterRegex=_dereq_("../../lib").counterRegex,createPolar=_dereq_("./polar"),constants=_dereq_("./constants"),attr=constants.attr,name=constants.name,counter=counterRegex(name),attributes={};attributes[attr]={valType:"subplotid",dflt:name,editType:"calc"},module.exports={attr:attr,name:name,idRoot:name,idRegex:counter,attrRegex:counter,attributes:attributes,layoutAttributes:_dereq_("./layout_attributes"),supplyLayoutDefaults:_dereq_("./layout_defaults"),plot:function plot(gd){for(var fullLayout=gd._fullLayout,calcData=gd.calcdata,subplotIds=fullLayout._subplots[name],i=0;i<subplotIds.length;i++){var id=subplotIds[i],subplotCalcData=getSubplotCalcData(calcData,name,id),subplot=fullLayout[id]._subplot;subplot||(subplot=createPolar(gd,id),fullLayout[id]._subplot=subplot),subplot.plot(subplotCalcData,fullLayout,gd._promises)}},clean:function clean(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldIds=oldFullLayout._subplots[name]||[],i=0;i<oldIds.length;i++){var id=oldIds[i],oldSubplot=oldFullLayout[id]._subplot;if(!newFullLayout[id]&&oldSubplot)for(var k in oldSubplot.framework.remove(),oldSubplot.layers["radial-axis-title"].remove(),oldSubplot.clipPaths)oldSubplot.clipPaths[k].remove()}},toSVG:_dereq_("../cartesian").toSVG}},{"../../lib":693,"../cartesian":753,"../get_data":778,"./constants":806,"./layout_attributes":809,"./layout_defaults":810,"./polar":817}],809:[function(_dereq_,module,exports){"use strict";var colorAttrs=_dereq_("../../components/color/attributes"),axesAttrs=_dereq_("../cartesian/layout_attributes"),domainAttrs=_dereq_("../domain").attributes,extendFlat=_dereq_("../../lib").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,axisLineGridAttr=overrideAll({color:axesAttrs.color,showline:extendFlat({},axesAttrs.showline,{dflt:!0}),linecolor:axesAttrs.linecolor,linewidth:axesAttrs.linewidth,showgrid:extendFlat({},axesAttrs.showgrid,{dflt:!0}),gridcolor:axesAttrs.gridcolor,gridwidth:axesAttrs.gridwidth},"plot","from-root"),axisTickAttrs=overrideAll({tickmode:axesAttrs.tickmode,nticks:axesAttrs.nticks,tick0:axesAttrs.tick0,dtick:axesAttrs.dtick,tickvals:axesAttrs.tickvals,ticktext:axesAttrs.ticktext,ticks:axesAttrs.ticks,ticklen:axesAttrs.ticklen,tickwidth:axesAttrs.tickwidth,tickcolor:axesAttrs.tickcolor,showticklabels:axesAttrs.showticklabels,showtickprefix:axesAttrs.showtickprefix,tickprefix:axesAttrs.tickprefix,showticksuffix:axesAttrs.showticksuffix,ticksuffix:axesAttrs.ticksuffix,showexponent:axesAttrs.showexponent,exponentformat:axesAttrs.exponentformat,separatethousands:axesAttrs.separatethousands,tickfont:axesAttrs.tickfont,tickangle:axesAttrs.tickangle,tickformat:axesAttrs.tickformat,tickformatstops:axesAttrs.tickformatstops,layer:axesAttrs.layer},"plot","from-root"),radialAxisAttrs={visible:extendFlat({},axesAttrs.visible,{dflt:!0}),type:axesAttrs.type,autorange:axesAttrs.autorange,rangemode:{valType:"enumerated",values:["tozero","nonnegative","normal"],dflt:"tozero",editType:"calc"},range:axesAttrs.range,categoryorder:axesAttrs.categoryorder,categoryarray:axesAttrs.categoryarray,angle:{valType:"angle",editType:"plot"},side:{valType:"enumerated",values:["clockwise","counterclockwise"],dflt:"clockwise",editType:"plot"},title:extendFlat({},axesAttrs.title,{editType:"plot",dflt:""}),titlefont:overrideAll(axesAttrs.titlefont,"plot","from-root"),hoverformat:axesAttrs.hoverformat,editType:"calc"};extendFlat(radialAxisAttrs,axisLineGridAttr,axisTickAttrs);var angularAxisAttrs={visible:extendFlat({},axesAttrs.visible,{dflt:!0}),type:{valType:"enumerated",values:["-","linear","category"],dflt:"-",editType:"calc",_noTemplating:!0},categoryorder:axesAttrs.categoryorder,categoryarray:axesAttrs.categoryarray,thetaunit:{valType:"enumerated",values:["radians","degrees"],dflt:"degrees",editType:"calc"},period:{valType:"number",editType:"calc",min:0},direction:{valType:"enumerated",values:["counterclockwise","clockwise"],dflt:"counterclockwise",editType:"calc"},rotation:{valType:"angle",editType:"calc"},hoverformat:axesAttrs.hoverformat,editType:"calc"};extendFlat(angularAxisAttrs,axisLineGridAttr,axisTickAttrs),module.exports={domain:domainAttrs({name:"polar",editType:"plot"}),sector:{valType:"info_array",items:[{valType:"number",editType:"plot"},{valType:"number",editType:"plot"}],dflt:[0,360],editType:"plot"},hole:{valType:"number",min:0,max:1,dflt:0,editType:"plot"},bgcolor:{valType:"color",editType:"plot",dflt:colorAttrs.background},radialaxis:radialAxisAttrs,angularaxis:angularAxisAttrs,gridshape:{valType:"enumerated",values:["circular","linear"],dflt:"circular",editType:"plot"},editType:"calc"}},{"../../components/color/attributes":566,"../../lib":693,"../../plot_api/edit_types":725,"../cartesian/layout_attributes":754,"../domain":767}],810:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),handleSubplotDefaults=_dereq_("../subplot_defaults"),getSubplotData=_dereq_("../get_data").getSubplotData,handleTickValueDefaults=_dereq_("../cartesian/tick_value_defaults"),handleTickMarkDefaults=_dereq_("../cartesian/tick_mark_defaults"),handleTickLabelDefaults=_dereq_("../cartesian/tick_label_defaults"),handleCategoryOrderDefaults=_dereq_("../cartesian/category_order_defaults"),handleLineGridDefaults=_dereq_("../cartesian/line_grid_defaults"),autoType=_dereq_("../cartesian/axis_autotype"),layoutAttributes=_dereq_("./layout_attributes"),setConvert=_dereq_("./set_convert"),constants=_dereq_("./constants"),axisNames=constants.axisNames;function handleDefaults(contIn,contOut,coerce,opts){var bgColor=coerce("bgcolor");opts.bgColor=Color.combine(bgColor,opts.paper_bgcolor);var sector=coerce("sector");coerce("hole");var axName,subplotData=getSubplotData(opts.fullData,constants.name,opts.id),layoutOut=opts.layoutOut;function coerceAxis(attr,dflt){return coerce(axName+"."+attr,dflt)}for(var i=0;i<axisNames.length;i++){axName=axisNames[i],Lib.isPlainObject(contIn[axName])||(contIn[axName]={});var axIn=contIn[axName],axOut=contOut[axName]={};axOut._id=axOut._name=axName,axOut._traceIndices=subplotData.map(function(t){return t._expandedIndex});var dataAttr=constants.axisName2dataArray[axName],axType=handleAxisTypeDefaults(axIn,axOut,coerceAxis,subplotData,dataAttr);handleCategoryOrderDefaults(axIn,axOut,coerceAxis,{axData:subplotData,dataAttr:dataAttr});var dfltColor,dfltFontColor,visible=coerceAxis("visible");switch(setConvert(axOut,contOut,layoutOut),visible&&(dfltFontColor=(dfltColor=coerceAxis("color"))===axIn.color?dfltColor:opts.font.color),axOut._m=1,axName){case"radialaxis":var autoRange=coerceAxis("autorange",!axOut.isValidRange(axIn.range));axIn.autorange=autoRange,!autoRange||"linear"!==axType&&"-"!==axType||coerceAxis("rangemode"),"reversed"===autoRange&&(axOut._m=-1),coerceAxis("range"),axOut.cleanRange("range",{dfltRange:[0,1]}),visible&&(coerceAxis("side"),coerceAxis("angle",sector[0]),coerceAxis("title"),Lib.coerceFont(coerceAxis,"titlefont",{family:opts.font.family,size:Math.round(1.2*opts.font.size),color:dfltFontColor}));break;case"angularaxis":if("date"===axType){Lib.log("Polar plots do not support date angular axes yet.");for(var j=0;j<subplotData.length;j++)subplotData[j].visible=!1;axType=axIn.type=axOut.type="linear"}coerceAxis("linear"===axType?"thetaunit":"period"),coerceAxis("rotation",{counterclockwise:0,clockwise:90}[coerceAxis("direction")])}if(visible)handleTickValueDefaults(axIn,axOut,coerceAxis,axOut.type),handleTickLabelDefaults(axIn,axOut,coerceAxis,axOut.type,{tickSuffixDflt:"degrees"===axOut.thetaunit?"":void 0}),handleTickMarkDefaults(axIn,axOut,coerceAxis,{outerTicks:!0}),coerceAxis("showticklabels")&&(Lib.coerceFont(coerceAxis,"tickfont",{family:opts.font.family,size:opts.font.size,color:dfltFontColor}),coerceAxis("tickangle"),coerceAxis("tickformat")),handleLineGridDefaults(axIn,axOut,coerceAxis,{dfltColor:dfltColor,bgColor:opts.bgColor,blend:60,showLine:!0,showGrid:!0,noZeroLine:!0,attributes:layoutAttributes[axName]}),coerceAxis("layer");"category"!==axType&&coerceAxis("hoverformat"),axOut._input=axIn}"category"===contOut.angularaxis.type&&coerce("gridshape")}function handleAxisTypeDefaults(axIn,axOut,coerce,subplotData,dataAttr){if("-"===coerce("type")){for(var trace,i=0;i<subplotData.length;i++)if(subplotData[i].visible){trace=subplotData[i];break}trace&&trace[dataAttr]&&(axOut.type=autoType(trace[dataAttr],"gregorian")),"-"===axOut.type?axOut.type="linear":axIn.type=axOut.type}return axOut.type}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){handleSubplotDefaults(layoutIn,layoutOut,fullData,{type:constants.name,attributes:layoutAttributes,handleDefaults:handleDefaults,font:layoutOut.font,paper_bgcolor:layoutOut.paper_bgcolor,fullData:fullData,layoutOut:layoutOut})}},{"../../components/color":567,"../../lib":693,"../cartesian/axis_autotype":743,"../cartesian/category_order_defaults":746,"../cartesian/line_grid_defaults":756,"../cartesian/tick_label_defaults":761,"../cartesian/tick_mark_defaults":762,"../cartesian/tick_value_defaults":763,"../get_data":778,"../subplot_defaults":820,"./constants":806,"./layout_attributes":809,"./set_convert":818}],811:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../../../traces/scatter/attributes"),scatterMarkerAttrs=scatterAttrs.marker,extendFlat=_dereq_("../../../lib/extend").extendFlat;["Area traces are deprecated!","Please switch to the *barpolar* trace type."].join(" ");module.exports={r:extendFlat({},scatterAttrs.r,{}),t:extendFlat({},scatterAttrs.t,{}),marker:{color:extendFlat({},scatterMarkerAttrs.color,{}),size:extendFlat({},scatterMarkerAttrs.size,{}),symbol:extendFlat({},scatterMarkerAttrs.symbol,{}),opacity:extendFlat({},scatterMarkerAttrs.opacity,{}),editType:"calc"}}},{"../../../lib/extend":682,"../../../traces/scatter/attributes":1032}],812:[function(_dereq_,module,exports){"use strict";var axesAttrs=_dereq_("../../cartesian/layout_attributes"),extendFlat=_dereq_("../../../lib/extend").extendFlat,overrideAll=_dereq_("../../../plot_api/edit_types").overrideAll,deprecationWarning=["Legacy polar charts are deprecated!","Please switch to *polar* subplots."].join(" "),domainAttr=extendFlat({},axesAttrs.domain,{});function mergeAttrs(axisName,nonCommonAttrs){return extendFlat({},nonCommonAttrs,{showline:{valType:"boolean"},showticklabels:{valType:"boolean"},tickorientation:{valType:"enumerated",values:["horizontal","vertical"]},ticklen:{valType:"number",min:0},tickcolor:{valType:"color"},ticksuffix:{valType:"string"},endpadding:{valType:"number",description:deprecationWarning},visible:{valType:"boolean"}})}module.exports=overrideAll({radialaxis:mergeAttrs(0,{range:{valType:"info_array",items:[{valType:"number"},{valType:"number"}]},domain:domainAttr,orientation:{valType:"number"}}),angularaxis:mergeAttrs(0,{range:{valType:"info_array",items:[{valType:"number",dflt:0},{valType:"number",dflt:360}]},domain:domainAttr}),layout:{direction:{valType:"enumerated",values:["clockwise","counterclockwise"]},orientation:{valType:"angle"}}},"plot","nested")},{"../../../lib/extend":682,"../../../plot_api/edit_types":725,"../../cartesian/layout_attributes":754}],813:[function(_dereq_,module,exports){"use strict";(module.exports=_dereq_("./micropolar")).manager=_dereq_("./micropolar_manager")},{"./micropolar":814,"./micropolar_manager":815}],814:[function(_dereq_,module,exports){var d3=_dereq_("d3"),extendDeepAll=_dereq_("../../../lib").extendDeepAll,MID_SHIFT=_dereq_("../../../constants/alignment").MID_SHIFT,=module.exports={version:"0.2.2"};.Axis=function module(){var svg,container,radialScale,angularScale,config={data:[],layout:{}},inputConfig={},liveConfig={},dispatch=d3.dispatch("hover"),exports={};return exports.render=function(_container){return function render(_container){container=_container||container;var data=config.data,axisConfig=config.layout;return("string"==typeof container||container.nodeName)&&(container=d3.select(container)),container.datum(data).each(function(_data,_index){var dataOriginal=_data.slice();liveConfig={data:.util.cloneJson(dataOriginal),layout:.util.cloneJson(axisConfig)};var colorIndex=0;dataOriginal.forEach(function(d,i){d.color||(d.color=axisConfig.defaultColorRange[colorIndex],colorIndex=(colorIndex+1)%axisConfig.defaultColorRange.length),d.strokeColor||(d.strokeColor="LinePlot"===d.geometry?d.color:d3.rgb(d.color).darker().toString()),liveConfig.data[i].color=d.color,liveConfig.data[i].strokeColor=d.strokeColor,liveConfig.data[i].strokeDash=d.strokeDash,liveConfig.data[i].strokeSize=d.strokeSize});var data=dataOriginal.filter(function(d,i){var visible=d.visible;return void 0===visible||!0===visible}),isStacked=!1,dataWithGroupId=data.map(function(d,i){return isStacked=isStacked||void 0!==d.groupId,d});if(isStacked){var dataYStack=[],stacked=d3.nest().key(function(d,i){return void 0!==d.groupId?d.groupId:"unstacked"}).entries(dataWithGroupId).map(function(d,i){if("unstacked"===d.key)return d.values;var prevArray=d.values[0].r.map(function(d,i){return 0});return d.values.forEach(function(d,i,a){d.yStack=[prevArray],dataYStack.push(prevArray),prevArray=.util.sumArrays(d.r,prevArray)}),d.values});data=d3.merge(stacked)}data.forEach(function(d,i){d.t=Array.isArray(d.t[0])?d.t:[d.t],d.r=Array.isArray(d.r[0])?d.r:[d.r]});var radius=Math.min(axisConfig.width-axisConfig.margin.left-axisConfig.margin.right,axisConfig.height-axisConfig.margin.top-axisConfig.margin.bottom)/2;radius=Math.max(10,radius);var extent,chartCenter=[axisConfig.margin.left+radius,axisConfig.margin.top+radius];extent=isStacked?[0,d3.max(.util.sumArrays(.util.arrayLast(data).r[0],.util.arrayLast(dataYStack)))]:d3.extent(.util.flattenArray(data.map(function(d,i){return d.r}))),axisConfig.radialAxis.domain!=.DATAEXTENT&&(extent[0]=0),radialScale=d3.scale.linear().domain(axisConfig.radialAxis.domain!=.DATAEXTENT&&axisConfig.radialAxis.domain?axisConfig.radialAxis.domain:extent).range([0,radius]),liveConfig.layout.radialAxis.domain=radialScale.domain();var ticks,angularDataMerged=.util.flattenArray(data.map(function(d,i){return d.t})),isOrdinal="string"==typeof angularDataMerged[0];isOrdinal&&(angularDataMerged=.util.deduplicate(angularDataMerged),ticks=angularDataMerged.slice(),angularDataMerged=d3.range(angularDataMerged.length),data=data.map(function(d,i){var result=d;return d.t=[angularDataMerged],isStacked&&(result.yStack=d.yStack),result}));var hasOnlyLineOrDotPlot=data.filter(function(d,i){return"LinePlot"===d.geometry||"DotPlot"===d.geometry}).length===data.length,needsEndSpacing=null===axisConfig.needsEndSpacing?isOrdinal||!hasOnlyLineOrDotPlot:axisConfig.needsEndSpacing,angularDomain=axisConfig.angularAxis.domain&&axisConfig.angularAxis.domain!=.DATAEXTENT&&!isOrdinal&&axisConfig.angularAxis.domain[0]>=0?axisConfig.angularAxis.domain:d3.extent(angularDataMerged),angularDomainStep=Math.abs(angularDataMerged[1]-angularDataMerged[0]);hasOnlyLineOrDotPlot&&!isOrdinal&&(angularDomainStep=0);var angularDomainWithPadding=angularDomain.slice();needsEndSpacing&&isOrdinal&&(angularDomainWithPadding[1]+=angularDomainStep);var tickCount=axisConfig.angularAxis.ticksCount||4;tickCount>8&&(tickCount=tickCount/(tickCount/8)+tickCount%8),axisConfig.angularAxis.ticksStep&&(tickCount=(angularDomainWithPadding[1]-angularDomainWithPadding[0])/tickCount);var angularTicksStep=axisConfig.angularAxis.ticksStep||(angularDomainWithPadding[1]-angularDomainWithPadding[0])/(tickCount*(axisConfig.minorTicks+1));ticks&&(angularTicksStep=Math.max(Math.round(angularTicksStep),1)),angularDomainWithPadding[2]||(angularDomainWithPadding[2]=angularTicksStep);var angularAxisRange=d3.range.apply(this,angularDomainWithPadding);if(angularAxisRange=angularAxisRange.map(function(d,i){return parseFloat(d.toPrecision(12))}),angularScale=d3.scale.linear().domain(angularDomainWithPadding.slice(0,2)).range("clockwise"===axisConfig.direction?[0,360]:[360,0]),liveConfig.layout.angularAxis.domain=angularScale.domain(),liveConfig.layout.angularAxis.endPadding=needsEndSpacing?angularDomainStep:0,void 0===(svg=d3.select(this).select("svg.chart-root"))||svg.empty()){var doc=(new DOMParser).parseFromString("<svg xmlns='http://www.w3.org/2000/svg' class='chart-root'>' + '<g class='outer-group'>' + '<g class='chart-group'>' + '<circle class='background-circle'></circle>' + '<g class='geometry-group'></g>' + '<g class='radial axis-group'>' + '<circle class='outside-circle'></circle>' + '</g>' + '<g class='angular axis-group'></g>' + '<g class='guides-group'><line></line><circle r='0'></circle></g>' + '</g>' + '<g class='legend-group'></g>' + '<g class='tooltips-group'></g>' + '<g class='title-group'><text></text></g>' + '</g>' + '</svg>","application/xml"),newSvg=this.appendChild(this.ownerDocument.importNode(doc.documentElement,!0));svg=d3.select(newSvg)}svg.select(".guides-group").style({"pointer-events":"none"}),svg.select(".angular.axis-group").style({"pointer-events":"none"}),svg.select(".radial.axis-group").style({"pointer-events":"none"});var legendContainer,chartGroup=svg.select(".chart-group"),lineStyle={fill:"none",stroke:axisConfig.tickColor},fontStyle={"font-size":axisConfig.font.size,"font-family":axisConfig.font.family,fill:axisConfig.font.color,"text-shadow":["-1px 0px","1px -1px","-1px 1px","1px 1px"].map(function(d,i){return" "+d+" 0 "+axisConfig.font.outlineColor}).join(",")};if(axisConfig.showLegend){legendContainer=svg.select(".legend-group").attr({transform:"translate("+[radius,axisConfig.margin.top]+")"}).style({display:"block"});var elements=data.map(function(d,i){var datumClone=.util.cloneJson(d);return datumClone.symbol="DotPlot"===d.geometry?d.dotType||"circle":"LinePlot"!=d.geometry?"square":"line",datumClone.visibleInLegend=void 0===d.visibleInLegend||d.visibleInLegend,datumClone.color="LinePlot"===d.geometry?d.strokeColor:d.color,datumClone});.Legend().config({data:data.map(function(d,i){return d.name||"Element"+i}),legendConfig:extendDeepAll({},.Legend.defaultConfig().legendConfig,{container:legendContainer,elements:elements,reverseOrder:axisConfig.legend.reverseOrder})})();var legendBBox=legendContainer.node().getBBox();radius=Math.min(axisConfig.width-legendBBox.width-axisConfig.margin.left-axisConfig.margin.right,axisConfig.height-axisConfig.margin.top-axisConfig.margin.bottom)/2,radius=Math.max(10,radius),chartCenter=[axisConfig.margin.left+radius,axisConfig.margin.top+radius],radialScale.range([0,radius]),liveConfig.layout.radialAxis.domain=radialScale.domain(),legendContainer.attr("transform","translate("+[chartCenter[0]+radius,chartCenter[1]-radius]+")")}else legendContainer=svg.select(".legend-group").style({display:"none"});svg.attr({width:axisConfig.width,height:axisConfig.height}).style({opacity:axisConfig.opacity}),chartGroup.attr("transform","translate("+chartCenter+")").style({cursor:"crosshair"});var centeringOffset=[(axisConfig.width-(axisConfig.margin.left+axisConfig.margin.right+2*radius+(legendBBox?legendBBox.width:0)))/2,(axisConfig.height-(axisConfig.margin.top+axisConfig.margin.bottom+2*radius))/2];if(centeringOffset[0]=Math.max(0,centeringOffset[0]),centeringOffset[1]=Math.max(0,centeringOffset[1]),svg.select(".outer-group").attr("transform","translate("+centeringOffset+")"),axisConfig.title){var title=svg.select("g.title-group text").style(fontStyle).text(axisConfig.title),titleBBox=title.node().getBBox();title.attr({x:chartCenter[0]-titleBBox.width/2,y:chartCenter[1]-radius-20})}var radialAxis=svg.select(".radial.axis-group");if(axisConfig.radialAxis.gridLinesVisible){var gridCircles=radialAxis.selectAll("circle.grid-circle").data(radialScale.ticks(5));gridCircles.enter().append("circle").attr({class:"grid-circle"}).style(lineStyle),gridCircles.attr("r",radialScale),gridCircles.exit().remove()}radialAxis.select("circle.outside-circle").attr({r:radius}).style(lineStyle);var backgroundCircle=svg.select("circle.background-circle").attr({r:radius}).style({fill:axisConfig.backgroundColor,stroke:axisConfig.stroke});function currentAngle(d,i){return angularScale(d)%360+axisConfig.orientation}if(axisConfig.radialAxis.visible){var axis=d3.svg.axis().scale(radialScale).ticks(5).tickSize(5);radialAxis.call(axis).attr({transform:"rotate("+axisConfig.radialAxis.orientation+")"}),radialAxis.selectAll(".domain").style(lineStyle),radialAxis.selectAll("g>text").text(function(d,i){return this.textContent+axisConfig.radialAxis.ticksSuffix}).style(fontStyle).style({"text-anchor":"start"}).attr({x:0,y:0,dx:0,dy:0,transform:function(d,i){return"horizontal"===axisConfig.radialAxis.tickOrientation?"rotate("+-axisConfig.radialAxis.orientation+") translate("+[0,fontStyle["font-size"]]+")":"translate("+[0,fontStyle["font-size"]]+")"}}),radialAxis.selectAll("g>line").style({stroke:"black"})}var angularAxis=svg.select(".angular.axis-group").selectAll("g.angular-tick").data(angularAxisRange),angularAxisEnter=angularAxis.enter().append("g").classed("angular-tick",!0);angularAxis.attr({transform:function(d,i){return"rotate("+currentAngle(d)+")"}}).style({display:axisConfig.angularAxis.visible?"block":"none"}),angularAxis.exit().remove(),angularAxisEnter.append("line").classed("grid-line",!0).classed("major",function(d,i){return i%(axisConfig.minorTicks+1)==0}).classed("minor",function(d,i){return!(i%(axisConfig.minorTicks+1)==0)}).style(lineStyle),angularAxisEnter.selectAll(".minor").style({stroke:axisConfig.minorTickColor}),angularAxis.select("line.grid-line").attr({x1:axisConfig.tickLength?radius-axisConfig.tickLength:0,x2:radius}).style({display:axisConfig.angularAxis.gridLinesVisible?"block":"none"}),angularAxisEnter.append("text").classed("axis-text",!0).style(fontStyle);var ticksText=angularAxis.select("text.axis-text").attr({x:radius+axisConfig.labelOffset,dy:MID_SHIFT+"em",transform:function(d,i){var angle=currentAngle(d),rad=radius+axisConfig.labelOffset,orient=axisConfig.angularAxis.tickOrientation;return"horizontal"==orient?"rotate("+-angle+" "+rad+" 0)":"radial"==orient?angle<270&&angle>90?"rotate(180 "+rad+" 0)":null:"rotate("+(angle<=180&&angle>0?-90:90)+" "+rad+" 0)"}}).style({"text-anchor":"middle",display:axisConfig.angularAxis.labelsVisible?"block":"none"}).text(function(d,i){return i%(axisConfig.minorTicks+1)!=0?"":ticks?ticks[d]+axisConfig.angularAxis.ticksSuffix:d+axisConfig.angularAxis.ticksSuffix}).style(fontStyle);axisConfig.angularAxis.rewriteTicks&&ticksText.text(function(d,i){return i%(axisConfig.minorTicks+1)!=0?"":axisConfig.angularAxis.rewriteTicks(this.textContent,i)});var rightmostTickEndX=d3.max(chartGroup.selectAll(".angular-tick text")[0].map(function(d,i){return d.getCTM().e+d.getBBox().width}));legendContainer.attr({transform:"translate("+[radius+rightmostTickEndX,axisConfig.margin.top]+")"});var hasGeometry=svg.select("g.geometry-group").selectAll("g").size()>0,geometryContainer=svg.select("g.geometry-group").selectAll("g.geometry").data(data);if(geometryContainer.enter().append("g").attr({class:function(d,i){return"geometry geometry"+i}}),geometryContainer.exit().remove(),data[0]||hasGeometry){var geometryConfigs=[];data.forEach(function(d,i){var geometryConfig={};geometryConfig.radialScale=radialScale,geometryConfig.angularScale=angularScale,geometryConfig.container=geometryContainer.filter(function(dB,iB){return iB==i}),geometryConfig.geometry=d.geometry,geometryConfig.orientation=axisConfig.orientation,geometryConfig.direction=axisConfig.direction,geometryConfig.index=i,geometryConfigs.push({data:d,geometryConfig:geometryConfig})});var geometryConfigsGrouped2=[];d3.nest().key(function(d,i){return void 0!==d.data.groupId||"unstacked"}).entries(geometryConfigs).forEach(function(d,i){"unstacked"===d.key?geometryConfigsGrouped2=geometryConfigsGrouped2.concat(d.values.map(function(d,i){return[d]})):geometryConfigsGrouped2.push(d.values)}),geometryConfigsGrouped2.forEach(function(d,i){var geometry;geometry=Array.isArray(d)?d[0].geometryConfig.geometry:d.geometryConfig.geometry;var finalGeometryConfig=d.map(function(dB,iB){return extendDeepAll([geometry].defaultConfig(),dB)});[geometry]().config(finalGeometryConfig)()})}var angularValue,radialValue,guides=svg.select(".guides-group"),tooltipContainer=svg.select(".tooltips-group"),angularTooltip=.tooltipPanel().config({container:tooltipContainer,fontSize:8})(),radialTooltip=.tooltipPanel().config({container:tooltipContainer,fontSize:8})(),geometryTooltip=.tooltipPanel().config({container:tooltipContainer,hasTick:!0})();if(!isOrdinal){var angularGuideLine=guides.select("line").attr({x1:0,y1:0,y2:0}).style({stroke:"grey","pointer-events":"none"});chartGroup.on("mousemove.angular-guide",function(d,i){var mouseAngle=.util.getMousePos(backgroundCircle).angle;angularGuideLine.attr({x2:-radius,transform:"rotate("+mouseAngle+")"}).style({opacity:.5});var angleWithOriginOffset=(mouseAngle+180+360-axisConfig.orientation)%360;angularValue=angularScale.invert(angleWithOriginOffset);var pos=.util.convertToCartesian(radius+12,mouseAngle+180);angularTooltip.text(.util.round(angularValue)).move([pos[0]+chartCenter[0],pos[1]+chartCenter[1]])}).on("mouseout.angular-guide",function(d,i){guides.select("line").style({opacity:0})})}var angularGuideCircle=guides.select("circle").style({stroke:"grey",fill:"none"});chartGroup.on("mousemove.radial-guide",function(d,i){var r=.util.getMousePos(backgroundCircle).radius;angularGuideCircle.attr({r:r}).style({opacity:.5}),radialValue=radialScale.invert(.util.getMousePos(backgroundCircle).radius);var pos=.util.convertToCartesian(r,axisConfig.radialAxis.orientation);radialTooltip.text(.util.round(radialValue)).move([pos[0]+chartCenter[0],pos[1]+chartCenter[1]])}).on("mouseout.radial-guide",function(d,i){angularGuideCircle.style({opacity:0}),geometryTooltip.hide(),angularTooltip.hide(),radialTooltip.hide()}),svg.selectAll(".geometry-group .mark").on("mouseover.tooltip",function(d,i){var el=d3.select(this),color=this.style.fill,newColor="black",opacity=this.style.opacity||1;if(el.attr({"data-opacity":opacity}),color&&"none"!==color){el.attr({"data-fill":color}),newColor=d3.hsl(color).darker().toString(),el.style({fill:newColor,opacity:1});var textData={t:.util.round(d[0]),r:.util.round(d[1])};isOrdinal&&(textData.t=ticks[d[0]]);var text="t: "+textData.t+", r: "+textData.r,bbox=this.getBoundingClientRect(),svgBBox=svg.node().getBoundingClientRect(),pos=[bbox.left+bbox.width/2-centeringOffset[0]-svgBBox.left,bbox.top+bbox.height/2-centeringOffset[1]-svgBBox.top];geometryTooltip.config({color:newColor}).text(text),geometryTooltip.move(pos)}else color=this.style.stroke||"black",el.attr({"data-stroke":color}),newColor=d3.hsl(color).darker().toString(),el.style({stroke:newColor,opacity:1})}).on("mousemove.tooltip",function(d,i){if(0!=d3.event.which)return!1;d3.select(this).attr("data-fill")&&geometryTooltip.show()}).on("mouseout.tooltip",function(d,i){geometryTooltip.hide();var el=d3.select(this),fillColor=el.attr("data-fill");fillColor?el.style({fill:fillColor,opacity:el.attr("data-opacity")}):el.style({stroke:el.attr("data-stroke"),opacity:el.attr("data-opacity")})})}),exports}(_container),this},exports.config=function(_x){if(!arguments.length)return config;var xClone=.util.cloneJson(_x);return xClone.data.forEach(function(d,i){config.data[i]||(config.data[i]={}),extendDeepAll(config.data[i],.Axis.defaultConfig().data[0]),extendDeepAll(config.data[i],d)}),extendDeepAll(config.layout,.Axis.defaultConfig().layout),extendDeepAll(config.layout,xClone.layout),this},exports.getLiveConfig=function(){return liveConfig},exports.getinputConfig=function(){return inputConfig},exports.radialScale=function(_x){return radialScale},exports.angularScale=function(_x){return angularScale},exports.svg=function(){return svg},d3.rebind(exports,dispatch,"on"),exports},.Axis.defaultConfig=function(d,i){return{data:[{t:[1,2,3,4],r:[10,11,12,13],name:"Line1",geometry:"LinePlot",color:null,strokeDash:"solid",strokeColor:null,strokeSize:"1",visibleInLegend:!0,opacity:1}],layout:{defaultColorRange:d3.scale.category10().range(),title:null,height:450,width:500,margin:{top:40,right:40,bottom:40,left:40},font:{size:12,color:"gray",outlineColor:"white",family:"Tahoma, sans-serif"},direction:"clockwise",orientation:0,labelOffset:10,radialAxis:{domain:null,orientation:-45,ticksSuffix:"",visible:!0,gridLinesVisible:!0,tickOrientation:"horizontal",rewriteTicks:null},angularAxis:{domain:[0,360],ticksSuffix:"",visible:!0,gridLinesVisible:!0,labelsVisible:!0,tickOrientation:"horizontal",rewriteTicks:null,ticksCount:null,ticksStep:null},minorTicks:0,tickLength:null,tickColor:"silver",minorTickColor:"#eee",backgroundColor:"none",needsEndSpacing:null,showLegend:!0,legend:{reverseOrder:!1},opacity:1}}},.util={},.DATAEXTENT="dataExtent",.AREA="AreaChart",.LINE="LinePlot",.DOT="DotPlot",.BAR="BarChart",.util._override=function(_objA,_objB){for(var x in _objA)x in _objB&&(_objB[x]=_objA[x])},.util._extend=function(_objA,_objB){for(var x in _objA)_objB[x]=_objA[x]},.util._rndSnd=function(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)},.util.dataFromEquation2=function(_equation,_step){var step=_step||6;return d3.range(0,360+step,step).map(function(deg,index){var theta=deg*Math.PI/180;return[deg,_equation(theta)]})},.util.dataFromEquation=function(_equation,_step,_name){var step=_step||6,t=[],r=[];d3.range(0,360+step,step).forEach(function(deg,index){var theta=deg*Math.PI/180,radius=_equation(theta);t.push(deg),r.push(radius)});var result={t:t,r:r};return _name&&(result.name=_name),result},.util.ensureArray=function(_val,_count){if(void 0===_val)return null;var arr=[].concat(_val);return d3.range(_count).map(function(d,i){return arr[i]||arr[0]})},.util.fillArrays=function(_obj,_valueNames,_count){return _valueNames.forEach(function(d,i){_obj[d]=.util.ensureArray(_obj[d],_count)}),_obj},.util.cloneJson=function(json){return JSON.parse(JSON.stringify(json))},.util.validateKeys=function(obj,keys){"string"==typeof keys&&(keys=keys.split("."));var next=keys.shift();return obj[next]&&(!keys.length||objHasKeys(obj[next],keys))},.util.sumArrays=function(a,b){return d3.zip(a,b).map(function(d,i){return d3.sum(d)})},.util.arrayLast=function(a){return a[a.length-1]},.util.arrayEqual=function(a,b){for(var i=Math.max(a.length,b.length,1);i-- >=0&&a[i]===b[i];);return-2===i},.util.flattenArray=function(arr){for(var r=[];!.util.arrayEqual(r,arr);)r=arr,arr=[].concat.apply([],arr);return arr},.util.deduplicate=function(arr){return arr.filter(function(v,i,a){return a.indexOf(v)==i})},.util.convertToCartesian=function(radius,theta){var thetaRadians=theta*Math.PI/180;return[radius*Math.cos(thetaRadians),radius*Math.sin(thetaRadians)]},.util.round=function(_value,_digits){var digits=_digits||2,mult=Math.pow(10,digits);return Math.round(_value*mult)/mult},.util.getMousePos=function(_referenceElement){var mousePos=d3.mouse(_referenceElement.node()),mouseX=mousePos[0],mouseY=mousePos[1],mouse={};return mouse.x=mouseX,mouse.y=mouseY,mouse.pos=mousePos,mouse.angle=180*(Math.atan2(mouseY,mouseX)+Math.PI)/Math.PI,mouse.radius=Math.sqrt(mouseX*mouseX+mouseY*mouseY),mouse},.util.duplicatesCount=function(arr){for(var val,uniques={},dups={},i=0,len=arr.length;i<len;i++)(val=arr[i])in uniques?(uniques[val]++,dups[val]=uniques[val]):uniques[val]=1;return dups},.util.duplicates=function(arr){return Object.keys(.util.duplicatesCount(arr))},.util.translator=function(obj,sourceBranch,targetBranch,reverse){if(reverse){var targetBranchCopy=targetBranch.slice();targetBranch=sourceBranch,sourceBranch=targetBranchCopy}var value=sourceBranch.reduce(function(previousValue,currentValue){if(void 0!==previousValue)return previousValue[currentValue]},obj);void 0!==value&&(sourceBranch.reduce(function(previousValue,currentValue,index){if(void 0!==previousValue)return index===sourceBranch.length-1&&delete previousValue[currentValue],previousValue[currentValue]},obj),targetBranch.reduce(function(previousValue,currentValue,index){return void 0===previousValue[currentValue]&&(previousValue[currentValue]={}),index===targetBranch.length-1&&(previousValue[currentValue]=value),previousValue[currentValue]},obj))},.PolyChart=function module(){var config=[.PolyChart.defaultConfig()],dispatch=d3.dispatch("hover"),dashArray={solid:"none",dash:[5,2],dot:[2,5]};function exports(){var geometryConfig=config[0].geometryConfig,container=geometryConfig.container;"string"==typeof container&&(container=d3.select(container)),container.datum(config).each(function(_config,_index){var isStack=!!_config[0].data.yStack,data=_config.map(function(d,i){return isStack?d3.zip(d.data.t[0],d.data.r[0],d.data.yStack[0]):d3.zip(d.data.t[0],d.data.r[0])}),angularScale=geometryConfig.angularScale,domainMin=geometryConfig.radialScale.domain()[0],generator={bar:function(d,i,pI){var dataConfig=_config[pI].data,h=geometryConfig.radialScale(d[1])-geometryConfig.radialScale(0),stackTop=geometryConfig.radialScale(d[2]||0),w=dataConfig.barWidth;d3.select(this).attr({class:"mark bar",d:"M"+[[h+stackTop,-w/2],[h+stackTop,w/2],[stackTop,w/2],[stackTop,-w/2]].join("L")+"Z",transform:function(d,i){return"rotate("+(geometryConfig.orientation+angularScale(d[0]))+")"}})}};generator.dot=function(d,i,pI){var stackedData=d[2]?[d[0],d[1]+d[2]]:d,symbol=d3.svg.symbol().size(_config[pI].data.dotSize).type(_config[pI].data.dotType)(d,i);d3.select(this).attr({class:"mark dot",d:symbol,transform:function(d,i){var coord=function convertToCartesian(polarCoordinates){var x=polarCoordinates.r*Math.cos(polarCoordinates.t),y=polarCoordinates.r*Math.sin(polarCoordinates.t);return{x:x,y:y}}(function getPolarCoordinates(d,i){var r=geometryConfig.radialScale(d[1]),t=(geometryConfig.angularScale(d[0])+geometryConfig.orientation)*Math.PI/180;return{r:r,t:t}}(stackedData));return"translate("+[coord.x,coord.y]+")"}})};var line=d3.svg.line.radial().interpolate(_config[0].data.lineInterpolation).radius(function(d){return geometryConfig.radialScale(d[1])}).angle(function(d){return geometryConfig.angularScale(d[0])*Math.PI/180});generator.line=function(d,i,pI){var lineData=d[2]?data[pI].map(function(d,i){return[d[0],d[1]+d[2]]}):data[pI];if(d3.select(this).each(generator.dot).style({opacity:function(dB,iB){return+_config[pI].data.dotVisible},fill:markStyle.stroke(d,i,pI)}).attr({class:"mark dot"}),!(i>0)){var lineSelection=d3.select(this.parentNode).selectAll("path.line").data([0]);lineSelection.enter().insert("path"),lineSelection.attr({class:"line",d:line(lineData),transform:function(dB,iB){return"rotate("+(geometryConfig.orientation+90)+")"},"pointer-events":"none"}).style({fill:function(dB,iB){return markStyle.fill(d,i,pI)},"fill-opacity":0,stroke:function(dB,iB){return markStyle.stroke(d,i,pI)},"stroke-width":function(dB,iB){return markStyle["stroke-width"](d,i,pI)},"stroke-dasharray":function(dB,iB){return markStyle["stroke-dasharray"](d,i,pI)},opacity:function(dB,iB){return markStyle.opacity(d,i,pI)},display:function(dB,iB){return markStyle.display(d,i,pI)}})}};var angularRange=geometryConfig.angularScale.range(),triangleAngle=Math.abs(angularRange[1]-angularRange[0])/data[0].length*Math.PI/180,arc=d3.svg.arc().startAngle(function(d){return-triangleAngle/2}).endAngle(function(d){return triangleAngle/2}).innerRadius(function(d){return geometryConfig.radialScale(domainMin+(d[2]||0))}).outerRadius(function(d){return geometryConfig.radialScale(domainMin+(d[2]||0))+geometryConfig.radialScale(d[1])});generator.arc=function(d,i,pI){d3.select(this).attr({class:"mark arc",d:arc,transform:function(d,i){return"rotate("+(geometryConfig.orientation+angularScale(d[0])+90)+")"}})};var markStyle={fill:function(d,i,pI){return _config[pI].data.color},stroke:function(d,i,pI){return _config[pI].data.strokeColor},"stroke-width":function(d,i,pI){return _config[pI].data.strokeSize+"px"},"stroke-dasharray":function(d,i,pI){return dashArray[_config[pI].data.strokeDash]},opacity:function(d,i,pI){return _config[pI].data.opacity},display:function(d,i,pI){return void 0===_config[pI].data.visible||_config[pI].data.visible?"block":"none"}},geometryLayer=d3.select(this).selectAll("g.layer").data(data);geometryLayer.enter().append("g").attr({class:"layer"});var geometry=geometryLayer.selectAll("path.mark").data(function(d,i){return d});geometry.enter().append("path").attr({class:"mark"}),geometry.style(markStyle).each(generator[geometryConfig.geometryType]),geometry.exit().remove(),geometryLayer.exit().remove()})}return exports.config=function(_x){return arguments.length?(_x.forEach(function(d,i){config[i]||(config[i]={}),extendDeepAll(config[i],.PolyChart.defaultConfig()),extendDeepAll(config[i],d)}),this):config},exports.getColorScale=function(){},d3.rebind(exports,dispatch,"on"),exports},.PolyChart.defaultConfig=function(){return{data:{name:"geom1",t:[[1,2,3,4]],r:[[1,2,3,4]],dotType:"circle",dotSize:64,dotVisible:!1,barWidth:20,color:"#ffa500",strokeSize:1,strokeColor:"silver",strokeDash:"solid",opacity:1,index:0,visible:!0,visibleInLegend:!0},geometryConfig:{geometry:"LinePlot",geometryType:"arc",direction:"clockwise",orientation:0,container:"body",radialScale:null,angularScale:null,colorScale:d3.scale.category20()}}},.BarChart=function module(){return .PolyChart()},.BarChart.defaultConfig=function(){return{geometryConfig:{geometryType:"bar"}}},.AreaChart=function module(){return .PolyChart()},.AreaChart.defaultConfig=function(){return{geometryConfig:{geometryType:"arc"}}},.DotPlot=function module(){return .PolyChart()},.DotPlot.defaultConfig=function(){return{geometryConfig:{geometryType:"dot",dotType:"circle"}}},.LinePlot=function module(){return .PolyChart()},.LinePlot.defaultConfig=function(){return{geometryConfig:{geometryType:"line"}}},.Legend=function module(){var config=.Legend.defaultConfig(),dispatch=d3.dispatch("hover");function exports(){var legendConfig=config.legendConfig,flattenData=config.data.map(function(d,i){return[].concat(d).map(function(dB,iB){var element=extendDeepAll({},legendConfig.elements[i]);return element.name=dB,element.color=[].concat(legendConfig.elements[i].color)[iB],element})}),data=d3.merge(flattenData);data=data.filter(function(d,i){return legendConfig.elements[i]&&(legendConfig.elements[i].visibleInLegend||void 0===legendConfig.elements[i].visibleInLegend)}),legendConfig.reverseOrder&&(data=data.reverse());var container=legendConfig.container;("string"==typeof container||container.nodeName)&&(container=d3.select(container));var colors=data.map(function(d,i){return d.color}),lineHeight=legendConfig.fontSize,isContinuous=null==legendConfig.isContinuous?"number"==typeof data[0]:legendConfig.isContinuous,height=isContinuous?legendConfig.height:lineHeight*data.length,svg=container.classed("legend-group",!0).selectAll("svg").data([0]),svgEnter=svg.enter().append("svg").attr({width:300,height:height+lineHeight,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"});svgEnter.append("g").classed("legend-axis",!0),svgEnter.append("g").classed("legend-marks",!0);var dataNumbered=d3.range(data.length),colorScale=d3.scale[isContinuous?"linear":"ordinal"]().domain(dataNumbered).range(colors),dataScale=d3.scale[isContinuous?"linear":"ordinal"]().domain(dataNumbered)[isContinuous?"range":"rangePoints"]([0,height]);if(isContinuous){var gradient=svg.select(".legend-marks").append("defs").append("linearGradient").attr({id:"grad1",x1:"0%",y1:"0%",x2:"0%",y2:"100%"}).selectAll("stop").data(colors);gradient.enter().append("stop"),gradient.attr({offset:function(d,i){return i/(colors.length-1)*100+"%"}}).style({"stop-color":function(d,i){return d}}),svg.append("rect").classed("legend-mark",!0).attr({height:legendConfig.height,width:legendConfig.colorBandWidth,fill:"url(#grad1)"})}else{var legendElement=svg.select(".legend-marks").selectAll("path.legend-mark").data(data);legendElement.enter().append("path").classed("legend-mark",!0),legendElement.attr({transform:function(d,i){return"translate("+[lineHeight/2,dataScale(i)+lineHeight/2]+")"},d:function(d,i){var _type,_size,squareSize,symbolType=d.symbol;return squareSize=3*(_size=lineHeight),"line"===(_type=symbolType)?"M"+[[-_size/2,-_size/12],[_size/2,-_size/12],[_size/2,_size/12],[-_size/2,_size/12]]+"Z":-1!=d3.svg.symbolTypes.indexOf(_type)?d3.svg.symbol().type(_type).size(squareSize)():d3.svg.symbol().type("square").size(squareSize)()},fill:function(d,i){return colorScale(i)}}),legendElement.exit().remove()}var legendAxis=d3.svg.axis().scale(dataScale).orient("right"),axis=svg.select("g.legend-axis").attr({transform:"translate("+[isContinuous?legendConfig.colorBandWidth:lineHeight,lineHeight/2]+")"}).call(legendAxis);return axis.selectAll(".domain").style({fill:"none",stroke:"none"}),axis.selectAll("line").style({fill:"none",stroke:isContinuous?legendConfig.textColor:"none"}),axis.selectAll("text").style({fill:legendConfig.textColor,"font-size":legendConfig.fontSize}).text(function(d,i){return data[i].name}),exports}return exports.config=function(_x){return arguments.length?(extendDeepAll(config,_x),this):config},d3.rebind(exports,dispatch,"on"),exports},.Legend.defaultConfig=function(d,i){return{data:["a","b","c"],legendConfig:{elements:[{symbol:"line",color:"red"},{symbol:"square",color:"yellow"},{symbol:"diamond",color:"limegreen"}],height:150,colorBandWidth:30,fontSize:12,container:"body",isContinuous:null,textColor:"grey",reverseOrder:!1}}},.tooltipPanel=function(){var tooltipEl,tooltipTextEl,backgroundEl,config={container:null,hasTick:!1,fontSize:12,color:"white",padding:5},id="tooltip-"+.tooltipPanel.uid++,tickSize=10,exports=function(){var tooltipEnter=(tooltipEl=config.container.selectAll("g."+id).data([0])).enter().append("g").classed(id,!0).style({"pointer-events":"none",display:"none"});return backgroundEl=tooltipEnter.append("path").style({fill:"white","fill-opacity":.9}).attr({d:"M0 0"}),tooltipTextEl=tooltipEnter.append("text").attr({dx:config.padding+tickSize,dy:.3*+config.fontSize}),exports};return exports.text=function(_text){var l=d3.hsl(config.color).l,strokeColor=l>=.5?"#aaa":"white",fillColor=l>=.5?"black":"white",text=_text||"";tooltipTextEl.style({fill:fillColor,"font-size":config.fontSize+"px"}).text(text);var padding=config.padding,bbox=tooltipTextEl.node().getBBox(),boxStyle={fill:config.color,stroke:strokeColor,"stroke-width":"2px"},backGroundW=bbox.width+2*padding+tickSize,backGroundH=bbox.height+2*padding;return backgroundEl.attr({d:"M"+[[tickSize,-backGroundH/2],[tickSize,-backGroundH/4],[config.hasTick?0:tickSize,0],[tickSize,backGroundH/4],[tickSize,backGroundH/2],[backGroundW,backGroundH/2],[backGroundW,-backGroundH/2]].join("L")+"Z"}).style(boxStyle),tooltipEl.attr({transform:"translate("+[tickSize,-backGroundH/2+2*padding]+")"}),tooltipEl.style({display:"block"}),exports},exports.move=function(_pos){if(tooltipEl)return tooltipEl.attr({transform:"translate("+[_pos[0],_pos[1]]+")"}).style({display:"block"}),exports},exports.hide=function(){if(tooltipEl)return tooltipEl.style({display:"none"}),exports},exports.show=function(){if(tooltipEl)return tooltipEl.style({display:"block"}),exports},exports.config=function(_x){return extendDeepAll(config,_x),exports},exports},.tooltipPanel.uid=1,.adapter={},.adapter.plotly=function module(){var exports={convert:function(_inputConfig,reverse){var outputConfig={};if(_inputConfig.data&&(outputConfig.data=_inputConfig.data.map(function(d,i){var r=extendDeepAll({},d);return[[r,["marker","color"],["color"]],[r,["marker","opacity"],["opacity"]],[r,["marker","line","color"],["strokeColor"]],[r,["marker","line","dash"],["strokeDash"]],[r,["marker","line","width"],["strokeSize"]],[r,["marker","symbol"],["dotType"]],[r,["marker","size"],["dotSize"]],[r,["marker","barWidth"],["barWidth"]],[r,["line","interpolation"],["lineInterpolation"]],[r,["showlegend"],["visibleInLegend"]]].forEach(function(d,i){.util.translator.apply(null,d.concat(reverse))}),reverse||delete r.marker,reverse&&delete r.groupId,reverse?("LinePlot"===r.geometry?(r.type="scatter",!0===r.dotVisible?(delete r.dotVisible,r.mode="lines+markers"):r.mode="lines"):"DotPlot"===r.geometry?(r.type="scatter",r.mode="markers"):"AreaChart"===r.geometry?r.type="area":"BarChart"===r.geometry&&(r.type="bar"),delete r.geometry):("scatter"===r.type?"lines"===r.mode?r.geometry="LinePlot":"markers"===r.mode?r.geometry="DotPlot":"lines+markers"===r.mode&&(r.geometry="LinePlot",r.dotVisible=!0):"area"===r.type?r.geometry="AreaChart":"bar"===r.type&&(r.geometry="BarChart"),delete r.mode,delete r.type),r}),!reverse&&_inputConfig.layout&&"stack"===_inputConfig.layout.barmode)){var duplicates=.util.duplicates(outputConfig.data.map(function(d,i){return d.geometry}));outputConfig.data.forEach(function(d,i){var idx=duplicates.indexOf(d.geometry);-1!=idx&&(outputConfig.data[i].groupId=idx)})}if(_inputConfig.layout){var r=extendDeepAll({},_inputConfig.layout);if([[r,["plot_bgcolor"],["backgroundColor"]],[r,["showlegend"],["showLegend"]],[r,["radialaxis"],["radialAxis"]],[r,["angularaxis"],["angularAxis"]],[r.angularaxis,["showline"],["gridLinesVisible"]],[r.angularaxis,["showticklabels"],["labelsVisible"]],[r.angularaxis,["nticks"],["ticksCount"]],[r.angularaxis,["tickorientation"],["tickOrientation"]],[r.angularaxis,["ticksuffix"],["ticksSuffix"]],[r.angularaxis,["range"],["domain"]],[r.angularaxis,["endpadding"],["endPadding"]],[r.radialaxis,["showline"],["gridLinesVisible"]],[r.radialaxis,["tickorientation"],["tickOrientation"]],[r.radialaxis,["ticksuffix"],["ticksSuffix"]],[r.radialaxis,["range"],["domain"]],[r.angularAxis,["showline"],["gridLinesVisible"]],[r.angularAxis,["showticklabels"],["labelsVisible"]],[r.angularAxis,["nticks"],["ticksCount"]],[r.angularAxis,["tickorientation"],["tickOrientation"]],[r.angularAxis,["ticksuffix"],["ticksSuffix"]],[r.angularAxis,["range"],["domain"]],[r.angularAxis,["endpadding"],["endPadding"]],[r.radialAxis,["showline"],["gridLinesVisible"]],[r.radialAxis,["tickorientation"],["tickOrientation"]],[r.radialAxis,["ticksuffix"],["ticksSuffix"]],[r.radialAxis,["range"],["domain"]],[r.font,["outlinecolor"],["outlineColor"]],[r.legend,["traceorder"],["reverseOrder"]],[r,["labeloffset"],["labelOffset"]],[r,["defaultcolorrange"],["defaultColorRange"]]].forEach(function(d,i){.util.translator.apply(null,d.concat(reverse))}),reverse?(void 0!==r.tickLength&&(r.angularaxis.ticklen=r.tickLength,delete r.tickLength),r.tickColor&&(r.angularaxis.tickcolor=r.tickColor,delete r.tickColor)):(r.angularAxis&&void 0!==r.angularAxis.ticklen&&(r.tickLength=r.angularAxis.ticklen),r.angularAxis&&void 0!==r.angularAxis.tickcolor&&(r.tickColor=r.angularAxis.tickcolor)),r.legend&&"boolean"!=typeof r.legend.reverseOrder&&(r.legend.reverseOrder="normal"!=r.legend.reverseOrder),r.legend&&"boolean"==typeof r.legend.traceorder&&(r.legend.traceorder=r.legend.traceorder?"reversed":"normal",delete r.legend.reverseOrder),r.margin&&void 0!==r.margin.t){var source=["t","r","b","l","pad"],target=["top","right","bottom","left","pad"],margin={};d3.entries(r.margin).forEach(function(dB,iB){margin[target[source.indexOf(dB.key)]]=dB.value}),r.margin=margin}reverse&&(delete r.needsEndSpacing,delete r.minorTickColor,delete r.minorTicks,delete r.angularaxis.ticksCount,delete r.angularaxis.ticksCount,delete r.angularaxis.ticksStep,delete r.angularaxis.rewriteTicks,delete r.angularaxis.nticks,delete r.radialaxis.ticksCount,delete r.radialaxis.ticksCount,delete r.radialaxis.ticksStep,delete r.radialaxis.rewriteTicks,delete r.radialaxis.nticks),outputConfig.layout=r}return outputConfig}};return exports}},{"../../../constants/alignment":665,"../../../lib":693,d3:147}],815:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../../lib"),Color=_dereq_("../../../components/color"),micropolar=_dereq_("./micropolar"),UndoManager=_dereq_("./undo_manager"),extendDeepAll=Lib.extendDeepAll,manager=module.exports={};manager.framework=function(_gd){var config,previousConfigClone,plot,convertedInput,container,undoManager=new UndoManager;function exports(_inputConfig,_container){return _container&&(container=_container),d3.select(d3.select(container).node().parentNode).selectAll(".svg-container>*:not(.chart-root)").remove(),config=config?extendDeepAll(config,_inputConfig):_inputConfig,plot||(plot=micropolar.Axis()),convertedInput=micropolar.adapter.plotly().convert(config),plot.config(convertedInput).render(container),_gd.data=config.data,_gd.layout=config.layout,manager.fillLayout(_gd),config}return exports.isPolar=!0,exports.svg=function(){return plot.svg()},exports.getConfig=function(){return config},exports.getLiveConfig=function(){return micropolar.adapter.plotly().convert(plot.getLiveConfig(),!0)},exports.getLiveScales=function(){return{t:plot.angularScale(),r:plot.radialScale()}},exports.setUndoPoint=function(){var _configClone,_previousConfigClone,that=this,configClone=micropolar.util.cloneJson(config);_configClone=configClone,_previousConfigClone=previousConfigClone,undoManager.add({undo:function(){_previousConfigClone&&that(_previousConfigClone)},redo:function(){that(_configClone)}}),previousConfigClone=micropolar.util.cloneJson(configClone)},exports.undo=function(){undoManager.undo()},exports.redo=function(){undoManager.redo()},exports},manager.fillLayout=function(_gd){var container=d3.select(_gd).selectAll(".plot-container"),paperDiv=container.selectAll(".svg-container"),paper=_gd.framework&&_gd.framework.svg&&_gd.framework.svg(),dflts={width:800,height:600,paper_bgcolor:Color.background,_container:container,_paperdiv:paperDiv,_paper:paper};_gd._fullLayout=extendDeepAll(dflts,_gd.layout)}},{"../../../components/color":567,"../../../lib":693,"./micropolar":814,"./undo_manager":816,d3:147}],816:[function(_dereq_,module,exports){"use strict";module.exports=function UndoManager(){var callback,undoCommands=[],index=-1,isExecuting=!1;function execute(command,action){return command?(isExecuting=!0,command[action](),isExecuting=!1,this):this}return{add:function(command){return isExecuting?this:(undoCommands.splice(index+1,undoCommands.length-index),undoCommands.push(command),index=undoCommands.length-1,this)},setCallback:function(callbackFunc){callback=callbackFunc},undo:function(){var command=undoCommands[index];return command?(execute(command,"undo"),index-=1,callback&&callback(command.undo),this):this},redo:function(){var command=undoCommands[index+1];return command?(execute(command,"redo"),index+=1,callback&&callback(command.redo),this):this},clear:function(){undoCommands=[],index=-1},hasUndo:function(){return-1!==index},hasRedo:function(){return index<undoCommands.length-1},getCommands:function(){return undoCommands},getPreviousCommand:function(){return undoCommands[index-1]},getIndex:function(){return index}}}},{}],817:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Plots=_dereq_("../plots"),setConvertCartesian=_dereq_("../cartesian/set_convert"),setConvertPolar=_dereq_("./set_convert"),doAutoRange=_dereq_("../cartesian/autorange").doAutoRange,doTicksSingle=_dereq_("../cartesian/axes").doTicksSingle,dragBox=_dereq_("../cartesian/dragbox"),dragElement=_dereq_("../../components/dragelement"),Fx=_dereq_("../../components/fx"),Titles=_dereq_("../../components/titles"),prepSelect=_dereq_("../cartesian/select").prepSelect,selectOnClick=_dereq_("../cartesian/select").selectOnClick,clearSelect=_dereq_("../cartesian/select").clearSelect,setCursor=_dereq_("../../lib/setcursor"),MID_SHIFT=_dereq_("../../constants/alignment").MID_SHIFT,constants=_dereq_("./constants"),helpers=_dereq_("./helpers"),_=Lib._,mod=Lib.mod,deg2rad=Lib.deg2rad,rad2deg=Lib.rad2deg;function Polar(gd,id){this.id=id,this.gd=gd,this._hasClipOnAxisFalse=null,this.vangles=null,this.radialAxisAngle=null,this.traceHash={},this.layers={},this.clipPaths={},this.clipIds={},this.viewInitial={};var fullLayout=gd._fullLayout,clipIdBase="clip"+fullLayout._uid+id;this.clipIds.forTraces=clipIdBase+"-for-traces",this.clipPaths.forTraces=fullLayout._clips.append("clipPath").attr("id",this.clipIds.forTraces),this.clipPaths.forTraces.append("path"),this.framework=fullLayout._polarlayer.append("g").attr("class",id),this.radialTickLayout=null,this.angularTickLayout=null}var proto=Polar.prototype;function strTickLayout(axLayout){var out=axLayout.ticks+String(axLayout.ticklen)+String(axLayout.showticklabels);return"side"in axLayout&&(out+=axLayout.side),out}function snapToVertexAngle(a,vangles){return vangles[Lib.findIndexOfMin(vangles,function(v){return Lib.angleDist(a,v)})]}function updateElement(sel,showAttr,attrs){return showAttr?(sel.attr("display",null),sel.attr(attrs)):sel&&sel.attr("display","none"),sel}function strTranslate(x,y){return"translate("+x+","+y+")"}function strRotate(angle){return"rotate("+angle+")"}function sign(v){return Math.abs(v)<1e-10?0:v>0?1:-1}function signCos(v){return sign(Math.cos(v))}function signSin(v){return sign(Math.sin(v))}module.exports=function createPolar(gd,id){return new Polar(gd,id)},proto.plot=function(polarCalcData,fullLayout){var polarLayout=fullLayout[this.id];this._hasClipOnAxisFalse=!1;for(var i=0;i<polarCalcData.length;i++){if(!1===polarCalcData[i][0].trace.cliponaxis){this._hasClipOnAxisFalse=!0;break}}this.updateLayers(fullLayout,polarLayout),this.updateLayout(fullLayout,polarLayout),Plots.generalUpdatePerTraceModule(this.gd,this,polarCalcData,polarLayout),this.updateFx(fullLayout,polarLayout)},proto.updateLayers=function(fullLayout,polarLayout){var layers=this.layers,radialLayout=polarLayout.radialaxis,angularLayout=polarLayout.angularaxis,layerNames=constants.layerNames,frontPlotIndex=layerNames.indexOf("frontplot"),layerData=layerNames.slice(0,frontPlotIndex),isAngularAxisBelowTraces="below traces"===angularLayout.layer,isRadialAxisBelowTraces="below traces"===radialLayout.layer;isAngularAxisBelowTraces&&layerData.push("angular-line"),isRadialAxisBelowTraces&&layerData.push("radial-line"),isAngularAxisBelowTraces&&layerData.push("angular-axis"),isRadialAxisBelowTraces&&layerData.push("radial-axis"),layerData.push("frontplot"),isAngularAxisBelowTraces||layerData.push("angular-line"),isRadialAxisBelowTraces||layerData.push("radial-line"),isAngularAxisBelowTraces||layerData.push("angular-axis"),isRadialAxisBelowTraces||layerData.push("radial-axis");var join=this.framework.selectAll(".polarsublayer").data(layerData,String);join.enter().append("g").attr("class",function(d){return"polarsublayer "+d}).each(function(d){var sel=layers[d]=d3.select(this);switch(d){case"frontplot":sel.append("g").classed("barlayer",!0),sel.append("g").classed("scatterlayer",!0);break;case"backplot":sel.append("g").classed("maplayer",!0);break;case"plotbg":layers.bg=sel.append("path");break;case"radial-grid":sel.style("fill","none"),sel.append("g").classed("x",1);break;case"angular-grid":sel.style("fill","none"),sel.append("g").classed("angularaxis",1);break;case"radial-line":sel.append("line").style("fill","none");break;case"angular-line":sel.append("path").style("fill","none")}}),join.order()},proto.updateLayout=function(fullLayout,polarLayout){var layers=this.layers,gs=fullLayout._size,radialLayout=polarLayout.radialaxis,angularLayout=polarLayout.angularaxis,xDomain=polarLayout.domain.x,yDomain=polarLayout.domain.y;this.xOffset=gs.l+gs.w*xDomain[0],this.yOffset=gs.t+gs.h*(1-yDomain[1]);var xLength=this.xLength=gs.w*(xDomain[1]-xDomain[0]),yLength=this.yLength=gs.h*(yDomain[1]-yDomain[0]),sector=polarLayout.sector;this.sectorInRad=sector.map(deg2rad);var xLength2,yLength2,xDomain2,yDomain2,gap,sectorBBox=this.sectorBBox=function computeSectorBBox(sector){var x0,y0,x1,y1,s0=sector[0],arc=sector[1]-s0,a0=mod(s0,360),a1=a0+arc,ax0=Math.cos(deg2rad(a0)),ay0=Math.sin(deg2rad(a0)),ax1=Math.cos(deg2rad(a1)),ay1=Math.sin(deg2rad(a1));y1=a0<=90&&a1>=90||a0>90&&a1>=450?1:ay0<=0&&ay1<=0?0:Math.max(ay0,ay1);x0=a0<=180&&a1>=180||a0>180&&a1>=540?-1:ax0>=0&&ax1>=0?0:Math.min(ax0,ax1);y0=a0<=270&&a1>=270||a0>270&&a1>=630?-1:ay0>=0&&ay1>=0?0:Math.min(ay0,ay1);x1=a1>=360?1:ax0<=0&&ax1<=0?0:Math.max(ax0,ax1);return[x0,y0,x1,y1]}(sector),dxSectorBBox=sectorBBox[2]-sectorBBox[0],dySectorBBox=sectorBBox[3]-sectorBBox[1],arDomain=yLength/xLength,arSector=Math.abs(dySectorBBox/dxSectorBBox);arDomain>arSector?(xLength2=xLength,gap=(yLength-(yLength2=xLength*arSector))/gs.h/2,xDomain2=[xDomain[0],xDomain[1]],yDomain2=[yDomain[0]+gap,yDomain[1]-gap]):(yLength2=yLength,gap=(xLength-(xLength2=yLength/arSector))/gs.w/2,xDomain2=[xDomain[0]+gap,xDomain[1]-gap],yDomain2=[yDomain[0],yDomain[1]]),this.xLength2=xLength2,this.yLength2=yLength2,this.xDomain2=xDomain2,this.yDomain2=yDomain2;var xOffset2=this.xOffset2=gs.l+gs.w*xDomain2[0],yOffset2=this.yOffset2=gs.t+gs.h*(1-yDomain2[1]),radius=this.radius=xLength2/dxSectorBBox,innerRadius=this.innerRadius=polarLayout.hole*radius,cx=this.cx=xOffset2-radius*sectorBBox[0],cy=this.cy=yOffset2+radius*sectorBBox[3],cxx=this.cxx=cx-xOffset2,cyy=this.cyy=cy-yOffset2;this.radialAxis=this.mockAxis(fullLayout,polarLayout,radialLayout,{_axislayer:layers["radial-axis"],_gridlayer:layers["radial-grid"],_id:"x",side:{counterclockwise:"top",clockwise:"bottom"}[radialLayout.side],domain:[innerRadius/gs.w,radius/gs.w]}),this.angularAxis=this.mockAxis(fullLayout,polarLayout,angularLayout,{_axislayer:layers["angular-axis"],_gridlayer:layers["angular-grid"],side:"right",domain:[0,Math.PI],autorange:!1}),this.doAutoRange(fullLayout,polarLayout),this.updateAngularAxis(fullLayout,polarLayout),this.updateRadialAxis(fullLayout,polarLayout),this.updateRadialAxisTitle(fullLayout,polarLayout),this.xaxis=this.mockCartesianAxis(fullLayout,polarLayout,{_id:"x",domain:xDomain2}),this.yaxis=this.mockCartesianAxis(fullLayout,polarLayout,{_id:"y",domain:yDomain2});var dPath=this.pathSubplot();this.clipPaths.forTraces.select("path").attr("d",dPath).attr("transform",strTranslate(cxx,cyy)),layers.frontplot.attr("transform",strTranslate(xOffset2,yOffset2)).call(Drawing.setClipUrl,this._hasClipOnAxisFalse?null:this.clipIds.forTraces),layers.bg.attr("d",dPath).attr("transform",strTranslate(cx,cy)).call(Color.fill,polarLayout.bgcolor),this.framework.selectAll(".crisp").classed("crisp",0)},proto.mockAxis=function(fullLayout,polarLayout,axLayout,opts){var ax=Lib.extendFlat({anchor:"free",position:0,_pos:0,_counteraxis:!0,automargin:!1},axLayout,opts);return setConvertPolar(ax,polarLayout,fullLayout),ax},proto.mockCartesianAxis=function(fullLayout,polarLayout,opts){var _this=this,axId=opts._id,ax=Lib.extendFlat({type:"linear"},opts);setConvertCartesian(ax,fullLayout);var bboxIndices={x:[0,2],y:[1,3]};return ax.setRange=function(){var sectorBBox=_this.sectorBBox,ind=bboxIndices[axId],rl=_this.radialAxis._rl,drl=(rl[1]-rl[0])/(1-polarLayout.hole);ax.range=[sectorBBox[ind[0]]*drl,sectorBBox[ind[1]]*drl]},ax.isPtWithinRange="x"===axId?function(d){return _this.isPtInside(d)}:function(){return!0},ax.setRange(),ax.setScale(),ax},proto.doAutoRange=function(fullLayout,polarLayout){var gd=this.gd,radialAxis=this.radialAxis,radialLayout=polarLayout.radialaxis;radialAxis.setScale(),doAutoRange(gd,radialAxis);var rng=radialAxis.range;radialLayout.range=rng.slice(),radialLayout._input.range=rng.slice(),radialAxis._rl=[radialAxis.r2l(rng[0],null,"gregorian"),radialAxis.r2l(rng[1],null,"gregorian")]},proto.updateRadialAxis=function(fullLayout,polarLayout){var _this=this,gd=_this.gd,layers=_this.layers,radius=_this.radius,innerRadius=_this.innerRadius,cx=_this.cx,cy=_this.cy,radialLayout=polarLayout.radialaxis,a0=mod(polarLayout.sector[0],360),ax=_this.radialAxis,hasRoomForIt=innerRadius<radius;_this.fillViewInitialKey("radialaxis.angle",radialLayout.angle),_this.fillViewInitialKey("radialaxis.range",ax.range.slice()),ax.setGeometry(),"auto"===ax.tickangle&&a0>90&&a0<=270&&(ax.tickangle=180),ax._transfn=function(d){return"translate("+(ax.l2p(d.x)+innerRadius)+",0)"},ax._gridpath=function(d){return _this.pathArc(ax.r2p(d.x)+innerRadius)};var newTickLayout=strTickLayout(radialLayout);_this.radialTickLayout!==newTickLayout&&(layers["radial-axis"].selectAll(".xtick").remove(),_this.radialTickLayout=newTickLayout),hasRoomForIt&&(ax.setScale(),doTicksSingle(gd,ax,!0));var angle=_this.radialAxisAngle=_this.vangles?rad2deg(snapToVertexAngle(deg2rad(radialLayout.angle),_this.vangles)):radialLayout.angle,trans=strTranslate(cx,cy)+strRotate(-angle);updateElement(layers["radial-axis"],hasRoomForIt&&(radialLayout.showticklabels||radialLayout.ticks),{transform:trans}),updateElement(layers["radial-grid"],hasRoomForIt&&radialLayout.showgrid,{transform:strTranslate(cx,cy)}).selectAll("path").attr("transform",null),updateElement(layers["radial-line"].select("line"),hasRoomForIt&&radialLayout.showline,{x1:innerRadius,y1:0,x2:radius,y2:0,transform:trans}).attr("stroke-width",radialLayout.linewidth).call(Color.stroke,radialLayout.linecolor)},proto.updateRadialAxisTitle=function(fullLayout,polarLayout,_angle){var gd=this.gd,radius=this.radius,cx=this.cx,cy=this.cy,radialLayout=polarLayout.radialaxis,titleClass=this.id+"title",angle=void 0!==_angle?_angle:this.radialAxisAngle,angleRad=deg2rad(angle),cosa=Math.cos(angleRad),sina=Math.sin(angleRad),pad=0;if(radialLayout.title){var h=Drawing.bBox(this.layers["radial-axis"].node()).height,ts=radialLayout.titlefont.size;pad="counterclockwise"===radialLayout.side?-h-.4*ts:h+.8*ts}this.layers["radial-axis-title"]=Titles.draw(gd,titleClass,{propContainer:radialLayout,propName:this.id+".radialaxis.title",placeholder:_(gd,"Click to enter radial axis title"),attributes:{x:cx+radius/2*cosa+pad*sina,y:cy-radius/2*sina+pad*cosa,"text-anchor":"middle"},transform:{rotate:-angle}})},proto.updateAngularAxis=function(fullLayout,polarLayout){var _this=this,gd=_this.gd,layers=_this.layers,radius=_this.radius,innerRadius=_this.innerRadius,cx=_this.cx,cy=_this.cy,angularLayout=polarLayout.angularaxis,ax=_this.angularAxis;_this.fillViewInitialKey("angularaxis.rotation",angularLayout.rotation),ax.setGeometry();var t2g=function(d){return ax.t2g(d.x)};"linear"===ax.type&&"radians"===ax.thetaunit&&(ax.tick0=rad2deg(ax.tick0),ax.dtick=rad2deg(ax.dtick)),"category"===ax.type&&(ax._tickFilter=function(d){return Lib.isAngleInsideSector(t2g(d),_this.sectorInRad)}),ax._transfn=function(d){var sel=d3.select(this),hasElement=sel&&sel.node();if(hasElement&&sel.classed("angularaxisgrid"))return"";var rad=t2g(d),out=strTranslate(cx+radius*Math.cos(rad),cy-radius*Math.sin(rad));return hasElement&&sel.classed("ticks")&&(out+=strRotate(-rad2deg(rad))),out},ax._gridpath=function(d){var rad=t2g(d),cosRad=Math.cos(rad),sinRad=Math.sin(rad);return"M"+[cx+innerRadius*cosRad,cy-innerRadius*sinRad]+"L"+[cx+radius*cosRad,cy-radius*sinRad]};var offset4fontsize="outside"!==angularLayout.ticks?.7:.5;ax._labelx=function(d){var rad=t2g(d),labelStandoff=ax._labelStandoff,pad=ax._pad;return(0===signSin(rad)?0:Math.cos(rad)*(labelStandoff+pad+offset4fontsize*d.fontSize))+signCos(rad)*(d.dx+labelStandoff+pad)},ax._labely=function(d){var rad=t2g(d),labelStandoff=ax._labelStandoff,labelShift=ax._labelShift,pad=ax._pad;return d.dy+d.fontSize*MID_SHIFT-labelShift+-Math.sin(rad)*(labelStandoff+pad+offset4fontsize*d.fontSize)},ax._labelanchor=function(angle,d){var rad=t2g(d);return 0===signSin(rad)?signCos(rad)>0?"start":"end":"middle"};var vangles,newTickLayout=strTickLayout(angularLayout);_this.angularTickLayout!==newTickLayout&&(layers["angular-axis"].selectAll("."+ax._id+"tick").remove(),_this.angularTickLayout=newTickLayout),ax.setScale(),doTicksSingle(gd,ax,!0),"linear"===polarLayout.gridshape?(vangles=ax._vals.map(t2g),Lib.angleDelta(vangles[0],vangles[1])<0&&(vangles=vangles.slice().reverse())):vangles=null,_this.vangles=vangles,updateElement(layers["angular-line"].select("path"),angularLayout.showline,{d:_this.pathSubplot(),transform:strTranslate(cx,cy)}).attr("stroke-width",angularLayout.linewidth).call(Color.stroke,angularLayout.linecolor)},proto.updateFx=function(fullLayout,polarLayout){this.gd._context.staticPlot||(this.updateAngularDrag(fullLayout),this.updateRadialDrag(fullLayout,polarLayout,0),this.updateRadialDrag(fullLayout,polarLayout,1),this.updateMainDrag(fullLayout))},proto.updateMainDrag=function(fullLayout){var _this=this,gd=_this.gd,layers=_this.layers,zoomlayer=fullLayout._zoomlayer,MINZOOM=constants.MINZOOM,OFFEDGE=constants.OFFEDGE,radius=_this.radius,innerRadius=_this.innerRadius,cx=_this.cx,cy=_this.cy,cxx=_this.cxx,cyy=_this.cyy,sectorInRad=_this.sectorInRad,vangles=_this.vangles,radialAxis=_this.radialAxis,clampTiny=helpers.clampTiny,findXYatLength=helpers.findXYatLength,findEnclosingVertexAngles=helpers.findEnclosingVertexAngles,chw=constants.cornerHalfWidth,chl=constants.cornerLen/2,mainDrag=dragBox.makeDragger(layers,"path","maindrag","crosshair");d3.select(mainDrag).attr("d",_this.pathSubplot()).attr("transform",strTranslate(cx,cy));var x0,y0,r0,r1,path0,dimmed,lum,zb,corners,dragOpts={element:mainDrag,gd:gd,subplot:_this.id,plotinfo:{id:_this.id,xaxis:_this.xaxis,yaxis:_this.yaxis},xaxes:[_this.xaxis],yaxes:[_this.yaxis]};function norm(x,y){return Math.sqrt(x*x+y*y)}function xy2r(x,y){return norm(x-cxx,y-cyy)}function xy2a(x,y){return Math.atan2(cyy-y,x-cxx)}function ra2xy(r,a){return[r*Math.cos(a),r*Math.sin(-a)]}function pathCorner(r,a){if(0===r)return _this.pathSector(2*chw);var da=chl/r,am=a-da,ap=a+da,rb=Math.max(0,Math.min(r,radius)),rm=rb-chw,rp=rb+chw;return"M"+ra2xy(rm,am)+"A"+[rm,rm]+" 0,0,0 "+ra2xy(rm,ap)+"L"+ra2xy(rp,ap)+"A"+[rp,rp]+" 0,0,1 "+ra2xy(rp,am)+"Z"}function pathCornerForPolygons(r,va0,va1){if(0===r)return _this.pathSector(2*chw);var innerPts,outerPts,xy0=ra2xy(r,va0),xy1=ra2xy(r,va1),x=clampTiny((xy0[0]+xy1[0])/2),y=clampTiny((xy0[1]+xy1[1])/2);if(x&&y){var m=y/x,mperp=-1/m,midPts=findXYatLength(chw,m,x,y);innerPts=findXYatLength(chl,mperp,midPts[0][0],midPts[0][1]),outerPts=findXYatLength(chl,mperp,midPts[1][0],midPts[1][1])}else{var dx,dy;y?(dx=chl,dy=chw):(dx=chw,dy=chl),innerPts=[[x-dx,y-dy],[x+dx,y-dy]],outerPts=[[x-dx,y+dy],[x+dx,y+dy]]}return"M"+innerPts.join("L")+"L"+outerPts.reverse().join("L")+"Z"}function clampAndSetR0R1(rr0,rr1){return rr1=Math.max(Math.min(rr1,radius),innerRadius),rr0<OFFEDGE?rr0=0:radius-rr0<OFFEDGE?rr0=radius:rr1<OFFEDGE?rr1=0:radius-rr1<OFFEDGE&&(rr1=radius),Math.abs(rr1-rr0)>MINZOOM?(rr0<rr1?(r0=rr0,r1=rr1):(r0=rr1,r1=rr0),!0):(r0=null,r1=null,!1)}function applyZoomMove(path1,cpath){path1=path1||path0,cpath=cpath||"M0,0Z",zb.attr("d",path1),corners.attr("d",cpath),dragBox.transitionZoombox(zb,corners,dimmed,lum),dimmed=!0}function zoomMove(dx,dy){var path1,cpath,x1=x0+dx,y1=y0+dy,rr0=xy2r(x0,y0),rr1=Math.min(xy2r(x1,y1),radius),a0=xy2a(x0,y0);clampAndSetR0R1(rr0,rr1)&&(path1=path0+_this.pathSector(r1),r0&&(path1+=_this.pathSector(r0)),cpath=pathCorner(r0,a0)+pathCorner(r1,a0)),applyZoomMove(path1,cpath)}function findPolygonRadius(x,y,va0,va1){var xy=helpers.findIntersectionXY(va0,va1,va0,[x-cxx,cyy-y]);return norm(xy[0],xy[1])}function zoomMoveForPolygons(dx,dy){var path1,cpath,x1=x0+dx,y1=y0+dy,a0=xy2a(x0,y0),a1=xy2a(x1,y1),vangles0=findEnclosingVertexAngles(a0,vangles),vangles1=findEnclosingVertexAngles(a1,vangles);clampAndSetR0R1(findPolygonRadius(x0,y0,vangles0[0],vangles0[1]),Math.min(findPolygonRadius(x1,y1,vangles1[0],vangles1[1]),radius))&&(path1=path0+_this.pathSector(r1),r0&&(path1+=_this.pathSector(r0)),cpath=[pathCornerForPolygons(r0,vangles0[0],vangles0[1]),pathCornerForPolygons(r1,vangles0[0],vangles0[1])].join(" ")),applyZoomMove(path1,cpath)}function zoomDone(){if(dragBox.removeZoombox(gd),null!==r0&&null!==r1){dragBox.showDoubleClickNotifier(gd);var rl=radialAxis._rl,m=(rl[1]-rl[0])/(1-innerRadius/radius)/radius,newRng=[rl[0]+(r0-innerRadius)*m,rl[0]+(r1-innerRadius)*m];Registry.call("relayout",gd,_this.id+".radialaxis.range",newRng)}}function zoomClick(numClicks,evt){var clickMode=gd._fullLayout.clickmode;if(dragBox.removeZoombox(gd),2===numClicks){var updateObj={};for(var k in _this.viewInitial)updateObj[_this.id+"."+k]=_this.viewInitial[k];gd.emit("plotly_doubleclick",null),Registry.call("relayout",gd,updateObj)}clickMode.indexOf("select")>-1&&1===numClicks&&selectOnClick(evt,gd,[_this.xaxis],[_this.yaxis],_this.id,dragOpts),clickMode.indexOf("event")>-1&&Fx.click(gd,evt,_this.id)}dragOpts.prepFn=function(evt,startX,startY){var dragModeNow=gd._fullLayout.dragmode,bbox=mainDrag.getBoundingClientRect();if(x0=startX-bbox.left,y0=startY-bbox.top,vangles){var offset=helpers.findPolygonOffset(radius,sectorInRad[0],sectorInRad[1],vangles);x0+=cxx+offset[0],y0+=cyy+offset[1]}switch(dragModeNow){case"zoom":dragOpts.moveFn=vangles?zoomMoveForPolygons:zoomMove,dragOpts.clickFn=zoomClick,dragOpts.doneFn=zoomDone,function zoomPrep(){r0=null,r1=null,path0=_this.pathSubplot(),dimmed=!1;var polarLayoutNow=gd._fullLayout[_this.id];lum=tinycolor(polarLayoutNow.bgcolor).getLuminance(),(zb=dragBox.makeZoombox(zoomlayer,lum,cx,cy,path0)).attr("fill-rule","evenodd"),corners=dragBox.makeCorners(zoomlayer,cx,cy),clearSelect(zoomlayer)}();break;case"select":case"lasso":prepSelect(evt,startX,startY,dragOpts,dragModeNow)}},mainDrag.onmousemove=function(evt){Fx.hover(gd,evt,_this.id),gd._fullLayout._lasthover=mainDrag,gd._fullLayout._hoversubplot=_this.id},mainDrag.onmouseout=function(evt){gd._dragging||dragElement.unhover(gd,evt)},dragElement.init(dragOpts)},proto.updateRadialDrag=function(fullLayout,polarLayout,rngIndex){var _this=this,gd=_this.gd,layers=_this.layers,radius=_this.radius,innerRadius=_this.innerRadius,cx=_this.cx,cy=_this.cy,radialAxis=_this.radialAxis,bl=constants.radialDragBoxSize,bl2=bl/2;if(radialAxis.visible){var tx,ty,className,angle0=deg2rad(_this.radialAxisAngle),rl=radialAxis._rl,rl0=rl[0],rl1=rl[1],rbase=rl[rngIndex],m=.75*(rl[1]-rl[0])/(1-polarLayout.hole)/radius;rngIndex?(tx=cx+(radius+bl2)*Math.cos(angle0),ty=cy-(radius+bl2)*Math.sin(angle0),className="radialdrag"):(tx=cx+(innerRadius-bl2)*Math.cos(angle0),ty=cy-(innerRadius-bl2)*Math.sin(angle0),className="radialdrag-inner");var moveFn2,angle1,rprime,radialDrag=dragBox.makeRectDragger(layers,className,"crosshair",-bl2,-bl2,bl,bl),dragOpts={element:radialDrag,gd:gd};updateElement(d3.select(radialDrag),radialAxis.visible&&innerRadius<radius,{transform:strTranslate(tx,ty)}),dragOpts.prepFn=function(){moveFn2=null,angle1=null,rprime=null,dragOpts.moveFn=moveFn,dragOpts.doneFn=doneFn,clearSelect(fullLayout._zoomlayer)},dragOpts.clampFn=function(dx,dy){return Math.sqrt(dx*dx+dy*dy)<constants.MINDRAG&&(dx=0,dy=0),[dx,dy]},dragElement.init(dragOpts)}function moveFn(dx,dy){if(moveFn2)moveFn2(dx,dy);else{var dvec=[dx,-dy],rvec=[Math.cos(angle0),Math.sin(angle0)],comp=Math.abs(Lib.dot(dvec,rvec)/Math.sqrt(Lib.dot(dvec,dvec)));isNaN(comp)||(moveFn2=comp<.5?rotateMove:rerangeMove)}}function doneFn(){null!==angle1?Registry.call("relayout",gd,_this.id+".radialaxis.angle",angle1):null!==rprime&&Registry.call("relayout",gd,_this.id+".radialaxis.range["+rngIndex+"]",rprime)}function rotateMove(dx,dy){if(0!==rngIndex){var x1=tx+dx,y1=ty+dy;angle1=Math.atan2(cy-y1,x1-cx),_this.vangles&&(angle1=snapToVertexAngle(angle1,_this.vangles)),angle1=rad2deg(angle1);var transform=strTranslate(cx,cy)+strRotate(-angle1);layers["radial-axis"].attr("transform",transform),layers["radial-line"].select("line").attr("transform",transform);var fullLayoutNow=_this.gd._fullLayout,polarLayoutNow=fullLayoutNow[_this.id];_this.updateRadialAxisTitle(fullLayoutNow,polarLayoutNow,angle1)}}function rerangeMove(dx,dy){var dr=Lib.dot([dx,-dy],[Math.cos(angle0),Math.sin(angle0)]);if(rprime=rbase-m*dr,m>0==(rngIndex?rprime>rl0:rprime<rl1))for(var traceType in radialAxis.range[rngIndex]=rprime,radialAxis._rl[rngIndex]=rprime,radialAxis.setGeometry(),radialAxis.setScale(),_this.xaxis.setRange(),_this.xaxis.setScale(),_this.yaxis.setRange(),_this.yaxis.setScale(),doTicksSingle(gd,radialAxis,!0),layers["radial-grid"].attr("transform",strTranslate(cx,cy)).selectAll("path").attr("transform",null),_this._scene&&_this._scene.clear(),_this.traceHash){var moduleCalcData=_this.traceHash[traceType],moduleCalcDataVisible=Lib.filterVisible(moduleCalcData),_module=moduleCalcData[0][0].trace._module,polarLayoutNow=gd._fullLayout[_this.id];_module.plot(gd,_this,moduleCalcDataVisible,polarLayoutNow)}else rprime=null}},proto.updateAngularDrag=function(fullLayout){var _this=this,gd=_this.gd,layers=_this.layers,radius=_this.radius,angularAxis=_this.angularAxis,cx=_this.cx,cy=_this.cy,cxx=_this.cxx,cyy=_this.cyy,dbs=constants.angularDragBoxSize,angularDrag=dragBox.makeDragger(layers,"path","angulardrag","move"),dragOpts={element:angularDrag,gd:gd};function xy2a(x,y){return Math.atan2(cyy+dbs-y,x-cxx-dbs)}d3.select(angularDrag).attr("d",_this.pathAnnulus(radius,radius+dbs)).attr("transform",strTranslate(cx,cy)).call(setCursor,"move");var x0,y0,rot0,rot1,rrot1,a0,scatterTraces=layers.frontplot.select(".scatterlayer").selectAll(".trace"),scatterPoints=scatterTraces.selectAll(".point"),scatterTextPoints=scatterTraces.selectAll(".textpoint");function moveFn(dx,dy){var fullLayoutNow=_this.gd._fullLayout,polarLayoutNow=fullLayoutNow[_this.id],a1=xy2a(x0+dx,y0+dy),da=rad2deg(a1-a0);if(rot1=rot0+da,layers.frontplot.attr("transform",strTranslate(_this.xOffset2,_this.yOffset2)+strRotate([-da,cxx,cyy])),_this.vangles){rrot1=_this.radialAxisAngle+da;var trans=strTranslate(cx,cy)+strRotate(-da),trans2=strTranslate(cx,cy)+strRotate(-rrot1);layers.bg.attr("transform",trans),layers["radial-grid"].attr("transform",trans),layers["angular-line"].select("path").attr("transform",trans),layers["radial-axis"].attr("transform",trans2),layers["radial-line"].select("line").attr("transform",trans2),_this.updateRadialAxisTitle(fullLayoutNow,polarLayoutNow,rrot1)}else _this.clipPaths.forTraces.select("path").attr("transform",strTranslate(cxx,cyy)+strRotate(da));for(var traceType in scatterPoints.each(function(){var sel=d3.select(this),xy=Drawing.getTranslate(sel);sel.attr("transform",strTranslate(xy.x,xy.y)+strRotate([da]))}),scatterTextPoints.each(function(){var sel=d3.select(this),tx=sel.select("text"),xy=Drawing.getTranslate(sel);sel.attr("transform",strRotate([da,tx.attr("x"),tx.attr("y")])+strTranslate(xy.x,xy.y))}),angularAxis.rotation=Lib.modHalf(rot1,360),angularAxis.setGeometry(),angularAxis.setScale(),doTicksSingle(gd,angularAxis,!0),_this._hasClipOnAxisFalse&&!Lib.isFullCircle(_this.sectorInRad)&&scatterTraces.call(Drawing.hideOutsideRangePoints,_this),_this._scene&&_this._scene.clear(),_this.traceHash)if(Registry.traceIs(traceType,"gl")){var moduleCalcData=_this.traceHash[traceType],moduleCalcDataVisible=Lib.filterVisible(moduleCalcData);moduleCalcData[0][0].trace._module.plot(gd,_this,moduleCalcDataVisible,polarLayoutNow)}}function doneFn(){scatterTextPoints.select("text").attr("transform",null);var updateObj={};updateObj[_this.id+".angularaxis.rotation"]=rot1,_this.vangles&&(updateObj[_this.id+".radialaxis.angle"]=rrot1),Registry.call("relayout",gd,updateObj)}dragOpts.prepFn=function(evt,startX,startY){var polarLayoutNow=fullLayout[_this.id];rot0=polarLayoutNow.angularaxis.rotation;var bbox=angularDrag.getBoundingClientRect();x0=startX-bbox.left,y0=startY-bbox.top,a0=xy2a(x0,y0),dragOpts.moveFn=moveFn,dragOpts.doneFn=doneFn,clearSelect(fullLayout._zoomlayer)},_this.vangles&&!Lib.isFullCircle(_this.sectorInRad)&&(dragOpts.prepFn=Lib.noop,setCursor(d3.select(angularDrag),null)),dragElement.init(dragOpts)},proto.isPtInside=function(d){var sectorInRad=this.sectorInRad,vangles=this.vangles,thetag=this.angularAxis.c2g(d.theta),radialAxis=this.radialAxis,r=radialAxis.c2l(d.r),rl=radialAxis._rl;return(vangles?helpers.isPtInsidePolygon:Lib.isPtInsideSector)(r,thetag,rl,sectorInRad,vangles)},proto.pathArc=function(r){var sectorInRad=this.sectorInRad,vangles=this.vangles;return(vangles?helpers.pathPolygon:Lib.pathArc)(r,sectorInRad[0],sectorInRad[1],vangles)},proto.pathSector=function(r){var sectorInRad=this.sectorInRad,vangles=this.vangles;return(vangles?helpers.pathPolygon:Lib.pathSector)(r,sectorInRad[0],sectorInRad[1],vangles)},proto.pathAnnulus=function(r0,r1){var sectorInRad=this.sectorInRad,vangles=this.vangles;return(vangles?helpers.pathPolygonAnnulus:Lib.pathAnnulus)(r0,r1,sectorInRad[0],sectorInRad[1],vangles)},proto.pathSubplot=function(){var r0=this.innerRadius,r1=this.radius;return r0?this.pathAnnulus(r0,r1):this.pathSector(r1)},proto.fillViewInitialKey=function(key,val){key in this.viewInitial||(this.viewInitial[key]=val)}},{"../../components/color":567,"../../components/dragelement":589,"../../components/drawing":592,"../../components/fx":609,"../../components/titles":658,"../../constants/alignment":665,"../../lib":693,"../../lib/setcursor":714,"../../registry":825,"../cartesian/autorange":741,"../cartesian/axes":742,"../cartesian/dragbox":750,"../cartesian/select":759,"../cartesian/set_convert":760,"../plots":805,"./constants":806,"./helpers":807,"./set_convert":818,d3:147,tinycolor2:511}],818:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),setConvertCartesian=_dereq_("../cartesian/set_convert"),deg2rad=Lib.deg2rad,rad2deg=Lib.rad2deg;module.exports=function setConvert(ax,polarLayout,fullLayout){switch(setConvertCartesian(ax,fullLayout),ax._id){case"x":case"radialaxis":!function setConvertRadial(ax,polarLayout){var subplot=polarLayout._subplot;ax.setGeometry=function(){var rl0=ax._rl[0],rl1=ax._rl[1],b=subplot.innerRadius,m=(subplot.radius-b)/(rl1-rl0),b2=b/m,rFilter=rl0>rl1?function(v){return v<=0}:function(v){return v>=0};ax.c2g=function(v){var r=ax.c2l(v)-rl0;return(rFilter(r)?r:0)+b2},ax.g2c=function(v){return ax.l2c(v+rl0-b2)},ax.g2p=function(v){return v*m},ax.c2p=function(v){return ax.g2p(ax.c2g(v))}}}(ax,polarLayout);break;case"angularaxis":!function setConvertAngular(ax,polarLayout){var axType=ax.type;if("linear"===axType){var _d2c=ax.d2c,_c2d=ax.c2d;ax.d2c=function(v,unit){return function toRadians(v,unit){return"degrees"===unit?deg2rad(v):v}(_d2c(v),unit)},ax.c2d=function(v,unit){return _c2d(function fromRadians(v,unit){return"degrees"===unit?rad2deg(v):v}(v,unit))}}ax.makeCalcdata=function(trace,coord){var arrayOut,i,arrayIn=trace[coord],len=trace._length,_d2c=function(v){return ax.d2c(v,trace.thetaunit)};if(arrayIn){if(Lib.isTypedArray(arrayIn)&&"linear"===axType){if(len===arrayIn.length)return arrayIn;if(arrayIn.subarray)return arrayIn.subarray(0,len)}for(arrayOut=new Array(len),i=0;i<len;i++)arrayOut[i]=_d2c(arrayIn[i])}else{var coord0=coord+"0",dcoord="d"+coord,v0=coord0 in trace?_d2c(trace[coord0]):0,dv=trace[dcoord]?_d2c(trace[dcoord]):(ax.period||2*Math.PI)/len;for(arrayOut=new Array(len),i=0;i<len;i++)arrayOut[i]=v0+i*dv}return arrayOut},ax.setGeometry=function(){var rad2c,c2rad,rad2t,t2rad,sector=polarLayout.sector,sectorInRad=sector.map(deg2rad),dir={clockwise:-1,counterclockwise:1}[ax.direction],rot=deg2rad(ax.rotation),rad2g=function(v){return dir*v+rot},g2rad=function(v){return(v-rot)/dir};switch(axType){case"linear":c2rad=rad2c=Lib.identity,t2rad=deg2rad,rad2t=rad2deg,ax.range=Lib.isFullCircle(sectorInRad)?[sector[0],sector[0]+360]:sectorInRad.map(g2rad).map(rad2deg);break;case"category":var catLen=ax._categories.length,_period=ax.period?Math.max(ax.period,catLen):catLen;c2rad=t2rad=function(v){return 2*v*Math.PI/_period},rad2c=rad2t=function(v){return v*_period/Math.PI/2},ax.range=[0,_period]}ax.c2g=function(v){return rad2g(c2rad(v))},ax.g2c=function(v){return rad2c(g2rad(v))},ax.t2g=function(v){return rad2g(t2rad(v))},ax.g2t=function(v){return rad2t(g2rad(v))}}}(ax,polarLayout)}}},{"../../lib":693,"../cartesian/set_convert":760}],819:[function(_dereq_,module,exports){"use strict";function sortModules(a,b){return"splom"===a?-1:"splom"===b?1:0}module.exports={sortBasePlotModules:function sortBasePlotModules(a,b){return sortModules(a.name,b.name)},sortModules:sortModules}},{}],820:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),Template=_dereq_("../plot_api/plot_template"),handleDomainDefaults=_dereq_("./domain").defaults;module.exports=function handleSubplotDefaults(layoutIn,layoutOut,fullData,opts){var subplotLayoutIn,subplotLayoutOut,subplotType=opts.type,subplotAttributes=opts.attributes,handleDefaults=opts.handleDefaults,partition=opts.partition||"x",ids=layoutOut._subplots[subplotType],idsLength=ids.length,baseId=idsLength&&ids[0].replace(/\d+$/,"");function coerce(attr,dflt){return Lib.coerce(subplotLayoutIn,subplotLayoutOut,subplotAttributes,attr,dflt)}for(var i=0;i<idsLength;i++){var id=ids[i];subplotLayoutIn=layoutIn[id]?layoutIn[id]:layoutIn[id]={},subplotLayoutOut=Template.newContainer(layoutOut,id,baseId);var dfltDomains={};dfltDomains[partition]=[i/idsLength,(i+1)/idsLength],handleDomainDefaults(subplotLayoutOut,layoutOut,coerce,dfltDomains),opts.id=id,handleDefaults(subplotLayoutIn,subplotLayoutOut,coerce,opts)}}},{"../lib":693,"../plot_api/plot_template":732,"./domain":767}],821:[function(_dereq_,module,exports){"use strict";var Ternary=_dereq_("./ternary"),getSubplotCalcData=_dereq_("../../plots/get_data").getSubplotCalcData,counterRegex=_dereq_("../../lib").counterRegex;exports.name="ternary";var attr=exports.attr="subplot";exports.idRoot="ternary",exports.idRegex=exports.attrRegex=counterRegex("ternary"),(exports.attributes={})[attr]={valType:"subplotid",dflt:"ternary",editType:"calc"},exports.layoutAttributes=_dereq_("./layout_attributes"),exports.supplyLayoutDefaults=_dereq_("./layout_defaults"),exports.plot=function plotTernary(gd){for(var fullLayout=gd._fullLayout,calcData=gd.calcdata,ternaryIds=fullLayout._subplots.ternary,i=0;i<ternaryIds.length;i++){var ternaryId=ternaryIds[i],ternaryCalcData=getSubplotCalcData(calcData,"ternary",ternaryId),ternary=fullLayout[ternaryId]._subplot;ternary||(ternary=new Ternary({id:ternaryId,graphDiv:gd,container:fullLayout._ternarylayer.node()},fullLayout),fullLayout[ternaryId]._subplot=ternary),ternary.plot(ternaryCalcData,fullLayout,gd._promises)}},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){for(var oldTernaryKeys=oldFullLayout._subplots.ternary||[],i=0;i<oldTernaryKeys.length;i++){var oldTernaryKey=oldTernaryKeys[i],oldTernary=oldFullLayout[oldTernaryKey]._subplot;!newFullLayout[oldTernaryKey]&&oldTernary&&(oldTernary.plotContainer.remove(),oldTernary.clipDef.remove(),oldTernary.clipDefRelative.remove(),oldTernary.layers["a-title"].remove(),oldTernary.layers["b-title"].remove(),oldTernary.layers["c-title"].remove())}}},{"../../lib":693,"../../plots/get_data":778,"./layout_attributes":822,"./layout_defaults":823,"./ternary":824}],822:[function(_dereq_,module,exports){"use strict";var colorAttrs=_dereq_("../../components/color/attributes"),domainAttrs=_dereq_("../domain").attributes,axesAttrs=_dereq_("../cartesian/layout_attributes"),overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,extendFlat=_dereq_("../../lib/extend").extendFlat,ternaryAxesAttrs={title:axesAttrs.title,titlefont:axesAttrs.titlefont,color:axesAttrs.color,tickmode:axesAttrs.tickmode,nticks:extendFlat({},axesAttrs.nticks,{dflt:6,min:1}),tick0:axesAttrs.tick0,dtick:axesAttrs.dtick,tickvals:axesAttrs.tickvals,ticktext:axesAttrs.ticktext,ticks:axesAttrs.ticks,ticklen:axesAttrs.ticklen,tickwidth:axesAttrs.tickwidth,tickcolor:axesAttrs.tickcolor,showticklabels:axesAttrs.showticklabels,showtickprefix:axesAttrs.showtickprefix,tickprefix:axesAttrs.tickprefix,showticksuffix:axesAttrs.showticksuffix,ticksuffix:axesAttrs.ticksuffix,showexponent:axesAttrs.showexponent,exponentformat:axesAttrs.exponentformat,separatethousands:axesAttrs.separatethousands,tickfont:axesAttrs.tickfont,tickangle:axesAttrs.tickangle,tickformat:axesAttrs.tickformat,tickformatstops:axesAttrs.tickformatstops,hoverformat:axesAttrs.hoverformat,showline:extendFlat({},axesAttrs.showline,{dflt:!0}),linecolor:axesAttrs.linecolor,linewidth:axesAttrs.linewidth,showgrid:extendFlat({},axesAttrs.showgrid,{dflt:!0}),gridcolor:axesAttrs.gridcolor,gridwidth:axesAttrs.gridwidth,layer:axesAttrs.layer,min:{valType:"number",dflt:0,min:0}};module.exports=overrideAll({domain:domainAttrs({name:"ternary"}),bgcolor:{valType:"color",dflt:colorAttrs.background},sum:{valType:"number",dflt:1,min:0},aaxis:ternaryAxesAttrs,baxis:ternaryAxesAttrs,caxis:ternaryAxesAttrs},"plot","from-root")},{"../../components/color/attributes":566,"../../lib/extend":682,"../../plot_api/edit_types":725,"../cartesian/layout_attributes":754,"../domain":767}],823:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),Template=_dereq_("../../plot_api/plot_template"),Lib=_dereq_("../../lib"),handleSubplotDefaults=_dereq_("../subplot_defaults"),handleTickLabelDefaults=_dereq_("../cartesian/tick_label_defaults"),handleTickMarkDefaults=_dereq_("../cartesian/tick_mark_defaults"),handleTickValueDefaults=_dereq_("../cartesian/tick_value_defaults"),handleLineGridDefaults=_dereq_("../cartesian/line_grid_defaults"),layoutAttributes=_dereq_("./layout_attributes"),axesNames=["aaxis","baxis","caxis"];function handleTernaryDefaults(ternaryLayoutIn,ternaryLayoutOut,coerce,options){var axName,containerIn,containerOut,bgColor=coerce("bgcolor"),sum=coerce("sum");options.bgColor=Color.combine(bgColor,options.paper_bgcolor);for(var j=0;j<axesNames.length;j++)containerIn=ternaryLayoutIn[axName=axesNames[j]]||{},(containerOut=Template.newContainer(ternaryLayoutOut,axName))._name=axName,handleAxisDefaults(containerIn,containerOut,options);var aaxis=ternaryLayoutOut.aaxis,baxis=ternaryLayoutOut.baxis,caxis=ternaryLayoutOut.caxis;aaxis.min+baxis.min+caxis.min>=sum&&(aaxis.min=0,baxis.min=0,caxis.min=0,ternaryLayoutIn.aaxis&&delete ternaryLayoutIn.aaxis.min,ternaryLayoutIn.baxis&&delete ternaryLayoutIn.baxis.min,ternaryLayoutIn.caxis&&delete ternaryLayoutIn.caxis.min)}function handleAxisDefaults(containerIn,containerOut,options){var axAttrs=layoutAttributes[containerOut._name];function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,axAttrs,attr,dflt)}containerOut.type="linear";var dfltColor=coerce("color"),dfltFontColor=dfltColor!==axAttrs.color.dflt?dfltColor:options.font.color,letterUpper=containerOut._name.charAt(0).toUpperCase(),dfltTitle="Component "+letterUpper,title=coerce("title",dfltTitle);containerOut._hovertitle=title===dfltTitle?title:letterUpper,Lib.coerceFont(coerce,"titlefont",{family:options.font.family,size:Math.round(1.2*options.font.size),color:dfltFontColor}),coerce("min"),handleTickValueDefaults(containerIn,containerOut,coerce,"linear"),handleTickLabelDefaults(containerIn,containerOut,coerce,"linear",{}),handleTickMarkDefaults(containerIn,containerOut,coerce,{outerTicks:!0}),coerce("showticklabels")&&(Lib.coerceFont(coerce,"tickfont",{family:options.font.family,size:options.font.size,color:dfltFontColor}),coerce("tickangle"),coerce("tickformat")),handleLineGridDefaults(containerIn,containerOut,coerce,{dfltColor:dfltColor,bgColor:options.bgColor,blend:60,showLine:!0,showGrid:!0,noZeroLine:!0,attributes:axAttrs}),coerce("hoverformat"),coerce("layer")}module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){handleSubplotDefaults(layoutIn,layoutOut,fullData,{type:"ternary",attributes:layoutAttributes,handleDefaults:handleTernaryDefaults,font:layoutOut.font,paper_bgcolor:layoutOut.paper_bgcolor})}},{"../../components/color":567,"../../lib":693,"../../plot_api/plot_template":732,"../cartesian/line_grid_defaults":756,"../cartesian/tick_label_defaults":761,"../cartesian/tick_mark_defaults":762,"../cartesian/tick_value_defaults":763,"../subplot_defaults":820,"./layout_attributes":822}],824:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),_=Lib._,Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),setConvert=_dereq_("../cartesian/set_convert"),extendFlat=_dereq_("../../lib/extend").extendFlat,Plots=_dereq_("../plots"),Axes=_dereq_("../cartesian/axes"),dragElement=_dereq_("../../components/dragelement"),Fx=_dereq_("../../components/fx"),Titles=_dereq_("../../components/titles"),prepSelect=_dereq_("../cartesian/select").prepSelect,selectOnClick=_dereq_("../cartesian/select").selectOnClick,clearSelect=_dereq_("../cartesian/select").clearSelect,constants=_dereq_("../cartesian/constants");function Ternary(options,fullLayout){this.id=options.id,this.graphDiv=options.graphDiv,this.init(fullLayout),this.makeFramework(fullLayout),this.aTickLayout=null,this.bTickLayout=null,this.cTickLayout=null}module.exports=Ternary;var proto=Ternary.prototype;proto.init=function(fullLayout){this.container=fullLayout._ternarylayer,this.defs=fullLayout._defs,this.layoutId=fullLayout._uid,this.traceHash={},this.layers={}},proto.plot=function(ternaryCalcData,fullLayout){var ternaryLayout=fullLayout[this.id],graphSize=fullLayout._size;this._hasClipOnAxisFalse=!1;for(var i=0;i<ternaryCalcData.length;i++){if(!1===ternaryCalcData[i][0].trace.cliponaxis){this._hasClipOnAxisFalse=!0;break}}this.updateLayers(ternaryLayout),this.adjustLayout(ternaryLayout,graphSize),Plots.generalUpdatePerTraceModule(this.graphDiv,this,ternaryCalcData,ternaryLayout),this.layers.plotbg.select("path").call(Color.fill,ternaryLayout.bgcolor)},proto.makeFramework=function(fullLayout){var ternaryLayout=fullLayout[this.id],clipId=this.clipId="clip"+this.layoutId+this.id,clipIdRelative=this.clipIdRelative="clip-relative"+this.layoutId+this.id;this.clipDef=Lib.ensureSingleById(fullLayout._clips,"clipPath",clipId,function(s){s.append("path").attr("d","M0,0Z")}),this.clipDefRelative=Lib.ensureSingleById(fullLayout._clips,"clipPath",clipIdRelative,function(s){s.append("path").attr("d","M0,0Z")}),this.plotContainer=Lib.ensureSingle(this.container,"g",this.id),this.updateLayers(ternaryLayout),Drawing.setClipUrl(this.layers.backplot,clipId),Drawing.setClipUrl(this.layers.grids,clipId)},proto.updateLayers=function(ternaryLayout){var layers=this.layers,plotLayers=["draglayer","plotbg","backplot","grids"];"below traces"===ternaryLayout.aaxis.layer&&plotLayers.push("aaxis","aline"),"below traces"===ternaryLayout.baxis.layer&&plotLayers.push("baxis","bline"),"below traces"===ternaryLayout.caxis.layer&&plotLayers.push("caxis","cline"),plotLayers.push("frontplot"),"above traces"===ternaryLayout.aaxis.layer&&plotLayers.push("aaxis","aline"),"above traces"===ternaryLayout.baxis.layer&&plotLayers.push("baxis","bline"),"above traces"===ternaryLayout.caxis.layer&&plotLayers.push("caxis","cline");var toplevel=this.plotContainer.selectAll("g.toplevel").data(plotLayers,String),grids=["agrid","bgrid","cgrid"];toplevel.enter().append("g").attr("class",function(d){return"toplevel "+d}).each(function(d){var s=d3.select(this);layers[d]=s,"frontplot"===d?s.append("g").classed("scatterlayer",!0):"backplot"===d?s.append("g").classed("maplayer",!0):"plotbg"===d?s.append("path").attr("d","M0,0Z"):"aline"===d||"bline"===d||"cline"===d?s.append("path"):"grids"===d&&grids.forEach(function(d){layers[d]=s.append("g").classed("grid "+d,!0);var fictID="bgrid"===d?"x":"y";layers[d].append("g").classed(fictID,!0)})}),toplevel.order()};var w_over_h=Math.sqrt(4/3);function strTickLayout(axLayout){return axLayout.ticks+String(axLayout.ticklen)+String(axLayout.showticklabels)}proto.adjustLayout=function(ternaryLayout,graphSize){var x0,y0,w,h,xDomainFinal,yDomainFinal,_this=this,domain=ternaryLayout.domain,xDomainCenter=(domain.x[0]+domain.x[1])/2,yDomainCenter=(domain.y[0]+domain.y[1])/2,xDomain=domain.x[1]-domain.x[0],yDomain=domain.y[1]-domain.y[0],wmax=xDomain*graphSize.w,hmax=yDomain*graphSize.h,sum=ternaryLayout.sum,amin=ternaryLayout.aaxis.min,bmin=ternaryLayout.baxis.min,cmin=ternaryLayout.caxis.min;wmax>w_over_h*hmax?w=(h=hmax)*w_over_h:h=(w=wmax)/w_over_h,xDomainFinal=xDomain*w/wmax,yDomainFinal=yDomain*h/hmax,x0=graphSize.l+graphSize.w*xDomainCenter-w/2,y0=graphSize.t+graphSize.h*(1-yDomainCenter)-h/2,_this.x0=x0,_this.y0=y0,_this.w=w,_this.h=h,_this.sum=sum,_this.xaxis={type:"linear",range:[amin+2*cmin-sum,sum-amin-2*bmin],domain:[xDomainCenter-xDomainFinal/2,xDomainCenter+xDomainFinal/2],_id:"x"},setConvert(_this.xaxis,_this.graphDiv._fullLayout),_this.xaxis.setScale(),_this.xaxis.isPtWithinRange=function(d){return d.a>=_this.aaxis.range[0]&&d.a<=_this.aaxis.range[1]&&d.b>=_this.baxis.range[1]&&d.b<=_this.baxis.range[0]&&d.c>=_this.caxis.range[1]&&d.c<=_this.caxis.range[0]},_this.yaxis={type:"linear",range:[amin,sum-bmin-cmin],domain:[yDomainCenter-yDomainFinal/2,yDomainCenter+yDomainFinal/2],_id:"y"},setConvert(_this.yaxis,_this.graphDiv._fullLayout),_this.yaxis.setScale(),_this.yaxis.isPtWithinRange=function(){return!0};var yDomain0=_this.yaxis.domain[0],aaxis=_this.aaxis=extendFlat({},ternaryLayout.aaxis,{visible:!0,range:[amin,sum-bmin-cmin],side:"left",_counterangle:30,tickangle:(+ternaryLayout.aaxis.tickangle||0)-30,domain:[yDomain0,yDomain0+yDomainFinal*w_over_h],_axislayer:_this.layers.aaxis,_gridlayer:_this.layers.agrid,anchor:"free",position:0,_pos:0,_id:"y",_length:w,_gridpath:"M0,0l"+h+",-"+w/2,automargin:!1});setConvert(aaxis,_this.graphDiv._fullLayout),aaxis.setScale();var baxis=_this.baxis=extendFlat({},ternaryLayout.baxis,{visible:!0,range:[sum-amin-cmin,bmin],side:"bottom",_counterangle:30,domain:_this.xaxis.domain,_axislayer:_this.layers.baxis,_gridlayer:_this.layers.bgrid,_counteraxis:_this.aaxis,anchor:"free",position:0,_pos:0,_id:"x",_length:w,_gridpath:"M0,0l-"+w/2+",-"+h,automargin:!1});setConvert(baxis,_this.graphDiv._fullLayout),baxis.setScale(),aaxis._counteraxis=baxis;var caxis=_this.caxis=extendFlat({},ternaryLayout.caxis,{visible:!0,range:[sum-amin-bmin,cmin],side:"right",_counterangle:30,tickangle:(+ternaryLayout.caxis.tickangle||0)+30,domain:[yDomain0,yDomain0+yDomainFinal*w_over_h],_axislayer:_this.layers.caxis,_gridlayer:_this.layers.cgrid,_counteraxis:_this.baxis,anchor:"free",position:0,_pos:0,_id:"y",_length:w,_gridpath:"M0,0l-"+h+","+w/2,automargin:!1});setConvert(caxis,_this.graphDiv._fullLayout),caxis.setScale();var triangleClip="M"+x0+","+(y0+h)+"h"+w+"l-"+w/2+",-"+h+"Z";_this.clipDef.select("path").attr("d",triangleClip),_this.layers.plotbg.select("path").attr("d",triangleClip);var triangleClipRelative="M0,"+h+"h"+w+"l-"+w/2+",-"+h+"Z";_this.clipDefRelative.select("path").attr("d",triangleClipRelative);var plotTransform="translate("+x0+","+y0+")";_this.plotContainer.selectAll(".scatterlayer,.maplayer").attr("transform",plotTransform),_this.clipDefRelative.select("path").attr("transform",null);var bTransform="translate("+(x0-baxis._offset)+","+(y0+h)+")";_this.layers.baxis.attr("transform",bTransform),_this.layers.bgrid.attr("transform",bTransform);var aTransform="translate("+(x0+w/2)+","+y0+")rotate(30)translate(0,"+-aaxis._offset+")";_this.layers.aaxis.attr("transform",aTransform),_this.layers.agrid.attr("transform",aTransform);var cTransform="translate("+(x0+w/2)+","+y0+")rotate(-30)translate(0,"+-caxis._offset+")";_this.layers.caxis.attr("transform",cTransform),_this.layers.cgrid.attr("transform",cTransform),_this.drawAxes(!0),_this.plotContainer.selectAll(".crisp").classed("crisp",!1),_this.layers.aline.select("path").attr("d",aaxis.showline?"M"+x0+","+(y0+h)+"l"+w/2+",-"+h:"M0,0").call(Color.stroke,aaxis.linecolor||"#000").style("stroke-width",(aaxis.linewidth||0)+"px"),_this.layers.bline.select("path").attr("d",baxis.showline?"M"+x0+","+(y0+h)+"h"+w:"M0,0").call(Color.stroke,baxis.linecolor||"#000").style("stroke-width",(baxis.linewidth||0)+"px"),_this.layers.cline.select("path").attr("d",caxis.showline?"M"+(x0+w/2)+","+y0+"l"+w/2+","+h:"M0,0").call(Color.stroke,caxis.linecolor||"#000").style("stroke-width",(caxis.linewidth||0)+"px"),_this.graphDiv._context.staticPlot||_this.initInteractions(),Drawing.setClipUrl(_this.layers.frontplot,_this._hasClipOnAxisFalse?null:_this.clipId)},proto.drawAxes=function(doTitles){var newTickLayout,gd=this.graphDiv,titlesuffix=this.id.substr(7)+"title",layers=this.layers,aaxis=this.aaxis,baxis=this.baxis,caxis=this.caxis;if(newTickLayout=strTickLayout(aaxis),this.aTickLayout!==newTickLayout&&(layers.aaxis.selectAll(".ytick").remove(),this.aTickLayout=newTickLayout),newTickLayout=strTickLayout(baxis),this.bTickLayout!==newTickLayout&&(layers.baxis.selectAll(".xtick").remove(),this.bTickLayout=newTickLayout),newTickLayout=strTickLayout(caxis),this.cTickLayout!==newTickLayout&&(layers.caxis.selectAll(".ytick").remove(),this.cTickLayout=newTickLayout),Axes.doTicksSingle(gd,aaxis,!0),Axes.doTicksSingle(gd,baxis,!0),Axes.doTicksSingle(gd,caxis,!0),doTitles){var apad=Math.max(aaxis.showticklabels?aaxis.tickfont.size/2:0,(caxis.showticklabels?.75*caxis.tickfont.size:0)+("outside"===caxis.ticks?.87*caxis.ticklen:0));this.layers["a-title"]=Titles.draw(gd,"a"+titlesuffix,{propContainer:aaxis,propName:this.id+".aaxis.title",placeholder:_(gd,"Click to enter Component A title"),attributes:{x:this.x0+this.w/2,y:this.y0-aaxis.titlefont.size/3-apad,"text-anchor":"middle"}});var bpad=(baxis.showticklabels?baxis.tickfont.size:0)+("outside"===baxis.ticks?baxis.ticklen:0)+3;this.layers["b-title"]=Titles.draw(gd,"b"+titlesuffix,{propContainer:baxis,propName:this.id+".baxis.title",placeholder:_(gd,"Click to enter Component B title"),attributes:{x:this.x0-bpad,y:this.y0+this.h+.83*baxis.titlefont.size+bpad,"text-anchor":"middle"}}),this.layers["c-title"]=Titles.draw(gd,"c"+titlesuffix,{propContainer:caxis,propName:this.id+".caxis.title",placeholder:_(gd,"Click to enter Component C title"),attributes:{x:this.x0+this.w+bpad,y:this.y0+this.h+.83*caxis.titlefont.size+bpad,"text-anchor":"middle"}})}};var CLEN=constants.MINZOOM/2+.87,BLPATH="m-0.87,.5h"+CLEN+"v3h-"+(CLEN+5.2)+"l"+(CLEN/2+2.6)+",-"+(.87*CLEN+4.5)+"l2.6,1.5l-"+CLEN/2+","+.87*CLEN+"Z",BRPATH="m0.87,.5h-"+CLEN+"v3h"+(CLEN+5.2)+"l-"+(CLEN/2+2.6)+",-"+(.87*CLEN+4.5)+"l-2.6,1.5l"+CLEN/2+","+.87*CLEN+"Z",TOPPATH="m0,1l"+CLEN/2+","+.87*CLEN+"l2.6,-1.5l-"+(CLEN/2+2.6)+",-"+(.87*CLEN+4.5)+"l-"+(CLEN/2+2.6)+","+(.87*CLEN+4.5)+"l2.6,1.5l"+CLEN/2+",-"+.87*CLEN+"Z",STARTMARKER="m0.5,0.5h5v-2h-5v-5h-2v5h-5v2h5v5h2Z",SHOWZOOMOUTTIP=!0;function removeZoombox(gd){d3.select(gd).selectAll(".zoombox,.js-zoombox-backdrop,.js-zoombox-menu,.zoombox-corners").remove()}proto.initInteractions=function(){var x0,y0,mins0,span0,mins,lum,path0,dimmed,zb,corners,_this=this,dragger=_this.layers.plotbg.select("path").node(),gd=_this.graphDiv,zoomContainer=gd._fullLayout._zoomlayer,dragOptions={element:dragger,gd:gd,plotinfo:{id:_this.id,xaxis:_this.xaxis,yaxis:_this.yaxis},subplot:_this.id,prepFn:function(e,startX,startY){dragOptions.xaxes=[_this.xaxis],dragOptions.yaxes=[_this.yaxis];var dragModeNow=gd._fullLayout.dragmode;dragOptions.minDrag="lasso"===dragModeNow?1:void 0,"zoom"===dragModeNow?(dragOptions.moveFn=zoomMove,dragOptions.clickFn=clickZoomPan,dragOptions.doneFn=zoomDone,function zoomPrep(e,startX,startY){var dragBBox=dragger.getBoundingClientRect();x0=startX-dragBBox.left,y0=startY-dragBBox.top,mins0={a:_this.aaxis.range[0],b:_this.baxis.range[1],c:_this.caxis.range[1]},mins=mins0,span0=_this.aaxis.range[1]-mins0.a,lum=tinycolor(_this.graphDiv._fullLayout[_this.id].bgcolor).getLuminance(),path0="M0,"+_this.h+"L"+_this.w/2+", 0L"+_this.w+","+_this.h+"Z",dimmed=!1,zb=zoomContainer.append("path").attr("class","zoombox").attr("transform","translate("+_this.x0+", "+_this.y0+")").style({fill:lum>.2?"rgba(0,0,0,0)":"rgba(255,255,255,0)","stroke-width":0}).attr("d",path0),corners=zoomContainer.append("path").attr("class","zoombox-corners").attr("transform","translate("+_this.x0+", "+_this.y0+")").style({fill:Color.background,stroke:Color.defaultLine,"stroke-width":1,opacity:0}).attr("d","M0,0Z"),clearSelect(zoomContainer)}(0,startX,startY)):"pan"===dragModeNow?(dragOptions.moveFn=plotDrag,dragOptions.clickFn=clickZoomPan,dragOptions.doneFn=dragDone,function panPrep(){mins0={a:_this.aaxis.range[0],b:_this.baxis.range[1],c:_this.caxis.range[1]},mins=mins0}(),clearSelect(zoomContainer)):"select"!==dragModeNow&&"lasso"!==dragModeNow||prepSelect(e,startX,startY,dragOptions,dragModeNow)}};function clickZoomPan(numClicks,evt){var clickMode=gd._fullLayout.clickmode;if(removeZoombox(gd),2===numClicks){var attrs={};attrs[_this.id+".aaxis.min"]=0,attrs[_this.id+".baxis.min"]=0,attrs[_this.id+".caxis.min"]=0,gd.emit("plotly_doubleclick",null),Registry.call("relayout",gd,attrs)}clickMode.indexOf("select")>-1&&1===numClicks&&selectOnClick(evt,gd,[_this.xaxis],[_this.yaxis],_this.id,dragOptions),clickMode.indexOf("event")>-1&&Fx.click(gd,evt,_this.id)}function getAFrac(x,y){return 1-y/_this.h}function getBFrac(x,y){return 1-(x+(_this.h-y)/Math.sqrt(3))/_this.w}function getCFrac(x,y){return(x-(_this.h-y)/Math.sqrt(3))/_this.w}function zoomMove(dx0,dy0){var x1=x0+dx0,y1=y0+dy0,afrac=Math.max(0,Math.min(1,getAFrac(0,y0),getAFrac(0,y1))),bfrac=Math.max(0,Math.min(1,getBFrac(x0,y0),getBFrac(x1,y1))),cfrac=Math.max(0,Math.min(1,getCFrac(x0,y0),getCFrac(x1,y1))),xLeft=(afrac/2+cfrac)*_this.w,xRight=(1-afrac/2-bfrac)*_this.w,xCenter=(xLeft+xRight)/2,xSpan=xRight-xLeft,yBottom=(1-afrac)*_this.h,yTop=yBottom-xSpan/w_over_h;xSpan<constants.MINZOOM?(mins=mins0,zb.attr("d",path0),corners.attr("d","M0,0Z")):(mins={a:mins0.a+afrac*span0,b:mins0.b+bfrac*span0,c:mins0.c+cfrac*span0},zb.attr("d",path0+"M"+xLeft+","+yBottom+"H"+xRight+"L"+xCenter+","+yTop+"L"+xLeft+","+yBottom+"Z"),corners.attr("d","M"+x0+","+y0+STARTMARKER+"M"+xLeft+","+yBottom+BLPATH+"M"+xRight+","+yBottom+BRPATH+"M"+xCenter+","+yTop+TOPPATH)),dimmed||(zb.transition().style("fill",lum>.2?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.3)").duration(200),corners.transition().style("opacity",1).duration(200),dimmed=!0)}function zoomDone(){if(removeZoombox(gd),mins!==mins0){var attrs={};attrs[_this.id+".aaxis.min"]=mins.a,attrs[_this.id+".baxis.min"]=mins.b,attrs[_this.id+".caxis.min"]=mins.c,Registry.call("relayout",gd,attrs),SHOWZOOMOUTTIP&&gd.data&&gd._context.showTips&&(Lib.notifier(_(gd,"Double-click to zoom back out"),"long"),SHOWZOOMOUTTIP=!1)}}function plotDrag(dx,dy){var dxScaled=dx/_this.xaxis._m,dyScaled=dy/_this.yaxis._m,minsorted=[(mins={a:mins0.a-dyScaled,b:mins0.b+(dxScaled+dyScaled)/2,c:mins0.c-(dxScaled-dyScaled)/2}).a,mins.b,mins.c].sort(),minindices_a=minsorted.indexOf(mins.a),minindices_b=minsorted.indexOf(mins.b),minindices_c=minsorted.indexOf(mins.c);minsorted[0]<0&&(minsorted[1]+minsorted[0]/2<0?(minsorted[2]+=minsorted[0]+minsorted[1],minsorted[0]=minsorted[1]=0):(minsorted[2]+=minsorted[0]/2,minsorted[1]+=minsorted[0]/2,minsorted[0]=0),mins={a:minsorted[minindices_a],b:minsorted[minindices_b],c:minsorted[minindices_c]},dy=(mins0.a-mins.a)*_this.yaxis._m,dx=(mins0.c-mins.c-mins0.b+mins.b)*_this.xaxis._m);var plotTransform="translate("+(_this.x0+dx)+","+(_this.y0+dy)+")";_this.plotContainer.selectAll(".scatterlayer,.maplayer").attr("transform",plotTransform);var plotTransform2="translate("+-dx+","+-dy+")";_this.clipDefRelative.select("path").attr("transform",plotTransform2),_this.aaxis.range=[mins.a,_this.sum-mins.b-mins.c],_this.baxis.range=[_this.sum-mins.a-mins.c,mins.b],_this.caxis.range=[_this.sum-mins.a-mins.b,mins.c],_this.drawAxes(!1),_this.plotContainer.selectAll(".crisp").classed("crisp",!1),_this._hasClipOnAxisFalse&&_this.plotContainer.select(".scatterlayer").selectAll(".trace").call(Drawing.hideOutsideRangePoints,_this)}function dragDone(){var attrs={};attrs[_this.id+".aaxis.min"]=mins.a,attrs[_this.id+".baxis.min"]=mins.b,attrs[_this.id+".caxis.min"]=mins.c,Registry.call("relayout",gd,attrs)}dragger.onmousemove=function(evt){Fx.hover(gd,evt,_this.id),gd._fullLayout._lasthover=dragger,gd._fullLayout._hoversubplot=_this.id},dragger.onmouseout=function(evt){gd._dragging||dragElement.unhover(gd,evt)},dragElement.init(dragOptions)}},{"../../components/color":567,"../../components/dragelement":589,"../../components/drawing":592,"../../components/fx":609,"../../components/titles":658,"../../lib":693,"../../lib/extend":682,"../../registry":825,"../cartesian/axes":742,"../cartesian/constants":747,"../cartesian/select":759,"../cartesian/set_convert":760,"../plots":805,d3:147,tinycolor2:511}],825:[function(_dereq_,module,exports){"use strict";var Loggers=_dereq_("./lib/loggers"),noop=_dereq_("./lib/noop"),pushUnique=_dereq_("./lib/push_unique"),isPlainObject=_dereq_("./lib/is_plain_object"),ExtendModule=_dereq_("./lib/extend"),basePlotAttributes=_dereq_("./plots/attributes"),baseLayoutAttributes=_dereq_("./plots/layout_attributes"),extendFlat=ExtendModule.extendFlat,extendDeepAll=ExtendModule.extendDeepAll;function registerTraceModule(_module){var thisType=_module.name,categoriesIn=_module.categories,meta=_module.meta;if(exports.modules[thisType])Loggers.log("Type "+thisType+" already registered");else{exports.subplotsRegistry[_module.basePlotModule.name]||function registerSubplot(_module){var plotType=_module.name;if(exports.subplotsRegistry[plotType])return void Loggers.log("Plot type "+plotType+" already registered.");for(var componentName in findArrayRegexps(_module),exports.subplotsRegistry[plotType]=_module,exports.componentsRegistry)mergeComponentAttrsToSubplot(componentName,_module.name)}(_module.basePlotModule);for(var categoryObj={},i=0;i<categoriesIn.length;i++)categoryObj[categoriesIn[i]]=!0,exports.allCategories[categoriesIn[i]]=!0;for(var componentName in exports.modules[thisType]={_module:_module,categories:categoryObj},meta&&Object.keys(meta).length&&(exports.modules[thisType].meta=meta),exports.allTypes.push(thisType),exports.componentsRegistry)mergeComponentAttrsToTrace(componentName,thisType);_module.layoutAttributes&&extendFlat(exports.traceLayoutAttributes,_module.layoutAttributes)}}function registerComponentModule(_module){if("string"!=typeof _module.name)throw new Error("Component module *name* must be a string.");var name=_module.name;for(var traceType in exports.componentsRegistry[name]=_module,_module.layoutAttributes&&(_module.layoutAttributes._isLinkedToArray&&pushUnique(exports.layoutArrayContainers,name),findArrayRegexps(_module)),exports.modules)mergeComponentAttrsToTrace(name,traceType);for(var subplotName in exports.subplotsRegistry)mergeComponentAttrsToSubplot(name,subplotName);for(var transformType in exports.transformsRegistry)mergeComponentAttrsToTransform(name,transformType);_module.schema&&_module.schema.layout&&extendDeepAll(baseLayoutAttributes,_module.schema.layout)}function registerTransformModule(_module){if("string"!=typeof _module.name)throw new Error("Transform module *name* must be a string.");var prefix="Transform module "+_module.name,hasTransform="function"==typeof _module.transform,hasCalcTransform="function"==typeof _module.calcTransform;if(!hasTransform&&!hasCalcTransform)throw new Error(prefix+" is missing a *transform* or *calcTransform* method.");for(var componentName in hasTransform&&hasCalcTransform&&Loggers.log([prefix+" has both a *transform* and *calcTransform* methods.","Please note that all *transform* methods are executed","before all *calcTransform* methods."].join(" ")),isPlainObject(_module.attributes)||Loggers.log(prefix+" registered without an *attributes* object."),"function"!=typeof _module.supplyDefaults&&Loggers.log(prefix+" registered without a *supplyDefaults* method."),exports.transformsRegistry[_module.name]=_module,exports.componentsRegistry)mergeComponentAttrsToTransform(componentName,_module.name)}function registerLocale(_module){var locale=_module.name,baseLocale=locale.split("-")[0],newDict=_module.dictionary,newFormat=_module.format,hasDict=newDict&&Object.keys(newDict).length,hasFormat=newFormat&&Object.keys(newFormat).length,locales=exports.localeRegistry,localeObj=locales[locale];if(localeObj||(locales[locale]=localeObj={}),baseLocale!==locale){var baseLocaleObj=locales[baseLocale];baseLocaleObj||(locales[baseLocale]=baseLocaleObj={}),hasDict&&baseLocaleObj.dictionary===localeObj.dictionary&&(baseLocaleObj.dictionary=newDict),hasFormat&&baseLocaleObj.format===localeObj.format&&(baseLocaleObj.format=newFormat)}hasDict&&(localeObj.dictionary=newDict),hasFormat&&(localeObj.format=newFormat)}function findArrayRegexps(_module){if(_module.layoutAttributes){var arrayAttrRegexps=_module.layoutAttributes._arrayAttrRegexps;if(arrayAttrRegexps)for(var i=0;i<arrayAttrRegexps.length;i++)pushUnique(exports.layoutArrayRegexes,arrayAttrRegexps[i])}}function mergeComponentAttrsToTrace(componentName,traceType){var componentSchema=exports.componentsRegistry[componentName].schema;if(componentSchema&&componentSchema.traces){var traceAttrs=componentSchema.traces[traceType];traceAttrs&&extendDeepAll(exports.modules[traceType]._module.attributes,traceAttrs)}}function mergeComponentAttrsToTransform(componentName,transformType){var componentSchema=exports.componentsRegistry[componentName].schema;if(componentSchema&&componentSchema.transforms){var transformAttrs=componentSchema.transforms[transformType];transformAttrs&&extendDeepAll(exports.transformsRegistry[transformType].attributes,transformAttrs)}}function mergeComponentAttrsToSubplot(componentName,subplotName){var componentSchema=exports.componentsRegistry[componentName].schema;if(componentSchema&&componentSchema.subplots){var subplotModule=exports.subplotsRegistry[subplotName],subplotAttrs=subplotModule.layoutAttributes,subplotAttr="subplot"===subplotModule.attr?subplotModule.name:subplotModule.attr;Array.isArray(subplotAttr)&&(subplotAttr=subplotAttr[0]);var componentLayoutAttrs=componentSchema.subplots[subplotAttr];subplotAttrs&&componentLayoutAttrs&&extendDeepAll(subplotAttrs,componentLayoutAttrs)}}function getTraceType(traceType){return"object"==typeof traceType&&(traceType=traceType.type),traceType}exports.modules={},exports.allCategories={},exports.allTypes=[],exports.subplotsRegistry={},exports.transformsRegistry={},exports.componentsRegistry={},exports.layoutArrayContainers=[],exports.layoutArrayRegexes=[],exports.traceLayoutAttributes={},exports.localeRegistry={},exports.apiMethodRegistry={},exports.register=function register(_modules){if(!_modules)throw new Error("No argument passed to Plotly.register.");_modules&&!Array.isArray(_modules)&&(_modules=[_modules]);for(var i=0;i<_modules.length;i++){var newModule=_modules[i];if(!newModule)throw new Error("Invalid module was attempted to be registered!");switch(newModule.moduleType){case"trace":registerTraceModule(newModule);break;case"transform":registerTransformModule(newModule);break;case"component":registerComponentModule(newModule);break;case"locale":registerLocale(newModule);break;case"apiMethod":var name=newModule.name;exports.apiMethodRegistry[name]=newModule.fn;break;default:throw new Error("Invalid module was attempted to be registered!")}}},exports.getModule=function(trace){var _module=exports.modules[getTraceType(trace)];return!!_module&&_module._module},exports.traceIs=function(traceType,category){if("various"===(traceType=getTraceType(traceType)))return!1;var _module=exports.modules[traceType];return _module||(traceType&&"area"!==traceType&&Loggers.log("Unrecognized trace type "+traceType+"."),_module=exports.modules[basePlotAttributes.type.dflt]),!!_module.categories[category]},exports.getTransformIndices=function(data,type){for(var indices=[],transforms=data.transforms||[],i=0;i<transforms.length;i++)transforms[i].type===type&&indices.push(i);return indices},exports.hasTransform=function(data,type){for(var transforms=data.transforms||[],i=0;i<transforms.length;i++)if(transforms[i].type===type)return!0;return!1},exports.getComponentMethod=function(name,method){var _module=exports.componentsRegistry[name];return _module&&_module[method]||noop},exports.call=function(){var name=arguments[0],args=[].slice.call(arguments,1);return exports.apiMethodRegistry[name].apply(null,args)}},{"./lib/extend":682,"./lib/is_plain_object":695,"./lib/loggers":698,"./lib/noop":703,"./lib/push_unique":708,"./plots/attributes":739,"./plots/layout_attributes":796}],826:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),extendFlat=Lib.extendFlat,extendDeep=Lib.extendDeep;function cloneLayoutOverride(tileClass){var override;switch(tileClass){case"themes__thumb":override={autosize:!0,width:150,height:150,title:"",showlegend:!1,margin:{l:5,r:5,t:5,b:5,pad:0},annotations:[]};break;case"thumbnail":override={title:"",hidesources:!0,showlegend:!1,borderwidth:0,bordercolor:"",margin:{l:1,r:1,t:1,b:1,pad:0},annotations:[]};break;default:override={}}return override}module.exports=function clonePlot(graphObj,options){var i;graphObj.framework&&graphObj.framework.isPolar&&(graphObj=graphObj.framework.getConfig());var keyName,oldData=graphObj.data,oldLayout=graphObj.layout,newData=extendDeep([],oldData),newLayout=extendDeep({},oldLayout,cloneLayoutOverride(options.tileClass)),context=graphObj._context||{};if(options.width&&(newLayout.width=options.width),options.height&&(newLayout.height=options.height),"thumbnail"===options.tileClass||"themes__thumb"===options.tileClass){newLayout.annotations=[];var keys=Object.keys(newLayout);for(i=0;i<keys.length;i++)keyName=keys[i],["xaxis","yaxis","zaxis"].indexOf(keyName.slice(0,5))>-1&&(newLayout[keys[i]].title="");for(i=0;i<newData.length;i++){var trace=newData[i];trace.showscale=!1,trace.marker&&(trace.marker.showscale=!1),"pie"===trace.type&&(trace.textposition="none")}}if(Array.isArray(options.annotations))for(i=0;i<options.annotations.length;i++)newLayout.annotations.push(options.annotations[i]);var sceneIds=Object.keys(newLayout).filter(function(key){return key.match(/^scene\d*$/)});if(sceneIds.length){var axesImageOverride={};for("thumbnail"===options.tileClass&&(axesImageOverride={title:"",showaxeslabels:!1,showticklabels:!1,linetickenable:!1}),i=0;i<sceneIds.length;i++){var scene=newLayout[sceneIds[i]];scene.xaxis||(scene.xaxis={}),scene.yaxis||(scene.yaxis={}),scene.zaxis||(scene.zaxis={}),extendFlat(scene.xaxis,axesImageOverride),extendFlat(scene.yaxis,axesImageOverride),extendFlat(scene.zaxis,axesImageOverride),scene._scene=null}}var gd=document.createElement("div");options.tileClass&&(gd.className=options.tileClass);var plotTile={gd:gd,td:gd,layout:newLayout,data:newData,config:{staticPlot:void 0===options.staticPlot||options.staticPlot,plotGlPixelRatio:void 0===options.plotGlPixelRatio?2:options.plotGlPixelRatio,displaylogo:options.displaylogo||!1,showLink:options.showLink||!1,showTips:options.showTips||!1,mapboxAccessToken:context.mapboxAccessToken}};return"transparent"!==options.setBackground&&(plotTile.config.setBackground=options.setBackground||"opaque"),plotTile.gd.defaultLayout=cloneLayoutOverride(options.tileClass),plotTile}},{"../lib":693}],827:[function(_dereq_,module,exports){"use strict";var toImage=_dereq_("../plot_api/to_image"),Lib=_dereq_("../lib"),fileSaver=_dereq_("./filesaver");module.exports=function downloadImage(gd,opts){var _gd;return Lib.isPlainObject(gd)||(_gd=Lib.getGraphDiv(gd)),(opts=opts||{}).format=opts.format||"png",new Promise(function(resolve,reject){_gd&&_gd._snapshotInProgress&&reject(new Error("Snapshotting already in progress.")),Lib.isIE()&&"svg"!==opts.format&&reject(new Error("Sorry IE does not support downloading from canvas. Try {format:'svg'} instead.")),_gd&&(_gd._snapshotInProgress=!0);var promise=toImage(gd,opts),filename=opts.filename||gd.fn||"newplot";filename+="."+opts.format,promise.then(function(result){return _gd&&(_gd._snapshotInProgress=!1),fileSaver(result,filename)}).then(function(name){resolve(name)}).catch(function(err){_gd&&(_gd._snapshotInProgress=!1),reject(err)})})}},{"../lib":693,"../plot_api/to_image":735,"./filesaver":828}],828:[function(_dereq_,module,exports){"use strict";module.exports=function(url,name){var saveLink=document.createElement("a"),canUseSaveLink="download"in saveLink,isSafari=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);return new Promise(function(resolve,reject){if("undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent)&&reject(new Error("IE < 10 unsupported")),isSafari&&(document.location.href="data:application/octet-stream"+url.slice(url.search(/[,;]/)),resolve(name)),name||(name="download"),canUseSaveLink&&(saveLink.href=url,saveLink.download=name,document.body.appendChild(saveLink),saveLink.click(),document.body.removeChild(saveLink),resolve(name)),"undefined"!=typeof navigator&&navigator.msSaveBlob){var encoded=url.split(/^data:image\/svg\+xml,/)[1],svg=decodeURIComponent(encoded);navigator.msSaveBlob(new Blob([svg]),name),resolve(name)}reject(new Error("download error"))})}},{}],829:[function(_dereq_,module,exports){"use strict";exports.getDelay=function(fullLayout){return fullLayout._has&&(fullLayout._has("gl3d")||fullLayout._has("gl2d")||fullLayout._has("mapbox"))?500:0},exports.getRedrawFunc=function(gd){var fullLayout=gd._fullLayout||{};if(!(!(fullLayout._has&&fullLayout._has("polar"))&&gd.data&&gd.data[0]&&gd.data[0].r))return function(){(gd.calcdata||[]).forEach(function(d){d[0]&&d[0].t&&d[0].t.cb&&d[0].t.cb()})}}},{}],830:[function(_dereq_,module,exports){"use strict";var helpers=_dereq_("./helpers"),Snapshot={getDelay:helpers.getDelay,getRedrawFunc:helpers.getRedrawFunc,clone:_dereq_("./cloneplot"),toSVG:_dereq_("./tosvg"),svgToImg:_dereq_("./svgtoimg"),toImage:_dereq_("./toimage"),downloadImage:_dereq_("./download")};module.exports=Snapshot},{"./cloneplot":826,"./download":827,"./helpers":829,"./svgtoimg":831,"./toimage":832,"./tosvg":833}],831:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),EventEmitter=_dereq_("events").EventEmitter;module.exports=function svgToImg(opts){var ev=opts.emitter||new EventEmitter,promise=new Promise(function(resolve,reject){var Image=window.Image,svg=opts.svg,format=opts.format||"png";if(Lib.isIE()&&"svg"!==format){var ieSvgError=new Error("Sorry IE does not support downloading from canvas. Try {format:'svg'} instead.");return reject(ieSvgError),opts.promise?promise:ev.emit("error",ieSvgError)}var canvas=opts.canvas,scale=opts.scale||1,w1=scale*(opts.width||300),h1=scale*(opts.height||150),ctx=canvas.getContext("2d"),img=new Image,url="data:image/svg+xml,"+encodeURIComponent(svg);canvas.width=w1,canvas.height=h1,img.onload=function(){var imgData;switch("svg"!==format&&ctx.drawImage(img,0,0,w1,h1),format){case"jpeg":imgData=canvas.toDataURL("image/jpeg");break;case"png":imgData=canvas.toDataURL("image/png");break;case"webp":imgData=canvas.toDataURL("image/webp");break;case"svg":imgData=url;break;default:var errorMsg="Image format is not jpeg, png, svg or webp.";if(reject(new Error(errorMsg)),!opts.promise)return ev.emit("error",errorMsg)}resolve(imgData),opts.promise||ev.emit("success",imgData)},img.onerror=function(err){if(reject(err),!opts.promise)return ev.emit("error",err)},img.src=url});return opts.promise?promise:ev}},{"../lib":693,events:91}],832:[function(_dereq_,module,exports){"use strict";var EventEmitter=_dereq_("events").EventEmitter,Registry=_dereq_("../registry"),Lib=_dereq_("../lib"),helpers=_dereq_("./helpers"),clonePlot=_dereq_("./cloneplot"),toSVG=_dereq_("./tosvg"),svgToImg=_dereq_("./svgtoimg");module.exports=function toImage(gd,opts){var ev=new EventEmitter,clone=clonePlot(gd,{format:"png"}),clonedGd=clone.gd;clonedGd.style.position="absolute",clonedGd.style.left="-5000px",document.body.appendChild(clonedGd);var redrawFunc=helpers.getRedrawFunc(clonedGd);return Registry.call("plot",clonedGd,clone.data,clone.layout,clone.config).then(redrawFunc).then(function wait(){var delay=helpers.getDelay(clonedGd._fullLayout);setTimeout(function(){var svg=toSVG(clonedGd),canvas=document.createElement("canvas");canvas.id=Lib.randstr(),(ev=svgToImg({format:opts.format,width:clonedGd._fullLayout.width,height:clonedGd._fullLayout.height,canvas:canvas,emitter:ev,svg:svg})).clean=function(){clonedGd&&document.body.removeChild(clonedGd)}},delay)}).catch(function(err){ev.emit("error",err)}),ev}},{"../lib":693,"../registry":825,"./cloneplot":826,"./helpers":829,"./svgtoimg":831,"./tosvg":833,events:91}],833:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../lib"),Drawing=_dereq_("../components/drawing"),Color=_dereq_("../components/color"),xmlnsNamespaces=_dereq_("../constants/xmlns_namespaces"),DOUBLEQUOTE_REGEX=/"/g,DUMMY_REGEX=new RegExp('("TOBESTRIPPED)|(TOBESTRIPPED")',"g");module.exports=function toSVG(gd,format,scale){var i,fullLayout=gd._fullLayout,svg=fullLayout._paper,toppaper=fullLayout._toppaper,width=fullLayout.width,height=fullLayout.height;svg.insert("rect",":first-child").call(Drawing.setRect,0,0,width,height).call(Color.fill,fullLayout.paper_bgcolor);var basePlotModules=fullLayout._basePlotModules||[];for(i=0;i<basePlotModules.length;i++){var _module=basePlotModules[i];_module.toSVG&&_module.toSVG(gd)}if(toppaper){var nodes=toppaper.node().childNodes,topGroups=Array.prototype.slice.call(nodes);for(i=0;i<topGroups.length;i++){var topGroup=topGroups[i];topGroup.childNodes.length&&svg.node().appendChild(topGroup)}}fullLayout._draggers&&fullLayout._draggers.remove(),svg.node().style.background="",svg.selectAll("text").attr({"data-unformatted":null,"data-math":null}).each(function(){var txt=d3.select(this);if("hidden"!==this.style.visibility&&"none"!==this.style.display){txt.style({visibility:null,display:null});var ff=this.style.fontFamily;ff&&-1!==ff.indexOf('"')&&txt.style("font-family",ff.replace(DOUBLEQUOTE_REGEX,"TOBESTRIPPED"))}else txt.remove()}),svg.selectAll(".point, .scatterpts, .legendfill>path, .legendlines>path, .cbfill").each(function(){var pt=d3.select(this),fill=this.style.fill;fill&&-1!==fill.indexOf("url(")&&pt.style("fill",fill.replace(DOUBLEQUOTE_REGEX,"TOBESTRIPPED"));var stroke=this.style.stroke;stroke&&-1!==stroke.indexOf("url(")&&pt.style("stroke",stroke.replace(DOUBLEQUOTE_REGEX,"TOBESTRIPPED"))}),"pdf"!==format&&"eps"!==format||svg.selectAll("#MathJax_SVG_glyphs path").attr("stroke-width",0),svg.node().setAttributeNS(xmlnsNamespaces.xmlns,"xmlns",xmlnsNamespaces.svg),svg.node().setAttributeNS(xmlnsNamespaces.xmlns,"xmlns:xlink",xmlnsNamespaces.xlink),"svg"===format&&scale&&(svg.attr("width",scale*width),svg.attr("height",scale*height),svg.attr("viewBox","0 0 "+width+" "+height));var s=(new window.XMLSerializer).serializeToString(svg.node());return s=(s=function xmlEntityEncode(str){return str.replace(/&(?!\w+;|\#[0-9]+;| \#x[0-9A-F]+;)/g,"&amp;")}(s=function htmlEntityDecode(s){var hiddenDiv=d3.select("body").append("div").style({display:"none"}).html(""),replaced=s.replace(/(&[^;]*;)/gi,function(d){return"&lt;"===d?"&#60;":"&rt;"===d?"&#62;":-1!==d.indexOf("<")||-1!==d.indexOf(">")?"":hiddenDiv.html(d).text()});return hiddenDiv.remove(),replaced}(s))).replace(DUMMY_REGEX,"'"),Lib.isIE()&&(s=(s=(s=s.replace(/"/gi,"'")).replace(/(\('#)([^']*)('\))/gi,'("#$2")')).replace(/(\\')/gi,'"')),s}},{"../components/color":567,"../components/drawing":592,"../constants/xmlns_namespaces":671,"../lib":693,d3:147}],834:[function(_dereq_,module,exports){"use strict";var mergeArray=_dereq_("../../lib").mergeArray;module.exports=function arraysToCalcdata(cd,trace){for(var i=0;i<cd.length;i++)cd[i].i=i;mergeArray(trace.text,cd,"tx"),mergeArray(trace.hovertext,cd,"htx");var marker=trace.marker;if(marker){mergeArray(marker.opacity,cd,"mo"),mergeArray(marker.color,cd,"mc");var markerLine=marker.line;markerLine&&(mergeArray(markerLine.color,cd,"mlc"),mergeArray(markerLine.width,cd,"mlw"))}}},{"../../lib":693}],835:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),colorAttributes=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),fontAttrs=_dereq_("../../plots/font_attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,textFontAttrs=fontAttrs({editType:"calc",arrayOk:!0}),marker=extendFlat({line:extendFlat({width:extendFlat({},scatterAttrs.marker.line.width,{dflt:0}),editType:"calc"},colorAttributes("marker.line")),editType:"calc"},colorAttributes("marker"),{colorbar:colorbarAttrs,opacity:{valType:"number",arrayOk:!0,dflt:1,min:0,max:1,editType:"style"}});module.exports={x:scatterAttrs.x,x0:scatterAttrs.x0,dx:scatterAttrs.dx,y:scatterAttrs.y,y0:scatterAttrs.y0,dy:scatterAttrs.dy,text:scatterAttrs.text,hovertext:scatterAttrs.hovertext,textposition:{valType:"enumerated",values:["inside","outside","auto","none"],dflt:"none",arrayOk:!0,editType:"calc"},textfont:extendFlat({},textFontAttrs,{}),insidetextfont:extendFlat({},textFontAttrs,{}),outsidetextfont:extendFlat({},textFontAttrs,{}),constraintext:{valType:"enumerated",values:["inside","outside","both","none"],dflt:"both",editType:"calc"},cliponaxis:extendFlat({},scatterAttrs.cliponaxis,{}),orientation:{valType:"enumerated",values:["v","h"],editType:"calc+clearAxisTypes"},base:{valType:"any",dflt:null,arrayOk:!0,editType:"calc"},offset:{valType:"number",dflt:null,arrayOk:!0,editType:"calc"},width:{valType:"number",dflt:null,min:0,arrayOk:!0,editType:"calc"},marker:marker,selected:{marker:{opacity:scatterAttrs.selected.marker.opacity,color:scatterAttrs.selected.marker.color,editType:"style"},textfont:scatterAttrs.selected.textfont,editType:"style"},unselected:{marker:{opacity:scatterAttrs.unselected.marker.opacity,color:scatterAttrs.unselected.marker.color,editType:"style"},textfont:scatterAttrs.unselected.textfont,editType:"style"},r:scatterAttrs.r,t:scatterAttrs.t,_deprecated:{bardir:{valType:"enumerated",editType:"calc",values:["v","h"]}}}},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/font_attributes":768,"../scatter/attributes":1032}],836:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleCalc=_dereq_("../../components/colorscale/calc"),arraysToCalcdata=_dereq_("./arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection");module.exports=function calc(gd,trace){var size,pos,xa=Axes.getFromId(gd,trace.xaxis||"x"),ya=Axes.getFromId(gd,trace.yaxis||"y");"h"===trace.orientation?(size=xa.makeCalcdata(trace,"x"),pos=ya.makeCalcdata(trace,"y")):(size=ya.makeCalcdata(trace,"y"),pos=xa.makeCalcdata(trace,"x"));for(var serieslen=Math.min(pos.length,size.length),cd=new Array(serieslen),i=0;i<serieslen;i++)cd[i]={p:pos[i],s:size[i]},trace.ids&&(cd[i].id=String(trace.ids[i]));return hasColorscale(trace,"marker")&&colorscaleCalc(trace,trace.marker.color,"marker","c"),hasColorscale(trace,"marker.line")&&colorscaleCalc(trace,trace.marker.line.color,"marker.line","c"),arraysToCalcdata(cd,trace),calcSelection(cd,trace),cd}},{"../../components/colorscale/calc":575,"../../components/colorscale/has_colorscale":581,"../../plots/cartesian/axes":742,"../scatter/calc_selection":1034,"./arrays_to_calcdata":834}],837:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray,BADNUM=_dereq_("../../constants/numerical").BADNUM,Registry=_dereq_("../../registry"),Axes=_dereq_("../../plots/cartesian/axes"),Sieve=_dereq_("./sieve.js");function setGroupPositions(gd,pa,sa,calcTraces){if(calcTraces.length){var excluded,included,i,calcTrace,barmode=gd._fullLayout.barmode,overlay="overlay"===barmode,group="group"===barmode;if(function initBase(gd,pa,sa,calcTraces){var i,j;for(i=0;i<calcTraces.length;i++){var b,cd=calcTraces[i],trace=cd[0].trace,base=trace.base,scalendar="h"===trace.orientation?trace.xcalendar:trace.ycalendar;if(isArrayOrTypedArray(base)){for(j=0;j<Math.min(base.length,cd.length);j++)b=sa.d2c(base[j],0,scalendar),isNumeric(b)?(cd[j].b=+b,cd[j].hasB=1):cd[j].b=0;for(;j<cd.length;j++)cd[j].b=0}else{b=sa.d2c(base,0,scalendar);var hasBase=isNumeric(b);for(b=hasBase?b:0,j=0;j<cd.length;j++)cd[j].b=b,hasBase&&(cd[j].hasB=1)}}}(0,0,sa,calcTraces),overlay)setGroupPositionsInOverlayMode(gd,pa,sa,calcTraces);else if(group){for(excluded=[],included=[],i=0;i<calcTraces.length;i++)void 0===(calcTrace=calcTraces[i])[0].trace.offset?included.push(calcTrace):excluded.push(calcTrace);included.length&&function setGroupPositionsInGroupMode(gd,pa,sa,calcTraces){var barnorm=gd._fullLayout.barnorm,sieve=new Sieve(calcTraces,!1,!barnorm);(function setOffsetAndWidthInGroupMode(gd,pa,sieve){var i,calcTrace,calcTrace0,t,fullLayout=gd._fullLayout,bargap=fullLayout.bargap,bargroupgap=fullLayout.bargroupgap||0,positions=sieve.positions,distinctPositions=sieve.distinctPositions,minDiff=sieve.minDiff,calcTraces=sieve.traces,overlap=positions.length!==distinctPositions.length,nTraces=calcTraces.length,barGroupWidth=minDiff*(1-bargap),barWidthPlusGap=overlap?barGroupWidth/nTraces:barGroupWidth,barWidth=barWidthPlusGap*(1-bargroupgap);for(i=0;i<nTraces;i++){calcTrace=calcTraces[i],calcTrace0=calcTrace[0];var offsetFromCenter=overlap?((2*i+1-nTraces)*barWidthPlusGap-barWidth)/2:-barWidth/2;(t=calcTrace0.t).barwidth=barWidth,t.poffset=offsetFromCenter,t.bargroupwidth=barGroupWidth,t.bardelta=minDiff}sieve.binWidth=calcTraces[0][0].t.barwidth/100,applyAttributes(sieve),setBarCenterAndWidth(gd,pa,sieve),updatePositionAxis(gd,pa,sieve,overlap)})(gd,pa,sieve),barnorm?(sieveBars(gd,sa,sieve),normalizeBars(gd,sa,sieve)):setBaseAndTop(gd,sa,sieve)}(gd,pa,sa,included),excluded.length&&setGroupPositionsInOverlayMode(gd,pa,sa,excluded)}else{for(excluded=[],included=[],i=0;i<calcTraces.length;i++)void 0===(calcTrace=calcTraces[i])[0].trace.base?included.push(calcTrace):excluded.push(calcTrace);included.length&&function setGroupPositionsInStackOrRelativeMode(gd,pa,sa,calcTraces){var barmode=gd._fullLayout.barmode,stack="stack"===barmode,relative="relative"===barmode,barnorm=gd._fullLayout.barnorm,sieve=new Sieve(calcTraces,relative,!(barnorm||stack||relative));setOffsetAndWidth(gd,pa,sieve),function stackBars(gd,sa,sieve){var i,trace,j,bar,barnorm=gd._fullLayout.barnorm,sLetter=getAxisLetter(sa),traces=sieve.traces,sRange=[null,null];for(i=0;i<traces.length;i++)for(trace=traces[i],j=0;j<trace.length;j++)if((bar=trace[j]).s!==BADNUM){var barBase=sieve.put(bar.p,bar.b+bar.s),barTop=barBase+bar.b+bar.s;bar.b=barBase,bar[sLetter]=barTop,barnorm||(isNumeric(sa.c2l(barTop))&&expandRange(sRange,barTop),bar.hasB&&isNumeric(sa.c2l(barBase))&&expandRange(sRange,barBase))}if(!barnorm){var extremes=Axes.findExtremes(sa,sRange,{tozero:!0,padded:!0});putExtremes(traces,sa,extremes)}}(gd,sa,sieve);for(var i=0;i<calcTraces.length;i++)for(var calcTrace=calcTraces[i],j=0;j<calcTrace.length;j++){var bar=calcTrace[j];if(bar.s!==BADNUM){var isOutmostBar=bar.b+bar.s===sieve.get(bar.p,bar.s);isOutmostBar&&(bar._outmost=!0)}}barnorm&&normalizeBars(gd,sa,sieve)}(gd,pa,sa,included),excluded.length&&setGroupPositionsInOverlayMode(gd,pa,sa,excluded)}!function collectExtents(calcTraces,pa){var i,j,cd,posLetter=pa._id.charAt(0),extents={},pMin=1/0,pMax=-1/0;for(i=0;i<calcTraces.length;i++)for(cd=calcTraces[i],j=0;j<cd.length;j++){var p=cd[j].p;isNumeric(p)&&(pMin=Math.min(pMin,p),pMax=Math.max(pMax,p))}var poffset,poffsetIsArray,roundFactor=1e4/(pMax-pMin),round=extents.round=function(p){return String(Math.round(roundFactor*(p-pMin)))};for(i=0;i<calcTraces.length;i++)for((cd=calcTraces[i])[0].t.extents=extents,poffset=cd[0].t.poffset,poffsetIsArray=Array.isArray(poffset),j=0;j<cd.length;j++){var di=cd[j],p0=di[posLetter]-di.w/2;if(isNumeric(p0)){var p1=di[posLetter]+di.w/2,pVal=round(di.p);extents[pVal]?extents[pVal]=[Math.min(p0,extents[pVal][0]),Math.max(p1,extents[pVal][1])]:extents[pVal]=[p0,p1]}di.p0=di.p+(poffsetIsArray?poffset[j]:poffset),di.p1=di.p0+di.w,di.s0=di.b,di.s1=di.s0+di.s}}(calcTraces,pa)}}function setGroupPositionsInOverlayMode(gd,pa,sa,calcTraces){for(var barnorm=gd._fullLayout.barnorm,dontMergeOverlappingData=!barnorm,i=0;i<calcTraces.length;i++){var calcTrace=calcTraces[i],sieve=new Sieve([calcTrace],!1,dontMergeOverlappingData);setOffsetAndWidth(gd,pa,sieve),barnorm?(sieveBars(gd,sa,sieve),normalizeBars(gd,sa,sieve)):setBaseAndTop(gd,sa,sieve)}}function setOffsetAndWidth(gd,pa,sieve){var i,t,fullLayout=gd._fullLayout,bargap=fullLayout.bargap,bargroupgap=fullLayout.bargroupgap||0,minDiff=sieve.minDiff,calcTraces=sieve.traces,barGroupWidth=minDiff*(1-bargap),barWidth=barGroupWidth*(1-bargroupgap),offsetFromCenter=-barWidth/2;for(i=0;i<calcTraces.length;i++)(t=calcTraces[i][0].t).barwidth=barWidth,t.poffset=offsetFromCenter,t.bargroupwidth=barGroupWidth,t.bardelta=minDiff;sieve.binWidth=calcTraces[0][0].t.barwidth/100,applyAttributes(sieve),setBarCenterAndWidth(gd,pa,sieve),updatePositionAxis(gd,pa,sieve)}function applyAttributes(sieve){var i,calcTrace,calcTrace0,fullTrace,j,t,calcTraces=sieve.traces;for(i=0;i<calcTraces.length;i++){fullTrace=(calcTrace0=(calcTrace=calcTraces[i])[0]).trace,t=calcTrace0.t;var newPoffset,offset=fullTrace._offset||fullTrace.offset,initialPoffset=t.poffset;if(isArrayOrTypedArray(offset)){for(newPoffset=offset.slice(0,calcTrace.length),j=0;j<newPoffset.length;j++)isNumeric(newPoffset[j])||(newPoffset[j]=initialPoffset);for(j=newPoffset.length;j<calcTrace.length;j++)newPoffset.push(initialPoffset);t.poffset=newPoffset}else void 0!==offset&&(t.poffset=offset);var width=fullTrace._width||fullTrace.width,initialBarwidth=t.barwidth;if(isArrayOrTypedArray(width)){var newBarwidth=width.slice(0,calcTrace.length);for(j=0;j<newBarwidth.length;j++)isNumeric(newBarwidth[j])||(newBarwidth[j]=initialBarwidth);for(j=newBarwidth.length;j<calcTrace.length;j++)newBarwidth.push(initialBarwidth);if(t.barwidth=newBarwidth,void 0===offset){for(newPoffset=[],j=0;j<calcTrace.length;j++)newPoffset.push(initialPoffset+(initialBarwidth-newBarwidth[j])/2);t.poffset=newPoffset}}else void 0!==width&&(t.barwidth=width,void 0===offset&&(t.poffset=initialPoffset+(initialBarwidth-width)/2))}}function setBarCenterAndWidth(gd,pa,sieve){for(var calcTraces=sieve.traces,pLetter=getAxisLetter(pa),i=0;i<calcTraces.length;i++)for(var calcTrace=calcTraces[i],t=calcTrace[0].t,poffset=t.poffset,poffsetIsArray=Array.isArray(poffset),barwidth=t.barwidth,barwidthIsArray=Array.isArray(barwidth),j=0;j<calcTrace.length;j++){var calcBar=calcTrace[j],width=calcBar.w=barwidthIsArray?barwidth[j]:barwidth;calcBar[pLetter]=calcBar.p+(poffsetIsArray?poffset[j]:poffset)+width/2}}function updatePositionAxis(gd,pa,sieve,allowMinDtick){var calcTraces=sieve.traces,distinctPositions=sieve.distinctPositions,distinctPositions0=distinctPositions[0],minDiff=sieve.minDiff,vpad=minDiff/2;Axes.minDtick(pa,minDiff,distinctPositions0,allowMinDtick);for(var pMin=Math.min.apply(Math,distinctPositions)-vpad,pMax=Math.max.apply(Math,distinctPositions)+vpad,i=0;i<calcTraces.length;i++){var calcTrace=calcTraces[i],calcTrace0=calcTrace[0],fullTrace=calcTrace0.trace;if(void 0!==fullTrace.width||void 0!==fullTrace.offset)for(var t=calcTrace0.t,poffset=t.poffset,barwidth=t.barwidth,poffsetIsArray=Array.isArray(poffset),barwidthIsArray=Array.isArray(barwidth),j=0;j<calcTrace.length;j++){var calcBar=calcTrace[j],calcBarOffset=poffsetIsArray?poffset[j]:poffset,calcBarWidth=barwidthIsArray?barwidth[j]:barwidth,l=calcBar.p+calcBarOffset,r=l+calcBarWidth;pMin=Math.min(pMin,l),pMax=Math.max(pMax,r)}}putExtremes(calcTraces,pa,Axes.findExtremes(pa,[pMin,pMax],{padded:!1}))}function expandRange(range,newValue){isNumeric(range[0])?range[0]=Math.min(range[0],newValue):range[0]=newValue,isNumeric(range[1])?range[1]=Math.max(range[1],newValue):range[1]=newValue}function setBaseAndTop(gd,sa,sieve){for(var traces=sieve.traces,sLetter=getAxisLetter(sa),sRange=[null,null],i=0;i<traces.length;i++)for(var trace=traces[i],j=0;j<trace.length;j++){var bar=trace[j],barBase=bar.b,barTop=barBase+bar.s;bar[sLetter]=barTop,isNumeric(sa.c2l(barTop))&&expandRange(sRange,barTop),bar.hasB&&isNumeric(sa.c2l(barBase))&&expandRange(sRange,barBase)}putExtremes(traces,sa,Axes.findExtremes(sa,sRange,{tozero:!0,padded:!0}))}function sieveBars(gd,sa,sieve){for(var traces=sieve.traces,i=0;i<traces.length;i++)for(var trace=traces[i],j=0;j<trace.length;j++){var bar=trace[j];bar.s!==BADNUM&&sieve.put(bar.p,bar.b+bar.s)}}function normalizeBars(gd,sa,sieve){var traces=sieve.traces,sLetter=getAxisLetter(sa),sTop="fraction"===gd._fullLayout.barnorm?1:100,sTiny=sTop/1e9,sMin=sa.l2c(sa.c2l(0)),sMax="stack"===gd._fullLayout.barmode?sTop:sMin,sRange=[sMin,sMax],padded=!1;function maybeExpand(newValue){isNumeric(sa.c2l(newValue))&&(newValue<sMin-sTiny||newValue>sMax+sTiny||!isNumeric(sMin))&&(padded=!0,expandRange(sRange,newValue))}for(var i=0;i<traces.length;i++)for(var trace=traces[i],j=0;j<trace.length;j++){var bar=trace[j];if(bar.s!==BADNUM){var scale=Math.abs(sTop/sieve.get(bar.p,bar.s));bar.b*=scale,bar.s*=scale;var barBase=bar.b,barTop=barBase+bar.s;bar[sLetter]=barTop,maybeExpand(barTop),bar.hasB&&maybeExpand(barBase)}}var extremes=Axes.findExtremes(sa,sRange,{tozero:!0,padded:padded});putExtremes(traces,sa,extremes)}function getAxisLetter(ax){return ax._id.charAt(0)}function putExtremes(cd,ax,extremes){for(var i=0;i<cd.length;i++)cd[i][0].trace._extremes[ax._id]=extremes}module.exports={crossTraceCalc:function crossTraceCalc(gd,plotinfo){var i,xa=plotinfo.xaxis,ya=plotinfo.yaxis,fullTraces=gd._fullData,calcTraces=gd.calcdata,calcTracesHorizontal=[],calcTracesVertical=[];for(i=0;i<fullTraces.length;i++){var fullTrace=fullTraces[i];!0===fullTrace.visible&&Registry.traceIs(fullTrace,"bar")&&fullTrace.xaxis===xa._id&&fullTrace.yaxis===ya._id&&("h"===fullTrace.orientation?calcTracesHorizontal.push(calcTraces[i]):calcTracesVertical.push(calcTraces[i]))}setGroupPositions(gd,xa,ya,calcTracesVertical),setGroupPositions(gd,ya,xa,calcTracesHorizontal)},setGroupPositions:setGroupPositions}},{"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axes":742,"../../registry":825,"./sieve.js":845,"fast-isnumeric":213}],838:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),Registry=_dereq_("../../registry"),handleXYDefaults=_dereq_("../scatter/xy_defaults"),handleStyleDefaults=_dereq_("../bar/style_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var coerceFont=Lib.coerceFont;if(handleXYDefaults(traceIn,traceOut,layout,coerce)){coerce("orientation",traceOut.x&&!traceOut.y?"h":"v"),coerce("base"),coerce("offset"),coerce("width"),coerce("text"),coerce("hovertext");var textPosition=coerce("textposition"),hasBoth=Array.isArray(textPosition)||"auto"===textPosition,hasInside=hasBoth||"inside"===textPosition,hasOutside=hasBoth||"outside"===textPosition;if(hasInside||hasOutside){var textFont=coerceFont(coerce,"textfont",layout.font);hasInside&&coerceFont(coerce,"insidetextfont",textFont),hasOutside&&coerceFont(coerce,"outsidetextfont",textFont),coerce("constraintext"),coerce("selected.textfont.color"),coerce("unselected.textfont.color"),coerce("cliponaxis")}handleStyleDefaults(traceIn,traceOut,coerce,defaultColor,layout);var errorBarsSupplyDefaults=Registry.getComponentMethod("errorbars","supplyDefaults");errorBarsSupplyDefaults(traceIn,traceOut,Color.defaultLine,{axis:"y"}),errorBarsSupplyDefaults(traceIn,traceOut,Color.defaultLine,{axis:"x",inherit:"y"}),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../components/color":567,"../../lib":693,"../../registry":825,"../bar/style_defaults":847,"../scatter/xy_defaults":1058,"./attributes":835}],839:[function(_dereq_,module,exports){"use strict";var Fx=_dereq_("../../components/fx"),Registry=_dereq_("../../registry"),Color=_dereq_("../../components/color"),fillHoverText=_dereq_("../scatter/fill_hover_text");function getTraceColor(trace,di){var mc=di.mcc||trace.marker.color,mlc=di.mlcc||trace.marker.line.color,mlw=di.mlw||trace.marker.line.width;return Color.opacity(mc)?mc:Color.opacity(mlc)&&mlw?mlc:void 0}module.exports={hoverPoints:function hoverPoints(pointData,xval,yval,hovermode){var posVal,sizeVal,posLetter,sizeLetter,dx,dy,pRangeCalc,cd=pointData.cd,trace=cd[0].trace,t=cd[0].t,isClosest="closest"===hovermode,maxHoverDistance=pointData.maxHoverDistance,maxSpikeDistance=pointData.maxSpikeDistance;function thisBarMinPos(di){return di[posLetter]-di.w/2}function thisBarMaxPos(di){return di[posLetter]+di.w/2}var minPos=isClosest?thisBarMinPos:function(di){return Math.min(thisBarMinPos(di),di.p-t.bardelta/2)},maxPos=isClosest?thisBarMaxPos:function(di){return Math.max(thisBarMaxPos(di),di.p+t.bardelta/2)};function _positionFn(_minPos,_maxPos){return Fx.inbox(_minPos-posVal,_maxPos-posVal,maxHoverDistance+Math.min(1,Math.abs(_maxPos-_minPos)/pRangeCalc)-1)}function positionFn(di){return _positionFn(minPos(di),maxPos(di))}function sizeFn(di){return Fx.inbox(di.b-sizeVal,di[sizeLetter]-sizeVal,maxHoverDistance+(di[sizeLetter]-sizeVal)/(di[sizeLetter]-di.b)-1)}"h"===trace.orientation?(posVal=yval,sizeVal=xval,posLetter="y",sizeLetter="x",dx=sizeFn,dy=positionFn):(posVal=xval,sizeVal=yval,posLetter="x",sizeLetter="y",dy=sizeFn,dx=positionFn);var pa=pointData[posLetter+"a"],sa=pointData[sizeLetter+"a"];pRangeCalc=Math.abs(pa.r2c(pa.range[1])-pa.r2c(pa.range[0]));var distfn=Fx.getDistanceFunction(hovermode,dx,dy,function dxy(di){return(dx(di)+dy(di))/2});if(Fx.getClosest(cd,distfn,pointData),!1!==pointData.index){isClosest||(minPos=function(di){return Math.min(thisBarMinPos(di),di.p-t.bargroupwidth/2)},maxPos=function(di){return Math.max(thisBarMaxPos(di),di.p+t.bargroupwidth/2)});var di=cd[pointData.index],size=trace.base?di.b+di.s:di.s;pointData[sizeLetter+"0"]=pointData[sizeLetter+"1"]=sa.c2p(di[sizeLetter],!0),pointData[sizeLetter+"LabelVal"]=size;var extent=t.extents[t.extents.round(di.p)];return pointData[posLetter+"0"]=pa.c2p(isClosest?minPos(di):extent[0],!0),pointData[posLetter+"1"]=pa.c2p(isClosest?maxPos(di):extent[1],!0),pointData[posLetter+"LabelVal"]=di.p,pointData.spikeDistance=(sizeFn(di)+function thisBarPositionFn(di){return _positionFn(thisBarMinPos(di),thisBarMaxPos(di))}(di))/2+maxSpikeDistance-maxHoverDistance,pointData[posLetter+"Spike"]=pa.c2p(di.p,!0),pointData.color=getTraceColor(trace,di),fillHoverText(di,trace,pointData),Registry.getComponentMethod("errorbars","hoverInfo")(di,trace,pointData),[pointData]}},getTraceColor:getTraceColor}},{"../../components/color":567,"../../components/fx":609,"../../registry":825,"../scatter/fill_hover_text":1040}],840:[function(_dereq_,module,exports){"use strict";var Bar={};Bar.attributes=_dereq_("./attributes"),Bar.layoutAttributes=_dereq_("./layout_attributes"),Bar.supplyDefaults=_dereq_("./defaults"),Bar.supplyLayoutDefaults=_dereq_("./layout_defaults"),Bar.calc=_dereq_("./calc"),Bar.crossTraceCalc=_dereq_("./cross_trace_calc").crossTraceCalc,Bar.colorbar=_dereq_("../scatter/marker_colorbar"),Bar.arraysToCalcdata=_dereq_("./arrays_to_calcdata"),Bar.plot=_dereq_("./plot"),Bar.style=_dereq_("./style").style,Bar.styleOnSelect=_dereq_("./style").styleOnSelect,Bar.hoverPoints=_dereq_("./hover").hoverPoints,Bar.selectPoints=_dereq_("./select"),Bar.moduleType="trace",Bar.name="bar",Bar.basePlotModule=_dereq_("../../plots/cartesian"),Bar.categories=["cartesian","svg","bar","oriented","errorBarsOK","showLegend","zoomScale"],Bar.meta={},module.exports=Bar},{"../../plots/cartesian":753,"../scatter/marker_colorbar":1050,"./arrays_to_calcdata":834,"./attributes":835,"./calc":836,"./cross_trace_calc":837,"./defaults":838,"./hover":839,"./layout_attributes":841,"./layout_defaults":842,"./plot":843,"./select":844,"./style":846}],841:[function(_dereq_,module,exports){"use strict";module.exports={barmode:{valType:"enumerated",values:["stack","group","overlay","relative"],dflt:"group",editType:"calc"},barnorm:{valType:"enumerated",values:["","fraction","percent"],dflt:"",editType:"calc"},bargap:{valType:"number",min:0,max:1,editType:"calc"},bargroupgap:{valType:"number",min:0,max:1,dflt:0,editType:"calc"}}},{}],842:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Axes=_dereq_("../../plots/cartesian/axes"),Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes");module.exports=function(layoutIn,layoutOut,fullData){function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)}for(var hasBars=!1,shouldBeGapless=!1,gappedAnyway=!1,usedSubplots={},i=0;i<fullData.length;i++){var trace=fullData[i];if(Registry.traceIs(trace,"bar")){if(hasBars=!0,"overlay"!==layoutIn.barmode&&"stack"!==layoutIn.barmode){var subploti=trace.xaxis+trace.yaxis;usedSubplots[subploti]&&(gappedAnyway=!0),usedSubplots[subploti]=!0}if(trace.visible&&"histogram"===trace.type)"category"!==Axes.getFromId({_fullLayout:layoutOut},trace["v"===trace.orientation?"xaxis":"yaxis"]).type&&(shouldBeGapless=!0)}}hasBars&&("overlay"!==coerce("barmode")&&coerce("barnorm"),coerce("bargap",shouldBeGapless&&!gappedAnyway?0:.2),coerce("bargroupgap"))}},{"../../lib":693,"../../plots/cartesian/axes":742,"../../registry":825,"./layout_attributes":841}],843:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),tinycolor=_dereq_("tinycolor2"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Registry=_dereq_("../../registry"),attributes=_dereq_("./attributes"),attributeText=attributes.text,attributeTextPosition=attributes.textposition,attributeTextFont=attributes.textfont,attributeInsideTextFont=attributes.insidetextfont,attributeOutsideTextFont=attributes.outsidetextfont,TEXTPAD=3;function getTransform(textX,textY,targetX,targetY,scale,rotate){var transformScale;return scale<1?transformScale="scale("+scale+") ":(scale=1,transformScale=""),"translate("+(targetX-scale*textX)+" "+(targetY-scale*textY)+")"+transformScale+(rotate?"rotate("+rotate+" "+textX+" "+textY+") ":"")}function getFontValue(attributeDefinition,attributeValue,index,defaultValue){var familyValue=getValue((attributeValue=attributeValue||{}).family,index),sizeValue=getValue(attributeValue.size,index),colorValue=getValue(attributeValue.color,index);return{family:coerceString(attributeDefinition.family,familyValue,defaultValue.family),size:function coerceNumber(attributeDefinition,value,defaultValue){if(isNumeric(value)){value=+value;var min=attributeDefinition.min,max=attributeDefinition.max,isOutOfBounds=void 0!==min&&value<min||void 0!==max&&value>max;if(!isOutOfBounds)return value}return void 0!==defaultValue?defaultValue:attributeDefinition.dflt}(attributeDefinition.size,sizeValue,defaultValue.size),color:function coerceColor(attributeDefinition,value,defaultValue){return tinycolor(value).isValid()?value:void 0!==defaultValue?defaultValue:attributeDefinition.dflt}(attributeDefinition.color,colorValue,defaultValue.color)}}function getValue(arrayOrScalar,index){var value;return Array.isArray(arrayOrScalar)?index<arrayOrScalar.length&&(value=arrayOrScalar[index]):value=arrayOrScalar,value}function coerceString(attributeDefinition,value,defaultValue){if("string"==typeof value){if(value||!attributeDefinition.noBlank)return value}else if("number"==typeof value&&!attributeDefinition.strict)return String(value);return void 0!==defaultValue?defaultValue:attributeDefinition.dflt}module.exports=function plot(gd,plotinfo,cdbar,barLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,fullLayout=gd._fullLayout,bartraces=Lib.makeTraceGroups(barLayer,cdbar,"trace bars").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],trace=cd0.trace;plotinfo.isRangePlot||(cd0.node3=plotGroup);var bars=Lib.ensureSingle(plotGroup,"g","points").selectAll("g.point").data(Lib.identity);bars.enter().append("g").classed("point",!0),bars.exit().remove(),bars.each(function(di,i){var x0,x1,y0,y1,bar=d3.select(this);if("h"===trace.orientation?(y0=ya.c2p(di.p0,!0),y1=ya.c2p(di.p1,!0),x0=xa.c2p(di.s0,!0),x1=xa.c2p(di.s1,!0),di.ct=[x1,(y0+y1)/2]):(x0=xa.c2p(di.p0,!0),x1=xa.c2p(di.p1,!0),y0=ya.c2p(di.s0,!0),y1=ya.c2p(di.s1,!0),di.ct=[(x0+x1)/2,y1]),isNumeric(x0)&&isNumeric(x1)&&isNumeric(y0)&&isNumeric(y1)&&x0!==x1&&y0!==y1){var lw=(di.mlw+1||trace.marker.line.width+1||(di.trace?di.trace.marker.line.width:0)+1)-1,offset=d3.round(lw/2%1,2);if(!gd._context.staticPlot){var fixpx=Color.opacity(di.mc||trace.marker.color)<1||lw>.01?roundWithLine:function expandToVisible(v,vc){return Math.abs(v-vc)>=2?roundWithLine(v):v>vc?Math.ceil(v):Math.floor(v)};x1=fixpx(x1,x0=fixpx(x0,x1)),y1=fixpx(y1,y0=fixpx(y0,y1))}Lib.ensureSingle(bar,"path").style("vector-effect","non-scaling-stroke").attr("d","M"+x0+","+y0+"V"+y1+"H"+x1+"V"+y0+"Z").call(Drawing.setClipUrl,plotinfo.layerClipId),function appendBarText(gd,bar,calcTrace,i,x0,x1,y0,y1){var textPosition;function appendTextNode(bar,text,textFont){var textSelection=Lib.ensureSingle(bar,"text").text(text).attr({class:"bartext bartext-"+textPosition,transform:"","text-anchor":"middle","data-notex":1}).call(Drawing.font,textFont).call(svgTextUtils.convertToTspans,gd);return textSelection}var trace=calcTrace[0].trace,orientation=trace.orientation,text=function getText(trace,index){var value=getValue(trace.text,index);return coerceString(attributeText,value)}(trace,i);if(textPosition=function getTextPosition(trace,index){var value=getValue(trace.textposition,index);return function coerceEnumerated(attributeDefinition,value,defaultValue){return attributeDefinition.coerceNumber&&(value=+value),-1!==attributeDefinition.values.indexOf(value)?value:void 0!==defaultValue?defaultValue:attributeDefinition.dflt}(attributeTextPosition,value)}(trace,i),!text||"none"===textPosition)return void bar.select("text").remove();var textSelection,textBB,textWidth,textHeight,transform,constrained,textFont=function getTextFont(trace,index,defaultValue){return getFontValue(attributeTextFont,trace.textfont,index,defaultValue)}(trace,i,gd._fullLayout.font),insideTextFont=function getInsideTextFont(trace,index,defaultValue){return getFontValue(attributeInsideTextFont,trace.insidetextfont,index,defaultValue)}(trace,i,textFont),outsideTextFont=function getOutsideTextFont(trace,index,defaultValue){return getFontValue(attributeOutsideTextFont,trace.outsidetextfont,index,defaultValue)}(trace,i,textFont),barmode=gd._fullLayout.barmode,inStackOrRelativeMode="stack"===barmode||"relative"===barmode,calcBar=calcTrace[i],isOutmostBar=!inStackOrRelativeMode||calcBar._outmost,barWidth=Math.abs(x1-x0)-2*TEXTPAD,barHeight=Math.abs(y1-y0)-2*TEXTPAD;"outside"===textPosition&&(isOutmostBar||(textPosition="inside"));if("auto"===textPosition)if(isOutmostBar){textPosition="inside",textSelection=appendTextNode(bar,text,insideTextFont),textBB=Drawing.bBox(textSelection.node()),textWidth=textBB.width,textHeight=textBB.height;var textHasSize=textWidth>0&&textHeight>0,fitsInside=textWidth<=barWidth&&textHeight<=barHeight,fitsInsideIfRotated=textWidth<=barHeight&&textHeight<=barWidth,fitsInsideIfShrunk="h"===orientation?barWidth>=textWidth*(barHeight/textHeight):barHeight>=textHeight*(barWidth/textWidth);textHasSize&&(fitsInside||fitsInsideIfRotated||fitsInsideIfShrunk)?textPosition="inside":(textPosition="outside",textSelection.remove(),textSelection=null)}else textPosition="inside";if(!textSelection&&(textSelection=appendTextNode(bar,text,"outside"===textPosition?outsideTextFont:insideTextFont),textBB=Drawing.bBox(textSelection.node()),textWidth=textBB.width,textHeight=textBB.height,textWidth<=0||textHeight<=0))return void textSelection.remove();"outside"===textPosition?(constrained="both"===trace.constraintext||"outside"===trace.constraintext,transform=function getTransformToMoveOutsideBar(x0,x1,y0,y1,textBB,orientation,constrained){var textpad,barWidth="h"===orientation?Math.abs(y1-y0):Math.abs(x1-x0);barWidth>2*TEXTPAD&&(textpad=TEXTPAD);var scale=1;constrained&&(scale="h"===orientation?Math.min(1,barWidth/textBB.height):Math.min(1,barWidth/textBB.width));var targetWidth,targetHeight,targetX,targetY,textX=(textBB.left+textBB.right)/2,textY=(textBB.top+textBB.bottom)/2;targetWidth=scale*textBB.width,targetHeight=scale*textBB.height,"h"===orientation?x1<x0?(targetX=x1-textpad-targetWidth/2,targetY=(y0+y1)/2):(targetX=x1+textpad+targetWidth/2,targetY=(y0+y1)/2):y1>y0?(targetX=(x0+x1)/2,targetY=y1+textpad+targetHeight/2):(targetX=(x0+x1)/2,targetY=y1-textpad-targetHeight/2);return getTransform(textX,textY,targetX,targetY,scale,!1)}(x0,x1,y0,y1,textBB,orientation,constrained)):(constrained="both"===trace.constraintext||"inside"===trace.constraintext,transform=function getTransformToMoveInsideBar(x0,x1,y0,y1,textBB,orientation,constrained){var targetWidth,targetHeight,targetX,targetY,textpad,rotate,scale,textWidth=textBB.width,textHeight=textBB.height,textX=(textBB.left+textBB.right)/2,textY=(textBB.top+textBB.bottom)/2,barWidth=Math.abs(x1-x0),barHeight=Math.abs(y1-y0);barWidth>2*TEXTPAD&&barHeight>2*TEXTPAD?(barWidth-=2*(textpad=TEXTPAD),barHeight-=2*textpad):textpad=0;textWidth<=barWidth&&textHeight<=barHeight?(rotate=!1,scale=1):textWidth<=barHeight&&textHeight<=barWidth?(rotate=!0,scale=1):textWidth<textHeight==barWidth<barHeight?(rotate=!1,scale=constrained?Math.min(barWidth/textWidth,barHeight/textHeight):1):(rotate=!0,scale=constrained?Math.min(barHeight/textWidth,barWidth/textHeight):1);rotate&&(rotate=90);rotate?(targetWidth=scale*textHeight,targetHeight=scale*textWidth):(targetWidth=scale*textWidth,targetHeight=scale*textHeight);"h"===orientation?x1<x0?(targetX=x1+textpad+targetWidth/2,targetY=(y0+y1)/2):(targetX=x1-textpad-targetWidth/2,targetY=(y0+y1)/2):y1>y0?(targetX=(x0+x1)/2,targetY=y1-textpad-targetHeight/2):(targetX=(x0+x1)/2,targetY=y1+textpad+targetHeight/2);return getTransform(textX,textY,targetX,targetY,scale,rotate)}(x0,x1,y0,y1,textBB,orientation,constrained));textSelection.attr("transform",transform)}(gd,bar,cd,i,x0,x1,y0,y1),plotinfo.layerClipId&&Drawing.hideOutsideRangePoint(di,bar.select("text"),xa,ya,trace.xcalendar,trace.ycalendar)}else bar.remove();function roundWithLine(v){return 0===fullLayout.bargap&&0===fullLayout.bargroupgap?d3.round(Math.round(v)-offset,2):v}});var hasClipOnAxisFalse=!1===cd0.trace.cliponaxis;Drawing.setClipUrl(plotGroup,hasClipOnAxisFalse?null:plotinfo.layerClipId)});Registry.getComponentMethod("errorbars","plot")(bartraces,plotinfo)}},{"../../components/color":567,"../../components/drawing":592,"../../lib":693,"../../lib/svg_text_utils":718,"../../registry":825,"./attributes":835,d3:147,"fast-isnumeric":213,tinycolor2:511}],844:[function(_dereq_,module,exports){"use strict";module.exports=function selectPoints(searchInfo,selectionTester){var i,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[];if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++){var di=cd[i];selectionTester.contains(di.ct,!1,i,searchInfo)?(selection.push({pointNumber:i,x:xa.c2d(di.x),y:ya.c2d(di.y)}),di.selected=1):di.selected=0}return selection}},{}],845:[function(_dereq_,module,exports){"use strict";module.exports=Sieve;var Lib=_dereq_("../../lib"),BADNUM=_dereq_("../../constants/numerical").BADNUM;function Sieve(traces,separateNegativeValues,dontMergeOverlappingData){this.traces=traces,this.separateNegativeValues=separateNegativeValues,this.dontMergeOverlappingData=dontMergeOverlappingData;for(var width1=1/0,positions=[],i=0;i<traces.length;i++){for(var trace=traces[i],j=0;j<trace.length;j++){var bar=trace[j];bar.p!==BADNUM&&positions.push(bar.p)}trace[0]&&trace[0].width1&&(width1=Math.min(trace[0].width1,width1))}this.positions=positions;var dv=Lib.distinctVals(positions);this.distinctPositions=dv.vals,1===dv.vals.length&&width1!==1/0?this.minDiff=width1:this.minDiff=Math.min(dv.minDiff,width1),this.binWidth=this.minDiff,this.bins={}}Sieve.prototype.put=function put(position,value){var label=this.getLabel(position,value),oldValue=this.bins[label]||0;return this.bins[label]=oldValue+value,oldValue},Sieve.prototype.get=function put(position,value){var label=this.getLabel(position,value);return this.bins[label]||0},Sieve.prototype.getLabel=function getLabel(position,value){return(value<0&&this.separateNegativeValues?"v":"^")+(this.dontMergeOverlappingData?position:Math.round(position/this.binWidth))}},{"../../constants/numerical":670,"../../lib":693}],846:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),Registry=_dereq_("../../registry");function stylePoints(sel,trace,gd){var pts=sel.selectAll("path"),txs=sel.selectAll("text");Drawing.pointStyle(pts,trace,gd),txs.each(function(d){var textFont,tx=d3.select(this);function cast(k){var cont=textFont[k];return Array.isArray(cont)?cont[d.i]:cont}tx.classed("bartext-inside")?textFont=trace.insidetextfont:tx.classed("bartext-outside")&&(textFont=trace.outsidetextfont),textFont||(textFont=trace.textfont),Drawing.font(tx,cast("family"),cast("size"),cast("color"))})}module.exports={style:function style(gd,cd){var s=cd?cd[0].node3:d3.select(gd).selectAll("g.trace.bars"),barcount=s.size(),fullLayout=gd._fullLayout;s.style("opacity",function(d){return d[0].trace.opacity}).each(function(d){("stack"===fullLayout.barmode&&barcount>1||0===fullLayout.bargap&&0===fullLayout.bargroupgap&&!d[0].trace.marker.line.width)&&d3.select(this).attr("shape-rendering","crispEdges")}),s.selectAll("g.points").each(function(d){stylePoints(d3.select(this),d[0].trace,gd)}),Registry.getComponentMethod("errorbars","style")(s)},styleOnSelect:function styleOnSelect(gd,cd){var s=cd[0].node3,trace=cd[0].trace;trace.selectedpoints?(Drawing.selectedPointStyle(s.selectAll("path"),trace),Drawing.selectedTextStyle(s.selectAll("text"),trace)):stylePoints(s,trace,gd)}}},{"../../components/drawing":592,"../../registry":825,d3:147}],847:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults");module.exports=function handleStyleDefaults(traceIn,traceOut,coerce,defaultColor,layout){coerce("marker.color",defaultColor),hasColorscale(traceIn,"marker")&&colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"marker.",cLetter:"c"}),coerce("marker.line.color",Color.defaultLine),hasColorscale(traceIn,"marker.line")&&colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"marker.line.",cLetter:"c"}),coerce("marker.line.width"),coerce("marker.opacity"),coerce("selected.marker.color"),coerce("unselected.marker.color")}},{"../../components/color":567,"../../components/colorscale/defaults":577,"../../components/colorscale/has_colorscale":581}],848:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../../lib/extend").extendFlat,scatterPolarAttrs=_dereq_("../scatterpolar/attributes"),barAttrs=_dereq_("../bar/attributes");module.exports={r:scatterPolarAttrs.r,theta:scatterPolarAttrs.theta,r0:scatterPolarAttrs.r0,dr:scatterPolarAttrs.dr,theta0:scatterPolarAttrs.theta0,dtheta:scatterPolarAttrs.dtheta,thetaunit:scatterPolarAttrs.thetaunit,base:extendFlat({},barAttrs.base,{}),offset:extendFlat({},barAttrs.offset,{}),width:extendFlat({},barAttrs.width,{}),text:extendFlat({},barAttrs.text,{}),marker:barAttrs.marker,hoverinfo:scatterPolarAttrs.hoverinfo,selected:barAttrs.selected,unselected:barAttrs.unselected}},{"../../lib/extend":682,"../bar/attributes":835,"../scatterpolar/attributes":1094}],849:[function(_dereq_,module,exports){"use strict";var hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleCalc=_dereq_("../../components/colorscale/calc"),arraysToCalcdata=_dereq_("../bar/arrays_to_calcdata"),setGroupPositions=_dereq_("../bar/cross_trace_calc").setGroupPositions,calcSelection=_dereq_("../scatter/calc_selection"),traceIs=_dereq_("../../registry").traceIs,extendFlat=_dereq_("../../lib").extendFlat;module.exports={calc:function calc(gd,trace){for(var fullLayout=gd._fullLayout,subplotId=trace.subplot,radialAxis=fullLayout[subplotId].radialaxis,angularAxis=fullLayout[subplotId].angularaxis,rArray=radialAxis.makeCalcdata(trace,"r"),thetaArray=angularAxis.makeCalcdata(trace,"theta"),len=trace._length,cd=new Array(len),sArray=rArray,pArray=thetaArray,i=0;i<len;i++)cd[i]={p:pArray[i],s:sArray[i]};function d2c(attr){var val=trace[attr];void 0!==val&&(trace["_"+attr]=Array.isArray(val)?angularAxis.makeCalcdata(trace,attr):angularAxis.d2c(val,trace.thetaunit))}return"linear"===angularAxis.type&&(d2c("width"),d2c("offset")),hasColorscale(trace,"marker")&&colorscaleCalc(trace,trace.marker.color,"marker","c"),hasColorscale(trace,"marker.line")&&colorscaleCalc(trace,trace.marker.line.color,"marker.line","c"),arraysToCalcdata(cd,trace),calcSelection(cd,trace),cd},crossTraceCalc:function crossTraceCalc(gd,polarLayout,subplotId){for(var calcdata=gd.calcdata,barPolarCd=[],i=0;i<calcdata.length;i++){var cdi=calcdata[i],trace=cdi[0].trace;!0===trace.visible&&traceIs(trace,"bar")&&trace.subplot===subplotId&&barPolarCd.push(cdi)}var rAxis=extendFlat({},polarLayout.radialaxis,{_id:"x"}),aAxis=polarLayout.angularaxis;setGroupPositions({_fullLayout:polarLayout},aAxis,rAxis,barPolarCd)}}},{"../../components/colorscale/calc":575,"../../components/colorscale/has_colorscale":581,"../../lib":693,"../../registry":825,"../bar/arrays_to_calcdata":834,"../bar/cross_trace_calc":837,"../scatter/calc_selection":1034}],850:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleRThetaDefaults=_dereq_("../scatterpolar/defaults").handleRThetaDefaults,handleStyleDefaults=_dereq_("../bar/style_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleRThetaDefaults(traceIn,traceOut,layout,coerce)?(coerce("thetaunit"),coerce("base"),coerce("offset"),coerce("width"),coerce("text"),handleStyleDefaults(traceIn,traceOut,coerce,defaultColor,layout),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)):traceOut.visible=!1}},{"../../lib":693,"../bar/style_defaults":847,"../scatterpolar/defaults":1096,"./attributes":848}],851:[function(_dereq_,module,exports){"use strict";var Fx=_dereq_("../../components/fx"),Lib=_dereq_("../../lib"),getTraceColor=_dereq_("../bar/hover").getTraceColor,fillHoverText=_dereq_("../scatter/fill_hover_text"),makeHoverPointText=_dereq_("../scatterpolar/hover").makeHoverPointText,isPtInsidePolygon=_dereq_("../../plots/polar/helpers").isPtInsidePolygon;module.exports=function hoverPoints(pointData,xval,yval){var cd=pointData.cd,trace=cd[0].trace,subplot=pointData.subplot,radialAxis=subplot.radialAxis,angularAxis=subplot.angularAxis,vangles=subplot.vangles,inboxFn=vangles?isPtInsidePolygon:Lib.isPtInsideSector,maxHoverDistance=pointData.maxHoverDistance,period=angularAxis._period||2*Math.PI,rVal=Math.abs(radialAxis.g2p(Math.sqrt(xval*xval+yval*yval))),thetaVal=Math.atan2(yval,xval);radialAxis.range[0]>radialAxis.range[1]&&(thetaVal+=Math.PI);if(Fx.getClosest(cd,function(di){return inboxFn(rVal,thetaVal,[di.rp0,di.rp1],[di.thetag0,di.thetag1],vangles)?maxHoverDistance+Math.min(1,Math.abs(di.thetag1-di.thetag0)/period)-1+(di.rp1-rVal)/(di.rp1-di.rp0)-1:1/0},pointData),!1!==pointData.index){var cdi=cd[pointData.index];pointData.x0=pointData.x1=cdi.ct[0],pointData.y0=pointData.y1=cdi.ct[1];var _cdi=Lib.extendFlat({},cdi,{r:cdi.s,theta:cdi.p});return fillHoverText(cdi,trace,pointData),makeHoverPointText(_cdi,trace,subplot,pointData),pointData.color=getTraceColor(trace,cdi),pointData.xLabelVal=pointData.yLabelVal=void 0,cdi.s<0&&(pointData.idealAlign="left"),[pointData]}}},{"../../components/fx":609,"../../lib":693,"../../plots/polar/helpers":807,"../bar/hover":839,"../scatter/fill_hover_text":1040,"../scatterpolar/hover":1097}],852:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"barpolar",basePlotModule:_dereq_("../../plots/polar"),categories:["polar","bar","showLegend"],attributes:_dereq_("./attributes"),layoutAttributes:_dereq_("./layout_attributes"),supplyDefaults:_dereq_("./defaults"),supplyLayoutDefaults:_dereq_("./layout_defaults"),calc:_dereq_("./calc").calc,crossTraceCalc:_dereq_("./calc").crossTraceCalc,plot:_dereq_("./plot"),colorbar:_dereq_("../scatter/marker_colorbar"),style:_dereq_("../bar/style").style,hoverPoints:_dereq_("./hover"),selectPoints:_dereq_("../bar/select"),meta:{}}},{"../../plots/polar":808,"../bar/select":844,"../bar/style":846,"../scatter/marker_colorbar":1050,"./attributes":848,"./calc":849,"./defaults":850,"./hover":851,"./layout_attributes":853,"./layout_defaults":854,"./plot":855}],853:[function(_dereq_,module,exports){"use strict";module.exports={barmode:{valType:"enumerated",values:["stack","overlay"],dflt:"stack",editType:"calc"},bargap:{valType:"number",dflt:.1,min:0,max:1,editType:"calc"}}},{}],854:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attrs=_dereq_("./layout_attributes");module.exports=function(layoutIn,layoutOut,fullData){var sp,subplotsDone={};function coerce(attr,dflt){return Lib.coerce(layoutIn[sp]||{},layoutOut[sp],attrs,attr,dflt)}for(var i=0;i<fullData.length;i++){var trace=fullData[i];"barpolar"===trace.type&&!0===trace.visible&&(subplotsDone[sp=trace.subplot]||(coerce("barmode"),coerce("bargap"),subplotsDone[sp]=1))}}},{"../../lib":693,"./layout_attributes":853}],855:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../../components/drawing"),helpers=_dereq_("../../plots/polar/helpers");module.exports=function plot(gd,subplot,cdbar){var xa=subplot.xaxis,ya=subplot.yaxis,radialAxis=subplot.radialAxis,angularAxis=subplot.angularAxis,pathFn=function makePathFn(subplot){var cxx=subplot.cxx,cyy=subplot.cyy;if(subplot.vangles)return function(r0,r1,_a0,_a1){var a0,a1;Lib.angleDelta(_a0,_a1)>0?(a0=_a0,a1=_a1):(a0=_a1,a1=_a0);var va0=helpers.findEnclosingVertexAngles(a0,subplot.vangles)[0],va1=helpers.findEnclosingVertexAngles(a1,subplot.vangles)[1],vaBar=[va0,(a0+a1)/2,va1];return helpers.pathPolygonAnnulus(r0,r1,a0,a1,vaBar,cxx,cyy)};return function(r0,r1,a0,a1){return Lib.pathAnnulus(r0,r1,a0,a1,cxx,cyy)}}(subplot),barLayer=subplot.layers.frontplot.select("g.barlayer");Lib.makeTraceGroups(barLayer,cdbar,"trace bars").each(function(cd){var plotGroup=cd[0].node3=d3.select(this),bars=Lib.ensureSingle(plotGroup,"g","points").selectAll("g.point").data(Lib.identity);bars.enter().append("g").style("vector-effect","non-scaling-stroke").style("stroke-miterlimit",2).classed("point",!0),bars.exit().remove(),bars.each(function(di){var dPath,bar=d3.select(this),rp0=di.rp0=radialAxis.c2p(di.s0),rp1=di.rp1=radialAxis.c2p(di.s1),thetag0=di.thetag0=angularAxis.c2g(di.p0),thetag1=di.thetag1=angularAxis.c2g(di.p1);if(isNumeric(rp0)&&isNumeric(rp1)&&isNumeric(thetag0)&&isNumeric(thetag1)&&rp0!==rp1&&thetag0!==thetag1){var rg1=radialAxis.c2g(di.s1),thetagMid=(thetag0+thetag1)/2;di.ct=[xa.c2p(rg1*Math.cos(thetagMid)),ya.c2p(rg1*Math.sin(thetagMid))],dPath=pathFn(rp0,rp1,thetag0,thetag1)}else dPath="M0,0Z";Lib.ensureSingle(bar,"path").attr("d",dPath)}),Drawing.setClipUrl(plotGroup,subplot._hasClipOnAxisFalse?subplot.clipIds.forTraces:null)})}},{"../../components/drawing":592,"../../lib":693,"../../plots/polar/helpers":807,d3:147,"fast-isnumeric":213}],856:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),colorAttrs=_dereq_("../../components/color/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,scatterMarkerAttrs=scatterAttrs.marker,scatterMarkerLineAttrs=scatterMarkerAttrs.line;module.exports={y:{valType:"data_array",editType:"calc+clearAxisTypes"},x:{valType:"data_array",editType:"calc+clearAxisTypes"},x0:{valType:"any",editType:"calc+clearAxisTypes"},y0:{valType:"any",editType:"calc+clearAxisTypes"},name:{valType:"string",editType:"calc+clearAxisTypes"},text:extendFlat({},scatterAttrs.text,{}),whiskerwidth:{valType:"number",min:0,max:1,dflt:.5,editType:"calc"},notched:{valType:"boolean",editType:"calc"},notchwidth:{valType:"number",min:0,max:.5,dflt:.25,editType:"calc"},boxpoints:{valType:"enumerated",values:["all","outliers","suspectedoutliers",!1],dflt:"outliers",editType:"calc"},boxmean:{valType:"enumerated",values:[!0,"sd",!1],dflt:!1,editType:"calc"},jitter:{valType:"number",min:0,max:1,editType:"calc"},pointpos:{valType:"number",min:-2,max:2,editType:"calc"},orientation:{valType:"enumerated",values:["v","h"],editType:"calc+clearAxisTypes"},marker:{outliercolor:{valType:"color",dflt:"rgba(0, 0, 0, 0)",editType:"style"},symbol:extendFlat({},scatterMarkerAttrs.symbol,{arrayOk:!1,editType:"plot"}),opacity:extendFlat({},scatterMarkerAttrs.opacity,{arrayOk:!1,dflt:1,editType:"style"}),size:extendFlat({},scatterMarkerAttrs.size,{arrayOk:!1,editType:"calc"}),color:extendFlat({},scatterMarkerAttrs.color,{arrayOk:!1,editType:"style"}),line:{color:extendFlat({},scatterMarkerLineAttrs.color,{arrayOk:!1,dflt:colorAttrs.defaultLine,editType:"style"}),width:extendFlat({},scatterMarkerLineAttrs.width,{arrayOk:!1,dflt:0,editType:"style"}),outliercolor:{valType:"color",editType:"style"},outlierwidth:{valType:"number",min:0,dflt:1,editType:"style"},editType:"style"},editType:"plot"},line:{color:{valType:"color",editType:"style"},width:{valType:"number",min:0,dflt:2,editType:"style"},editType:"plot"},fillcolor:scatterAttrs.fillcolor,selected:{marker:scatterAttrs.selected.marker,editType:"style"},unselected:{marker:scatterAttrs.unselected.marker,editType:"style"},hoveron:{valType:"flaglist",flags:["boxes","points"],dflt:"boxes+points",editType:"style"}}},{"../../components/color/attributes":566,"../../lib/extend":682,"../scatter/attributes":1032}],857:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),_=Lib._,Axes=_dereq_("../../plots/cartesian/axes");function arraysToCalcdata(pt,trace,i){var trace2calc={text:"tx"};for(var k in trace2calc)Array.isArray(trace[k])&&(pt[trace2calc[k]]=trace[k][i])}function sortByVal(a,b){return a.v-b.v}function extractVal(o){return o.v}module.exports=function calc(gd,trace){var i,valAxis,valLetter,posAxis,posLetter,fullLayout=gd._fullLayout,xa=Axes.getFromId(gd,trace.xaxis||"x"),ya=Axes.getFromId(gd,trace.yaxis||"y"),cd=[],numKey="violin"===trace.type?"_numViolins":"_numBoxes";"h"===trace.orientation?(valAxis=xa,valLetter="x",posAxis=ya,posLetter="y"):(valAxis=ya,valLetter="y",posAxis=xa,posLetter="x");var val=valAxis.makeCalcdata(trace,valLetter),pos=function getPos(trace,posLetter,posAxis,val,num){if(posLetter in trace)return posAxis.makeCalcdata(trace,posLetter);var pos0;pos0=posLetter+"0"in trace?trace[posLetter+"0"]:"name"in trace&&("category"===posAxis.type||isNumeric(trace.name)&&-1!==["linear","log"].indexOf(posAxis.type)||Lib.isDateTime(trace.name)&&"date"===posAxis.type)?trace.name:num;var pos0c=posAxis.d2c(pos0,0,trace[posLetter+"calendar"]);return val.map(function(){return pos0c})}(trace,posLetter,posAxis,val,fullLayout[numKey]),dv=Lib.distinctVals(pos),posDistinct=dv.vals,dPos=dv.minDiff/2,posBins=function makeBins(x,dx){for(var len=x.length,bins=new Array(len+1),i=0;i<len;i++)bins[i]=x[i]-dx;return bins[len]=x[len-1]+dx,bins}(posDistinct,dPos),pLen=posDistinct.length,ptsPerBin=function initNestedArray(len){for(var arr=new Array(len),i=0;i<len;i++)arr[i]=[];return arr}(pLen);for(i=0;i<trace._length;i++){var v=val[i];if(isNumeric(v)){var n=Lib.findBin(pos[i],posBins);if(n>=0&&n<pLen){var pt={v:v,i:i};arraysToCalcdata(pt,trace,i),ptsPerBin[n].push(pt)}}}for(i=0;i<pLen;i++)if(ptsPerBin[i].length>0){var pts=ptsPerBin[i].sort(sortByVal),boxVals=pts.map(extractVal),bvLen=boxVals.length,cdi={pos:posDistinct[i],pts:pts};cdi.min=boxVals[0],cdi.max=boxVals[bvLen-1],cdi.mean=Lib.mean(boxVals,bvLen),cdi.sd=Lib.stdev(boxVals,bvLen,cdi.mean),cdi.q1=Lib.interp(boxVals,.25),cdi.med=Lib.interp(boxVals,.5),cdi.q3=Lib.interp(boxVals,.75),cdi.lf=Math.min(cdi.q1,boxVals[Math.min(Lib.findBin(2.5*cdi.q1-1.5*cdi.q3,boxVals,!0)+1,bvLen-1)]),cdi.uf=Math.max(cdi.q3,boxVals[Math.max(Lib.findBin(2.5*cdi.q3-1.5*cdi.q1,boxVals),0)]),cdi.lo=4*cdi.q1-3*cdi.q3,cdi.uo=4*cdi.q3-3*cdi.q1;var mci=1.57*(cdi.q3-cdi.q1)/Math.sqrt(bvLen);cdi.ln=cdi.med-mci,cdi.un=cdi.med+mci,cd.push(cdi)}!function calcSelection(cd,trace){if(Lib.isArrayOrTypedArray(trace.selectedpoints))for(var i=0;i<cd.length;i++){for(var pts=cd[i].pts||[],ptNumber2cdIndex={},j=0;j<pts.length;j++)ptNumber2cdIndex[pts[j].i]=j;Lib.tagSelected(pts,trace,ptNumber2cdIndex)}}(cd,trace);var extremes=Axes.findExtremes(valAxis,val,{padded:!0});return trace._extremes[valAxis._id]=extremes,cd.length>0?(cd[0].t={num:fullLayout[numKey],dPos:dPos,posLetter:posLetter,valLetter:valLetter,labels:{med:_(gd,"median:"),min:_(gd,"min:"),q1:_(gd,"q1:"),q3:_(gd,"q3:"),max:_(gd,"max:"),mean:"sd"===trace.boxmean?_(gd,"mean  :"):_(gd,"mean:"),lf:_(gd,"lower fence:"),uf:_(gd,"upper fence:")}},fullLayout[numKey]++,cd):[{t:{empty:!0}}]}},{"../../lib":693,"../../plots/cartesian/axes":742,"fast-isnumeric":213}],858:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),Lib=_dereq_("../../lib"),orientations=["v","h"];function setPositionOffset(traceType,gd,boxList,posAxis,pad){var i,j,calcTrace,calcdata=gd.calcdata,fullLayout=gd._fullLayout,pointList=[],numKey="violin"===traceType?"_numViolins":"_numBoxes";for(i=0;i<boxList.length;i++)for(calcTrace=calcdata[boxList[i]],j=0;j<calcTrace.length;j++)pointList.push(calcTrace[j].pos);if(pointList.length){var boxdv=Lib.distinctVals(pointList),dPos=boxdv.minDiff/2;pointList.length===boxdv.vals.length&&(fullLayout[numKey]=1),Axes.minDtick(posAxis,boxdv.minDiff,boxdv.vals[0],!0);var padfactor=(1-fullLayout[traceType+"gap"])*(1-fullLayout[traceType+"groupgap"])*dPos/fullLayout[numKey],extremes=Axes.findExtremes(posAxis,boxdv.vals,{vpadminus:dPos+pad[0]*padfactor,vpadplus:dPos+pad[1]*padfactor});for(i=0;i<boxList.length;i++)(calcTrace=calcdata[boxList[i]])[0].t.dPos=dPos,calcTrace[0].trace._extremes[posAxis._id]=extremes}}module.exports={crossTraceCalc:function crossTraceCalc(gd,plotinfo){for(var calcdata=gd.calcdata,xa=plotinfo.xaxis,ya=plotinfo.yaxis,i=0;i<orientations.length;i++){for(var orientation=orientations[i],posAxis="h"===orientation?ya:xa,boxList=[],minPad=0,maxPad=0,j=0;j<calcdata.length;j++){var cd=calcdata[j],t=cd[0].t,trace=cd[0].trace;!0!==trace.visible||"box"!==trace.type&&"candlestick"!==trace.type||t.empty||(trace.orientation||"v")!==orientation||trace.xaxis!==xa._id||trace.yaxis!==ya._id||(boxList.push(j),trace.boxpoints&&(minPad=Math.max(minPad,trace.jitter-trace.pointpos-1),maxPad=Math.max(maxPad,trace.jitter+trace.pointpos-1)))}setPositionOffset("box",gd,boxList,posAxis,[minPad,maxPad])}},setPositionOffset:setPositionOffset}},{"../../lib":693,"../../plots/cartesian/axes":742}],859:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry"),Color=_dereq_("../../components/color"),attributes=_dereq_("./attributes");function handleSampleDefaults(traceIn,traceOut,coerce,layout){var defaultOrientation,len,y=coerce("y"),x=coerce("x"),hasX=x&&x.length;if(y&&y.length)defaultOrientation="v",hasX?len=Math.min(x.length,y.length):(coerce("x0"),len=y.length);else{if(!hasX)return void(traceOut.visible=!1);defaultOrientation="h",coerce("y0"),len=x.length}traceOut._length=len,Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y"],layout),coerce("orientation",defaultOrientation)}function handlePointsDefaults(traceIn,traceOut,coerce,opts){var prefix=opts.prefix,outlierColorDflt=Lib.coerce2(traceIn,traceOut,attributes,"marker.outliercolor"),lineoutliercolor=coerce("marker.line.outliercolor"),points=coerce(prefix+"points",outlierColorDflt||lineoutliercolor?"suspectedoutliers":void 0);points?(coerce("jitter","all"===points?.3:0),coerce("pointpos","all"===points?-1.5:0),coerce("marker.symbol"),coerce("marker.opacity"),coerce("marker.size"),coerce("marker.color",traceOut.line.color),coerce("marker.line.color"),coerce("marker.line.width"),"suspectedoutliers"===points&&(coerce("marker.line.outliercolor",traceOut.marker.color),coerce("marker.line.outlierwidth")),coerce("selected.marker.color"),coerce("unselected.marker.color"),coerce("selected.marker.size"),coerce("unselected.marker.size"),coerce("text")):delete traceOut.marker,coerce("hoveron"),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}module.exports={supplyDefaults:function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleSampleDefaults(traceIn,traceOut,coerce,layout),!1!==traceOut.visible&&(coerce("line.color",(traceIn.marker||{}).color||defaultColor),coerce("line.width"),coerce("fillcolor",Color.addOpacity(traceOut.line.color,.5)),coerce("whiskerwidth"),coerce("boxmean"),coerce("notched",void 0!==traceIn.notchwidth)&&coerce("notchwidth"),handlePointsDefaults(traceIn,traceOut,coerce,{prefix:"box"}))},handleSampleDefaults:handleSampleDefaults,handlePointsDefaults:handlePointsDefaults}},{"../../components/color":567,"../../lib":693,"../../registry":825,"./attributes":856}],860:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt){return pt.hoverOnBox&&(out.hoverOnBox=pt.hoverOnBox),"xVal"in pt&&(out.x=pt.xVal),"yVal"in pt&&(out.y=pt.yVal),pt.xa&&(out.xaxis=pt.xa),pt.ya&&(out.yaxis=pt.ya),out}},{}],861:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),Lib=_dereq_("../../lib"),Fx=_dereq_("../../components/fx"),Color=_dereq_("../../components/color"),fillHoverText=_dereq_("../scatter/fill_hover_text");function hoverOnBoxes(pointData,xval,yval,hovermode){var pLetter,vLetter,pAxis,vAxis,vVal,pVal,dx,dy,dPos,hoverPseudoDistance,spikePseudoDistance,dVal,cd=pointData.cd,xa=pointData.xa,ya=pointData.ya,trace=cd[0].trace,t=cd[0].t,isViolin="violin"===trace.type,closeBoxData=[],boxDelta=t.bdPos,posAcceptance=t.wHover,shiftPos=function(di){return di.pos+t.bPos-pVal};isViolin&&"both"!==trace.side?("positive"===trace.side&&(dPos=function(di){var pos=shiftPos(di);return Fx.inbox(pos,pos+posAcceptance,hoverPseudoDistance)}),"negative"===trace.side&&(dPos=function(di){var pos=shiftPos(di);return Fx.inbox(pos-posAcceptance,pos,hoverPseudoDistance)})):dPos=function(di){var pos=shiftPos(di);return Fx.inbox(pos-posAcceptance,pos+posAcceptance,hoverPseudoDistance)},dVal=isViolin?function(di){return Fx.inbox(di.span[0]-vVal,di.span[1]-vVal,hoverPseudoDistance)}:function(di){return Fx.inbox(di.min-vVal,di.max-vVal,hoverPseudoDistance)},"h"===trace.orientation?(vVal=xval,pVal=yval,dx=dVal,dy=dPos,pLetter="y",pAxis=ya,vLetter="x",vAxis=xa):(vVal=yval,pVal=xval,dx=dPos,dy=dVal,pLetter="x",pAxis=xa,vLetter="y",vAxis=ya);var pseudoDistance=Math.min(1,boxDelta/Math.abs(pAxis.r2c(pAxis.range[1])-pAxis.r2c(pAxis.range[0])));function dxy(di){return(dx(di)+dy(di))/2}hoverPseudoDistance=pointData.maxHoverDistance-pseudoDistance,spikePseudoDistance=pointData.maxSpikeDistance-pseudoDistance;var distfn=Fx.getDistanceFunction(hovermode,dx,dy,dxy);if(Fx.getClosest(cd,distfn,pointData),!1===pointData.index)return[];var di=cd[pointData.index],lc=trace.line.color,mc=(trace.marker||{}).color;Color.opacity(lc)&&trace.line.width?pointData.color=lc:Color.opacity(mc)&&trace.boxpoints?pointData.color=mc:pointData.color=trace.fillcolor,pointData[pLetter+"0"]=pAxis.c2p(di.pos+t.bPos-boxDelta,!0),pointData[pLetter+"1"]=pAxis.c2p(di.pos+t.bPos+boxDelta,!0),pointData[pLetter+"LabelVal"]=di.pos;var spikePosAttr=pLetter+"Spike";pointData.spikeDistance=dxy(di)*spikePseudoDistance/hoverPseudoDistance,pointData[spikePosAttr]=pAxis.c2p(di.pos,!0);var usedVals={},attrs=["med","min","q1","q3","max"];(trace.boxmean||(trace.meanline||{}).visible)&&attrs.push("mean"),(trace.boxpoints||trace.points)&&attrs.push("lf","uf");for(var i=0;i<attrs.length;i++){var attr=attrs[i];if(attr in di&&!(di[attr]in usedVals)){usedVals[di[attr]]=!0;var val=di[attr],valPx=vAxis.c2p(val,!0),pointData2=Lib.extendFlat({},pointData);pointData2[vLetter+"0"]=pointData2[vLetter+"1"]=valPx,pointData2[vLetter+"LabelVal"]=val,pointData2[vLetter+"Label"]=(t.labels?t.labels[attr]+" ":"")+Axes.hoverLabelText(vAxis,val),pointData2.hoverOnBox=!0,"mean"===attr&&"sd"in di&&"sd"===trace.boxmean&&(pointData2[vLetter+"err"]=di.sd),pointData.name="",pointData.spikeDistance=void 0,pointData[spikePosAttr]=void 0,closeBoxData.push(pointData2)}}return closeBoxData}function hoverOnPoints(pointData,xval,yval){for(var closePtData,di,pt,cd=pointData.cd,xa=pointData.xa,ya=pointData.ya,trace=cd[0].trace,xPx=xa.c2p(xval),yPx=ya.c2p(yval),distfn=Fx.quadrature(function(di){var rad=Math.max(3,di.mrc||0);return Math.max(Math.abs(xa.c2p(di.x)-xPx)-rad,1-3/rad)},function(di){var rad=Math.max(3,di.mrc||0);return Math.max(Math.abs(ya.c2p(di.y)-yPx)-rad,1-3/rad)}),ijClosest=!1,i=0;i<cd.length;i++){di=cd[i];for(var j=0;j<(di.pts||[]).length;j++){var newDistance=distfn(pt=di.pts[j]);newDistance<=pointData.distance&&(pointData.distance=newDistance,ijClosest=[i,j])}}if(!ijClosest)return!1;pt=(di=cd[ijClosest[0]]).pts[ijClosest[1]];var xc=xa.c2p(pt.x,!0),yc=ya.c2p(pt.y,!0),rad=pt.mrc||1;closePtData=Lib.extendFlat({},pointData,{index:pt.i,color:(trace.marker||{}).color,name:trace.name,x0:xc-rad,x1:xc+rad,xLabelVal:pt.x,y0:yc-rad,y1:yc+rad,yLabelVal:pt.y,spikeDistance:pointData.distance});var pLetter="h"===trace.orientation?"y":"x",pa="h"===trace.orientation?ya:xa;return closePtData[pLetter+"Spike"]=pa.c2p(di.pos,!0),fillHoverText(pt,trace,closePtData),closePtData}module.exports={hoverPoints:function hoverPoints(pointData,xval,yval,hovermode){var closePtData,hoveron=pointData.cd[0].trace.hoveron,closeBoxData=[];return-1!==hoveron.indexOf("boxes")&&(closeBoxData=closeBoxData.concat(hoverOnBoxes(pointData,xval,yval,hovermode))),-1!==hoveron.indexOf("points")&&(closePtData=hoverOnPoints(pointData,xval,yval)),"closest"===hovermode?closePtData?[closePtData]:closeBoxData:closePtData?(closeBoxData.push(closePtData),closeBoxData):closeBoxData},hoverOnBoxes:hoverOnBoxes,hoverOnPoints:hoverOnPoints}},{"../../components/color":567,"../../components/fx":609,"../../lib":693,"../../plots/cartesian/axes":742,"../scatter/fill_hover_text":1040}],862:[function(_dereq_,module,exports){"use strict";var Box={};Box.attributes=_dereq_("./attributes"),Box.layoutAttributes=_dereq_("./layout_attributes"),Box.supplyDefaults=_dereq_("./defaults").supplyDefaults,Box.supplyLayoutDefaults=_dereq_("./layout_defaults").supplyLayoutDefaults,Box.calc=_dereq_("./calc"),Box.crossTraceCalc=_dereq_("./cross_trace_calc").crossTraceCalc,Box.plot=_dereq_("./plot").plot,Box.style=_dereq_("./style").style,Box.styleOnSelect=_dereq_("./style").styleOnSelect,Box.hoverPoints=_dereq_("./hover").hoverPoints,Box.eventData=_dereq_("./event_data"),Box.selectPoints=_dereq_("./select"),Box.moduleType="trace",Box.name="box",Box.basePlotModule=_dereq_("../../plots/cartesian"),Box.categories=["cartesian","svg","symbols","oriented","box-violin","showLegend","boxLayout","zoomScale"],Box.meta={},module.exports=Box},{"../../plots/cartesian":753,"./attributes":856,"./calc":857,"./cross_trace_calc":858,"./defaults":859,"./event_data":860,"./hover":861,"./layout_attributes":863,"./layout_defaults":864,"./plot":865,"./select":866,"./style":867}],863:[function(_dereq_,module,exports){"use strict";module.exports={boxmode:{valType:"enumerated",values:["group","overlay"],dflt:"overlay",editType:"calc"},boxgap:{valType:"number",min:0,max:1,dflt:.3,editType:"calc"},boxgroupgap:{valType:"number",min:0,max:1,dflt:.3,editType:"calc"}}},{}],864:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes");function _supply(layoutIn,layoutOut,fullData,coerce,traceType){for(var hasTraceType,category=traceType+"Layout",i=0;i<fullData.length;i++)if(Registry.traceIs(fullData[i],category)){hasTraceType=!0;break}hasTraceType&&(coerce(traceType+"mode"),coerce(traceType+"gap"),coerce(traceType+"groupgap"))}module.exports={supplyLayoutDefaults:function supplyLayoutDefaults(layoutIn,layoutOut,fullData){_supply(0,0,fullData,function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)},"box")},_supply:_supply}},{"../../lib":693,"../../registry":825,"./layout_attributes":863}],865:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../../components/drawing"),JITTERCOUNT=5,JITTERSPREAD=.01;function plotBoxAndWhiskers(sel,axes,trace,t){var bdPos0,bdPos1,posAxis=axes.pos,valAxis=axes.val,bPos=t.bPos,wdPos=t.wdPos||0,bPosPxOffset=t.bPosPxOffset||0,whiskerWidth=trace.whiskerwidth||0,notched=trace.notched||!1,nw=notched?1-2*trace.notchwidth:1;Array.isArray(t.bdPos)?(bdPos0=t.bdPos[0],bdPos1=t.bdPos[1]):(bdPos0=t.bdPos,bdPos1=t.bdPos);var paths=sel.selectAll("path.box").data("violin"!==trace.type||trace.box.visible?Lib.identity:[]);paths.enter().append("path").style("vector-effect","non-scaling-stroke").attr("class","box"),paths.exit().remove(),paths.each(function(d){var pos=d.pos,posc=posAxis.c2p(pos+bPos,!0)+bPosPxOffset,pos0=posAxis.c2p(pos+bPos-bdPos0,!0)+bPosPxOffset,pos1=posAxis.c2p(pos+bPos+bdPos1,!0)+bPosPxOffset,posw0=posAxis.c2p(pos+bPos-wdPos,!0)+bPosPxOffset,posw1=posAxis.c2p(pos+bPos+wdPos,!0)+bPosPxOffset,posm0=posAxis.c2p(pos+bPos-bdPos0*nw,!0)+bPosPxOffset,posm1=posAxis.c2p(pos+bPos+bdPos1*nw,!0)+bPosPxOffset,q1=valAxis.c2p(d.q1,!0),q3=valAxis.c2p(d.q3,!0),m=Lib.constrain(valAxis.c2p(d.med,!0),Math.min(q1,q3)+1,Math.max(q1,q3)-1),useExtremes=void 0===d.lf||!1===trace.boxpoints,lf=valAxis.c2p(useExtremes?d.min:d.lf,!0),uf=valAxis.c2p(useExtremes?d.max:d.uf,!0),ln=valAxis.c2p(d.ln,!0),un=valAxis.c2p(d.un,!0);"h"===trace.orientation?d3.select(this).attr("d","M"+m+","+posm0+"V"+posm1+"M"+q1+","+pos0+"V"+pos1+(notched?"H"+ln+"L"+m+","+posm1+"L"+un+","+pos1:"")+"H"+q3+"V"+pos0+(notched?"H"+un+"L"+m+","+posm0+"L"+ln+","+pos0:"")+"ZM"+q1+","+posc+"H"+lf+"M"+q3+","+posc+"H"+uf+(0===whiskerWidth?"":"M"+lf+","+posw0+"V"+posw1+"M"+uf+","+posw0+"V"+posw1)):d3.select(this).attr("d","M"+posm0+","+m+"H"+posm1+"M"+pos0+","+q1+"H"+pos1+(notched?"V"+ln+"L"+posm1+","+m+"L"+pos1+","+un:"")+"V"+q3+"H"+pos0+(notched?"V"+un+"L"+posm0+","+m+"L"+pos0+","+ln:"")+"ZM"+posc+","+q1+"V"+lf+"M"+posc+","+q3+"V"+uf+(0===whiskerWidth?"":"M"+posw0+","+lf+"H"+posw1+"M"+posw0+","+uf+"H"+posw1))})}function plotPoints(sel,axes,trace,t){var xa=axes.x,ya=axes.y,bdPos=t.bdPos,bPos=t.bPos,mode=trace.boxpoints||trace.points;Lib.seedPseudoRandom();var gPoints=sel.selectAll("g.points").data(mode?function(d){return d.forEach(function(v){v.t=t,v.trace=trace}),d}:[]);gPoints.enter().append("g").attr("class","points"),gPoints.exit().remove();var paths=gPoints.selectAll("path").data(function(d){var i,newJitter,pts="all"===mode?d.pts:d.pts.filter(function(pt){return pt.v<d.lf||pt.v>d.uf}),typicalSpread=Math.max((d.max-d.min)/10,d.q3-d.q1),minSpread=1e-9*typicalSpread,spreadLimit=typicalSpread*JITTERSPREAD,jitterFactors=[],maxJitterFactor=0;if(trace.jitter){if(0===typicalSpread)for(maxJitterFactor=1,jitterFactors=new Array(pts.length),i=0;i<pts.length;i++)jitterFactors[i]=1;else for(i=0;i<pts.length;i++){var i0=Math.max(0,i-JITTERCOUNT),pmin=pts[i0].v,i1=Math.min(pts.length-1,i+JITTERCOUNT),pmax=pts[i1].v;"all"!==mode&&(pts[i].v<d.lf?pmax=Math.min(pmax,d.lf):pmin=Math.max(pmin,d.uf));var jitterFactor=Math.sqrt(spreadLimit*(i1-i0)/(pmax-pmin+minSpread))||0;jitterFactor=Lib.constrain(Math.abs(jitterFactor),0,1),jitterFactors.push(jitterFactor),maxJitterFactor=Math.max(jitterFactor,maxJitterFactor)}newJitter=2*trace.jitter/(maxJitterFactor||1)}for(i=0;i<pts.length;i++){var pt=pts[i],v=pt.v,jitterOffset=trace.jitter?newJitter*jitterFactors[i]*(Lib.pseudoRandom()-.5):0,posPx=d.pos+bPos+bdPos*(trace.pointpos+jitterOffset);"h"===trace.orientation?(pt.y=posPx,pt.x=v):(pt.x=posPx,pt.y=v),"suspectedoutliers"===mode&&v<d.uo&&v>d.lo&&(pt.so=!0)}return pts});paths.enter().append("path").classed("point",!0),paths.exit().remove(),paths.call(Drawing.translatePoints,xa,ya)}function plotBoxMean(sel,axes,trace,t){var bdPos0,bdPos1,posAxis=axes.pos,valAxis=axes.val,bPos=t.bPos,bPosPxOffset=t.bPosPxOffset||0,mode=trace.boxmean||(trace.meanline||{}).visible;Array.isArray(t.bdPos)?(bdPos0=t.bdPos[0],bdPos1=t.bdPos[1]):(bdPos0=t.bdPos,bdPos1=t.bdPos);var paths=sel.selectAll("path.mean").data("box"===trace.type&&trace.boxmean||"violin"===trace.type&&trace.box.visible&&trace.meanline.visible?Lib.identity:[]);paths.enter().append("path").attr("class","mean").style({fill:"none","vector-effect":"non-scaling-stroke"}),paths.exit().remove(),paths.each(function(d){var posc=posAxis.c2p(d.pos+bPos,!0)+bPosPxOffset,pos0=posAxis.c2p(d.pos+bPos-bdPos0,!0)+bPosPxOffset,pos1=posAxis.c2p(d.pos+bPos+bdPos1,!0)+bPosPxOffset,m=valAxis.c2p(d.mean,!0),sl=valAxis.c2p(d.mean-d.sd,!0),sh=valAxis.c2p(d.mean+d.sd,!0);"h"===trace.orientation?d3.select(this).attr("d","M"+m+","+pos0+"V"+pos1+("sd"===mode?"m0,0L"+sl+","+posc+"L"+m+","+pos0+"L"+sh+","+posc+"Z":"")):d3.select(this).attr("d","M"+pos0+","+m+"H"+pos1+("sd"===mode?"m0,0L"+posc+","+sl+"L"+pos0+","+m+"L"+posc+","+sh+"Z":""))})}module.exports={plot:function plot(gd,plotinfo,cdbox,boxLayer){var fullLayout=gd._fullLayout,xa=plotinfo.xaxis,ya=plotinfo.yaxis,numBoxes=fullLayout._numBoxes,groupFraction=1-fullLayout.boxgap,group="group"===fullLayout.boxmode&&numBoxes>1;Lib.makeTraceGroups(boxLayer,cdbox,"trace boxes").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],t=cd0.t,trace=cd0.trace;plotinfo.isRangePlot||(cd0.node3=plotGroup);var posAxis,valAxis,bdPos=t.dPos*groupFraction*(1-fullLayout.boxgroupgap)/(group?numBoxes:1),bPos=group?2*t.dPos*((t.num+.5)/numBoxes-.5)*groupFraction:0,wdPos=bdPos*trace.whiskerwidth;!0!==trace.visible||t.empty?plotGroup.remove():("h"===trace.orientation?(posAxis=ya,valAxis=xa):(posAxis=xa,valAxis=ya),t.bPos=bPos,t.bdPos=bdPos,t.wdPos=wdPos,t.wHover=t.dPos*(group?groupFraction/numBoxes:1),plotBoxAndWhiskers(plotGroup,{pos:posAxis,val:valAxis},trace,t),plotPoints(plotGroup,{x:xa,y:ya},trace,t),plotBoxMean(plotGroup,{pos:posAxis,val:valAxis},trace,t))})},plotBoxAndWhiskers:plotBoxAndWhiskers,plotPoints:plotPoints,plotBoxMean:plotBoxMean}},{"../../components/drawing":592,"../../lib":693,d3:147}],866:[function(_dereq_,module,exports){"use strict";module.exports=function selectPoints(searchInfo,selectionTester){var i,j,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[];if(!1===selectionTester)for(i=0;i<cd.length;i++)for(j=0;j<(cd[i].pts||[]).length;j++)cd[i].pts[j].selected=0;else for(i=0;i<cd.length;i++)for(j=0;j<(cd[i].pts||[]).length;j++){var pt=cd[i].pts[j],x=xa.c2p(pt.x),y=ya.c2p(pt.y);selectionTester.contains([x,y],null,pt.i,searchInfo)?(selection.push({pointNumber:pt.i,x:xa.c2d(pt.x),y:ya.c2d(pt.y)}),pt.selected=1):pt.selected=0}return selection}},{}],867:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing");module.exports={style:function style(gd,cd){var s=cd?cd[0].node3:d3.select(gd).selectAll("g.trace.boxes");s.style("opacity",function(d){return d[0].trace.opacity}),s.each(function(d){var el=d3.select(this),trace=d[0].trace,lineWidth=trace.line.width;function styleBox(boxSel,lineWidth,lineColor,fillColor){boxSel.style("stroke-width",lineWidth+"px").call(Color.stroke,lineColor).call(Color.fill,fillColor)}var allBoxes=el.selectAll("path.box");if("candlestick"===trace.type)allBoxes.each(function(boxData){var thisBox=d3.select(this),container=trace[boxData.dir];styleBox(thisBox,container.line.width,container.line.color,container.fillcolor),thisBox.style("opacity",trace.selectedpoints&&!boxData.selected?.3:1)});else{styleBox(allBoxes,lineWidth,trace.line.color,trace.fillcolor),el.selectAll("path.mean").style({"stroke-width":lineWidth,"stroke-dasharray":2*lineWidth+"px,"+lineWidth+"px"}).call(Color.stroke,trace.line.color);var pts=el.selectAll("path.point");Drawing.pointStyle(pts,trace,gd)}})},styleOnSelect:function styleOnSelect(gd,cd){var s=cd[0].node3,trace=cd[0].trace,pts=s.selectAll("path.point");trace.selectedpoints?Drawing.selectedPointStyle(pts,trace):Drawing.pointStyle(pts,trace,gd)}}},{"../../components/color":567,"../../components/drawing":592,d3:147}],868:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../../lib").extendFlat,OHLCattrs=_dereq_("../ohlc/attributes"),boxAttrs=_dereq_("../box/attributes");function directionAttrs(lineColorDefault){return{line:{color:extendFlat({},boxAttrs.line.color,{dflt:lineColorDefault}),width:boxAttrs.line.width,editType:"style"},fillcolor:boxAttrs.fillcolor,editType:"style"}}module.exports={x:OHLCattrs.x,open:OHLCattrs.open,high:OHLCattrs.high,low:OHLCattrs.low,close:OHLCattrs.close,line:{width:extendFlat({},boxAttrs.line.width,{}),editType:"style"},increasing:directionAttrs(OHLCattrs.increasing.line.color.dflt),decreasing:directionAttrs(OHLCattrs.decreasing.line.color.dflt),text:OHLCattrs.text,whiskerwidth:extendFlat({},boxAttrs.whiskerwidth,{dflt:0})}},{"../../lib":693,"../box/attributes":856,"../ohlc/attributes":987}],869:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),calcCommon=_dereq_("../ohlc/calc").calcCommon;function ptFunc(o,h,l,c){return{min:l,q1:Math.min(o,c),med:c,q3:Math.max(o,c),max:h}}module.exports=function(gd,trace){var fullLayout=gd._fullLayout,xa=Axes.getFromId(gd,trace.xaxis),ya=Axes.getFromId(gd,trace.yaxis),x=xa.makeCalcdata(trace,"x"),cd=calcCommon(gd,trace,x,ya,ptFunc);return cd.length?(Lib.extendFlat(cd[0].t,{num:fullLayout._numBoxes,dPos:Lib.distinctVals(x).minDiff/2,posLetter:"x",valLetter:"y"}),fullLayout._numBoxes++,cd):[{t:{empty:!0}}]}},{"../../lib":693,"../../plots/cartesian/axes":742,"../ohlc/calc":988}],870:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),handleOHLC=_dereq_("../ohlc/ohlc_defaults"),attributes=_dereq_("./attributes");function handleDirection(traceIn,traceOut,coerce,direction){var lineColor=coerce(direction+".line.color");coerce(direction+".line.width",traceOut.line.width),coerce(direction+".fillcolor",Color.addOpacity(lineColor,.5))}module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleOHLC(traceIn,traceOut,coerce,layout)?(coerce("line.width"),handleDirection(traceIn,traceOut,coerce,"increasing"),handleDirection(traceIn,traceOut,coerce,"decreasing"),coerce("text"),coerce("whiskerwidth"),layout._requestRangeslider[traceOut.xaxis]=!0):traceOut.visible=!1}},{"../../components/color":567,"../../lib":693,"../ohlc/ohlc_defaults":992,"./attributes":868}],871:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"candlestick",basePlotModule:_dereq_("../../plots/cartesian"),categories:["cartesian","svg","showLegend","candlestick","boxLayout"],meta:{},attributes:_dereq_("./attributes"),layoutAttributes:_dereq_("../box/layout_attributes"),supplyLayoutDefaults:_dereq_("../box/layout_defaults").supplyLayoutDefaults,crossTraceCalc:_dereq_("../box/cross_trace_calc").crossTraceCalc,supplyDefaults:_dereq_("./defaults"),calc:_dereq_("./calc"),plot:_dereq_("../box/plot").plot,layerName:"boxlayer",style:_dereq_("../box/style").style,hoverPoints:_dereq_("../ohlc/hover"),selectPoints:_dereq_("../ohlc/select")}},{"../../plots/cartesian":753,"../box/cross_trace_calc":858,"../box/layout_attributes":863,"../box/layout_defaults":864,"../box/plot":865,"../box/style":867,"../ohlc/hover":990,"../ohlc/select":994,"./attributes":868,"./calc":869,"./defaults":870}],872:[function(_dereq_,module,exports){"use strict";var handleAxisDefaults=_dereq_("./axis_defaults");module.exports=function handleABDefaults(traceIn,traceOut,fullLayout,coerce,dfltColor){coerce("a")||(coerce("da"),coerce("a0")),coerce("b")||(coerce("db"),coerce("b0")),function mimickAxisDefaults(traceIn,traceOut,fullLayout,dfltColor){["aaxis","baxis"].forEach(function(axName){var axLetter=axName.charAt(0),axIn=traceIn[axName]||{},axOut={},defaultOptions={tickfont:"x",id:axLetter+"axis",letter:axLetter,font:traceOut.font,name:axName,data:traceIn[axLetter],calendar:traceOut.calendar,dfltColor:dfltColor,bgColor:fullLayout.paper_bgcolor,fullLayout:fullLayout};handleAxisDefaults(axIn,axOut,defaultOptions),axOut._categories=axOut._categories||[],traceOut[axName]=axOut,traceIn[axName]||"-"===axIn.type||(traceIn[axName]={type:axIn.type})})}(traceIn,traceOut,fullLayout,dfltColor)}},{"./axis_defaults":877}],873:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function(a){return function minMax(a,depth){if(!isArrayOrTypedArray(a)||depth>=10)return null;var min=1/0;var max=-1/0;var n=a.length;for(var i=0;i<n;i++){var datum=a[i];if(isArrayOrTypedArray(datum)){var result=minMax(datum,depth+1);result&&(min=Math.min(result[0],min),max=Math.max(result[1],max))}else min=Math.min(datum,min),max=Math.max(datum,max)}return[min,max]}(a,0)}},{"../../lib":693}],874:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),axisAttrs=_dereq_("./axis_attributes"),colorAttrs=_dereq_("../../components/color/attributes"),carpetFont=fontAttrs({editType:"calc"});carpetFont.family.dflt='"Open Sans", verdana, arial, sans-serif',carpetFont.size.dflt=12,carpetFont.color.dflt=colorAttrs.defaultLine,module.exports={carpet:{valType:"string",editType:"calc"},x:{valType:"data_array",editType:"calc+clearAxisTypes"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},a:{valType:"data_array",editType:"calc"},a0:{valType:"number",dflt:0,editType:"calc"},da:{valType:"number",dflt:1,editType:"calc"},b:{valType:"data_array",editType:"calc"},b0:{valType:"number",dflt:0,editType:"calc"},db:{valType:"number",dflt:1,editType:"calc"},cheaterslope:{valType:"number",dflt:1,editType:"calc"},aaxis:axisAttrs,baxis:axisAttrs,font:carpetFont,color:{valType:"color",dflt:colorAttrs.defaultLine,editType:"plot"}}},{"../../components/color/attributes":566,"../../plots/font_attributes":768,"./axis_attributes":876}],875:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function(carpet,carpetcd,a,b){var idx,tangent,tanIsoIdx,tanIsoPar,segment,refidx,p0,p1,v0,v1,start,end,range,axis=isArrayOrTypedArray(a)?"a":"b",smoothing=("a"===axis?carpet.aaxis:carpet.baxis).smoothing,toIdx="a"===axis?carpet.a2i:carpet.b2j,pt="a"===axis?a:b,iso="a"===axis?b:a,n="a"===axis?carpetcd.a.length:carpetcd.b.length,m="a"===axis?carpetcd.b.length:carpetcd.a.length,isoIdx=Math.floor("a"===axis?carpet.b2j(iso):carpet.a2i(iso)),xy="a"===axis?function(value){return carpet.evalxy([],value,isoIdx)}:function(value){return carpet.evalxy([],isoIdx,value)};smoothing&&(tanIsoIdx=Math.max(0,Math.min(m-2,isoIdx)),tanIsoPar=isoIdx-tanIsoIdx,tangent="a"===axis?function(i,ti){return carpet.dxydi([],i,tanIsoIdx,ti,tanIsoPar)}:function(j,tj){return carpet.dxydj([],tanIsoIdx,j,tanIsoPar,tj)});var vstart=toIdx(pt[0]),vend=toIdx(pt[1]),dir=vstart<vend?1:-1,tol=1e-8*(vend-vstart),dirfloor=dir>0?Math.floor:Math.ceil,dirceil=dir>0?Math.ceil:Math.floor,dirmin=dir>0?Math.min:Math.max,dirmax=dir>0?Math.max:Math.min,idx0=dirfloor(vstart+tol),idx1=dirceil(vend-tol),segments=[[p0=xy(vstart)]];for(idx=idx0;idx*dir<idx1*dir;idx+=dir)segment=[],start=dirmax(vstart,idx),range=(end=dirmin(vend,idx+dir))-start,refidx=Math.max(0,Math.min(n-2,Math.floor(.5*(start+end)))),p1=xy(end),smoothing&&(v0=tangent(refidx,start-refidx),v1=tangent(refidx,end-refidx),segment.push([p0[0]+v0[0]/3*range,p0[1]+v0[1]/3*range]),segment.push([p1[0]-v1[0]/3*range,p1[1]-v1[1]/3*range])),segment.push(p1),segments.push(segment),p0=p1;return segments}},{"../../lib":693}],876:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),colorAttrs=_dereq_("../../components/color/attributes"),axesAttrs=_dereq_("../../plots/cartesian/layout_attributes"),overrideAll=_dereq_("../../plot_api/edit_types").overrideAll;module.exports={color:{valType:"color",editType:"calc"},smoothing:{valType:"number",dflt:1,min:0,max:1.3,editType:"calc"},title:{valType:"string",editType:"calc"},titlefont:fontAttrs({editType:"calc"}),titleoffset:{valType:"number",dflt:10,editType:"calc"},type:{valType:"enumerated",values:["-","linear","date","category"],dflt:"-",editType:"calc"},autorange:{valType:"enumerated",values:[!0,!1,"reversed"],dflt:!0,editType:"calc"},rangemode:{valType:"enumerated",values:["normal","tozero","nonnegative"],dflt:"normal",editType:"calc"},range:{valType:"info_array",editType:"calc",items:[{valType:"any",editType:"calc"},{valType:"any",editType:"calc"}]},fixedrange:{valType:"boolean",dflt:!1,editType:"calc"},cheatertype:{valType:"enumerated",values:["index","value"],dflt:"value",editType:"calc"},tickmode:{valType:"enumerated",values:["linear","array"],dflt:"array",editType:"calc"},nticks:{valType:"integer",min:0,dflt:0,editType:"calc"},tickvals:{valType:"data_array",editType:"calc"},ticktext:{valType:"data_array",editType:"calc"},showticklabels:{valType:"enumerated",values:["start","end","both","none"],dflt:"start",editType:"calc"},tickfont:fontAttrs({editType:"calc"}),tickangle:{valType:"angle",dflt:"auto",editType:"calc"},tickprefix:{valType:"string",dflt:"",editType:"calc"},showtickprefix:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"calc"},ticksuffix:{valType:"string",dflt:"",editType:"calc"},showticksuffix:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"calc"},showexponent:{valType:"enumerated",values:["all","first","last","none"],dflt:"all",editType:"calc"},exponentformat:{valType:"enumerated",values:["none","e","E","power","SI","B"],dflt:"B",editType:"calc"},separatethousands:{valType:"boolean",dflt:!1,editType:"calc"},tickformat:{valType:"string",dflt:"",editType:"calc"},tickformatstops:overrideAll(axesAttrs.tickformatstops,"calc","from-root"),categoryorder:{valType:"enumerated",values:["trace","category ascending","category descending","array"],dflt:"trace",editType:"calc"},categoryarray:{valType:"data_array",editType:"calc"},labelpadding:{valType:"integer",dflt:10,editType:"calc"},labelprefix:{valType:"string",editType:"calc"},labelsuffix:{valType:"string",dflt:"",editType:"calc"},showline:{valType:"boolean",dflt:!1,editType:"calc"},linecolor:{valType:"color",dflt:colorAttrs.defaultLine,editType:"calc"},linewidth:{valType:"number",min:0,dflt:1,editType:"calc"},gridcolor:{valType:"color",editType:"calc"},gridwidth:{valType:"number",min:0,dflt:1,editType:"calc"},showgrid:{valType:"boolean",dflt:!0,editType:"calc"},minorgridcount:{valType:"integer",min:0,dflt:0,editType:"calc"},minorgridwidth:{valType:"number",min:0,dflt:1,editType:"calc"},minorgridcolor:{valType:"color",dflt:colorAttrs.lightLine,editType:"calc"},startline:{valType:"boolean",editType:"calc"},startlinecolor:{valType:"color",editType:"calc"},startlinewidth:{valType:"number",dflt:1,editType:"calc"},endline:{valType:"boolean",editType:"calc"},endlinewidth:{valType:"number",dflt:1,editType:"calc"},endlinecolor:{valType:"color",editType:"calc"},tick0:{valType:"number",min:0,dflt:0,editType:"calc"},dtick:{valType:"number",min:0,dflt:1,editType:"calc"},arraytick0:{valType:"integer",min:0,dflt:0,editType:"calc"},arraydtick:{valType:"integer",min:1,dflt:1,editType:"calc"},editType:"calc"}},{"../../components/color/attributes":566,"../../plot_api/edit_types":725,"../../plots/cartesian/layout_attributes":754,"../../plots/font_attributes":768}],877:[function(_dereq_,module,exports){"use strict";var carpetAttrs=_dereq_("./attributes"),addOpacity=_dereq_("../../components/color").addOpacity,Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),handleTickValueDefaults=_dereq_("../../plots/cartesian/tick_value_defaults"),handleTickLabelDefaults=_dereq_("../../plots/cartesian/tick_label_defaults"),handleCategoryOrderDefaults=_dereq_("../../plots/cartesian/category_order_defaults"),setConvert=_dereq_("../../plots/cartesian/set_convert"),autoType=_dereq_("../../plots/cartesian/axis_autotype");module.exports=function handleAxisDefaults(containerIn,containerOut,options){var letter=options.letter,font=options.font||{},attributes=carpetAttrs[letter+"axis"];function coerce(attr,dflt){return Lib.coerce(containerIn,containerOut,attributes,attr,dflt)}function coerce2(attr,dflt){return Lib.coerce2(containerIn,containerOut,attributes,attr,dflt)}options.name&&(containerOut._name=options.name,containerOut._id=options.name);var axType=coerce("type");("-"===axType&&(options.data&&function setAutoType(ax,data){if("-"!==ax.type)return;var axLetter=ax._id.charAt(0),calendar=ax[axLetter+"calendar"];ax.type=autoType(data,calendar)}(containerOut,options.data),"-"===containerOut.type?containerOut.type="linear":axType=containerIn.type=containerOut.type),coerce("smoothing"),coerce("cheatertype"),coerce("showticklabels"),coerce("labelprefix",letter+" = "),coerce("labelsuffix"),coerce("showtickprefix"),coerce("showticksuffix"),coerce("separatethousands"),coerce("tickformat"),coerce("exponentformat"),coerce("showexponent"),coerce("categoryorder"),coerce("tickmode"),coerce("tickvals"),coerce("ticktext"),coerce("tick0"),coerce("dtick"),"array"===containerOut.tickmode&&(coerce("arraytick0"),coerce("arraydtick")),coerce("labelpadding"),containerOut._hovertitle=letter,"date"===axType)&&Registry.getComponentMethod("calendars","handleDefaults")(containerIn,containerOut,"calendar",options.calendar);setConvert(containerOut,options.fullLayout),containerOut.c2p=Lib.identity;var dfltColor=coerce("color",options.dfltColor),dfltFontColor=dfltColor===containerIn.color?dfltColor:font.color;coerce("title"),Lib.coerceFont(coerce,"titlefont",{family:font.family,size:Math.round(1.2*font.size),color:dfltFontColor}),coerce("titleoffset"),coerce("tickangle"),coerce("autorange",!containerOut.isValidRange(containerIn.range))&&coerce("rangemode"),coerce("range"),containerOut.cleanRange(),coerce("fixedrange"),handleTickValueDefaults(containerIn,containerOut,coerce,axType),handleTickLabelDefaults(containerIn,containerOut,coerce,axType,options),handleCategoryOrderDefaults(containerIn,containerOut,coerce,{data:options.data,dataAttr:letter});var gridColor=coerce2("gridcolor",addOpacity(dfltColor,.3)),gridWidth=coerce2("gridwidth"),showGrid=coerce("showgrid");showGrid||(delete containerOut.gridcolor,delete containerOut.gridwidth);var startLineColor=coerce2("startlinecolor",dfltColor),startLineWidth=coerce2("startlinewidth",gridWidth);coerce("startline",containerOut.showgrid||!!startLineColor||!!startLineWidth)||(delete containerOut.startlinecolor,delete containerOut.startlinewidth);var endLineColor=coerce2("endlinecolor",dfltColor),endLineWidth=coerce2("endlinewidth",gridWidth);return coerce("endline",containerOut.showgrid||!!endLineColor||!!endLineWidth)||(delete containerOut.endlinecolor,delete containerOut.endlinewidth),showGrid?(coerce("minorgridcount"),coerce("minorgridwidth",gridWidth),coerce("minorgridcolor",addOpacity(gridColor,.06)),containerOut.minorgridcount||(delete containerOut.minorgridwidth,delete containerOut.minorgridcolor)):(delete containerOut.gridcolor,delete containerOut.gridWidth),"none"===containerOut.showticklabels&&(delete containerOut.tickfont,delete containerOut.tickangle,delete containerOut.showexponent,delete containerOut.exponentformat,delete containerOut.tickformat,delete containerOut.showticksuffix,delete containerOut.showtickprefix),containerOut.showticksuffix||delete containerOut.ticksuffix,containerOut.showtickprefix||delete containerOut.tickprefix,coerce("tickmode"),(!containerOut.title||containerOut.title&&0===containerOut.title.length)&&(delete containerOut.titlefont,delete containerOut.titleoffset),containerOut}},{"../../components/color":567,"../../lib":693,"../../plots/cartesian/axis_autotype":743,"../../plots/cartesian/category_order_defaults":746,"../../plots/cartesian/set_convert":760,"../../plots/cartesian/tick_label_defaults":761,"../../plots/cartesian/tick_value_defaults":763,"../../registry":825,"./attributes":874}],878:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),isArray1D=_dereq_("../../lib").isArray1D,cheaterBasis=_dereq_("./cheater_basis"),arrayMinmax=_dereq_("./array_minmax"),calcGridlines=_dereq_("./calc_gridlines"),calcLabels=_dereq_("./calc_labels"),calcClipPath=_dereq_("./calc_clippath"),clean2dArray=_dereq_("../heatmap/clean_2d_array"),smoothFill2dArray=_dereq_("./smooth_fill_2d_array"),convertColumnData=_dereq_("../heatmap/convert_column_xyz"),setConvert=_dereq_("./set_convert");module.exports=function calc(gd,trace){var xa=Axes.getFromId(gd,trace.xaxis),ya=Axes.getFromId(gd,trace.yaxis),aax=trace.aaxis,bax=trace.baxis,x=trace.x,y=trace.y,cols=[];x&&isArray1D(x)&&cols.push("x"),y&&isArray1D(y)&&cols.push("y"),cols.length&&convertColumnData(trace,aax,bax,"a","b",cols);var a=trace._a=trace._a||trace.a,b=trace._b=trace._b||trace.b;x=trace._x||trace.x,y=trace._y||trace.y;var t={};if(trace._cheater){var avals="index"===aax.cheatertype?a.length:a,bvals="index"===bax.cheatertype?b.length:b;x=cheaterBasis(avals,bvals,trace.cheaterslope)}trace._x=x=clean2dArray(x),trace._y=y=clean2dArray(y),smoothFill2dArray(x,a,b),smoothFill2dArray(y,a,b),setConvert(trace),trace.setScale();var xrange=arrayMinmax(x),yrange=arrayMinmax(y),dx=.5*(xrange[1]-xrange[0]),xc=.5*(xrange[1]+xrange[0]),dy=.5*(yrange[1]-yrange[0]),yc=.5*(yrange[1]+yrange[0]);return xrange=[xc-1.3*dx,xc+1.3*dx],yrange=[yc-1.3*dy,yc+1.3*dy],trace._extremes[xa._id]=Axes.findExtremes(xa,xrange,{padded:!0}),trace._extremes[ya._id]=Axes.findExtremes(ya,yrange,{padded:!0}),calcGridlines(trace,"a","b"),calcGridlines(trace,"b","a"),calcLabels(trace,aax),calcLabels(trace,bax),t.clipsegments=calcClipPath(trace._xctrl,trace._yctrl,aax,bax),t.x=x,t.y=y,t.a=a,t.b=b,[t]}},{"../../lib":693,"../../plots/cartesian/axes":742,"../heatmap/clean_2d_array":944,"../heatmap/convert_column_xyz":946,"./array_minmax":873,"./calc_clippath":879,"./calc_gridlines":880,"./calc_labels":881,"./cheater_basis":883,"./set_convert":896,"./smooth_fill_2d_array":897}],879:[function(_dereq_,module,exports){"use strict";module.exports=function makeClipPath(xctrl,yctrl,aax,bax){var i,x,y,segments=[],asmoothing=!!aax.smoothing,bsmoothing=!!bax.smoothing,nea1=xctrl[0].length-1,neb1=xctrl.length-1;for(i=0,x=[],y=[];i<=nea1;i++)x[i]=xctrl[0][i],y[i]=yctrl[0][i];for(segments.push({x:x,y:y,bicubic:asmoothing}),i=0,x=[],y=[];i<=neb1;i++)x[i]=xctrl[i][nea1],y[i]=yctrl[i][nea1];for(segments.push({x:x,y:y,bicubic:bsmoothing}),i=nea1,x=[],y=[];i>=0;i--)x[nea1-i]=xctrl[neb1][i],y[nea1-i]=yctrl[neb1][i];for(segments.push({x:x,y:y,bicubic:asmoothing}),i=neb1,x=[],y=[];i>=0;i--)x[neb1-i]=xctrl[i][0],y[neb1-i]=yctrl[i][0];return segments.push({x:x,y:y,bicubic:bsmoothing}),segments}},{}],880:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=function calcGridlines(trace,axisLetter,crossAxisLetter){var i,j,j0,eps,bounds,n1,n2,n,value,v,j1,v0,v1,d,data=trace["_"+axisLetter],axis=trace[axisLetter+"axis"],gridlines=axis._gridlines=[],minorgridlines=axis._minorgridlines=[],boundarylines=axis._boundarylines=[],crossData=trace["_"+crossAxisLetter],crossAxis=trace[crossAxisLetter+"axis"];"array"===axis.tickmode&&(axis.tickvals=data.slice());var xcp=trace._xctrl,ycp=trace._yctrl,nea=xcp[0].length,neb=xcp.length,na=trace._a.length,nb=trace._b.length;Axes.prepTicks(axis),"array"===axis.tickmode&&delete axis.tickvals;var stride=axis.smoothing?3:1;function constructValueGridline(value){var i,j,j0,tj,pxy,i0,ti,xy,dxydi0,dxydi1,dxydj0,dxydj1,xpoints=[],ypoints=[],ret={};if("b"===axisLetter)for(j=trace.b2j(value),j0=Math.floor(Math.max(0,Math.min(nb-2,j))),tj=j-j0,ret.length=nb,ret.crossLength=na,ret.xy=function(i){return trace.evalxy([],i,j)},ret.dxy=function(i0,ti){return trace.dxydi([],i0,j0,ti,tj)},i=0;i<na;i++)i0=Math.min(na-2,i),ti=i-i0,xy=trace.evalxy([],i,j),crossAxis.smoothing&&i>0&&(dxydi0=trace.dxydi([],i-1,j0,0,tj),xpoints.push(pxy[0]+dxydi0[0]/3),ypoints.push(pxy[1]+dxydi0[1]/3),dxydi1=trace.dxydi([],i-1,j0,1,tj),xpoints.push(xy[0]-dxydi1[0]/3),ypoints.push(xy[1]-dxydi1[1]/3)),xpoints.push(xy[0]),ypoints.push(xy[1]),pxy=xy;else for(i=trace.a2i(value),i0=Math.floor(Math.max(0,Math.min(na-2,i))),ti=i-i0,ret.length=na,ret.crossLength=nb,ret.xy=function(j){return trace.evalxy([],i,j)},ret.dxy=function(j0,tj){return trace.dxydj([],i0,j0,ti,tj)},j=0;j<nb;j++)j0=Math.min(nb-2,j),tj=j-j0,xy=trace.evalxy([],i,j),crossAxis.smoothing&&j>0&&(dxydj0=trace.dxydj([],i0,j-1,ti,0),xpoints.push(pxy[0]+dxydj0[0]/3),ypoints.push(pxy[1]+dxydj0[1]/3),dxydj1=trace.dxydj([],i0,j-1,ti,1),xpoints.push(xy[0]-dxydj1[0]/3),ypoints.push(xy[1]-dxydj1[1]/3)),xpoints.push(xy[0]),ypoints.push(xy[1]),pxy=xy;return ret.axisLetter=axisLetter,ret.axis=axis,ret.crossAxis=crossAxis,ret.value=value,ret.constvar=crossAxisLetter,ret.index=n,ret.x=xpoints,ret.y=ypoints,ret.smoothing=crossAxis.smoothing,ret}function constructArrayGridline(idx){var j,i0,j0,ti,tj,xpoints=[],ypoints=[],ret={};if(ret.length=data.length,ret.crossLength=crossData.length,"b"===axisLetter)for(j0=Math.max(0,Math.min(nb-2,idx)),tj=Math.min(1,Math.max(0,idx-j0)),ret.xy=function(i){return trace.evalxy([],i,idx)},ret.dxy=function(i0,ti){return trace.dxydi([],i0,j0,ti,tj)},j=0;j<nea;j++)xpoints[j]=xcp[idx*stride][j],ypoints[j]=ycp[idx*stride][j];else for(i0=Math.max(0,Math.min(na-2,idx)),ti=Math.min(1,Math.max(0,idx-i0)),ret.xy=function(j){return trace.evalxy([],idx,j)},ret.dxy=function(j0,tj){return trace.dxydj([],i0,j0,ti,tj)},j=0;j<neb;j++)xpoints[j]=xcp[j][idx*stride],ypoints[j]=ycp[j][idx*stride];return ret.axisLetter=axisLetter,ret.axis=axis,ret.crossAxis=crossAxis,ret.value=data[idx],ret.constvar=crossAxisLetter,ret.index=idx,ret.x=xpoints,ret.y=ypoints,ret.smoothing=crossAxis.smoothing,ret}if("array"===axis.tickmode){for(eps=5e-15,n1=(bounds=[Math.floor((data.length-1-axis.arraytick0)/axis.arraydtick*(1+eps)),Math.ceil(-axis.arraytick0/axis.arraydtick/(1+eps))].sort(function(a,b){return a-b}))[0]-1,n2=bounds[1]+1,n=n1;n<n2;n++)(j=axis.arraytick0+axis.arraydtick*n)<0||j>data.length-1||gridlines.push(extendFlat(constructArrayGridline(j),{color:axis.gridcolor,width:axis.gridwidth}));for(n=n1;n<n2;n++)if(j0=axis.arraytick0+axis.arraydtick*n,j1=Math.min(j0+axis.arraydtick,data.length-1),!(j0<0||j0>data.length-1||j1<0||j1>data.length-1))for(v0=data[j0],v1=data[j1],i=0;i<axis.minorgridcount;i++)(d=j1-j0)<=0||(v=v0+(v1-v0)*(i+1)/(axis.minorgridcount+1)*(axis.arraydtick/d))<data[0]||v>data[data.length-1]||minorgridlines.push(extendFlat(constructValueGridline(v),{color:axis.minorgridcolor,width:axis.minorgridwidth}));axis.startline&&boundarylines.push(extendFlat(constructArrayGridline(0),{color:axis.startlinecolor,width:axis.startlinewidth})),axis.endline&&boundarylines.push(extendFlat(constructArrayGridline(data.length-1),{color:axis.endlinecolor,width:axis.endlinewidth}))}else{for(eps=5e-15,n1=(bounds=[Math.floor((data[data.length-1]-axis.tick0)/axis.dtick*(1+eps)),Math.ceil((data[0]-axis.tick0)/axis.dtick/(1+eps))].sort(function(a,b){return a-b}))[0],n2=bounds[1],n=n1;n<=n2;n++)value=axis.tick0+axis.dtick*n,gridlines.push(extendFlat(constructValueGridline(value),{color:axis.gridcolor,width:axis.gridwidth}));for(n=n1-1;n<n2+1;n++)for(value=axis.tick0+axis.dtick*n,i=0;i<axis.minorgridcount;i++)(v=value+axis.dtick*(i+1)/(axis.minorgridcount+1))<data[0]||v>data[data.length-1]||minorgridlines.push(extendFlat(constructValueGridline(v),{color:axis.minorgridcolor,width:axis.minorgridwidth}));axis.startline&&boundarylines.push(extendFlat(constructValueGridline(data[0]),{color:axis.startlinecolor,width:axis.startlinewidth})),axis.endline&&boundarylines.push(extendFlat(constructValueGridline(data[data.length-1]),{color:axis.endlinecolor,width:axis.endlinewidth}))}}},{"../../lib/extend":682,"../../plots/cartesian/axes":742}],881:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=function calcLabels(trace,axis){var i,tobj,gridline,labels=axis._labels=[],gridlines=axis._gridlines;for(i=0;i<gridlines.length;i++)gridline=gridlines[i],-1!==["start","both"].indexOf(axis.showticklabels)&&(tobj=Axes.tickText(axis,gridline.value),extendFlat(tobj,{prefix:void 0,suffix:void 0,endAnchor:!0,xy:gridline.xy(0),dxy:gridline.dxy(0,0),axis:gridline.axis,length:gridline.crossAxis.length,font:gridline.axis.tickfont,isFirst:0===i,isLast:i===gridlines.length-1}),labels.push(tobj)),-1!==["end","both"].indexOf(axis.showticklabels)&&(tobj=Axes.tickText(axis,gridline.value),extendFlat(tobj,{endAnchor:!1,xy:gridline.xy(gridline.crossLength-1),dxy:gridline.dxy(gridline.crossLength-2,1),axis:gridline.axis,length:gridline.crossAxis.length,font:gridline.axis.tickfont,isFirst:0===i,isLast:i===gridlines.length-1}),labels.push(tobj))}},{"../../lib/extend":682,"../../plots/cartesian/axes":742}],882:[function(_dereq_,module,exports){"use strict";module.exports=function makeControlPoints(p0,p1,p2,smoothness){var d1x=p0[0]-p1[0],d1y=p0[1]-p1[1],d2x=p2[0]-p1[0],d2y=p2[1]-p1[1],d1a=Math.pow(d1x*d1x+d1y*d1y,.25),d2a=Math.pow(d2x*d2x+d2y*d2y,.25),numx=(d2a*d2a*d1x-d1a*d1a*d2x)*smoothness,numy=(d2a*d2a*d1y-d1a*d1a*d2y)*smoothness,denom1=d2a*(d1a+d2a)*3,denom2=d1a*(d1a+d2a)*3;return[[p1[0]+(denom1&&numx/denom1),p1[1]+(denom1&&numy/denom1)],[p1[0]-(denom2&&numx/denom2),p1[1]-(denom2&&numy/denom2)]]}},{}],883:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function(a,b,cheaterslope){var i,j,ascal,bscal,bval,xval,data=[],na=isArrayOrTypedArray(a)?a.length:a,nb=isArrayOrTypedArray(b)?b.length:b,adata=isArrayOrTypedArray(a)?a:null,bdata=isArrayOrTypedArray(b)?b:null;adata&&(ascal=(adata.length-1)/(adata[adata.length-1]-adata[0])/(na-1)),bdata&&(bscal=(bdata.length-1)/(bdata[bdata.length-1]-bdata[0])/(nb-1));var xmin=1/0,xmax=-1/0;for(j=0;j<nb;j++)for(data[j]=[],bval=bdata?(bdata[j]-bdata[0])*bscal:j/(nb-1),i=0;i<na;i++)xval=(adata?(adata[i]-adata[0])*ascal:i/(na-1))-bval*cheaterslope,xmin=Math.min(xval,xmin),xmax=Math.max(xval,xmax),data[j][i]=xval;var slope=1/(xmax-xmin),offset=-xmin*slope;for(j=0;j<nb;j++)for(i=0;i<na;i++)data[j][i]=slope*data[j][i]+offset;return data}},{"../../lib":693}],884:[function(_dereq_,module,exports){"use strict";var makeControlPoints=_dereq_("./catmull_rom"),ensureArray=_dereq_("../../lib").ensureArray;function inferCubicControlPoint(p0,p2,p3){var p2e0=-.5*p3[0]+1.5*p2[0],p2e1=-.5*p3[1]+1.5*p2[1];return[(2*p2e0+p0[0])/3,(2*p2e1+p0[1])/3]}module.exports=function computeControlPoints(xe,ye,x,y,asmoothing,bsmoothing){var i,j,ie,je,xej,yej,xj,yj,cp,p1,na=x[0].length,nb=x.length,nea=asmoothing?3*na-2:na,neb=bsmoothing?3*nb-2:nb;for(xe=ensureArray(xe,neb),ye=ensureArray(ye,neb),ie=0;ie<neb;ie++)xe[ie]=ensureArray(xe[ie],nea),ye[ie]=ensureArray(ye[ie],nea);for(j=0,je=0;j<nb;j++,je+=bsmoothing?3:1)for(xej=xe[je],yej=ye[je],xj=x[j],yj=y[j],i=0,ie=0;i<na;i++,ie+=asmoothing?3:1)xej[ie]=xj[i],yej[ie]=yj[i];if(asmoothing)for(j=0,je=0;j<nb;j++,je+=bsmoothing?3:1){for(i=1,ie=3;i<na-1;i++,ie+=3)cp=makeControlPoints([x[j][i-1],y[j][i-1]],[x[j][i],y[j][i]],[x[j][i+1],y[j][i+1]],asmoothing),xe[je][ie-1]=cp[0][0],ye[je][ie-1]=cp[0][1],xe[je][ie+1]=cp[1][0],ye[je][ie+1]=cp[1][1];p1=inferCubicControlPoint([xe[je][0],ye[je][0]],[xe[je][2],ye[je][2]],[xe[je][3],ye[je][3]]),xe[je][1]=p1[0],ye[je][1]=p1[1],p1=inferCubicControlPoint([xe[je][nea-1],ye[je][nea-1]],[xe[je][nea-3],ye[je][nea-3]],[xe[je][nea-4],ye[je][nea-4]]),xe[je][nea-2]=p1[0],ye[je][nea-2]=p1[1]}if(bsmoothing)for(ie=0;ie<nea;ie++){for(je=3;je<neb-3;je+=3)cp=makeControlPoints([xe[je-3][ie],ye[je-3][ie]],[xe[je][ie],ye[je][ie]],[xe[je+3][ie],ye[je+3][ie]],bsmoothing),xe[je-1][ie]=cp[0][0],ye[je-1][ie]=cp[0][1],xe[je+1][ie]=cp[1][0],ye[je+1][ie]=cp[1][1];p1=inferCubicControlPoint([xe[0][ie],ye[0][ie]],[xe[2][ie],ye[2][ie]],[xe[3][ie],ye[3][ie]]),xe[1][ie]=p1[0],ye[1][ie]=p1[1],p1=inferCubicControlPoint([xe[neb-1][ie],ye[neb-1][ie]],[xe[neb-3][ie],ye[neb-3][ie]],[xe[neb-4][ie],ye[neb-4][ie]]),xe[neb-2][ie]=p1[0],ye[neb-2][ie]=p1[1]}if(asmoothing&&bsmoothing)for(je=1;je<neb;je+=(je+1)%3==0?2:1){for(ie=3;ie<nea-3;ie+=3)cp=makeControlPoints([xe[je][ie-3],ye[je][ie-3]],[xe[je][ie],ye[je][ie]],[xe[je][ie+3],ye[je][ie+3]],asmoothing),xe[je][ie-1]=.5*(xe[je][ie-1]+cp[0][0]),ye[je][ie-1]=.5*(ye[je][ie-1]+cp[0][1]),xe[je][ie+1]=.5*(xe[je][ie+1]+cp[1][0]),ye[je][ie+1]=.5*(ye[je][ie+1]+cp[1][1]);p1=inferCubicControlPoint([xe[je][0],ye[je][0]],[xe[je][2],ye[je][2]],[xe[je][3],ye[je][3]]),xe[je][1]=.5*(xe[je][1]+p1[0]),ye[je][1]=.5*(ye[je][1]+p1[1]),p1=inferCubicControlPoint([xe[je][nea-1],ye[je][nea-1]],[xe[je][nea-3],ye[je][nea-3]],[xe[je][nea-4],ye[je][nea-4]]),xe[je][nea-2]=.5*(xe[je][nea-2]+p1[0]),ye[je][nea-2]=.5*(ye[je][nea-2]+p1[1])}return[xe,ye]}},{"../../lib":693,"./catmull_rom":882}],885:[function(_dereq_,module,exports){"use strict";module.exports={RELATIVE_CULL_TOLERANCE:1e-6}},{}],886:[function(_dereq_,module,exports){"use strict";module.exports=function(arrays,asmoothing,bsmoothing){return asmoothing&&bsmoothing?function(out,i0,j0,u,v){var f0,f1,f2,f3,ak,k;out||(out=[]),i0*=3,j0*=3;var u2=u*u,ou=1-u,ou2=ou*ou,ouu2=ou*u*2,a=-3*ou2,b=3*(ou2-ouu2),c=3*(ouu2-u2),d=3*u2,v2=v*v,v3=v2*v,ov=1-v,ov2=ov*ov,ov3=ov2*ov;for(k=0;k<arrays.length;k++)f0=a*(ak=arrays[k])[j0][i0]+b*ak[j0][i0+1]+c*ak[j0][i0+2]+d*ak[j0][i0+3],f1=a*ak[j0+1][i0]+b*ak[j0+1][i0+1]+c*ak[j0+1][i0+2]+d*ak[j0+1][i0+3],f2=a*ak[j0+2][i0]+b*ak[j0+2][i0+1]+c*ak[j0+2][i0+2]+d*ak[j0+2][i0+3],f3=a*ak[j0+3][i0]+b*ak[j0+3][i0+1]+c*ak[j0+3][i0+2]+d*ak[j0+3][i0+3],out[k]=ov3*f0+3*(ov2*v*f1+ov*v2*f2)+v3*f3;return out}:asmoothing?function(out,i0,j0,u,v){var f0,f1,k,ak;out||(out=[]),i0*=3;var u2=u*u,ou=1-u,ou2=ou*ou,ouu2=ou*u*2,a=-3*ou2,b=3*(ou2-ouu2),c=3*(ouu2-u2),d=3*u2,ov=1-v;for(k=0;k<arrays.length;k++)f0=a*(ak=arrays[k])[j0][i0]+b*ak[j0][i0+1]+c*ak[j0][i0+2]+d*ak[j0][i0+3],f1=a*ak[j0+1][i0]+b*ak[j0+1][i0+1]+c*ak[j0+1][i0+2]+d*ak[j0+1][i0+3],out[k]=ov*f0+v*f1;return out}:bsmoothing?function(out,i0,j0,u,v){var f0,f1,f2,f3,k,ak;out||(out=[]),j0*=3;var v2=v*v,v3=v2*v,ov=1-v,ov2=ov*ov,ov3=ov2*ov;for(k=0;k<arrays.length;k++)f0=(ak=arrays[k])[j0][i0+1]-ak[j0][i0],f1=ak[j0+1][i0+1]-ak[j0+1][i0],f2=ak[j0+2][i0+1]-ak[j0+2][i0],f3=ak[j0+3][i0+1]-ak[j0+3][i0],out[k]=ov3*f0+3*(ov2*v*f1+ov*v2*f2)+v3*f3;return out}:function(out,i0,j0,u,v){var f0,f1,k,ak;out||(out=[]);var ov=1-v;for(k=0;k<arrays.length;k++)f0=(ak=arrays[k])[j0][i0+1]-ak[j0][i0],f1=ak[j0+1][i0+1]-ak[j0+1][i0],out[k]=ov*f0+v*f1;return out}}},{}],887:[function(_dereq_,module,exports){"use strict";module.exports=function(arrays,asmoothing,bsmoothing){return asmoothing&&bsmoothing?function(out,i0,j0,u,v){var f0,f1,f2,f3,ak,k;out||(out=[]),i0*=3,j0*=3;var u2=u*u,u3=u2*u,ou=1-u,ou2=ou*ou,ou3=ou2*ou,v2=v*v,ov=1-v,ov2=ov*ov,ovv2=ov*v*2,a=-3*ov2,b=3*(ov2-ovv2),c=3*(ovv2-v2),d=3*v2;for(k=0;k<arrays.length;k++)f0=a*(ak=arrays[k])[j0][i0]+b*ak[j0+1][i0]+c*ak[j0+2][i0]+d*ak[j0+3][i0],f1=a*ak[j0][i0+1]+b*ak[j0+1][i0+1]+c*ak[j0+2][i0+1]+d*ak[j0+3][i0+1],f2=a*ak[j0][i0+2]+b*ak[j0+1][i0+2]+c*ak[j0+2][i0+2]+d*ak[j0+3][i0+2],f3=a*ak[j0][i0+3]+b*ak[j0+1][i0+3]+c*ak[j0+2][i0+3]+d*ak[j0+3][i0+3],out[k]=ou3*f0+3*(ou2*u*f1+ou*u2*f2)+u3*f3;return out}:asmoothing?function(out,i0,j0,v,u){var f0,f1,f2,f3,k,ak;out||(out=[]),i0*=3;var u2=u*u,u3=u2*u,ou=1-u,ou2=ou*ou,ou3=ou2*ou;for(k=0;k<arrays.length;k++)f0=(ak=arrays[k])[j0+1][i0]-ak[j0][i0],f1=ak[j0+1][i0+1]-ak[j0][i0+1],f2=ak[j0+1][i0+2]-ak[j0][i0+2],f3=ak[j0+1][i0+3]-ak[j0][i0+3],out[k]=ou3*f0+3*(ou2*u*f1+ou*u2*f2)+u3*f3;return out}:bsmoothing?function(out,i0,j0,u,v){var f0,f1,k,ak;out||(out=[]),j0*=3;var ou=1-u,v2=v*v,ov=1-v,ov2=ov*ov,ovv2=ov*v*2,a=-3*ov2,b=3*(ov2-ovv2),c=3*(ovv2-v2),d=3*v2;for(k=0;k<arrays.length;k++)f0=a*(ak=arrays[k])[j0][i0]+b*ak[j0+1][i0]+c*ak[j0+2][i0]+d*ak[j0+3][i0],f1=a*ak[j0][i0+1]+b*ak[j0+1][i0+1]+c*ak[j0+2][i0+1]+d*ak[j0+3][i0+1],out[k]=ou*f0+u*f1;return out}:function(out,i0,j0,v,u){var f0,f1,k,ak;out||(out=[]);var ov=1-v;for(k=0;k<arrays.length;k++)f0=(ak=arrays[k])[j0+1][i0]-ak[j0][i0],f1=ak[j0+1][i0+1]-ak[j0][i0+1],out[k]=ov*f0+v*f1;return out}}},{}],888:[function(_dereq_,module,exports){"use strict";module.exports=function(arrays,na,nb,asmoothing,bsmoothing){var imax=na-2,jmax=nb-2;return asmoothing&&bsmoothing?function(out,i,j){var f0,f1,f2,f3,ak,k;out||(out=[]);var i0=Math.max(0,Math.min(Math.floor(i),imax)),j0=Math.max(0,Math.min(Math.floor(j),jmax)),u=Math.max(0,Math.min(1,i-i0)),v=Math.max(0,Math.min(1,j-j0));i0*=3,j0*=3;var u2=u*u,u3=u2*u,ou=1-u,ou2=ou*ou,ou3=ou2*ou,v2=v*v,v3=v2*v,ov=1-v,ov2=ov*ov,ov3=ov2*ov;for(k=0;k<arrays.length;k++)f0=ou3*(ak=arrays[k])[j0][i0]+3*(ou2*u*ak[j0][i0+1]+ou*u2*ak[j0][i0+2])+u3*ak[j0][i0+3],f1=ou3*ak[j0+1][i0]+3*(ou2*u*ak[j0+1][i0+1]+ou*u2*ak[j0+1][i0+2])+u3*ak[j0+1][i0+3],f2=ou3*ak[j0+2][i0]+3*(ou2*u*ak[j0+2][i0+1]+ou*u2*ak[j0+2][i0+2])+u3*ak[j0+2][i0+3],f3=ou3*ak[j0+3][i0]+3*(ou2*u*ak[j0+3][i0+1]+ou*u2*ak[j0+3][i0+2])+u3*ak[j0+3][i0+3],out[k]=ov3*f0+3*(ov2*v*f1+ov*v2*f2)+v3*f3;return out}:asmoothing?function(out,i,j){out||(out=[]);var f0,f1,f2,f3,k,ak,i0=Math.max(0,Math.min(Math.floor(i),imax)),j0=Math.max(0,Math.min(Math.floor(j),jmax)),u=Math.max(0,Math.min(1,i-i0)),v=Math.max(0,Math.min(1,j-j0));i0*=3;var u2=u*u,u3=u2*u,ou=1-u,ou2=ou*ou,ou3=ou2*ou,ov=1-v;for(k=0;k<arrays.length;k++)f0=ov*(ak=arrays[k])[j0][i0]+v*ak[j0+1][i0],f1=ov*ak[j0][i0+1]+v*ak[j0+1][i0+1],f2=ov*ak[j0][i0+2]+v*ak[j0+1][i0+1],f3=ov*ak[j0][i0+3]+v*ak[j0+1][i0+1],out[k]=ou3*f0+3*(ou2*u*f1+ou*u2*f2)+u3*f3;return out}:bsmoothing?function(out,i,j){out||(out=[]);var f0,f1,f2,f3,k,ak,i0=Math.max(0,Math.min(Math.floor(i),imax)),j0=Math.max(0,Math.min(Math.floor(j),jmax)),u=Math.max(0,Math.min(1,i-i0)),v=Math.max(0,Math.min(1,j-j0));j0*=3;var v2=v*v,v3=v2*v,ov=1-v,ov2=ov*ov,ov3=ov2*ov,ou=1-u;for(k=0;k<arrays.length;k++)f0=ou*(ak=arrays[k])[j0][i0]+u*ak[j0][i0+1],f1=ou*ak[j0+1][i0]+u*ak[j0+1][i0+1],f2=ou*ak[j0+2][i0]+u*ak[j0+2][i0+1],f3=ou*ak[j0+3][i0]+u*ak[j0+3][i0+1],out[k]=ov3*f0+3*(ov2*v*f1+ov*v2*f2)+v3*f3;return out}:function(out,i,j){out||(out=[]);var f0,f1,k,ak,i0=Math.max(0,Math.min(Math.floor(i),imax)),j0=Math.max(0,Math.min(Math.floor(j),jmax)),u=Math.max(0,Math.min(1,i-i0)),v=Math.max(0,Math.min(1,j-j0)),ov=1-v,ou=1-u;for(k=0;k<arrays.length;k++)f0=ou*(ak=arrays[k])[j0][i0]+u*ak[j0][i0+1],f1=ou*ak[j0+1][i0]+u*ak[j0+1][i0+1],out[k]=ov*f0+v*f1;return out}}},{}],889:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleXYDefaults=_dereq_("./xy_defaults"),handleABDefaults=_dereq_("./ab_defaults"),attributes=_dereq_("./attributes"),colorAttrs=_dereq_("../../components/color/attributes");module.exports=function supplyDefaults(traceIn,traceOut,dfltColor,fullLayout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}traceOut._clipPathId="clip"+traceOut.uid+"carpet";var defaultColor=coerce("color",colorAttrs.defaultLine);(Lib.coerceFont(coerce,"font"),coerce("carpet"),handleABDefaults(traceIn,traceOut,fullLayout,coerce,defaultColor),traceOut.a&&traceOut.b)?(traceOut.a.length<3&&(traceOut.aaxis.smoothing=0),traceOut.b.length<3&&(traceOut.baxis.smoothing=0),handleXYDefaults(traceIn,traceOut,coerce)||(traceOut.visible=!1),traceOut._cheater&&coerce("cheaterslope")):traceOut.visible=!1}},{"../../components/color/attributes":566,"../../lib":693,"./ab_defaults":872,"./attributes":874,"./xy_defaults":898}],890:[function(_dereq_,module,exports){"use strict";var Carpet={};Carpet.attributes=_dereq_("./attributes"),Carpet.supplyDefaults=_dereq_("./defaults"),Carpet.plot=_dereq_("./plot"),Carpet.calc=_dereq_("./calc"),Carpet.animatable=!0,Carpet.isContainer=!0,Carpet.moduleType="trace",Carpet.name="carpet",Carpet.basePlotModule=_dereq_("../../plots/cartesian"),Carpet.categories=["cartesian","svg","carpet","carpetAxis","notLegendIsolatable"],Carpet.meta={},module.exports=Carpet},{"../../plots/cartesian":753,"./attributes":874,"./calc":878,"./defaults":889,"./plot":895}],891:[function(_dereq_,module,exports){"use strict";module.exports=function(gd,trace){for(var firstAxis,n=gd._fullData.length,i=0;i<n;i++){var maybeCarpet=gd._fullData[i];if(maybeCarpet.index!==trace.index&&("carpet"===maybeCarpet.type&&(firstAxis||(firstAxis=maybeCarpet),maybeCarpet.carpet===trace.carpet)))return maybeCarpet}return firstAxis}},{}],892:[function(_dereq_,module,exports){"use strict";module.exports=function makePath(xp,yp,isBicubic){if(0===xp.length)return"";var i,path=[],stride=isBicubic?3:1;for(i=0;i<xp.length;i+=stride)path.push(xp[i]+","+yp[i]),isBicubic&&i<xp.length-stride&&(path.push("C"),path.push([xp[i+1]+","+yp[i+1],xp[i+2]+","+yp[i+2]+" "].join(" ")));return path.join(isBicubic?"":"L")}},{}],893:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function mapArray(out,data,func){var i;for(isArrayOrTypedArray(out)?out.length>data.length&&(out=out.slice(0,data.length)):out=[],i=0;i<data.length;i++)out[i]=func(data[i]);return out}},{"../../lib":693}],894:[function(_dereq_,module,exports){"use strict";module.exports=function orientText(trace,xaxis,yaxis,xy,dxy,refDxy){var dx=dxy[0]*trace.dpdx(xaxis),dy=dxy[1]*trace.dpdy(yaxis),flip=1,offsetMultiplier=1;if(refDxy){var l1=Math.sqrt(dxy[0]*dxy[0]+dxy[1]*dxy[1]),l2=Math.sqrt(refDxy[0]*refDxy[0]+refDxy[1]*refDxy[1]),dot=(dxy[0]*refDxy[0]+dxy[1]*refDxy[1])/l1/l2;offsetMultiplier=Math.max(0,dot)}var angle=180*Math.atan2(dy,dx)/Math.PI;return angle<-90?(angle+=180,flip=-flip):angle>90&&(angle-=180,flip=-flip),{angle:angle,flip:flip,p:trace.c2p(xy,xaxis,yaxis),offsetMultplier:offsetMultiplier}}},{}],895:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),map1dArray=_dereq_("./map_1d_array"),makepath=_dereq_("./makepath"),orientText=_dereq_("./orient_text"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),Lib=_dereq_("../../lib"),alignmentConstants=_dereq_("../../constants/alignment");function drawGridLines(xaxis,yaxis,layer,axis,axisLetter,gridlines){var lineClass="const-"+axisLetter+"-lines",gridJoin=layer.selectAll("."+lineClass).data(gridlines);gridJoin.enter().append("path").classed(lineClass,!0).style("vector-effect","non-scaling-stroke"),gridJoin.each(function(d){var gridline=d,x=gridline.x,y=gridline.y,xp=map1dArray([],x,xaxis.c2p),yp=map1dArray([],y,yaxis.c2p),path="M"+makepath(xp,yp,gridline.smoothing);d3.select(this).attr("d",path).style("stroke-width",gridline.width).style("stroke",gridline.color).style("fill","none")}),gridJoin.exit().remove()}function drawAxisLabels(gd,xaxis,yaxis,trace,t,layer,labels,labelClass){var labelJoin=layer.selectAll("text."+labelClass).data(labels);labelJoin.enter().append("text").classed(labelClass,!0);var maxExtent=0,labelOrientation={};return labelJoin.each(function(label,i){var orientation;if("auto"===label.axis.tickangle)orientation=orientText(trace,xaxis,yaxis,label.xy,label.dxy);else{var angle=(label.axis.tickangle+180)*Math.PI/180;orientation=orientText(trace,xaxis,yaxis,label.xy,[Math.cos(angle),Math.sin(angle)])}i||(labelOrientation={angle:orientation.angle,flip:orientation.flip});var direction=(label.endAnchor?-1:1)*orientation.flip,labelEl=d3.select(this).attr({"text-anchor":direction>0?"start":"end","data-notex":1}).call(Drawing.font,label.font).text(label.text).call(svgTextUtils.convertToTspans,gd),bbox=Drawing.bBox(this);labelEl.attr("transform","translate("+orientation.p[0]+","+orientation.p[1]+") rotate("+orientation.angle+")translate("+label.axis.labelpadding*direction+","+.3*bbox.height+")"),maxExtent=Math.max(maxExtent,bbox.width+label.axis.labelpadding)}),labelJoin.exit().remove(),labelOrientation.maxExtent=maxExtent,labelOrientation}module.exports=function plot(gd,plotinfo,cdcarpet,carpetLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,clipLayer=gd._fullLayout._clips;Lib.makeTraceGroups(carpetLayer,cdcarpet,"trace").each(function(cd){var axisLayer=d3.select(this),cd0=cd[0],trace=cd0.trace,aax=trace.aaxis,bax=trace.baxis,minorLayer=Lib.ensureSingle(axisLayer,"g","minorlayer"),majorLayer=Lib.ensureSingle(axisLayer,"g","majorlayer"),boundaryLayer=Lib.ensureSingle(axisLayer,"g","boundarylayer"),labelLayer=Lib.ensureSingle(axisLayer,"g","labellayer");axisLayer.style("opacity",trace.opacity),drawGridLines(xa,ya,majorLayer,aax,"a",aax._gridlines),drawGridLines(xa,ya,majorLayer,bax,"b",bax._gridlines),drawGridLines(xa,ya,minorLayer,aax,"a",aax._minorgridlines),drawGridLines(xa,ya,minorLayer,bax,"b",bax._minorgridlines),drawGridLines(xa,ya,boundaryLayer,aax,"a-boundary",aax._boundarylines),drawGridLines(xa,ya,boundaryLayer,bax,"b-boundary",bax._boundarylines);var labelOrientationA=drawAxisLabels(gd,xa,ya,trace,cd0,labelLayer,aax._labels,"a-label"),labelOrientationB=drawAxisLabels(gd,xa,ya,trace,cd0,labelLayer,bax._labels,"b-label");!function drawAxisTitles(gd,layer,trace,t,xa,ya,labelOrientationA,labelOrientationB){var a,b,xy,dxy;a=.5*(trace.a[0]+trace.a[trace.a.length-1]),b=trace.b[0],xy=trace.ab2xy(a,b,!0),dxy=trace.dxyda_rough(a,b),void 0===labelOrientationA.angle&&Lib.extendFlat(labelOrientationA,orientText(trace,xa,ya,xy,trace.dxydb_rough(a,b)));drawAxisTitle(gd,layer,trace,t,xy,dxy,trace.aaxis,xa,ya,labelOrientationA,"a-title"),a=trace.a[0],b=.5*(trace.b[0]+trace.b[trace.b.length-1]),xy=trace.ab2xy(a,b,!0),dxy=trace.dxydb_rough(a,b),void 0===labelOrientationB.angle&&Lib.extendFlat(labelOrientationB,orientText(trace,xa,ya,xy,trace.dxyda_rough(a,b)));drawAxisTitle(gd,layer,trace,t,xy,dxy,trace.baxis,xa,ya,labelOrientationB,"b-title")}(gd,labelLayer,trace,cd0,xa,ya,labelOrientationA,labelOrientationB),function drawClipPath(trace,t,layer,xaxis,yaxis){var seg,xp,yp,i,clip=layer.select("#"+trace._clipPathId);clip.size()||(clip=layer.append("clipPath").classed("carpetclip",!0));var path=Lib.ensureSingle(clip,"path","carpetboundary"),segments=t.clipsegments,segs=[];for(i=0;i<segments.length;i++)seg=segments[i],xp=map1dArray([],seg.x,xaxis.c2p),yp=map1dArray([],seg.y,yaxis.c2p),segs.push(makepath(xp,yp,seg.bicubic));var clipPathData="M"+segs.join("L")+"Z";clip.attr("id",trace._clipPathId),path.attr("d",clipPathData)}(trace,cd0,clipLayer,xa,ya)})};var lineSpacing=alignmentConstants.LINE_SPACING,midShift=(1-alignmentConstants.MID_SHIFT)/lineSpacing+1;function drawAxisTitle(gd,layer,trace,t,xy,dxy,axis,xa,ya,labelOrientation,labelClass){var data=[];axis.title&&data.push(axis.title);var titleJoin=layer.selectAll("text."+labelClass).data(data),offset=labelOrientation.maxExtent;titleJoin.enter().append("text").classed(labelClass,!0),titleJoin.each(function(){var orientation=orientText(trace,xa,ya,xy,dxy);-1===["start","both"].indexOf(axis.showticklabels)&&(offset=0);var titleSize=axis.titlefont.size;offset+=titleSize+axis.titleoffset;var angleDiff=(labelOrientation.angle+(labelOrientation.flip<0?180:0)-orientation.angle+450)%360,reverseTitle=angleDiff>90&&angleDiff<270,el=d3.select(this);el.text(axis.title||"").call(svgTextUtils.convertToTspans,gd),reverseTitle&&(offset=(-svgTextUtils.lineCount(el)+midShift)*lineSpacing*titleSize-offset),el.attr("transform","translate("+orientation.p[0]+","+orientation.p[1]+") rotate("+orientation.angle+") translate(0,"+offset+")").classed("user-select-none",!0).attr("text-anchor","middle").call(Drawing.font,axis.titlefont)}),titleJoin.exit().remove()}},{"../../components/drawing":592,"../../constants/alignment":665,"../../lib":693,"../../lib/svg_text_utils":718,"./makepath":892,"./map_1d_array":893,"./orient_text":894,d3:147}],896:[function(_dereq_,module,exports){"use strict";var constants=_dereq_("./constants"),search=_dereq_("../../lib/search").findBin,computeControlPoints=_dereq_("./compute_control_points"),createSplineEvaluator=_dereq_("./create_spline_evaluator"),createIDerivativeEvaluator=_dereq_("./create_i_derivative_evaluator"),createJDerivativeEvaluator=_dereq_("./create_j_derivative_evaluator");module.exports=function setConvert(trace){var a=trace._a,b=trace._b,na=a.length,nb=b.length,aax=trace.aaxis,bax=trace.baxis,amin=a[0],amax=a[na-1],bmin=b[0],bmax=b[nb-1],arange=a[a.length-1]-a[0],brange=b[b.length-1]-b[0],atol=arange*constants.RELATIVE_CULL_TOLERANCE,btol=brange*constants.RELATIVE_CULL_TOLERANCE;amin-=atol,amax+=atol,bmin-=btol,bmax+=btol,trace.isVisible=function(a,b){return a>amin&&a<amax&&b>bmin&&b<bmax},trace.isOccluded=function(a,b){return a<amin||a>amax||b<bmin||b>bmax},trace.setScale=function(){var x=trace._x,y=trace._y,result=computeControlPoints(trace._xctrl,trace._yctrl,x,y,aax.smoothing,bax.smoothing);trace._xctrl=result[0],trace._yctrl=result[1],trace.evalxy=createSplineEvaluator([trace._xctrl,trace._yctrl],na,nb,aax.smoothing,bax.smoothing),trace.dxydi=createIDerivativeEvaluator([trace._xctrl,trace._yctrl],aax.smoothing,bax.smoothing),trace.dxydj=createJDerivativeEvaluator([trace._xctrl,trace._yctrl],aax.smoothing,bax.smoothing)},trace.i2a=function(i){var i0=Math.max(0,Math.floor(i[0]),na-2),ti=i[0]-i0;return(1-ti)*a[i0]+ti*a[i0+1]},trace.j2b=function(j){var j0=Math.max(0,Math.floor(j[1]),na-2),tj=j[1]-j0;return(1-tj)*b[j0]+tj*b[j0+1]},trace.ij2ab=function(ij){return[trace.i2a(ij[0]),trace.j2b(ij[1])]},trace.a2i=function(aval){var i0=Math.max(0,Math.min(search(aval,a),na-2)),a0=a[i0],a1=a[i0+1];return Math.max(0,Math.min(na-1,i0+(aval-a0)/(a1-a0)))},trace.b2j=function(bval){var j0=Math.max(0,Math.min(search(bval,b),nb-2)),b0=b[j0],b1=b[j0+1];return Math.max(0,Math.min(nb-1,j0+(bval-b0)/(b1-b0)))},trace.ab2ij=function(ab){return[trace.a2i(ab[0]),trace.b2j(ab[1])]},trace.i2c=function(i,j){return trace.evalxy([],i,j)},trace.ab2xy=function(aval,bval,extrapolate){if(!extrapolate&&(aval<a[0]||aval>a[na-1]|bval<b[0]||bval>b[nb-1]))return[!1,!1];var i=trace.a2i(aval),j=trace.b2j(bval),pt=trace.evalxy([],i,j);if(extrapolate){var i0,ti,j0,tj,iex=0,jex=0,der=[];aval<a[0]?(i0=0,ti=0,iex=(aval-a[0])/(a[1]-a[0])):aval>a[na-1]?(i0=na-2,ti=1,iex=(aval-a[na-1])/(a[na-1]-a[na-2])):ti=i-(i0=Math.max(0,Math.min(na-2,Math.floor(i)))),bval<b[0]?(j0=0,tj=0,jex=(bval-b[0])/(b[1]-b[0])):bval>b[nb-1]?(j0=nb-2,tj=1,jex=(bval-b[nb-1])/(b[nb-1]-b[nb-2])):tj=j-(j0=Math.max(0,Math.min(nb-2,Math.floor(j)))),iex&&(trace.dxydi(der,i0,j0,ti,tj),pt[0]+=der[0]*iex,pt[1]+=der[1]*iex),jex&&(trace.dxydj(der,i0,j0,ti,tj),pt[0]+=der[0]*jex,pt[1]+=der[1]*jex)}return pt},trace.c2p=function(xy,xa,ya){return[xa.c2p(xy[0]),ya.c2p(xy[1])]},trace.p2x=function(p,xa,ya){return[xa.p2c(p[0]),ya.p2c(p[1])]},trace.dadi=function(i){var i0=Math.max(0,Math.min(a.length-2,i));return a[i0+1]-a[i0]},trace.dbdj=function(j){var j0=Math.max(0,Math.min(b.length-2,j));return b[j0+1]-b[j0]},trace.dxyda=function(i0,j0,u,v){var dxydi=trace.dxydi(null,i0,j0,u,v),dadi=trace.dadi(i0,u);return[dxydi[0]/dadi,dxydi[1]/dadi]},trace.dxydb=function(i0,j0,u,v){var dxydj=trace.dxydj(null,i0,j0,u,v),dbdj=trace.dbdj(j0,v);return[dxydj[0]/dbdj,dxydj[1]/dbdj]},trace.dxyda_rough=function(a,b,reldiff){var h=arange*(reldiff||.1),plus=trace.ab2xy(a+h,b,!0),minus=trace.ab2xy(a-h,b,!0);return[.5*(plus[0]-minus[0])/h,.5*(plus[1]-minus[1])/h]},trace.dxydb_rough=function(a,b,reldiff){var h=brange*(reldiff||.1),plus=trace.ab2xy(a,b+h,!0),minus=trace.ab2xy(a,b-h,!0);return[.5*(plus[0]-minus[0])/h,.5*(plus[1]-minus[1])/h]},trace.dpdx=function(xa){return xa._m},trace.dpdy=function(ya){return ya._m}}},{"../../lib/search":713,"./compute_control_points":884,"./constants":885,"./create_i_derivative_evaluator":886,"./create_j_derivative_evaluator":887,"./create_spline_evaluator":888}],897:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function smoothFill2dArray(data,a,b){var i,j,k,ip=[],jp=[],ni=data[0].length,nj=data.length;function avgSurrounding(i,j){var val,sum=0,cnt=0;return i>0&&void 0!==(val=data[j][i-1])&&(cnt++,sum+=val),i<ni-1&&void 0!==(val=data[j][i+1])&&(cnt++,sum+=val),j>0&&void 0!==(val=data[j-1][i])&&(cnt++,sum+=val),j<nj-1&&void 0!==(val=data[j+1][i])&&(cnt++,sum+=val),sum/Math.max(1,cnt)}var dxp,dxm,dap,dam,dbp,dbm,c,d,diff,reldiff,overrelaxation,dmax=0;for(i=0;i<ni;i++)for(j=0;j<nj;j++)void 0===data[j][i]&&(ip.push(i),jp.push(j),data[j][i]=avgSurrounding(i,j)),dmax=Math.max(dmax,Math.abs(data[j][i]));if(!ip.length)return data;var resid=0,iter=0,n=ip.length;do{for(resid=0,k=0;k<n;k++){i=ip[k],j=jp[k];var d0,d1,x0,x1,i0,j0,boundaryCnt=0,newVal=0;0===i?(x0=a[i0=Math.min(ni-1,2)],x1=a[1],d0=data[j][i0],newVal+=(d1=data[j][1])+(d1-d0)*(a[0]-x1)/(x1-x0),boundaryCnt++):i===ni-1&&(x0=a[i0=Math.max(0,ni-3)],x1=a[ni-2],d0=data[j][i0],newVal+=(d1=data[j][ni-2])+(d1-d0)*(a[ni-1]-x1)/(x1-x0),boundaryCnt++),(0===i||i===ni-1)&&j>0&&j<nj-1&&(dxp=b[j+1]-b[j],newVal+=((dxm=b[j]-b[j-1])*data[j+1][i]+dxp*data[j-1][i])/(dxm+dxp),boundaryCnt++),0===j?(x0=b[j0=Math.min(nj-1,2)],x1=b[1],d0=data[j0][i],newVal+=(d1=data[1][i])+(d1-d0)*(b[0]-x1)/(x1-x0),boundaryCnt++):j===nj-1&&(x0=b[j0=Math.max(0,nj-3)],x1=b[nj-2],d0=data[j0][i],newVal+=(d1=data[nj-2][i])+(d1-d0)*(b[nj-1]-x1)/(x1-x0),boundaryCnt++),(0===j||j===nj-1)&&i>0&&i<ni-1&&(dxp=a[i+1]-a[i],newVal+=((dxm=a[i]-a[i-1])*data[j][i+1]+dxp*data[j][i-1])/(dxm+dxp),boundaryCnt++),boundaryCnt?newVal/=boundaryCnt:(dap=a[i+1]-a[i],dam=a[i]-a[i-1],d=(dbp=b[j+1]-b[j])*(dbm=b[j]-b[j-1])*(dbp+dbm),newVal=((c=dap*dam*(dap+dam))*(dbm*data[j+1][i]+dbp*data[j-1][i])+d*(dam*data[j][i+1]+dap*data[j][i-1]))/(d*(dam+dap)+c*(dbm+dbp))),resid+=(reldiff=(diff=newVal-data[j][i])/dmax)*reldiff,overrelaxation=boundaryCnt?0:.85,data[j][i]+=diff*(1+overrelaxation)}resid=Math.sqrt(resid)}while(iter++<100&&resid>1e-5);return Lib.log("Smoother converged to",resid,"after",iter,"iterations"),data}},{"../../lib":693}],898:[function(_dereq_,module,exports){"use strict";var isArray1D=_dereq_("../../lib").isArray1D;module.exports=function handleXYDefaults(traceIn,traceOut,coerce){var x=coerce("x"),hasX=x&&x.length,y=coerce("y"),hasY=y&&y.length;if(!hasX&&!hasY)return!1;if(traceOut._cheater=!x,hasX&&!isArray1D(x)||hasY&&!isArray1D(y))traceOut._length=null;else{var len=hasX?x.length:1/0;hasY&&(len=Math.min(len,y.length)),traceOut.a&&traceOut.a.length&&(len=Math.min(len,traceOut.a.length)),traceOut.b&&traceOut.b.length&&(len=Math.min(len,traceOut.b.length)),traceOut._length=len}return!0}},{"../../lib":693}],899:[function(_dereq_,module,exports){"use strict";var scatterGeoAttrs=_dereq_("../scattergeo/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),plotAttrs=_dereq_("../../plots/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,scatterGeoMarkerLineAttrs=scatterGeoAttrs.marker.line;module.exports=extendFlat({locations:{valType:"data_array",editType:"calc"},locationmode:scatterGeoAttrs.locationmode,z:{valType:"data_array",editType:"calc"},text:extendFlat({},scatterGeoAttrs.text,{}),marker:{line:{color:scatterGeoMarkerLineAttrs.color,width:extendFlat({},scatterGeoMarkerLineAttrs.width,{dflt:1}),editType:"calc"},opacity:{valType:"number",arrayOk:!0,min:0,max:1,dflt:1,editType:"style"},editType:"calc"},selected:{marker:{opacity:scatterGeoAttrs.selected.marker.opacity,editType:"plot"},editType:"plot"},unselected:{marker:{opacity:scatterGeoAttrs.unselected.marker.opacity,editType:"plot"},editType:"plot"},hoverinfo:extendFlat({},plotAttrs.hoverinfo,{editType:"calc",flags:["location","z","text","name"]})},colorscaleAttrs("",{cLetter:"z",editTypeOverride:"calc"}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/attributes":739,"../scattergeo/attributes":1072}],900:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),BADNUM=_dereq_("../../constants/numerical").BADNUM,colorscaleCalc=_dereq_("../../components/colorscale/calc"),arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection");module.exports=function calc(gd,trace){for(var len=trace._length,calcTrace=new Array(len),i=0;i<len;i++){var calcPt=calcTrace[i]={},loc=trace.locations[i],z=trace.z[i];calcPt.loc="string"==typeof loc?loc:null,calcPt.z=isNumeric(z)?z:BADNUM}return arraysToCalcdata(calcTrace,trace),colorscaleCalc(trace,trace.z,"","z"),calcSelection(calcTrace,trace),calcTrace}},{"../../components/colorscale/calc":575,"../../constants/numerical":670,"../scatter/arrays_to_calcdata":1031,"../scatter/calc_selection":1034,"fast-isnumeric":213}],901:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var locations=coerce("locations"),z=coerce("z");locations&&locations.length&&Lib.isArrayOrTypedArray(z)&&z.length?(traceOut._length=Math.min(locations.length,z.length),coerce("locationmode"),coerce("text"),coerce("marker.line.color"),coerce("marker.line.width"),coerce("marker.opacity"),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"z"}),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)):traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"./attributes":899}],902:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt){return out.location=pt.location,out.z=pt.z,out}},{}],903:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),attributes=_dereq_("./attributes"),fillHoverText=_dereq_("../scatter/fill_hover_text");module.exports=function hoverPoints(pointData,xval,yval){var pt,i,j,isInside,cd=pointData.cd,trace=cd[0].trace,geo=pointData.subplot;for(i=0;i<cd.length;i++)if(isInside=!1,(pt=cd[i])._polygons){for(j=0;j<pt._polygons.length;j++)pt._polygons[j].contains([xval,yval])&&(isInside=!isInside),pt._polygons[j].contains([xval+360,yval])&&(isInside=!isInside);if(isInside)break}if(isInside&&pt)return pointData.x0=pointData.x1=pointData.xa.c2p(pt.ct),pointData.y0=pointData.y1=pointData.ya.c2p(pt.ct),pointData.index=pt.index,pointData.location=pt.loc,pointData.z=pt.z,function makeHoverInfo(pointData,trace,pt,axis){var hoverinfo=pt.hi||trace.hoverinfo,parts="all"===hoverinfo?attributes.hoverinfo.flags:hoverinfo.split("+"),hasName=-1!==parts.indexOf("name"),hasLocation=-1!==parts.indexOf("location"),hasZ=-1!==parts.indexOf("z"),hasText=-1!==parts.indexOf("text"),text=[];!hasName&&hasLocation?pointData.nameOverride=pt.loc:(hasName&&(pointData.nameOverride=trace.name),hasLocation&&text.push(pt.loc));hasZ&&text.push(function formatter(val){return Axes.tickText(axis,axis.c2l(val),"hover").text}(pt.z));hasText&&fillHoverText(pt,trace,text);pointData.extraText=text.join("<br>")}(pointData,trace,pt,geo.mockAxis),[pointData]}},{"../../plots/cartesian/axes":742,"../scatter/fill_hover_text":1040,"./attributes":899}],904:[function(_dereq_,module,exports){"use strict";var Choropleth={};Choropleth.attributes=_dereq_("./attributes"),Choropleth.supplyDefaults=_dereq_("./defaults"),Choropleth.colorbar=_dereq_("../heatmap/colorbar"),Choropleth.calc=_dereq_("./calc"),Choropleth.plot=_dereq_("./plot"),Choropleth.style=_dereq_("./style").style,Choropleth.styleOnSelect=_dereq_("./style").styleOnSelect,Choropleth.hoverPoints=_dereq_("./hover"),Choropleth.eventData=_dereq_("./event_data"),Choropleth.selectPoints=_dereq_("./select"),Choropleth.moduleType="trace",Choropleth.name="choropleth",Choropleth.basePlotModule=_dereq_("../../plots/geo"),Choropleth.categories=["geo","noOpacity"],Choropleth.meta={},module.exports=Choropleth},{"../../plots/geo":772,"../heatmap/colorbar":945,"./attributes":899,"./calc":900,"./defaults":901,"./event_data":902,"./hover":903,"./plot":905,"./select":906,"./style":907}],905:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),polygon=_dereq_("../../lib/polygon"),getTopojsonFeatures=_dereq_("../../lib/topojson_utils").getTopojsonFeatures,locationToFeature=_dereq_("../../lib/geo_location_utils").locationToFeature,style=_dereq_("./style").style;function calcGeoJSON(calcTrace,topojson){for(var trace=calcTrace[0].trace,len=calcTrace.length,features=getTopojsonFeatures(trace,topojson),i=0;i<len;i++){var calcPt=calcTrace[i],feature=locationToFeature(trace.locationmode,calcPt.loc,features);feature?(calcPt.geojson=feature,calcPt.ct=feature.properties.ct,calcPt.index=i,calcPt._polygons=feature2polygons(feature)):calcPt.geojson=null}}function feature2polygons(feature){var appendPolygon,j,k,m,geometry=feature.geometry,coords=geometry.coordinates,loc=feature.id,polygons=[];function doesCrossAntiMerdian(pts){for(var l=0;l<pts.length-1;l++)if(pts[l][0]>0&&pts[l+1][0]<0)return l;return null}switch(appendPolygon="RUS"===loc||"FJI"===loc?function(_pts){var pts;if(null===doesCrossAntiMerdian(_pts))pts=_pts;else for(pts=new Array(_pts.length),m=0;m<_pts.length;m++)pts[m]=[_pts[m][0]<0?_pts[m][0]+360:_pts[m][0],_pts[m][1]];polygons.push(polygon.tester(pts))}:"ATA"===loc?function(pts){var crossAntiMeridianIndex=doesCrossAntiMerdian(pts);if(null===crossAntiMeridianIndex)return polygons.push(polygon.tester(pts));var stitch=new Array(pts.length+1),si=0;for(m=0;m<pts.length;m++)m>crossAntiMeridianIndex?stitch[si++]=[pts[m][0]+360,pts[m][1]]:m===crossAntiMeridianIndex?(stitch[si++]=pts[m],stitch[si++]=[pts[m][0],-90]):stitch[si++]=pts[m];var tester=polygon.tester(stitch);tester.pts.pop(),polygons.push(tester)}:function(pts){polygons.push(polygon.tester(pts))},geometry.type){case"MultiPolygon":for(j=0;j<coords.length;j++)for(k=0;k<coords[j].length;k++)appendPolygon(coords[j][k]);break;case"Polygon":for(j=0;j<coords.length;j++)appendPolygon(coords[j])}return polygons}module.exports=function plot(gd,geo,calcData){for(var i=0;i<calcData.length;i++)calcGeoJSON(calcData[i],geo.topojson);var choroplethLayer=geo.layers.backplot.select(".choroplethlayer");Lib.makeTraceGroups(choroplethLayer,calcData,"trace choropleth").each(function(calcTrace){var paths=(calcTrace[0].node3=d3.select(this)).selectAll("path.choroplethlocation").data(Lib.identity);paths.enter().append("path").classed("choroplethlocation",!0),paths.exit().remove(),style(gd,calcTrace)})}},{"../../lib":693,"../../lib/geo_location_utils":685,"../../lib/polygon":706,"../../lib/topojson_utils":721,"./style":907,d3:147}],906:[function(_dereq_,module,exports){"use strict";module.exports=function selectPoints(searchInfo,selectionTester){var i,di,ct,x,y,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[];if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++)(ct=(di=cd[i]).ct)&&(x=xa.c2p(ct),y=ya.c2p(ct),selectionTester.contains([x,y],null,i,searchInfo)?(selection.push({pointNumber:i,lon:ct[0],lat:ct[1]}),di.selected=1):di.selected=0);return selection}},{}],907:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Colorscale=_dereq_("../../components/colorscale");function styleTrace(gd,calcTrace){var trace=calcTrace[0].trace,locs=calcTrace[0].node3.selectAll(".choroplethlocation"),marker=trace.marker||{},markerLine=marker.line||{},sclFunc=Colorscale.makeColorScaleFunc(Colorscale.extractScale(trace.colorscale,trace.zmin,trace.zmax));locs.each(function(d){d3.select(this).attr("fill",sclFunc(d.z)).call(Color.stroke,d.mlc||markerLine.color).call(Drawing.dashLine,"",d.mlw||markerLine.width||0).style("opacity",marker.opacity)}),Drawing.selectedPointStyle(locs,trace,gd)}module.exports={style:function style(gd,calcTrace){calcTrace&&styleTrace(gd,calcTrace)},styleOnSelect:function styleOnSelect(gd,calcTrace){var s=calcTrace[0].node3,trace=calcTrace[0].trace;trace.selectedpoints?Drawing.selectedPointStyle(s.selectAll(".choroplethlocation"),trace,gd):styleTrace(gd,calcTrace)}}},{"../../components/color":567,"../../components/colorscale":582,"../../components/drawing":592,d3:147}],908:[function(_dereq_,module,exports){"use strict";var colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),mesh3dAttrs=_dereq_("../mesh3d/attributes"),baseAttrs=_dereq_("../../plots/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,attrs={x:{valType:"data_array",editType:"calc+clearAxisTypes"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},z:{valType:"data_array",editType:"calc+clearAxisTypes"},u:{valType:"data_array",editType:"calc"},v:{valType:"data_array",editType:"calc"},w:{valType:"data_array",editType:"calc"},sizemode:{valType:"enumerated",values:["scaled","absolute"],editType:"calc",dflt:"scaled"},sizeref:{valType:"number",editType:"calc",min:0},anchor:{valType:"enumerated",editType:"calc",values:["tip","tail","cm","center"],dflt:"cm"},text:{valType:"string",dflt:"",arrayOk:!0,editType:"calc"}};extendFlat(attrs,colorscaleAttrs("",{colorAttr:"u/v/w norm",showScaleDflt:!0,editTypeOverride:"calc"}),{colorbar:colorbarAttrs});["opacity","lightposition","lighting"].forEach(function(k){attrs[k]=mesh3dAttrs[k]}),attrs.hoverinfo=extendFlat({},baseAttrs.hoverinfo,{editType:"calc",flags:["x","y","z","u","v","w","norm","text","name"],dflt:"x+y+z+norm+text+name"}),module.exports=attrs},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/attributes":739,"../mesh3d/attributes":982}],909:[function(_dereq_,module,exports){"use strict";var colorscaleCalc=_dereq_("../../components/colorscale/calc");module.exports=function calc(gd,trace){for(var u=trace.u,v=trace.v,w=trace.w,len=Math.min(trace.x.length,trace.y.length,trace.z.length,u.length,v.length,w.length),normMax=-1/0,normMin=1/0,i=0;i<len;i++){var uu=u[i],vv=v[i],ww=w[i],norm=Math.sqrt(uu*uu+vv*vv+ww*ww);normMax=Math.max(normMax,norm),normMin=Math.min(normMin,norm)}trace._len=len,trace._normMax=normMax,colorscaleCalc(trace,[normMin,normMax],"","c")}},{"../../components/colorscale/calc":575}],910:[function(_dereq_,module,exports){"use strict";var conePlot=_dereq_("gl-cone3d"),createConeMesh=_dereq_("gl-cone3d").createConeMesh,simpleMap=_dereq_("../../lib").simpleMap,parseColorScale=_dereq_("../../lib/gl_format_color").parseColorScale,zip3=_dereq_("../../plots/gl3d/zip3");function Cone(scene,uid){this.scene=scene,this.uid=uid,this.mesh=null,this.data=null}var proto=Cone.prototype;proto.handlePick=function(selection){if(selection.object===this.mesh){var selectIndex=selection.index=selection.data.index,xx=this.data.x[selectIndex],yy=this.data.y[selectIndex],zz=this.data.z[selectIndex],uu=this.data.u[selectIndex],vv=this.data.v[selectIndex],ww=this.data.w[selectIndex];selection.traceCoordinate=[xx,yy,zz,uu,vv,ww,Math.sqrt(uu*uu+vv*vv+ww*ww)];var text=this.data.text;return Array.isArray(text)&&void 0!==text[selectIndex]?selection.textLabel=text[selectIndex]:text&&(selection.textLabel=text),!0}};var axisName2scaleIndex={xaxis:0,yaxis:1,zaxis:2},anchor2coneOffset={tip:1,tail:0,cm:.25,center:.5},anchor2coneSpan={tip:1,tail:1,cm:.75,center:.5};function convert(scene,trace){var sceneLayout=scene.fullSceneLayout,dataScale=scene.dataScale,coneOpts={};function toDataCoords(arr,axisName){var ax=sceneLayout[axisName],scale=dataScale[axisName2scaleIndex[axisName]];return simpleMap(arr,function(v){return ax.d2l(v)*scale})}coneOpts.vectors=zip3(toDataCoords(trace.u,"xaxis"),toDataCoords(trace.v,"yaxis"),toDataCoords(trace.w,"zaxis"),trace._len),coneOpts.positions=zip3(toDataCoords(trace.x,"xaxis"),toDataCoords(trace.y,"yaxis"),toDataCoords(trace.z,"zaxis"),trace._len),coneOpts.colormap=parseColorScale(trace.colorscale),coneOpts.vertexIntensityBounds=[trace.cmin/trace._normMax,trace.cmax/trace._normMax],coneOpts.coneOffset=anchor2coneOffset[trace.anchor],"scaled"===trace.sizemode?coneOpts.coneSize=trace.sizeref||.5:coneOpts.coneSize=trace.sizeref&&trace._normMax?trace.sizeref/trace._normMax:.5;var meshData=conePlot(coneOpts),lp=trace.lightposition;return meshData.lightPosition=[lp.x,lp.y,lp.z],meshData.ambient=trace.lighting.ambient,meshData.diffuse=trace.lighting.diffuse,meshData.specular=trace.lighting.specular,meshData.roughness=trace.lighting.roughness,meshData.fresnel=trace.lighting.fresnel,meshData.opacity=trace.opacity,trace._pad=anchor2coneSpan[trace.anchor]*meshData.vectorScale*meshData.coneScale*trace._normMax,meshData}proto.update=function(data){this.data=data;var meshData=convert(this.scene,data);this.mesh.update(meshData)},proto.dispose=function(){this.scene.glplot.remove(this.mesh),this.mesh.dispose()},module.exports=function createConeTrace(scene,data){var gl=scene.glplot.gl,meshData=convert(scene,data),mesh=createConeMesh(gl,meshData),cone=new Cone(scene,data.uid);return cone.mesh=mesh,cone.data=data,mesh._trace=cone,scene.glplot.add(mesh),cone}},{"../../lib":693,"../../lib/gl_format_color":689,"../../plots/gl3d/zip3":795,"gl-cone3d":230}],911:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var u=coerce("u"),v=coerce("v"),w=coerce("w"),x=coerce("x"),y=coerce("y"),z=coerce("z");u&&u.length&&v&&v.length&&w&&w.length&&x&&x.length&&y&&y.length&&z&&z.length?(coerce("sizeref"),coerce("sizemode"),coerce("anchor"),coerce("lighting.ambient"),coerce("lighting.diffuse"),coerce("lighting.specular"),coerce("lighting.roughness"),coerce("lighting.fresnel"),coerce("lightposition.x"),coerce("lightposition.y"),coerce("lightposition.z"),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"c"}),coerce("text"),traceOut._length=null):traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"./attributes":908}],912:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"cone",basePlotModule:_dereq_("../../plots/gl3d"),categories:["gl3d"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),colorbar:{min:"cmin",max:"cmax"},calc:_dereq_("./calc"),plot:_dereq_("./convert"),meta:{}}},{"../../plots/gl3d":784,"./attributes":908,"./calc":909,"./convert":910,"./defaults":911}],913:[function(_dereq_,module,exports){"use strict";var heatmapAttrs=_dereq_("../heatmap/attributes"),scatterAttrs=_dereq_("../scatter/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),dash=_dereq_("../../components/drawing/attributes").dash,fontAttrs=_dereq_("../../plots/font_attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,filterOps=_dereq_("../../constants/filter_ops"),COMPARISON_OPS2=filterOps.COMPARISON_OPS2,INTERVAL_OPS=filterOps.INTERVAL_OPS,scatterLineAttrs=scatterAttrs.line;module.exports=extendFlat({z:heatmapAttrs.z,x:heatmapAttrs.x,x0:heatmapAttrs.x0,dx:heatmapAttrs.dx,y:heatmapAttrs.y,y0:heatmapAttrs.y0,dy:heatmapAttrs.dy,text:heatmapAttrs.text,transpose:heatmapAttrs.transpose,xtype:heatmapAttrs.xtype,ytype:heatmapAttrs.ytype,zhoverformat:heatmapAttrs.zhoverformat,connectgaps:heatmapAttrs.connectgaps,fillcolor:{valType:"color",editType:"calc"},autocontour:{valType:"boolean",dflt:!0,editType:"calc",impliedEdits:{"contours.start":void 0,"contours.end":void 0,"contours.size":void 0}},ncontours:{valType:"integer",dflt:15,min:1,editType:"calc"},contours:{type:{valType:"enumerated",values:["levels","constraint"],dflt:"levels",editType:"calc"},start:{valType:"number",dflt:null,editType:"plot",impliedEdits:{"^autocontour":!1}},end:{valType:"number",dflt:null,editType:"plot",impliedEdits:{"^autocontour":!1}},size:{valType:"number",dflt:null,min:0,editType:"plot",impliedEdits:{"^autocontour":!1}},coloring:{valType:"enumerated",values:["fill","heatmap","lines","none"],dflt:"fill",editType:"calc"},showlines:{valType:"boolean",dflt:!0,editType:"plot"},showlabels:{valType:"boolean",dflt:!1,editType:"plot"},labelfont:fontAttrs({editType:"plot",colorEditType:"style"}),labelformat:{valType:"string",dflt:"",editType:"plot"},operation:{valType:"enumerated",values:[].concat(COMPARISON_OPS2).concat(INTERVAL_OPS),dflt:"=",editType:"calc"},value:{valType:"any",dflt:0,editType:"calc"},editType:"calc",impliedEdits:{autocontour:!1}},line:{color:extendFlat({},scatterLineAttrs.color,{editType:"style+colorbars"}),width:extendFlat({},scatterLineAttrs.width,{editType:"style+colorbars"}),dash:dash,smoothing:extendFlat({},scatterLineAttrs.smoothing,{}),editType:"plot"}},colorscaleAttrs("",{cLetter:"z",autoColorDflt:!1,editTypeOverride:"calc"}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../components/drawing/attributes":591,"../../constants/filter_ops":666,"../../lib/extend":682,"../../plots/font_attributes":768,"../heatmap/attributes":942,"../scatter/attributes":1032}],914:[function(_dereq_,module,exports){"use strict";var heatmapCalc=_dereq_("../heatmap/calc"),setContours=_dereq_("./set_contours");module.exports=function calc(gd,trace){var cd=heatmapCalc(gd,trace);return setContours(trace),cd}},{"../heatmap/calc":943,"./set_contours":932}],915:[function(_dereq_,module,exports){"use strict";module.exports=function(pathinfo,operation,perimeter,trace){var i,v1,v2,pi0=pathinfo[0],na=pi0.x.length,nb=pi0.y.length,z=pi0.z,contours=trace.contours,boundaryMax=-1/0,boundaryMin=1/0;for(i=0;i<nb;i++)boundaryMin=Math.min(boundaryMin,z[i][0]),boundaryMin=Math.min(boundaryMin,z[i][na-1]),boundaryMax=Math.max(boundaryMax,z[i][0]),boundaryMax=Math.max(boundaryMax,z[i][na-1]);for(i=1;i<na-1;i++)boundaryMin=Math.min(boundaryMin,z[0][i]),boundaryMin=Math.min(boundaryMin,z[nb-1][i]),boundaryMax=Math.max(boundaryMax,z[0][i]),boundaryMax=Math.max(boundaryMax,z[nb-1][i]);switch(pi0.prefixBoundary=!1,operation){case">":contours.value>boundaryMax&&(pi0.prefixBoundary=!0);break;case"<":contours.value<boundaryMin&&(pi0.prefixBoundary=!0);break;case"[]":v1=Math.min.apply(null,contours.value),((v2=Math.max.apply(null,contours.value))<boundaryMin||v1>boundaryMax)&&(pi0.prefixBoundary=!0);break;case"][":v1=Math.min.apply(null,contours.value),v2=Math.max.apply(null,contours.value),v1<boundaryMin&&v2>boundaryMax&&(pi0.prefixBoundary=!0)}}},{}],916:[function(_dereq_,module,exports){"use strict";var drawColorbar=_dereq_("../../components/colorbar/draw"),makeColorMap=_dereq_("./make_color_map"),endPlus=_dereq_("./end_plus");module.exports=function colorbar(gd,cd){var trace=cd[0].trace,cbId="cb"+trace.uid;if(gd._fullLayout._infolayer.selectAll("."+cbId).remove(),trace.showscale){var cb=cd[0].t.cb=drawColorbar(gd,cbId),contours=trace.contours,line=trace.line,cs=contours.size||1,coloring=contours.coloring,colorMap=makeColorMap(trace,{isColorbar:!0});cb.fillgradient("heatmap"===coloring?trace.colorscale:"").zrange("heatmap"===coloring?[trace.zmin,trace.zmax]:"").fillcolor("fill"===coloring?colorMap:"").line({color:"lines"===coloring?colorMap:line.color,width:!1!==contours.showlines?line.width:0,dash:line.dash}).levels({start:contours.start,end:endPlus(contours),size:cs}).options(trace.colorbar)()}}},{"../../components/colorbar/draw":572,"./end_plus":924,"./make_color_map":929}],917:[function(_dereq_,module,exports){"use strict";module.exports={BOTTOMSTART:[1,9,13,104,713],TOPSTART:[4,6,7,104,713],LEFTSTART:[8,12,14,208,1114],RIGHTSTART:[2,3,11,208,1114],NEWDELTA:[null,[-1,0],[0,-1],[-1,0],[1,0],null,[0,-1],[-1,0],[0,1],[0,1],null,[0,1],[1,0],[1,0],[0,-1]],CHOOSESADDLE:{104:[4,1],208:[2,8],713:[7,13],1114:[11,14]},SADDLEREMAINDER:{1:4,2:8,4:1,7:13,8:2,11:14,13:7,14:11},LABELDISTANCE:2,LABELINCREASE:10,LABELMIN:3,LABELMAX:10,LABELOPTIMIZER:{EDGECOST:1,ANGLECOST:1,NEIGHBORCOST:5,SAMELEVELFACTOR:10,SAMELEVELDISTANCE:5,MAXCOST:100,INITIALSEARCHPOINTS:10,ITERATIONS:5}}},{}],918:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),handleLabelDefaults=_dereq_("./label_defaults"),Color=_dereq_("../../components/color"),addOpacity=Color.addOpacity,opacity=Color.opacity,filterOps=_dereq_("../../constants/filter_ops"),CONSTRAINT_REDUCTION=filterOps.CONSTRAINT_REDUCTION,COMPARISON_OPS2=filterOps.COMPARISON_OPS2;module.exports=function handleConstraintDefaults(traceIn,traceOut,coerce,layout,defaultColor,opts){var showLines,lineColor,fillColor,contours=traceOut.contours,operation=coerce("contours.operation");(contours._operation=CONSTRAINT_REDUCTION[operation],function handleConstraintValueDefaults(coerce,contours){var zvalue;-1===COMPARISON_OPS2.indexOf(contours.operation)?(coerce("contours.value",[0,1]),Array.isArray(contours.value)?contours.value.length>2?contours.value=contours.value.slice(2):0===contours.length?contours.value=[0,1]:contours.length<2?(zvalue=parseFloat(contours.value[0]),contours.value=[zvalue,zvalue+1]):contours.value=[parseFloat(contours.value[0]),parseFloat(contours.value[1])]:isNumeric(contours.value)&&(zvalue=parseFloat(contours.value),contours.value=[zvalue,zvalue+1])):(coerce("contours.value",0),isNumeric(contours.value)||(Array.isArray(contours.value)?contours.value=parseFloat(contours.value[0]):contours.value=0))}(coerce,contours),"="===operation?showLines=contours.showlines=!0:(showLines=coerce("contours.showlines"),fillColor=coerce("fillcolor",addOpacity((traceIn.line||{}).color||defaultColor,.5))),showLines)&&(lineColor=coerce("line.color",fillColor&&opacity(fillColor)?addOpacity(traceOut.fillcolor,1):defaultColor),coerce("line.width",2),coerce("line.dash"));coerce("line.smoothing"),handleLabelDefaults(coerce,layout,lineColor,opts)}},{"../../components/color":567,"../../constants/filter_ops":666,"./label_defaults":928,"fast-isnumeric":213}],919:[function(_dereq_,module,exports){"use strict";var filterOps=_dereq_("../../constants/filter_ops"),isNumeric=_dereq_("fast-isnumeric");function coerceValue(operation,value){var coercedValue,hasArrayValue=Array.isArray(value);function coerce(value){return isNumeric(value)?+value:null}return-1!==filterOps.COMPARISON_OPS2.indexOf(operation)?coercedValue=coerce(hasArrayValue?value[0]:value):-1!==filterOps.INTERVAL_OPS.indexOf(operation)?coercedValue=hasArrayValue?[coerce(value[0]),coerce(value[1])]:[coerce(value),coerce(value)]:-1!==filterOps.SET_OPS.indexOf(operation)&&(coercedValue=hasArrayValue?value.map(coerce):[coerce(value)]),coercedValue}function makeRangeSettings(operation){return function(value){value=coerceValue(operation,value);var min=Math.min(value[0],value[1]),max=Math.max(value[0],value[1]);return{start:min,end:max,size:max-min}}}function makeInequalitySettings(operation){return function(value){return{start:value=coerceValue(operation,value),end:1/0,size:1/0}}}module.exports={"[]":makeRangeSettings("[]"),"][":makeRangeSettings("]["),">":makeInequalitySettings(">"),"<":makeInequalitySettings("<"),"=":makeInequalitySettings("=")}},{"../../constants/filter_ops":666,"fast-isnumeric":213}],920:[function(_dereq_,module,exports){"use strict";module.exports=function handleContourDefaults(traceIn,traceOut,coerce,coerce2){var contourStart=coerce2("contours.start"),contourEnd=coerce2("contours.end"),missingEnd=!1===contourStart||!1===contourEnd,contourSize=coerce("contours.size");!(missingEnd?traceOut.autocontour=!0:coerce("autocontour",!1))&&contourSize||coerce("ncontours")}},{}],921:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");function copyPathinfo(pi){return Lib.extendFlat({},pi,{edgepaths:Lib.extendDeep([],pi.edgepaths),paths:Lib.extendDeep([],pi.paths)})}module.exports=function(pathinfo,operation){var i,pi0,pi1,op0=function(arr){return arr.reverse()},op1=function(arr){return arr};switch(operation){case"=":case"<":return pathinfo;case">":for(1!==pathinfo.length&&Lib.warn("Contour data invalid for the specified inequality operation."),pi0=pathinfo[0],i=0;i<pi0.edgepaths.length;i++)pi0.edgepaths[i]=op0(pi0.edgepaths[i]);for(i=0;i<pi0.paths.length;i++)pi0.paths[i]=op0(pi0.paths[i]);return pathinfo;case"][":var tmp=op0;op0=op1,op1=tmp;case"[]":for(2!==pathinfo.length&&Lib.warn("Contour data invalid for the specified inequality range operation."),pi0=copyPathinfo(pathinfo[0]),pi1=copyPathinfo(pathinfo[1]),i=0;i<pi0.edgepaths.length;i++)pi0.edgepaths[i]=op0(pi0.edgepaths[i]);for(i=0;i<pi0.paths.length;i++)pi0.paths[i]=op0(pi0.paths[i]);for(;pi1.edgepaths.length;)pi0.edgepaths.push(op1(pi1.edgepaths.shift()));for(;pi1.paths.length;)pi0.paths.push(op1(pi1.paths.shift()));return[pi0]}}},{"../../lib":693}],922:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleXYZDefaults=_dereq_("../heatmap/xyz_defaults"),handleConstraintDefaults=_dereq_("./constraint_defaults"),handleContoursDefaults=_dereq_("./contours_defaults"),handleStyleDefaults=_dereq_("./style_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}if(handleXYZDefaults(traceIn,traceOut,coerce,layout)){coerce("text");var isConstraint="constraint"===coerce("contours.type");coerce("connectgaps",Lib.isArray1D(traceOut.z)),isConstraint?handleConstraintDefaults(traceIn,traceOut,coerce,layout,defaultColor):(handleContoursDefaults(traceIn,traceOut,coerce,function coerce2(attr){return Lib.coerce2(traceIn,traceOut,attributes,attr)}),handleStyleDefaults(traceIn,traceOut,coerce,layout))}else traceOut.visible=!1}},{"../../lib":693,"../heatmap/xyz_defaults":957,"./attributes":913,"./constraint_defaults":918,"./contours_defaults":920,"./style_defaults":934}],923:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),constraintMapping=_dereq_("./constraint_mapping"),endPlus=_dereq_("./end_plus");module.exports=function emptyPathinfo(contours,plotinfo,cd0){for(var contoursFinal="constraint"===contours.type?constraintMapping[contours._operation](contours.value):contours,cs=contoursFinal.size,pathinfo=[],end=endPlus(contoursFinal),carpet=cd0.trace._carpetTrace,basePathinfo=carpet?{xaxis:carpet.aaxis,yaxis:carpet.baxis,x:cd0.a,y:cd0.b}:{xaxis:plotinfo.xaxis,yaxis:plotinfo.yaxis,x:cd0.x,y:cd0.y},ci=contoursFinal.start;ci<end;ci+=cs)if(pathinfo.push(Lib.extendFlat({level:ci,crossings:{},starts:[],edgepaths:[],paths:[],z:cd0.z,smoothing:cd0.trace.line.smoothing},basePathinfo)),pathinfo.length>1e3){Lib.warn("Too many contours, clipping at 1000",contours);break}return pathinfo}},{"../../lib":693,"./constraint_mapping":919,"./end_plus":924}],924:[function(_dereq_,module,exports){"use strict";module.exports=function endPlus(contours){return contours.end+contours.size/1e6}},{}],925:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),constants=_dereq_("./constants");function equalPts(pt1,pt2,xtol,ytol){return Math.abs(pt1[0]-pt2[0])<xtol&&Math.abs(pt1[1]-pt2[1])<ytol}function makePath(pi,loc,edgeflag,xtol,ytol){var cnt,startLocStr=loc.join(","),locStr=startLocStr,mi=pi.crossings[locStr],marchStep=function startStep(mi,edgeflag,loc){var dx=0,dy=0;mi>20&&edgeflag?208===mi||1114===mi?dx=0===loc[0]?1:-1:dy=0===loc[1]?1:-1:-1!==constants.BOTTOMSTART.indexOf(mi)?dy=1:-1!==constants.LEFTSTART.indexOf(mi)?dx=1:-1!==constants.TOPSTART.indexOf(mi)?dy=-1:dx=-1;return[dx,dy]}(mi,edgeflag,loc),pts=[getInterpPx(pi,loc,[-marchStep[0],-marchStep[1]])],startStepStr=marchStep.join(","),m=pi.z.length,n=pi.z[0].length;for(cnt=0;cnt<1e4;cnt++){if(mi>20?(mi=constants.CHOOSESADDLE[mi][(marchStep[0]||marchStep[1])<0?0:1],pi.crossings[locStr]=constants.SADDLEREMAINDER[mi]):delete pi.crossings[locStr],!(marchStep=constants.NEWDELTA[mi])){Lib.log("Found bad marching index:",mi,loc,pi.level);break}pts.push(getInterpPx(pi,loc,marchStep)),loc[0]+=marchStep[0],loc[1]+=marchStep[1],equalPts(pts[pts.length-1],pts[pts.length-2],xtol,ytol)&&pts.pop(),locStr=loc.join(",");var atEdge=marchStep[0]&&(loc[0]<0||loc[0]>n-2)||marchStep[1]&&(loc[1]<0||loc[1]>m-2);if(locStr===startLocStr&&marchStep.join(",")===startStepStr||edgeflag&&atEdge)break;mi=pi.crossings[locStr]}1e4===cnt&&Lib.log("Infinite loop in contour?");var distgroup,cnt2,cnt3,newpt,ptcnt,ptavg,thisdist,i,j,edgepathi,edgepathj,pt1,pt2,dx,dy,closedpath=equalPts(pts[0],pts[pts.length-1],xtol,ytol),totaldist=0,distThresholdFactor=.2*pi.smoothing,alldists=[],cropstart=0;for(cnt=1;cnt<pts.length;cnt++)pt1=pts[cnt],pt2=pts[cnt-1],void 0,void 0,dx=pt1[2]-pt2[2],dy=pt1[3]-pt2[3],totaldist+=thisdist=Math.sqrt(dx*dx+dy*dy),alldists.push(thisdist);var distThreshold=totaldist/alldists.length*distThresholdFactor;function getpt(i){return pts[i%pts.length]}for(cnt=pts.length-2;cnt>=cropstart;cnt--)if((distgroup=alldists[cnt])<distThreshold){for(cnt3=0,cnt2=cnt-1;cnt2>=cropstart&&distgroup+alldists[cnt2]<distThreshold;cnt2--)distgroup+=alldists[cnt2];if(closedpath&&cnt===pts.length-2)for(cnt3=0;cnt3<cnt2&&distgroup+alldists[cnt3]<distThreshold;cnt3++)distgroup+=alldists[cnt3];ptcnt=cnt-cnt2+cnt3+1,ptavg=Math.floor((cnt+cnt2+cnt3+2)/2),newpt=closedpath||cnt!==pts.length-2?closedpath||-1!==cnt2?ptcnt%2?getpt(ptavg):[(getpt(ptavg)[0]+getpt(ptavg+1)[0])/2,(getpt(ptavg)[1]+getpt(ptavg+1)[1])/2]:pts[0]:pts[pts.length-1],pts.splice(cnt2+1,cnt-cnt2+1,newpt),cnt=cnt2+1,cnt3&&(cropstart=cnt3),closedpath&&(cnt===pts.length-2?pts[cnt3]=pts[pts.length-1]:0===cnt&&(pts[pts.length-1]=pts[0]))}for(pts.splice(0,cropstart),cnt=0;cnt<pts.length;cnt++)pts[cnt].length=2;if(!(pts.length<2))if(closedpath)pts.pop(),pi.paths.push(pts);else{edgeflag||Lib.log("Unclosed interior contour?",pi.level,startLocStr,pts.join("L"));var merged=!1;for(i=0;i<pi.edgepaths.length;i++)if(edgepathi=pi.edgepaths[i],!merged&&equalPts(edgepathi[0],pts[pts.length-1],xtol,ytol)){pts.pop(),merged=!0;var doublemerged=!1;for(j=0;j<pi.edgepaths.length;j++)if(equalPts((edgepathj=pi.edgepaths[j])[edgepathj.length-1],pts[0],xtol,ytol)){doublemerged=!0,pts.shift(),pi.edgepaths.splice(i,1),j===i?pi.paths.push(pts.concat(edgepathj)):(j>i&&j--,pi.edgepaths[j]=edgepathj.concat(pts,edgepathi));break}doublemerged||(pi.edgepaths[i]=pts.concat(edgepathi))}for(i=0;i<pi.edgepaths.length&&!merged;i++)equalPts((edgepathi=pi.edgepaths[i])[edgepathi.length-1],pts[0],xtol,ytol)&&(pts.shift(),pi.edgepaths[i]=edgepathi.concat(pts),merged=!0);merged||pi.edgepaths.push(pts)}}function getInterpPx(pi,loc,step){var locx=loc[0]+Math.max(step[0],0),locy=loc[1]+Math.max(step[1],0),zxy=pi.z[locy][locx],xa=pi.xaxis,ya=pi.yaxis;if(step[1]){var dx=(pi.level-zxy)/(pi.z[locy][locx+1]-zxy);return[xa.c2p((1-dx)*pi.x[locx]+dx*pi.x[locx+1],!0),ya.c2p(pi.y[locy],!0),locx+dx,locy]}var dy=(pi.level-zxy)/(pi.z[locy+1][locx]-zxy);return[xa.c2p(pi.x[locx],!0),ya.c2p((1-dy)*pi.y[locy]+dy*pi.y[locy+1],!0),locx,locy+dy]}module.exports=function findAllPaths(pathinfo,xtol,ytol){var cnt,i,pi,j;for(xtol=xtol||.01,ytol=ytol||.01,i=0;i<pathinfo.length;i++){for(pi=pathinfo[i],j=0;j<pi.starts.length;j++)makePath(pi,pi.starts[j],"edge",xtol,ytol);for(cnt=0;Object.keys(pi.crossings).length&&cnt<1e4;)cnt++,makePath(pi,Object.keys(pi.crossings)[0].split(",").map(Number),void 0,xtol,ytol);1e4===cnt&&Lib.log("Infinite loop in contour?")}}},{"../../lib":693,"./constants":917}],926:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),heatmapHoverPoints=_dereq_("../heatmap/hover");module.exports=function hoverPoints(pointData,xval,yval,hovermode,hoverLayer){var hoverData=heatmapHoverPoints(pointData,xval,yval,hovermode,hoverLayer,!0);return hoverData&&hoverData.forEach(function(hoverPt){var trace=hoverPt.trace;"constraint"===trace.contours.type&&(trace.fillcolor&&Color.opacity(trace.fillcolor)?hoverPt.color=Color.addOpacity(trace.fillcolor,1):trace.contours.showlines&&Color.opacity(trace.line.color)&&(hoverPt.color=Color.addOpacity(trace.line.color,1)))}),hoverData}},{"../../components/color":567,"../heatmap/hover":949}],927:[function(_dereq_,module,exports){"use strict";var Contour={};Contour.attributes=_dereq_("./attributes"),Contour.supplyDefaults=_dereq_("./defaults"),Contour.calc=_dereq_("./calc"),Contour.plot=_dereq_("./plot").plot,Contour.style=_dereq_("./style"),Contour.colorbar=_dereq_("./colorbar"),Contour.hoverPoints=_dereq_("./hover"),Contour.moduleType="trace",Contour.name="contour",Contour.basePlotModule=_dereq_("../../plots/cartesian"),Contour.categories=["cartesian","svg","2dMap","contour","showLegend"],Contour.meta={},module.exports=Contour},{"../../plots/cartesian":753,"./attributes":913,"./calc":914,"./colorbar":916,"./defaults":922,"./hover":926,"./plot":931,"./style":933}],928:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function handleLabelDefaults(coerce,layout,lineColor,opts){if(opts||(opts={}),coerce("contours.showlabels")){var globalFont=layout.font;Lib.coerceFont(coerce,"contours.labelfont",{family:globalFont.family,size:globalFont.size,color:lineColor}),coerce("contours.labelformat")}!1!==opts.hasHover&&coerce("zhoverformat")}},{"../../lib":693}],929:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Colorscale=_dereq_("../../components/colorscale"),endPlus=_dereq_("./end_plus");module.exports=function makeColorMap(trace){var contours=trace.contours,start=contours.start,end=endPlus(contours),cs=contours.size||1,nc=Math.floor((end-start)/cs)+1,extra="lines"===contours.coloring?0:1;isFinite(cs)||(cs=1,nc=1);var si,i,scl=trace.colorscale,len=scl.length,domain=new Array(len),range=new Array(len);if("heatmap"===contours.coloring){for(trace.zauto&&!1===trace.autocontour&&(trace.zmin=start-cs/2,trace.zmax=trace.zmin+nc*cs),i=0;i<len;i++)si=scl[i],domain[i]=si[0]*(trace.zmax-trace.zmin)+trace.zmin,range[i]=si[1];var zRange=d3.extent([trace.zmin,trace.zmax,contours.start,contours.start+cs*(nc-1)]),zmin=zRange[trace.zmin<trace.zmax?0:1],zmax=zRange[trace.zmin<trace.zmax?1:0];zmin!==trace.zmin&&(domain.splice(0,0,zmin),range.splice(0,0,Range[0])),zmax!==trace.zmax&&(domain.push(zmax),range.push(range[range.length-1]))}else for(i=0;i<len;i++)si=scl[i],domain[i]=(si[0]*(nc+extra-1)-extra/2)*cs+start,range[i]=si[1];return Colorscale.makeColorScaleFunc({domain:domain,range:range},{noNumericCheck:!0})}},{"../../components/colorscale":582,"./end_plus":924,d3:147}],930:[function(_dereq_,module,exports){"use strict";var constants=_dereq_("./constants");function getMarchingIndex(val,corners){var mi=(corners[0][0]>val?0:1)+(corners[0][1]>val?0:2)+(corners[1][1]>val?0:4)+(corners[1][0]>val?0:8);return 5===mi||10===mi?val>(corners[0][0]+corners[0][1]+corners[1][0]+corners[1][1])/4?5===mi?713:1114:5===mi?104:208:15===mi?0:mi}module.exports=function makeCrossings(pathinfo){var xi,yi,startIndices,ystartIndices,label,corners,mi,pi,i,z=pathinfo[0].z,m=z.length,n=z[0].length,twoWide=2===m||2===n;for(yi=0;yi<m-1;yi++)for(ystartIndices=[],0===yi&&(ystartIndices=ystartIndices.concat(constants.BOTTOMSTART)),yi===m-2&&(ystartIndices=ystartIndices.concat(constants.TOPSTART)),xi=0;xi<n-1;xi++)for(startIndices=ystartIndices.slice(),0===xi&&(startIndices=startIndices.concat(constants.LEFTSTART)),xi===n-2&&(startIndices=startIndices.concat(constants.RIGHTSTART)),label=xi+","+yi,corners=[[z[yi][xi],z[yi][xi+1]],[z[yi+1][xi],z[yi+1][xi+1]]],i=0;i<pathinfo.length;i++)(mi=getMarchingIndex((pi=pathinfo[i]).level,corners))&&(pi.crossings[label]=mi,-1!==startIndices.indexOf(mi)&&(pi.starts.push([xi,yi]),twoWide&&-1!==startIndices.indexOf(mi,startIndices.indexOf(mi)+1)&&pi.starts.push([xi,yi])))}},{"./constants":917}],931:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../../components/drawing"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),Axes=_dereq_("../../plots/cartesian/axes"),setConvert=_dereq_("../../plots/cartesian/set_convert"),heatmapPlot=_dereq_("../heatmap/plot"),makeCrossings=_dereq_("./make_crossings"),findAllPaths=_dereq_("./find_all_paths"),emptyPathinfo=_dereq_("./empty_pathinfo"),convertToConstraints=_dereq_("./convert_to_constraints"),closeBoundaries=_dereq_("./close_boundaries"),constants=_dereq_("./constants"),costConstants=constants.LABELOPTIMIZER;function joinAllPaths(pi,perimeter){var endpt,newendpt,cnt,nexti,possiblei,addpath,pt,fullpath=function initFullPath(pi,perimeter){var prefixBoundary=pi.prefixBoundary;if(void 0===prefixBoundary){var edgeVal2=Math.min(pi.z[0][0],pi.z[0][1]);prefixBoundary=!pi.edgepaths.length&&edgeVal2>pi.level}return prefixBoundary?"M"+perimeter.join("L")+"Z":""}(pi,perimeter),i=0,startsleft=pi.edgepaths.map(function(v,i){return i}),newloop=!0;function isbottom(pt){return Math.abs(pt[1]-perimeter[2][1])<.01}function isleft(pt){return Math.abs(pt[0]-perimeter[0][0])<.01}function isright(pt){return Math.abs(pt[0]-perimeter[2][0])<.01}for(;startsleft.length;){for(addpath=Drawing.smoothopen(pi.edgepaths[i],pi.smoothing),fullpath+=newloop?addpath:addpath.replace(/^M/,"L"),startsleft.splice(startsleft.indexOf(i),1),endpt=pi.edgepaths[i][pi.edgepaths[i].length-1],nexti=-1,cnt=0;cnt<4;cnt++){if(!endpt){Lib.log("Missing end?",i,pi);break}for(pt=endpt,Math.abs(pt[1]-perimeter[0][1])<.01&&!isright(endpt)?newendpt=perimeter[1]:isleft(endpt)?newendpt=perimeter[0]:isbottom(endpt)?newendpt=perimeter[3]:isright(endpt)&&(newendpt=perimeter[2]),possiblei=0;possiblei<pi.edgepaths.length;possiblei++){var ptNew=pi.edgepaths[possiblei][0];Math.abs(endpt[0]-newendpt[0])<.01?Math.abs(endpt[0]-ptNew[0])<.01&&(ptNew[1]-endpt[1])*(newendpt[1]-ptNew[1])>=0&&(newendpt=ptNew,nexti=possiblei):Math.abs(endpt[1]-newendpt[1])<.01?Math.abs(endpt[1]-ptNew[1])<.01&&(ptNew[0]-endpt[0])*(newendpt[0]-ptNew[0])>=0&&(newendpt=ptNew,nexti=possiblei):Lib.log("endpt to newendpt is not vert. or horz.",endpt,newendpt,ptNew)}if(endpt=newendpt,nexti>=0)break;fullpath+="L"+newendpt}if(nexti===pi.edgepaths.length){Lib.log("unclosed perimeter path");break}i=nexti,(newloop=-1===startsleft.indexOf(i))&&(i=startsleft[0],fullpath+="Z")}for(i=0;i<pi.paths.length;i++)fullpath+=Drawing.smoothclosed(pi.paths[i],pi.smoothing);return fullpath}function locationCost(loc,textOpts,labelData,bounds){var halfWidth=textOpts.width/2,halfHeight=textOpts.height/2,x=loc.x,y=loc.y,theta=loc.theta,dx=Math.cos(theta)*halfWidth,dy=Math.sin(theta)*halfWidth,normX=(x>bounds.center?bounds.right-x:x-bounds.left)/(dx+Math.abs(Math.sin(theta)*halfHeight)),normY=(y>bounds.middle?bounds.bottom-y:y-bounds.top)/(Math.abs(dy)+Math.cos(theta)*halfHeight);if(normX<1||normY<1)return 1/0;var cost=costConstants.EDGECOST*(1/(normX-1)+1/(normY-1));cost+=costConstants.ANGLECOST*theta*theta;for(var x1=x-dx,y1=y-dy,x2=x+dx,y2=y+dy,i=0;i<labelData.length;i++){var labeli=labelData[i],dxd=Math.cos(labeli.theta)*labeli.width/2,dyd=Math.sin(labeli.theta)*labeli.width/2,dist=2*Lib.segmentDistance(x1,y1,x2,y2,labeli.x-dxd,labeli.y-dyd,labeli.x+dxd,labeli.y+dyd)/(textOpts.height+labeli.height),sameLevel=labeli.level===textOpts.level,distOffset=sameLevel?costConstants.SAMELEVELDISTANCE:1;if(dist<=distOffset)return 1/0;cost+=costConstants.NEIGHBORCOST*(sameLevel?costConstants.SAMELEVELFACTOR:1)/(dist-distOffset)}return cost}exports.plot=function plot(gd,plotinfo,cdcontours,contourLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,fullLayout=gd._fullLayout;Lib.makeTraceGroups(contourLayer,cdcontours,"contour").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],trace=cd0.trace,x=cd0.x,y=cd0.y,contours=trace.contours,pathinfo=emptyPathinfo(contours,plotinfo,cd0),heatmapColoringLayer=Lib.ensureSingle(plotGroup,"g","heatmapcoloring"),cdheatmaps=[];"heatmap"===contours.coloring&&(trace.zauto&&!1===trace.autocontour&&(trace._input.zmin=trace.zmin=contours.start-contours.size/2,trace._input.zmax=trace.zmax=trace.zmin+pathinfo.length*contours.size),cdheatmaps=[cd]),heatmapPlot(gd,plotinfo,cdheatmaps,heatmapColoringLayer),makeCrossings(pathinfo),findAllPaths(pathinfo);var leftedge=xa.c2p(x[0],!0),rightedge=xa.c2p(x[x.length-1],!0),bottomedge=ya.c2p(y[0],!0),topedge=ya.c2p(y[y.length-1],!0),perimeter=[[leftedge,topedge],[rightedge,topedge],[rightedge,bottomedge],[leftedge,bottomedge]],fillPathinfo=pathinfo;"constraint"===contours.type&&(fillPathinfo=convertToConstraints(pathinfo,contours._operation),closeBoundaries(fillPathinfo,contours._operation,perimeter,trace)),function makeBackground(plotgroup,perimeter,contours){var bgfill=Lib.ensureSingle(plotgroup,"g","contourbg").selectAll("path").data("fill"===contours.coloring?[0]:[]);bgfill.enter().append("path"),bgfill.exit().remove(),bgfill.attr("d","M"+perimeter.join("L")+"Z").style("stroke","none")}(plotGroup,perimeter,contours),function makeFills(plotgroup,pathinfo,perimeter,contours){var fillitems=Lib.ensureSingle(plotgroup,"g","contourfill").selectAll("path").data("fill"===contours.coloring||"constraint"===contours.type&&"="!==contours._operation?pathinfo:[]);fillitems.enter().append("path"),fillitems.exit().remove(),fillitems.each(function(pi){var fullpath=joinAllPaths(pi,perimeter);fullpath?d3.select(this).attr("d",fullpath).style("stroke","none"):d3.select(this).remove()})}(plotGroup,fillPathinfo,perimeter,contours),function makeLinesAndLabels(plotgroup,pathinfo,gd,cd0,contours,perimeter){var lineContainer=Lib.ensureSingle(plotgroup,"g","contourlines"),showLines=!1!==contours.showlines,showLabels=contours.showlabels,clipLinesForLabels=showLines&&showLabels,linegroup=exports.createLines(lineContainer,showLines||showLabels,pathinfo),lineClip=exports.createLineClip(lineContainer,clipLinesForLabels,gd._fullLayout._clips,cd0.trace.uid),labelGroup=plotgroup.selectAll("g.contourlabels").data(showLabels?[0]:[]);if(labelGroup.exit().remove(),labelGroup.enter().append("g").classed("contourlabels",!0),showLabels){var labelClipPathData=[perimeter],labelData=[];Lib.clearLocationCache();var contourFormat=exports.labelFormatter(contours,cd0.t.cb,gd._fullLayout),dummyText=Drawing.tester.append("text").attr("data-notex",1).call(Drawing.font,contours.labelfont),xLen=pathinfo[0].xaxis._length,yLen=pathinfo[0].yaxis._length,bounds={left:Math.max(perimeter[0][0],0),right:Math.min(perimeter[2][0],xLen),top:Math.max(perimeter[0][1],0),bottom:Math.min(perimeter[2][1],yLen)};bounds.middle=(bounds.top+bounds.bottom)/2,bounds.center=(bounds.left+bounds.right)/2;var plotDiagonal=Math.sqrt(xLen*xLen+yLen*yLen),normLength=constants.LABELDISTANCE*plotDiagonal/Math.max(1,pathinfo.length/constants.LABELINCREASE);linegroup.each(function(d){var textOpts=exports.calcTextOpts(d.level,contourFormat,dummyText,gd);d3.select(this).selectAll("path").each(function(){var pathBounds=Lib.getVisibleSegment(this,bounds,textOpts.height/2);if(pathBounds&&!(pathBounds.len<(textOpts.width+textOpts.height)*constants.LABELMIN))for(var maxLabels=Math.min(Math.ceil(pathBounds.len/normLength),constants.LABELMAX),i=0;i<maxLabels;i++){var loc=exports.findBestTextLocation(this,pathBounds,textOpts,labelData,bounds);if(!loc)break;exports.addLabelData(loc,textOpts,labelData,labelClipPathData)}})}),dummyText.remove(),exports.drawLabels(labelGroup,labelData,gd,lineClip,clipLinesForLabels?labelClipPathData:null)}showLabels&&!showLines&&linegroup.remove()}(plotGroup,pathinfo,gd,cd0,contours,perimeter),function clipGaps(plotGroup,plotinfo,clips,cd0,perimeter){var clipId="clip"+cd0.trace.uid,clipPath=clips.selectAll("#"+clipId).data(cd0.trace.connectgaps?[]:[0]);if(clipPath.enter().append("clipPath").classed("contourclip",!0).attr("id",clipId),clipPath.exit().remove(),!1===cd0.trace.connectgaps){var clipPathInfo={level:.9,crossings:{},starts:[],edgepaths:[],paths:[],xaxis:plotinfo.xaxis,yaxis:plotinfo.yaxis,x:cd0.x,y:cd0.y,z:function makeClipMask(cd0){var i,emptyPoint,empties=cd0.trace._emptypoints,z=[],m=cd0.z.length,n=cd0.z[0].length,row=[];for(i=0;i<n;i++)row.push(1);for(i=0;i<m;i++)z.push(row.slice());for(i=0;i<empties.length;i++)emptyPoint=empties[i],z[emptyPoint[0]][emptyPoint[1]]=0;return cd0.zmask=z,z}(cd0),smoothing:0};makeCrossings([clipPathInfo]),findAllPaths([clipPathInfo]);var fullpath=joinAllPaths(clipPathInfo,perimeter),path=Lib.ensureSingle(clipPath,"path","");path.attr("d",fullpath)}else clipId=null;plotGroup.call(Drawing.setClipUrl,clipId)}(plotGroup,plotinfo,fullLayout._clips,cd0,perimeter)})},exports.createLines=function(lineContainer,makeLines,pathinfo){var smoothing=pathinfo[0].smoothing,linegroup=lineContainer.selectAll("g.contourlevel").data(makeLines?pathinfo:[]);if(linegroup.exit().remove(),linegroup.enter().append("g").classed("contourlevel",!0),makeLines){var opencontourlines=linegroup.selectAll("path.openline").data(function(d){return d.pedgepaths||d.edgepaths});opencontourlines.exit().remove(),opencontourlines.enter().append("path").classed("openline",!0),opencontourlines.attr("d",function(d){return Drawing.smoothopen(d,smoothing)}).style("stroke-miterlimit",1).style("vector-effect","non-scaling-stroke");var closedcontourlines=linegroup.selectAll("path.closedline").data(function(d){return d.ppaths||d.paths});closedcontourlines.exit().remove(),closedcontourlines.enter().append("path").classed("closedline",!0),closedcontourlines.attr("d",function(d){return Drawing.smoothclosed(d,smoothing)}).style("stroke-miterlimit",1).style("vector-effect","non-scaling-stroke")}return linegroup},exports.createLineClip=function(lineContainer,clipLinesForLabels,clips,uid){var clipId=clipLinesForLabels?"clipline"+uid:null,lineClip=clips.selectAll("#"+clipId).data(clipLinesForLabels?[0]:[]);return lineClip.exit().remove(),lineClip.enter().append("clipPath").classed("contourlineclip",!0).attr("id",clipId),Drawing.setClipUrl(lineContainer,clipId),lineClip},exports.labelFormatter=function(contours,colorbar,fullLayout){if(contours.labelformat)return fullLayout._d3locale.numberFormat(contours.labelformat);var formatAxis;if(colorbar)formatAxis=colorbar.axis;else{if(formatAxis={type:"linear",_id:"ycontour",showexponent:"all",exponentformat:"B"},"constraint"===contours.type){var value=contours.value;Array.isArray(value)?formatAxis.range=[value[0],value[value.length-1]]:formatAxis.range=[value,value]}else formatAxis.range=[contours.start,contours.end],formatAxis.nticks=(contours.end-contours.start)/contours.size;formatAxis.range[0]===formatAxis.range[1]&&(formatAxis.range[1]+=formatAxis.range[0]||1),formatAxis.nticks||(formatAxis.nticks=1e3),setConvert(formatAxis,fullLayout),Axes.prepTicks(formatAxis),formatAxis._tmin=null,formatAxis._tmax=null}return function(v){return Axes.tickText(formatAxis,v).text}},exports.calcTextOpts=function(level,contourFormat,dummyText,gd){var text=contourFormat(level);dummyText.text(text).call(svgTextUtils.convertToTspans,gd);var bBox=Drawing.bBox(dummyText.node(),!0);return{text:text,width:bBox.width,height:bBox.height,level:level,dy:(bBox.top+bBox.bottom)/2}},exports.findBestTextLocation=function(path,pathBounds,textOpts,labelData,plotBounds){var p0,dp,pMax,pMin,loc,textWidth=textOpts.width;pathBounds.isClosed?(dp=pathBounds.len/costConstants.INITIALSEARCHPOINTS,p0=pathBounds.min+dp/2,pMax=pathBounds.max):(dp=(pathBounds.len-textWidth)/(costConstants.INITIALSEARCHPOINTS+1),p0=pathBounds.min+dp+textWidth/2,pMax=pathBounds.max-(dp+textWidth)/2);for(var cost=1/0,j=0;j<costConstants.ITERATIONS;j++){for(var p=p0;p<pMax;p+=dp){var newLocation=Lib.getTextLocation(path,pathBounds.total,p,textWidth),newCost=locationCost(newLocation,textOpts,labelData,plotBounds);newCost<cost&&(cost=newCost,loc=newLocation,pMin=p)}if(cost>2*costConstants.MAXCOST)break;j&&(dp/=2),pMax=(p0=pMin-dp/2)+1.5*dp}if(cost<=costConstants.MAXCOST)return loc},exports.addLabelData=function(loc,textOpts,labelData,labelClipPathData){var halfWidth=textOpts.width/2,halfHeight=textOpts.height/2,x=loc.x,y=loc.y,theta=loc.theta,sin=Math.sin(theta),cos=Math.cos(theta),dxw=halfWidth*cos,dxh=halfHeight*sin,dyw=halfWidth*sin,dyh=-halfHeight*cos,bBoxPts=[[x-dxw-dxh,y-dyw-dyh],[x+dxw-dxh,y+dyw-dyh],[x+dxw+dxh,y+dyw+dyh],[x-dxw+dxh,y-dyw+dyh]];labelData.push({text:textOpts.text,x:x,y:y,dy:textOpts.dy,theta:theta,level:textOpts.level,width:textOpts.width,height:textOpts.height}),labelClipPathData.push(bBoxPts)},exports.drawLabels=function(labelGroup,labelData,gd,lineClip,labelClipPathData){var labels=labelGroup.selectAll("text").data(labelData,function(d){return d.text+","+d.x+","+d.y+","+d.theta});if(labels.exit().remove(),labels.enter().append("text").attr({"data-notex":1,"text-anchor":"middle"}).each(function(d){var x=d.x+Math.sin(d.theta)*d.dy,y=d.y-Math.cos(d.theta)*d.dy;d3.select(this).text(d.text).attr({x:x,y:y,transform:"rotate("+180*d.theta/Math.PI+" "+x+" "+y+")"}).call(svgTextUtils.convertToTspans,gd)}),labelClipPathData){for(var clipPath="",i=0;i<labelClipPathData.length;i++)clipPath+="M"+labelClipPathData[i].join("L")+"Z";Lib.ensureSingle(lineClip,"path","").attr("d",clipPath)}}},{"../../components/drawing":592,"../../lib":693,"../../lib/svg_text_utils":718,"../../plots/cartesian/axes":742,"../../plots/cartesian/set_convert":760,"../heatmap/plot":954,"./close_boundaries":915,"./constants":917,"./convert_to_constraints":921,"./empty_pathinfo":923,"./find_all_paths":925,"./make_crossings":930,d3:147}],932:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),Lib=_dereq_("../../lib");function autoContours(start,end,ncontours){var dummyAx={type:"linear",range:[start,end]};return Axes.autoTicks(dummyAx,(end-start)/(ncontours||15)),dummyAx}module.exports=function setContours(trace){var contours=trace.contours;if(trace.autocontour){var zmin=trace.zmin,zmax=trace.zmax;void 0!==zmin&&void 0!==zmax||(zmin=Lib.aggNums(Math.min,null,trace._z),zmax=Lib.aggNums(Math.max,null,trace._z));var dummyAx=autoContours(zmin,zmax,trace.ncontours);contours.size=dummyAx.dtick,contours.start=Axes.tickFirst(dummyAx),dummyAx.range.reverse(),contours.end=Axes.tickFirst(dummyAx),contours.start===zmin&&(contours.start+=contours.size),contours.end===zmax&&(contours.end-=contours.size),contours.start>contours.end&&(contours.start=contours.end=(contours.start+contours.end)/2),trace._input.contours||(trace._input.contours={}),Lib.extendFlat(trace._input.contours,{start:contours.start,end:contours.end,size:contours.size}),trace._input.autocontour=!0}else if("constraint"!==contours.type){var sizeOut,start=contours.start,end=contours.end,inputContours=trace._input.contours;if(start>end&&(contours.start=inputContours.start=end,end=contours.end=inputContours.end=start,start=contours.start),!(contours.size>0))sizeOut=start===end?1:autoContours(start,end,trace.ncontours).dtick,inputContours.size=contours.size=sizeOut}}},{"../../lib":693,"../../plots/cartesian/axes":742}],933:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),heatmapStyle=_dereq_("../heatmap/style"),makeColorMap=_dereq_("./make_color_map");module.exports=function style(gd){var contours=d3.select(gd).selectAll("g.contour");contours.style("opacity",function(d){return d[0].trace.opacity}),contours.each(function(d){var c=d3.select(this),trace=d[0].trace,contours=trace.contours,line=trace.line,cs=contours.size||1,start=contours.start,isConstraintType="constraint"===contours.type,colorLines=!isConstraintType&&"lines"===contours.coloring,colorFills=!isConstraintType&&"fill"===contours.coloring,colorMap=colorLines||colorFills?makeColorMap(trace):null;c.selectAll("g.contourlevel").each(function(d){d3.select(this).selectAll("path").call(Drawing.lineGroupStyle,line.width,colorLines?colorMap(d.level):line.color,line.dash)});var labelFont=contours.labelfont;if(c.selectAll("g.contourlabels text").each(function(d){Drawing.font(d3.select(this),{family:labelFont.family,size:labelFont.size,color:labelFont.color||(colorLines?colorMap(d.level):line.color)})}),isConstraintType)c.selectAll("g.contourfill path").style("fill",trace.fillcolor);else if(colorFills){var firstFill;c.selectAll("g.contourfill path").style("fill",function(d){return void 0===firstFill&&(firstFill=d.level),colorMap(d.level+.5*cs)}),void 0===firstFill&&(firstFill=start),c.selectAll("g.contourbg path").style("fill",colorMap(firstFill-.5*cs))}}),heatmapStyle(gd)}},{"../../components/drawing":592,"../heatmap/style":955,"./make_color_map":929,d3:147}],934:[function(_dereq_,module,exports){"use strict";var colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),handleLabelDefaults=_dereq_("./label_defaults");module.exports=function handleStyleDefaults(traceIn,traceOut,coerce,layout,opts){var showLines,coloring=coerce("contours.coloring"),lineColor="";"fill"===coloring&&(showLines=coerce("contours.showlines")),!1!==showLines&&("lines"!==coloring&&(lineColor=coerce("line.color","#000")),coerce("line.width",.5),coerce("line.dash")),"none"!==coloring&&(!0!==traceIn.showlegend&&(traceOut.showlegend=!1),traceOut._dfltShowLegend=!1,colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"z"})),coerce("line.smoothing"),handleLabelDefaults(coerce,layout,lineColor,opts)}},{"../../components/colorscale/defaults":577,"./label_defaults":928}],935:[function(_dereq_,module,exports){"use strict";var heatmapAttrs=_dereq_("../heatmap/attributes"),contourAttrs=_dereq_("../contour/attributes"),contourContourAttrs=contourAttrs.contours,scatterAttrs=_dereq_("../scatter/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,scatterLineAttrs=scatterAttrs.line;module.exports=extendFlat({carpet:{valType:"string",editType:"calc"},z:heatmapAttrs.z,a:heatmapAttrs.x,a0:heatmapAttrs.x0,da:heatmapAttrs.dx,b:heatmapAttrs.y,b0:heatmapAttrs.y0,db:heatmapAttrs.dy,text:heatmapAttrs.text,transpose:heatmapAttrs.transpose,atype:heatmapAttrs.xtype,btype:heatmapAttrs.ytype,fillcolor:contourAttrs.fillcolor,autocontour:contourAttrs.autocontour,ncontours:contourAttrs.ncontours,contours:{type:contourContourAttrs.type,start:contourContourAttrs.start,end:contourContourAttrs.end,size:contourContourAttrs.size,coloring:{valType:"enumerated",values:["fill","lines","none"],dflt:"fill",editType:"calc"},showlines:contourContourAttrs.showlines,showlabels:contourContourAttrs.showlabels,labelfont:contourContourAttrs.labelfont,labelformat:contourContourAttrs.labelformat,operation:contourContourAttrs.operation,value:contourContourAttrs.value,editType:"calc",impliedEdits:{autocontour:!1}},line:{color:extendFlat({},scatterLineAttrs.color,{}),width:scatterLineAttrs.width,dash:scatterLineAttrs.dash,smoothing:extendFlat({},scatterLineAttrs.smoothing,{}),editType:"plot"}},colorscaleAttrs("",{cLetter:"z",autoColorDflt:!1}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../contour/attributes":913,"../heatmap/attributes":942,"../scatter/attributes":1032}],936:[function(_dereq_,module,exports){"use strict";var colorscaleCalc=_dereq_("../../components/colorscale/calc"),isArray1D=_dereq_("../../lib").isArray1D,convertColumnData=_dereq_("../heatmap/convert_column_xyz"),clean2dArray=_dereq_("../heatmap/clean_2d_array"),maxRowLength=_dereq_("../heatmap/max_row_length"),interp2d=_dereq_("../heatmap/interp2d"),findEmpties=_dereq_("../heatmap/find_empties"),makeBoundArray=_dereq_("../heatmap/make_bound_array"),supplyDefaults=_dereq_("./defaults"),lookupCarpet=_dereq_("../carpet/lookup_carpetid"),setContours=_dereq_("../contour/set_contours");module.exports=function calc(gd,trace){var carpet=trace._carpetTrace=lookupCarpet(gd,trace);if(carpet&&carpet.visible&&"legendonly"!==carpet.visible){if(!trace.a||!trace.b){var carpetdata=gd.data[carpet.index],tracedata=gd.data[trace.index];tracedata.a||(tracedata.a=carpetdata.a),tracedata.b||(tracedata.b=carpetdata.b),supplyDefaults(tracedata,trace,trace._defaultColor,gd._fullLayout)}var cd=function heatmappishCalc(gd,trace){var a,a0,da,b,b0,db,z,carpet=trace._carpetTrace,aax=carpet.aaxis,bax=carpet.baxis;aax._minDtick=0,bax._minDtick=0,isArray1D(trace.z)&&convertColumnData(trace,aax,bax,"a","b",["z"]);a=trace._a=trace._a||trace.a,b=trace._b=trace._b||trace.b,a=a?aax.makeCalcdata(trace,"_a"):[],b=b?bax.makeCalcdata(trace,"_b"):[],a0=trace.a0||0,da=trace.da||1,b0=trace.b0||0,db=trace.db||1,z=trace._z=clean2dArray(trace._z||trace.z,trace.transpose),trace._emptypoints=findEmpties(z),interp2d(z,trace._emptypoints);var xlen=maxRowLength(z),xIn="scaled"===trace.xtype?"":a,xArray=makeBoundArray(trace,xIn,a0,da,xlen,aax),yIn="scaled"===trace.ytype?"":b,yArray=makeBoundArray(trace,yIn,b0,db,z.length,bax),cd0={a:xArray,b:yArray,z:z};"levels"===trace.contours.type&&"none"!==trace.contours.coloring&&colorscaleCalc(trace,z,"","z");return[cd0]}(0,trace);return setContours(trace),cd}}},{"../../components/colorscale/calc":575,"../../lib":693,"../carpet/lookup_carpetid":891,"../contour/set_contours":932,"../heatmap/clean_2d_array":944,"../heatmap/convert_column_xyz":946,"../heatmap/find_empties":948,"../heatmap/interp2d":951,"../heatmap/make_bound_array":952,"../heatmap/max_row_length":953,"./defaults":937}],937:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleXYZDefaults=_dereq_("../heatmap/xyz_defaults"),attributes=_dereq_("./attributes"),handleConstraintDefaults=_dereq_("../contour/constraint_defaults"),handleContoursDefaults=_dereq_("../contour/contours_defaults"),handleStyleDefaults=_dereq_("../contour/style_defaults");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}if(coerce("carpet"),traceIn.a&&traceIn.b){if(!handleXYZDefaults(traceIn,traceOut,coerce,layout,"a","b"))return void(traceOut.visible=!1);coerce("text"),"constraint"===coerce("contours.type")?handleConstraintDefaults(traceIn,traceOut,coerce,layout,defaultColor,{hasHover:!1}):(handleContoursDefaults(traceIn,traceOut,coerce,function coerce2(attr){return Lib.coerce2(traceIn,traceOut,attributes,attr)}),handleStyleDefaults(traceIn,traceOut,coerce,layout,{hasHover:!1}))}else traceOut._defaultColor=defaultColor,traceOut._length=null}},{"../../lib":693,"../contour/constraint_defaults":918,"../contour/contours_defaults":920,"../contour/style_defaults":934,"../heatmap/xyz_defaults":957,"./attributes":935}],938:[function(_dereq_,module,exports){"use strict";var ContourCarpet={};ContourCarpet.attributes=_dereq_("./attributes"),ContourCarpet.supplyDefaults=_dereq_("./defaults"),ContourCarpet.colorbar=_dereq_("../contour/colorbar"),ContourCarpet.calc=_dereq_("./calc"),ContourCarpet.plot=_dereq_("./plot"),ContourCarpet.style=_dereq_("../contour/style"),ContourCarpet.moduleType="trace",ContourCarpet.name="contourcarpet",ContourCarpet.basePlotModule=_dereq_("../../plots/cartesian"),ContourCarpet.categories=["cartesian","svg","carpet","contour","symbols","showLegend","hasLines","carpetDependent"],ContourCarpet.meta={},module.exports=ContourCarpet},{"../../plots/cartesian":753,"../contour/colorbar":916,"../contour/style":933,"./attributes":935,"./calc":936,"./defaults":937,"./plot":941}],939:[function(_dereq_,module,exports){"use strict";var Drawing=_dereq_("../../components/drawing"),axisAlignedLine=_dereq_("../carpet/axis_aligned_line"),Lib=_dereq_("../../lib");module.exports=function joinAllPaths(trace,pi,perimeter,ab2p,carpet,carpetcd,xa,ya){var i,endpt,newendpt,cnt,nexti,possiblei,addpath,fullpath="",startsleft=pi.edgepaths.map(function(v,i){return i}),newloop=!0,atol=1e-4*Math.abs(perimeter[0][0]-perimeter[2][0]),btol=1e-4*Math.abs(perimeter[0][1]-perimeter[2][1]);function istop(pt){return Math.abs(pt[1]-perimeter[0][1])<btol}function isbottom(pt){return Math.abs(pt[1]-perimeter[2][1])<btol}function isleft(pt){return Math.abs(pt[0]-perimeter[0][0])<atol}function isright(pt){return Math.abs(pt[0]-perimeter[2][0])<atol}function pathto(pt0,pt1){var i,j,segments,axis,path="";for(istop(pt0)&&!isright(pt0)||isbottom(pt0)&&!isleft(pt0)?(axis=carpet.aaxis,segments=axisAlignedLine(carpet,carpetcd,[pt0[0],pt1[0]],.5*(pt0[1]+pt1[1]))):(axis=carpet.baxis,segments=axisAlignedLine(carpet,carpetcd,.5*(pt0[0]+pt1[0]),[pt0[1],pt1[1]])),i=1;i<segments.length;i++)for(path+=axis.smoothing?"C":"L",j=0;j<segments[i].length;j++){var pt=segments[i][j];path+=[xa.c2p(pt[0]),ya.c2p(pt[1])]+" "}return path}for(i=0,endpt=null;startsleft.length;){var startpt=pi.edgepaths[i][0];for(endpt&&(fullpath+=pathto(endpt,startpt)),addpath=Drawing.smoothopen(pi.edgepaths[i].map(ab2p),pi.smoothing),fullpath+=newloop?addpath:addpath.replace(/^M/,"L"),startsleft.splice(startsleft.indexOf(i),1),endpt=pi.edgepaths[i][pi.edgepaths[i].length-1],nexti=-1,cnt=0;cnt<4;cnt++){if(!endpt){Lib.log("Missing end?",i,pi);break}for(istop(endpt)&&!isright(endpt)?newendpt=perimeter[1]:isleft(endpt)?newendpt=perimeter[0]:isbottom(endpt)?newendpt=perimeter[3]:isright(endpt)&&(newendpt=perimeter[2]),possiblei=0;possiblei<pi.edgepaths.length;possiblei++){var ptNew=pi.edgepaths[possiblei][0];Math.abs(endpt[0]-newendpt[0])<atol?Math.abs(endpt[0]-ptNew[0])<atol&&(ptNew[1]-endpt[1])*(newendpt[1]-ptNew[1])>=0&&(newendpt=ptNew,nexti=possiblei):Math.abs(endpt[1]-newendpt[1])<btol?Math.abs(endpt[1]-ptNew[1])<btol&&(ptNew[0]-endpt[0])*(newendpt[0]-ptNew[0])>=0&&(newendpt=ptNew,nexti=possiblei):Lib.log("endpt to newendpt is not vert. or horz.",endpt,newendpt,ptNew)}if(nexti>=0)break;fullpath+=pathto(endpt,newendpt),endpt=newendpt}if(nexti===pi.edgepaths.length){Lib.log("unclosed perimeter path");break}i=nexti,(newloop=-1===startsleft.indexOf(i))&&(i=startsleft[0],fullpath+=pathto(endpt,newendpt)+"Z",endpt=null)}for(i=0;i<pi.paths.length;i++)fullpath+=Drawing.smoothclosed(pi.paths[i].map(ab2p),pi.smoothing);return fullpath}},{"../../components/drawing":592,"../../lib":693,"../carpet/axis_aligned_line":875}],940:[function(_dereq_,module,exports){"use strict";module.exports=function mapPathinfo(pathinfo,map){var i,j,k,pi,pedgepaths,ppaths,pedgepath,ppath,path;for(i=0;i<pathinfo.length;i++){for(pedgepaths=(pi=pathinfo[i]).pedgepaths=[],ppaths=pi.ppaths=[],j=0;j<pi.edgepaths.length;j++){for(path=pi.edgepaths[j],pedgepath=[],k=0;k<path.length;k++)pedgepath[k]=map(path[k]);pedgepaths.push(pedgepath)}for(j=0;j<pi.paths.length;j++){for(path=pi.paths[j],ppath=[],k=0;k<path.length;k++)ppath[k]=map(path[k]);ppaths.push(ppath)}}}},{}],941:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),map1dArray=_dereq_("../carpet/map_1d_array"),makepath=_dereq_("../carpet/makepath"),Drawing=_dereq_("../../components/drawing"),Lib=_dereq_("../../lib"),makeCrossings=_dereq_("../contour/make_crossings"),findAllPaths=_dereq_("../contour/find_all_paths"),contourPlot=_dereq_("../contour/plot"),constants=_dereq_("../contour/constants"),convertToConstraints=_dereq_("../contour/convert_to_constraints"),joinAllPaths=_dereq_("./join_all_paths"),emptyPathinfo=_dereq_("../contour/empty_pathinfo"),mapPathinfo=_dereq_("./map_pathinfo"),lookupCarpet=_dereq_("../carpet/lookup_carpetid"),closeBoundaries=_dereq_("../contour/close_boundaries");function getUnitVector(path,p0,p1){var pt0=path.getPointAtLength(p0),pt1=path.getPointAtLength(p1),dx=pt1.x-pt0.x,dy=pt1.y-pt0.y,len=Math.sqrt(dx*dx+dy*dy);return[dx/len,dy/len]}function normalizeVector(v){var len=Math.sqrt(v[0]*v[0]+v[1]*v[1]);return[v[0]/len,v[1]/len]}function vectorTan(v0,v1){var cos=Math.abs(v0[0]*v1[0]+v0[1]*v1[1]);return Math.sqrt(1-cos*cos)/cos}module.exports=function plot(gd,plotinfo,cdcontours,contourcarpetLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis;Lib.makeTraceGroups(contourcarpetLayer,cdcontours,"contour").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],trace=cd0.trace,carpet=trace._carpetTrace=lookupCarpet(gd,trace),carpetcd=gd.calcdata[carpet.index][0];if(carpet.visible&&"legendonly"!==carpet.visible){var a=cd0.a,b=cd0.b,contours=trace.contours,pathinfo=emptyPathinfo(contours,plotinfo,cd0),isConstraint="constraint"===contours.type,operation=contours._operation,coloring=isConstraint?"="===operation?"lines":"fill":contours.coloring,perimeter=[[a[0],b[b.length-1]],[a[a.length-1],b[b.length-1]],[a[a.length-1],b[0]],[a[0],b[0]]];makeCrossings(pathinfo);var atol=1e-8*(a[a.length-1]-a[0]),btol=1e-8*(b[b.length-1]-b[0]);findAllPaths(pathinfo,atol,btol);var seg,xp,yp,i,fillPathinfo=pathinfo;"constraint"===contours.type&&(fillPathinfo=convertToConstraints(pathinfo,operation),closeBoundaries(fillPathinfo,operation,perimeter,trace)),mapPathinfo(pathinfo,ab2p);var segs=[];for(i=carpetcd.clipsegments.length-1;i>=0;i--)seg=carpetcd.clipsegments[i],xp=map1dArray([],seg.x,xa.c2p),yp=map1dArray([],seg.y,ya.c2p),xp.reverse(),yp.reverse(),segs.push(makepath(xp,yp,seg.bicubic));var boundaryPath="M"+segs.join("L")+"Z";!function makeBackground(plotgroup,clipsegments,xaxis,yaxis,isConstraint,coloring){var seg,xp,yp,i,bgfill=Lib.ensureSingle(plotgroup,"g","contourbg").selectAll("path").data("fill"!==coloring||isConstraint?[]:[0]);bgfill.enter().append("path"),bgfill.exit().remove();var segs=[];for(i=0;i<clipsegments.length;i++)seg=clipsegments[i],xp=map1dArray([],seg.x,xaxis.c2p),yp=map1dArray([],seg.y,yaxis.c2p),segs.push(makepath(xp,yp,seg.bicubic));bgfill.attr("d","M"+segs.join("L")+"Z").style("stroke","none")}(plotGroup,carpetcd.clipsegments,xa,ya,isConstraint,coloring),function makeFills(trace,plotgroup,xa,ya,pathinfo,perimeter,ab2p,carpet,carpetcd,coloring,boundaryPath){var fillitems=Lib.ensureSingle(plotgroup,"g","contourfill").selectAll("path").data("fill"===coloring?pathinfo:[]);fillitems.enter().append("path"),fillitems.exit().remove(),fillitems.each(function(pi){var fullpath=joinAllPaths(trace,pi,perimeter,ab2p,carpet,carpetcd,xa,ya);pi.prefixBoundary&&(fullpath=boundaryPath+fullpath),fullpath?d3.select(this).attr("d",fullpath).style("stroke","none"):d3.select(this).remove()})}(trace,plotGroup,xa,ya,fillPathinfo,perimeter,ab2p,carpet,carpetcd,coloring,boundaryPath),function makeLinesAndLabels(plotgroup,pathinfo,gd,cd0,contours,plotinfo,carpet){var lineContainer=Lib.ensureSingle(plotgroup,"g","contourlines"),showLines=!1!==contours.showlines,showLabels=contours.showlabels,clipLinesForLabels=showLines&&showLabels,linegroup=contourPlot.createLines(lineContainer,showLines||showLabels,pathinfo),lineClip=contourPlot.createLineClip(lineContainer,clipLinesForLabels,gd._fullLayout._defs,cd0.trace.uid),labelGroup=plotgroup.selectAll("g.contourlabels").data(showLabels?[0]:[]);if(labelGroup.exit().remove(),labelGroup.enter().append("g").classed("contourlabels",!0),showLabels){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,xLen=xa._length,yLen=ya._length,labelClipPathData=[[[0,0],[xLen,0],[xLen,yLen],[0,yLen]]],labelData=[];Lib.clearLocationCache();var contourFormat=contourPlot.labelFormatter(contours,cd0.t.cb,gd._fullLayout),dummyText=Drawing.tester.append("text").attr("data-notex",1).call(Drawing.font,contours.labelfont),bounds={left:0,right:xLen,center:xLen/2,top:0,bottom:yLen,middle:yLen/2},plotDiagonal=Math.sqrt(xLen*xLen+yLen*yLen),normLength=constants.LABELDISTANCE*plotDiagonal/Math.max(1,pathinfo.length/constants.LABELINCREASE);linegroup.each(function(d){var textOpts=contourPlot.calcTextOpts(d.level,contourFormat,dummyText,gd);d3.select(this).selectAll("path").each(function(pathData){var pathBounds=Lib.getVisibleSegment(this,bounds,textOpts.height/2);if(pathBounds&&(function constrainToCarpet(path,pathData,levelData,pathBounds,carpet,textHeight){for(var pathABData,i=0;i<levelData.pedgepaths.length;i++)pathData===levelData.pedgepaths[i]&&(pathABData=levelData.edgepaths[i]);if(!pathABData)return;var aMin=carpet.a[0],aMax=carpet.a[carpet.a.length-1],bMin=carpet.b[0],bMax=carpet.b[carpet.b.length-1];function getOffset(abPt,pathVector){var edgeVector,offset=0;return(Math.abs(abPt[0]-aMin)<.1||Math.abs(abPt[0]-aMax)<.1)&&(edgeVector=normalizeVector(carpet.dxydb_rough(abPt[0],abPt[1],.1)),offset=Math.max(offset,textHeight*vectorTan(pathVector,edgeVector)/2)),(Math.abs(abPt[1]-bMin)<.1||Math.abs(abPt[1]-bMax)<.1)&&(edgeVector=normalizeVector(carpet.dxyda_rough(abPt[0],abPt[1],.1)),offset=Math.max(offset,textHeight*vectorTan(pathVector,edgeVector)/2)),offset}var startVector=getUnitVector(path,0,1),endVector=getUnitVector(path,pathBounds.total,pathBounds.total-1),minStart=getOffset(pathABData[0],startVector),maxEnd=pathBounds.total-getOffset(pathABData[pathABData.length-1],endVector);pathBounds.min<minStart&&(pathBounds.min=minStart);pathBounds.max>maxEnd&&(pathBounds.max=maxEnd);pathBounds.len=pathBounds.max-pathBounds.min}(this,pathData,d,pathBounds,carpet,textOpts.height),!(pathBounds.len<(textOpts.width+textOpts.height)*constants.LABELMIN)))for(var maxLabels=Math.min(Math.ceil(pathBounds.len/normLength),constants.LABELMAX),i=0;i<maxLabels;i++){var loc=contourPlot.findBestTextLocation(this,pathBounds,textOpts,labelData,bounds);if(!loc)break;contourPlot.addLabelData(loc,textOpts,labelData,labelClipPathData)}})}),dummyText.remove(),contourPlot.drawLabels(labelGroup,labelData,gd,lineClip,clipLinesForLabels?labelClipPathData:null)}showLabels&&!showLines&&linegroup.remove()}(plotGroup,pathinfo,gd,cd0,contours,plotinfo,carpet),Drawing.setClipUrl(plotGroup,carpet._clipPathId)}function ab2p(ab){var pt=carpet.ab2xy(ab[0],ab[1],!0);return[xa.c2p(pt[0]),ya.c2p(pt[1])]}})}},{"../../components/drawing":592,"../../lib":693,"../carpet/lookup_carpetid":891,"../carpet/makepath":892,"../carpet/map_1d_array":893,"../contour/close_boundaries":915,"../contour/constants":917,"../contour/convert_to_constraints":921,"../contour/empty_pathinfo":923,"../contour/find_all_paths":925,"../contour/make_crossings":930,"../contour/plot":931,"./join_all_paths":939,"./map_pathinfo":940,d3:147}],942:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=extendFlat({z:{valType:"data_array",editType:"calc"},x:extendFlat({},scatterAttrs.x,{impliedEdits:{xtype:"array"}}),x0:extendFlat({},scatterAttrs.x0,{impliedEdits:{xtype:"scaled"}}),dx:extendFlat({},scatterAttrs.dx,{impliedEdits:{xtype:"scaled"}}),y:extendFlat({},scatterAttrs.y,{impliedEdits:{ytype:"array"}}),y0:extendFlat({},scatterAttrs.y0,{impliedEdits:{ytype:"scaled"}}),dy:extendFlat({},scatterAttrs.dy,{impliedEdits:{ytype:"scaled"}}),text:{valType:"data_array",editType:"calc"},transpose:{valType:"boolean",dflt:!1,editType:"calc"},xtype:{valType:"enumerated",values:["array","scaled"],editType:"calc+clearAxisTypes"},ytype:{valType:"enumerated",values:["array","scaled"],editType:"calc+clearAxisTypes"},zsmooth:{valType:"enumerated",values:["fast","best",!1],dflt:!1,editType:"calc"},connectgaps:{valType:"boolean",dflt:!1,editType:"calc"},xgap:{valType:"number",dflt:0,min:0,editType:"plot"},ygap:{valType:"number",dflt:0,min:0,editType:"plot"},zhoverformat:{valType:"string",dflt:"",editType:"none"}},colorscaleAttrs("",{cLetter:"z",autoColorDflt:!1}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../scatter/attributes":1032}],943:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),histogram2dCalc=_dereq_("../histogram2d/calc"),colorscaleCalc=_dereq_("../../components/colorscale/calc"),convertColumnData=_dereq_("./convert_column_xyz"),maxRowLength=_dereq_("./max_row_length"),clean2dArray=_dereq_("./clean_2d_array"),interp2d=_dereq_("./interp2d"),findEmpties=_dereq_("./find_empties"),makeBoundArray=_dereq_("./make_bound_array");module.exports=function calc(gd,trace){var x,x0,dx,y,y0,dy,z,i,binned,xa=Axes.getFromId(gd,trace.xaxis||"x"),ya=Axes.getFromId(gd,trace.yaxis||"y"),isContour=Registry.traceIs(trace,"contour"),isHist=Registry.traceIs(trace,"histogram"),isGL2D=Registry.traceIs(trace,"gl2d"),zsmooth=isContour?"best":trace.zsmooth;if(xa._minDtick=0,ya._minDtick=0,isHist)x=(binned=histogram2dCalc(gd,trace)).x,x0=binned.x0,dx=binned.dx,y=binned.y,y0=binned.y0,dy=binned.dy,z=binned.z;else{var zIn=trace.z;Lib.isArray1D(zIn)?(convertColumnData(trace,xa,ya,"x","y",["z"]),x=trace._x,y=trace._y,zIn=trace._z):(x=trace.x?xa.makeCalcdata(trace,"x"):[],y=trace.y?ya.makeCalcdata(trace,"y"):[]),x0=trace.x0||0,dx=trace.dx||1,y0=trace.y0||0,dy=trace.dy||1,z=clean2dArray(zIn,trace.transpose),(isContour||trace.connectgaps)&&(trace._emptypoints=findEmpties(z),interp2d(z,trace._emptypoints))}function noZsmooth(msg){zsmooth=trace._input.zsmooth=trace.zsmooth=!1,Lib.warn('cannot use zsmooth: "fast": '+msg)}if("fast"===zsmooth)if("log"===xa.type||"log"===ya.type)noZsmooth("log axis found");else if(!isHist){if(x.length){var avgdx=(x[x.length-1]-x[0])/(x.length-1),maxErrX=Math.abs(avgdx/100);for(i=0;i<x.length-1;i++)if(Math.abs(x[i+1]-x[i]-avgdx)>maxErrX){noZsmooth("x scale is not linear");break}}if(y.length&&"fast"===zsmooth){var avgdy=(y[y.length-1]-y[0])/(y.length-1),maxErrY=Math.abs(avgdy/100);for(i=0;i<y.length-1;i++)if(Math.abs(y[i+1]-y[i]-avgdy)>maxErrY){noZsmooth("y scale is not linear");break}}}var xlen=maxRowLength(z),xIn="scaled"===trace.xtype?"":x,xArray=makeBoundArray(trace,xIn,x0,dx,xlen,xa),yIn="scaled"===trace.ytype?"":y,yArray=makeBoundArray(trace,yIn,y0,dy,z.length,ya);isGL2D||(trace._extremes[xa._id]=Axes.findExtremes(xa,xArray),trace._extremes[ya._id]=Axes.findExtremes(ya,yArray));var cd0={x:xArray,y:yArray,z:z,text:trace._text||trace.text};if(xIn&&xIn.length===xArray.length-1&&(cd0.xCenter=xIn),yIn&&yIn.length===yArray.length-1&&(cd0.yCenter=yIn),isHist&&(cd0.xRanges=binned.xRanges,cd0.yRanges=binned.yRanges,cd0.pts=binned.pts),isContour&&"constraint"===trace.contours.type||colorscaleCalc(trace,z,"","z"),isContour&&trace.contours&&"heatmap"===trace.contours.coloring){var dummyTrace={type:"contour"===trace.type?"heatmap":"histogram2d",xcalendar:trace.xcalendar,ycalendar:trace.ycalendar};cd0.xfill=makeBoundArray(dummyTrace,xIn,x0,dx,xlen,xa),cd0.yfill=makeBoundArray(dummyTrace,yIn,y0,dy,z.length,ya)}return[cd0]}},{"../../components/colorscale/calc":575,"../../lib":693,"../../plots/cartesian/axes":742,"../../registry":825,"../histogram2d/calc":974,"./clean_2d_array":944,"./convert_column_xyz":946,"./find_empties":948,"./interp2d":951,"./make_bound_array":952,"./max_row_length":953}],944:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric");module.exports=function clean2dArray(zOld,transpose){var rowlen,collen,getCollen,old2new,i,j;function cleanZvalue(v){if(isNumeric(v))return+v}if(transpose){for(rowlen=0,i=0;i<zOld.length;i++)rowlen=Math.max(rowlen,zOld[i].length);if(0===rowlen)return!1;getCollen=function(zOld){return zOld.length},old2new=function(zOld,i,j){return zOld[j][i]}}else rowlen=zOld.length,getCollen=function(zOld,i){return zOld[i].length},old2new=function(zOld,i,j){return zOld[i][j]};var zNew=new Array(rowlen);for(i=0;i<rowlen;i++)for(collen=getCollen(zOld,i),zNew[i]=new Array(collen),j=0;j<collen;j++)zNew[i][j]=cleanZvalue(old2new(zOld,i,j));return zNew}},{"fast-isnumeric":213}],945:[function(_dereq_,module,exports){"use strict";module.exports={min:"zmin",max:"zmax"}},{}],946:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function convertColumnData(trace,ax1,ax2,var1Name,var2Name,arrayVarNames){var i,j,arrayVar,colLen=trace._length,col1=trace[var1Name].slice(0,colLen),col2=trace[var2Name].slice(0,colLen),textCol=trace.text,hasColumnText=void 0!==textCol&&Lib.isArray1D(textCol),col1Calendar=trace[var1Name+"calendar"],col2Calendar=trace[var2Name+"calendar"];for(i=0;i<colLen;i++)col1[i]=ax1.d2c(col1[i],0,col1Calendar),col2[i]=ax2.d2c(col2[i],0,col2Calendar);var i1,i2,text,col1dv=Lib.distinctVals(col1),col1vals=col1dv.vals,col2dv=Lib.distinctVals(col2),col2vals=col2dv.vals,newArrays=[];for(i=0;i<arrayVarNames.length;i++)newArrays[i]=Lib.init2dArray(col2vals.length,col1vals.length);for(hasColumnText&&(text=Lib.init2dArray(col2vals.length,col1vals.length)),i=0;i<colLen;i++)if(col1[i]!==BADNUM&&col2[i]!==BADNUM){for(i1=Lib.findBin(col1[i]+col1dv.minDiff/2,col1vals),i2=Lib.findBin(col2[i]+col2dv.minDiff/2,col2vals),j=0;j<arrayVarNames.length;j++)arrayVar=trace[arrayVarNames[j]],newArrays[j][i2][i1]=arrayVar[i];hasColumnText&&(text[i2][i1]=textCol[i])}for(trace["_"+var1Name]=col1vals,trace["_"+var2Name]=col2vals,j=0;j<arrayVarNames.length;j++)trace["_"+arrayVarNames[j]]=newArrays[j];hasColumnText&&(trace._text=text)}},{"../../constants/numerical":670,"../../lib":693}],947:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleXYZDefaults=_dereq_("./xyz_defaults"),handleStyleDefaults=_dereq_("./style_defaults"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleXYZDefaults(traceIn,traceOut,coerce,layout)?(coerce("text"),handleStyleDefaults(traceIn,traceOut,coerce,layout),coerce("connectgaps",Lib.isArray1D(traceOut.z)&&!1!==traceOut.zsmooth),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"z"})):traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"./attributes":942,"./style_defaults":956,"./xyz_defaults":957}],948:[function(_dereq_,module,exports){"use strict";var maxRowLength=_dereq_("./max_row_length");module.exports=function findEmpties(z){var prevRow,i,j,thisPt,p,neighborCount,newNeighborHash,foundNewNeighbors,empties=[],neighborHash={},noNeighborList=[],nextRow=z[0],row=[],blank=[0,0,0],rowLength=maxRowLength(z);for(i=0;i<z.length;i++)for(prevRow=row,row=nextRow,nextRow=z[i+1]||[],j=0;j<rowLength;j++)void 0===row[j]&&((neighborCount=(void 0!==row[j-1]?1:0)+(void 0!==row[j+1]?1:0)+(void 0!==prevRow[j]?1:0)+(void 0!==nextRow[j]?1:0))?(0===i&&neighborCount++,0===j&&neighborCount++,i===z.length-1&&neighborCount++,j===row.length-1&&neighborCount++,neighborCount<4&&(neighborHash[[i,j]]=[i,j,neighborCount]),empties.push([i,j,neighborCount])):noNeighborList.push([i,j]));for(;noNeighborList.length;){for(newNeighborHash={},foundNewNeighbors=!1,p=noNeighborList.length-1;p>=0;p--)(neighborCount=((neighborHash[[(i=(thisPt=noNeighborList[p])[0])-1,j=thisPt[1]]]||blank)[2]+(neighborHash[[i+1,j]]||blank)[2]+(neighborHash[[i,j-1]]||blank)[2]+(neighborHash[[i,j+1]]||blank)[2])/20)&&(newNeighborHash[thisPt]=[i,j,neighborCount],noNeighborList.splice(p,1),foundNewNeighbors=!0);if(!foundNewNeighbors)throw"findEmpties iterated with no new neighbors";for(thisPt in newNeighborHash)neighborHash[thisPt]=newNeighborHash[thisPt],empties.push(newNeighborHash[thisPt])}return empties.sort(function(a,b){return b[2]-a[2]})}},{"./max_row_length":953}],949:[function(_dereq_,module,exports){"use strict";var Fx=_dereq_("../../components/fx"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes");module.exports=function hoverPoints(pointData,xval,yval,hovermode,hoverLayer,contour){var xl,yl,nx,ny,cd0=pointData.cd[0],trace=cd0.trace,xa=pointData.xa,ya=pointData.ya,x=cd0.x,y=cd0.y,z=cd0.z,xc=cd0.xCenter,yc=cd0.yCenter,zmask=cd0.zmask,range=[trace.zmin,trace.zmax],zhoverformat=trace.zhoverformat,x2=x,y2=y;if(!1!==pointData.index){try{nx=Math.round(pointData.index[1]),ny=Math.round(pointData.index[0])}catch(e){return void Lib.error("Error hovering on heatmap, pointNumber must be [row,col], found:",pointData.index)}if(nx<0||nx>=z[0].length||ny<0||ny>z.length)return}else{if(Fx.inbox(xval-x[0],xval-x[x.length-1],0)>0||Fx.inbox(yval-y[0],yval-y[y.length-1],0)>0)return;if(contour){var i2;for(x2=[2*x[0]-x[1]],i2=1;i2<x.length;i2++)x2.push((x[i2]+x[i2-1])/2);for(x2.push([2*x[x.length-1]-x[x.length-2]]),y2=[2*y[0]-y[1]],i2=1;i2<y.length;i2++)y2.push((y[i2]+y[i2-1])/2);y2.push([2*y[y.length-1]-y[y.length-2]])}nx=Math.max(0,Math.min(x2.length-2,Lib.findBin(xval,x2))),ny=Math.max(0,Math.min(y2.length-2,Lib.findBin(yval,y2)))}var x0=xa.c2p(x[nx]),x1=xa.c2p(x[nx+1]),y0=ya.c2p(y[ny]),y1=ya.c2p(y[ny+1]);contour?(x1=x0,xl=x[nx],y1=y0,yl=y[ny]):(xl=xc?xc[nx]:(x[nx]+x[nx+1])/2,yl=yc?yc[ny]:(y[ny]+y[ny+1])/2,trace.zsmooth&&(x0=x1=xa.c2p(xl),y0=y1=ya.c2p(yl)));var text,zLabel,zVal=z[ny][nx];zmask&&!zmask[ny][nx]&&(zVal=void 0),Array.isArray(cd0.text)&&Array.isArray(cd0.text[ny])&&(text=cd0.text[ny][nx]);var dummyAx={type:"linear",range:range,hoverformat:zhoverformat,_separators:xa._separators,_numFormat:xa._numFormat};return zLabel=Axes.tickText(dummyAx,zVal,"hover").text,[Lib.extendFlat(pointData,{index:[ny,nx],distance:pointData.maxHoverDistance,spikeDistance:pointData.maxSpikeDistance,x0:x0,x1:x1,y0:y0,y1:y1,xLabelVal:xl,yLabelVal:yl,zLabelVal:zVal,zLabel:zLabel,text:text})]}},{"../../components/fx":609,"../../lib":693,"../../plots/cartesian/axes":742}],950:[function(_dereq_,module,exports){"use strict";var Heatmap={};Heatmap.attributes=_dereq_("./attributes"),Heatmap.supplyDefaults=_dereq_("./defaults"),Heatmap.calc=_dereq_("./calc"),Heatmap.plot=_dereq_("./plot"),Heatmap.colorbar=_dereq_("./colorbar"),Heatmap.style=_dereq_("./style"),Heatmap.hoverPoints=_dereq_("./hover"),Heatmap.moduleType="trace",Heatmap.name="heatmap",Heatmap.basePlotModule=_dereq_("../../plots/cartesian"),Heatmap.categories=["cartesian","svg","2dMap"],Heatmap.meta={},module.exports=Heatmap},{"../../plots/cartesian":753,"./attributes":942,"./calc":943,"./colorbar":945,"./defaults":947,"./hover":949,"./plot":954,"./style":955}],951:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),NEIGHBORSHIFTS=[[-1,0],[1,0],[0,-1],[0,1]];function correctionOvershoot(maxFractionalChange){return.5-.25*Math.min(1,.5*maxFractionalChange)}function iterateInterp2d(z,emptyPoints,overshoot){var thisPt,i,j,p,q,neighborShift,neighborRow,neighborVal,neighborCount,neighborSum,initialVal,minNeighbor,maxNeighbor,maxFractionalChange=0;for(p=0;p<emptyPoints.length;p++){for(i=(thisPt=emptyPoints[p])[0],j=thisPt[1],initialVal=z[i][j],neighborSum=0,neighborCount=0,q=0;q<4;q++)(neighborRow=z[i+(neighborShift=NEIGHBORSHIFTS[q])[0]])&&void 0!==(neighborVal=neighborRow[j+neighborShift[1]])&&(0===neighborSum?minNeighbor=maxNeighbor=neighborVal:(minNeighbor=Math.min(minNeighbor,neighborVal),maxNeighbor=Math.max(maxNeighbor,neighborVal)),neighborCount++,neighborSum+=neighborVal);if(0===neighborCount)throw"iterateInterp2d order is wrong: no defined neighbors";z[i][j]=neighborSum/neighborCount,void 0===initialVal?neighborCount<4&&(maxFractionalChange=1):(z[i][j]=(1+overshoot)*z[i][j]-overshoot*initialVal,maxNeighbor>minNeighbor&&(maxFractionalChange=Math.max(maxFractionalChange,Math.abs(z[i][j]-initialVal)/(maxNeighbor-minNeighbor))))}return maxFractionalChange}module.exports=function interp2d(z,emptyPoints){var i,maxFractionalChange=1;for(iterateInterp2d(z,emptyPoints),i=0;i<emptyPoints.length&&!(emptyPoints[i][2]<4);i++);for(emptyPoints=emptyPoints.slice(i),i=0;i<100&&maxFractionalChange>.01;i++)maxFractionalChange=iterateInterp2d(z,emptyPoints,correctionOvershoot(maxFractionalChange));return maxFractionalChange>.01&&Lib.log("interp2d didn't converge quickly",maxFractionalChange),z}},{"../../lib":693}],952:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function makeBoundArray(trace,arrayIn,v0In,dvIn,numbricks,ax){var v0,dv,i,arrayOut=[],isContour=Registry.traceIs(trace,"contour"),isHist=Registry.traceIs(trace,"histogram"),isGL2D=Registry.traceIs(trace,"gl2d");if(isArrayOrTypedArray(arrayIn)&&arrayIn.length>1&&!isHist&&"category"!==ax.type){var len=arrayIn.length;if(!(len<=numbricks))return isContour?arrayIn.slice(0,numbricks):arrayIn.slice(0,numbricks+1);if(isContour||isGL2D)arrayOut=arrayIn.slice(0,numbricks);else if(1===numbricks)arrayOut=[arrayIn[0]-.5,arrayIn[0]+.5];else{for(arrayOut=[1.5*arrayIn[0]-.5*arrayIn[1]],i=1;i<len;i++)arrayOut.push(.5*(arrayIn[i-1]+arrayIn[i]));arrayOut.push(1.5*arrayIn[len-1]-.5*arrayIn[len-2])}if(len<numbricks){var lastPt=arrayOut[arrayOut.length-1],delta=lastPt-arrayOut[arrayOut.length-2];for(i=len;i<numbricks;i++)lastPt+=delta,arrayOut.push(lastPt)}}else{dv=dvIn||1;var calendar=trace[ax._id.charAt(0)+"calendar"];for(v0=isHist||"category"===ax.type?ax.r2c(v0In,0,calendar)||0:isArrayOrTypedArray(arrayIn)&&1===arrayIn.length?arrayIn[0]:void 0===v0In?0:ax.d2c(v0In,0,calendar),i=isContour||isGL2D?0:-.5;i<numbricks;i++)arrayOut.push(v0+dv*i)}return arrayOut}},{"../../lib":693,"../../registry":825}],953:[function(_dereq_,module,exports){"use strict";module.exports=function maxRowLength(z){for(var len=0,i=0;i<z.length;i++)len=Math.max(len,z[i].length);return len}},{}],954:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Colorscale=_dereq_("../../components/colorscale"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces"),maxRowLength=_dereq_("./max_row_length");function findInterp(pixel,pixArray){var maxBin=pixArray.length-2,bin=Lib.constrain(Lib.findBin(pixel,pixArray),0,maxBin),pix0=pixArray[bin],pix1=pixArray[bin+1],interp=Lib.constrain(bin+(pixel-pix0)/(pix1-pix0)-.5,0,maxBin),bin0=Math.round(interp),frac=Math.abs(interp-bin0);return interp&&interp!==maxBin&&frac?{bin0:bin0,frac:frac,bin1:Math.round(bin0+frac/(interp-bin0))}:{bin0:bin0,bin1:bin0,frac:0}}function findInterpFromCenters(pixel,centerPixArray){var maxBin=centerPixArray.length-1,bin=Lib.constrain(Lib.findBin(pixel,centerPixArray),0,maxBin),pix0=centerPixArray[bin],frac=(pixel-pix0)/(centerPixArray[bin+1]-pix0)||0;return frac<=0?{bin0:bin,bin1:bin,frac:0}:frac<.5?{bin0:bin,bin1:bin+1,frac:frac}:{bin0:bin+1,bin1:bin,frac:1-frac}}function putColor(pixels,pxIndex,c){pixels[pxIndex]=c[0],pixels[pxIndex+1]=c[1],pixels[pxIndex+2]=c[2],pixels[pxIndex+3]=Math.round(255*c[3])}module.exports=function(gd,plotinfo,cdheatmaps,heatmapLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis;Lib.makeTraceGroups(heatmapLayer,cdheatmaps,"hm").each(function(cd){var left,right,temp,top,bottom,i,plotGroup=d3.select(this),cd0=cd[0],trace=cd0.trace,z=cd0.z,x=cd0.x,y=cd0.y,xc=cd0.xCenter,yc=cd0.yCenter,isContour=Registry.traceIs(trace,"contour"),zsmooth=isContour?"best":trace.zsmooth,m=z.length,n=maxRowLength(z),xrev=!1,yrev=!1;for(i=0;void 0===left&&i<x.length-1;)left=xa.c2p(x[i]),i++;for(i=x.length-1;void 0===right&&i>0;)right=xa.c2p(x[i]),i--;for(right<left&&(temp=right,right=left,left=temp,xrev=!0),i=0;void 0===top&&i<y.length-1;)top=ya.c2p(y[i]),i++;for(i=y.length-1;void 0===bottom&&i>0;)bottom=ya.c2p(y[i]),i--;if(bottom<top&&(temp=top,top=bottom,bottom=temp,yrev=!0),isContour&&(xc=x,yc=y,x=cd0.xfill,y=cd0.yfill),"fast"!==zsmooth){var extra="best"===zsmooth?0:.5;left=Math.max(-extra*xa._length,left),right=Math.min((1+extra)*xa._length,right),top=Math.max(-extra*ya._length,top),bottom=Math.min((1+extra)*ya._length,bottom)}var imageWidth=Math.round(right-left),imageHeight=Math.round(bottom-top);if(imageWidth<=0||imageHeight<=0){plotGroup.selectAll("image").data([]).exit().remove()}else{var canvasW,canvasH;"fast"===zsmooth?(canvasW=n,canvasH=m):(canvasW=imageWidth,canvasH=imageHeight);var canvas=document.createElement("canvas");canvas.width=canvasW,canvas.height=canvasH;var xpx,ypx,context=canvas.getContext("2d"),sclFunc=Colorscale.makeColorScaleFunc(Colorscale.extractScale(trace.colorscale,trace.zmin,trace.zmax),{noNumericCheck:!0,returnArray:!0});"fast"===zsmooth?(xpx=xrev?function(index){return n-1-index}:Lib.identity,ypx=yrev?function(index){return m-1-index}:Lib.identity):(xpx=function(index){return Lib.constrain(Math.round(xa.c2p(x[index])-left),0,imageWidth)},ypx=function(index){return Lib.constrain(Math.round(ya.c2p(y[index])-top),0,imageHeight)});var xb,j,xi,row,c,yi=ypx(0),yb=[yi,yi],xbi=xrev?0:1,ybi=yrev?0:1,pixcount=0,rcount=0,gcount=0,bcount=0;if(zsmooth){var pixels,pxIndex=0;try{pixels=new Uint8Array(imageWidth*imageHeight*4)}catch(e){pixels=new Array(imageWidth*imageHeight*4)}if("best"===zsmooth){var yinterp,r0,r1,xForPx=xc||x,yForPx=yc||y,xPixArray=new Array(xForPx.length),yPixArray=new Array(yForPx.length),xinterpArray=new Array(imageWidth),findInterpX=xc?findInterpFromCenters:findInterp,findInterpY=yc?findInterpFromCenters:findInterp;for(i=0;i<xForPx.length;i++)xPixArray[i]=Math.round(xa.c2p(xForPx[i])-left);for(i=0;i<yForPx.length;i++)yPixArray[i]=Math.round(ya.c2p(yForPx[i])-top);for(i=0;i<imageWidth;i++)xinterpArray[i]=findInterpX(i,xPixArray);for(j=0;j<imageHeight;j++)for(r0=z[(yinterp=findInterpY(j,yPixArray)).bin0],r1=z[yinterp.bin1],i=0;i<imageWidth;i++,pxIndex+=4)putColor(pixels,pxIndex,c=interpColor(r0,r1,xinterpArray[i],yinterp))}else for(j=0;j<m;j++)for(row=z[j],yb=ypx(j),i=0;i<imageWidth;i++)c=setColor(row[i],1),putColor(pixels,pxIndex=4*(yb*imageWidth+xpx(i)),c);var imageData=context.createImageData(imageWidth,imageHeight);try{imageData.data.set(pixels)}catch(e){var pxArray=imageData.data,dlen=pxArray.length;for(j=0;j<dlen;j++)pxArray[j]=pixels[j]}context.putImageData(imageData,0,0)}else{var xGap=trace.xgap,yGap=trace.ygap,xGapLeft=Math.floor(xGap/2),yGapTop=Math.floor(yGap/2);for(j=0;j<m;j++)if(row=z[j],yb.reverse(),yb[ybi]=ypx(j+1),yb[0]!==yb[1]&&void 0!==yb[0]&&void 0!==yb[1])for(xb=[xi=xpx(0),xi],i=0;i<n;i++)xb.reverse(),xb[xbi]=xpx(i+1),xb[0]!==xb[1]&&void 0!==xb[0]&&void 0!==xb[1]&&(c=setColor(row[i],(xb[1]-xb[0])*(yb[1]-yb[0])),context.fillStyle="rgba("+c.join(",")+")",context.fillRect(xb[0]+xGapLeft,yb[0]+yGapTop,xb[1]-xb[0]-xGap,yb[1]-yb[0]-yGap))}rcount=Math.round(rcount/pixcount),gcount=Math.round(gcount/pixcount),bcount=Math.round(bcount/pixcount);var avgColor=tinycolor("rgb("+rcount+","+gcount+","+bcount+")");gd._hmpixcount=(gd._hmpixcount||0)+pixcount,gd._hmlumcount=(gd._hmlumcount||0)+pixcount*avgColor.getLuminance();var image3=plotGroup.selectAll("image").data(cd);image3.enter().append("svg:image").attr({xmlns:xmlnsNamespaces.svg,preserveAspectRatio:"none"}),image3.attr({height:imageHeight,width:imageWidth,x:left,y:top,"xlink:href":canvas.toDataURL("image/png")})}function setColor(v,pixsize){if(void 0!==v){var c=sclFunc(v);return c[0]=Math.round(c[0]),c[1]=Math.round(c[1]),c[2]=Math.round(c[2]),pixcount+=pixsize,rcount+=c[0]*pixsize,gcount+=c[1]*pixsize,bcount+=c[2]*pixsize,c}return[0,0,0,0]}function interpColor(r0,r1,xinterp,yinterp){var z00=r0[xinterp.bin0];if(void 0===z00)return setColor(void 0,1);var dxy,z01=r0[xinterp.bin1],z10=r1[xinterp.bin0],z11=r1[xinterp.bin1],dx=z01-z00||0,dy=z10-z00||0;return dxy=void 0===z01?void 0===z11?0:void 0===z10?2*(z11-z00):2*(2*z11-z10-z00)/3:void 0===z11?void 0===z10?0:2*(2*z00-z01-z10)/3:void 0===z10?2*(2*z11-z01-z00)/3:z11+z00-z01-z10,setColor(z00+xinterp.frac*dx+yinterp.frac*(dy+xinterp.frac*dxy))}})}},{"../../components/colorscale":582,"../../constants/xmlns_namespaces":671,"../../lib":693,"../../registry":825,"./max_row_length":953,d3:147,tinycolor2:511}],955:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3");module.exports=function style(gd){d3.select(gd).selectAll(".hm image").style("opacity",function(d){return d.trace.opacity})}},{d3:147}],956:[function(_dereq_,module,exports){"use strict";module.exports=function handleStyleDefaults(traceIn,traceOut,coerce){!1===coerce("zsmooth")&&(coerce("xgap"),coerce("ygap")),coerce("zhoverformat")}},{}],957:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry");function coordDefaults(coordStr,coerce){var coord=coerce(coordStr);return"scaled"===(coord?coerce(coordStr+"type","array"):"scaled")&&(coerce(coordStr+"0"),coerce("d"+coordStr)),coord}module.exports=function handleXYZDefaults(traceIn,traceOut,coerce,layout,xName,yName){var x,y,z=coerce("z");if(xName=xName||"x",yName=yName||"y",void 0===z||!z.length)return 0;if(Lib.isArray1D(traceIn.z)){if(x=coerce(xName),y=coerce(yName),!(x&&x.length&&y&&y.length))return 0;traceOut._length=Math.min(x.length,y.length,z.length)}else{if(x=coordDefaults(xName,coerce),y=coordDefaults(yName,coerce),!function isValidZ(z){for(var zi,allRowsAreArrays=!0,oneRowIsFilled=!1,hasOneNumber=!1,i=0;i<z.length;i++){if(zi=z[i],!Lib.isArrayOrTypedArray(zi)){allRowsAreArrays=!1;break}zi.length>0&&(oneRowIsFilled=!0);for(var j=0;j<zi.length;j++)if(isNumeric(zi[j])){hasOneNumber=!0;break}}return allRowsAreArrays&&oneRowIsFilled&&hasOneNumber}(z))return 0;coerce("transpose"),traceOut._length=null}return Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,[xName,yName],layout),!0}},{"../../lib":693,"../../registry":825,"fast-isnumeric":213}],958:[function(_dereq_,module,exports){"use strict";for(var heatmapAttrs=_dereq_("../heatmap/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,commonList=["z","x","x0","dx","y","y0","dy","text","transpose","xtype","ytype"],attrs={},i=0;i<commonList.length;i++){var k=commonList[i];attrs[k]=heatmapAttrs[k]}extendFlat(attrs,colorscaleAttrs("",{cLetter:"z",autoColorDflt:!1}),{colorbar:colorbarAttrs}),module.exports=overrideAll(attrs,"calc","nested")},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plot_api/edit_types":725,"../heatmap/attributes":942}],959:[function(_dereq_,module,exports){"use strict";var createHeatmap2D=_dereq_("gl-heatmap2d"),Axes=_dereq_("../../plots/cartesian/axes"),str2RGBArray=_dereq_("../../lib/str2rgbarray");function Heatmap(scene,uid){this.scene=scene,this.uid=uid,this.type="heatmapgl",this.name="",this.hoverinfo="all",this.xData=[],this.yData=[],this.zData=[],this.textLabels=[],this.idToIndex=[],this.bounds=[0,0,0,0],this.options={z:[],x:[],y:[],shape:[0,0],colorLevels:[0],colorValues:[0,0,0,1]},this.heatmap=createHeatmap2D(scene.glplot,this.options),this.heatmap._trace=this}var proto=Heatmap.prototype;proto.handlePick=function(pickResult){var options=this.options,shape=options.shape,index=pickResult.pointId,xIndex=index%shape[0],yIndex=Math.floor(index/shape[0]),zIndex=index;return{trace:this,dataCoord:pickResult.dataCoord,traceCoord:[options.x[xIndex],options.y[yIndex],options.z[zIndex]],textLabel:this.textLabels[index],name:this.name,pointIndex:[yIndex,xIndex],hoverinfo:this.hoverinfo}},proto.update=function(fullTrace,calcTrace){var calcPt=calcTrace[0];this.index=fullTrace.index,this.name=fullTrace.name,this.hoverinfo=fullTrace.hoverinfo;var z=calcPt.z;this.options.z=[].concat.apply([],z);var rowLen=z[0].length,colLen=z.length;this.options.shape=[rowLen,colLen],this.options.x=calcPt.x,this.options.y=calcPt.y;var colorOptions=function convertColorscale(fullTrace){for(var scl=fullTrace.colorscale,zmin=fullTrace.zmin,zmax=fullTrace.zmax,N=scl.length,domain=new Array(N),range=new Array(4*N),i=0;i<N;i++){var si=scl[i],color=str2RGBArray(si[1]);domain[i]=zmin+si[0]*(zmax-zmin);for(var j=0;j<4;j++)range[4*i+j]=color[j]}return{colorLevels:domain,colorValues:range}}(fullTrace);this.options.colorLevels=colorOptions.colorLevels,this.options.colorValues=colorOptions.colorValues,this.textLabels=[].concat.apply([],fullTrace.text),this.heatmap.update(this.options);var xa=this.scene.xaxis,ya=this.scene.yaxis;fullTrace._extremes[xa._id]=Axes.findExtremes(xa,calcPt.x),fullTrace._extremes[ya._id]=Axes.findExtremes(ya,calcPt.y)},proto.dispose=function(){this.heatmap.dispose()},module.exports=function createHeatmap(scene,fullTrace,calcTrace){var plot=new Heatmap(scene,fullTrace.uid);return plot.update(fullTrace,calcTrace),plot}},{"../../lib/str2rgbarray":717,"../../plots/cartesian/axes":742,"gl-heatmap2d":240}],960:[function(_dereq_,module,exports){"use strict";var HeatmapGl={};HeatmapGl.attributes=_dereq_("./attributes"),HeatmapGl.supplyDefaults=_dereq_("../heatmap/defaults"),HeatmapGl.colorbar=_dereq_("../heatmap/colorbar"),HeatmapGl.calc=_dereq_("../heatmap/calc"),HeatmapGl.plot=_dereq_("./convert"),HeatmapGl.moduleType="trace",HeatmapGl.name="heatmapgl",HeatmapGl.basePlotModule=_dereq_("../../plots/gl2d"),HeatmapGl.categories=["gl","gl2d","2dMap"],HeatmapGl.meta={},module.exports=HeatmapGl},{"../../plots/gl2d":781,"../heatmap/calc":943,"../heatmap/colorbar":945,"../heatmap/defaults":947,"./attributes":958,"./convert":959}],961:[function(_dereq_,module,exports){"use strict";var barAttrs=_dereq_("../bar/attributes");function makeBinsAttr(axLetter){var impliedEdits={};impliedEdits["autobin"+axLetter]=!1;var impliedEditsInner={};return impliedEditsInner["^autobin"+axLetter]=!1,{start:{valType:"any",dflt:null,editType:"calc",impliedEdits:impliedEditsInner},end:{valType:"any",dflt:null,editType:"calc",impliedEdits:impliedEditsInner},size:{valType:"any",dflt:null,editType:"calc",impliedEdits:impliedEditsInner},editType:"calc",impliedEdits:impliedEdits}}module.exports={x:{valType:"data_array",editType:"calc+clearAxisTypes"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},text:barAttrs.text,orientation:barAttrs.orientation,histfunc:{valType:"enumerated",values:["count","sum","avg","min","max"],dflt:"count",editType:"calc"},histnorm:{valType:"enumerated",values:["","percent","probability","density","probability density"],dflt:"",editType:"calc"},cumulative:{enabled:{valType:"boolean",dflt:!1,editType:"calc"},direction:{valType:"enumerated",values:["increasing","decreasing"],dflt:"increasing",editType:"calc"},currentbin:{valType:"enumerated",values:["include","exclude","half"],dflt:"include",editType:"calc"},editType:"calc"},autobinx:{valType:"boolean",dflt:null,editType:"calc",impliedEdits:{"xbins.start":void 0,"xbins.end":void 0,"xbins.size":void 0}},nbinsx:{valType:"integer",min:0,dflt:0,editType:"calc"},xbins:makeBinsAttr("x"),autobiny:{valType:"boolean",dflt:null,editType:"calc",impliedEdits:{"ybins.start":void 0,"ybins.end":void 0,"ybins.size":void 0}},nbinsy:{valType:"integer",min:0,dflt:0,editType:"calc"},ybins:makeBinsAttr("y"),marker:barAttrs.marker,selected:barAttrs.selected,unselected:barAttrs.unselected,_deprecated:{bardir:barAttrs._deprecated.bardir}}},{"../bar/attributes":835}],962:[function(_dereq_,module,exports){"use strict";module.exports=function doAvg(size,counts){for(var nMax=size.length,total=0,i=0;i<nMax;i++)counts[i]?(size[i]/=counts[i],total+=size[i]):size[i]=null;return total}},{}],963:[function(_dereq_,module,exports){"use strict";module.exports=function handleBinDefaults(traceIn,traceOut,coerce,binDirections){return coerce("histnorm"),binDirections.forEach(function(binDirection){coerce(binDirection+"bins.start"),coerce(binDirection+"bins.end"),coerce(binDirection+"bins.size"),!1!==coerce("autobin"+binDirection)&&coerce("nbins"+binDirection)}),traceOut}},{}],964:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric");module.exports={count:function(n,i,size){return size[n]++,1},sum:function(n,i,size,counterData){var v=counterData[i];return isNumeric(v)?(v=Number(v),size[n]+=v,v):0},avg:function(n,i,size,counterData,counts){var v=counterData[i];return isNumeric(v)&&(v=Number(v),size[n]+=v,counts[n]++),0},min:function(n,i,size,counterData){var v=counterData[i];if(isNumeric(v)){if(v=Number(v),!isNumeric(size[n]))return size[n]=v,v;if(size[n]>v){var delta=v-size[n];return size[n]=v,delta}}return 0},max:function(n,i,size,counterData){var v=counterData[i];if(isNumeric(v)){if(v=Number(v),!isNumeric(size[n]))return size[n]=v,v;if(size[n]<v){var delta=v-size[n];return size[n]=v,delta}}return 0}}},{"fast-isnumeric":213}],965:[function(_dereq_,module,exports){"use strict";var numConstants=_dereq_("../../constants/numerical"),oneYear=numConstants.ONEAVGYEAR,oneMonth=numConstants.ONEAVGMONTH,oneDay=numConstants.ONEDAY,oneHour=numConstants.ONEHOUR,oneMin=numConstants.ONEMIN,oneSec=numConstants.ONESEC,tickIncrement=_dereq_("../../plots/cartesian/axes").tickIncrement;function biggestDigitChanged(v1,v2,pa,calendar){if(v1*v2<=0)return 1/0;for(var dv=Math.abs(v2-v1),isDate="date"===pa.type,digit=biggestGuaranteedDigitChanged(dv,isDate),i=0;i<10;i++){var nextDigit=biggestGuaranteedDigitChanged(80*digit,isDate);if(digit===nextDigit)break;if(!didDigitChange(nextDigit,v1,v2,isDate,pa,calendar))break;digit=nextDigit}return digit}function biggestGuaranteedDigitChanged(dv,isDate){return isDate&&dv>oneSec?dv>oneDay?dv>1.1*oneYear?oneYear:dv>1.1*oneMonth?oneMonth:oneDay:dv>oneHour?oneHour:dv>oneMin?oneMin:oneSec:Math.pow(10,Math.floor(Math.log(dv)/Math.LN10))}function didDigitChange(digit,v1,v2,isDate,pa,calendar){if(isDate&&digit>oneDay){var dateParts1=dateParts(v1,pa,calendar),dateParts2=dateParts(v2,pa,calendar),parti=digit===oneYear?0:1;return dateParts1[parti]!==dateParts2[parti]}return Math.floor(v2/digit)-Math.floor(v1/digit)>.1}function dateParts(v,pa,calendar){var parts=pa.c2d(v,oneYear,calendar).split("-");return""===parts[0]&&(parts.unshift(),parts[0]="-"+parts[0]),parts}module.exports=function getBinSpanLabelRound(leftGap,rightGap,binEdges,pa,calendar){var digit,disambiguateEdges,dv0=-1.1*rightGap,dv1=-.1*rightGap,dv2=leftGap-dv1,edge0=binEdges[0],edge1=binEdges[1],leftDigit=Math.min(biggestDigitChanged(edge0+dv1,edge0+dv2,pa,calendar),biggestDigitChanged(edge1+dv1,edge1+dv2,pa,calendar)),rightDigit=Math.min(biggestDigitChanged(edge0+dv0,edge0+dv1,pa,calendar),biggestDigitChanged(edge1+dv0,edge1+dv1,pa,calendar));if(leftDigit>rightDigit&&rightDigit<Math.abs(edge1-edge0)/4e3?(digit=leftDigit,disambiguateEdges=!1):(digit=Math.min(leftDigit,rightDigit),disambiguateEdges=!0),"date"===pa.type&&digit>oneDay){var dashExclude=digit===oneYear?1:6,increment=digit===oneYear?"M12":"M1";return function(v,isRightEdge){var dateStr=pa.c2d(v,oneYear,calendar),dashPos=dateStr.indexOf("-",dashExclude);dashPos>0&&(dateStr=dateStr.substr(0,dashPos));var roundedV=pa.d2c(dateStr,0,calendar);if(roundedV<v){var nextV=tickIncrement(roundedV,increment,!1,calendar);(roundedV+nextV)/2<v+leftGap&&(roundedV=nextV)}return isRightEdge&&disambiguateEdges?tickIncrement(roundedV,increment,!0,calendar):roundedV}}return function(v,isRightEdge){var roundedV=digit*Math.round(v/digit);return roundedV+digit/10<v&&roundedV+.9*digit<v+leftGap&&(roundedV+=digit),isRightEdge&&disambiguateEdges&&(roundedV-=digit),roundedV}}},{"../../constants/numerical":670,"../../plots/cartesian/axes":742}],966:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),arraysToCalcdata=_dereq_("../bar/arrays_to_calcdata"),binFunctions=_dereq_("./bin_functions"),normFunctions=_dereq_("./norm_functions"),doAvg=_dereq_("./average"),cleanBins=_dereq_("./clean_bins"),oneMonth=_dereq_("../../constants/numerical").ONEAVGMONTH,getBinSpanLabelRound=_dereq_("./bin_label_vals");function calcAllAutoBins(gd,trace,pa,mainData,_overlayEdgeCase){var i,tracei,calendar,firstManual,pos0,binAttr=mainData+"bins",isOverlay="overlay"===gd._fullLayout.barmode;if(trace._autoBinFinished)delete trace._autoBinFinished;else{var traceGroup=isOverlay?[trace]:getConnectedHistograms(gd,trace),autoBinnedTraces=[],minSize=1/0,minStart=1/0,maxEnd=-1/0,autoBinAttr="autobin"+mainData;for(i=0;i<traceGroup.length;i++){pos0=(tracei=traceGroup[i])._pos0=pa.makeCalcdata(tracei,mainData);var binSpec=tracei[binAttr];if(tracei[autoBinAttr]||!binSpec||null===binSpec.start||null===binSpec.end){calendar=tracei[mainData+"calendar"];var cumulativeSpec=tracei.cumulative;if(binSpec=Axes.autoBin(pos0,pa,tracei["nbins"+mainData],!1,calendar),isOverlay&&0===binSpec._dataSpan&&"category"!==pa.type){if(_overlayEdgeCase)return[binSpec,pos0,!0];binSpec=handleSingleValueOverlays(gd,trace,pa,mainData,binAttr)}cumulativeSpec.enabled&&"include"!==cumulativeSpec.currentbin&&("decreasing"===cumulativeSpec.direction?minStart=Math.min(minStart,pa.r2c(binSpec.start,0,calendar)-binSpec.size):maxEnd=Math.max(maxEnd,pa.r2c(binSpec.end,0,calendar)+binSpec.size)),autoBinnedTraces.push(tracei)}else firstManual||(firstManual={size:binSpec.size,start:pa.r2c(binSpec.start,0,calendar),end:pa.r2c(binSpec.end,0,calendar)});minSize=getMinSize(minSize,binSpec.size),minStart=Math.min(minStart,pa.r2c(binSpec.start,0,calendar)),maxEnd=Math.max(maxEnd,pa.r2c(binSpec.end,0,calendar)),i&&(tracei._autoBinFinished=1)}if(firstManual&&isNumeric(firstManual.size)&&isNumeric(minSize)){minSize=minSize>firstManual.size/1.9?firstManual.size:firstManual.size/Math.ceil(firstManual.size/minSize);var adjustedFirstStart=firstManual.start+(firstManual.size-minSize)/2;minStart=adjustedFirstStart-minSize*Math.ceil((adjustedFirstStart-minStart)/minSize)}for(i=0;i<autoBinnedTraces.length;i++)calendar=(tracei=autoBinnedTraces[i])[mainData+"calendar"],tracei._input[binAttr]=tracei[binAttr]={start:pa.c2r(minStart,0,calendar),end:pa.c2r(maxEnd,0,calendar),size:minSize},tracei._input[autoBinAttr]=tracei[autoBinAttr]}return pos0=trace._pos0,delete trace._pos0,[trace[binAttr],pos0]}function handleSingleValueOverlays(gd,trace,pa,mainData,binAttr){var i,tracei,overlaidTraceGroup=getConnectedHistograms(gd,trace),pastThisTrace=!1,minSize=1/0,singleValuedTraces=[trace];for(i=0;i<overlaidTraceGroup.length;i++)if((tracei=overlaidTraceGroup[i])===trace)pastThisTrace=!0;else if(pastThisTrace){var resulti=calcAllAutoBins(gd,tracei,pa,mainData,!0),binSpeci=resulti[0],isSingleValued=resulti[2];tracei._autoBinFinished=1,tracei._pos0=resulti[1],isSingleValued?singleValuedTraces.push(tracei):minSize=Math.min(minSize,binSpeci.size)}else minSize=Math.min(minSize,tracei[binAttr].size);var dataVals=new Array(singleValuedTraces.length);for(i=0;i<singleValuedTraces.length;i++)for(var pos0=singleValuedTraces[i]._pos0,j=0;j<pos0.length;j++)if(void 0!==pos0[j]){dataVals[i]=pos0[j];break}for(isFinite(minSize)||(minSize=Lib.distinctVals(dataVals).minDiff),i=0;i<singleValuedTraces.length;i++){var calendar=(tracei=singleValuedTraces[i])[mainData+"calendar"];tracei._input[binAttr]=tracei[binAttr]={start:pa.c2r(dataVals[i]-minSize/2,0,calendar),end:pa.c2r(dataVals[i]+minSize/2,0,calendar),size:minSize}}return trace[binAttr]}function getConnectedHistograms(gd,trace){for(var xid=trace.xaxis,yid=trace.yaxis,orientation=trace.orientation,out=[],fullData=gd._fullData,i=0;i<fullData.length;i++){var tracei=fullData[i];"histogram"===tracei.type&&!0===tracei.visible&&tracei.orientation===orientation&&tracei.xaxis===xid&&tracei.yaxis===yid&&out.push(tracei)}return out}function getMinSize(size1,size2){if(size1===1/0)return size2;var sizeNumeric1=numericSize(size1);return numericSize(size2)<sizeNumeric1?size2:size1}function numericSize(size){return isNumeric(size)?size:"string"==typeof size&&"M"===size.charAt(0)?oneMonth*+size.substr(1):1/0}module.exports=function calc(gd,trace){if(!0===trace.visible){var i,pos=[],size=[],pa=Axes.getFromId(gd,"h"===trace.orientation?trace.yaxis||"y":trace.xaxis||"x"),mainData="h"===trace.orientation?"y":"x",counterData={x:"y",y:"x"}[mainData],calendar=trace[mainData+"calendar"],cumulativeSpec=trace.cumulative;cleanBins(trace,pa,mainData);var i2,binEnd,n,binsAndPos=calcAllAutoBins(gd,trace,pa,mainData),binSpec=binsAndPos[0],pos0=binsAndPos[1],nonuniformBins="string"==typeof binSpec.size,binEdges=[],bins=nonuniformBins?binEdges:binSpec,inc=[],counts=[],inputPoints=[],total=0,norm=trace.histnorm,func=trace.histfunc,densityNorm=-1!==norm.indexOf("density");cumulativeSpec.enabled&&densityNorm&&(norm=norm.replace(/ ?density$/,""),densityNorm=!1);var rawCounterData,sizeInit="max"===func||"min"===func?null:0,binFunc=binFunctions.count,normFunc=normFunctions[norm],isAvg=!1,pr2c=function(v){return pa.r2c(v,0,calendar)};for(Lib.isArrayOrTypedArray(trace[counterData])&&"count"!==func&&(rawCounterData=trace[counterData],isAvg="avg"===func,binFunc=binFunctions[func]),i=pr2c(binSpec.start),binEnd=pr2c(binSpec.end)+(i-Axes.tickIncrement(i,binSpec.size,!1,calendar))/1e6;i<binEnd&&pos.length<1e6&&(i2=Axes.tickIncrement(i,binSpec.size,!1,calendar),pos.push((i+i2)/2),size.push(sizeInit),inputPoints.push([]),binEdges.push(i),densityNorm&&inc.push(1/(i2-i)),isAvg&&counts.push(0),!(i2<=i));)i=i2;binEdges.push(i),nonuniformBins||"date"!==pa.type||(bins={start:pr2c(bins.start),end:pr2c(bins.end),size:bins.size});var roundFn,nMax=size.length,uniqueValsPerBin=!0,leftGap=1/0,rightGap=1/0,ptNumber2cdIndex={};for(i=0;i<pos0.length;i++){var posi=pos0[i];(n=Lib.findBin(posi,bins))>=0&&n<nMax&&(total+=binFunc(n,i,size,rawCounterData,counts),uniqueValsPerBin&&inputPoints[n].length&&posi!==pos0[inputPoints[n][0]]&&(uniqueValsPerBin=!1),inputPoints[n].push(i),ptNumber2cdIndex[i]=n,leftGap=Math.min(leftGap,posi-binEdges[n]),rightGap=Math.min(rightGap,binEdges[n+1]-posi))}uniqueValsPerBin||(roundFn=getBinSpanLabelRound(leftGap,rightGap,binEdges,pa,calendar)),isAvg&&(total=doAvg(size,counts)),normFunc&&normFunc(size,total,inc),cumulativeSpec.enabled&&function cdf(size,direction,currentBin){var i,vi,prevSum;function firstHalfPoint(i){prevSum=size[i],size[i]/=2}function nextHalfPoint(i){vi=size[i],size[i]=prevSum+vi/2,prevSum+=vi}if("half"===currentBin)if("increasing"===direction)for(firstHalfPoint(0),i=1;i<size.length;i++)nextHalfPoint(i);else for(firstHalfPoint(size.length-1),i=size.length-2;i>=0;i--)nextHalfPoint(i);else if("increasing"===direction){for(i=1;i<size.length;i++)size[i]+=size[i-1];"exclude"===currentBin&&(size.unshift(0),size.pop())}else{for(i=size.length-2;i>=0;i--)size[i]+=size[i+1];"exclude"===currentBin&&(size.push(0),size.shift())}}(size,cumulativeSpec.direction,cumulativeSpec.currentbin);var seriesLen=Math.min(pos.length,size.length),cd=[],firstNonzero=0,lastNonzero=seriesLen-1;for(i=0;i<seriesLen;i++)if(size[i]){firstNonzero=i;break}for(i=seriesLen-1;i>=firstNonzero;i--)if(size[i]){lastNonzero=i;break}for(i=firstNonzero;i<=lastNonzero;i++)if(isNumeric(pos[i])&&isNumeric(size[i])){var cdi={p:pos[i],s:size[i],b:0};cumulativeSpec.enabled||(cdi.pts=inputPoints[i],uniqueValsPerBin?cdi.ph0=cdi.ph1=inputPoints[i].length?pos0[inputPoints[i][0]]:pos[i]:(cdi.ph0=roundFn(binEdges[i]),cdi.ph1=roundFn(binEdges[i+1],!0))),cd.push(cdi)}return 1===cd.length&&(cd[0].width1=Axes.tickIncrement(cd[0].p,binSpec.size,!1,calendar)-cd[0].p),arraysToCalcdata(cd,trace),Lib.isArrayOrTypedArray(trace.selectedpoints)&&Lib.tagSelected(cd,trace,ptNumber2cdIndex),cd}}},{"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axes":742,"../bar/arrays_to_calcdata":834,"./average":962,"./bin_functions":964,"./bin_label_vals":965,"./clean_bins":967,"./norm_functions":972,"fast-isnumeric":213}],967:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),cleanDate=_dereq_("../../lib").cleanDate,constants=_dereq_("../../constants/numerical"),ONEDAY=constants.ONEDAY,BADNUM=constants.BADNUM;module.exports=function cleanBins(trace,ax,binDirection){var axType=ax.type,binAttr=binDirection+"bins",bins=trace[binAttr];bins||(bins=trace[binAttr]={});var cleanBound="date"===axType?function(v){return v||0===v?cleanDate(v,BADNUM,bins.calendar):null}:function(v){return isNumeric(v)?Number(v):null};bins.start=cleanBound(bins.start),bins.end=cleanBound(bins.end);var sizeDflt="date"===axType?ONEDAY:1,binSize=bins.size;if(isNumeric(binSize))bins.size=binSize>0?Number(binSize):sizeDflt;else if("string"!=typeof binSize)bins.size=sizeDflt;else{var prefix=binSize.charAt(0),sizeNum=binSize.substr(1);((sizeNum=isNumeric(sizeNum)?Number(sizeNum):0)<=0||"date"!==axType||"M"!==prefix||sizeNum!==Math.round(sizeNum))&&(bins.size=sizeDflt)}var autoBinAttr="autobin"+binDirection;"boolean"!=typeof trace[autoBinAttr]&&(trace[autoBinAttr]=trace._fullInput[autoBinAttr]=trace._input[autoBinAttr]=!((bins.start||0===bins.start)&&(bins.end||0===bins.end))),trace[autoBinAttr]||(delete trace["nbins"+binDirection],delete trace._fullInput["nbins"+binDirection])}},{"../../constants/numerical":670,"../../lib":693,"fast-isnumeric":213}],968:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),handleBinDefaults=_dereq_("./bin_defaults"),handleStyleDefaults=_dereq_("../bar/style_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var x=coerce("x"),y=coerce("y");coerce("cumulative.enabled")&&(coerce("cumulative.direction"),coerce("cumulative.currentbin")),coerce("text");var orientation=coerce("orientation",y&&!x?"h":"v"),sampleLetter="v"===orientation?"x":"y",aggLetter="v"===orientation?"y":"x",len=x&&y?Math.min(x.length&&y.length):(traceOut[sampleLetter]||[]).length;if(len){traceOut._length=len,Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y"],layout),traceOut[aggLetter]&&coerce("histfunc"),handleBinDefaults(traceIn,traceOut,coerce,[sampleLetter]),handleStyleDefaults(traceIn,traceOut,coerce,defaultColor,layout);var errorBarsSupplyDefaults=Registry.getComponentMethod("errorbars","supplyDefaults");errorBarsSupplyDefaults(traceIn,traceOut,Color.defaultLine,{axis:"y"}),errorBarsSupplyDefaults(traceIn,traceOut,Color.defaultLine,{axis:"x",inherit:"y"}),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../components/color":567,"../../lib":693,"../../registry":825,"../bar/style_defaults":847,"./attributes":961,"./bin_defaults":963}],969:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt,trace,cd,pointNumber){if(out.x="xVal"in pt?pt.xVal:pt.x,out.y="yVal"in pt?pt.yVal:pt.y,pt.xa&&(out.xaxis=pt.xa),pt.ya&&(out.yaxis=pt.ya),!(trace.cumulative||{}).enabled){var pointIndices,pts=Array.isArray(pointNumber)?cd[0].pts[pointNumber[0]][pointNumber[1]]:cd[pointNumber].pts;if(out.pointNumbers=pts,out.binNumber=out.pointNumber,delete out.pointNumber,delete out.pointIndex,trace._indexToPoints){pointIndices=[];for(var i=0;i<pts.length;i++)pointIndices=pointIndices.concat(trace._indexToPoints[pts[i]])}else pointIndices=pts;out.pointIndices=pointIndices}return out}},{}],970:[function(_dereq_,module,exports){"use strict";var barHover=_dereq_("../bar/hover").hoverPoints,hoverLabelText=_dereq_("../../plots/cartesian/axes").hoverLabelText;module.exports=function hoverPoints(pointData,xval,yval,hovermode){var pts=barHover(pointData,xval,yval,hovermode);if(pts){var di=(pointData=pts[0]).cd[pointData.index],trace=pointData.cd[0].trace;if(!trace.cumulative.enabled){var posLetter="h"===trace.orientation?"y":"x";pointData[posLetter+"Label"]=hoverLabelText(pointData[posLetter+"a"],di.ph0,di.ph1)}return pts}}},{"../../plots/cartesian/axes":742,"../bar/hover":839}],971:[function(_dereq_,module,exports){"use strict";var Histogram={};Histogram.attributes=_dereq_("./attributes"),Histogram.layoutAttributes=_dereq_("../bar/layout_attributes"),Histogram.supplyDefaults=_dereq_("./defaults"),Histogram.supplyLayoutDefaults=_dereq_("../bar/layout_defaults"),Histogram.calc=_dereq_("./calc"),Histogram.crossTraceCalc=_dereq_("../bar/cross_trace_calc").crossTraceCalc,Histogram.plot=_dereq_("../bar/plot"),Histogram.layerName="barlayer",Histogram.style=_dereq_("../bar/style").style,Histogram.styleOnSelect=_dereq_("../bar/style").styleOnSelect,Histogram.colorbar=_dereq_("../scatter/marker_colorbar"),Histogram.hoverPoints=_dereq_("./hover"),Histogram.selectPoints=_dereq_("../bar/select"),Histogram.eventData=_dereq_("./event_data"),Histogram.moduleType="trace",Histogram.name="histogram",Histogram.basePlotModule=_dereq_("../../plots/cartesian"),Histogram.categories=["cartesian","svg","bar","histogram","oriented","errorBarsOK","showLegend"],Histogram.meta={},module.exports=Histogram},{"../../plots/cartesian":753,"../bar/cross_trace_calc":837,"../bar/layout_attributes":841,"../bar/layout_defaults":842,"../bar/plot":843,"../bar/select":844,"../bar/style":846,"../scatter/marker_colorbar":1050,"./attributes":961,"./calc":966,"./defaults":968,"./event_data":969,"./hover":970}],972:[function(_dereq_,module,exports){"use strict";module.exports={percent:function(size,total){for(var nMax=size.length,norm=100/total,n=0;n<nMax;n++)size[n]*=norm},probability:function(size,total){for(var nMax=size.length,n=0;n<nMax;n++)size[n]/=total},density:function(size,total,inc,yinc){var nMax=size.length;yinc=yinc||1;for(var n=0;n<nMax;n++)size[n]*=inc[n]*yinc},"probability density":function(size,total,inc,yinc){var nMax=size.length;yinc&&(total/=yinc);for(var n=0;n<nMax;n++)size[n]*=inc[n]/total}}},{}],973:[function(_dereq_,module,exports){"use strict";var histogramAttrs=_dereq_("../histogram/attributes"),heatmapAttrs=_dereq_("../heatmap/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=extendFlat({x:histogramAttrs.x,y:histogramAttrs.y,z:{valType:"data_array",editType:"calc"},marker:{color:{valType:"data_array",editType:"calc"},editType:"calc"},histnorm:histogramAttrs.histnorm,histfunc:histogramAttrs.histfunc,autobinx:histogramAttrs.autobinx,nbinsx:histogramAttrs.nbinsx,xbins:histogramAttrs.xbins,autobiny:histogramAttrs.autobiny,nbinsy:histogramAttrs.nbinsy,ybins:histogramAttrs.ybins,xgap:heatmapAttrs.xgap,ygap:heatmapAttrs.ygap,zsmooth:heatmapAttrs.zsmooth,zhoverformat:heatmapAttrs.zhoverformat},colorscaleAttrs("",{cLetter:"z",autoColorDflt:!1}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../heatmap/attributes":942,"../histogram/attributes":961}],974:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),binFunctions=_dereq_("../histogram/bin_functions"),normFunctions=_dereq_("../histogram/norm_functions"),doAvg=_dereq_("../histogram/average"),cleanBins=_dereq_("../histogram/clean_bins"),getBinSpanLabelRound=_dereq_("../histogram/bin_label_vals");function cleanAndAutobin(trace,axLetter,data,ax,r2c,c2r,calendar){var binSpecAttr=axLetter+"bins",autoBinAttr="autobin"+axLetter,binSpec=trace[binSpecAttr];cleanBins(trace,ax,axLetter),!trace[autoBinAttr]&&binSpec&&null!==binSpec.start&&null!==binSpec.end||(binSpec=Axes.autoBin(data,ax,trace["nbins"+axLetter],"2d",calendar),"histogram2dcontour"===trace.type&&(binSpec.start=c2r(Axes.tickIncrement(r2c(binSpec.start),binSpec.size,!0,calendar)),binSpec.end=c2r(Axes.tickIncrement(r2c(binSpec.end),binSpec.size,!1,calendar))),trace._input[binSpecAttr]=trace[binSpecAttr]=binSpec,trace._input[autoBinAttr]=trace[autoBinAttr])}function makeIncrements(len,bins,dv,nonuniform){var i,out=new Array(len);if(nonuniform)for(i=0;i<len;i++)out[i]=1/(bins[i+1]-bins[i]);else{var inc=1/dv;for(i=0;i<len;i++)out[i]=inc}return out}function binsToCalc(r2c,bins){return{start:r2c(bins.start),end:r2c(bins.end),size:bins.size}}function getRanges(edges,uniqueVals,gapLow,gapHigh,ax,calendar){var i,len=edges.length-1,out=new Array(len);if(uniqueVals)for(i=0;i<len;i++)out[i]=[uniqueVals[i],uniqueVals[i]];else{var roundFn=getBinSpanLabelRound(gapLow,gapHigh,edges,ax,calendar);for(i=0;i<len;i++)out[i]=[roundFn(edges[i]),roundFn(edges[i+1],!0)]}return out}module.exports=function calc(gd,trace){var i,j,n,m,xa=Axes.getFromId(gd,trace.xaxis||"x"),x=trace.x?xa.makeCalcdata(trace,"x"):[],ya=Axes.getFromId(gd,trace.yaxis||"y"),y=trace.y?ya.makeCalcdata(trace,"y"):[],xcalendar=trace.xcalendar,ycalendar=trace.ycalendar,xr2c=function(v){return xa.r2c(v,0,xcalendar)},yr2c=function(v){return ya.r2c(v,0,ycalendar)},xc2r=function(v){return xa.c2r(v,0,xcalendar)},yc2r=function(v){return ya.c2r(v,0,ycalendar)},serieslen=trace._length;x.length>serieslen&&x.splice(serieslen,x.length-serieslen),y.length>serieslen&&y.splice(serieslen,y.length-serieslen),cleanAndAutobin(trace,"x",x,xa,xr2c,xc2r,xcalendar),cleanAndAutobin(trace,"y",y,ya,yr2c,yc2r,ycalendar);var z=[],onecol=[],zerocol=[],nonuniformBinsX="string"==typeof trace.xbins.size,nonuniformBinsY="string"==typeof trace.ybins.size,xEdges=[],yEdges=[],xbins=nonuniformBinsX?xEdges:trace.xbins,ybins=nonuniformBinsY?yEdges:trace.ybins,total=0,counts=[],inputPoints=[],norm=trace.histnorm,func=trace.histfunc,densitynorm=-1!==norm.indexOf("density"),sizeinit="max"===func||"min"===func?null:0,binfunc=binFunctions.count,normfunc=normFunctions[norm],doavg=!1,xinc=[],yinc=[],rawCounterData="z"in trace?trace.z:"marker"in trace&&Array.isArray(trace.marker.color)?trace.marker.color:"";rawCounterData&&"count"!==func&&(doavg="avg"===func,binfunc=binFunctions[func]);var binSpec=trace.xbins,binStart=xr2c(binSpec.start),binEnd=xr2c(binSpec.end)+(binStart-Axes.tickIncrement(binStart,binSpec.size,!1,xcalendar))/1e6;for(i=binStart;i<binEnd;i=Axes.tickIncrement(i,binSpec.size,!1,xcalendar))onecol.push(sizeinit),xEdges.push(i),doavg&&zerocol.push(0);xEdges.push(i);var nx=onecol.length,x0c=xr2c(trace.xbins.start),dx=(i-x0c)/nx,x0=xc2r(x0c+dx/2);for(binStart=yr2c((binSpec=trace.ybins).start),binEnd=yr2c(binSpec.end)+(binStart-Axes.tickIncrement(binStart,binSpec.size,!1,ycalendar))/1e6,i=binStart;i<binEnd;i=Axes.tickIncrement(i,binSpec.size,!1,ycalendar)){z.push(onecol.slice()),yEdges.push(i);var ipCol=new Array(nx);for(j=0;j<nx;j++)ipCol[j]=[];inputPoints.push(ipCol),doavg&&counts.push(zerocol.slice())}yEdges.push(i);var ny=z.length,y0c=yr2c(trace.ybins.start),dy=(i-y0c)/ny,y0=yc2r(y0c+dy/2);densitynorm&&(xinc=makeIncrements(onecol.length,xbins,dx,nonuniformBinsX),yinc=makeIncrements(z.length,ybins,dy,nonuniformBinsY)),nonuniformBinsX||"date"!==xa.type||(xbins=binsToCalc(xr2c,xbins)),nonuniformBinsY||"date"!==ya.type||(ybins=binsToCalc(yr2c,ybins));var uniqueValsPerX=!0,uniqueValsPerY=!0,xVals=new Array(nx),yVals=new Array(ny),xGapLow=1/0,xGapHigh=1/0,yGapLow=1/0,yGapHigh=1/0;for(i=0;i<serieslen;i++){var xi=x[i],yi=y[i];n=Lib.findBin(xi,xbins),m=Lib.findBin(yi,ybins),n>=0&&n<nx&&m>=0&&m<ny&&(total+=binfunc(n,i,z[m],rawCounterData,counts[m]),inputPoints[m][n].push(i),uniqueValsPerX&&(void 0===xVals[n]?xVals[n]=xi:xVals[n]!==xi&&(uniqueValsPerX=!1)),uniqueValsPerY&&(void 0===yVals[n]?yVals[n]=yi:yVals[n]!==yi&&(uniqueValsPerY=!1)),xGapLow=Math.min(xGapLow,xi-xEdges[n]),xGapHigh=Math.min(xGapHigh,xEdges[n+1]-xi),yGapLow=Math.min(yGapLow,yi-yEdges[m]),yGapHigh=Math.min(yGapHigh,yEdges[m+1]-yi))}if(doavg)for(m=0;m<ny;m++)total+=doAvg(z[m],counts[m]);if(normfunc)for(m=0;m<ny;m++)normfunc(z[m],total,xinc,yinc[m]);return{x:x,xRanges:getRanges(xEdges,uniqueValsPerX&&xVals,xGapLow,xGapHigh,xa,xcalendar),x0:x0,dx:dx,y:y,yRanges:getRanges(yEdges,uniqueValsPerY&&yVals,yGapLow,yGapHigh,ya,ycalendar),y0:y0,dy:dy,z:z,pts:inputPoints}}},{"../../lib":693,"../../plots/cartesian/axes":742,"../histogram/average":962,"../histogram/bin_functions":964,"../histogram/bin_label_vals":965,"../histogram/clean_bins":967,"../histogram/norm_functions":972}],975:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleSampleDefaults=_dereq_("./sample_defaults"),handleStyleDefaults=_dereq_("../heatmap/style_defaults"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleSampleDefaults(traceIn,traceOut,coerce,layout),!1!==traceOut.visible&&(handleStyleDefaults(traceIn,traceOut,coerce,layout),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"z"}))}},{"../../components/colorscale/defaults":577,"../../lib":693,"../heatmap/style_defaults":956,"./attributes":973,"./sample_defaults":978}],976:[function(_dereq_,module,exports){"use strict";var heatmapHover=_dereq_("../heatmap/hover"),hoverLabelText=_dereq_("../../plots/cartesian/axes").hoverLabelText;module.exports=function hoverPoints(pointData,xval,yval,hovermode,hoverLayer,contour){var pts=heatmapHover(pointData,xval,yval,hovermode,hoverLayer,contour);if(pts){var indices=(pointData=pts[0]).index,ny=indices[0],nx=indices[1],cd0=pointData.cd[0],xRange=cd0.xRanges[nx],yRange=cd0.yRanges[ny];return pointData.xLabel=hoverLabelText(pointData.xa,xRange[0],xRange[1]),pointData.yLabel=hoverLabelText(pointData.ya,yRange[0],yRange[1]),pts}}},{"../../plots/cartesian/axes":742,"../heatmap/hover":949}],977:[function(_dereq_,module,exports){"use strict";var Histogram2D={};Histogram2D.attributes=_dereq_("./attributes"),Histogram2D.supplyDefaults=_dereq_("./defaults"),Histogram2D.calc=_dereq_("../heatmap/calc"),Histogram2D.plot=_dereq_("../heatmap/plot"),Histogram2D.layerName="heatmaplayer",Histogram2D.colorbar=_dereq_("../heatmap/colorbar"),Histogram2D.style=_dereq_("../heatmap/style"),Histogram2D.hoverPoints=_dereq_("./hover"),Histogram2D.eventData=_dereq_("../histogram/event_data"),Histogram2D.moduleType="trace",Histogram2D.name="histogram2d",Histogram2D.basePlotModule=_dereq_("../../plots/cartesian"),Histogram2D.categories=["cartesian","svg","2dMap","histogram"],Histogram2D.meta={},module.exports=Histogram2D},{"../../plots/cartesian":753,"../heatmap/calc":943,"../heatmap/colorbar":945,"../heatmap/plot":954,"../heatmap/style":955,"../histogram/event_data":969,"./attributes":973,"./defaults":975,"./hover":976}],978:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),handleBinDefaults=_dereq_("../histogram/bin_defaults");module.exports=function handleSampleDefaults(traceIn,traceOut,coerce,layout){var x=coerce("x"),y=coerce("y");if(x&&x.length&&y&&y.length){traceOut._length=Math.min(x.length,y.length),Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y"],layout),(coerce("z")||coerce("marker.color"))&&coerce("histfunc");handleBinDefaults(traceIn,traceOut,coerce,["x","y"])}else traceOut.visible=!1}},{"../../registry":825,"../histogram/bin_defaults":963}],979:[function(_dereq_,module,exports){"use strict";var histogram2dAttrs=_dereq_("../histogram2d/attributes"),contourAttrs=_dereq_("../contour/attributes"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=extendFlat({x:histogram2dAttrs.x,y:histogram2dAttrs.y,z:histogram2dAttrs.z,marker:histogram2dAttrs.marker,histnorm:histogram2dAttrs.histnorm,histfunc:histogram2dAttrs.histfunc,autobinx:histogram2dAttrs.autobinx,nbinsx:histogram2dAttrs.nbinsx,xbins:histogram2dAttrs.xbins,autobiny:histogram2dAttrs.autobiny,nbinsy:histogram2dAttrs.nbinsy,ybins:histogram2dAttrs.ybins,autocontour:contourAttrs.autocontour,ncontours:contourAttrs.ncontours,contours:contourAttrs.contours,line:contourAttrs.line,zhoverformat:histogram2dAttrs.zhoverformat},colorscaleAttrs("",{cLetter:"z",editTypeOverride:"calc"}),{colorbar:colorbarAttrs})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../contour/attributes":913,"../histogram2d/attributes":973}],980:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleSampleDefaults=_dereq_("../histogram2d/sample_defaults"),handleContoursDefaults=_dereq_("../contour/contours_defaults"),handleStyleDefaults=_dereq_("../contour/style_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleSampleDefaults(traceIn,traceOut,coerce,layout),!1!==traceOut.visible&&(handleContoursDefaults(traceIn,traceOut,coerce,function coerce2(attr){return Lib.coerce2(traceIn,traceOut,attributes,attr)}),handleStyleDefaults(traceIn,traceOut,coerce,layout))}},{"../../lib":693,"../contour/contours_defaults":920,"../contour/style_defaults":934,"../histogram2d/sample_defaults":978,"./attributes":979}],981:[function(_dereq_,module,exports){"use strict";var Histogram2dContour={};Histogram2dContour.attributes=_dereq_("./attributes"),Histogram2dContour.supplyDefaults=_dereq_("./defaults"),Histogram2dContour.calc=_dereq_("../contour/calc"),Histogram2dContour.plot=_dereq_("../contour/plot").plot,Histogram2dContour.layerName="contourlayer",Histogram2dContour.style=_dereq_("../contour/style"),Histogram2dContour.colorbar=_dereq_("../contour/colorbar"),Histogram2dContour.hoverPoints=_dereq_("../contour/hover"),Histogram2dContour.moduleType="trace",Histogram2dContour.name="histogram2dcontour",Histogram2dContour.basePlotModule=_dereq_("../../plots/cartesian"),Histogram2dContour.categories=["cartesian","svg","2dMap","contour","histogram","showLegend"],Histogram2dContour.meta={},module.exports=Histogram2dContour},{"../../plots/cartesian":753,"../contour/calc":914,"../contour/colorbar":916,"../contour/hover":926,"../contour/plot":931,"../contour/style":933,"./attributes":979,"./defaults":980}],982:[function(_dereq_,module,exports){"use strict";var colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),surfaceAtts=_dereq_("../surface/attributes"),baseAttrs=_dereq_("../../plots/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports=extendFlat({x:{valType:"data_array",editType:"calc+clearAxisTypes"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},z:{valType:"data_array",editType:"calc+clearAxisTypes"},i:{valType:"data_array",editType:"calc"},j:{valType:"data_array",editType:"calc"},k:{valType:"data_array",editType:"calc"},text:{valType:"string",dflt:"",arrayOk:!0,editType:"calc"},delaunayaxis:{valType:"enumerated",values:["x","y","z"],dflt:"z",editType:"calc"},alphahull:{valType:"number",dflt:-1,editType:"calc"},intensity:{valType:"data_array",editType:"calc"},color:{valType:"color",editType:"calc"},vertexcolor:{valType:"data_array",editType:"calc"},facecolor:{valType:"data_array",editType:"calc"}},colorscaleAttrs("",{colorAttr:"`intensity`",showScaleDflt:!0,editTypeOverride:"calc"}),{colorbar:colorbarAttrs,opacity:surfaceAtts.opacity,flatshading:{valType:"boolean",dflt:!1,editType:"calc"},contour:{show:extendFlat({},surfaceAtts.contours.x.show,{}),color:surfaceAtts.contours.x.color,width:surfaceAtts.contours.x.width,editType:"calc"},lightposition:{x:extendFlat({},surfaceAtts.lightposition.x,{dflt:1e5}),y:extendFlat({},surfaceAtts.lightposition.y,{dflt:1e5}),z:extendFlat({},surfaceAtts.lightposition.z,{dflt:0}),editType:"calc"},lighting:extendFlat({vertexnormalsepsilon:{valType:"number",min:0,max:1,dflt:1e-12,editType:"calc"},facenormalsepsilon:{valType:"number",min:0,max:1,dflt:1e-6,editType:"calc"},editType:"calc"},surfaceAtts.lighting),hoverinfo:extendFlat({},baseAttrs.hoverinfo,{editType:"calc"})})},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/attributes":739,"../surface/attributes":1119}],983:[function(_dereq_,module,exports){"use strict";var colorscaleCalc=_dereq_("../../components/colorscale/calc");module.exports=function calc(gd,trace){trace.intensity&&colorscaleCalc(trace,trace.intensity,"","c")}},{"../../components/colorscale/calc":575}],984:[function(_dereq_,module,exports){"use strict";var createMesh=_dereq_("gl-mesh3d"),triangulate=_dereq_("delaunay-triangulate"),alphaShape=_dereq_("alpha-shape"),convexHull=_dereq_("convex-hull"),parseColorScale=_dereq_("../../lib/gl_format_color").parseColorScale,str2RgbaArray=_dereq_("../../lib/str2rgbarray"),zip3=_dereq_("../../plots/gl3d/zip3");function Mesh3DTrace(scene,mesh,uid){this.scene=scene,this.uid=uid,this.mesh=mesh,this.name="",this.color="#fff",this.data=null,this.showContour=!1}var proto=Mesh3DTrace.prototype;function parseColorArray(colors){return colors.map(str2RgbaArray)}proto.handlePick=function(selection){if(selection.object===this.mesh){var selectIndex=selection.index=selection.data.index;selection.traceCoordinate=[this.data.x[selectIndex],this.data.y[selectIndex],this.data.z[selectIndex]];var text=this.data.text;return Array.isArray(text)&&void 0!==text[selectIndex]?selection.textLabel=text[selectIndex]:text&&(selection.textLabel=text),!0}},proto.update=function(data){var scene=this.scene,layout=scene.fullSceneLayout;function toDataCoords(axis,coord,scale,calendar){return coord.map(function(x){return axis.d2l(x,0,calendar)*scale})}this.data=data;var cells,positions=zip3(toDataCoords(layout.xaxis,data.x,scene.dataScale[0],data.xcalendar),toDataCoords(layout.yaxis,data.y,scene.dataScale[1],data.ycalendar),toDataCoords(layout.zaxis,data.z,scene.dataScale[2],data.zcalendar));if(data.i&&data.j&&data.k)cells=zip3(data.i,data.j,data.k);else if(0===data.alphahull)cells=convexHull(positions);else if(data.alphahull>0)cells=alphaShape(data.alphahull,positions);else{var d=["x","y","z"].indexOf(data.delaunayaxis);cells=triangulate(positions.map(function(c){return[c[(d+1)%3],c[(d+2)%3]]}))}var config={positions:positions,cells:cells,lightPosition:[data.lightposition.x,data.lightposition.y,data.lightposition.z],ambient:data.lighting.ambient,diffuse:data.lighting.diffuse,specular:data.lighting.specular,roughness:data.lighting.roughness,fresnel:data.lighting.fresnel,vertexNormalsEpsilon:data.lighting.vertexnormalsepsilon,faceNormalsEpsilon:data.lighting.facenormalsepsilon,opacity:data.opacity,contourEnable:data.contour.show,contourColor:str2RgbaArray(data.contour.color).slice(0,3),contourWidth:data.contour.width,useFacetNormals:data.flatshading};data.intensity?(this.color="#fff",config.vertexIntensity=data.intensity,config.vertexIntensityBounds=[data.cmin,data.cmax],config.colormap=parseColorScale(data.colorscale)):data.vertexcolor?(this.color=data.vertexcolor[0],config.vertexColors=parseColorArray(data.vertexcolor)):data.facecolor?(this.color=data.facecolor[0],config.cellColors=parseColorArray(data.facecolor)):(this.color=data.color,config.meshColor=str2RgbaArray(data.color)),this.mesh.update(config)},proto.dispose=function(){this.scene.glplot.remove(this.mesh),this.mesh.dispose()},module.exports=function createMesh3DTrace(scene,data){var gl=scene.glplot.gl,mesh=createMesh({gl:gl}),result=new Mesh3DTrace(scene,mesh,data.uid);return mesh._trace=result,result.update(data),scene.glplot.add(mesh),result}},{"../../lib/gl_format_color":689,"../../lib/str2rgbarray":717,"../../plots/gl3d/zip3":795,"alpha-shape":51,"convex-hull":117,"delaunay-triangulate":149,"gl-mesh3d":267}],985:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}function readComponents(array){var ret=array.map(function(attr){var result=coerce(attr);return result&&Lib.isArrayOrTypedArray(result)?result:null});return ret.every(function(x){return x&&x.length===ret[0].length})&&ret}var coords=readComponents(["x","y","z"]),indices=readComponents(["i","j","k"]);coords?(indices&&indices.forEach(function(index){for(var i=0;i<index.length;++i)index[i]|=0}),Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y","z"],layout),["lighting.ambient","lighting.diffuse","lighting.specular","lighting.roughness","lighting.fresnel","lighting.vertexnormalsepsilon","lighting.facenormalsepsilon","lightposition.x","lightposition.y","lightposition.z","contour.show","contour.color","contour.width","colorscale","reversescale","flatshading","alphahull","delaunayaxis","opacity"].forEach(function(x){coerce(x)}),"intensity"in traceIn?(coerce("intensity"),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"c"})):(traceOut.showscale=!1,"facecolor"in traceIn?coerce("facecolor"):"vertexcolor"in traceIn?coerce("vertexcolor"):coerce("color",defaultColor)),coerce("text"),traceOut._length=null):traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"../../registry":825,"./attributes":982}],986:[function(_dereq_,module,exports){"use strict";var Mesh3D={};Mesh3D.attributes=_dereq_("./attributes"),Mesh3D.supplyDefaults=_dereq_("./defaults"),Mesh3D.calc=_dereq_("./calc"),Mesh3D.colorbar={min:"cmin",max:"cmax"},Mesh3D.plot=_dereq_("./convert"),Mesh3D.moduleType="trace",Mesh3D.name="mesh3d",Mesh3D.basePlotModule=_dereq_("../../plots/gl3d"),Mesh3D.categories=["gl3d"],Mesh3D.meta={},module.exports=Mesh3D},{"../../plots/gl3d":784,"./attributes":982,"./calc":983,"./convert":984,"./defaults":985}],987:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../../lib").extendFlat,scatterAttrs=_dereq_("../scatter/attributes"),dash=_dereq_("../../components/drawing/attributes").dash,lineAttrs=scatterAttrs.line;function directionAttrs(lineColorDefault){return{line:{color:extendFlat({},lineAttrs.color,{dflt:lineColorDefault}),width:lineAttrs.width,dash:dash,editType:"style"},editType:"style"}}module.exports={x:{valType:"data_array",editType:"calc+clearAxisTypes"},open:{valType:"data_array",editType:"calc"},high:{valType:"data_array",editType:"calc"},low:{valType:"data_array",editType:"calc"},close:{valType:"data_array",editType:"calc"},line:{width:extendFlat({},lineAttrs.width,{}),dash:extendFlat({},dash,{}),editType:"style"},increasing:directionAttrs("#3D9970"),decreasing:directionAttrs("#FF4136"),text:{valType:"string",dflt:"",arrayOk:!0,editType:"calc"},tickwidth:{valType:"number",min:0,max:.5,dflt:.3,editType:"calc"}}},{"../../components/drawing/attributes":591,"../../lib":693,"../scatter/attributes":1032}],988:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),_=Lib._,Axes=_dereq_("../../plots/cartesian/axes"),BADNUM=_dereq_("../../constants/numerical").BADNUM;function ptFunc(o,h,l,c){return{o:o,h:h,l:l,c:c}}function calcCommon(gd,trace,x,ya,ptFunc){for(var o=ya.makeCalcdata(trace,"open"),h=ya.makeCalcdata(trace,"high"),l=ya.makeCalcdata(trace,"low"),c=ya.makeCalcdata(trace,"close"),hasTextArray=Array.isArray(trace.text),increasing=!0,cPrev=null,cd=[],i=0;i<x.length;i++){var xi=x[i],oi=o[i],hi=h[i],li=l[i],ci=c[i];if(xi!==BADNUM&&oi!==BADNUM&&hi!==BADNUM&&li!==BADNUM&&ci!==BADNUM){ci===oi?null!==cPrev&&ci!==cPrev&&(increasing=ci>cPrev):increasing=ci>oi,cPrev=ci;var pt=ptFunc(oi,hi,li,ci);pt.pos=xi,pt.yc=(oi+ci)/2,pt.i=i,pt.dir=increasing?"increasing":"decreasing",hasTextArray&&(pt.tx=trace.text[i]),cd.push(pt)}}return trace._extremes[ya._id]=Axes.findExtremes(ya,l.concat(h),{padded:!0}),cd.length&&(cd[0].t={labels:{open:_(gd,"open:")+" ",high:_(gd,"high:")+" ",low:_(gd,"low:")+" ",close:_(gd,"close:")+" "}}),cd}module.exports={calc:function calc(gd,trace){var xa=Axes.getFromId(gd,trace.xaxis),ya=Axes.getFromId(gd,trace.yaxis),tickLen=function convertTickWidth(gd,xa,trace){var minDiff=trace._minDiff;if(!minDiff){var i,fullData=gd._fullData,ohlcTracesOnThisXaxis=[];for(minDiff=1/0,i=0;i<fullData.length;i++){var tracei=fullData[i];if("ohlc"===tracei.type&&!0===tracei.visible&&tracei.xaxis===xa._id){ohlcTracesOnThisXaxis.push(tracei);var xcalc=xa.makeCalcdata(tracei,"x");tracei._xcalc=xcalc;var _minDiff=Lib.distinctVals(xcalc).minDiff;_minDiff&&isFinite(_minDiff)&&(minDiff=Math.min(minDiff,_minDiff))}}for(minDiff===1/0&&(minDiff=1),i=0;i<ohlcTracesOnThisXaxis.length;i++)ohlcTracesOnThisXaxis[i]._minDiff=minDiff}return minDiff*trace.tickwidth}(gd,xa,trace),minDiff=trace._minDiff;trace._minDiff=null;var x=trace._xcalc;trace._xcalc=null;var cd=calcCommon(gd,trace,x,ya,ptFunc);return trace._extremes[xa._id]=Axes.findExtremes(xa,x,{vpad:minDiff/2}),cd.length?(Lib.extendFlat(cd[0].t,{wHover:minDiff/2,tickLen:tickLen}),cd):[{t:{empty:!0}}]},calcCommon:calcCommon}},{"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axes":742}],989:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleOHLC=_dereq_("./ohlc_defaults"),attributes=_dereq_("./attributes");function handleDirection(traceIn,traceOut,coerce,direction){coerce(direction+".line.color"),coerce(direction+".line.width",traceOut.line.width),coerce(direction+".line.dash",traceOut.line.dash)}module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleOHLC(traceIn,traceOut,coerce,layout)?(coerce("line.width"),coerce("line.dash"),handleDirection(traceIn,traceOut,coerce,"increasing"),handleDirection(traceIn,traceOut,coerce,"decreasing"),coerce("text"),coerce("tickwidth"),layout._requestRangeslider[traceOut.xaxis]=!0):traceOut.visible=!1}},{"../../lib":693,"./attributes":987,"./ohlc_defaults":992}],990:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../../plots/cartesian/axes"),Fx=_dereq_("../../components/fx"),Color=_dereq_("../../components/color"),fillHoverText=_dereq_("../scatter/fill_hover_text"),DIRSYMBOL={increasing:"",decreasing:""};module.exports=function hoverPoints(pointData,xval,yval,hovermode){var cd=pointData.cd,xa=pointData.xa,ya=pointData.ya,trace=cd[0].trace,t=cd[0].t,type=trace.type,minAttr="ohlc"===type?"l":"min",maxAttr="ohlc"===type?"h":"max",centerShift=t.bPos||0,x0=xval-centerShift,displayHalfWidth=t.bdPos||t.tickLen,hoverHalfWidth=t.wHover,pseudoDistance=Math.min(1,displayHalfWidth/Math.abs(xa.r2c(xa.range[1])-xa.r2c(xa.range[0]))),hoverPseudoDistance=pointData.maxHoverDistance-pseudoDistance,spikePseudoDistance=pointData.maxSpikeDistance-pseudoDistance;function dx(di){var pos=di.pos-x0;return Fx.inbox(pos-hoverHalfWidth,pos+hoverHalfWidth,hoverPseudoDistance)}function dy(di){return Fx.inbox(di[minAttr]-yval,di[maxAttr]-yval,hoverPseudoDistance)}function dxy(di){return(dx(di)+dy(di))/2}var distfn=Fx.getDistanceFunction(hovermode,dx,dy,dxy);if(Fx.getClosest(cd,distfn,pointData),!1===pointData.index)return[];var di=cd[pointData.index],i=pointData.index=di.i,dir=di.dir,container=trace[dir],lc=container.line.color;function getLabelLine(attr){return t.labels[attr]+Axes.hoverLabelText(ya,trace[attr][i])}Color.opacity(lc)&&container.line.width?pointData.color=lc:pointData.color=container.fillcolor,pointData.x0=xa.c2p(di.pos+centerShift-displayHalfWidth,!0),pointData.x1=xa.c2p(di.pos+centerShift+displayHalfWidth,!0),pointData.xLabelVal=di.pos,pointData.spikeDistance=dxy(di)*spikePseudoDistance/hoverPseudoDistance,pointData.xSpike=xa.c2p(di.pos,!0);var hoverinfo=trace.hoverinfo,hoverParts=hoverinfo.split("+"),isAll="all"===hoverinfo,hasY=isAll||-1!==hoverParts.indexOf("y"),hasText=isAll||-1!==hoverParts.indexOf("text"),textParts=hasY?[getLabelLine("open"),getLabelLine("high"),getLabelLine("low"),getLabelLine("close")+"  "+DIRSYMBOL[dir]]:[];return hasText&&fillHoverText(di,trace,textParts),pointData.extraText=textParts.join("<br>"),pointData.y0=pointData.y1=ya.c2p(di.yc,!0),[pointData]}},{"../../components/color":567,"../../components/fx":609,"../../plots/cartesian/axes":742,"../scatter/fill_hover_text":1040}],991:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"ohlc",basePlotModule:_dereq_("../../plots/cartesian"),categories:["cartesian","svg","showLegend"],meta:{},attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),calc:_dereq_("./calc").calc,plot:_dereq_("./plot"),style:_dereq_("./style"),hoverPoints:_dereq_("./hover"),selectPoints:_dereq_("./select")}},{"../../plots/cartesian":753,"./attributes":987,"./calc":988,"./defaults":989,"./hover":990,"./plot":993,"./select":994,"./style":995}],992:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry");module.exports=function handleOHLC(traceIn,traceOut,coerce,layout){var x=coerce("x"),open=coerce("open"),high=coerce("high"),low=coerce("low"),close=coerce("close");if(Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x"],layout),open&&high&&low&&close){var len=Math.min(open.length,high.length,low.length,close.length);return x&&(len=Math.min(len,x.length)),traceOut._length=len,len}}},{"../../registry":825}],993:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib");module.exports=function plot(gd,plotinfo,cdOHLC,ohlcLayer){var xa=plotinfo.xaxis,ya=plotinfo.yaxis;Lib.makeTraceGroups(ohlcLayer,cdOHLC,"trace ohlc").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],t=cd0.t,trace=cd0.trace;if(plotinfo.isRangePlot||(cd0.node3=plotGroup),!0!==trace.visible||t.empty)plotGroup.remove();else{var tickLen=t.tickLen,paths=plotGroup.selectAll("path").data(Lib.identity);paths.enter().append("path"),paths.exit().remove(),paths.attr("d",function(d){var x=xa.c2p(d.pos,!0),xo=xa.c2p(d.pos-tickLen,!0),xc=xa.c2p(d.pos+tickLen,!0);return"M"+xo+","+ya.c2p(d.o,!0)+"H"+x+"M"+x+","+ya.c2p(d.h,!0)+"V"+ya.c2p(d.l,!0)+"M"+xc+","+ya.c2p(d.c,!0)+"H"+x})}})}},{"../../lib":693,d3:147}],994:[function(_dereq_,module,exports){"use strict";module.exports=function selectPoints(searchInfo,selectionTester){var i,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[],posOffset=cd[0].t.bPos||0;if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++){var di=cd[i];selectionTester.contains([xa.c2p(di.pos+posOffset),ya.c2p(di.yc)],null,di.i,searchInfo)?(selection.push({pointNumber:di.i,x:xa.c2d(di.pos),y:ya.c2d(di.yc)}),di.selected=1):di.selected=0}return selection}},{}],995:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),Color=_dereq_("../../components/color");module.exports=function style(gd,cd){var s=cd?cd[0].node3:d3.select(gd).selectAll("g.ohlclayer").selectAll("g.trace");s.style("opacity",function(d){return d[0].trace.opacity}),s.each(function(d){var trace=d[0].trace;d3.select(this).selectAll("path").each(function(di){var dirLine=trace[di.dir].line;d3.select(this).style("fill","none").call(Color.stroke,dirLine.color).call(Drawing.dashLine,dirLine.dash,dirLine.width).style("opacity",trace.selectedpoints&&!di.selected?.3:1)})})}},{"../../components/color":567,"../../components/drawing":592,d3:147}],996:[function(_dereq_,module,exports){"use strict";var colorAttributes=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),axesAttrs=_dereq_("../../plots/cartesian/layout_attributes"),fontAttrs=_dereq_("../../plots/font_attributes"),domainAttrs=_dereq_("../../plots/domain").attributes,extendFlat=_dereq_("../../lib/extend").extendFlat,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;module.exports={domain:domainAttrs({name:"parcoords",trace:!0,editType:"calc"}),labelfont:fontAttrs({editType:"calc"}),tickfont:fontAttrs({editType:"calc"}),rangefont:fontAttrs({editType:"calc"}),dimensions:templatedArray("dimension",{label:{valType:"string",editType:"calc"},tickvals:extendFlat({},axesAttrs.tickvals,{editType:"calc"}),ticktext:extendFlat({},axesAttrs.ticktext,{editType:"calc"}),tickformat:{valType:"string",dflt:"3s",editType:"calc"},visible:{valType:"boolean",dflt:!0,editType:"calc"},range:{valType:"info_array",items:[{valType:"number",editType:"calc"},{valType:"number",editType:"calc"}],editType:"calc"},constraintrange:{valType:"info_array",freeLength:!0,dimensions:"1-2",items:[{valType:"number",editType:"calc"},{valType:"number",editType:"calc"}],editType:"calc"},multiselect:{valType:"boolean",dflt:!0,editType:"calc"},values:{valType:"data_array",editType:"calc"},editType:"calc"}),line:extendFlat(colorAttributes("line",{colorscaleDflt:"Viridis",autoColorDflt:!1,editTypeOverride:"calc"}),{colorbar:colorbarAttrs,editType:"calc"})}},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plot_api/plot_template":732,"../../plots/cartesian/layout_attributes":754,"../../plots/domain":767,"../../plots/font_attributes":768}],997:[function(_dereq_,module,exports){"use strict";var c=_dereq_("./constants"),d3=_dereq_("d3"),keyFun=_dereq_("../../lib/gup").keyFun,repeat=_dereq_("../../lib/gup").repeat,sortAsc=_dereq_("../../lib").sorterAsc,snapRatio=c.bar.snapRatio;function snapOvershoot(v,vAdjacent){return v*(1-snapRatio)+vAdjacent*snapRatio}var snapClose=c.bar.snapClose;function closeToCovering(v,vAdjacent){return v*(1-snapClose)+vAdjacent*snapClose}function ordinalScaleSnapLo(a,v,existingRanges){if(overlappingExisting(v,existingRanges))return v;for(var aPrev=a[0],aPrevPrev=aPrev,i=1;i<a.length;i++){var aNext=a[i];if(v<closeToCovering(aPrev,aNext))return snapOvershoot(aPrev,aPrevPrev);if(v<aNext||i===a.length-1)return snapOvershoot(aNext,aPrev);aPrevPrev=aPrev,aPrev=aNext}}function ordinalScaleSnapHi(a,v,existingRanges){if(overlappingExisting(v,existingRanges))return v;for(var aPrev=a[a.length-1],aPrevPrev=aPrev,i=a.length-2;i>=0;i--){var aNext=a[i];if(v>closeToCovering(aPrev,aNext))return snapOvershoot(aPrev,aPrevPrev);if(v>aNext||i===a.length-1)return snapOvershoot(aNext,aPrev);aPrevPrev=aPrev,aPrev=aNext}}function overlappingExisting(v,existingRanges){for(var i=0;i<existingRanges.length;i++)if(v>=existingRanges[i][0]&&v<=existingRanges[i][1])return!0;return!1}function barHorizontalSetup(selection){selection.attr("x",-c.bar.captureWidth/2).attr("width",c.bar.captureWidth)}function backgroundBarHorizontalSetup(selection){selection.attr("visibility","visible").style("visibility","visible").attr("fill","yellow").attr("opacity",0)}function setHighlight(d){if(!d.brush.filterSpecified)return"0,"+d.height;for(var p,sectionHeight,iNext,pixelRanges=unitToPx(d.brush.filter.getConsolidated(),d.height),dashArray=[0],currentGap=pixelRanges.length?pixelRanges[0][0]:null,i=0;i<pixelRanges.length;i++)sectionHeight=(p=pixelRanges[i])[1]-p[0],dashArray.push(currentGap),dashArray.push(sectionHeight),(iNext=i+1)<pixelRanges.length&&(currentGap=pixelRanges[iNext][0]-p[1]);return dashArray.push(d.height),dashArray}function unitToPx(unitRanges,height){return unitRanges.map(function(pr){return pr.map(function(v){return v*height}).sort(sortAsc)})}function clearCursor(){d3.select(document.body).style("cursor",null)}function styleHighlight(selection){selection.attr("stroke-dasharray",setHighlight)}function renderHighlight(root,tweenCallback){var bar=d3.select(root).selectAll(".highlight, .highlight-shadow");styleHighlight(tweenCallback?bar.transition().duration(c.bar.snapDuration).each("end",tweenCallback):bar)}function getInterval(d,y){var i,b=d.brush,closestInterval=NaN,out={};if(b.filterSpecified){var height=d.height,intervals=b.filter.getConsolidated(),pixIntervals=unitToPx(intervals,height),hoveredInterval=NaN,previousInterval=NaN,nextInterval=NaN;for(i=0;i<=pixIntervals.length;i++){var p=pixIntervals[i];if(p&&p[0]<=y&&y<=p[1]){hoveredInterval=i;break}if(previousInterval=i?i-1:NaN,p&&p[0]>y){nextInterval=i;break}}if(closestInterval=hoveredInterval,isNaN(closestInterval)&&(closestInterval=isNaN(previousInterval)||isNaN(nextInterval)?isNaN(previousInterval)?nextInterval:previousInterval:y-pixIntervals[previousInterval][1]<pixIntervals[nextInterval][0]-y?previousInterval:nextInterval),!isNaN(closestInterval)){var fPix=pixIntervals[closestInterval],region=function getRegion(fPix,y){var pad=c.bar.handleHeight;if(!(y>fPix[1]+pad||y<fPix[0]-pad))return y>=.9*fPix[1]+.1*fPix[0]?"n":y<=.9*fPix[0]+.1*fPix[1]?"s":"ns"}(fPix,y);region&&(out.interval=intervals[closestInterval],out.intervalPix=fPix,out.region=region)}}if(d.ordinal&&!out.region){var a=d.unitTickvals,unitLocation=d.unitToPaddedPx.invert(y);for(i=0;i<a.length;i++){var rangei=[.25*a[Math.max(i-1,0)]+.75*a[i],.25*a[Math.min(i+1,a.length-1)]+.75*a[i]];if(unitLocation>=rangei[0]&&unitLocation<=rangei[1]){out.clickableOrdinalRange=rangei;break}}}return out}function attachDragBehavior(selection){selection.on("mousemove",function(d){if(d3.event.preventDefault(),!d.parent.inBrushDrag){var interval=getInterval(d,d.height-d3.mouse(this)[1]-2*c.verticalPadding),cursor="crosshair";interval.clickableOrdinalRange?cursor="pointer":interval.region&&(cursor=interval.region+"-resize"),d3.select(document.body).style("cursor",cursor)}}).on("mouseleave",function(d){d.parent.inBrushDrag||clearCursor()}).call(d3.behavior.drag().on("dragstart",function(d){d3.event.sourceEvent.stopPropagation();var y=d.height-d3.mouse(this)[1]-2*c.verticalPadding,unitLocation=d.unitToPaddedPx.invert(y),b=d.brush,interval=getInterval(d,y),unitRange=interval.interval,s=b.svgBrush;if(s.wasDragged=!1,s.grabbingBar="ns"===interval.region,s.grabbingBar){var pixelRange=unitRange.map(d.unitToPaddedPx);s.grabPoint=y-pixelRange[0]-c.verticalPadding,s.barLength=pixelRange[1]-pixelRange[0]}s.clickableOrdinalRange=interval.clickableOrdinalRange,s.stayingIntervals=d.multiselect&&b.filterSpecified?b.filter.getConsolidated():[],unitRange&&(s.stayingIntervals=s.stayingIntervals.filter(function(int2){return int2[0]!==unitRange[0]&&int2[1]!==unitRange[1]})),s.startExtent=interval.region?unitRange["s"===interval.region?1:0]:unitLocation,d.parent.inBrushDrag=!0,s.brushStartCallback()}).on("drag",function(d){d3.event.sourceEvent.stopPropagation();var y=d.height-d3.mouse(this)[1]-2*c.verticalPadding,s=d.brush.svgBrush;s.wasDragged=!0,s.grabbingBar?s.newExtent=[y-s.grabPoint,y+s.barLength-s.grabPoint].map(d.unitToPaddedPx.invert):s.newExtent=[s.startExtent,d.unitToPaddedPx.invert(y)].sort(sortAsc);var bottomViolation=Math.max(0,-s.newExtent[0]),topViolation=Math.max(0,s.newExtent[1]-1);s.newExtent[0]+=bottomViolation,s.newExtent[1]-=topViolation,s.grabbingBar&&(s.newExtent[1]+=bottomViolation,s.newExtent[0]-=topViolation),d.brush.filterSpecified=!0,s.extent=s.stayingIntervals.concat([s.newExtent]),s.brushCallback(d),renderHighlight(this.parentNode)}).on("dragend",function(d){d3.event.sourceEvent.stopPropagation();var brush=d.brush,filter=brush.filter,s=brush.svgBrush,grabbingBar=s.grabbingBar;if(s.grabbingBar=!1,s.grabLocation=void 0,d.parent.inBrushDrag=!1,clearCursor(),!s.wasDragged)return s.wasDragged=void 0,s.clickableOrdinalRange?brush.filterSpecified&&d.multiselect?s.extent.push(s.clickableOrdinalRange):(s.extent=[s.clickableOrdinalRange],brush.filterSpecified=!0):grabbingBar?(s.extent=s.stayingIntervals,0===s.extent.length&&brushClear(brush)):brushClear(brush),s.brushCallback(d),renderHighlight(this.parentNode),void s.brushEndCallback(brush.filterSpecified?filter.getConsolidated():[]);var mergeIntervals=function(){filter.set(filter.getConsolidated())};if(d.ordinal){var a=d.unitTickvals;a[a.length-1]<a[0]&&a.reverse(),s.newExtent=[ordinalScaleSnapLo(a,s.newExtent[0],s.stayingIntervals),ordinalScaleSnapHi(a,s.newExtent[1],s.stayingIntervals)];var hasNewExtent=s.newExtent[1]>s.newExtent[0];s.extent=s.stayingIntervals.concat(hasNewExtent?[s.newExtent]:[]),s.extent.length||brushClear(brush),s.brushCallback(d),hasNewExtent?renderHighlight(this.parentNode,mergeIntervals):(mergeIntervals(),renderHighlight(this.parentNode))}else mergeIntervals();s.brushEndCallback(brush.filterSpecified?filter.getConsolidated():[])}))}function startAsc(a,b){return a[0]-b[0]}function brushClear(brush){brush.filterSpecified=!1,brush.svgBrush.extent=[[0,1]]}function dedupeRealRanges(intervals){for(var currentInterval,queue=intervals.slice(),result=[],current=queue.shift();current;){for(currentInterval=current.slice();(current=queue.shift())&&current[0]<=currentInterval[1];)currentInterval[1]=Math.max(currentInterval[1],current[1]);result.push(currentInterval)}return result}module.exports={makeBrush:function makeBrush(state,rangeSpecified,initialRange,brushStartCallback,brushCallback,brushEndCallback){var filter=function makeFilter(){var consolidated,bounds,filter=[];return{set:function(a){filter=a.map(function(d){return d.slice().sort(sortAsc)}).sort(startAsc),consolidated=dedupeRealRanges(filter),bounds=filter.reduce(function(p,n){return[Math.min(p[0],n[0]),Math.max(p[1],n[1])]},[1/0,-1/0])},get:function(){return filter.slice()},getConsolidated:function(){return consolidated},getBounds:function(){return bounds}}}();return filter.set(initialRange),{filter:filter,filterSpecified:rangeSpecified,svgBrush:{extent:[],brushStartCallback:brushStartCallback,brushCallback:function axisBrushMoved(callback){return function axisBrushMoved(dimension){var brush=dimension.brush,newExtent=function getBrushExtent(brush){return brush.svgBrush.extent.map(function(e){return e.slice()})}(brush).slice();brush.filter.set(newExtent),callback()}}(brushCallback),brushEndCallback:brushEndCallback}}},ensureAxisBrush:function ensureAxisBrush(axisOverlays){var axisBrush=axisOverlays.selectAll("."+c.cn.axisBrush).data(repeat,keyFun);axisBrush.enter().append("g").classed(c.cn.axisBrush,!0),function renderAxisBrush(axisBrush){var background=axisBrush.selectAll(".background").data(repeat);background.enter().append("rect").classed("background",!0).call(barHorizontalSetup).call(backgroundBarHorizontalSetup).style("pointer-events","auto").attr("transform","translate(0 "+c.verticalPadding+")"),background.call(attachDragBehavior).attr("height",function(d){return d.height-c.verticalPadding});var highlightShadow=axisBrush.selectAll(".highlight-shadow").data(repeat);highlightShadow.enter().append("line").classed("highlight-shadow",!0).attr("x",-c.bar.width/2).attr("stroke-width",c.bar.width+c.bar.strokeWidth).attr("stroke",c.bar.strokeColor).attr("opacity",c.bar.strokeOpacity).attr("stroke-linecap","butt"),highlightShadow.attr("y1",function(d){return d.height}).call(styleHighlight);var highlight=axisBrush.selectAll(".highlight").data(repeat);highlight.enter().append("line").classed("highlight",!0).attr("x",-c.bar.width/2).attr("stroke-width",c.bar.width-c.bar.strokeWidth).attr("stroke",c.bar.fillColor).attr("opacity",c.bar.fillOpacity).attr("stroke-linecap","butt"),highlight.attr("y1",function(d){return d.height}).call(styleHighlight)}(axisBrush)},cleanRanges:function cleanRanges(ranges,dimension){if(Array.isArray(ranges[0])?(ranges=ranges.map(function(ri){return ri.sort(sortAsc)}),ranges=dimension.multiselect?dedupeRealRanges(ranges.sort(startAsc)):[ranges[0]]):ranges=[ranges.sort(sortAsc)],dimension.tickvals){var sortedTickVals=dimension.tickvals.slice().sort(sortAsc);if(!(ranges=ranges.map(function(ri){var rSnapped=[ordinalScaleSnapLo(sortedTickVals,ri[0],[]),ordinalScaleSnapHi(sortedTickVals,ri[1],[])];if(rSnapped[1]>rSnapped[0])return rSnapped}).filter(function(ri){return ri})).length)return}return ranges.length>1?ranges:ranges[0]}}},{"../../lib":693,"../../lib/gup":690,"./constants":1e3,d3:147}],998:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),getModuleCalcData=_dereq_("../../plots/get_data").getModuleCalcData,parcoordsPlot=_dereq_("./plot"),xmlnsNamespaces=_dereq_("../../constants/xmlns_namespaces");exports.name="parcoords",exports.plot=function(gd){var calcData=getModuleCalcData(gd.calcdata,"parcoords")[0];calcData.length&&parcoordsPlot(gd,calcData)},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var hadParcoords=oldFullLayout._has&&oldFullLayout._has("parcoords"),hasParcoords=newFullLayout._has&&newFullLayout._has("parcoords");hadParcoords&&!hasParcoords&&(oldFullLayout._paperdiv.selectAll(".parcoords").remove(),oldFullLayout._glimages.selectAll("*").remove())},exports.toSVG=function(gd){var imageRoot=gd._fullLayout._glimages,root=d3.select(gd).selectAll(".svg-container");root.filter(function(d,i){return i===root.size()-1}).selectAll(".gl-canvas-context, .gl-canvas-focus").each(function canvasToImage(){var imageData=this.toDataURL("image/png");imageRoot.append("svg:image").attr({xmlns:xmlnsNamespaces.svg,"xlink:href":imageData,preserveAspectRatio:"none",x:0,y:0,width:this.width,height:this.height})}),window.setTimeout(function(){d3.selectAll("#filterBarPattern").attr("id","filterBarPattern")},60)}},{"../../constants/xmlns_namespaces":671,"../../plots/get_data":778,"./plot":1006,d3:147}],999:[function(_dereq_,module,exports){"use strict";var hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),calcColorscale=_dereq_("../../components/colorscale/calc"),Lib=_dereq_("../../lib"),wrap=_dereq_("../../lib/gup").wrap;module.exports=function calc(gd,trace){var cs=!!trace.line.colorscale&&Lib.isArrayOrTypedArray(trace.line.color),color=cs?trace.line.color:function constHalf(len){for(var out=new Array(len),i=0;i<len;i++)out[i]=.5;return out}(trace._length),cscale=cs?trace.line.colorscale:[[0,trace.line.color],[1,trace.line.color]];return hasColorscale(trace,"line")&&calcColorscale(trace,color,"line","c"),wrap({lineColor:color,cscale:cscale})}},{"../../components/colorscale/calc":575,"../../components/colorscale/has_colorscale":581,"../../lib":693,"../../lib/gup":690}],1000:[function(_dereq_,module,exports){"use strict";module.exports={maxDimensionCount:60,overdrag:45,verticalPadding:2,tickDistance:50,canvasPixelRatio:1,blockLineCount:5e3,layers:["contextLineLayer","focusLineLayer","pickLineLayer"],axisTitleOffset:28,axisExtentOffset:10,bar:{width:4,captureWidth:10,fillColor:"magenta",fillOpacity:1,snapDuration:150,snapRatio:.25,snapClose:.01,strokeColor:"white",strokeOpacity:1,strokeWidth:1,handleHeight:8,handleOpacity:1,handleOverlap:0},cn:{axisExtentText:"axis-extent-text",parcoordsLineLayers:"parcoords-line-layers",parcoordsLineLayer:"parcoords-lines",parcoords:"parcoords",parcoordsControlView:"parcoords-control-view",yAxis:"y-axis",axisOverlays:"axis-overlays",axis:"axis",axisHeading:"axis-heading",axisTitle:"axis-title",axisExtent:"axis-extent",axisExtentTop:"axis-extent-top",axisExtentTopText:"axis-extent-top-text",axisExtentBottom:"axis-extent-bottom",axisExtentBottomText:"axis-extent-bottom-text",axisBrush:"axis-brush"},id:{filterBarPattern:"filter-bar-pattern"}}},{}],1001:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),handleDomainDefaults=_dereq_("../../plots/domain").defaults,handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),axisBrush=_dereq_("./axisbrush"),maxDimensionCount=_dereq_("./constants").maxDimensionCount,mergeLength=_dereq_("./merge_length");function dimensionDefaults(dimensionIn,dimensionOut){function coerce(attr,dflt){return Lib.coerce(dimensionIn,dimensionOut,attributes.dimensions,attr,dflt)}var values=coerce("values"),visible=coerce("visible");if(values&&values.length||(visible=dimensionOut.visible=!1),visible){coerce("label"),coerce("tickvals"),coerce("ticktext"),coerce("tickformat"),coerce("range"),coerce("multiselect");var constraintRange=coerce("constraintrange");constraintRange&&(dimensionOut.constraintrange=axisBrush.cleanRanges(constraintRange,dimensionOut))}}module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var dimensionsIn=traceIn.dimensions;Array.isArray(dimensionsIn)&&dimensionsIn.length>maxDimensionCount&&(Lib.log("parcoords traces support up to "+maxDimensionCount+" dimensions at the moment"),dimensionsIn.splice(maxDimensionCount));var dimensions=handleArrayContainerDefaults(traceIn,traceOut,{name:"dimensions",handleItemDefaults:dimensionDefaults}),len=function handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce){var lineColor=coerce("line.color",defaultColor);if(hasColorscale(traceIn,"line")&&Lib.isArrayOrTypedArray(lineColor)){if(lineColor.length)return coerce("line.colorscale"),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"line.",cLetter:"c"}),lineColor.length;traceOut.line.color=defaultColor}return 1/0}(traceIn,traceOut,defaultColor,layout,coerce);handleDomainDefaults(traceOut,layout,coerce),Array.isArray(dimensions)&&dimensions.length||(traceOut.visible=!1),mergeLength(traceOut,dimensions,"values",len);var fontDflt={family:layout.font.family,size:Math.round(layout.font.size/1.2),color:layout.font.color};Lib.coerceFont(coerce,"labelfont",fontDflt),Lib.coerceFont(coerce,"tickfont",fontDflt),Lib.coerceFont(coerce,"rangefont",fontDflt)}},{"../../components/colorscale/defaults":577,"../../components/colorscale/has_colorscale":581,"../../lib":693,"../../plots/array_container_defaults":738,"../../plots/domain":767,"./attributes":996,"./axisbrush":997,"./constants":1e3,"./merge_length":1004}],1002:[function(_dereq_,module,exports){"use strict";var Parcoords={};Parcoords.attributes=_dereq_("./attributes"),Parcoords.supplyDefaults=_dereq_("./defaults"),Parcoords.calc=_dereq_("./calc"),Parcoords.plot=_dereq_("./plot"),Parcoords.colorbar={container:"line",min:"cmin",max:"cmax"},Parcoords.moduleType="trace",Parcoords.name="parcoords",Parcoords.basePlotModule=_dereq_("./base_plot"),Parcoords.categories=["gl","regl","noOpacity"],Parcoords.meta={},module.exports=Parcoords},{"./attributes":996,"./base_plot":998,"./calc":999,"./defaults":1001,"./plot":1006}],1003:[function(_dereq_,module,exports){"use strict";var glslify=_dereq_("glslify"),vertexShaderSource=glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec4 p0, p1, p2, p3,\n               p4, p5, p6, p7,\n               p8, p9, pa, pb,\n               pc, pd, pe;\n\nattribute vec4 pf;\n\nuniform mat4 dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D,\n             loA, hiA, loB, hiB, loC, hiC, loD, hiD;\n\nuniform vec2 resolution,\n             viewBoxPosition,\n             viewBoxSize;\n\nuniform sampler2D palette;\nuniform sampler2D mask;\nuniform float maskHeight;\n\nuniform vec2 colorClamp;\n\nvarying vec4 fragColor;\n\nvec4 unit_1 = vec4(1, 1, 1, 1);\n\nfloat val(mat4 p, mat4 v) {\n    return dot(matrixCompMult(p, v) * unit_1, unit_1);\n}\n\nfloat axisY(\n        float x,\n        mat4 d[4],\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D\n    ) {\n\n    float y1 = val(d[0], dim1A) + val(d[1], dim1B) + val(d[2], dim1C) + val(d[3], dim1D);\n    float y2 = val(d[0], dim2A) + val(d[1], dim2B) + val(d[2], dim2C) + val(d[3], dim2D);\n    return y1 * (1.0 - x) + y2 * x;\n}\n\nconst int bitsPerByte = 8;\n\nint mod2(int a) {\n    return a - 2 * (a / 2);\n}\n\nint mod8(int a) {\n    return a - 8 * (a / 8);\n}\n\nvec4 zero = vec4(0, 0, 0, 0);\nvec4 unit_0 = vec4(1, 1, 1, 1);\nvec2 xyProjection = vec2(1, 1);\n\nmat4 mclamp(mat4 m, mat4 lo, mat4 hi) {\n    return mat4(clamp(m[0], lo[0], hi[0]),\n                clamp(m[1], lo[1], hi[1]),\n                clamp(m[2], lo[2], hi[2]),\n                clamp(m[3], lo[3], hi[3]));\n}\n\nbool mshow(mat4 p, mat4 lo, mat4 hi) {\n    return mclamp(p, lo, hi) == p;\n}\n\nbool withinBoundingBox(\n        mat4 d[4],\n        mat4 loA, mat4 hiA, mat4 loB, mat4 hiB, mat4 loC, mat4 hiC, mat4 loD, mat4 hiD\n    ) {\n\n    return mshow(d[0], loA, hiA) &&\n           mshow(d[1], loB, hiB) &&\n           mshow(d[2], loC, hiC) &&\n           mshow(d[3], loD, hiD);\n}\n\nbool withinRasterMask(mat4 d[4], sampler2D mask, float height) {\n    bool result = true;\n    int bitInByteStepper;\n    float valY, valueY, scaleX;\n    int hit, bitmask, valX;\n    for(int i = 0; i < 4; i++) {\n        for(int j = 0; j < 4; j++) {\n            for(int k = 0; k < 4; k++) {\n                bitInByteStepper = mod8(j * 4 + k);\n                valX = i * 2 + j / 2;\n                valY = d[i][j][k];\n                valueY = valY * (height - 1.0) + 0.5;\n                scaleX = (float(valX) + 0.5) / 8.0;\n                hit = int(texture2D(mask, vec2(scaleX, (valueY + 0.5) / height))[3] * 255.0) / int(pow(2.0, float(bitInByteStepper)));\n                result = result && mod2(hit) == 1;\n            }\n        }\n    }\n    return result;\n}\n\nvec4 position(\n        float depth,\n        vec2 resolution, vec2 viewBoxPosition, vec2 viewBoxSize,\n        mat4 dims[4],\n        float signum,\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D,\n        mat4 loA, mat4 hiA, mat4 loB, mat4 hiB, mat4 loC, mat4 hiC, mat4 loD, mat4 hiD,\n        sampler2D mask, float maskHeight\n    ) {\n\n    float x = 0.5 * signum + 0.5;\n    float y = axisY(x, dims, dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D);\n\n    float show = float(\n                            withinBoundingBox(dims, loA, hiA, loB, hiB, loC, hiC, loD, hiD)\n                         && withinRasterMask(dims, mask, maskHeight)\n                      );\n\n    vec2 viewBoxXY = viewBoxPosition + viewBoxSize * vec2(x, y);\n    float depthOrHide = depth + 2.0 * (1.0 - show);\n\n    return vec4(\n        xyProjection * (2.0 * viewBoxXY / resolution - 1.0),\n        depthOrHide,\n        1.0\n    );\n}\n\nvoid main() {\n\n    float prominence = abs(pf[3]);\n\n    mat4 p[4];\n    p[0] = mat4(p0, p1, p2, p3);\n    p[1] = mat4(p4, p5, p6, p7);\n    p[2] = mat4(p8, p9, pa, pb);\n    p[3] = mat4(pc, pd, pe, abs(pf));\n\n    gl_Position = position(\n        1.0 - prominence,\n        resolution, viewBoxPosition, viewBoxSize,\n        p,\n        sign(pf[3]),\n        dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D,\n        loA, hiA, loB, hiB, loC, hiC, loD, hiD,\n        mask, maskHeight\n    );\n\n    float clampedColorIndex = clamp((prominence - colorClamp[0]) / (colorClamp[1] - colorClamp[0]), 0.0, 1.0);\n    fragColor = texture2D(palette, vec2((clampedColorIndex * 255.0 + 0.5) / 256.0, 0.5));\n}\n"]),contextShaderSource=glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec4 p0, p1, p2, p3,\n               p4, p5, p6, p7,\n               p8, p9, pa, pb,\n               pc, pd, pe;\n\nattribute vec4 pf;\n\nuniform mat4 dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D;\n\nuniform vec2 resolution,\n             viewBoxPosition,\n             viewBoxSize;\n\nuniform sampler2D palette;\n\nuniform vec2 colorClamp;\n\nvarying vec4 fragColor;\n\nvec2 xyProjection = vec2(1, 1);\n\nvec4 unit = vec4(1, 1, 1, 1);\n\nfloat val(mat4 p, mat4 v) {\n    return dot(matrixCompMult(p, v) * unit, unit);\n}\n\nfloat axisY(\n        float x,\n        mat4 d[4],\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D\n    ) {\n\n    float y1 = val(d[0], dim1A) + val(d[1], dim1B) + val(d[2], dim1C) + val(d[3], dim1D);\n    float y2 = val(d[0], dim2A) + val(d[1], dim2B) + val(d[2], dim2C) + val(d[3], dim2D);\n    return y1 * (1.0 - x) + y2 * x;\n}\n\nvec4 position(\n        float depth,\n        vec2 resolution, vec2 viewBoxPosition, vec2 viewBoxSize,\n        mat4 dims[4],\n        float signum,\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D\n    ) {\n\n    float x = 0.5 * signum + 0.5;\n    float y = axisY(x, dims, dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D);\n\n    vec2 viewBoxXY = viewBoxPosition + viewBoxSize * vec2(x, y);\n\n    return vec4(\n        xyProjection * (2.0 * viewBoxXY / resolution - 1.0),\n        depth,\n        1.0\n    );\n}\n\nvoid main() {\n\n    float prominence = abs(pf[3]);\n\n    mat4 p[4];\n    p[0] = mat4(p0, p1, p2, p3);\n    p[1] = mat4(p4, p5, p6, p7);\n    p[2] = mat4(p8, p9, pa, pb);\n    p[3] = mat4(pc, pd, pe, abs(pf));\n\n    gl_Position = position(\n        1.0 - prominence,\n        resolution, viewBoxPosition, viewBoxSize,\n        p,\n        sign(pf[3]),\n        dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D\n    );\n\n    float clampedColorIndex = clamp((prominence - colorClamp[0]) / (colorClamp[1] - colorClamp[0]), 0.0, 1.0);\n    fragColor = texture2D(palette, vec2((clampedColorIndex * 255.0 + 0.5) / 256.0, 0.5));\n}\n"]),pickVertexShaderSource=glslify(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec4 p0, p1, p2, p3,\n               p4, p5, p6, p7,\n               p8, p9, pa, pb,\n               pc, pd, pe;\n\nattribute vec4 pf;\n\nuniform mat4 dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D,\n             loA, hiA, loB, hiB, loC, hiC, loD, hiD;\n\nuniform vec2 resolution,\n             viewBoxPosition,\n             viewBoxSize;\n\nuniform sampler2D mask;\nuniform float maskHeight;\n\nuniform vec2 colorClamp;\n\nvarying vec4 fragColor;\n\nvec4 unit_1 = vec4(1, 1, 1, 1);\n\nfloat val(mat4 p, mat4 v) {\n    return dot(matrixCompMult(p, v) * unit_1, unit_1);\n}\n\nfloat axisY(\n        float x,\n        mat4 d[4],\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D\n    ) {\n\n    float y1 = val(d[0], dim1A) + val(d[1], dim1B) + val(d[2], dim1C) + val(d[3], dim1D);\n    float y2 = val(d[0], dim2A) + val(d[1], dim2B) + val(d[2], dim2C) + val(d[3], dim2D);\n    return y1 * (1.0 - x) + y2 * x;\n}\n\nconst int bitsPerByte = 8;\n\nint mod2(int a) {\n    return a - 2 * (a / 2);\n}\n\nint mod8(int a) {\n    return a - 8 * (a / 8);\n}\n\nvec4 zero = vec4(0, 0, 0, 0);\nvec4 unit_0 = vec4(1, 1, 1, 1);\nvec2 xyProjection = vec2(1, 1);\n\nmat4 mclamp(mat4 m, mat4 lo, mat4 hi) {\n    return mat4(clamp(m[0], lo[0], hi[0]),\n                clamp(m[1], lo[1], hi[1]),\n                clamp(m[2], lo[2], hi[2]),\n                clamp(m[3], lo[3], hi[3]));\n}\n\nbool mshow(mat4 p, mat4 lo, mat4 hi) {\n    return mclamp(p, lo, hi) == p;\n}\n\nbool withinBoundingBox(\n        mat4 d[4],\n        mat4 loA, mat4 hiA, mat4 loB, mat4 hiB, mat4 loC, mat4 hiC, mat4 loD, mat4 hiD\n    ) {\n\n    return mshow(d[0], loA, hiA) &&\n           mshow(d[1], loB, hiB) &&\n           mshow(d[2], loC, hiC) &&\n           mshow(d[3], loD, hiD);\n}\n\nbool withinRasterMask(mat4 d[4], sampler2D mask, float height) {\n    bool result = true;\n    int bitInByteStepper;\n    float valY, valueY, scaleX;\n    int hit, bitmask, valX;\n    for(int i = 0; i < 4; i++) {\n        for(int j = 0; j < 4; j++) {\n            for(int k = 0; k < 4; k++) {\n                bitInByteStepper = mod8(j * 4 + k);\n                valX = i * 2 + j / 2;\n                valY = d[i][j][k];\n                valueY = valY * (height - 1.0) + 0.5;\n                scaleX = (float(valX) + 0.5) / 8.0;\n                hit = int(texture2D(mask, vec2(scaleX, (valueY + 0.5) / height))[3] * 255.0) / int(pow(2.0, float(bitInByteStepper)));\n                result = result && mod2(hit) == 1;\n            }\n        }\n    }\n    return result;\n}\n\nvec4 position(\n        float depth,\n        vec2 resolution, vec2 viewBoxPosition, vec2 viewBoxSize,\n        mat4 dims[4],\n        float signum,\n        mat4 dim1A, mat4 dim2A, mat4 dim1B, mat4 dim2B, mat4 dim1C, mat4 dim2C, mat4 dim1D, mat4 dim2D,\n        mat4 loA, mat4 hiA, mat4 loB, mat4 hiB, mat4 loC, mat4 hiC, mat4 loD, mat4 hiD,\n        sampler2D mask, float maskHeight\n    ) {\n\n    float x = 0.5 * signum + 0.5;\n    float y = axisY(x, dims, dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D);\n\n    float show = float(\n                            withinBoundingBox(dims, loA, hiA, loB, hiB, loC, hiC, loD, hiD)\n                         && withinRasterMask(dims, mask, maskHeight)\n                      );\n\n    vec2 viewBoxXY = viewBoxPosition + viewBoxSize * vec2(x, y);\n    float depthOrHide = depth + 2.0 * (1.0 - show);\n\n    return vec4(\n        xyProjection * (2.0 * viewBoxXY / resolution - 1.0),\n        depthOrHide,\n        1.0\n    );\n}\n\nvoid main() {\n\n    float prominence = abs(pf[3]);\n\n    mat4 p[4];\n    p[0] = mat4(p0, p1, p2, p3);\n    p[1] = mat4(p4, p5, p6, p7);\n    p[2] = mat4(p8, p9, pa, pb);\n    p[3] = mat4(pc, pd, pe, abs(pf));\n\n    gl_Position = position(\n        1.0 - prominence,\n        resolution, viewBoxPosition, viewBoxSize,\n        p,\n        sign(pf[3]),\n        dim1A, dim2A, dim1B, dim2B, dim1C, dim2C, dim1D, dim2D,\n        loA, hiA, loB, hiB, loC, hiC, loD, hiD,\n        mask, maskHeight\n    );\n\n    fragColor = vec4(pf.rgb, 1.0);\n}\n"]),fragmentShaderSource=glslify(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec4 fragColor;\n\nvoid main() {\n    gl_FragColor = fragColor;\n}\n"]),Lib=_dereq_("../../lib"),depthLimitEpsilon=1e-6,filterEpsilon=1e-7,maskHeight=2048,gpuDimensionCount=64,sectionVertexCount=2,vec4NumberCount=4,bitsPerByte=8,channelCount=gpuDimensionCount/bitsPerByte,contextColor=[119,119,119],dummyPixel=new Uint8Array(4),pickPixel=new Uint8Array(4),paletteTextureConfig={shape:[256,1],format:"rgba",type:"uint8",mag:"nearest",min:"nearest"};function clear(regl,x,y,width,height){var gl=regl._gl;gl.enable(gl.SCISSOR_TEST),gl.scissor(x,y,width,height),regl.clear({color:[0,0,0,0],depth:1})}function renderBlock(regl,glAes,renderState,blockLineCount,sampleCount,item){var rafKey=item.key;renderState.drawCompleted||(!function ensureDraw(regl){regl.read({x:0,y:0,width:1,height:1,data:dummyPixel})}(regl),renderState.drawCompleted=!0),function render(blockNumber){var count;count=Math.min(blockLineCount,sampleCount-blockNumber*blockLineCount),item.offset=sectionVertexCount*blockNumber*blockLineCount,item.count=sectionVertexCount*count,0===blockNumber&&(window.cancelAnimationFrame(renderState.currentRafs[rafKey]),delete renderState.currentRafs[rafKey],clear(regl,item.scissorX,item.scissorY,item.scissorWidth,item.viewBoxSize[1])),renderState.clearOnly||(glAes(item),blockNumber*blockLineCount+count<sampleCount&&(renderState.currentRafs[rafKey]=window.requestAnimationFrame(function(){render(blockNumber+1)})),renderState.drawCompleted=!1)}(0)}function calcPickColor(j,rgbIndex){return(j>>>8*rgbIndex)%256/255}function makeVecAttr(sampleCount,points,vecIndex){var i,j,k,pointPairs=[];for(j=0;j<sampleCount;j++)for(k=0;k<sectionVertexCount;k++)for(i=0;i<vec4NumberCount;i++)pointPairs.push(points[j*gpuDimensionCount+vecIndex*vec4NumberCount+i]),vecIndex*vec4NumberCount+i===gpuDimensionCount-1&&k%2==0&&(pointPairs[pointPairs.length-1]*=-1);return pointPairs}module.exports=function(canvasGL,d){var model,vm,initialDims,sampleCount,maskTexture,context=d.context,pick=d.pick,regl=d.regl,renderState={currentRafs:{},drawCompleted:!0,clearOnly:!1},attributes=function emptyAttributes(regl){for(var attributes={},i=0;i<16;i++)attributes["p"+i.toString(16)]=regl.buffer({usage:"dynamic",type:"float",data:new Uint8Array(0)});return attributes}(regl),paletteTexture=regl.texture(paletteTextureConfig);update(d);var glAes=regl({profile:!1,blend:{enable:context,func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:1,dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},depth:{enable:!context,mask:!0,func:"less",range:[0,1]},cull:{enable:!0,face:"back"},scissor:{enable:!0,box:{x:regl.prop("scissorX"),y:regl.prop("scissorY"),width:regl.prop("scissorWidth"),height:regl.prop("scissorHeight")}},viewport:{x:regl.prop("viewportX"),y:regl.prop("viewportY"),width:regl.prop("viewportWidth"),height:regl.prop("viewportHeight")},dither:!1,vert:pick?pickVertexShaderSource:context?contextShaderSource:vertexShaderSource,frag:fragmentShaderSource,primitive:"lines",lineWidth:1,attributes:attributes,uniforms:{resolution:regl.prop("resolution"),viewBoxPosition:regl.prop("viewBoxPosition"),viewBoxSize:regl.prop("viewBoxSize"),dim1A:regl.prop("dim1A"),dim2A:regl.prop("dim2A"),dim1B:regl.prop("dim1B"),dim2B:regl.prop("dim2B"),dim1C:regl.prop("dim1C"),dim2C:regl.prop("dim2C"),dim1D:regl.prop("dim1D"),dim2D:regl.prop("dim2D"),loA:regl.prop("loA"),hiA:regl.prop("hiA"),loB:regl.prop("loB"),hiB:regl.prop("hiB"),loC:regl.prop("loC"),hiC:regl.prop("hiC"),loD:regl.prop("loD"),hiD:regl.prop("hiD"),palette:paletteTexture,mask:regl.prop("maskTexture"),maskHeight:regl.prop("maskHeight"),colorClamp:regl.prop("colorClamp")},offset:regl.prop("offset"),count:regl.prop("count")});function update(dNew){model=dNew.model,vm=dNew.viewModel,initialDims=vm.dimensions.slice(),sampleCount=initialDims[0]?initialDims[0].values.length:0;var lines=model.lines,color=pick?lines.color.map(function(_,i){return i/lines.color.length}):lines.color,contextOpacity=Math.max(1/255,Math.pow(1/color.length,1/3)),points=function makePoints(sampleCount,dimensions,color){for(var d,dimensionCount=dimensions.length,points=[],j=0;j<sampleCount;j++)for(var i=0;i<gpuDimensionCount;i++)points.push(i<dimensionCount?dimensions[i].paddedUnitValues[j]:i===gpuDimensionCount-1?(d=color[j],Math.max(depthLimitEpsilon,Math.min(1-depthLimitEpsilon,d))):i>=gpuDimensionCount-4?calcPickColor(j,gpuDimensionCount-2-i):.5);return points}(sampleCount,initialDims,color);!function setAttributes(attributes,sampleCount,points){for(var i=0;i<16;i++)attributes["p"+i.toString(16)](makeVecAttr(sampleCount,points,i))}(attributes,sampleCount,points),paletteTexture=regl.texture(Lib.extendFlat({data:function palette(unitToColor,context,opacity){for(var result=[],j=0;j<256;j++){var c=unitToColor(j/255);result.push((context?contextColor:c).concat(opacity))}return result}(model.unitToColor,context,Math.round(255*(context?contextOpacity:1)))},paletteTextureConfig))}var colorClamp=[0,1];var previousAxisOrder=[];function makeItem(i,ii,x,y,panelSizeX,canvasPanelSizeY,crossfilterDimensionIndex,I,leftmost,rightmost,constraints){var loHi,abcd,d,index,leftRight=[i,ii],dims=[0,1].map(function(){return[0,1,2,3].map(function(){return new Float32Array(16)})});for(loHi=0;loHi<2;loHi++)for(index=leftRight[loHi],abcd=0;abcd<4;abcd++)for(d=0;d<16;d++)dims[loHi][abcd][d]=d+16*abcd===index?1:0;var overdrag=model.lines.canvasOverdrag,domain=model.domain,canvasWidth=model.canvasWidth,canvasHeight=model.canvasHeight;return Lib.extendFlat({key:crossfilterDimensionIndex,resolution:[canvasWidth,canvasHeight],viewBoxPosition:[x+overdrag,y],viewBoxSize:[panelSizeX,canvasPanelSizeY],i:i,ii:ii,dim1A:dims[0][0],dim1B:dims[0][1],dim1C:dims[0][2],dim1D:dims[0][3],dim2A:dims[1][0],dim2B:dims[1][1],dim2C:dims[1][2],dim2D:dims[1][3],colorClamp:colorClamp,scissorX:(I===leftmost?0:x+overdrag)+(model.pad.l-overdrag)+model.layoutWidth*domain.x[0],scissorWidth:(I===rightmost?canvasWidth-x+overdrag:panelSizeX+.5)+(I===leftmost?x+overdrag:0),scissorY:y+model.pad.b+model.layoutHeight*domain.y[0],scissorHeight:canvasPanelSizeY,viewportX:model.pad.l-overdrag+model.layoutWidth*domain.x[0],viewportY:model.pad.b+model.layoutHeight*domain.y[0],viewportWidth:canvasWidth,viewportHeight:canvasHeight},constraints)}return{setColorDomain:function setColorDomain(unitDomain){colorClamp[0]=unitDomain[0],colorClamp[1]=unitDomain[1]},render:function renderGLParcoords(panels,setChanged,clearOnly){var I,leftmost,rightmost,panelCount=panels.length,lowestX=1/0,highestX=-1/0;for(I=0;I<panelCount;I++)panels[I].dim2.canvasX>highestX&&(highestX=panels[I].dim2.canvasX,rightmost=I),panels[I].dim1.canvasX<lowestX&&(lowestX=panels[I].dim1.canvasX,leftmost=I);0===panelCount&&clear(regl,0,0,model.canvasWidth,model.canvasHeight);var constraints=context?{}:function makeConstraints(){var loHi,abcd,d,lims=[0,1].map(function(){return[0,1,2,3].map(function(){return new Float32Array(16)})});for(loHi=0;loHi<2;loHi++)for(abcd=0;abcd<4;abcd++)for(d=0;d<16;d++){var lim,dimP=d+16*abcd;lim=dimP<initialDims.length?initialDims[dimP].brush.filter.getBounds()[loHi]:loHi,lims[loHi][abcd][d]=lim+(2*loHi-1)*filterEpsilon}function expandedPixelRange(dim,bounds){var maskHMinus=maskHeight-1;return[Math.max(0,Math.floor(bounds[0]*maskHMinus)),Math.min(maskHMinus,Math.ceil(bounds[1]*maskHMinus))]}for(var mask=Array.apply(null,new Array(maskHeight*channelCount)).map(function(){return 255}),dimIndex=0;dimIndex<initialDims.length;dimIndex++){var bitIndex=dimIndex%bitsPerByte,byteIndex=(dimIndex-bitIndex)/bitsPerByte,bitMask=Math.pow(2,bitIndex),dim=initialDims[dimIndex],ranges=dim.brush.filter.get();if(!(ranges.length<2))for(var prevEnd=expandedPixelRange(0,ranges[0])[1],ri=1;ri<ranges.length;ri++){for(var nextRange=expandedPixelRange(0,ranges[ri]),pi=prevEnd+1;pi<nextRange[0];pi++)mask[pi*channelCount+byteIndex]&=~bitMask;prevEnd=Math.max(prevEnd,nextRange[1])}}var textureData={shape:[channelCount,maskHeight],format:"alpha",type:"uint8",mag:"nearest",min:"nearest",data:mask};return maskTexture?maskTexture(textureData):maskTexture=regl.texture(textureData),{maskTexture:maskTexture,maskHeight:maskHeight,loA:lims[0][0],loB:lims[0][1],loC:lims[0][2],loD:lims[0][3],hiA:lims[1][0],hiB:lims[1][1],hiC:lims[1][2],hiD:lims[1][3]}}();for(I=0;I<panelCount;I++){var panel=panels[I],dim1=panel.dim1,i=dim1.crossfilterDimensionIndex,x=panel.canvasX,y=panel.canvasY,ii=panel.dim2.crossfilterDimensionIndex,panelSizeX=panel.panelSizeX,panelSizeY=panel.panelSizeY,xTo=x+panelSizeX;if(setChanged||!previousAxisOrder[i]||previousAxisOrder[i][0]!==x||previousAxisOrder[i][1]!==xTo){previousAxisOrder[i]=[x,xTo];var item=makeItem(i,ii,x,y,panelSizeX,panelSizeY,dim1.crossfilterDimensionIndex,I,leftmost,rightmost,constraints);renderState.clearOnly=clearOnly,renderBlock(regl,glAes,renderState,setChanged?model.lines.blockLineCount:sampleCount,sampleCount,item)}}},readPixel:function readPixel(canvasX,canvasY){return regl.read({x:canvasX,y:canvasY,width:1,height:1,data:pickPixel}),pickPixel},readPixels:function readPixels(canvasX,canvasY,width,height){var pixelArray=new Uint8Array(4*width*height);return regl.read({x:canvasX,y:canvasY,width:width,height:height,data:pixelArray}),pixelArray},destroy:function destroy(){for(var k in canvasGL.style["pointer-events"]="none",paletteTexture.destroy(),maskTexture&&maskTexture.destroy(),attributes)attributes[k].destroy()},update:update}}},{"../../lib":693,glslify:390}],1004:[function(_dereq_,module,exports){"use strict";module.exports=function(traceOut,dimensions,dataAttr,len){var i,dimi;for(len||(len=1/0),i=0;i<dimensions.length;i++)(dimi=dimensions[i]).visible&&(len=Math.min(len,dimi[dataAttr].length));for(len===1/0&&(len=0),traceOut._length=len,i=0;i<dimensions.length;i++)(dimi=dimensions[i]).visible&&(dimi._length=len);return len}},{}],1005:[function(_dereq_,module,exports){"use strict";var lineLayerMaker=_dereq_("./lines"),c=_dereq_("./constants"),Lib=_dereq_("../../lib"),d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),gup=_dereq_("../../lib/gup"),keyFun=gup.keyFun,repeat=gup.repeat,unwrap=gup.unwrap,brush=_dereq_("./axisbrush");function visible(dimension){return!("visible"in dimension)||dimension.visible}function dimensionExtent(dimension){var lo=dimension.range?dimension.range[0]:Lib.aggNums(Math.min,null,dimension.values,dimension._length),hi=dimension.range?dimension.range[1]:Lib.aggNums(Math.max,null,dimension.values,dimension._length);return!isNaN(lo)&&isFinite(lo)||(lo=0),!isNaN(hi)&&isFinite(hi)||(hi=0),lo===hi&&(0===lo?(lo-=1,hi+=1):(lo*=.9,hi*=1.1)),[lo,hi]}function someFiltersActive(view){return view.dimensions.some(function(p){return p.brush.filterSpecified})}function model(layout,d,i){var cd0=unwrap(d),trace=cd0.trace,lineColor=cd0.lineColor,cscale=cd0.cscale,line=trace.line,domain=trace.domain,dimensions=trace.dimensions,width=layout.width,labelFont=trace.labelfont,tickFont=trace.tickfont,rangeFont=trace.rangefont,lines=Lib.extendDeepNoArrays({},line,{color:lineColor.map(d3.scale.linear().domain(dimensionExtent({values:lineColor,range:[line.cmin,line.cmax],_length:trace._length}))),blockLineCount:c.blockLineCount,canvasOverdrag:c.overdrag*c.canvasPixelRatio}),groupWidth=Math.floor(width*(domain.x[1]-domain.x[0])),groupHeight=Math.floor(layout.height*(domain.y[1]-domain.y[0])),pad=layout.margin||{l:80,r:80,t:100,b:80},rowContentWidth=groupWidth,rowHeight=groupHeight;return{key:i,colCount:dimensions.filter(visible).length,dimensions:dimensions,tickDistance:c.tickDistance,unitToColor:function unitToColorScale(cscale){var colorStops=cscale.map(function(d){return d[0]}),colorTuples=cscale.map(function(d){return d3.rgb(d[1])}),polylinearUnitScales="rgb".split("").map(function(key){return d3.scale.linear().clamp(!0).domain(colorStops).range(colorTuples.map((n=key,function(o){return o[n]})));var n});return function(d){return polylinearUnitScales.map(function(s){return s(d)})}}(cscale),lines:lines,labelFont:labelFont,tickFont:tickFont,rangeFont:rangeFont,layoutWidth:width,layoutHeight:layout.height,domain:domain,translateX:domain.x[0]*width,translateY:layout.height-domain.y[1]*layout.height,pad:pad,canvasWidth:rowContentWidth*c.canvasPixelRatio+2*lines.canvasOverdrag,canvasHeight:rowHeight*c.canvasPixelRatio,width:rowContentWidth,height:rowHeight,canvasPixelRatio:c.canvasPixelRatio}}function viewModel(state,callbacks,model){var width=model.width,height=model.height,dimensions=model.dimensions,canvasPixelRatio=model.canvasPixelRatio,xScale=function(d){return width*d/Math.max(1,model.colCount-1)},unitPad=c.verticalPadding/height,_unitToPaddedPx=function unitToPaddedPx(height,padding){return d3.scale.linear().range([padding,height-padding])}(height,c.verticalPadding),viewModel={key:model.key,xScale:xScale,model:model,inBrushDrag:!1},uniqueKeys={};return viewModel.dimensions=dimensions.filter(visible).map(function(dimension,i){var domainToPaddedUnit=function domainToPaddedUnitScale(dimension,padFraction){return d3.scale.linear().domain(dimensionExtent(dimension)).range([padFraction,1-padFraction])}(dimension,unitPad),foundKey=uniqueKeys[dimension.label];uniqueKeys[dimension.label]=(foundKey||0)+1;var key=dimension.label+(foundKey?"__"+foundKey:""),specifiedConstraint=dimension.constraintrange,filterRangeSpecified=specifiedConstraint&&specifiedConstraint.length;filterRangeSpecified&&!Array.isArray(specifiedConstraint[0])&&(specifiedConstraint=[specifiedConstraint]);var filterRange=filterRangeSpecified?specifiedConstraint.map(function(d){return d.map(domainToPaddedUnit)}):[[0,1]],truncatedValues=dimension.values;truncatedValues.length>dimension._length&&(truncatedValues=truncatedValues.slice(0,dimension._length));var ticktext,tickvals=dimension.tickvals;function makeTickItem(v,i){return{val:v,text:ticktext[i]}}function sortTickItem(a,b){return a.val-b.val}if(Array.isArray(tickvals)&&tickvals.length){ticktext=dimension.ticktext,Array.isArray(ticktext)&&ticktext.length?ticktext.length>tickvals.length?ticktext=ticktext.slice(0,tickvals.length):tickvals.length>ticktext.length&&(tickvals=tickvals.slice(0,ticktext.length)):ticktext=tickvals.map(d3.format(dimension.tickformat));for(var j=1;j<tickvals.length;j++)if(tickvals[j]<tickvals[j-1]){for(var tickItems=tickvals.map(makeTickItem).sort(sortTickItem),k=0;k<tickvals.length;k++)tickvals[k]=tickItems[k].val,ticktext[k]=tickItems[k].text;break}}else tickvals=void 0;return{key:key,label:dimension.label,tickFormat:dimension.tickformat,tickvals:tickvals,ticktext:ticktext,ordinal:!!tickvals,multiselect:dimension.multiselect,xIndex:i,crossfilterDimensionIndex:i,visibleIndex:dimension._index,height:height,values:truncatedValues,paddedUnitValues:truncatedValues.map(domainToPaddedUnit),unitTickvals:tickvals&&tickvals.map(domainToPaddedUnit),xScale:xScale,x:xScale(i),canvasX:xScale(i)*canvasPixelRatio,unitToPaddedPx:_unitToPaddedPx,domainScale:function domainScale(height,padding,dimension,tickvals,ticktext){var extent=dimensionExtent(dimension);return tickvals?d3.scale.ordinal().domain(tickvals.map(function toText(formatter,texts){return texts?function(v,i){var text=texts[i];return null===text||void 0===text?formatter(v):text}:formatter}(d3.format(dimension.tickformat),ticktext))).range(tickvals.map(function(d){var unitVal=(d-extent[0])/(extent[1]-extent[0]);return height-padding+unitVal*(2*padding-height)})):d3.scale.linear().domain(extent).range([height-padding,padding])}(height,c.verticalPadding,dimension,tickvals,ticktext),ordinalScale:function ordinalScale(dimension){if(dimension.tickvals){var extent=dimensionExtent(dimension);return d3.scale.ordinal().domain(dimension.tickvals).range(dimension.tickvals.map(function(d){return(d-extent[0])/(extent[1]-extent[0])}))}}(dimension),parent:viewModel,model:model,brush:brush.makeBrush(state,filterRangeSpecified,filterRange,function(){state.linePickActive(!1)},function(){var p=viewModel;p.focusLayer&&p.focusLayer.render(p.panels,!0);var filtersActive=someFiltersActive(p);!state.contextShown()&&filtersActive?(p.contextLayer&&p.contextLayer.render(p.panels,!0),state.contextShown(!0)):state.contextShown()&&!filtersActive&&(p.contextLayer&&p.contextLayer.render(p.panels,!0,!0),state.contextShown(!1))},function(f){var p=viewModel;if(p.focusLayer.render(p.panels,!0),p.pickLayer&&p.pickLayer.render(p.panels,!0),state.linePickActive(!0),callbacks&&callbacks.filterChanged){var invScale=domainToPaddedUnit.invert,newRanges=f.map(function(r){return r.map(invScale).sort(Lib.sorterAsc)}).sort(function(a,b){return a[0]-b[0]});callbacks.filterChanged(p.key,dimension._index,newRanges)}})}}),viewModel}function styleExtentTexts(selection){selection.classed(c.cn.axisExtentText,!0).attr("text-anchor","middle").style("cursor","default").style("user-select","none")}module.exports=function(root,svg,parcoordsLineLayers,styledData,layout,callbacks){var state=function parcoordsInteractionState(){var linePickActive=!0,contextShown=!1;return{linePickActive:function(val){return arguments.length?linePickActive=!!val:linePickActive},contextShown:function(val){return arguments.length?contextShown=!!val:contextShown}}}(),vm=styledData.filter(function(d){return unwrap(d).trace.visible}).map(model.bind(0,layout)).map(viewModel.bind(0,state,callbacks));parcoordsLineLayers.each(function(d,i){return Lib.extendFlat(d,vm[i])});var parcoordsLineLayer=parcoordsLineLayers.selectAll(".gl-canvas").each(function(d){d.viewModel=vm[0],d.model=d.viewModel?d.viewModel.model:null}),lastHovered=null;parcoordsLineLayer.filter(function(d){return d.pick}).style("pointer-events","auto").on("mousemove",function(d){if(state.linePickActive()&&d.lineLayer&&callbacks&&callbacks.hover){var event=d3.event,cw=this.width,ch=this.height,pointer=d3.mouse(this),x=pointer[0],y=pointer[1];if(x<0||y<0||x>=cw||y>=ch)return;var pixel=d.lineLayer.readPixel(x,ch-1-y),found=0!==pixel[3],curveNumber=found?pixel[2]+256*(pixel[1]+256*pixel[0]):null,eventData={x:x,y:y,clientX:event.clientX,clientY:event.clientY,dataIndex:d.model.key,curveNumber:curveNumber};curveNumber!==lastHovered&&(found?callbacks.hover(eventData):callbacks.unhover&&callbacks.unhover(eventData),lastHovered=curveNumber)}}),parcoordsLineLayer.style("opacity",function(d){return d.pick?.01:1}),svg.style("background","rgba(255, 255, 255, 0)");var parcoordsControlOverlay=svg.selectAll("."+c.cn.parcoords).data(vm,keyFun);parcoordsControlOverlay.exit().remove(),parcoordsControlOverlay.enter().append("g").classed(c.cn.parcoords,!0).style("shape-rendering","crispEdges").style("pointer-events","none"),parcoordsControlOverlay.attr("transform",function(d){return"translate("+d.model.translateX+","+d.model.translateY+")"});var parcoordsControlView=parcoordsControlOverlay.selectAll("."+c.cn.parcoordsControlView).data(repeat,keyFun);parcoordsControlView.enter().append("g").classed(c.cn.parcoordsControlView,!0),parcoordsControlView.attr("transform",function(d){return"translate("+d.model.pad.l+","+d.model.pad.t+")"});var yAxis=parcoordsControlView.selectAll("."+c.cn.yAxis).data(function(vm){return vm.dimensions},keyFun);function updatePanelLayout(yAxis,vm){for(var panels=vm.panels||(vm.panels=[]),dimData=yAxis.data(),panelCount=dimData.length-1,p=0;p<panelCount;p++){var panel=panels[p]||(panels[p]={}),dim1=dimData[p],dim2=dimData[p+1];panel.dim1=dim1,panel.dim2=dim2,panel.canvasX=dim1.canvasX,panel.panelSizeX=dim2.canvasX-dim1.canvasX,panel.panelSizeY=vm.model.canvasHeight,panel.y=0,panel.canvasY=0}}yAxis.enter().append("g").classed(c.cn.yAxis,!0),parcoordsControlView.each(function(vm){updatePanelLayout(yAxis,vm)}),parcoordsLineLayer.each(function(d){d.viewModel&&(d.lineLayer?d.lineLayer.update(d):d.lineLayer=lineLayerMaker(this,d),d.viewModel[d.key]=d.lineLayer,d.lineLayer.render(d.viewModel.panels,!d.context))}),yAxis.attr("transform",function(d){return"translate("+d.xScale(d.xIndex)+", 0)"}),yAxis.call(d3.behavior.drag().origin(function(d){return d}).on("drag",function(d){var p=d.parent;state.linePickActive(!1),d.x=Math.max(-c.overdrag,Math.min(d.model.width+c.overdrag,d3.event.x)),d.canvasX=d.x*d.model.canvasPixelRatio,yAxis.sort(function(a,b){return a.x-b.x}).each(function(dd,i){dd.xIndex=i,dd.x=d===dd?dd.x:dd.xScale(dd.xIndex),dd.canvasX=dd.x*dd.model.canvasPixelRatio}),updatePanelLayout(yAxis,p),yAxis.filter(function(dd){return 0!==Math.abs(d.xIndex-dd.xIndex)}).attr("transform",function(d){return"translate("+d.xScale(d.xIndex)+", 0)"}),d3.select(this).attr("transform","translate("+d.x+", 0)"),yAxis.each(function(dd,i,ii){ii===d.parent.key&&(p.dimensions[i]=dd)}),p.contextLayer&&p.contextLayer.render(p.panels,!1,!someFiltersActive(p)),p.focusLayer.render&&p.focusLayer.render(p.panels)}).on("dragend",function(d){var p=d.parent;d.x=d.xScale(d.xIndex),d.canvasX=d.x*d.model.canvasPixelRatio,updatePanelLayout(yAxis,p),d3.select(this).attr("transform",function(d){return"translate("+d.x+", 0)"}),p.contextLayer&&p.contextLayer.render(p.panels,!1,!someFiltersActive(p)),p.focusLayer&&p.focusLayer.render(p.panels),p.pickLayer&&p.pickLayer.render(p.panels,!0),state.linePickActive(!0),callbacks&&callbacks.axesMoved&&callbacks.axesMoved(p.key,p.dimensions.map(function(dd){return dd.crossfilterDimensionIndex}))})),yAxis.exit().remove();var axisOverlays=yAxis.selectAll("."+c.cn.axisOverlays).data(repeat,keyFun);axisOverlays.enter().append("g").classed(c.cn.axisOverlays,!0),axisOverlays.selectAll("."+c.cn.axis).remove();var axis=axisOverlays.selectAll("."+c.cn.axis).data(repeat,keyFun);axis.enter().append("g").classed(c.cn.axis,!0),axis.each(function(d){var wantedTickCount=d.model.height/d.model.tickDistance,scale=d.domainScale,sdom=scale.domain();d3.select(this).call(d3.svg.axis().orient("left").tickSize(4).outerTickSize(2).ticks(wantedTickCount,d.tickFormat).tickValues(d.ordinal?sdom:null).tickFormat(d.ordinal?function(d){return d}:null).scale(scale)),Drawing.font(axis.selectAll("text"),d.model.tickFont)}),axis.selectAll(".domain, .tick>line").attr("fill","none").attr("stroke","black").attr("stroke-opacity",.25).attr("stroke-width","1px"),axis.selectAll("text").style("text-shadow","1px 1px 1px #fff, -1px -1px 1px #fff, 1px -1px 1px #fff, -1px 1px 1px #fff").style("cursor","default").style("user-select","none");var axisHeading=axisOverlays.selectAll("."+c.cn.axisHeading).data(repeat,keyFun);axisHeading.enter().append("g").classed(c.cn.axisHeading,!0);var axisTitle=axisHeading.selectAll("."+c.cn.axisTitle).data(repeat,keyFun);axisTitle.enter().append("text").classed(c.cn.axisTitle,!0).attr("text-anchor","middle").style("cursor","ew-resize").style("user-select","none").style("pointer-events","auto"),axisTitle.attr("transform","translate(0,"+-c.axisTitleOffset+")").text(function(d){return d.label}).each(function(d){Drawing.font(d3.select(this),d.model.labelFont)});var axisExtent=axisOverlays.selectAll("."+c.cn.axisExtent).data(repeat,keyFun);axisExtent.enter().append("g").classed(c.cn.axisExtent,!0);var axisExtentTop=axisExtent.selectAll("."+c.cn.axisExtentTop).data(repeat,keyFun);axisExtentTop.enter().append("g").classed(c.cn.axisExtentTop,!0),axisExtentTop.attr("transform","translate(0,"+-c.axisExtentOffset+")");var axisExtentTopText=axisExtentTop.selectAll("."+c.cn.axisExtentTopText).data(repeat,keyFun);function extremeText(d,isTop){if(d.ordinal)return"";var domain=d.domainScale.domain();return d3.format(d.tickFormat)(domain[isTop?domain.length-1:0])}axisExtentTopText.enter().append("text").classed(c.cn.axisExtentTopText,!0).call(styleExtentTexts),axisExtentTopText.text(function(d){return extremeText(d,!0)}).each(function(d){Drawing.font(d3.select(this),d.model.rangeFont)});var axisExtentBottom=axisExtent.selectAll("."+c.cn.axisExtentBottom).data(repeat,keyFun);axisExtentBottom.enter().append("g").classed(c.cn.axisExtentBottom,!0),axisExtentBottom.attr("transform",function(d){return"translate(0,"+(d.model.height+c.axisExtentOffset)+")"});var axisExtentBottomText=axisExtentBottom.selectAll("."+c.cn.axisExtentBottomText).data(repeat,keyFun);axisExtentBottomText.enter().append("text").classed(c.cn.axisExtentBottomText,!0).attr("dy","0.75em").call(styleExtentTexts),axisExtentBottomText.text(function(d){return extremeText(d)}).each(function(d){Drawing.font(d3.select(this),d.model.rangeFont)}),brush.ensureAxisBrush(axisOverlays)}},{"../../components/drawing":592,"../../lib":693,"../../lib/gup":690,"./axisbrush":997,"./constants":1e3,"./lines":1003,d3:147}],1006:[function(_dereq_,module,exports){"use strict";var parcoords=_dereq_("./parcoords"),prepareRegl=_dereq_("../../lib/prepare_regl");module.exports=function plot(gd,cdparcoords){var fullLayout=gd._fullLayout,svg=fullLayout._toppaper,root=fullLayout._paperdiv,container=fullLayout._glcontainer;if(prepareRegl(gd)){var gdDimensions={},gdDimensionsOriginalOrder={},size=fullLayout._size;cdparcoords.forEach(function(d,i){gdDimensions[i]=gd.data[i].dimensions,gdDimensionsOriginalOrder[i]=gd.data[i].dimensions.slice()});parcoords(root,svg,container,cdparcoords,{width:size.w,height:size.h,margin:{t:size.t,r:size.r,b:size.b,l:size.l}},{filterChanged:function(i,originalDimensionIndex,newRanges){var gdDimension=gdDimensionsOriginalOrder[i][originalDimensionIndex],newConstraints=newRanges.map(function(r){return r.slice()});newConstraints.length?(1===newConstraints.length&&(newConstraints=newConstraints[0]),gdDimension.constraintrange=newConstraints,newConstraints=[newConstraints]):(delete gdDimension.constraintrange,newConstraints=null);var restyleData={};restyleData["dimensions["+originalDimensionIndex+"].constraintrange"]=newConstraints,gd.emit("plotly_restyle",[restyleData,[i]])},hover:function(eventData){gd.emit("plotly_hover",eventData)},unhover:function(eventData){gd.emit("plotly_unhover",eventData)},axesMoved:function(i,visibleIndices){function visible(dimension){return!("visible"in dimension)||dimension.visible}function newIdx(visibleIndices,orig,dim){var origIndex=orig.indexOf(dim),currentIndex=visibleIndices.indexOf(origIndex);return-1===currentIndex&&(currentIndex+=orig.length),currentIndex}var orig=function sorter(orig){return function sorter(d1,d2){return newIdx(visibleIndices,orig,d1)-newIdx(visibleIndices,orig,d2)}}(gdDimensionsOriginalOrder[i].filter(visible));gdDimensions[i].sort(orig),gdDimensionsOriginalOrder[i].filter(function(d){return!visible(d)}).sort(function(d){return gdDimensionsOriginalOrder[i].indexOf(d)}).forEach(function(d){gdDimensions[i].splice(gdDimensions[i].indexOf(d),1),gdDimensions[i].splice(gdDimensionsOriginalOrder[i].indexOf(d),0,d)}),gd.emit("plotly_restyle")}})}}},{"../../lib/prepare_regl":707,"./parcoords":1005}],1007:[function(_dereq_,module,exports){"use strict";var colorAttrs=_dereq_("../../components/color/attributes"),fontAttrs=_dereq_("../../plots/font_attributes"),plotAttrs=_dereq_("../../plots/attributes"),domainAttrs=_dereq_("../../plots/domain").attributes,extendFlat=_dereq_("../../lib/extend").extendFlat,textFontAttrs=fontAttrs({editType:"calc",colorEditType:"style"});module.exports={labels:{valType:"data_array",editType:"calc"},label0:{valType:"number",dflt:0,editType:"calc"},dlabel:{valType:"number",dflt:1,editType:"calc"},values:{valType:"data_array",editType:"calc"},marker:{colors:{valType:"data_array",editType:"calc"},line:{color:{valType:"color",dflt:colorAttrs.defaultLine,arrayOk:!0,editType:"style"},width:{valType:"number",min:0,dflt:0,arrayOk:!0,editType:"style"},editType:"calc"},editType:"calc"},text:{valType:"data_array",editType:"calc"},hovertext:{valType:"string",dflt:"",arrayOk:!0,editType:"style"},scalegroup:{valType:"string",dflt:"",editType:"calc"},textinfo:{valType:"flaglist",flags:["label","text","value","percent"],extras:["none"],editType:"calc"},hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["label","text","value","percent","name"]}),textposition:{valType:"enumerated",values:["inside","outside","auto","none"],dflt:"auto",arrayOk:!0,editType:"calc"},textfont:extendFlat({},textFontAttrs,{}),insidetextfont:extendFlat({},textFontAttrs,{}),outsidetextfont:extendFlat({},textFontAttrs,{}),domain:domainAttrs({name:"pie",trace:!0,editType:"calc"}),hole:{valType:"number",min:0,max:1,dflt:0,editType:"calc"},sort:{valType:"boolean",dflt:!0,editType:"calc"},direction:{valType:"enumerated",values:["clockwise","counterclockwise"],dflt:"counterclockwise",editType:"calc"},rotation:{valType:"number",min:-360,max:360,dflt:0,editType:"calc"},pull:{valType:"number",min:0,max:1,dflt:0,arrayOk:!0,editType:"calc"}}},{"../../components/color/attributes":566,"../../lib/extend":682,"../../plots/attributes":739,"../../plots/domain":767,"../../plots/font_attributes":768}],1008:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),getModuleCalcData=_dereq_("../../plots/get_data").getModuleCalcData;exports.name="pie",exports.plot=function(gd){var Pie=Registry.getModule("pie"),cdPie=getModuleCalcData(gd.calcdata,Pie)[0];cdPie.length&&Pie.plot(gd,cdPie)},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var hadPie=oldFullLayout._has&&oldFullLayout._has("pie"),hasPie=newFullLayout._has&&newFullLayout._has("pie");hadPie&&!hasPie&&oldFullLayout._pielayer.selectAll("g.trace").remove()}},{"../../plots/get_data":778,"../../registry":825}],1009:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray,tinycolor=_dereq_("tinycolor2"),Color=_dereq_("../../components/color"),helpers=_dereq_("./helpers");exports.calc=function calc(gd,trace){var i,v,label,hidden,pt,vals=trace.values,hasVals=isArrayOrTypedArray(vals)&&vals.length,labels=trace.labels,colors=trace.marker.colors||[],cd=[],fullLayout=gd._fullLayout,colorMap=fullLayout._piecolormap,allThisTraceLabels={},vTotal=0,hiddenLabels=fullLayout.hiddenlabels||[];if(trace.dlabel)for(labels=new Array(vals.length),i=0;i<vals.length;i++)labels[i]=String(trace.label0+i*trace.dlabel);function pullColor(color,label){return!!color&&(!!(color=tinycolor(color)).isValid()&&(color=Color.addOpacity(color,color.getAlpha()),colorMap[label]||(colorMap[label]=color),color))}var seriesLen=(hasVals?vals:labels).length;for(i=0;i<seriesLen;i++){if(hasVals){if(v=vals[i],!isNumeric(v))continue;if((v=+v)<0)continue}else v=1;void 0!==(label=labels[i])&&""!==label||(label=i);var thisLabelIndex=allThisTraceLabels[label=String(label)];void 0===thisLabelIndex?(allThisTraceLabels[label]=cd.length,(hidden=-1!==hiddenLabels.indexOf(label))||(vTotal+=v),cd.push({v:v,label:label,color:pullColor(colors[i],label),i:i,pts:[i],hidden:hidden})):((pt=cd[thisLabelIndex]).v+=v,pt.pts.push(i),pt.hidden||(vTotal+=v),!1===pt.color&&colors[i]&&(pt.color=pullColor(colors[i],label)))}if(trace.sort&&cd.sort(function(a,b){return b.v-a.v}),cd[0]&&(cd[0].vTotal=vTotal),trace.textinfo&&"none"!==trace.textinfo){var thisText,hasLabel=-1!==trace.textinfo.indexOf("label"),hasText=-1!==trace.textinfo.indexOf("text"),hasValue=-1!==trace.textinfo.indexOf("value"),hasPercent=-1!==trace.textinfo.indexOf("percent"),separators=fullLayout.separators;for(i=0;i<cd.length;i++){if(pt=cd[i],thisText=hasLabel?[pt.label]:[],hasText){var texti=helpers.getFirstFilled(trace.text,pt.pts);texti&&thisText.push(texti)}hasValue&&thisText.push(helpers.formatPieValue(pt.v,separators)),hasPercent&&thisText.push(helpers.formatPiePercent(pt.v/vTotal,separators)),pt.text=thisText.join("<br>")}}return cd},exports.crossTraceCalc=function(gd){var fullLayout=gd._fullLayout,calcdata=gd.calcdata,pieColorWay=fullLayout.piecolorway,colorMap=fullLayout._piecolormap;fullLayout.extendpiecolors&&(pieColorWay=function generateExtendedColors(colorList){var i,colorString=JSON.stringify(colorList),pieColors=extendedColorWays[colorString];if(!pieColors){for(pieColors=colorList.slice(),i=0;i<colorList.length;i++)pieColors.push(tinycolor(colorList[i]).lighten(20).toHexString());for(i=0;i<colorList.length;i++)pieColors.push(tinycolor(colorList[i]).darken(20).toHexString());extendedColorWays[colorString]=pieColors}return pieColors}(pieColorWay));var i,j,cd,pt,dfltColorCount=0;for(i=0;i<calcdata.length;i++)if("pie"===(cd=calcdata[i])[0].trace.type)for(j=0;j<cd.length;j++)!1===(pt=cd[j]).color&&(colorMap[pt.label]?pt.color=colorMap[pt.label]:(colorMap[pt.label]=pt.color=pieColorWay[dfltColorCount%pieColorWay.length],dfltColorCount++))};var extendedColorWays={}},{"../../components/color":567,"../../lib":693,"./helpers":1012,"fast-isnumeric":213,tinycolor2:511}],1010:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attributes=_dereq_("./attributes"),handleDomainDefaults=_dereq_("../../plots/domain").defaults;module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var len,coerceFont=Lib.coerceFont,vals=coerce("values"),hasVals=Lib.isArrayOrTypedArray(vals),labels=coerce("labels");if(Array.isArray(labels)?(len=labels.length,hasVals&&(len=Math.min(len,vals.length))):hasVals&&(len=vals.length,coerce("label0"),coerce("dlabel")),len){traceOut._length=len,coerce("marker.line.width")&&coerce("marker.line.color"),coerce("marker.colors"),coerce("scalegroup");var textData=coerce("text"),textInfo=coerce("textinfo",Array.isArray(textData)?"text+percent":"percent");if(coerce("hovertext"),textInfo&&"none"!==textInfo){var textPosition=coerce("textposition"),hasBoth=Array.isArray(textPosition)||"auto"===textPosition,hasInside=hasBoth||"inside"===textPosition,hasOutside=hasBoth||"outside"===textPosition;if(hasInside||hasOutside){var dfltFont=coerceFont(coerce,"textfont",layout.font);hasInside&&coerceFont(coerce,"insidetextfont",dfltFont),hasOutside&&coerceFont(coerce,"outsidetextfont",dfltFont)}}handleDomainDefaults(traceOut,layout,coerce),coerce("hole"),coerce("sort"),coerce("direction"),coerce("rotation"),coerce("pull")}else traceOut.visible=!1}},{"../../lib":693,"../../plots/domain":767,"./attributes":1007}],1011:[function(_dereq_,module,exports){"use strict";var appendArrayMultiPointValues=_dereq_("../../components/fx/helpers").appendArrayMultiPointValues;module.exports=function eventData(pt,trace){var out={curveNumber:trace.index,pointNumbers:pt.pts,data:trace._input,fullData:trace,label:pt.label,color:pt.color,value:pt.v,v:pt.v};return 1===pt.pts.length&&(out.pointNumber=out.i=pt.pts[0]),appendArrayMultiPointValues(out,trace,pt.pts),out}},{"../../components/fx/helpers":606}],1012:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");exports.formatPiePercent=function formatPiePercent(v,separators){var vRounded=(100*v).toPrecision(3);return-1!==vRounded.lastIndexOf(".")&&(vRounded=vRounded.replace(/[.]?0+$/,"")),Lib.numSeparate(vRounded,separators)+"%"},exports.formatPieValue=function formatPieValue(v,separators){var vRounded=v.toPrecision(10);return-1!==vRounded.lastIndexOf(".")&&(vRounded=vRounded.replace(/[.]?0+$/,"")),Lib.numSeparate(vRounded,separators)},exports.getFirstFilled=function getFirstFilled(array,indices){if(Array.isArray(array))for(var i=0;i<indices.length;i++){var v=array[indices[i]];if(v||0===v)return v}},exports.castOption=function castOption(item,indices){return Array.isArray(item)?exports.getFirstFilled(item,indices):item||void 0}},{"../../lib":693}],1013:[function(_dereq_,module,exports){"use strict";var Pie={};Pie.attributes=_dereq_("./attributes"),Pie.supplyDefaults=_dereq_("./defaults"),Pie.supplyLayoutDefaults=_dereq_("./layout_defaults"),Pie.layoutAttributes=_dereq_("./layout_attributes");var calcModule=_dereq_("./calc");Pie.calc=calcModule.calc,Pie.crossTraceCalc=calcModule.crossTraceCalc,Pie.plot=_dereq_("./plot"),Pie.style=_dereq_("./style"),Pie.styleOne=_dereq_("./style_one"),Pie.moduleType="trace",Pie.name="pie",Pie.basePlotModule=_dereq_("./base_plot"),Pie.categories=["pie","showLegend"],Pie.meta={},module.exports=Pie},{"./attributes":1007,"./base_plot":1008,"./calc":1009,"./defaults":1010,"./layout_attributes":1014,"./layout_defaults":1015,"./plot":1016,"./style":1017,"./style_one":1018}],1014:[function(_dereq_,module,exports){"use strict";module.exports={hiddenlabels:{valType:"data_array",editType:"calc"},piecolorway:{valType:"colorlist",editType:"calc"},extendpiecolors:{valType:"boolean",dflt:!0,editType:"calc"}}},{}],1015:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes");module.exports=function supplyLayoutDefaults(layoutIn,layoutOut){function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)}coerce("hiddenlabels"),coerce("piecolorway",layoutOut.colorway),coerce("extendpiecolors")}},{"../../lib":693,"./layout_attributes":1014}],1016:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Fx=_dereq_("../../components/fx"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),Lib=_dereq_("../../lib"),svgTextUtils=_dereq_("../../lib/svg_text_utils"),helpers=_dereq_("./helpers"),eventData=_dereq_("./event_data");function getInscribedRadiusFraction(pt,cd0){if(pt.v===cd0.vTotal&&!cd0.trace.hole)return 1;var halfAngle=Math.PI*Math.min(pt.v/cd0.vTotal,.5);return Math.min(1/(1+1/Math.sin(halfAngle)),(1-cd0.trace.hole)/2)}function transformOutsideText(textBB,pt){var x=pt.pxmid[0],y=pt.pxmid[1],dx=textBB.width/2,dy=textBB.height/2;return x<0&&(dx*=-1),y<0&&(dy*=-1),{scale:1,rCenter:1,rotate:0,x:dx+Math.abs(dy)*(dx>0?1:-1)/2,y:dy/(1+x*x/(y*y)),outside:!0}}module.exports=function plot(gd,cdpie){var fullLayout=gd._fullLayout;!function scalePies(cdpie,plotSize){var pieBoxWidth,pieBoxHeight,i,j,cd0,trace,maxPull,scaleGroup,minPxPerValUnit,scaleGroups=[];for(i=0;i<cdpie.length;i++){if(cd0=cdpie[i][0],trace=cd0.trace,pieBoxWidth=plotSize.w*(trace.domain.x[1]-trace.domain.x[0]),pieBoxHeight=plotSize.h*(trace.domain.y[1]-trace.domain.y[0]),maxPull=trace.pull,Array.isArray(maxPull))for(maxPull=0,j=0;j<trace.pull.length;j++)trace.pull[j]>maxPull&&(maxPull=trace.pull[j]);cd0.r=Math.min(pieBoxWidth,pieBoxHeight)/(2+2*maxPull),cd0.cx=plotSize.l+plotSize.w*(trace.domain.x[1]+trace.domain.x[0])/2,cd0.cy=plotSize.t+plotSize.h*(2-trace.domain.y[1]-trace.domain.y[0])/2,trace.scalegroup&&-1===scaleGroups.indexOf(trace.scalegroup)&&scaleGroups.push(trace.scalegroup)}for(j=0;j<scaleGroups.length;j++){for(minPxPerValUnit=1/0,scaleGroup=scaleGroups[j],i=0;i<cdpie.length;i++)(cd0=cdpie[i][0]).trace.scalegroup===scaleGroup&&(minPxPerValUnit=Math.min(minPxPerValUnit,cd0.r*cd0.r/cd0.vTotal));for(i=0;i<cdpie.length;i++)(cd0=cdpie[i][0]).trace.scalegroup===scaleGroup&&(cd0.r=Math.sqrt(minPxPerValUnit*cd0.vTotal))}}(cdpie,fullLayout._size);var pieGroups=Lib.makeTraceGroups(fullLayout._pielayer,cdpie,"trace").each(function(cd){var pieGroup=d3.select(this),cd0=cd[0],trace=cd0.trace;!function setCoords(cd){var i,cdi,currentCoords,cd0=cd[0],trace=cd0.trace,currentAngle=trace.rotation*Math.PI/180,angleFactor=2*Math.PI/cd0.vTotal,firstPt="px0",lastPt="px1";if("counterclockwise"===trace.direction){for(i=0;i<cd.length&&cd[i].hidden;i++);if(i===cd.length)return;currentAngle+=angleFactor*cd[i].v,angleFactor*=-1,firstPt="px1",lastPt="px0"}function getCoords(angle){return[cd0.r*Math.sin(angle),-cd0.r*Math.cos(angle)]}for(currentCoords=getCoords(currentAngle),i=0;i<cd.length;i++)(cdi=cd[i]).hidden||(cdi[firstPt]=currentCoords,currentAngle+=angleFactor*cdi.v/2,cdi.pxmid=getCoords(currentAngle),cdi.midangle=currentAngle,currentAngle+=angleFactor*cdi.v/2,currentCoords=getCoords(currentAngle),cdi[lastPt]=currentCoords,cdi.largeArc=cdi.v>cd0.vTotal/2?1:0)}(cd),pieGroup.attr("stroke-linejoin","round"),pieGroup.each(function(){var slices=d3.select(this).selectAll("g.slice").data(cd);slices.enter().append("g").classed("slice",!0),slices.exit().remove();var quadrants=[[[],[]],[[],[]]],hasOutsideText=!1;slices.each(function(pt){if(pt.hidden)d3.select(this).selectAll("path,g").remove();else{pt.pointNumber=pt.i,pt.curveNumber=trace.index,quadrants[pt.pxmid[1]<0?0:1][pt.pxmid[0]<0?0:1].push(pt);var cx=cd0.cx,cy=cd0.cy,sliceTop=d3.select(this),slicePath=sliceTop.selectAll("path.surface").data([pt]),hasHoverLabel=!1,hasHoverEvent=!1;if(slicePath.enter().append("path").classed("surface",!0).style({"pointer-events":"all"}),sliceTop.select("path.textline").remove(),sliceTop.on("mouseover",function handleMouseOver(){var fullLayout2=gd._fullLayout,trace2=gd._fullData[trace.index];if(!gd._dragging&&!1!==fullLayout2.hovermode){var hoverinfo=trace2.hoverinfo;if(Array.isArray(hoverinfo)&&(hoverinfo=Fx.castHoverinfo({hoverinfo:[helpers.castOption(hoverinfo,pt.pts)],_module:trace._module},fullLayout2,0)),"all"===hoverinfo&&(hoverinfo="label+text+value+percent+name"),"none"!==hoverinfo&&"skip"!==hoverinfo&&hoverinfo){var rInscribed=getInscribedRadiusFraction(pt,cd0),hoverCenterX=cx+pt.pxmid[0]*(1-rInscribed),hoverCenterY=cy+pt.pxmid[1]*(1-rInscribed),separators=fullLayout.separators,thisText=[];if(-1!==hoverinfo.indexOf("label")&&thisText.push(pt.label),-1!==hoverinfo.indexOf("text")){var texti=helpers.castOption(trace2.hovertext||trace2.text,pt.pts);texti&&thisText.push(texti)}-1!==hoverinfo.indexOf("value")&&thisText.push(helpers.formatPieValue(pt.v,separators)),-1!==hoverinfo.indexOf("percent")&&thisText.push(helpers.formatPiePercent(pt.v/cd0.vTotal,separators));var hoverLabel=trace.hoverlabel,hoverFont=hoverLabel.font;Fx.loneHover({x0:hoverCenterX-rInscribed*cd0.r,x1:hoverCenterX+rInscribed*cd0.r,y:hoverCenterY,text:thisText.join("<br>"),name:-1!==hoverinfo.indexOf("name")?trace2.name:void 0,idealAlign:pt.pxmid[0]<0?"left":"right",color:helpers.castOption(hoverLabel.bgcolor,pt.pts)||pt.color,borderColor:helpers.castOption(hoverLabel.bordercolor,pt.pts),fontFamily:helpers.castOption(hoverFont.family,pt.pts),fontSize:helpers.castOption(hoverFont.size,pt.pts),fontColor:helpers.castOption(hoverFont.color,pt.pts)},{container:fullLayout2._hoverlayer.node(),outerContainer:fullLayout2._paper.node(),gd:gd}),hasHoverLabel=!0}gd.emit("plotly_hover",{points:[eventData(pt,trace2)],event:d3.event}),hasHoverEvent=!0}}).on("mouseout",function handleMouseOut(evt){var fullLayout2=gd._fullLayout,trace2=gd._fullData[trace.index];hasHoverEvent&&(evt.originalEvent=d3.event,gd.emit("plotly_unhover",{points:[eventData(pt,trace2)],event:d3.event}),hasHoverEvent=!1),hasHoverLabel&&(Fx.loneUnhover(fullLayout2._hoverlayer.node()),hasHoverLabel=!1)}).on("click",function handleClick(){var fullLayout2=gd._fullLayout,trace2=gd._fullData[trace.index];gd._dragging||!1===fullLayout2.hovermode||(gd._hoverdata=[eventData(pt,trace2)],Fx.click(gd,d3.event))}),trace.pull){var pull=+helpers.castOption(trace.pull,pt.pts)||0;pull>0&&(cx+=pull*pt.pxmid[0],cy+=pull*pt.pxmid[1])}pt.cxFinal=cx,pt.cyFinal=cy;var hole=trace.hole;if(pt.v===cd0.vTotal){var outerCircle="M"+(cx+pt.px0[0])+","+(cy+pt.px0[1])+arc(pt.px0,pt.pxmid,!0,1)+arc(pt.pxmid,pt.px0,!0,1)+"Z";hole?slicePath.attr("d","M"+(cx+hole*pt.px0[0])+","+(cy+hole*pt.px0[1])+arc(pt.px0,pt.pxmid,!1,hole)+arc(pt.pxmid,pt.px0,!1,hole)+"Z"+outerCircle):slicePath.attr("d",outerCircle)}else{var outerArc=arc(pt.px0,pt.px1,!0,1);if(hole){var rim=1-hole;slicePath.attr("d","M"+(cx+hole*pt.px1[0])+","+(cy+hole*pt.px1[1])+arc(pt.px1,pt.px0,!1,hole)+"l"+rim*pt.px0[0]+","+rim*pt.px0[1]+outerArc+"Z")}else slicePath.attr("d","M"+cx+","+cy+"l"+pt.px0[0]+","+pt.px0[1]+outerArc+"Z")}var textPosition=helpers.castOption(trace.textposition,pt.pts),sliceTextGroup=sliceTop.selectAll("g.slicetext").data(pt.text&&"none"!==textPosition?[0]:[]);sliceTextGroup.enter().append("g").classed("slicetext",!0),sliceTextGroup.exit().remove(),sliceTextGroup.each(function(){var sliceText=Lib.ensureSingle(d3.select(this),"text","",function(s){s.attr("data-notex",1)});sliceText.text(pt.text).attr({class:"slicetext",transform:"","text-anchor":"middle"}).call(Drawing.font,"outside"===textPosition?trace.outsidetextfont:trace.insidetextfont).call(svgTextUtils.convertToTspans,gd);var transform,textBB=Drawing.bBox(sliceText.node());"outside"===textPosition?transform=transformOutsideText(textBB,pt):(transform=function transformInsideText(textBB,pt,cd0){var textDiameter=Math.sqrt(textBB.width*textBB.width+textBB.height*textBB.height),textAspect=textBB.width/textBB.height,halfAngle=Math.PI*Math.min(pt.v/cd0.vTotal,.5),ring=1-cd0.trace.hole,rInscribed=getInscribedRadiusFraction(pt,cd0),transform={scale:rInscribed*cd0.r*2/textDiameter,rCenter:1-rInscribed,rotate:0};if(transform.scale>=1)return transform;var Qr=textAspect+1/(2*Math.tan(halfAngle)),maxHalfHeightRotRadial=cd0.r*Math.min(1/(Math.sqrt(Qr*Qr+.5)+Qr),ring/(Math.sqrt(textAspect*textAspect+ring/2)+textAspect)),radialTransform={scale:2*maxHalfHeightRotRadial/textBB.height,rCenter:Math.cos(maxHalfHeightRotRadial/cd0.r)-maxHalfHeightRotRadial*textAspect/cd0.r,rotate:(180/Math.PI*pt.midangle+720)%180-90},aspectInv=1/textAspect,Qt=aspectInv+1/(2*Math.tan(halfAngle)),maxHalfWidthTangential=cd0.r*Math.min(1/(Math.sqrt(Qt*Qt+.5)+Qt),ring/(Math.sqrt(aspectInv*aspectInv+ring/2)+aspectInv)),tangentialTransform={scale:2*maxHalfWidthTangential/textBB.width,rCenter:Math.cos(maxHalfWidthTangential/cd0.r)-maxHalfWidthTangential/textAspect/cd0.r,rotate:(180/Math.PI*pt.midangle+810)%180-90},rotatedTransform=tangentialTransform.scale>radialTransform.scale?tangentialTransform:radialTransform;return transform.scale<1&&rotatedTransform.scale>transform.scale?rotatedTransform:transform}(textBB,pt,cd0),"auto"===textPosition&&transform.scale<1&&(sliceText.call(Drawing.font,trace.outsidetextfont),trace.outsidetextfont.family===trace.insidetextfont.family&&trace.outsidetextfont.size===trace.insidetextfont.size||(textBB=Drawing.bBox(sliceText.node())),transform=transformOutsideText(textBB,pt)));var translateX=cx+pt.pxmid[0]*transform.rCenter+(transform.x||0),translateY=cy+pt.pxmid[1]*transform.rCenter+(transform.y||0);transform.outside&&(pt.yLabelMin=translateY-textBB.height/2,pt.yLabelMid=translateY,pt.yLabelMax=translateY+textBB.height/2,pt.labelExtraX=0,pt.labelExtraY=0,hasOutsideText=!0),sliceText.attr("transform","translate("+translateX+","+translateY+")"+(transform.scale<1?"scale("+transform.scale+")":"")+(transform.rotate?"rotate("+transform.rotate+")":"")+"translate("+-(textBB.left+textBB.right)/2+","+-(textBB.top+textBB.bottom)/2+")")})}function arc(start,finish,cw,scale){return"a"+scale*cd0.r+","+scale*cd0.r+" 0 "+pt.largeArc+(cw?" 1 ":" 0 ")+scale*(finish[0]-start[0])+","+scale*(finish[1]-start[1])}}),hasOutsideText&&function scootLabels(quadrants,trace){var xHalf,yHalf,equatorFirst,farthestX,farthestY,xDiffSign,yDiffSign,thisQuad,oppositeQuad,wholeSide,i,thisQuadOutside,firstOppositeOutsidePt;function topFirst(a,b){return a.pxmid[1]-b.pxmid[1]}function bottomFirst(a,b){return b.pxmid[1]-a.pxmid[1]}function scootOneLabel(thisPt,prevPt){prevPt||(prevPt={});var xBuffer,i,otherPt,otherOuterY,otherOuterX,newExtraX,prevOuterY=prevPt.labelExtraY+(yHalf?prevPt.yLabelMax:prevPt.yLabelMin),thisInnerY=yHalf?thisPt.yLabelMin:thisPt.yLabelMax,thisOuterY=yHalf?thisPt.yLabelMax:thisPt.yLabelMin,thisSliceOuterY=thisPt.cyFinal+farthestY(thisPt.px0[1],thisPt.px1[1]),newExtraY=prevOuterY-thisInnerY;if(newExtraY*yDiffSign>0&&(thisPt.labelExtraY=newExtraY),Array.isArray(trace.pull))for(i=0;i<wholeSide.length;i++)(otherPt=wholeSide[i])===thisPt||(helpers.castOption(trace.pull,thisPt.pts)||0)>=(helpers.castOption(trace.pull,otherPt.pts)||0)||((thisPt.pxmid[1]-otherPt.pxmid[1])*yDiffSign>0?(otherOuterY=otherPt.cyFinal+farthestY(otherPt.px0[1],otherPt.px1[1]),(newExtraY=otherOuterY-thisInnerY-thisPt.labelExtraY)*yDiffSign>0&&(thisPt.labelExtraY+=newExtraY)):(thisOuterY+thisPt.labelExtraY-thisSliceOuterY)*yDiffSign>0&&(xBuffer=3*xDiffSign*Math.abs(i-wholeSide.indexOf(thisPt)),otherOuterX=otherPt.cxFinal+farthestX(otherPt.px0[0],otherPt.px1[0]),(newExtraX=otherOuterX+xBuffer-(thisPt.cxFinal+thisPt.pxmid[0])-thisPt.labelExtraX)*xDiffSign>0&&(thisPt.labelExtraX+=newExtraX)))}for(yHalf=0;yHalf<2;yHalf++)for(equatorFirst=yHalf?topFirst:bottomFirst,farthestY=yHalf?Math.max:Math.min,yDiffSign=yHalf?1:-1,xHalf=0;xHalf<2;xHalf++){for(farthestX=xHalf?Math.max:Math.min,xDiffSign=xHalf?1:-1,(thisQuad=quadrants[yHalf][xHalf]).sort(equatorFirst),oppositeQuad=quadrants[1-yHalf][xHalf],wholeSide=oppositeQuad.concat(thisQuad),thisQuadOutside=[],i=0;i<thisQuad.length;i++)void 0!==thisQuad[i].yLabelMid&&thisQuadOutside.push(thisQuad[i]);for(firstOppositeOutsidePt=!1,i=0;yHalf&&i<oppositeQuad.length;i++)if(void 0!==oppositeQuad[i].yLabelMid){firstOppositeOutsidePt=oppositeQuad[i];break}for(i=0;i<thisQuadOutside.length;i++){var prevPt=i&&thisQuadOutside[i-1];firstOppositeOutsidePt&&!i&&(prevPt=firstOppositeOutsidePt),scootOneLabel(thisQuadOutside[i],prevPt)}}}(quadrants,trace),slices.each(function(pt){if(pt.labelExtraX||pt.labelExtraY){var sliceTop=d3.select(this),sliceText=sliceTop.select("g.slicetext text");sliceText.attr("transform","translate("+pt.labelExtraX+","+pt.labelExtraY+")"+sliceText.attr("transform"));var lineStartX=pt.cxFinal+pt.pxmid[0],textLinePath="M"+lineStartX+","+(pt.cyFinal+pt.pxmid[1]),finalX=(pt.yLabelMax-pt.yLabelMin)*(pt.pxmid[0]<0?-1:1)/4;if(pt.labelExtraX){var yFromX=pt.labelExtraX*pt.pxmid[1]/pt.pxmid[0],yNet=pt.yLabelMid+pt.labelExtraY-(pt.cyFinal+pt.pxmid[1]);Math.abs(yFromX)>Math.abs(yNet)?textLinePath+="l"+yNet*pt.pxmid[0]/pt.pxmid[1]+","+yNet+"H"+(lineStartX+pt.labelExtraX+finalX):textLinePath+="l"+pt.labelExtraX+","+yFromX+"v"+(yNet-yFromX)+"h"+finalX}else textLinePath+="V"+(pt.yLabelMid+pt.labelExtraY)+"h"+finalX;sliceTop.append("path").classed("textline",!0).call(Color.stroke,trace.outsidetextfont.color).attr({"stroke-width":Math.min(2,trace.outsidetextfont.size/8),d:textLinePath,fill:"none"})}})})});setTimeout(function(){pieGroups.selectAll("tspan").each(function(){var s=d3.select(this);s.attr("dy")&&s.attr("dy",s.attr("dy"))})},0)}},{"../../components/color":567,"../../components/drawing":592,"../../components/fx":609,"../../lib":693,"../../lib/svg_text_utils":718,"./event_data":1011,"./helpers":1012,d3:147}],1017:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),styleOne=_dereq_("./style_one");module.exports=function style(gd){gd._fullLayout._pielayer.selectAll(".trace").each(function(cd){var trace=cd[0].trace,traceSelection=d3.select(this);traceSelection.style({opacity:trace.opacity}),traceSelection.selectAll("path.surface").each(function(pt){d3.select(this).call(styleOne,pt,trace)})})}},{"./style_one":1018,d3:147}],1018:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),castOption=_dereq_("./helpers").castOption;module.exports=function styleOne(s,pt,trace){var line=trace.marker.line,lineColor=castOption(line.color,pt.pts)||Color.defaultLine,lineWidth=castOption(line.width,pt.pts)||0;s.style({"stroke-width":lineWidth}).call(Color.fill,pt.color).call(Color.stroke,lineColor)}},{"../../components/color":567,"./helpers":1012}],1019:[function(_dereq_,module,exports){"use strict";var scatterglAttrs=_dereq_("../scatter/attributes");module.exports={x:scatterglAttrs.x,y:scatterglAttrs.y,xy:{valType:"data_array",editType:"calc"},indices:{valType:"data_array",editType:"calc"},xbounds:{valType:"data_array",editType:"calc"},ybounds:{valType:"data_array",editType:"calc"},text:scatterglAttrs.text,marker:{color:{valType:"color",arrayOk:!1,editType:"calc"},opacity:{valType:"number",min:0,max:1,dflt:1,arrayOk:!1,editType:"calc"},blend:{valType:"boolean",dflt:null,editType:"calc"},sizemin:{valType:"number",min:.1,max:2,dflt:.5,editType:"calc"},sizemax:{valType:"number",min:.1,dflt:20,editType:"calc"},border:{color:{valType:"color",arrayOk:!1,editType:"calc"},arearatio:{valType:"number",min:0,max:1,dflt:0,editType:"calc"},editType:"calc"},editType:"calc"}}},{"../scatter/attributes":1032}],1020:[function(_dereq_,module,exports){"use strict";var createPointCloudRenderer=_dereq_("gl-pointcloud2d"),str2RGBArray=_dereq_("../../lib/str2rgbarray"),findExtremes=_dereq_("../../plots/cartesian/autorange").findExtremes,getTraceColor=_dereq_("../scatter/get_trace_color");function Pointcloud(scene,uid){this.scene=scene,this.uid=uid,this.type="pointcloud",this.pickXData=[],this.pickYData=[],this.xData=[],this.yData=[],this.textLabels=[],this.color="rgb(0, 0, 0)",this.name="",this.hoverinfo="all",this.idToIndex=new Int32Array(0),this.bounds=[0,0,0,0],this.pointcloudOptions={positions:new Float32Array(0),idToIndex:this.idToIndex,sizemin:.5,sizemax:12,color:[0,0,0,1],areaRatio:1,borderColor:[0,0,0,1]},this.pointcloud=createPointCloudRenderer(scene.glplot,this.pointcloudOptions),this.pointcloud._trace=this}var proto=Pointcloud.prototype;proto.handlePick=function(pickResult){var index=this.idToIndex[pickResult.pointId];return{trace:this,dataCoord:pickResult.dataCoord,traceCoord:this.pickXYData?[this.pickXYData[2*index],this.pickXYData[2*index+1]]:[this.pickXData[index],this.pickYData[index]],textLabel:Array.isArray(this.textLabels)?this.textLabels[index]:this.textLabels,color:this.color,name:this.name,pointIndex:index,hoverinfo:this.hoverinfo}},proto.update=function(options){this.index=options.index,this.textLabels=options.text,this.name=options.name,this.hoverinfo=options.hoverinfo,this.bounds=[1/0,1/0,-1/0,-1/0],this.updateFast(options),this.color=getTraceColor(options,{})},proto.updateFast=function(options){var len,idToIndex,positions,xx,yy,i,x=this.xData=this.pickXData=options.x,y=this.yData=this.pickYData=options.y,xy=this.pickXYData=options.xy,userBounds=options.xbounds&&options.ybounds,index=options.indices,bounds=this.bounds;if(xy){if(positions=xy,len=xy.length>>>1,userBounds)bounds[0]=options.xbounds[0],bounds[2]=options.xbounds[1],bounds[1]=options.ybounds[0],bounds[3]=options.ybounds[1];else for(i=0;i<len;i++)xx=positions[2*i],yy=positions[2*i+1],xx<bounds[0]&&(bounds[0]=xx),xx>bounds[2]&&(bounds[2]=xx),yy<bounds[1]&&(bounds[1]=yy),yy>bounds[3]&&(bounds[3]=yy);if(index)idToIndex=index;else for(idToIndex=new Int32Array(len),i=0;i<len;i++)idToIndex[i]=i}else for(len=x.length,positions=new Float32Array(2*len),idToIndex=new Int32Array(len),i=0;i<len;i++)xx=x[i],yy=y[i],idToIndex[i]=i,positions[2*i]=xx,positions[2*i+1]=yy,xx<bounds[0]&&(bounds[0]=xx),xx>bounds[2]&&(bounds[2]=xx),yy<bounds[1]&&(bounds[1]=yy),yy>bounds[3]&&(bounds[3]=yy);this.idToIndex=idToIndex,this.pointcloudOptions.idToIndex=idToIndex,this.pointcloudOptions.positions=positions;var markerColor=str2RGBArray(options.marker.color),borderColor=str2RGBArray(options.marker.border.color),opacity=options.opacity*options.marker.opacity;markerColor[3]*=opacity,this.pointcloudOptions.color=markerColor;var blend=options.marker.blend;if(null===blend){blend=x.length<100||y.length<100}this.pointcloudOptions.blend=blend,borderColor[3]*=opacity,this.pointcloudOptions.borderColor=borderColor;var markerSizeMin=options.marker.sizemin,markerSizeMax=Math.max(options.marker.sizemax,options.marker.sizemin);this.pointcloudOptions.sizeMin=markerSizeMin,this.pointcloudOptions.sizeMax=markerSizeMax,this.pointcloudOptions.areaRatio=options.marker.border.arearatio,this.pointcloud.update(this.pointcloudOptions);var xa=this.scene.xaxis,ya=this.scene.yaxis,pad=markerSizeMax/2||.5;options._extremes[xa._id]=findExtremes(xa,[bounds[0],bounds[2]],{ppad:pad}),options._extremes[ya._id]=findExtremes(ya,[bounds[1],bounds[3]],{ppad:pad})},proto.dispose=function(){this.pointcloud.dispose()},module.exports=function createPointcloud(scene,data){var plot=new Pointcloud(scene,data.uid);return plot.update(data),plot}},{"../../lib/str2rgbarray":717,"../../plots/cartesian/autorange":741,"../scatter/get_trace_color":1042,"gl-pointcloud2d":278}],1021:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}coerce("x"),coerce("y"),coerce("xbounds"),coerce("ybounds"),traceIn.xy&&traceIn.xy instanceof Float32Array&&(traceOut.xy=traceIn.xy),traceIn.indices&&traceIn.indices instanceof Int32Array&&(traceOut.indices=traceIn.indices),coerce("text"),coerce("marker.color",defaultColor),coerce("marker.opacity"),coerce("marker.blend"),coerce("marker.sizemin"),coerce("marker.sizemax"),coerce("marker.border.color",defaultColor),coerce("marker.border.arearatio"),traceOut._length=null}},{"../../lib":693,"./attributes":1019}],1022:[function(_dereq_,module,exports){"use strict";var pointcloud={};pointcloud.attributes=_dereq_("./attributes"),pointcloud.supplyDefaults=_dereq_("./defaults"),pointcloud.calc=_dereq_("../scatter3d/calc"),pointcloud.plot=_dereq_("./convert"),pointcloud.moduleType="trace",pointcloud.name="pointcloud",pointcloud.basePlotModule=_dereq_("../../plots/gl2d"),pointcloud.categories=["gl","gl2d","showLegend"],pointcloud.meta={},module.exports=pointcloud},{"../../plots/gl2d":781,"../scatter3d/calc":1060,"./attributes":1019,"./convert":1020,"./defaults":1021}],1023:[function(_dereq_,module,exports){"use strict";var fontAttrs=_dereq_("../../plots/font_attributes"),plotAttrs=_dereq_("../../plots/attributes"),colorAttrs=_dereq_("../../components/color/attributes"),fxAttrs=_dereq_("../../components/fx/attributes"),domainAttrs=_dereq_("../../plots/domain").attributes,extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll;module.exports=overrideAll({hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["label","text","value","percent","name"]}),hoverlabel:fxAttrs.hoverlabel,domain:domainAttrs({name:"sankey",trace:!0}),orientation:{valType:"enumerated",values:["v","h"],dflt:"h"},valueformat:{valType:"string",dflt:".3s"},valuesuffix:{valType:"string",dflt:""},arrangement:{valType:"enumerated",values:["snap","perpendicular","freeform","fixed"],dflt:"snap"},textfont:fontAttrs({}),node:{label:{valType:"data_array",dflt:[]},color:{valType:"color",arrayOk:!0},line:{color:{valType:"color",dflt:colorAttrs.defaultLine,arrayOk:!0},width:{valType:"number",min:0,dflt:.5,arrayOk:!0}},pad:{valType:"number",arrayOk:!1,min:0,dflt:20},thickness:{valType:"number",arrayOk:!1,min:1,dflt:20}},link:{label:{valType:"data_array",dflt:[]},color:{valType:"color",arrayOk:!0},line:{color:{valType:"color",dflt:colorAttrs.defaultLine,arrayOk:!0},width:{valType:"number",min:0,dflt:0,arrayOk:!0}},source:{valType:"data_array",dflt:[]},target:{valType:"data_array",dflt:[]},value:{valType:"data_array",dflt:[]}}},"calc","nested")},{"../../components/color/attributes":566,"../../components/fx/attributes":601,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739,"../../plots/domain":767,"../../plots/font_attributes":768}],1024:[function(_dereq_,module,exports){"use strict";var overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,getModuleCalcData=_dereq_("../../plots/get_data").getModuleCalcData,plot=_dereq_("./plot"),fxAttrs=_dereq_("../../components/fx/layout_attributes");exports.name="sankey",exports.baseLayoutAttrOverrides=overrideAll({hoverlabel:fxAttrs.hoverlabel},"plot","nested"),exports.plot=function(gd){var calcData=getModuleCalcData(gd.calcdata,"sankey")[0];plot(gd,calcData)},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var hadPlot=oldFullLayout._has&&oldFullLayout._has("sankey"),hasPlot=newFullLayout._has&&newFullLayout._has("sankey");hadPlot&&!hasPlot&&oldFullLayout._paperdiv.selectAll(".sankey").remove()}},{"../../components/fx/layout_attributes":610,"../../plot_api/edit_types":725,"../../plots/get_data":778,"./plot":1029}],1025:[function(_dereq_,module,exports){"use strict";var tarjan=_dereq_("strongly-connected-components"),Lib=_dereq_("../../lib"),wrap=_dereq_("../../lib/gup").wrap;module.exports=function calc(gd,trace){return function circularityPresent(nodeList,sources,targets){for(var nodeLen=nodeList.length,nodes=Lib.init2dArray(nodeLen,0),i=0;i<Math.min(sources.length,targets.length);i++)if(Lib.isIndex(sources[i],nodeLen)&&Lib.isIndex(targets[i],nodeLen)){if(sources[i]===targets[i])return!0;nodes[sources[i]].push(targets[i])}return tarjan(nodes).components.some(function(c){return c.length>1})}(trace.node.label,trace.link.source,trace.link.target)&&(Lib.error("Circularity is present in the Sankey data. Removing all nodes and links."),trace.link.label=[],trace.link.source=[],trace.link.target=[],trace.link.value=[],trace.link.color=[],trace.node.label=[],trace.node.color=[]),wrap({link:trace.link,node:trace.node})}},{"../../lib":693,"../../lib/gup":690,"strongly-connected-components":503}],1026:[function(_dereq_,module,exports){"use strict";module.exports={nodeTextOffsetHorizontal:4,nodeTextOffsetVertical:3,nodePadAcross:10,sankeyIterations:50,forceIterations:5,forceTicksPerFrame:10,duration:500,ease:"cubic-in-out",cn:{sankey:"sankey",sankeyLinks:"sankey-links",sankeyLink:"sankey-link",sankeyNodeSet:"sankey-node-set",sankeyNode:"sankey-node",nodeRect:"node-rect",nodeCapture:"node-capture",nodeCentered:"node-entered",nodeLabelGuide:"node-label-guide",nodeLabel:"node-label",nodeLabelTextPath:"node-label-text-path"}}},{}],1027:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attributes=_dereq_("./attributes"),Color=_dereq_("../../components/color"),tinycolor=_dereq_("tinycolor2"),handleDomainDefaults=_dereq_("../../plots/domain").defaults;module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}coerce("node.label"),coerce("node.pad"),coerce("node.thickness"),coerce("node.line.color"),coerce("node.line.width");var colors=layout.colorway;coerce("node.color",traceOut.node.label.map(function(d,i){return Color.addOpacity(function(i){return colors[i%colors.length]}(i),.8)})),coerce("link.label"),coerce("link.source"),coerce("link.target"),coerce("link.value"),coerce("link.line.color"),coerce("link.line.width"),coerce("link.color",traceOut.link.value.map(function(){return tinycolor(layout.paper_bgcolor).getLuminance()<.333?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.2)"})),handleDomainDefaults(traceOut,layout,coerce),coerce("orientation"),coerce("valueformat"),coerce("valuesuffix"),coerce("arrangement"),Lib.coerceFont(coerce,"textfont",Lib.extendFlat({},layout.font)),traceOut._length=null}},{"../../components/color":567,"../../lib":693,"../../plots/domain":767,"./attributes":1023,tinycolor2:511}],1028:[function(_dereq_,module,exports){"use strict";var Plot={};Plot.attributes=_dereq_("./attributes"),Plot.supplyDefaults=_dereq_("./defaults"),Plot.calc=_dereq_("./calc"),Plot.plot=_dereq_("./plot"),Plot.moduleType="trace",Plot.name="sankey",Plot.basePlotModule=_dereq_("./base_plot"),Plot.categories=["noOpacity"],Plot.meta={},module.exports=Plot},{"./attributes":1023,"./base_plot":1024,"./calc":1025,"./defaults":1027,"./plot":1029}],1029:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),render=_dereq_("./render"),Fx=_dereq_("../../components/fx"),Color=_dereq_("../../components/color"),Lib=_dereq_("../../lib"),cn=_dereq_("./constants").cn,_=Lib._;function renderableValuePresent(d){return""!==d}function ownTrace(selection,d){return selection.filter(function(s){return s.key===d.traceId})}function makeTranslucent(element,alpha){d3.select(element).select("path").style("fill-opacity",alpha),d3.select(element).select("rect").style("fill-opacity",alpha)}function makeTextContrasty(element){d3.select(element).select("text.name").style("fill","black")}function relatedLinks(d){return function(l){return-1!==d.node.sourceLinks.indexOf(l.link)||-1!==d.node.targetLinks.indexOf(l.link)}}function relatedNodes(l){return function(d){return-1!==d.node.sourceLinks.indexOf(l.link)||-1!==d.node.targetLinks.indexOf(l.link)}}function nodeHoveredStyle(sankeyNode,d,sankey){d&&sankey&&ownTrace(sankey,d).selectAll("."+cn.sankeyLink).filter(relatedLinks(d)).call(linkHoveredStyle.bind(0,d,sankey,!1))}function nodeNonHoveredStyle(sankeyNode,d,sankey){d&&sankey&&ownTrace(sankey,d).selectAll("."+cn.sankeyLink).filter(relatedLinks(d)).call(linkNonHoveredStyle.bind(0,d,sankey,!1))}function linkHoveredStyle(d,sankey,visitNodes,sankeyLink){var label=sankeyLink.datum().link.label;sankeyLink.style("fill-opacity",.4),label&&ownTrace(sankey,d).selectAll("."+cn.sankeyLink).filter(function(l){return l.link.label===label}).style("fill-opacity",.4),visitNodes&&ownTrace(sankey,d).selectAll("."+cn.sankeyNode).filter(relatedNodes(d)).call(nodeHoveredStyle)}function linkNonHoveredStyle(d,sankey,visitNodes,sankeyLink){var label=sankeyLink.datum().link.label;sankeyLink.style("fill-opacity",function(d){return d.tinyColorAlpha}),label&&ownTrace(sankey,d).selectAll("."+cn.sankeyLink).filter(function(l){return l.link.label===label}).style("fill-opacity",function(d){return d.tinyColorAlpha}),visitNodes&&ownTrace(sankey,d).selectAll(cn.sankeyNode).filter(relatedNodes(d)).call(nodeNonHoveredStyle)}function castHoverOption(trace,attr){var labelOpts=trace.hoverlabel||{},val=Lib.nestedProperty(labelOpts,attr).get();return!Array.isArray(val)&&val}module.exports=function plot(gd,calcData){var fullLayout=gd._fullLayout,svg=fullLayout._paper,size=fullLayout._size,sourceLabel=_(gd,"source:")+" ",targetLabel=_(gd,"target:")+" ",incomingLabel=_(gd,"incoming flow count:")+" ",outgoingLabel=_(gd,"outgoing flow count:")+" ";render(svg,calcData,{width:size.w,height:size.h,margin:{t:size.t,r:size.r,b:size.b,l:size.l}},{linkEvents:{hover:function(element,d,sankey){!1!==gd._fullLayout.hovermode&&(d3.select(element).call(linkHoveredStyle.bind(0,d,sankey,!0)),gd.emit("plotly_hover",{event:d3.event,points:[d.link]}))},follow:function(element,d){if(!1!==gd._fullLayout.hovermode){var trace=d.link.trace,rootBBox=gd._fullLayout._paperdiv.node().getBoundingClientRect(),boundingBox=element.getBoundingClientRect(),hoverCenterX=boundingBox.left+boundingBox.width/2,hoverCenterY=boundingBox.top+boundingBox.height/2,tooltip=Fx.loneHover({x:hoverCenterX-rootBBox.left,y:hoverCenterY-rootBBox.top,name:d3.format(d.valueFormat)(d.link.value)+d.valueSuffix,text:[d.link.label||"",sourceLabel+d.link.source.label,targetLabel+d.link.target.label].filter(renderableValuePresent).join("<br>"),color:castHoverOption(trace,"bgcolor")||Color.addOpacity(d.tinyColorHue,1),borderColor:castHoverOption(trace,"bordercolor"),fontFamily:castHoverOption(trace,"font.family"),fontSize:castHoverOption(trace,"font.size"),fontColor:castHoverOption(trace,"font.color"),idealAlign:d3.event.x<hoverCenterX?"right":"left"},{container:fullLayout._hoverlayer.node(),outerContainer:fullLayout._paper.node(),gd:gd});makeTranslucent(tooltip,.65),makeTextContrasty(tooltip)}},unhover:function(element,d,sankey){!1!==gd._fullLayout.hovermode&&(d3.select(element).call(linkNonHoveredStyle.bind(0,d,sankey,!0)),gd.emit("plotly_unhover",{event:d3.event,points:[d.link]}),Fx.loneUnhover(fullLayout._hoverlayer.node()))},select:function(element,d){var evt=d.link;evt.originalEvent=d3.event,gd._hoverdata=[evt],Fx.click(gd,{target:!0})}},nodeEvents:{hover:function(element,d,sankey){!1!==gd._fullLayout.hovermode&&(d3.select(element).call(nodeHoveredStyle,d,sankey),gd.emit("plotly_hover",{event:d3.event,points:[d.node]}))},follow:function(element,d){if(!1!==gd._fullLayout.hovermode){var trace=d.node.trace,nodeRect=d3.select(element).select("."+cn.nodeRect),rootBBox=gd._fullLayout._paperdiv.node().getBoundingClientRect(),boundingBox=nodeRect.node().getBoundingClientRect(),hoverCenterX0=boundingBox.left-2-rootBBox.left,hoverCenterX1=boundingBox.right+2-rootBBox.left,hoverCenterY=boundingBox.top+boundingBox.height/4-rootBBox.top,tooltip=Fx.loneHover({x0:hoverCenterX0,x1:hoverCenterX1,y:hoverCenterY,name:d3.format(d.valueFormat)(d.node.value)+d.valueSuffix,text:[d.node.label,incomingLabel+d.node.targetLinks.length,outgoingLabel+d.node.sourceLinks.length].filter(renderableValuePresent).join("<br>"),color:castHoverOption(trace,"bgcolor")||d.tinyColorHue,borderColor:castHoverOption(trace,"bordercolor"),fontFamily:castHoverOption(trace,"font.family"),fontSize:castHoverOption(trace,"font.size"),fontColor:castHoverOption(trace,"font.color"),idealAlign:"left"},{container:fullLayout._hoverlayer.node(),outerContainer:fullLayout._paper.node(),gd:gd});makeTranslucent(tooltip,.85),makeTextContrasty(tooltip)}},unhover:function(element,d,sankey){!1!==gd._fullLayout.hovermode&&(d3.select(element).call(nodeNonHoveredStyle,d,sankey),gd.emit("plotly_unhover",{event:d3.event,points:[d.node]}),Fx.loneUnhover(fullLayout._hoverlayer.node()))},select:function(element,d,sankey){var evt=d.node;evt.originalEvent=d3.event,gd._hoverdata=[evt],d3.select(element).call(nodeNonHoveredStyle,d,sankey),Fx.click(gd,{target:!0})}}})}},{"../../components/color":567,"../../components/fx":609,"../../lib":693,"./constants":1026,"./render":1030,d3:147}],1030:[function(_dereq_,module,exports){"use strict";var c=_dereq_("./constants"),d3=_dereq_("d3"),tinycolor=_dereq_("tinycolor2"),Color=_dereq_("../../components/color"),Drawing=_dereq_("../../components/drawing"),d3sankey=_dereq_("@plotly/d3-sankey").sankey,d3Force=_dereq_("d3-force"),Lib=_dereq_("../../lib"),isArrayOrTypedArray=Lib.isArrayOrTypedArray,isIndex=Lib.isIndex,gup=_dereq_("../../lib/gup"),keyFun=gup.keyFun,repeat=gup.repeat,unwrap=gup.unwrap;function saveCurrentDragPosition(d){d.lastDraggedX=d.x,d.lastDraggedY=d.y}function sameLayer(d){return function(n){return n.node.originalX===d.node.originalX}}function switchToForceFormat(nodes){for(var i=0;i<nodes.length;i++)nodes[i].y=nodes[i].y+nodes[i].dy/2}function updateNodePositions(sankeyNode){sankeyNode.attr("transform",function(d){return"translate("+d.node.x.toFixed(3)+", "+(d.node.y-d.node.dy/2).toFixed(3)+")"})}function linkPath(d){var nodes=d.sankey.nodes();!function switchToSankeyFormat(nodes){for(var i=0;i<nodes.length;i++)nodes[i].y=nodes[i].y-nodes[i].dy/2}(nodes);var result=d.sankey.link()(d.link);return switchToForceFormat(nodes),result}function updateNodeShapes(sankeyNode){sankeyNode.call(updateNodePositions)}function updateShapes(sankeyNode,sankeyLink){sankeyNode.call(updateNodeShapes),sankeyLink.attr("d",linkPath)}function sizeNode(rect){rect.attr("width",function(d){return d.visibleWidth}).attr("height",function(d){return d.visibleHeight})}function salientEnough(d){return d.link.dy>1||d.linkLineWidth>0}function sankeyTransform(d){return"translate("+d.translateX+","+d.translateY+")"+(d.horizontal?"matrix(1 0 0 1 0 0)":"matrix(0 1 1 0 0 0)")}function nodeCentering(d){return"translate("+(d.horizontal?0:d.labelY)+" "+(d.horizontal?d.labelY:0)+")"}function textGuidePath(d){return d3.svg.line()([[d.horizontal?d.left?-d.sizeAcross:d.visibleWidth+c.nodeTextOffsetHorizontal:c.nodeTextOffsetHorizontal,0],[d.horizontal?d.left?-c.nodeTextOffsetHorizontal:d.sizeAcross:d.visibleHeight-c.nodeTextOffsetHorizontal,0]])}function sankeyInverseTransform(d){return d.horizontal?"matrix(1 0 0 1 0 0)":"matrix(0 1 1 0 0 0)"}function textFlip(d){return d.horizontal?"scale(1 1)":"scale(-1 1)"}function nodeTextColor(d){return d.darkBackground&&!d.horizontal?"rgb(255,255,255)":"rgb(0,0,0)"}function nodeTextOffset(d){return d.horizontal&&d.left?"100%":"0%"}function attachPointerEvents(selection,sankey,eventSet){selection.on(".basic",null).on("mouseover.basic",function(d){d.interactionState.dragInProgress||(eventSet.hover(this,d,sankey),d.interactionState.hovered=[this,d])}).on("mousemove.basic",function(d){d.interactionState.dragInProgress||(eventSet.follow(this,d),d.interactionState.hovered=[this,d])}).on("mouseout.basic",function(d){d.interactionState.dragInProgress||(eventSet.unhover(this,d,sankey),d.interactionState.hovered=!1)}).on("click.basic",function(d){d.interactionState.hovered&&(eventSet.unhover(this,d,sankey),d.interactionState.hovered=!1),d.interactionState.dragInProgress||eventSet.select(this,d,sankey)})}function attachDragHandler(sankeyNode,sankeyLink,callbacks){var dragBehavior=d3.behavior.drag().origin(function(d){return d.node}).on("dragstart",function(d){if("fixed"!==d.arrangement&&(Lib.raiseToTop(this),d.interactionState.dragInProgress=d.node,saveCurrentDragPosition(d.node),d.interactionState.hovered&&(callbacks.nodeEvents.unhover.apply(0,d.interactionState.hovered),d.interactionState.hovered=!1),"snap"===d.arrangement)){var forceKey=d.traceId+"|"+Math.floor(d.node.originalX);d.forceLayouts[forceKey]?d.forceLayouts[forceKey].alpha(1):function attachForce(sankeyNode,forceKey,d){var nodes=d.sankey.nodes().filter(function(n){return n.originalX===d.node.originalX});d.forceLayouts[forceKey]=d3Force.forceSimulation(nodes).alphaDecay(0).force("collide",d3Force.forceCollide().radius(function(n){return n.dy/2+d.nodePad/2}).strength(1).iterations(c.forceIterations)).force("constrain",function snappingForce(sankeyNode,forceKey,nodes,d){return function _snappingForce(){for(var maxVelocity=0,i=0;i<nodes.length;i++){var n=nodes[i];n===d.interactionState.dragInProgress?(n.x=n.lastDraggedX,n.y=n.lastDraggedY):(n.vx=(n.originalX-n.x)/c.forceTicksPerFrame,n.y=Math.min(d.size-n.dy/2,Math.max(n.dy/2,n.y))),maxVelocity=Math.max(maxVelocity,Math.abs(n.vx),Math.abs(n.vy))}!d.interactionState.dragInProgress&&maxVelocity<.1&&d.forceLayouts[forceKey].alpha()>0&&d.forceLayouts[forceKey].alpha(0)}}(0,forceKey,nodes,d)).stop()}(0,forceKey,d),function startForce(sankeyNode,sankeyLink,d,forceKey){window.requestAnimationFrame(function faster(){for(var i=0;i<c.forceTicksPerFrame;i++)d.forceLayouts[forceKey].tick();d.sankey.relayout(),updateShapes(sankeyNode.filter(sameLayer(d)),sankeyLink),d.forceLayouts[forceKey].alpha()>0&&window.requestAnimationFrame(faster)})}(sankeyNode,sankeyLink,d,forceKey)}}).on("drag",function(d){if("fixed"!==d.arrangement){var x=d3.event.x,y=d3.event.y;"snap"===d.arrangement?(d.node.x=x,d.node.y=y):("freeform"===d.arrangement&&(d.node.x=x),d.node.y=Math.max(d.node.dy/2,Math.min(d.size-d.node.dy/2,y))),saveCurrentDragPosition(d.node),"snap"!==d.arrangement&&(d.sankey.relayout(),updateShapes(sankeyNode.filter(sameLayer(d)),sankeyLink))}}).on("dragend",function(d){d.interactionState.dragInProgress=!1});sankeyNode.on(".drag",null).call(dragBehavior)}module.exports=function(svg,styledData,layout,callbacks){var sankey=svg.selectAll("."+c.cn.sankey).data(styledData.filter(function(d){return unwrap(d).trace.visible}).map(function sankeyModel(layout,d,traceIndex){var i,trace=unwrap(d).trace,domain=trace.domain,nodeSpec=trace.node,linkSpec=trace.link,arrangement=trace.arrangement,horizontal="h"===trace.orientation,nodePad=trace.node.pad,nodeThickness=trace.node.thickness,nodeLineColor=trace.node.line.color,nodeLineWidth=trace.node.line.width,linkLineColor=trace.link.line.color,linkLineWidth=trace.link.line.width,valueFormat=trace.valueformat,valueSuffix=trace.valuesuffix,textFont=trace.textfont,width=layout.width*(domain.x[1]-domain.x[0]),height=layout.height*(domain.y[1]-domain.y[0]),links=[],hasLinkColorArray=isArrayOrTypedArray(linkSpec.color),linkedNodes={},nodeCount=nodeSpec.label.length;for(i=0;i<linkSpec.value.length;i++){var val=linkSpec.value[i],source=linkSpec.source[i],target=linkSpec.target[i];val>0&&isIndex(source,nodeCount)&&isIndex(target,nodeCount)&&(target=+target,linkedNodes[source=+source]=linkedNodes[target]=!0,links.push({pointNumber:i,label:linkSpec.label[i],color:hasLinkColorArray?linkSpec.color[i]:linkSpec.color,source:source,target:target,value:+val}))}var hasNodeColorArray=isArrayOrTypedArray(nodeSpec.color),nodes=[],removedNodes=!1,nodeIndices={};for(i=0;i<nodeCount;i++)if(linkedNodes[i]){var l=nodeSpec.label[i];nodeIndices[i]=nodes.length,nodes.push({pointNumber:i,label:l,color:hasNodeColorArray?nodeSpec.color[i]:nodeSpec.color})}else removedNodes=!0;if(removedNodes)for(i=0;i<links.length;i++)links[i].source=nodeIndices[links[i].source],links[i].target=nodeIndices[links[i].target];for(var node,sankey=d3sankey().size(horizontal?[width,height]:[height,width]).nodeWidth(nodeThickness).nodePadding(nodePad).nodes(nodes).links(links).layout(c.sankeyIterations),sankeyNodes=sankey.nodes(),n=0;n<sankeyNodes.length;n++)(node=sankeyNodes[n]).width=width,node.height=height;return switchToForceFormat(nodes),{key:traceIndex,trace:trace,guid:Math.floor(1e12*(1+Math.random())),horizontal:horizontal,width:width,height:height,nodePad:nodePad,nodeLineColor:nodeLineColor,nodeLineWidth:nodeLineWidth,linkLineColor:linkLineColor,linkLineWidth:linkLineWidth,valueFormat:valueFormat,valueSuffix:valueSuffix,textFont:textFont,translateX:domain.x[0]*layout.width+layout.margin.l,translateY:layout.height-domain.y[1]*layout.height+layout.margin.t,dragParallel:horizontal?height:width,dragPerpendicular:horizontal?width:height,nodes:nodes,links:links,arrangement:arrangement,sankey:sankey,forceLayouts:{},interactionState:{dragInProgress:!1,hovered:!1}}}.bind(null,layout)),keyFun);sankey.exit().remove(),sankey.enter().append("g").classed(c.cn.sankey,!0).style("box-sizing","content-box").style("position","absolute").style("left",0).style("shape-rendering","geometricPrecision").style("pointer-events","auto").attr("transform",sankeyTransform),sankey.transition().ease(c.ease).duration(c.duration).attr("transform",sankeyTransform);var sankeyLinks=sankey.selectAll("."+c.cn.sankeyLinks).data(repeat,keyFun);sankeyLinks.enter().append("g").classed(c.cn.sankeyLinks,!0).style("fill","none");var sankeyLink=sankeyLinks.selectAll("."+c.cn.sankeyLink).data(function(d){return d.sankey.links().filter(function(l){return l.value}).map(function linkModel(uniqueKeys,d,l){var tc=tinycolor(l.color),basicKey=l.source.label+"|"+l.target.label,foundKey=uniqueKeys[basicKey];uniqueKeys[basicKey]=(foundKey||0)+1;var key=basicKey+"__"+uniqueKeys[basicKey];return l.trace=d.trace,l.curveNumber=d.trace.index,{key:key,traceId:d.key,link:l,tinyColorHue:Color.tinyRGB(tc),tinyColorAlpha:tc.getAlpha(),linkLineColor:d.linkLineColor,linkLineWidth:d.linkLineWidth,valueFormat:d.valueFormat,valueSuffix:d.valueSuffix,sankey:d.sankey,interactionState:d.interactionState}}.bind(null,{},d))},keyFun);sankeyLink.enter().append("path").classed(c.cn.sankeyLink,!0).attr("d",linkPath).call(attachPointerEvents,sankey,callbacks.linkEvents),sankeyLink.style("stroke",function(d){return salientEnough(d)?Color.tinyRGB(tinycolor(d.linkLineColor)):d.tinyColorHue}).style("stroke-opacity",function(d){return salientEnough(d)?Color.opacity(d.linkLineColor):d.tinyColorAlpha}).style("stroke-width",function(d){return salientEnough(d)?d.linkLineWidth:1}).style("fill",function(d){return d.tinyColorHue}).style("fill-opacity",function(d){return d.tinyColorAlpha}),sankeyLink.transition().ease(c.ease).duration(c.duration).attr("d",linkPath),sankeyLink.exit().transition().ease(c.ease).duration(c.duration).style("opacity",0).remove();var sankeyNodeSet=sankey.selectAll("."+c.cn.sankeyNodeSet).data(repeat,keyFun);sankeyNodeSet.enter().append("g").classed(c.cn.sankeyNodeSet,!0),sankeyNodeSet.style("cursor",function(d){switch(d.arrangement){case"fixed":return"default";case"perpendicular":return"ns-resize";default:return"move"}});var sankeyNode=sankeyNodeSet.selectAll("."+c.cn.sankeyNode).data(function(d){var nodes=d.sankey.nodes();return function persistOriginalPlace(nodes){var i,distinctLayerPositions=[];for(i=0;i<nodes.length;i++)nodes[i].originalX=nodes[i].x,nodes[i].originalY=nodes[i].y,-1===distinctLayerPositions.indexOf(nodes[i].x)&&distinctLayerPositions.push(nodes[i].x);for(distinctLayerPositions.sort(function(a,b){return a-b}),i=0;i<nodes.length;i++)nodes[i].originalLayerIndex=distinctLayerPositions.indexOf(nodes[i].originalX),nodes[i].originalLayer=nodes[i].originalLayerIndex/(distinctLayerPositions.length-1)}(nodes),nodes.filter(function(n){return n.value}).map(function nodeModel(uniqueKeys,d,n){var tc=tinycolor(n.color),zoneThicknessPad=c.nodePadAcross,zoneLengthPad=d.nodePad/2,visibleThickness=n.dx,visibleLength=Math.max(.5,n.dy),basicKey=n.label,foundKey=uniqueKeys[basicKey];uniqueKeys[basicKey]=(foundKey||0)+1;var key=basicKey+"__"+uniqueKeys[basicKey];return n.trace=d.trace,n.curveNumber=d.trace.index,{key:key,traceId:d.key,node:n,nodePad:d.nodePad,nodeLineColor:d.nodeLineColor,nodeLineWidth:d.nodeLineWidth,textFont:d.textFont,size:d.horizontal?d.height:d.width,visibleWidth:Math.ceil(visibleThickness),visibleHeight:visibleLength,zoneX:-zoneThicknessPad,zoneY:-zoneLengthPad,zoneWidth:visibleThickness+2*zoneThicknessPad,zoneHeight:visibleLength+2*zoneLengthPad,labelY:d.horizontal?n.dy/2+1:n.dx/2+1,left:1===n.originalLayer,sizeAcross:d.width,forceLayouts:d.forceLayouts,horizontal:d.horizontal,darkBackground:tc.getBrightness()<=128,tinyColorHue:Color.tinyRGB(tc),tinyColorAlpha:tc.getAlpha(),valueFormat:d.valueFormat,valueSuffix:d.valueSuffix,sankey:d.sankey,arrangement:d.arrangement,uniqueNodeLabelPathId:[d.guid,d.key,key].join(" "),interactionState:d.interactionState}}.bind(null,{},d))},keyFun);sankeyNode.enter().append("g").classed(c.cn.sankeyNode,!0).call(updateNodePositions).call(attachPointerEvents,sankey,callbacks.nodeEvents),sankeyNode.call(attachDragHandler,sankeyLink,callbacks),sankeyNode.transition().ease(c.ease).duration(c.duration).call(updateNodePositions),sankeyNode.exit().transition().ease(c.ease).duration(c.duration).style("opacity",0).remove();var nodeRect=sankeyNode.selectAll("."+c.cn.nodeRect).data(repeat);nodeRect.enter().append("rect").classed(c.cn.nodeRect,!0).call(sizeNode),nodeRect.style("stroke-width",function(d){return d.nodeLineWidth}).style("stroke",function(d){return Color.tinyRGB(tinycolor(d.nodeLineColor))}).style("stroke-opacity",function(d){return Color.opacity(d.nodeLineColor)}).style("fill",function(d){return d.tinyColorHue}).style("fill-opacity",function(d){return d.tinyColorAlpha}),nodeRect.transition().ease(c.ease).duration(c.duration).call(sizeNode);var nodeCapture=sankeyNode.selectAll("."+c.cn.nodeCapture).data(repeat);nodeCapture.enter().append("rect").classed(c.cn.nodeCapture,!0).style("fill-opacity",0),nodeCapture.attr("x",function(d){return d.zoneX}).attr("y",function(d){return d.zoneY}).attr("width",function(d){return d.zoneWidth}).attr("height",function(d){return d.zoneHeight});var nodeCentered=sankeyNode.selectAll("."+c.cn.nodeCentered).data(repeat);nodeCentered.enter().append("g").classed(c.cn.nodeCentered,!0).attr("transform",nodeCentering),nodeCentered.transition().ease(c.ease).duration(c.duration).attr("transform",nodeCentering);var nodeLabelGuide=nodeCentered.selectAll("."+c.cn.nodeLabelGuide).data(repeat);nodeLabelGuide.enter().append("path").classed(c.cn.nodeLabelGuide,!0).attr("id",function(d){return d.uniqueNodeLabelPathId}).attr("d",textGuidePath).attr("transform",sankeyInverseTransform),nodeLabelGuide.transition().ease(c.ease).duration(c.duration).attr("d",textGuidePath).attr("transform",sankeyInverseTransform);var nodeLabel=nodeCentered.selectAll("."+c.cn.nodeLabel).data(repeat);nodeLabel.enter().append("text").classed(c.cn.nodeLabel,!0).attr("transform",textFlip).style("user-select","none").style("cursor","default").style("fill","black"),nodeLabel.style("text-shadow",function(d){return d.horizontal?"-1px 1px 1px #fff, 1px 1px 1px #fff, 1px -1px 1px #fff, -1px -1px 1px #fff":"none"}).each(function(d){Drawing.font(nodeLabel,d.textFont)}),nodeLabel.transition().ease(c.ease).duration(c.duration).attr("transform",textFlip);var nodeLabelTextPath=nodeLabel.selectAll("."+c.cn.nodeLabelTextPath).data(repeat);nodeLabelTextPath.enter().append("textPath").classed(c.cn.nodeLabelTextPath,!0).attr("alignment-baseline","middle").attr("xlink:href",function(d){return"#"+d.uniqueNodeLabelPathId}).attr("startOffset",nodeTextOffset).style("fill",nodeTextColor),nodeLabelTextPath.text(function(d){return d.horizontal||d.node.dy>5?d.node.label:""}).attr("text-anchor",function(d){return d.horizontal&&d.left?"end":"start"}),nodeLabelTextPath.transition().ease(c.ease).duration(c.duration).attr("startOffset",nodeTextOffset).style("fill",nodeTextColor)}},{"../../components/color":567,"../../components/drawing":592,"../../lib":693,"../../lib/gup":690,"./constants":1026,"@plotly/d3-sankey":45,d3:147,"d3-force":143,tinycolor2:511}],1031:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function arraysToCalcdata(cd,trace){for(var i=0;i<cd.length;i++)cd[i].i=i;Lib.mergeArray(trace.text,cd,"tx"),Lib.mergeArray(trace.hovertext,cd,"htx"),Lib.mergeArray(trace.customdata,cd,"data"),Lib.mergeArray(trace.textposition,cd,"tp"),trace.textfont&&(Lib.mergeArray(trace.textfont.size,cd,"ts"),Lib.mergeArray(trace.textfont.color,cd,"tc"),Lib.mergeArray(trace.textfont.family,cd,"tf"));var marker=trace.marker;if(marker){Lib.mergeArray(marker.size,cd,"ms"),Lib.mergeArray(marker.opacity,cd,"mo"),Lib.mergeArray(marker.symbol,cd,"mx"),Lib.mergeArray(marker.color,cd,"mc");var markerLine=marker.line;marker.line&&(Lib.mergeArray(markerLine.color,cd,"mlc"),Lib.mergeArray(markerLine.width,cd,"mlw"));var markerGradient=marker.gradient;markerGradient&&"none"!==markerGradient.type&&(Lib.mergeArray(markerGradient.type,cd,"mgt"),Lib.mergeArray(markerGradient.color,cd,"mgc"))}}},{"../../lib":693}],1032:[function(_dereq_,module,exports){"use strict";var colorAttributes=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),fontAttrs=_dereq_("../../plots/font_attributes"),dash=_dereq_("../../components/drawing/attributes").dash,Drawing=_dereq_("../../components/drawing"),extendFlat=(_dereq_("./constants"),_dereq_("../../lib/extend").extendFlat);module.exports={x:{valType:"data_array",editType:"calc+clearAxisTypes"},x0:{valType:"any",dflt:0,editType:"calc+clearAxisTypes"},dx:{valType:"number",dflt:1,editType:"calc"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},y0:{valType:"any",dflt:0,editType:"calc+clearAxisTypes"},dy:{valType:"number",dflt:1,editType:"calc"},stackgroup:{valType:"string",dflt:"",editType:"calc"},orientation:{valType:"enumerated",values:["v","h"],editType:"calc"},groupnorm:{valType:"enumerated",values:["","fraction","percent"],dflt:"",editType:"calc"},stackgaps:{valType:"enumerated",values:["infer zero","interpolate"],dflt:"infer zero",editType:"calc"},text:{valType:"string",dflt:"",arrayOk:!0,editType:"calc"},hovertext:{valType:"string",dflt:"",arrayOk:!0,editType:"style"},mode:{valType:"flaglist",flags:["lines","markers","text"],extras:["none"],editType:"calc"},hoveron:{valType:"flaglist",flags:["points","fills"],editType:"style"},line:{color:{valType:"color",editType:"style"},width:{valType:"number",min:0,dflt:2,editType:"style"},shape:{valType:"enumerated",values:["linear","spline","hv","vh","hvh","vhv"],dflt:"linear",editType:"plot"},smoothing:{valType:"number",min:0,max:1.3,dflt:1,editType:"plot"},dash:extendFlat({},dash,{editType:"style"}),simplify:{valType:"boolean",dflt:!0,editType:"plot"},editType:"plot"},connectgaps:{valType:"boolean",dflt:!1,editType:"calc"},cliponaxis:{valType:"boolean",dflt:!0,editType:"plot"},fill:{valType:"enumerated",values:["none","tozeroy","tozerox","tonexty","tonextx","toself","tonext"],editType:"calc"},fillcolor:{valType:"color",editType:"style"},marker:extendFlat({symbol:{valType:"enumerated",values:Drawing.symbolList,dflt:"circle",arrayOk:!0,editType:"style"},opacity:{valType:"number",min:0,max:1,arrayOk:!0,editType:"style"},size:{valType:"number",min:0,dflt:6,arrayOk:!0,editType:"calc"},maxdisplayed:{valType:"number",min:0,dflt:0,editType:"plot"},sizeref:{valType:"number",dflt:1,editType:"calc"},sizemin:{valType:"number",min:0,dflt:0,editType:"calc"},sizemode:{valType:"enumerated",values:["diameter","area"],dflt:"diameter",editType:"calc"},colorbar:colorbarAttrs,line:extendFlat({width:{valType:"number",min:0,arrayOk:!0,editType:"style"},editType:"calc"},colorAttributes("marker.line")),gradient:{type:{valType:"enumerated",values:["radial","horizontal","vertical","none"],arrayOk:!0,dflt:"none",editType:"calc"},color:{valType:"color",arrayOk:!0,editType:"calc"},editType:"calc"},editType:"calc"},colorAttributes("marker")),selected:{marker:{opacity:{valType:"number",min:0,max:1,editType:"style"},color:{valType:"color",editType:"style"},size:{valType:"number",min:0,editType:"style"},editType:"style"},textfont:{color:{valType:"color",editType:"style"},editType:"style"},editType:"style"},unselected:{marker:{opacity:{valType:"number",min:0,max:1,editType:"style"},color:{valType:"color",editType:"style"},size:{valType:"number",min:0,editType:"style"},editType:"style"},textfont:{color:{valType:"color",editType:"style"},editType:"style"},editType:"style"},textposition:{valType:"enumerated",values:["top left","top center","top right","middle left","middle center","middle right","bottom left","bottom center","bottom right"],dflt:"middle center",arrayOk:!0,editType:"calc"},textfont:fontAttrs({editType:"calc",colorEditType:"style",arrayOk:!0}),r:{valType:"data_array",editType:"calc"},t:{valType:"data_array",editType:"calc"}}},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../components/drawing":592,"../../components/drawing/attributes":591,"../../lib/extend":682,"../../plots/font_attributes":768,"./constants":1037}],1033:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),BADNUM=_dereq_("../../constants/numerical").BADNUM,subTypes=_dereq_("./subtypes"),calcColorscale=_dereq_("./colorscale_calc"),arraysToCalcdata=_dereq_("./arrays_to_calcdata"),calcSelection=_dereq_("./calc_selection");function calcAxisExpansion(gd,trace,xa,ya,x,y,ppad){var serieslen=trace._length,fullLayout=gd._fullLayout,xId=xa._id,yId=ya._id,firstScatter=fullLayout._firstScatter[firstScatterGroup(trace)]===trace.uid,stackOrientation=(getStackOpts(trace,fullLayout,xa,ya)||{}).orientation,fill=trace.fill;xa._minDtick=0,ya._minDtick=0;var xOptions={padded:!0},yOptions={padded:!0};ppad&&(xOptions.ppad=yOptions.ppad=ppad);var openEnded=serieslen<2||x[0]!==x[serieslen-1]||y[0]!==y[serieslen-1];openEnded&&("tozerox"===fill||"tonextx"===fill&&(firstScatter||"h"===stackOrientation))?xOptions.tozero=!0:(trace.error_y||{}).visible||"tonexty"!==fill&&"tozeroy"!==fill&&(subTypes.hasMarkers(trace)||subTypes.hasText(trace))||(xOptions.padded=!1,xOptions.ppad=0),openEnded&&("tozeroy"===fill||"tonexty"===fill&&(firstScatter||"v"===stackOrientation))?yOptions.tozero=!0:"tonextx"!==fill&&"tozerox"!==fill||(yOptions.padded=!1),xId&&(trace._extremes[xId]=Axes.findExtremes(xa,x,xOptions)),yId&&(trace._extremes[yId]=Axes.findExtremes(ya,y,yOptions))}function calcMarkerSize(trace,serieslen){if(subTypes.hasMarkers(trace)){var markerTrans,marker=trace.marker,sizeref=1.6*(trace.marker.sizeref||1);if(markerTrans="area"===trace.marker.sizemode?function(v){return Math.max(Math.sqrt((v||0)/sizeref),3)}:function(v){return Math.max((v||0)/sizeref,3)},Lib.isArrayOrTypedArray(marker.size)){var ax={type:"linear"};Axes.setConvert(ax);for(var s=ax.makeCalcdata(trace.marker,"size"),sizeOut=new Array(serieslen),i=0;i<serieslen;i++)sizeOut[i]=markerTrans(s[i]);return sizeOut}return markerTrans(marker.size)}}function setFirstScatter(fullLayout,trace){var group=firstScatterGroup(trace),firstScatter=fullLayout._firstScatter;firstScatter[group]||(firstScatter[group]=trace.uid)}function firstScatterGroup(trace){var stackGroup=trace.stackgroup;return trace.xaxis+trace.yaxis+trace.type+(stackGroup?"-"+stackGroup:"")}function getStackOpts(trace,fullLayout,xa,ya){var stackGroup=trace.stackgroup;if(stackGroup){var stackOpts=fullLayout._scatterStackOpts[xa._id+ya._id][stackGroup],stackAx="v"===stackOpts.orientation?ya:xa;return"linear"===stackAx.type||"log"===stackAx.type?stackOpts:void 0}}module.exports={calc:function calc(gd,trace){var isV,i,j,k,interpolate,vali,fullLayout=gd._fullLayout,xa=Axes.getFromId(gd,trace.xaxis||"x"),ya=Axes.getFromId(gd,trace.yaxis||"y"),x=xa.makeCalcdata(trace,"x"),y=ya.makeCalcdata(trace,"y"),serieslen=trace._length,cd=new Array(serieslen),ids=trace.ids,stackGroupOpts=getStackOpts(trace,fullLayout,xa,ya),interpolateGaps=!1;setFirstScatter(fullLayout,trace);var posAttr,xAttr="x",yAttr="y";for(stackGroupOpts?(stackGroupOpts.traceIndices.push(trace.index),(isV="v"===stackGroupOpts.orientation)?(yAttr="s",posAttr="x"):(xAttr="s",posAttr="y"),interpolate="interpolate"===stackGroupOpts.stackgaps):calcAxisExpansion(gd,trace,xa,ya,x,y,calcMarkerSize(trace,serieslen)),i=0;i<serieslen;i++){var cdi=cd[i]={},xValid=isNumeric(x[i]),yValid=isNumeric(y[i]);xValid&&yValid?(cdi[xAttr]=x[i],cdi[yAttr]=y[i]):stackGroupOpts&&(isV?xValid:yValid)?(cdi[posAttr]=isV?x[i]:y[i],cdi.gap=!0,interpolate?(cdi.s=BADNUM,interpolateGaps=!0):cdi.s=0):cdi[xAttr]=cdi[yAttr]=BADNUM,ids&&(cdi.id=String(ids[i]))}if(arraysToCalcdata(cd,trace),calcColorscale(trace),calcSelection(cd,trace),stackGroupOpts){for(i=0;i<cd.length;)cd[i][posAttr]===BADNUM?cd.splice(i,1):i++;if(Lib.sort(cd,function(a,b){return a[posAttr]-b[posAttr]||a.i-b.i}),interpolateGaps){for(i=0;i<cd.length-1&&cd[i].gap;)i++;for((vali=cd[i].s)||(vali=cd[i].s=0),j=0;j<i;j++)cd[j].s=vali;for(k=cd.length-1;k>i&&cd[k].gap;)k--;for(vali=cd[k].s,j=cd.length-1;j>k;j--)cd[j].s=vali;for(;i<k;)if(cd[++i].gap){for(j=i+1;cd[j].gap;)j++;for(var pos0=cd[i-1][posAttr],size0=cd[i-1].s,m=(cd[j].s-size0)/(cd[j][posAttr]-pos0);i<j;)cd[i].s=size0+(cd[i][posAttr]-pos0)*m,i++}}}return cd},calcMarkerSize:calcMarkerSize,calcAxisExpansion:calcAxisExpansion,setFirstScatter:setFirstScatter,getStackOpts:getStackOpts}},{"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axes":742,"./arrays_to_calcdata":1031,"./calc_selection":1034,"./colorscale_calc":1036,"./subtypes":1056,"fast-isnumeric":213}],1034:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function calcSelection(cd,trace){Lib.isArrayOrTypedArray(trace.selectedpoints)&&Lib.tagSelected(cd,trace)}},{"../../lib":693}],1035:[function(_dereq_,module,exports){"use strict";module.exports=function cleanData(fullData){for(var i=0;i<fullData.length;i++){var tracei=fullData[i];if("scatter"===tracei.type){var filli=tracei.fill;if("none"!==filli&&"toself"!==filli&&(tracei.opacity=void 0,"tonexty"===filli||"tonextx"===filli))for(var j=i-1;j>=0;j--){var tracej=fullData[j];if("scatter"===tracej.type&&tracej.xaxis===tracei.xaxis&&tracej.yaxis===tracei.yaxis){tracej.opacity=void 0;break}}}}}},{}],1036:[function(_dereq_,module,exports){"use strict";var hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),calcColorscale=_dereq_("../../components/colorscale/calc"),subTypes=_dereq_("./subtypes");module.exports=function calcMarkerColorscale(trace){subTypes.hasLines(trace)&&hasColorscale(trace,"line")&&calcColorscale(trace,trace.line.color,"line","c"),subTypes.hasMarkers(trace)&&(hasColorscale(trace,"marker")&&calcColorscale(trace,trace.marker.color,"marker","c"),hasColorscale(trace,"marker.line")&&calcColorscale(trace,trace.marker.line.color,"marker.line","c"))}},{"../../components/colorscale/calc":575,"../../components/colorscale/has_colorscale":581,"./subtypes":1056}],1037:[function(_dereq_,module,exports){"use strict";module.exports={PTS_LINESONLY:20,minTolerance:.2,toleranceGrowth:10,maxScreensAway:20}},{}],1038:[function(_dereq_,module,exports){"use strict";var calc=_dereq_("./calc");function insertBlank(calcTrace,index,position,traceIndex,hasAnyBlanks,interpolate,posAttr){hasAnyBlanks[traceIndex]=!0;var newEntry={i:null,gap:!0,s:0};if(newEntry[posAttr]=position,calcTrace.splice(index,0,newEntry),index&&position===calcTrace[index-1][posAttr]){var prevEntry=calcTrace[index-1];newEntry.s=prevEntry.s,newEntry.i=prevEntry.i,newEntry.gap=prevEntry.gap}else interpolate&&(newEntry.s=function getInterp(calcTrace,index,position,posAttr){var pt0=calcTrace[index-1],pt1=calcTrace[index+1];return pt1?pt0?pt0.s+(pt1.s-pt0.s)*(position-pt0[posAttr])/(pt1[posAttr]-pt0[posAttr]):pt1.s:pt0.s}(calcTrace,index,position,posAttr));index||(calcTrace[0].t=calcTrace[1].t,calcTrace[0].trace=calcTrace[1].trace,delete calcTrace[1].t,delete calcTrace[1].trace)}module.exports=function crossTraceCalc(gd,plotinfo){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,subplot=xa._id+ya._id,subplotStackOpts=gd._fullLayout._scatterStackOpts[subplot];if(subplotStackOpts){var i,j,k,i2,cd,cd0,posj,sumj,norm,groupOpts,interpolate,groupnorm,posAttr,valAttr,hasAnyBlanks,calcTraces=gd.calcdata;for(var stackGroup in subplotStackOpts){var indices=(groupOpts=subplotStackOpts[stackGroup]).traceIndices;if(indices.length){for(interpolate="interpolate"===groupOpts.stackgaps,groupnorm=groupOpts.groupnorm,"v"===groupOpts.orientation?(posAttr="x",valAttr="y"):(posAttr="y",valAttr="x"),hasAnyBlanks=new Array(indices.length),i=0;i<hasAnyBlanks.length;i++)hasAnyBlanks[i]=!1;cd0=calcTraces[indices[0]];var allPositions=new Array(cd0.length);for(i=0;i<cd0.length;i++)allPositions[i]=cd0[i][posAttr];for(i=1;i<indices.length;i++){for(cd=calcTraces[indices[i]],j=k=0;j<cd.length;j++){for(posj=cd[j][posAttr];posj>allPositions[k]&&k<allPositions.length;k++)insertBlank(cd,j,allPositions[k],i,hasAnyBlanks,interpolate,posAttr),j++;if(posj!==allPositions[k]){for(i2=0;i2<i;i2++)insertBlank(calcTraces[indices[i2]],k,posj,i2,hasAnyBlanks,interpolate,posAttr);allPositions.splice(k,0,posj)}k++}for(;k<allPositions.length;k++)insertBlank(cd,j,allPositions[k],i,hasAnyBlanks,interpolate,posAttr),j++}var serieslen=allPositions.length;for(j=0;j<cd0.length;j++){for(sumj=cd0[j][valAttr]=cd0[j].s,i=1;i<indices.length;i++)(cd=calcTraces[indices[i]])[0].trace._rawLength=cd[0].trace._length,cd[0].trace._length=serieslen,sumj+=cd[j].s,cd[j][valAttr]=sumj;if(groupnorm)for(norm=("fraction"===groupnorm?sumj:sumj/100)||1,i=0;i<indices.length;i++){var cdj=calcTraces[indices[i]][j];cdj[valAttr]/=norm,cdj.sNorm=cdj.s/norm}}for(i=0;i<indices.length;i++){var trace=(cd=calcTraces[indices[i]])[0].trace,ppad=calc.calcMarkerSize(trace,trace._rawLength),arrayPad=Array.isArray(ppad);if(ppad&&hasAnyBlanks[i]||arrayPad){var ppadRaw=ppad;for(ppad=new Array(serieslen),j=0;j<serieslen;j++)ppad[j]=cd[j].gap?0:arrayPad?ppadRaw[cd[j].i]:ppadRaw}var x=new Array(serieslen),y=new Array(serieslen);for(j=0;j<serieslen;j++)x[j]=cd[j].x,y[j]=cd[j].y;calc.calcAxisExpansion(gd,trace,xa,ya,x,y,ppad),cd[0].t.orientation=groupOpts.orientation}}}}}},{"./calc":1033}],1039:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry"),attributes=_dereq_("./attributes"),constants=_dereq_("./constants"),subTypes=_dereq_("./subtypes"),handleXYDefaults=_dereq_("./xy_defaults"),handleStackDefaults=_dereq_("./stack_defaults"),handleMarkerDefaults=_dereq_("./marker_defaults"),handleLineDefaults=_dereq_("./line_defaults"),handleLineShapeDefaults=_dereq_("./line_shape_defaults"),handleTextDefaults=_dereq_("./text_defaults"),handleFillColorDefaults=_dereq_("./fillcolor_defaults");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var len=handleXYDefaults(traceIn,traceOut,layout,coerce);if(len||(traceOut.visible=!1),traceOut.visible){var stackGroupOpts=handleStackDefaults(traceIn,traceOut,layout,coerce),defaultMode=!stackGroupOpts&&len<constants.PTS_LINESONLY?"lines+markers":"lines";coerce("text"),coerce("hovertext"),coerce("mode",defaultMode),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),handleLineShapeDefaults(traceIn,traceOut,coerce),coerce("connectgaps"),coerce("line.simplify")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{gradient:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce);var dfltHoverOn=[];(subTypes.hasMarkers(traceOut)||subTypes.hasText(traceOut))&&(coerce("cliponaxis"),coerce("marker.maxdisplayed"),dfltHoverOn.push("points")),coerce("fill",stackGroupOpts?stackGroupOpts.fillDflt:"none"),"none"!==traceOut.fill&&(handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),subTypes.hasLines(traceOut)||handleLineShapeDefaults(traceIn,traceOut,coerce)),"tonext"!==traceOut.fill&&"toself"!==traceOut.fill||dfltHoverOn.push("fills"),coerce("hoveron",dfltHoverOn.join("+")||"points");var errorBarsSupplyDefaults=Registry.getComponentMethod("errorbars","supplyDefaults");errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"y"}),errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"x",inherit:"y"}),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}}},{"../../lib":693,"../../registry":825,"./attributes":1032,"./constants":1037,"./fillcolor_defaults":1041,"./line_defaults":1045,"./line_shape_defaults":1047,"./marker_defaults":1051,"./stack_defaults":1054,"./subtypes":1056,"./text_defaults":1057,"./xy_defaults":1058}],1040:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");function isValid(v){return v||0===v}module.exports=function fillHoverText(calcPt,trace,contOut){var fill=Array.isArray(contOut)?function(v){contOut.push(v)}:function(v){contOut.text=v},htx=Lib.extractOption(calcPt,trace,"htx","hovertext");if(isValid(htx))return fill(htx);var tx=Lib.extractOption(calcPt,trace,"tx","text");return isValid(tx)?fill(tx):void 0}},{"../../lib":693}],1041:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray;module.exports=function fillColorDefaults(traceIn,traceOut,defaultColor,coerce){var inheritColorFromMarker=!1;if(traceOut.marker){var markerColor=traceOut.marker.color,markerLineColor=(traceOut.marker.line||{}).color;markerColor&&!isArrayOrTypedArray(markerColor)?inheritColorFromMarker=markerColor:markerLineColor&&!isArrayOrTypedArray(markerLineColor)&&(inheritColorFromMarker=markerLineColor)}coerce("fillcolor",Color.addOpacity((traceOut.line||{}).color||inheritColorFromMarker||defaultColor,.5))}},{"../../components/color":567,"../../lib":693}],1042:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),subtypes=_dereq_("./subtypes");module.exports=function getTraceColor(trace,di){var lc,tc;if("lines"===trace.mode)return(lc=trace.line.color)&&Color.opacity(lc)?lc:trace.fillcolor;if("none"===trace.mode)return trace.fill?trace.fillcolor:"";var mc=di.mcc||(trace.marker||{}).color,mlc=di.mlcc||((trace.marker||{}).line||{}).color;return(tc=mc&&Color.opacity(mc)?mc:mlc&&Color.opacity(mlc)&&(di.mlw||((trace.marker||{}).line||{}).width)?mlc:"")?Color.opacity(tc)<.3?Color.addOpacity(tc,.3):tc:(lc=(trace.line||{}).color)&&Color.opacity(lc)&&subtypes.hasLines(trace)&&trace.line.width?lc:trace.fillcolor}},{"../../components/color":567,"./subtypes":1056}],1043:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Fx=_dereq_("../../components/fx"),Registry=_dereq_("../../registry"),getTraceColor=_dereq_("./get_trace_color"),Color=_dereq_("../../components/color"),fillHoverText=_dereq_("./fill_hover_text");module.exports=function hoverPoints(pointData,xval,yval,hovermode){var cd=pointData.cd,trace=cd[0].trace,xa=pointData.xa,ya=pointData.ya,xpx=xa.c2p(xval),ypx=ya.c2p(yval),pt=[xpx,ypx],hoveron=trace.hoveron||"",minRad=-1!==trace.mode.indexOf("markers")?3:.5;if(-1!==hoveron.indexOf("points")){var dxy=function(di){var rad=Math.max(minRad,di.mrc||0),dx=xa.c2p(di.x)-xpx,dy=ya.c2p(di.y)-ypx;return Math.max(Math.sqrt(dx*dx+dy*dy)-rad,1-minRad/rad)},distfn=Fx.getDistanceFunction(hovermode,function(di){var rad=Math.max(3,di.mrc||0),kink=1-1/rad,dxRaw=Math.abs(xa.c2p(di.x)-xpx);return dxRaw<rad?kink*dxRaw/rad:dxRaw-rad+kink},function(di){var rad=Math.max(3,di.mrc||0),kink=1-1/rad,dyRaw=Math.abs(ya.c2p(di.y)-ypx);return dyRaw<rad?kink*dyRaw/rad:dyRaw-rad+kink},dxy);if(Fx.getClosest(cd,distfn,pointData),!1!==pointData.index){var di=cd[pointData.index],xc=xa.c2p(di.x,!0),yc=ya.c2p(di.y,!0),rad=di.mrc||1;pointData.index=di.i;var orientation=cd[0].t.orientation,sizeVal=orientation&&(di.sNorm||di.s),xLabelVal="h"===orientation?sizeVal:di.x,yLabelVal="v"===orientation?sizeVal:di.y;return Lib.extendFlat(pointData,{color:getTraceColor(trace,di),x0:xc-rad,x1:xc+rad,xLabelVal:xLabelVal,y0:yc-rad,y1:yc+rad,yLabelVal:yLabelVal,spikeDistance:dxy(di)}),fillHoverText(di,trace,pointData),Registry.getComponentMethod("errorbars","hoverInfo")(di,trace,pointData),[pointData]}}if(-1!==hoveron.indexOf("fills")&&trace._polygons){var i,j,polygon,pts,xCross,x0,x1,y0,y1,polygons=trace._polygons,polygonsIn=[],inside=!1,xmin=1/0,xmax=-1/0,ymin=1/0,ymax=-1/0;for(i=0;i<polygons.length;i++)(polygon=polygons[i]).contains(pt)&&(inside=!inside,polygonsIn.push(polygon),ymin=Math.min(ymin,polygon.ymin),ymax=Math.max(ymax,polygon.ymax));if(inside){var yAvg=((ymin=Math.max(ymin,0))+(ymax=Math.min(ymax,ya._length)))/2;for(i=0;i<polygonsIn.length;i++)for(pts=polygonsIn[i].pts,j=1;j<pts.length;j++)(y0=pts[j-1][1])>yAvg!=(y1=pts[j][1])>=yAvg&&(x0=pts[j-1][0],x1=pts[j][0],y1-y0&&(xCross=x0+(x1-x0)*(yAvg-y0)/(y1-y0),xmin=Math.min(xmin,xCross),xmax=Math.max(xmax,xCross)));xmin=Math.max(xmin,0),xmax=Math.min(xmax,xa._length);var color=Color.defaultLine;return Color.opacity(trace.fillcolor)?color=trace.fillcolor:Color.opacity((trace.line||{}).color)&&(color=trace.line.color),Lib.extendFlat(pointData,{distance:pointData.maxHoverDistance,x0:xmin,x1:xmax,y0:yAvg,y1:yAvg,color:color}),delete pointData.index,trace.text&&!Array.isArray(trace.text)?pointData.text=String(trace.text):pointData.text=trace.name,[pointData]}}}},{"../../components/color":567,"../../components/fx":609,"../../lib":693,"../../registry":825,"./fill_hover_text":1040,"./get_trace_color":1042}],1044:[function(_dereq_,module,exports){"use strict";var Scatter={},subtypes=_dereq_("./subtypes");Scatter.hasLines=subtypes.hasLines,Scatter.hasMarkers=subtypes.hasMarkers,Scatter.hasText=subtypes.hasText,Scatter.isBubble=subtypes.isBubble,Scatter.attributes=_dereq_("./attributes"),Scatter.supplyDefaults=_dereq_("./defaults"),Scatter.cleanData=_dereq_("./clean_data"),Scatter.calc=_dereq_("./calc").calc,Scatter.crossTraceCalc=_dereq_("./cross_trace_calc"),Scatter.arraysToCalcdata=_dereq_("./arrays_to_calcdata"),Scatter.plot=_dereq_("./plot"),Scatter.colorbar=_dereq_("./marker_colorbar"),Scatter.style=_dereq_("./style").style,Scatter.styleOnSelect=_dereq_("./style").styleOnSelect,Scatter.hoverPoints=_dereq_("./hover"),Scatter.selectPoints=_dereq_("./select"),Scatter.animatable=!0,Scatter.moduleType="trace",Scatter.name="scatter",Scatter.basePlotModule=_dereq_("../../plots/cartesian"),Scatter.categories=["cartesian","svg","symbols","errorBarsOK","showLegend","scatter-like","zoomScale"],Scatter.meta={},module.exports=Scatter},{"../../plots/cartesian":753,"./arrays_to_calcdata":1031,"./attributes":1032,"./calc":1033,"./clean_data":1035,"./cross_trace_calc":1038,"./defaults":1039,"./hover":1043,"./marker_colorbar":1050,"./plot":1052,"./select":1053,"./style":1055,"./subtypes":1056}],1045:[function(_dereq_,module,exports){"use strict";var isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray,hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults");module.exports=function lineDefaults(traceIn,traceOut,defaultColor,layout,coerce,opts){var markerColor=(traceIn.marker||{}).color;(coerce("line.color",defaultColor),hasColorscale(traceIn,"line"))?colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"line.",cLetter:"c",noScale:!0}):coerce("line.color",!isArrayOrTypedArray(markerColor)&&markerColor||defaultColor);coerce("line.width"),(opts||{}).noDash||coerce("line.dash")}},{"../../components/colorscale/defaults":577,"../../components/colorscale/has_colorscale":581,"../../lib":693}],1046:[function(_dereq_,module,exports){"use strict";var numConstants=_dereq_("../../constants/numerical"),BADNUM=numConstants.BADNUM,LOG_CLIP=numConstants.LOG_CLIP,LOG_CLIP_PLUS=LOG_CLIP+.5,LOG_CLIP_MINUS=LOG_CLIP-.5,Lib=_dereq_("../../lib"),segmentsIntersect=Lib.segmentsIntersect,constrain=Lib.constrain,constants=_dereq_("./constants");module.exports=function linePoints(d,opts){var i,clusterStartPt,clusterEndPt,clusterHighPt,clusterLowPt,thisPt,clusterHighFirst,clusterUnitVector,thisVector,clusterRefDist,clusterHighVal,clusterLowVal,thisVal,clusterMinDeviation,clusterMaxDeviation,thisDeviation,latestXFrac,latestYFrac,xa=opts.xaxis,ya=opts.yaxis,xLog="log"===xa.type,yLog="log"===ya.type,xLen=xa._length,yLen=ya._length,connectGaps=opts.connectGaps,baseTolerance=opts.baseTolerance,shape=opts.shape,linear="linear"===shape,segments=[],minTolerance=constants.minTolerance,pts=new Array(d.length),pti=0;function getPt(index){var di=d[index];if(!di)return!1;var x=xa.c2p(di.x),y=ya.c2p(di.y);if(x===BADNUM){if(xLog&&(x=xa.c2p(di.x,!0)),x===BADNUM)return!1;yLog&&y===BADNUM&&(x*=Math.abs(xa._m*yLen*(xa._m>0?LOG_CLIP_PLUS:LOG_CLIP_MINUS)/(ya._m*xLen*(ya._m>0?LOG_CLIP_PLUS:LOG_CLIP_MINUS)))),x*=1e3}if(y===BADNUM){if(yLog&&(y=ya.c2p(di.y,!0)),y===BADNUM)return!1;y*=1e3}return[x,y]}function crossesViewport(xFrac0,yFrac0,xFrac1,yFrac1){var dx=xFrac1-xFrac0,dy=yFrac1-yFrac0,dx0=.5-xFrac0,dy0=.5-yFrac0,norm2=dx*dx+dy*dy,dot=dx*dx0+dy*dy0;if(dot>0&&dot<norm2){var cross=dx0*dy-dy0*dx;if(cross*cross<norm2)return!0}}function getTolerance(pt,nextPt){var xFrac=pt[0]/xLen,yFrac=pt[1]/yLen,offScreenFraction=Math.max(0,-xFrac,xFrac-1,-yFrac,yFrac-1);return offScreenFraction&&void 0!==latestXFrac&&crossesViewport(xFrac,yFrac,latestXFrac,latestYFrac)&&(offScreenFraction=0),offScreenFraction&&nextPt&&crossesViewport(xFrac,yFrac,nextPt[0]/xLen,nextPt[1]/yLen)&&(offScreenFraction=0),(1+constants.toleranceGrowth*offScreenFraction)*baseTolerance}function ptDist(pt1,pt2){var dx=pt1[0]-pt2[0],dy=pt1[1]-pt2[1];return Math.sqrt(dx*dx+dy*dy)}var xEdge,yEdge,lastXEdge,lastYEdge,lastFarPt,edgePt,getEdgeIntersections,maxScreensAway=constants.maxScreensAway,xEdge0=-xLen*maxScreensAway,xEdge1=xLen*(1+maxScreensAway),yEdge0=-yLen*maxScreensAway,yEdge1=yLen*(1+maxScreensAway),edges=[[xEdge0,yEdge0,xEdge1,yEdge0],[xEdge1,yEdge0,xEdge1,yEdge1],[xEdge1,yEdge1,xEdge0,yEdge1],[xEdge0,yEdge1,xEdge0,yEdge0]];function onlyConstrainedPoint(pt){if(pt[0]<xEdge0||pt[0]>xEdge1||pt[1]<yEdge0||pt[1]>yEdge1)return[constrain(pt[0],xEdge0,xEdge1),constrain(pt[1],yEdge0,yEdge1)]}function sameEdge(pt1,pt2){return pt1[0]===pt2[0]&&(pt1[0]===xEdge0||pt1[0]===xEdge1)||(pt1[1]===pt2[1]&&(pt1[1]===yEdge0||pt1[1]===yEdge1)||void 0)}function getABAEdgeIntersections(dim,limit0,limit1){return function(pt1,pt2){var ptInt1=onlyConstrainedPoint(pt1),ptInt2=onlyConstrainedPoint(pt2),out=[];if(ptInt1&&ptInt2&&sameEdge(ptInt1,ptInt2))return out;ptInt1&&out.push(ptInt1),ptInt2&&out.push(ptInt2);var midShift=2*Lib.constrain((pt1[dim]+pt2[dim])/2,limit0,limit1)-((ptInt1||pt1)[dim]+(ptInt2||pt2)[dim]);midShift&&((ptInt1&&ptInt2?midShift>0==ptInt1[dim]>ptInt2[dim]?ptInt1:ptInt2:ptInt1||ptInt2)[dim]+=midShift);return out}}function updateEdge(pt){var x=pt[0],y=pt[1],xSame=x===pts[pti-1][0],ySame=y===pts[pti-1][1];if(!xSame||!ySame)if(pti>1){var xSame2=x===pts[pti-2][0],ySame2=y===pts[pti-2][1];xSame&&(x===xEdge0||x===xEdge1)&&xSame2?ySame2?pti--:pts[pti-1]=pt:ySame&&(y===yEdge0||y===yEdge1)&&ySame2?xSame2?pti--:pts[pti-1]=pt:pts[pti++]=pt}else pts[pti++]=pt}function updateEdgesForReentry(pt){pts[pti-1][0]!==pt[0]&&pts[pti-1][1]!==pt[1]&&updateEdge([lastXEdge,lastYEdge]),updateEdge(pt),lastFarPt=null,lastXEdge=lastYEdge=0}function addPt(pt){if(latestXFrac=pt[0]/xLen,latestYFrac=pt[1]/yLen,xEdge=pt[0]<xEdge0?xEdge0:pt[0]>xEdge1?xEdge1:0,yEdge=pt[1]<yEdge0?yEdge0:pt[1]>yEdge1?yEdge1:0,xEdge||yEdge){if(pti)if(lastFarPt){var intersections=getEdgeIntersections(lastFarPt,pt);intersections.length>1&&(updateEdgesForReentry(intersections[0]),pts[pti++]=intersections[1])}else edgePt=getEdgeIntersections(pts[pti-1],pt)[0],pts[pti++]=edgePt;else pts[pti++]=[xEdge||pt[0],yEdge||pt[1]];var lastPt=pts[pti-1];xEdge&&yEdge&&(lastPt[0]!==xEdge||lastPt[1]!==yEdge)?(lastFarPt&&(lastXEdge!==xEdge&&lastYEdge!==yEdge?updateEdge(lastXEdge&&lastYEdge?function getClosestCorner(pt1,pt2){var dx=pt2[0]-pt1[0],m=(pt2[1]-pt1[1])/dx;return(pt1[1]*pt2[0]-pt2[1]*pt1[0])/dx>0?[m>0?xEdge0:xEdge1,yEdge1]:[m>0?xEdge1:xEdge0,yEdge0]}(lastFarPt,pt):[lastXEdge||xEdge,lastYEdge||yEdge]):lastXEdge&&lastYEdge&&updateEdge([lastXEdge,lastYEdge])),updateEdge([xEdge,yEdge])):lastXEdge-xEdge&&lastYEdge-yEdge&&updateEdge([xEdge||lastXEdge,yEdge||lastYEdge]),lastFarPt=pt,lastXEdge=xEdge,lastYEdge=yEdge}else lastFarPt&&updateEdgesForReentry(getEdgeIntersections(lastFarPt,pt)[0]),pts[pti++]=pt}for("linear"===shape||"spline"===shape?getEdgeIntersections=function getLinearEdgeIntersections(pt1,pt2){for(var out=[],ptCount=0,i=0;i<4;i++){var edge=edges[i],ptInt=segmentsIntersect(pt1[0],pt1[1],pt2[0],pt2[1],edge[0],edge[1],edge[2],edge[3]);ptInt&&(!ptCount||Math.abs(ptInt.x-out[0][0])>1||Math.abs(ptInt.y-out[0][1])>1)&&(ptInt=[ptInt.x,ptInt.y],ptCount&&ptDist(ptInt,pt1)<ptDist(out[0],pt1)?out.unshift(ptInt):out.push(ptInt),ptCount++)}return out}:"hv"===shape||"vh"===shape?getEdgeIntersections=function getHVEdgeIntersections(pt1,pt2){var out=[],ptInt1=onlyConstrainedPoint(pt1),ptInt2=onlyConstrainedPoint(pt2);return ptInt1&&ptInt2&&sameEdge(ptInt1,ptInt2)?out:(ptInt1&&out.push(ptInt1),ptInt2&&out.push(ptInt2),out)}:"hvh"===shape?getEdgeIntersections=getABAEdgeIntersections(0,xEdge0,xEdge1):"vhv"===shape&&(getEdgeIntersections=getABAEdgeIntersections(1,yEdge0,yEdge1)),i=0;i<d.length;i++)if(clusterStartPt=getPt(i)){for(pti=0,lastFarPt=null,addPt(clusterStartPt),i++;i<d.length;i++){if(!(clusterHighPt=getPt(i))){if(connectGaps)continue;break}if(linear&&opts.simplify){var nextPt=getPt(i+1);if(!((clusterRefDist=ptDist(clusterHighPt,clusterStartPt))<getTolerance(clusterHighPt,nextPt)*minTolerance)){for(clusterUnitVector=[(clusterHighPt[0]-clusterStartPt[0])/clusterRefDist,(clusterHighPt[1]-clusterStartPt[1])/clusterRefDist],clusterLowPt=clusterStartPt,clusterHighVal=clusterRefDist,clusterLowVal=clusterMinDeviation=clusterMaxDeviation=0,clusterHighFirst=!1,clusterEndPt=clusterHighPt,i++;i<d.length;i++){if(thisPt=nextPt,nextPt=getPt(i+1),!thisPt){if(connectGaps)continue;break}if(thisDeviation=(thisVector=[thisPt[0]-clusterStartPt[0],thisPt[1]-clusterStartPt[1]])[0]*clusterUnitVector[1]-thisVector[1]*clusterUnitVector[0],clusterMinDeviation=Math.min(clusterMinDeviation,thisDeviation),(clusterMaxDeviation=Math.max(clusterMaxDeviation,thisDeviation))-clusterMinDeviation>getTolerance(thisPt,nextPt))break;clusterEndPt=thisPt,(thisVal=thisVector[0]*clusterUnitVector[0]+thisVector[1]*clusterUnitVector[1])>clusterHighVal?(clusterHighVal=thisVal,clusterHighPt=thisPt,clusterHighFirst=!1):thisVal<clusterLowVal&&(clusterLowVal=thisVal,clusterLowPt=thisPt,clusterHighFirst=!0)}if(clusterHighFirst?(addPt(clusterHighPt),clusterEndPt!==clusterLowPt&&addPt(clusterLowPt)):(clusterLowPt!==clusterStartPt&&addPt(clusterLowPt),clusterEndPt!==clusterHighPt&&addPt(clusterHighPt)),addPt(clusterEndPt),i>=d.length||!thisPt)break;addPt(thisPt),clusterStartPt=thisPt}}else addPt(clusterHighPt)}lastFarPt&&updateEdge([lastXEdge||lastFarPt[0],lastYEdge||lastFarPt[1]]),segments.push(pts.slice(0,pti))}return segments}},{"../../constants/numerical":670,"../../lib":693,"./constants":1037}],1047:[function(_dereq_,module,exports){"use strict";module.exports=function handleLineShapeDefaults(traceIn,traceOut,coerce){"spline"===coerce("line.shape")&&coerce("line.smoothing")}},{}],1048:[function(_dereq_,module,exports){"use strict";var LINKEDFILLS={tonextx:1,tonexty:1,tonext:1};module.exports=function linkTraces(gd,plotinfo,cdscatter){var trace,i,group,prevtrace,groupIndex,groupIndices={},needsSort=!1,prevGroupIndex=-1,nextGroupIndex=0,prevUnstackedGroupIndex=-1;for(i=0;i<cdscatter.length;i++)(group=(trace=cdscatter[i][0].trace).stackgroup||"")?group in groupIndices?groupIndex=groupIndices[group]:(groupIndex=groupIndices[group]=nextGroupIndex,nextGroupIndex++):trace.fill in LINKEDFILLS&&prevUnstackedGroupIndex>=0?groupIndex=prevUnstackedGroupIndex:(groupIndex=prevUnstackedGroupIndex=nextGroupIndex,nextGroupIndex++),groupIndex<prevGroupIndex&&(needsSort=!0),trace._groupIndex=prevGroupIndex=groupIndex;var cdscatterSorted=cdscatter.slice();needsSort&&cdscatterSorted.sort(function(a,b){var traceA=a[0].trace,traceB=b[0].trace;return traceA._groupIndex-traceB._groupIndex||traceA.index-traceB.index});var prevtraces={};for(i=0;i<cdscatterSorted.length;i++)group=(trace=cdscatterSorted[i][0].trace).stackgroup||"",!0===trace.visible?(trace._nexttrace=null,trace.fill in LINKEDFILLS&&(prevtrace=prevtraces[group],trace._prevtrace=prevtrace||null,prevtrace&&(prevtrace._nexttrace=trace)),prevtraces[group]=trace):trace._prevtrace=trace._nexttrace=null;return cdscatterSorted}},{}],1049:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric");module.exports=function makeBubbleSizeFn(trace){var marker=trace.marker,sizeRef=marker.sizeref||1,sizeMin=marker.sizemin||0,baseFn="area"===marker.sizemode?function(v){return Math.sqrt(v/sizeRef)}:function(v){return v/sizeRef};return function(v){var baseSize=baseFn(v/2);return isNumeric(baseSize)&&baseSize>0?Math.max(baseSize,sizeMin):0}}},{"fast-isnumeric":213}],1050:[function(_dereq_,module,exports){"use strict";module.exports={container:"marker",min:"cmin",max:"cmax"}},{}],1051:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),hasColorscale=_dereq_("../../components/colorscale/has_colorscale"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),subTypes=_dereq_("./subtypes");module.exports=function markerDefaults(traceIn,traceOut,defaultColor,layout,coerce,opts){var isBubble=subTypes.isBubble(traceIn),lineColor=(traceIn.line||{}).color;(opts=opts||{},lineColor&&(defaultColor=lineColor),coerce("marker.symbol"),coerce("marker.opacity",isBubble?.7:1),coerce("marker.size"),coerce("marker.color",defaultColor),hasColorscale(traceIn,"marker")&&colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"marker.",cLetter:"c"}),opts.noSelect||(coerce("selected.marker.color"),coerce("unselected.marker.color"),coerce("selected.marker.size"),coerce("unselected.marker.size")),opts.noLine||(coerce("marker.line.color",lineColor&&!Array.isArray(lineColor)&&traceOut.marker.color!==lineColor?lineColor:isBubble?Color.background:Color.defaultLine),hasColorscale(traceIn,"marker.line")&&colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"marker.line.",cLetter:"c"}),coerce("marker.line.width",isBubble?1:0)),isBubble&&(coerce("marker.sizeref"),coerce("marker.sizemin"),coerce("marker.sizemode")),opts.gradient)&&("none"!==coerce("marker.gradient.type")&&coerce("marker.gradient.color"))}},{"../../components/color":567,"../../components/colorscale/defaults":577,"../../components/colorscale/has_colorscale":581,"./subtypes":1056}],1052:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),ensureSingle=Lib.ensureSingle,identity=Lib.identity,Drawing=_dereq_("../../components/drawing"),subTypes=_dereq_("./subtypes"),linePoints=_dereq_("./line_points"),linkTraces=_dereq_("./link_traces"),polygonTester=_dereq_("../../lib/polygon").tester;function plotOne(gd,idx,plotinfo,cdscatter,cdscatterAll,element,transitionOpts){var i;!function selectMarkers(gd,idx,plotinfo,cdscatter,cdscatterAll){var xa=plotinfo.xaxis,ya=plotinfo.yaxis,xr=d3.extent(Lib.simpleMap(xa.range,xa.r2c)),yr=d3.extent(Lib.simpleMap(ya.range,ya.r2c)),trace=cdscatter[0].trace;if(!subTypes.hasMarkers(trace))return;var mnum=trace.marker.maxdisplayed;if(0===mnum)return;var cd=cdscatter.filter(function(v){return v.x>=xr[0]&&v.x<=xr[1]&&v.y>=yr[0]&&v.y<=yr[1]}),inc=Math.ceil(cd.length/mnum),tnum=0;cdscatterAll.forEach(function(cdj,j){var tracei=cdj[0].trace;subTypes.hasMarkers(tracei)&&tracei.marker.maxdisplayed>0&&j<idx&&tnum++});var i0=Math.round(tnum*inc/3+Math.floor(tnum/3)*inc/7.1);cdscatter.forEach(function(v){delete v.vis}),cd.forEach(function(v,i){0===Math.round((i+i0)%inc)&&(v.vis=!0)})}(0,idx,plotinfo,cdscatter,cdscatterAll);var hasTransition=!!transitionOpts&&transitionOpts.duration>0;function transition(selection){return hasTransition?selection.transition():selection}var xa=plotinfo.xaxis,ya=plotinfo.yaxis,trace=cdscatter[0].trace,line=trace.line,tr=d3.select(element),errorBarGroup=ensureSingle(tr,"g","errorbars"),lines=ensureSingle(tr,"g","lines"),points=ensureSingle(tr,"g","points"),text=ensureSingle(tr,"g","text");if(Registry.getComponentMethod("errorbars","plot")(errorBarGroup,plotinfo,transitionOpts),!0===trace.visible){var ownFillEl3,tonext;transition(tr).style("opacity",trace.opacity);var ownFillDir=trace.fill.charAt(trace.fill.length-1);"x"!==ownFillDir&&"y"!==ownFillDir&&(ownFillDir=""),plotinfo.isRangePlot||(cdscatter[0].node3=tr);var prevRevpath="",prevPolygons=[],prevtrace=trace._prevtrace;prevtrace&&(prevRevpath=prevtrace._prevRevpath||"",tonext=prevtrace._nextFill,prevPolygons=prevtrace._polygons);var thispath,thisrevpath,pathfn,revpathbase,revpathfn,pt0,lastSegment,pt1,thisPolygons,fullpath="",revpath="",segments=[],makeUpdate=Lib.noop;if(ownFillEl3=trace._ownFill,subTypes.hasLines(trace)||"none"!==trace.fill){for(tonext&&tonext.datum(cdscatter),-1!==["hv","vh","hvh","vhv"].indexOf(line.shape)?(pathfn=Drawing.steps(line.shape),revpathbase=Drawing.steps(line.shape.split("").reverse().join(""))):pathfn=revpathbase="spline"===line.shape?function(pts){var pLast=pts[pts.length-1];return pts.length>1&&pts[0][0]===pLast[0]&&pts[0][1]===pLast[1]?Drawing.smoothclosed(pts.slice(1),line.smoothing):Drawing.smoothopen(pts,line.smoothing)}:function(pts){return"M"+pts.join("L")},revpathfn=function(pts){return revpathbase(pts.reverse())},segments=linePoints(cdscatter,{xaxis:xa,yaxis:ya,connectGaps:trace.connectgaps,baseTolerance:Math.max(line.width||1,3)/4,shape:line.shape,simplify:line.simplify}),thisPolygons=trace._polygons=new Array(segments.length),i=0;i<segments.length;i++)trace._polygons[i]=polygonTester(segments[i]);segments.length&&(pt0=segments[0][0],pt1=(lastSegment=segments[segments.length-1])[lastSegment.length-1]),makeUpdate=function(isEnter){return function(pts){if(thispath=pathfn(pts),thisrevpath=revpathfn(pts),fullpath?ownFillDir?(fullpath+="L"+thispath.substr(1),revpath=thisrevpath+"L"+revpath.substr(1)):(fullpath+="Z"+thispath,revpath=thisrevpath+"Z"+revpath):(fullpath=thispath,revpath=thisrevpath),subTypes.hasLines(trace)&&pts.length>1){var el=d3.select(this);if(el.datum(cdscatter),isEnter)transition(el.style("opacity",0).attr("d",thispath).call(Drawing.lineGroupStyle)).style("opacity",1);else{var sel=transition(el);sel.attr("d",thispath),Drawing.singleLineStyle(cdscatter,sel)}}}}}var lineJoin=lines.selectAll(".js-line").data(segments);transition(lineJoin.exit()).style("opacity",0).remove(),lineJoin.each(makeUpdate(!1)),lineJoin.enter().append("path").classed("js-line",!0).style("vector-effect","non-scaling-stroke").call(Drawing.lineGroupStyle).each(makeUpdate(!0)),Drawing.setClipUrl(lineJoin,plotinfo.layerClipId),segments.length?(ownFillEl3?(ownFillEl3.datum(cdscatter),pt0&&pt1&&(ownFillDir?("y"===ownFillDir?pt0[1]=pt1[1]=ya.c2p(0,!0):"x"===ownFillDir&&(pt0[0]=pt1[0]=xa.c2p(0,!0)),transition(ownFillEl3).attr("d","M"+pt1+"L"+pt0+"L"+fullpath.substr(1)).call(Drawing.singleFillStyle)):transition(ownFillEl3).attr("d",fullpath+"Z").call(Drawing.singleFillStyle))):tonext&&("tonext"===trace.fill.substr(0,6)&&fullpath&&prevRevpath?("tonext"===trace.fill?transition(tonext).attr("d",fullpath+"Z"+prevRevpath+"Z").call(Drawing.singleFillStyle):transition(tonext).attr("d",fullpath+"L"+prevRevpath.substr(1)+"Z").call(Drawing.singleFillStyle),trace._polygons=trace._polygons.concat(prevPolygons)):(clearFill(tonext),trace._polygons=null)),trace._prevRevpath=revpath,trace._prevPolygons=thisPolygons):(ownFillEl3?clearFill(ownFillEl3):tonext&&clearFill(tonext),trace._polygons=trace._prevRevpath=trace._prevPolygons=null),points.datum(cdscatter),text.datum(cdscatter),function makePoints(points,text,cdscatter){var join,trace=cdscatter[0].trace,showMarkers=subTypes.hasMarkers(trace),showText=subTypes.hasText(trace),keyFunc=getKeyFunc(trace),markerFilter=hideFilter,textFilter=hideFilter;if(showMarkers||showText){var showFilter=identity,stackGroup=trace.stackgroup,isInferZero=stackGroup&&"infer zero"===gd._fullLayout._scatterStackOpts[xa._id+ya._id][stackGroup].stackgaps;trace.marker.maxdisplayed||trace._needsCull?showFilter=isInferZero?visFilterWithGaps:visFilter:stackGroup&&!isInferZero&&(showFilter=gapFilter),showMarkers&&(markerFilter=showFilter),showText&&(textFilter=showFilter)}var styleFns,enter=(join=points.selectAll("path.point").data(markerFilter,keyFunc)).enter().append("path").classed("point",!0);hasTransition&&enter.call(Drawing.pointStyle,trace,gd).call(Drawing.translatePoints,xa,ya).style("opacity",0).transition().style("opacity",1),join.order(),showMarkers&&(styleFns=Drawing.makePointStyleFns(trace)),join.each(function(d){var el=d3.select(this),sel=transition(el);Drawing.translatePoint(d,sel,xa,ya)?(Drawing.singlePointStyle(d,sel,trace,styleFns,gd),plotinfo.layerClipId&&Drawing.hideOutsideRangePoint(d,sel,xa,ya,trace.xcalendar,trace.ycalendar),trace.customdata&&el.classed("plotly-customdata",null!==d.data&&void 0!==d.data)):sel.remove()}),hasTransition?join.exit().transition().style("opacity",0).remove():join.exit().remove(),(join=text.selectAll("g").data(textFilter,keyFunc)).enter().append("g").classed("textpoint",!0).append("text"),join.order(),join.each(function(d){var g=d3.select(this),sel=transition(g.select("text"));Drawing.translatePoint(d,sel,xa,ya)?plotinfo.layerClipId&&Drawing.hideOutsideRangePoint(d,g,xa,ya,trace.xcalendar,trace.ycalendar):g.remove()}),join.selectAll("text").call(Drawing.textPointStyle,trace,gd).each(function(d){var x=xa.c2p(d.x),y=ya.c2p(d.y);d3.select(this).selectAll("tspan.line").each(function(){transition(d3.select(this)).attr({x:x,y:y})})}),join.exit().remove()}(points,text,cdscatter);var clipUrl=!1===trace.cliponaxis?null:plotinfo.layerClipId;Drawing.setClipUrl(points,clipUrl),Drawing.setClipUrl(text,clipUrl)}function clearFill(selection){transition(selection).attr("d","M0,0Z")}function visFilter(d){return d.filter(function(v){return!v.gap&&v.vis})}function visFilterWithGaps(d){return d.filter(function(v){return v.vis})}function gapFilter(d){return d.filter(function(v){return!v.gap})}function keyFunc(d){return d.id}function getKeyFunc(trace){if(trace.ids)return keyFunc}function hideFilter(){return!1}}module.exports=function plot(gd,plotinfo,cdscatter,scatterLayer,transitionOpts,makeOnCompleteCallback){var join,onComplete,isFullReplot=!transitionOpts,hasTransition=!!transitionOpts&&transitionOpts.duration>0,cdscatterSorted=linkTraces(gd,plotinfo,cdscatter);((join=scatterLayer.selectAll("g.trace").data(cdscatterSorted,function(d){return d[0].trace.uid})).enter().append("g").attr("class",function(d){return"trace scatter trace"+d[0].trace.uid}).style("stroke-miterlimit",2),join.order(),function createFills(gd,traceJoin,plotinfo){traceJoin.each(function(d){var fills=ensureSingle(d3.select(this),"g","fills");Drawing.setClipUrl(fills,plotinfo.layerClipId);var trace=d[0].trace,fillData=[];trace.fill&&("tozero"===trace.fill.substr(0,6)||"toself"===trace.fill||"to"===trace.fill.substr(0,2)&&!trace._prevtrace)&&(fillData=["_ownFill"]),trace._nexttrace&&fillData.push("_nextFill");var fillJoin=fills.selectAll("g").data(fillData,identity);fillJoin.enter().append("g"),fillJoin.exit().each(function(d){trace[d]=null}).remove(),fillJoin.order().each(function(d){trace[d]=ensureSingle(d3.select(this),"path","js-fill")})})}(0,join,plotinfo),hasTransition)?(makeOnCompleteCallback&&(onComplete=makeOnCompleteCallback()),d3.transition().duration(transitionOpts.duration).ease(transitionOpts.easing).each("end",function(){onComplete&&onComplete()}).each("interrupt",function(){onComplete&&onComplete()}).each(function(){scatterLayer.selectAll("g.trace").each(function(d,i){plotOne(gd,i,plotinfo,d,cdscatterSorted,this,transitionOpts)})})):join.each(function(d,i){plotOne(gd,i,plotinfo,d,cdscatterSorted,this,transitionOpts)});isFullReplot&&join.exit().remove(),scatterLayer.selectAll("path:not([d])").remove()}},{"../../components/drawing":592,"../../lib":693,"../../lib/polygon":706,"../../registry":825,"./line_points":1046,"./link_traces":1048,"./subtypes":1056,d3:147}],1053:[function(_dereq_,module,exports){"use strict";var subtypes=_dereq_("./subtypes");module.exports=function selectPoints(searchInfo,selectionTester){var i,di,x,y,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[],trace=cd[0].trace;if(!subtypes.hasMarkers(trace)&&!subtypes.hasText(trace))return[];if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++)di=cd[i],x=xa.c2p(di.x),y=ya.c2p(di.y),null!==di.i&&selectionTester.contains([x,y],!1,i,searchInfo)?(selection.push({pointNumber:di.i,x:xa.c2d(di.x),y:ya.c2d(di.y)}),di.selected=1):di.selected=0;return selection}},{"./subtypes":1056}],1054:[function(_dereq_,module,exports){"use strict";var perStackAttrs=["orientation","groupnorm","stackgaps"];module.exports=function handleStackDefaults(traceIn,traceOut,layout,coerce){var stackOpts=layout._scatterStackOpts,stackGroup=coerce("stackgroup");if(stackGroup){var subplot=traceOut.xaxis+traceOut.yaxis,subplotStackOpts=stackOpts[subplot];subplotStackOpts||(subplotStackOpts=stackOpts[subplot]={});var groupOpts=subplotStackOpts[stackGroup],firstTrace=!1;groupOpts?groupOpts.traces.push(traceOut):(groupOpts=subplotStackOpts[stackGroup]={traceIndices:[],traces:[traceOut]},firstTrace=!0);for(var dflts={orientation:traceOut.x&&!traceOut.y?"h":"v"},i=0;i<perStackAttrs.length;i++){var attr=perStackAttrs[i],attrFound=attr+"Found";if(!groupOpts[attrFound]){var traceHasAttr=void 0!==traceIn[attr],isOrientation="orientation"===attr;if((traceHasAttr||firstTrace)&&(groupOpts[attr]=coerce(attr,dflts[attr]),isOrientation&&(groupOpts.fillDflt="h"===groupOpts[attr]?"tonextx":"tonexty"),traceHasAttr&&(groupOpts[attrFound]=!0,!firstTrace&&(delete groupOpts.traces[0][attr],isOrientation))))for(var j=0;j<groupOpts.traces.length-1;j++){var trace2=groupOpts.traces[j];trace2._input.fill!==trace2.fill&&(trace2.fill=groupOpts.fillDflt)}}}return groupOpts}}},{}],1055:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),Registry=_dereq_("../../registry");function stylePoints(sel,trace,gd){Drawing.pointStyle(sel.selectAll("path.point"),trace,gd)}function styleText(sel,trace,gd){Drawing.textPointStyle(sel.selectAll("text"),trace,gd)}module.exports={style:function style(gd,cd){var s=cd?cd[0].node3:d3.select(gd).selectAll("g.trace.scatter");s.style("opacity",function(d){return d[0].trace.opacity}),s.selectAll("g.points").each(function(d){stylePoints(d3.select(this),d.trace||d[0].trace,gd)}),s.selectAll("g.text").each(function(d){styleText(d3.select(this),d.trace||d[0].trace,gd)}),s.selectAll("g.trace path.js-line").call(Drawing.lineGroupStyle),s.selectAll("g.trace path.js-fill").call(Drawing.fillGroupStyle),Registry.getComponentMethod("errorbars","style")(s)},stylePoints:stylePoints,styleText:styleText,styleOnSelect:function styleOnSelect(gd,cd){var s=cd[0].node3,trace=cd[0].trace;trace.selectedpoints?(Drawing.selectedPointStyle(s.selectAll("path.point"),trace),Drawing.selectedTextStyle(s.selectAll("text"),trace)):(stylePoints(s,trace,gd),styleText(s,trace,gd))}}},{"../../components/drawing":592,"../../registry":825,d3:147}],1056:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports={hasLines:function(trace){return trace.visible&&trace.mode&&-1!==trace.mode.indexOf("lines")},hasMarkers:function(trace){return trace.visible&&(trace.mode&&-1!==trace.mode.indexOf("markers")||"splom"===trace.type)},hasText:function(trace){return trace.visible&&trace.mode&&-1!==trace.mode.indexOf("text")},isBubble:function(trace){return Lib.isPlainObject(trace.marker)&&Lib.isArrayOrTypedArray(trace.marker.size)}}},{"../../lib":693}],1057:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib");module.exports=function(traceIn,traceOut,layout,coerce,opts){opts=opts||{},coerce("textposition"),Lib.coerceFont(coerce,"textfont",layout.font),opts.noSelect||(coerce("selected.textfont.color"),coerce("unselected.textfont.color"))}},{"../../lib":693}],1058:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry");module.exports=function handleXYDefaults(traceIn,traceOut,layout,coerce){var len,x=coerce("x"),y=coerce("y");if(Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y"],layout),x)y?len=Math.min(x.length,y.length):(len=x.length,coerce("y0"),coerce("dy"));else{if(!y)return 0;len=traceOut.y.length,coerce("x0"),coerce("dx")}return traceOut._length=len,len}},{"../../registry":825}],1059:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),colorAttributes=_dereq_("../../components/colorscale/attributes"),baseAttrs=_dereq_("../../plots/attributes"),DASHES=_dereq_("../../constants/gl3d_dashes"),MARKER_SYMBOLS=_dereq_("../../constants/gl3d_markers"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,scatterLineAttrs=scatterAttrs.line,scatterMarkerAttrs=scatterAttrs.marker,scatterMarkerLineAttrs=scatterMarkerAttrs.line,lineAttrs=extendFlat({width:scatterLineAttrs.width,dash:{valType:"enumerated",values:Object.keys(DASHES),dflt:"solid"}},colorAttributes("line"));delete lineAttrs.showscale,delete lineAttrs.colorbar;var attrs=module.exports=overrideAll({x:scatterAttrs.x,y:scatterAttrs.y,z:{valType:"data_array"},text:extendFlat({},scatterAttrs.text,{}),hovertext:extendFlat({},scatterAttrs.hovertext,{}),mode:extendFlat({},scatterAttrs.mode,{dflt:"lines+markers"}),surfaceaxis:{valType:"enumerated",values:[-1,0,1,2],dflt:-1},surfacecolor:{valType:"color"},projection:{x:{show:{valType:"boolean",dflt:!1},opacity:{valType:"number",min:0,max:1,dflt:1},scale:{valType:"number",min:0,max:10,dflt:2/3}},y:{show:{valType:"boolean",dflt:!1},opacity:{valType:"number",min:0,max:1,dflt:1},scale:{valType:"number",min:0,max:10,dflt:2/3}},z:{show:{valType:"boolean",dflt:!1},opacity:{valType:"number",min:0,max:1,dflt:1},scale:{valType:"number",min:0,max:10,dflt:2/3}}},connectgaps:scatterAttrs.connectgaps,line:lineAttrs,marker:extendFlat({symbol:{valType:"enumerated",values:Object.keys(MARKER_SYMBOLS),dflt:"circle",arrayOk:!0},size:extendFlat({},scatterMarkerAttrs.size,{dflt:8}),sizeref:scatterMarkerAttrs.sizeref,sizemin:scatterMarkerAttrs.sizemin,sizemode:scatterMarkerAttrs.sizemode,opacity:extendFlat({},scatterMarkerAttrs.opacity,{arrayOk:!1}),colorbar:scatterMarkerAttrs.colorbar,line:extendFlat({width:extendFlat({},scatterMarkerLineAttrs.width,{arrayOk:!1})},colorAttributes("marker.line"))},colorAttributes("marker")),textposition:extendFlat({},scatterAttrs.textposition,{dflt:"top center",arrayOk:!1}),textfont:{color:scatterAttrs.textfont.color,size:scatterAttrs.textfont.size,family:extendFlat({},scatterAttrs.textfont.family,{arrayOk:!1})},hoverinfo:extendFlat({},baseAttrs.hoverinfo)},"calc","nested");attrs.x.editType=attrs.y.editType=attrs.z.editType="calc+clearAxisTypes"},{"../../components/colorscale/attributes":574,"../../constants/gl3d_dashes":667,"../../constants/gl3d_markers":668,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739,"../scatter/attributes":1032}],1060:[function(_dereq_,module,exports){"use strict";var arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcColorscales=_dereq_("../scatter/colorscale_calc");module.exports=function calc(gd,trace){var cd=[{x:!1,y:!1,trace:trace,t:{}}];return arraysToCalcdata(cd,trace),calcColorscales(trace),cd}},{"../scatter/arrays_to_calcdata":1031,"../scatter/colorscale_calc":1036}],1061:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry");function calculateAxisErrors(data,params,scaleFactor,axis){if(!params||!params.visible)return null;for(var computeError=Registry.getComponentMethod("errorbars","makeComputeError")(params),result=new Array(data.length),i=0;i<data.length;i++){var errors=computeError(+data[i],i);if("log"===axis.type){var point=axis.c2l(data[i]),min=data[i]-errors[0],max=data[i]+errors[1];if(result[i]=[(axis.c2l(min,!0)-point)*scaleFactor,(axis.c2l(max,!0)-point)*scaleFactor],min>0){var lower=axis.c2l(min);axis._lowerLogErrorBound||(axis._lowerLogErrorBound=lower),axis._lowerErrorBound=Math.min(axis._lowerLogErrorBound,lower)}}else result[i]=[-errors[0]*scaleFactor,errors[1]*scaleFactor]}return result}module.exports=function calculateErrors(data,scaleFactor,sceneLayout){var errors=[calculateAxisErrors(data.x,data.error_x,scaleFactor[0],sceneLayout.xaxis),calculateAxisErrors(data.y,data.error_y,scaleFactor[1],sceneLayout.yaxis),calculateAxisErrors(data.z,data.error_z,scaleFactor[2],sceneLayout.zaxis)],n=function dataLength(array){for(var i=0;i<array.length;i++)if(array[i])return array[i].length;return 0}(errors);if(0===n)return null;for(var errorBounds=new Array(n),i=0;i<n;i++){for(var bound=[[0,0,0],[0,0,0]],j=0;j<3;j++)if(errors[j])for(var k=0;k<2;k++)bound[k][j]=errors[j][i][k];errorBounds[i]=bound}return errorBounds}},{"../../registry":825}],1062:[function(_dereq_,module,exports){"use strict";var createLinePlot=_dereq_("gl-line3d"),createScatterPlot=_dereq_("gl-scatter3d"),createErrorBars=_dereq_("gl-error3d"),createMesh=_dereq_("gl-mesh3d"),triangulate=_dereq_("delaunay-triangulate"),Lib=_dereq_("../../lib"),str2RgbaArray=_dereq_("../../lib/str2rgbarray"),formatColor=_dereq_("../../lib/gl_format_color").formatColor,makeBubbleSizeFn=_dereq_("../scatter/make_bubble_size_func"),DASH_PATTERNS=_dereq_("../../constants/gl3d_dashes"),MARKER_SYMBOLS=_dereq_("../../constants/gl3d_markers"),calculateError=_dereq_("./calc_errors");function LineWithMarkers(scene,uid){this.scene=scene,this.uid=uid,this.linePlot=null,this.scatterPlot=null,this.errorBars=null,this.textMarkers=null,this.delaunayMesh=null,this.color=null,this.mode="",this.dataPoints=[],this.axesBounds=[[-1/0,-1/0,-1/0],[1/0,1/0,1/0]],this.textLabels=null,this.data=null}var proto=LineWithMarkers.prototype;function calculateSize(sizeIn,sizeFn){return sizeFn(4*sizeIn)}function calculateSymbol(symbolIn){return MARKER_SYMBOLS[symbolIn]}function formatParam(paramIn,len,calculate,dflt,extraFn){var paramOut=null;if(Lib.isArrayOrTypedArray(paramIn)){paramOut=[];for(var i=0;i<len;i++)void 0===paramIn[i]?paramOut[i]=dflt:paramOut[i]=calculate(paramIn[i],extraFn)}else paramOut=calculate(paramIn,Lib.identity);return paramOut}function convertPlotlyOptions(scene,data){var params,i,xc,yc,zc,text,points=[],sceneLayout=scene.fullSceneLayout,scaleFactor=scene.dataScale,xaxis=sceneLayout.xaxis,yaxis=sceneLayout.yaxis,zaxis=sceneLayout.zaxis,marker=data.marker,line=data.line,x=data.x||[],y=data.y||[],z=data.z||[],len=x.length,xcalendar=data.xcalendar,ycalendar=data.ycalendar,zcalendar=data.zcalendar;for(i=0;i<len;i++)xc=xaxis.d2l(x[i],0,xcalendar)*scaleFactor[0],yc=yaxis.d2l(y[i],0,ycalendar)*scaleFactor[1],zc=zaxis.d2l(z[i],0,zcalendar)*scaleFactor[2],points[i]=[xc,yc,zc];if(Array.isArray(data.text))text=data.text;else if(void 0!==data.text)for(text=new Array(len),i=0;i<len;i++)text[i]=data.text;if(params={position:points,mode:data.mode,text:text},"line"in data&&(params.lineColor=formatColor(line,1,len),params.lineWidth=line.width,params.lineDashes=line.dash),"marker"in data){var sizeFn=makeBubbleSizeFn(data);params.scatterColor=formatColor(marker,1,len),params.scatterSize=formatParam(marker.size,len,calculateSize,20,sizeFn),params.scatterMarker=formatParam(marker.symbol,len,calculateSymbol,""),params.scatterLineWidth=marker.line.width,params.scatterLineColor=formatColor(marker.line,1,len),params.scatterAngle=0}"textposition"in data&&(params.textOffset=function calculateTextOffset(tp){var textOffset=[0,0];return Array.isArray(tp)?[0,-1]:(tp.indexOf("bottom")>=0&&(textOffset[1]+=1),tp.indexOf("top")>=0&&(textOffset[1]-=1),tp.indexOf("left")>=0&&(textOffset[0]-=1),tp.indexOf("right")>=0&&(textOffset[0]+=1),textOffset)}(data.textposition),params.textColor=formatColor(data.textfont,1,len),params.textSize=formatParam(data.textfont.size,len,Lib.identity,12),params.textFont=data.textfont.family,params.textAngle=0);var dims=["x","y","z"];for(params.project=[!1,!1,!1],params.projectScale=[1,1,1],params.projectOpacity=[1,1,1],i=0;i<3;++i){var projection=data.projection[dims[i]];(params.project[i]=projection.show)&&(params.projectOpacity[i]=projection.opacity,params.projectScale[i]=projection.scale)}params.errorBounds=calculateError(data,scaleFactor,sceneLayout);var errorParams=function calculateErrorParams(errors){for(var capSize=[0,0,0],color=[[0,0,0],[0,0,0],[0,0,0]],lineWidth=[1,1,1],i=0;i<3;i++){var e=errors[i];e&&!1!==e.copy_zstyle&&!1!==errors[2].visible&&(e=errors[2]),e&&e.visible&&(capSize[i]=e.width/2,color[i]=str2RgbaArray(e.color),lineWidth[i]=e.thickness)}return{capSize:capSize,color:color,lineWidth:lineWidth}}([data.error_x,data.error_y,data.error_z]);return params.errorColor=errorParams.color,params.errorLineWidth=errorParams.lineWidth,params.errorCapSize=errorParams.capSize,params.delaunayAxis=data.surfaceaxis,params.delaunayColor=str2RgbaArray(data.surfacecolor),params}function arrayToColor(color){if(Array.isArray(color)){var c=color[0];return Array.isArray(c)&&(color=c),"rgb("+color.slice(0,3).map(function(x){return Math.round(255*x)})+")"}return null}proto.handlePick=function(selection){if(selection.object&&(selection.object===this.linePlot||selection.object===this.delaunayMesh||selection.object===this.textMarkers||selection.object===this.scatterPlot)){var ind=selection.index=selection.data.index;return selection.object.highlight&&selection.object.highlight(null),this.scatterPlot&&(selection.object=this.scatterPlot,this.scatterPlot.highlight(selection.data)),selection.textLabel="",this.textLabels&&(Array.isArray(this.textLabels)?(this.textLabels[ind]||0===this.textLabels[ind])&&(selection.textLabel=this.textLabels[ind]):selection.textLabel=this.textLabels),selection.traceCoordinate=[this.data.x[ind],this.data.y[ind],this.data.z[ind]],!0}},proto.update=function(data){var lineOptions,scatterOptions,errorOptions,textOptions,gl=this.scene.glplot.gl,dashPattern=DASH_PATTERNS.solid;this.data=data;var options=convertPlotlyOptions(this.scene,data);"mode"in options&&(this.mode=options.mode),"lineDashes"in options&&options.lineDashes in DASH_PATTERNS&&(dashPattern=DASH_PATTERNS[options.lineDashes]),this.color=arrayToColor(options.scatterColor)||arrayToColor(options.lineColor),this.dataPoints=options.position,lineOptions={gl:gl,position:options.position,color:options.lineColor,lineWidth:options.lineWidth||1,dashes:dashPattern[0],dashScale:dashPattern[1],opacity:data.opacity,connectGaps:data.connectgaps},-1!==this.mode.indexOf("lines")?this.linePlot?this.linePlot.update(lineOptions):(this.linePlot=createLinePlot(lineOptions),this.linePlot._trace=this,this.scene.glplot.add(this.linePlot)):this.linePlot&&(this.scene.glplot.remove(this.linePlot),this.linePlot.dispose(),this.linePlot=null);var scatterOpacity=data.opacity;if(data.marker&&data.marker.opacity&&(scatterOpacity*=data.marker.opacity),scatterOptions={gl:gl,position:options.position,color:options.scatterColor,size:options.scatterSize,glyph:options.scatterMarker,opacity:scatterOpacity,orthographic:!0,lineWidth:options.scatterLineWidth,lineColor:options.scatterLineColor,project:options.project,projectScale:options.projectScale,projectOpacity:options.projectOpacity},-1!==this.mode.indexOf("markers")?this.scatterPlot?this.scatterPlot.update(scatterOptions):(this.scatterPlot=createScatterPlot(scatterOptions),this.scatterPlot._trace=this,this.scatterPlot.highlightScale=1,this.scene.glplot.add(this.scatterPlot)):this.scatterPlot&&(this.scene.glplot.remove(this.scatterPlot),this.scatterPlot.dispose(),this.scatterPlot=null),textOptions={gl:gl,position:options.position,glyph:options.text,color:options.textColor,size:options.textSize,angle:options.textAngle,alignment:options.textOffset,font:options.textFont,orthographic:!0,lineWidth:0,project:!1,opacity:data.opacity},this.textLabels=data.hovertext||data.text,-1!==this.mode.indexOf("text")?this.textMarkers?this.textMarkers.update(textOptions):(this.textMarkers=createScatterPlot(textOptions),this.textMarkers._trace=this,this.textMarkers.highlightScale=1,this.scene.glplot.add(this.textMarkers)):this.textMarkers&&(this.scene.glplot.remove(this.textMarkers),this.textMarkers.dispose(),this.textMarkers=null),errorOptions={gl:gl,position:options.position,color:options.errorColor,error:options.errorBounds,lineWidth:options.errorLineWidth,capSize:options.errorCapSize,opacity:data.opacity},this.errorBars?options.errorBounds?this.errorBars.update(errorOptions):(this.scene.glplot.remove(this.errorBars),this.errorBars.dispose(),this.errorBars=null):options.errorBounds&&(this.errorBars=createErrorBars(errorOptions),this.errorBars._trace=this,this.scene.glplot.add(this.errorBars)),options.delaunayAxis>=0){var delaunayOptions=function constructDelaunay(points,color,axis){var i,u=(axis+1)%3,v=(axis+2)%3,filteredPoints=[],filteredIds=[];for(i=0;i<points.length;++i){var p=points[i];!isNaN(p[u])&&isFinite(p[u])&&!isNaN(p[v])&&isFinite(p[v])&&(filteredPoints.push([p[u],p[v]]),filteredIds.push(i))}var cells=triangulate(filteredPoints);for(i=0;i<cells.length;++i)for(var c=cells[i],j=0;j<c.length;++j)c[j]=filteredIds[c[j]];return{positions:points,cells:cells,meshColor:color}}(options.position,options.delaunayColor,options.delaunayAxis);delaunayOptions.opacity=data.opacity,this.delaunayMesh?this.delaunayMesh.update(delaunayOptions):(delaunayOptions.gl=gl,this.delaunayMesh=createMesh(delaunayOptions),this.delaunayMesh._trace=this,this.scene.glplot.add(this.delaunayMesh))}else this.delaunayMesh&&(this.scene.glplot.remove(this.delaunayMesh),this.delaunayMesh.dispose(),this.delaunayMesh=null)},proto.dispose=function(){this.linePlot&&(this.scene.glplot.remove(this.linePlot),this.linePlot.dispose()),this.scatterPlot&&(this.scene.glplot.remove(this.scatterPlot),this.scatterPlot.dispose()),this.errorBars&&(this.scene.glplot.remove(this.errorBars),this.errorBars.dispose()),this.textMarkers&&(this.scene.glplot.remove(this.textMarkers),this.textMarkers.dispose()),this.delaunayMesh&&(this.scene.glplot.remove(this.delaunayMesh),this.delaunayMesh.dispose())},module.exports=function createLineWithMarkers(scene,data){var plot=new LineWithMarkers(scene,data.uid);return plot.update(data),plot}},{"../../constants/gl3d_dashes":667,"../../constants/gl3d_markers":668,"../../lib":693,"../../lib/gl_format_color":689,"../../lib/str2rgbarray":717,"../scatter/make_bubble_size_func":1049,"./calc_errors":1061,"delaunay-triangulate":149,"gl-error3d":236,"gl-line3d":244,"gl-mesh3d":267,"gl-scatter3d":282}],1063:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}if(function handleXYZDefaults(traceIn,traceOut,coerce,layout){var len=0,x=coerce("x"),y=coerce("y"),z=coerce("z");Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y","z"],layout),x&&y&&z&&(len=Math.min(x.length,y.length,z.length),traceOut._length=traceOut._xlength=traceOut._ylength=traceOut._zlength=len);return len}(traceIn,traceOut,coerce,layout)){coerce("text"),coerce("hovertext"),coerce("mode"),subTypes.hasLines(traceOut)&&(coerce("connectgaps"),handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce)),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{noSelect:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce,{noSelect:!0});var lineColor=(traceOut.line||{}).color,markerColor=(traceOut.marker||{}).color;coerce("surfaceaxis")>=0&&coerce("surfacecolor",lineColor||markerColor);for(var dims=["x","y","z"],i=0;i<3;++i){var projection="projection."+dims[i];coerce(projection+".show")&&(coerce(projection+".opacity"),coerce(projection+".scale"))}var errorBarsSupplyDefaults=Registry.getComponentMethod("errorbars","supplyDefaults");errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"z"}),errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"y",inherit:"z"}),errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"x",inherit:"z"})}else traceOut.visible=!1}},{"../../lib":693,"../../registry":825,"../scatter/line_defaults":1045,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1059}],1064:[function(_dereq_,module,exports){"use strict";var Scatter3D={};Scatter3D.plot=_dereq_("./convert"),Scatter3D.attributes=_dereq_("./attributes"),Scatter3D.markerSymbols=_dereq_("../../constants/gl3d_markers"),Scatter3D.supplyDefaults=_dereq_("./defaults"),Scatter3D.colorbar=_dereq_("../scatter/marker_colorbar"),Scatter3D.calc=_dereq_("./calc"),Scatter3D.moduleType="trace",Scatter3D.name="scatter3d",Scatter3D.basePlotModule=_dereq_("../../plots/gl3d"),Scatter3D.categories=["gl3d","symbols","showLegend"],Scatter3D.meta={},module.exports=Scatter3D},{"../../constants/gl3d_markers":668,"../../plots/gl3d":784,"../scatter/marker_colorbar":1050,"./attributes":1059,"./calc":1060,"./convert":1062,"./defaults":1063}],1065:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),plotAttrs=_dereq_("../../plots/attributes"),colorAttributes=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,scatterMarkerAttrs=scatterAttrs.marker,scatterLineAttrs=scatterAttrs.line,scatterMarkerLineAttrs=scatterMarkerAttrs.line;module.exports={carpet:{valType:"string",editType:"calc"},a:{valType:"data_array",editType:"calc"},b:{valType:"data_array",editType:"calc"},mode:extendFlat({},scatterAttrs.mode,{dflt:"markers"}),text:extendFlat({},scatterAttrs.text,{}),line:{color:scatterLineAttrs.color,width:scatterLineAttrs.width,dash:scatterLineAttrs.dash,shape:extendFlat({},scatterLineAttrs.shape,{values:["linear","spline"]}),smoothing:scatterLineAttrs.smoothing,editType:"calc"},connectgaps:scatterAttrs.connectgaps,fill:extendFlat({},scatterAttrs.fill,{values:["none","toself","tonext"],dflt:"none"}),fillcolor:scatterAttrs.fillcolor,marker:extendFlat({symbol:scatterMarkerAttrs.symbol,opacity:scatterMarkerAttrs.opacity,maxdisplayed:scatterMarkerAttrs.maxdisplayed,size:scatterMarkerAttrs.size,sizeref:scatterMarkerAttrs.sizeref,sizemin:scatterMarkerAttrs.sizemin,sizemode:scatterMarkerAttrs.sizemode,line:extendFlat({width:scatterMarkerLineAttrs.width,editType:"calc"},colorAttributes("marker.line")),gradient:scatterMarkerAttrs.gradient,editType:"calc"},colorAttributes("marker"),{colorbar:colorbarAttrs}),textfont:scatterAttrs.textfont,textposition:scatterAttrs.textposition,selected:scatterAttrs.selected,unselected:scatterAttrs.unselected,hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["a","b","text","name"]}),hoveron:scatterAttrs.hoveron}},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/attributes":739,"../scatter/attributes":1032}],1066:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),calcColorscale=_dereq_("../scatter/colorscale_calc"),arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection"),calcMarkerSize=_dereq_("../scatter/calc").calcMarkerSize,lookupCarpet=_dereq_("../carpet/lookup_carpetid");module.exports=function calc(gd,trace){var carpet=trace._carpetTrace=lookupCarpet(gd,trace);if(carpet&&carpet.visible&&"legendonly"!==carpet.visible){var i;trace.xaxis=carpet.xaxis,trace.yaxis=carpet.yaxis;var a,b,serieslen=trace._length,cd=new Array(serieslen),needsCull=!1;for(i=0;i<serieslen;i++)if(a=trace.a[i],b=trace.b[i],isNumeric(a)&&isNumeric(b)){var xy=carpet.ab2xy(+a,+b,!0),visible=carpet.isVisible(+a,+b);visible||(needsCull=!0),cd[i]={x:xy[0],y:xy[1],a:a,b:b,vis:visible}}else cd[i]={x:!1,y:!1};return trace._needsCull=needsCull,cd[0].carpet=carpet,cd[0].trace=trace,calcMarkerSize(trace,serieslen),calcColorscale(trace),arraysToCalcdata(cd,trace),calcSelection(cd,trace),cd}}},{"../carpet/lookup_carpetid":891,"../scatter/arrays_to_calcdata":1031,"../scatter/calc":1033,"../scatter/calc_selection":1034,"../scatter/colorscale_calc":1036,"fast-isnumeric":213}],1067:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),constants=_dereq_("../scatter/constants"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleLineShapeDefaults=_dereq_("../scatter/line_shape_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}coerce("carpet"),traceOut.xaxis="x",traceOut.yaxis="y";var a=coerce("a"),b=coerce("b"),len=Math.min(a.length,b.length);if(len){traceOut._length=len,coerce("text"),coerce("mode",len<constants.PTS_LINESONLY?"lines+markers":"lines"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),handleLineShapeDefaults(traceIn,traceOut,coerce),coerce("connectgaps")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{gradient:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce);var dfltHoverOn=[];(subTypes.hasMarkers(traceOut)||subTypes.hasText(traceOut))&&(coerce("marker.maxdisplayed"),dfltHoverOn.push("points")),coerce("fill"),"none"!==traceOut.fill&&(handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),subTypes.hasLines(traceOut)||handleLineShapeDefaults(traceIn,traceOut,coerce)),"tonext"!==traceOut.fill&&"toself"!==traceOut.fill||dfltHoverOn.push("fills"),coerce("hoveron",dfltHoverOn.join("+")||"points"),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../lib":693,"../scatter/constants":1037,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/line_shape_defaults":1047,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1065}],1068:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt,trace,cd,pointNumber){var cdi=cd[pointNumber];return out.a=cdi.a,out.b=cdi.b,out}},{}],1069:[function(_dereq_,module,exports){"use strict";var scatterHover=_dereq_("../scatter/hover");module.exports=function hoverPoints(pointData,xval,yval,hovermode){var scatterPointData=scatterHover(pointData,xval,yval,hovermode);if(scatterPointData&&!1!==scatterPointData[0].index){var newPointData=scatterPointData[0];if(void 0===newPointData.index){var yFracUp=1-newPointData.y0/pointData.ya._length,xLen=pointData.xa._length,xMin=xLen*yFracUp/2,xMax=xLen-xMin;return newPointData.x0=Math.max(Math.min(newPointData.x0,xMax),xMin),newPointData.x1=Math.max(Math.min(newPointData.x1,xMax),xMin),scatterPointData}var cdi=newPointData.cd[newPointData.index];newPointData.a=cdi.a,newPointData.b=cdi.b,newPointData.xLabelVal=void 0,newPointData.yLabelVal=void 0;var trace=newPointData.trace,carpet=trace._carpet,parts=(cdi.hi||trace.hoverinfo).split("+"),text=[];-1!==parts.indexOf("all")&&(parts=["a","b"]),-1!==parts.indexOf("a")&&textPart(carpet.aaxis,cdi.a),-1!==parts.indexOf("b")&&textPart(carpet.baxis,cdi.b);var ij=carpet.ab2ij([cdi.a,cdi.b]),i0=Math.floor(ij[0]),ti=ij[0]-i0,j0=Math.floor(ij[1]),tj=ij[1]-j0,xy=carpet.evalxy([],i0,j0,ti,tj);return text.push("y: "+xy[1].toFixed(3)),newPointData.extraText=text.join("<br>"),scatterPointData}function textPart(ax,val){var prefix;prefix=ax.labelprefix&&ax.labelprefix.length>0?ax.labelprefix.replace(/ = $/,""):ax._hovertitle,text.push(prefix+": "+val.toFixed(3)+ax.labelsuffix)}}},{"../scatter/hover":1043}],1070:[function(_dereq_,module,exports){"use strict";var ScatterCarpet={};ScatterCarpet.attributes=_dereq_("./attributes"),ScatterCarpet.supplyDefaults=_dereq_("./defaults"),ScatterCarpet.colorbar=_dereq_("../scatter/marker_colorbar"),ScatterCarpet.calc=_dereq_("./calc"),ScatterCarpet.plot=_dereq_("./plot"),ScatterCarpet.style=_dereq_("../scatter/style").style,ScatterCarpet.styleOnSelect=_dereq_("../scatter/style").styleOnSelect,ScatterCarpet.hoverPoints=_dereq_("./hover"),ScatterCarpet.selectPoints=_dereq_("../scatter/select"),ScatterCarpet.eventData=_dereq_("./event_data"),ScatterCarpet.moduleType="trace",ScatterCarpet.name="scattercarpet",ScatterCarpet.basePlotModule=_dereq_("../../plots/cartesian"),ScatterCarpet.categories=["svg","carpet","symbols","showLegend","carpetDependent","zoomScale"],ScatterCarpet.meta={},module.exports=ScatterCarpet},{"../../plots/cartesian":753,"../scatter/marker_colorbar":1050,"../scatter/select":1053,"../scatter/style":1055,"./attributes":1065,"./calc":1066,"./defaults":1067,"./event_data":1068,"./hover":1069,"./plot":1071}],1071:[function(_dereq_,module,exports){"use strict";var scatterPlot=_dereq_("../scatter/plot"),Axes=_dereq_("../../plots/cartesian/axes"),Drawing=_dereq_("../../components/drawing");module.exports=function plot(gd,plotinfoproxy,data,layer){var i,trace,node,carpet=data[0][0].carpet,plotinfo={xaxis:Axes.getFromId(gd,carpet.xaxis||"x"),yaxis:Axes.getFromId(gd,carpet.yaxis||"y"),plot:plotinfoproxy.plot};for(scatterPlot(gd,plotinfo,data,layer),i=0;i<data.length;i++)trace=data[i][0].trace,node=layer.selectAll("g.trace"+trace.uid+" .js-line"),Drawing.setClipUrl(node,carpet._clipPathId)}},{"../../components/drawing":592,"../../plots/cartesian/axes":742,"../scatter/plot":1052}],1072:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),plotAttrs=_dereq_("../../plots/attributes"),colorAttributes=_dereq_("../../components/colorscale/attributes"),dash=_dereq_("../../components/drawing/attributes").dash,extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,scatterMarkerAttrs=scatterAttrs.marker,scatterLineAttrs=scatterAttrs.line,scatterMarkerLineAttrs=scatterMarkerAttrs.line;module.exports=overrideAll({lon:{valType:"data_array"},lat:{valType:"data_array"},locations:{valType:"data_array"},locationmode:{valType:"enumerated",values:["ISO-3","USA-states","country names"],dflt:"ISO-3"},mode:extendFlat({},scatterAttrs.mode,{dflt:"markers"}),text:extendFlat({},scatterAttrs.text,{}),hovertext:extendFlat({},scatterAttrs.hovertext,{}),textfont:scatterAttrs.textfont,textposition:scatterAttrs.textposition,line:{color:scatterLineAttrs.color,width:scatterLineAttrs.width,dash:dash},connectgaps:scatterAttrs.connectgaps,marker:extendFlat({symbol:scatterMarkerAttrs.symbol,opacity:scatterMarkerAttrs.opacity,size:scatterMarkerAttrs.size,sizeref:scatterMarkerAttrs.sizeref,sizemin:scatterMarkerAttrs.sizemin,sizemode:scatterMarkerAttrs.sizemode,colorbar:scatterMarkerAttrs.colorbar,line:extendFlat({width:scatterMarkerLineAttrs.width},colorAttributes("marker.line")),gradient:scatterMarkerAttrs.gradient},colorAttributes("marker")),fill:{valType:"enumerated",values:["none","toself"],dflt:"none"},fillcolor:scatterAttrs.fillcolor,selected:scatterAttrs.selected,unselected:scatterAttrs.unselected,hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["lon","lat","location","text","name"]})},"calc","nested")},{"../../components/colorscale/attributes":574,"../../components/drawing/attributes":591,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739,"../scatter/attributes":1032}],1073:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),BADNUM=_dereq_("../../constants/numerical").BADNUM,calcMarkerColorscale=_dereq_("../scatter/colorscale_calc"),arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection"),_=_dereq_("../../lib")._;module.exports=function calc(gd,trace){for(var hasLocationData=Array.isArray(trace.locations),len=hasLocationData?trace.locations.length:trace._length,calcTrace=new Array(len),i=0;i<len;i++){var calcPt=calcTrace[i]={};if(hasLocationData){var loc=trace.locations[i];calcPt.loc="string"==typeof loc?loc:null}else{var lon=trace.lon[i],lat=trace.lat[i];isNumeric(lon)&&isNumeric(lat)?calcPt.lonlat=[+lon,+lat]:calcPt.lonlat=[BADNUM,BADNUM]}}return arraysToCalcdata(calcTrace,trace),calcMarkerColorscale(trace),calcSelection(calcTrace,trace),len&&(calcTrace[0].t={labels:{lat:_(gd,"lat:")+" ",lon:_(gd,"lon:")+" "}}),calcTrace}},{"../../constants/numerical":670,"../../lib":693,"../scatter/arrays_to_calcdata":1031,"../scatter/calc_selection":1034,"../scatter/colorscale_calc":1036,"fast-isnumeric":213}],1074:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}!function handleLonLatLocDefaults(traceIn,traceOut,coerce){var lon,lat,len=0,locations=coerce("locations");if(locations)return coerce("locationmode"),len=locations.length;return lon=coerce("lon")||[],lat=coerce("lat")||[],len=Math.min(lon.length,lat.length),traceOut._length=len,len}(0,traceOut,coerce)?traceOut.visible=!1:(coerce("text"),coerce("hovertext"),coerce("mode"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),coerce("connectgaps")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{gradient:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce),coerce("fill"),"none"!==traceOut.fill&&handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),Lib.coerceSelectionMarkerOpacity(traceOut,coerce))}},{"../../lib":693,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1072}],1075:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt){return out.lon=pt.lon,out.lat=pt.lat,out.location=pt.loc?pt.loc:null,out}},{}],1076:[function(_dereq_,module,exports){"use strict";var Fx=_dereq_("../../components/fx"),Axes=_dereq_("../../plots/cartesian/axes"),BADNUM=_dereq_("../../constants/numerical").BADNUM,getTraceColor=_dereq_("../scatter/get_trace_color"),fillHoverText=_dereq_("../scatter/fill_hover_text"),attributes=_dereq_("./attributes");module.exports=function hoverPoints(pointData,xval,yval){var cd=pointData.cd,trace=cd[0].trace,xa=pointData.xa,ya=pointData.ya,geo=pointData.subplot,isLonLatOverEdges=geo.projection.isLonLatOverEdges,project=geo.project;if(Fx.getClosest(cd,function distFn(d){var lonlat=d.lonlat;if(lonlat[0]===BADNUM)return 1/0;if(isLonLatOverEdges(lonlat))return 1/0;var pt=project(lonlat),px=project([xval,yval]),dx=Math.abs(pt[0]-px[0]),dy=Math.abs(pt[1]-px[1]),rad=Math.max(3,d.mrc||0);return Math.max(Math.sqrt(dx*dx+dy*dy)-rad,1-3/rad)},pointData),!1!==pointData.index){var di=cd[pointData.index],lonlat=di.lonlat,pos=[xa.c2p(lonlat),ya.c2p(lonlat)],rad=di.mrc||1;return pointData.x0=pos[0]-rad,pointData.x1=pos[0]+rad,pointData.y0=pos[1]-rad,pointData.y1=pos[1]+rad,pointData.loc=di.loc,pointData.lon=lonlat[0],pointData.lat=lonlat[1],pointData.color=getTraceColor(trace,di),pointData.extraText=function getExtraText(trace,pt,axis,labels){var hoverinfo=pt.hi||trace.hoverinfo,parts="all"===hoverinfo?attributes.hoverinfo.flags:hoverinfo.split("+"),hasLocation=-1!==parts.indexOf("location")&&Array.isArray(trace.locations),hasLon=-1!==parts.indexOf("lon"),hasLat=-1!==parts.indexOf("lat"),hasText=-1!==parts.indexOf("text"),text=[];function format(val){return Axes.tickText(axis,axis.c2l(val),"hover").text+""}hasLocation?text.push(pt.loc):hasLon&&hasLat?text.push("("+format(pt.lonlat[0])+", "+format(pt.lonlat[1])+")"):hasLon?text.push(labels.lon+format(pt.lonlat[0])):hasLat&&text.push(labels.lat+format(pt.lonlat[1]));hasText&&fillHoverText(pt,trace,text);return text.join("<br>")}(trace,di,geo.mockAxis,cd[0].t.labels),[pointData]}}},{"../../components/fx":609,"../../constants/numerical":670,"../../plots/cartesian/axes":742,"../scatter/fill_hover_text":1040,"../scatter/get_trace_color":1042,"./attributes":1072}],1077:[function(_dereq_,module,exports){"use strict";var ScatterGeo={};ScatterGeo.attributes=_dereq_("./attributes"),ScatterGeo.supplyDefaults=_dereq_("./defaults"),ScatterGeo.colorbar=_dereq_("../scatter/marker_colorbar"),ScatterGeo.calc=_dereq_("./calc"),ScatterGeo.plot=_dereq_("./plot"),ScatterGeo.style=_dereq_("./style"),ScatterGeo.styleOnSelect=_dereq_("../scatter/style").styleOnSelect,ScatterGeo.hoverPoints=_dereq_("./hover"),ScatterGeo.eventData=_dereq_("./event_data"),ScatterGeo.selectPoints=_dereq_("./select"),ScatterGeo.moduleType="trace",ScatterGeo.name="scattergeo",ScatterGeo.basePlotModule=_dereq_("../../plots/geo"),ScatterGeo.categories=["geo","symbols","showLegend","scatter-like"],ScatterGeo.meta={},module.exports=ScatterGeo},{"../../plots/geo":772,"../scatter/marker_colorbar":1050,"../scatter/style":1055,"./attributes":1072,"./calc":1073,"./defaults":1074,"./event_data":1075,"./hover":1076,"./plot":1078,"./select":1079,"./style":1080}],1078:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),BADNUM=_dereq_("../../constants/numerical").BADNUM,getTopojsonFeatures=_dereq_("../../lib/topojson_utils").getTopojsonFeatures,locationToFeature=_dereq_("../../lib/geo_location_utils").locationToFeature,geoJsonUtils=_dereq_("../../lib/geojson_utils"),subTypes=_dereq_("../scatter/subtypes"),style=_dereq_("./style");function calcGeoJSON(calcTrace,topojson){var trace=calcTrace[0].trace;if(Array.isArray(trace.locations))for(var features=getTopojsonFeatures(trace,topojson),locationmode=trace.locationmode,i=0;i<calcTrace.length;i++){var calcPt=calcTrace[i],feature=locationToFeature(locationmode,calcPt.loc,features);calcPt.lonlat=feature?feature.properties.ct:[BADNUM,BADNUM]}}module.exports=function plot(gd,geo,calcData){for(var i=0;i<calcData.length;i++)calcGeoJSON(calcData[i],geo.topojson);function removeBADNUM(d,node){d.lonlat[0]===BADNUM&&d3.select(node).remove()}var scatterLayer=geo.layers.frontplot.select(".scatterlayer"),gTraces=Lib.makeTraceGroups(scatterLayer,calcData,"trace scattergeo");gTraces.selectAll("*").remove(),gTraces.each(function(calcTrace){var s=calcTrace[0].node3=d3.select(this),trace=calcTrace[0].trace;if(subTypes.hasLines(trace)||"none"!==trace.fill){var lineCoords=geoJsonUtils.calcTraceToLineCoords(calcTrace),lineData="none"!==trace.fill?geoJsonUtils.makePolygon(lineCoords):geoJsonUtils.makeLine(lineCoords);s.selectAll("path.js-line").data([{geojson:lineData,trace:trace}]).enter().append("path").classed("js-line",!0).style("stroke-miterlimit",2)}subTypes.hasMarkers(trace)&&s.selectAll("path.point").data(Lib.identity).enter().append("path").classed("point",!0).each(function(calcPt){removeBADNUM(calcPt,this)}),subTypes.hasText(trace)&&s.selectAll("g").data(Lib.identity).enter().append("g").append("text").each(function(calcPt){removeBADNUM(calcPt,this)}),style(gd,calcTrace)})}},{"../../constants/numerical":670,"../../lib":693,"../../lib/geo_location_utils":685,"../../lib/geojson_utils":686,"../../lib/topojson_utils":721,"../scatter/subtypes":1056,"./style":1080,d3:147}],1079:[function(_dereq_,module,exports){"use strict";var subtypes=_dereq_("../scatter/subtypes"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function selectPoints(searchInfo,selectionTester){var di,lonlat,x,y,i,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[],trace=cd[0].trace;if(!subtypes.hasMarkers(trace)&&!subtypes.hasText(trace))return[];if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++)(lonlat=(di=cd[i]).lonlat)[0]!==BADNUM&&(x=xa.c2p(lonlat),y=ya.c2p(lonlat),selectionTester.contains([x,y],null,i,searchInfo)?(selection.push({pointNumber:i,lon:lonlat[0],lat:lonlat[1]}),di.selected=1):di.selected=0);return selection}},{"../../constants/numerical":670,"../scatter/subtypes":1056}],1080:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Drawing=_dereq_("../../components/drawing"),Color=_dereq_("../../components/color"),scatterStyle=_dereq_("../scatter/style"),stylePoints=scatterStyle.stylePoints,styleText=scatterStyle.styleText;module.exports=function style(gd,calcTrace){calcTrace&&function styleTrace(gd,calcTrace){var trace=calcTrace[0].trace,s=calcTrace[0].node3;s.style("opacity",calcTrace[0].trace.opacity),stylePoints(s,trace,gd),styleText(s,trace,gd),s.selectAll("path.js-line").style("fill","none").each(function(d){var path=d3.select(this),trace=d.trace,line=trace.line||{};path.call(Color.stroke,line.color).call(Drawing.dashLine,line.dash||"",line.width||0),"none"!==trace.fill&&path.call(Color.fill,trace.fillcolor)})}(gd,calcTrace)}},{"../../components/color":567,"../../components/drawing":592,"../scatter/style":1055,d3:147}],1081:[function(_dereq_,module,exports){"use strict";var plotAttrs=_dereq_("../../plots/attributes"),scatterAttrs=_dereq_("../scatter/attributes"),colorAttrs=_dereq_("../../components/colorscale/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,DASHES=_dereq_("./constants").DASHES,scatterLineAttrs=scatterAttrs.line,scatterMarkerAttrs=scatterAttrs.marker,scatterMarkerLineAttrs=scatterMarkerAttrs.line,attrs=module.exports=overrideAll({x:scatterAttrs.x,x0:scatterAttrs.x0,dx:scatterAttrs.dx,y:scatterAttrs.y,y0:scatterAttrs.y0,dy:scatterAttrs.dy,text:extendFlat({},scatterAttrs.text,{}),hovertext:scatterAttrs.hovertext,textposition:scatterAttrs.textposition,textfont:scatterAttrs.textfont,mode:{valType:"flaglist",flags:["lines","markers","text"],extras:["none"]},line:{color:scatterLineAttrs.color,width:scatterLineAttrs.width,dash:{valType:"enumerated",values:Object.keys(DASHES),dflt:"solid"}},marker:extendFlat({},colorAttrs("marker"),{symbol:scatterMarkerAttrs.symbol,size:scatterMarkerAttrs.size,sizeref:scatterMarkerAttrs.sizeref,sizemin:scatterMarkerAttrs.sizemin,sizemode:scatterMarkerAttrs.sizemode,opacity:scatterMarkerAttrs.opacity,colorbar:scatterMarkerAttrs.colorbar,line:extendFlat({},colorAttrs("marker.line"),{width:scatterMarkerLineAttrs.width})}),connectgaps:scatterAttrs.connectgaps,fill:extendFlat({},scatterAttrs.fill,{dflt:"none"}),fillcolor:scatterAttrs.fillcolor,selected:{marker:scatterAttrs.selected.marker,textfont:scatterAttrs.selected.textfont},unselected:{marker:scatterAttrs.unselected.marker,textfont:scatterAttrs.unselected.textfont},opacity:plotAttrs.opacity},"calc","nested");attrs.x.editType=attrs.y.editType=attrs.x0.editType=attrs.y0.editType="calc+clearAxisTypes"},{"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739,"../scatter/attributes":1032,"./constants":1082}],1082:[function(_dereq_,module,exports){"use strict";module.exports={TOO_MANY_POINTS:1e5,SYMBOL_SDF_SIZE:200,SYMBOL_SIZE:20,SYMBOL_STROKE:1,DOT_RE:/-dot/,OPEN_RE:/-open/,DASHES:{solid:[1],dot:[1,1],dash:[4,1],longdash:[8,1],dashdot:[4,1,1,1],longdashdot:[8,1,1,1]}}},{}],1083:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),svgSdf=_dereq_("svg-path-sdf"),rgba=_dereq_("color-normalize"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../../components/drawing"),AxisIDs=_dereq_("../../plots/cartesian/axis_ids"),formatColor=_dereq_("../../lib/gl_format_color").formatColor,subTypes=_dereq_("../scatter/subtypes"),makeBubbleSizeFn=_dereq_("../scatter/make_bubble_size_func"),constants=_dereq_("./constants"),DESELECTDIM=_dereq_("../../constants/interactions").DESELECTDIM,TEXTOFFSETSIGN={start:1,left:1,end:-1,right:-1,middle:0,center:0,bottom:1,top:-1};function convertTextStyle(trace){var i,count=trace._length,textfontIn=trace.textfont,textpositionIn=trace.textposition,textPos=Array.isArray(textpositionIn)?textpositionIn:[textpositionIn],tfc=textfontIn.color,tfs=textfontIn.size,tff=textfontIn.family,optsOut={};for(optsOut.text=trace.text,optsOut.opacity=trace.opacity,optsOut.font={},optsOut.align=[],optsOut.baseline=[],i=0;i<textPos.length;i++){var tp=textPos[i].split(/\s+/);switch(tp[1]){case"left":optsOut.align.push("right");break;case"right":optsOut.align.push("left");break;default:optsOut.align.push(tp[1])}switch(tp[0]){case"top":optsOut.baseline.push("bottom");break;case"bottom":optsOut.baseline.push("top");break;default:optsOut.baseline.push(tp[0])}}if(Array.isArray(tfc))for(optsOut.color=new Array(count),i=0;i<count;i++)optsOut.color[i]=tfc[i];else optsOut.color=tfc;if(Array.isArray(tfs)||Array.isArray(tff))for(optsOut.font=new Array(count),i=0;i<count;i++){var fonti=optsOut.font[i]={};fonti.size=Array.isArray(tfs)?isNumeric(tfs[i])?tfs[i]:0:tfs,fonti.family=Array.isArray(tff)?tff[i]:tff}else optsOut.font={size:tfs,family:tff};return optsOut}function convertMarkerStyle(trace){var i,isOpen,count=trace._length,optsIn=trace.marker,optsOut={},multiSymbol=Array.isArray(optsIn.symbol),multiColor=Lib.isArrayOrTypedArray(optsIn.color),multiLineColor=Lib.isArrayOrTypedArray(optsIn.line.color),multiOpacity=Lib.isArrayOrTypedArray(optsIn.opacity),multiSize=Lib.isArrayOrTypedArray(optsIn.size),multiLineWidth=Lib.isArrayOrTypedArray(optsIn.line.width);if(multiSymbol||(isOpen=constants.OPEN_RE.test(optsIn.symbol)),multiSymbol||multiColor||multiLineColor||multiOpacity){optsOut.colors=new Array(count),optsOut.borderColors=new Array(count);var colors=formatColor(optsIn,optsIn.opacity,count),borderColors=formatColor(optsIn.line,optsIn.opacity,count);if(!Array.isArray(borderColors[0])){var borderColor=borderColors;for(borderColors=Array(count),i=0;i<count;i++)borderColors[i]=borderColor}if(!Array.isArray(colors[0])){var color=colors;for(colors=Array(count),i=0;i<count;i++)colors[i]=color}for(optsOut.colors=colors,optsOut.borderColors=borderColors,i=0;i<count;i++){if(multiSymbol){var symbol=optsIn.symbol[i];isOpen=constants.OPEN_RE.test(symbol)}isOpen&&(borderColors[i]=colors[i].slice(),colors[i]=colors[i].slice(),colors[i][3]=0)}optsOut.opacity=trace.opacity}else isOpen?(optsOut.color=rgba(optsIn.color,"uint8"),optsOut.color[3]=0,optsOut.borderColor=rgba(optsIn.color,"uint8")):(optsOut.color=rgba(optsIn.color,"uint8"),optsOut.borderColor=rgba(optsIn.line.color,"uint8")),optsOut.opacity=trace.opacity*optsIn.opacity;if(multiSymbol)for(optsOut.markers=new Array(count),i=0;i<count;i++)optsOut.markers[i]=getSymbolSdf(optsIn.symbol[i]);else optsOut.marker=getSymbolSdf(optsIn.symbol);var s,markerSizeFunc=makeBubbleSizeFn(trace);if(multiSize||multiLineWidth){var sizeAvg,sizes=optsOut.sizes=new Array(count),borderSizes=optsOut.borderSizes=new Array(count),sizeTotal=0;if(multiSize){for(i=0;i<count;i++)sizes[i]=markerSizeFunc(optsIn.size[i]),sizeTotal+=sizes[i];sizeAvg=sizeTotal/count}else for(s=markerSizeFunc(optsIn.size),i=0;i<count;i++)sizes[i]=s;if(multiLineWidth)for(i=0;i<count;i++)borderSizes[i]=optsIn.line.width[i]/2;else for(s=optsIn.line.width/2,i=0;i<count;i++)borderSizes[i]=s;optsOut.sizeAvg=sizeAvg}else optsOut.size=markerSizeFunc(optsIn&&optsIn.size||10),optsOut.borderSizes=markerSizeFunc(optsIn.line.width);return optsOut}function convertMarkerSelection(trace,target){var optsIn=trace.marker,optsOut={};return target?(target.marker&&target.marker.symbol?optsOut=convertMarkerStyle(Lib.extendFlat({},optsIn,target.marker)):target.marker&&(target.marker.size&&(optsOut.size=target.marker.size/2),target.marker.color&&(optsOut.colors=target.marker.color),void 0!==target.marker.opacity&&(optsOut.opacity=target.marker.opacity)),optsOut):optsOut}function convertTextSelection(trace,target){var optsOut={};if(!target)return optsOut;if(target.textfont){var optsIn={opacity:1,text:trace.text,textposition:trace.textposition,textfont:Lib.extendFlat({},trace.textfont)};target.textfont&&Lib.extendFlat(optsIn.textfont,target.textfont),optsOut=convertTextStyle(optsIn)}return optsOut}function convertErrorBarStyle(trace,target){var optsOut={capSize:2*target.width,lineWidth:target.thickness,color:target.color};return target.copy_ystyle&&(optsOut=trace.error_y),optsOut}var SYMBOL_SDF_SIZE=constants.SYMBOL_SDF_SIZE,SYMBOL_SIZE=constants.SYMBOL_SIZE,SYMBOL_STROKE=constants.SYMBOL_STROKE,SYMBOL_SDF={},SYMBOL_SVG_CIRCLE=Drawing.symbolFuncs[0](.05*SYMBOL_SIZE);function getSymbolSdf(symbol){if("circle"===symbol)return null;var symbolPath,symbolSdf,symbolNumber=Drawing.symbolNumber(symbol),symbolFunc=Drawing.symbolFuncs[symbolNumber%100],symbolNoDot=!!Drawing.symbolNoDot[symbolNumber%100],symbolNoFill=!!Drawing.symbolNoFill[symbolNumber%100],isDot=constants.DOT_RE.test(symbol);return SYMBOL_SDF[symbol]?SYMBOL_SDF[symbol]:(symbolPath=isDot&&!symbolNoDot?symbolFunc(1.1*SYMBOL_SIZE)+SYMBOL_SVG_CIRCLE:symbolFunc(SYMBOL_SIZE),symbolSdf=svgSdf(symbolPath,{w:SYMBOL_SDF_SIZE,h:SYMBOL_SDF_SIZE,viewBox:[-SYMBOL_SIZE,-SYMBOL_SIZE,SYMBOL_SIZE,SYMBOL_SIZE],stroke:symbolNoFill?SYMBOL_STROKE:-SYMBOL_STROKE}),SYMBOL_SDF[symbol]=symbolSdf,symbolSdf||null)}module.exports={style:function convertStyle(gd,trace){var i,opts={marker:void 0,markerSel:void 0,markerUnsel:void 0,line:void 0,fill:void 0,errorX:void 0,errorY:void 0,text:void 0,textSel:void 0,textUnsel:void 0};if(!0!==trace.visible)return opts;if(subTypes.hasText(trace)&&(opts.text=convertTextStyle(trace),opts.textSel=convertTextSelection(trace,trace.selected),opts.textUnsel=convertTextSelection(trace,trace.unselected)),subTypes.hasMarkers(trace)&&(opts.marker=convertMarkerStyle(trace),opts.markerSel=convertMarkerSelection(trace,trace.selected),opts.markerUnsel=convertMarkerSelection(trace,trace.unselected),!trace.unselected&&Array.isArray(trace.marker.opacity))){var mo=trace.marker.opacity;for(opts.markerUnsel.opacity=new Array(mo.length),i=0;i<mo.length;i++)opts.markerUnsel.opacity[i]=DESELECTDIM*mo[i]}if(subTypes.hasLines(trace)){opts.line={overlay:!0,thickness:trace.line.width,color:trace.line.color,opacity:trace.opacity};var dashes=(constants.DASHES[trace.line.dash]||[1]).slice();for(i=0;i<dashes.length;++i)dashes[i]*=trace.line.width;opts.line.dashes=dashes}return trace.error_x&&trace.error_x.visible&&(opts.errorX=convertErrorBarStyle(trace,trace.error_x)),trace.error_y&&trace.error_y.visible&&(opts.errorY=convertErrorBarStyle(trace,trace.error_y)),trace.fill&&"none"!==trace.fill&&(opts.fill={closed:!0,fill:trace.fillcolor,thickness:0}),opts},markerStyle:convertMarkerStyle,markerSelection:convertMarkerSelection,linePositions:function convertLinePositions(gd,trace,positions){var linePositions,i,count=positions.length/2;if(subTypes.hasLines(trace)&&count)if("hv"===trace.line.shape){for(linePositions=[],i=0;i<count-1;i++)isNaN(positions[2*i])||isNaN(positions[2*i+1])?(linePositions.push(NaN),linePositions.push(NaN),linePositions.push(NaN),linePositions.push(NaN)):(linePositions.push(positions[2*i]),linePositions.push(positions[2*i+1]),linePositions.push(positions[2*i+2]),linePositions.push(positions[2*i+1]));linePositions.push(positions[positions.length-2]),linePositions.push(positions[positions.length-1])}else if("vh"===trace.line.shape){for(linePositions=[],i=0;i<count-1;i++)isNaN(positions[2*i])||isNaN(positions[2*i+1])?(linePositions.push(NaN),linePositions.push(NaN),linePositions.push(NaN),linePositions.push(NaN)):(linePositions.push(positions[2*i]),linePositions.push(positions[2*i+1]),linePositions.push(positions[2*i]),linePositions.push(positions[2*i+3]));linePositions.push(positions[positions.length-2]),linePositions.push(positions[positions.length-1])}else linePositions=positions;var hasNaN=!1;for(i=0;i<linePositions.length;i++)if(isNaN(linePositions[i])){hasNaN=!0;break}var join=hasNaN||linePositions.length>constants.TOO_MANY_POINTS?"rect":subTypes.hasMarkers(trace)?"rect":"round";if(hasNaN&&trace.connectgaps){var lastX=linePositions[0],lastY=linePositions[1];for(i=0;i<linePositions.length;i+=2)isNaN(linePositions[i])||isNaN(linePositions[i+1])?(linePositions[i]=lastX,linePositions[i+1]=lastY):(lastX=linePositions[i],lastY=linePositions[i+1])}return{join:join,positions:linePositions}},errorBarPositions:function convertErrorBarPositions(gd,trace,positions,x,y){var makeComputeError=Registry.getComponentMethod("errorbars","makeComputeError"),xa=AxisIDs.getFromId(gd,trace.xaxis),ya=AxisIDs.getFromId(gd,trace.yaxis),count=positions.length/2,out={};function convertOneAxis(coords,ax){var axLetter=ax._id.charAt(0),opts=trace["error_"+axLetter];if(opts&&opts.visible&&("linear"===ax.type||"log"===ax.type)){for(var computeError=makeComputeError(opts),pOffset={x:0,y:1}[axLetter],eOffset={x:[0,1,2,3],y:[2,3,0,1]}[axLetter],errors=new Float64Array(4*count),minShoe=1/0,maxHat=-1/0,i=0,j=0;i<count;i++,j+=4){var dc=coords[i];if(isNumeric(dc)){var dl=positions[2*i+pOffset],vals=computeError(dc,i),lv=vals[0],hv=vals[1];if(isNumeric(lv)&&isNumeric(hv)){var shoe=dc-lv,hat=dc+hv;errors[j+eOffset[0]]=dl-ax.c2l(shoe),errors[j+eOffset[1]]=ax.c2l(hat)-dl,errors[j+eOffset[2]]=0,errors[j+eOffset[3]]=0,minShoe=Math.min(minShoe,dc-lv),maxHat=Math.max(maxHat,dc+hv)}}}out[axLetter]={positions:positions,errors:errors,_bnds:[minShoe,maxHat]}}}return convertOneAxis(x,xa),convertOneAxis(y,ya),out},textPosition:function convertTextPosition(gd,trace,textOpts,markerOpts){var i,count=trace._length,out={};if(subTypes.hasMarkers(trace)){var fontOpts=textOpts.font,align=textOpts.align,baseline=textOpts.baseline;for(out.offset=new Array(count),i=0;i<count;i++){var ms=markerOpts.sizes?markerOpts.sizes[i]:markerOpts.size,fs=Array.isArray(fontOpts)?fontOpts[i].size:fontOpts.size,a=Array.isArray(align)?align.length>1?align[i]:align[0]:align,b=Array.isArray(baseline)?baseline.length>1?baseline[i]:baseline[0]:baseline,hSign=TEXTOFFSETSIGN[a],vSign=TEXTOFFSETSIGN[b],xPad=ms?ms/.8+1:0,yPad=-vSign*xPad-.5*vSign;out.offset[i]=[hSign*xPad/fs,yPad/fs]}}return out}}},{"../../components/drawing":592,"../../constants/interactions":669,"../../lib":693,"../../lib/gl_format_color":689,"../../plots/cartesian/axis_ids":745,"../../registry":825,"../scatter/make_bubble_size_func":1049,"../scatter/subtypes":1056,"./constants":1082,"color-normalize":107,"fast-isnumeric":213,"svg-path-sdf":509}],1084:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Registry=_dereq_("../../registry"),attributes=_dereq_("./attributes"),constants=_dereq_("../scatter/constants"),subTypes=_dereq_("../scatter/subtypes"),handleXYDefaults=_dereq_("../scatter/xy_defaults"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var isOpen=!!traceIn.marker&&/-open/.test(traceIn.marker.symbol),isBubble=subTypes.isBubble(traceIn),len=handleXYDefaults(traceIn,traceOut,layout,coerce);if(len){var defaultMode=len<constants.PTS_LINESONLY?"lines+markers":"lines";coerce("text"),coerce("hovertext"),coerce("mode",defaultMode),subTypes.hasLines(traceOut)&&(coerce("connectgaps"),handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce)),subTypes.hasMarkers(traceOut)&&(handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce),coerce("marker.line.width",isOpen||isBubble?1:0)),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce),coerce("fill"),"none"!==traceOut.fill&&handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce);var errorBarsSupplyDefaults=Registry.getComponentMethod("errorbars","supplyDefaults");errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"y"}),errorBarsSupplyDefaults(traceIn,traceOut,defaultColor,{axis:"x",inherit:"y"}),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../lib":693,"../../registry":825,"../scatter/constants":1037,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"../scatter/xy_defaults":1058,"./attributes":1081}],1085:[function(_dereq_,module,exports){"use strict";var createScatter=_dereq_("regl-scatter2d"),createLine=_dereq_("regl-line2d"),createError=_dereq_("regl-error2d"),cluster=_dereq_("point-cluster"),arrayRange=_dereq_("array-range"),Text=_dereq_("gl-text"),Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),prepareRegl=_dereq_("../../lib/prepare_regl"),AxisIDs=_dereq_("../../plots/cartesian/axis_ids"),findExtremes=_dereq_("../../plots/cartesian/autorange").findExtremes,Color=_dereq_("../../components/color"),subTypes=_dereq_("../scatter/subtypes"),scatterCalc=_dereq_("../scatter/calc"),calcMarkerSize=scatterCalc.calcMarkerSize,calcAxisExpansion=scatterCalc.calcAxisExpansion,setFirstScatter=scatterCalc.setFirstScatter,calcColorscales=_dereq_("../scatter/colorscale_calc"),linkTraces=_dereq_("../scatter/link_traces"),getTraceColor=_dereq_("../scatter/get_trace_color"),fillHoverText=_dereq_("../scatter/fill_hover_text"),convert=_dereq_("./convert"),BADNUM=_dereq_("../../constants/numerical").BADNUM,TOO_MANY_POINTS=_dereq_("./constants").TOO_MANY_POINTS,DESELECTDIM=_dereq_("../../constants/interactions").DESELECTDIM;function expandForErrorBars(trace,ax,opts){var extremes=trace._extremes[ax._id],errExt=findExtremes(ax,opts._bnds,{padded:!0});extremes.min=extremes.min.concat(errExt.min),extremes.max=extremes.max.concat(errExt.max)}function sceneOptions(gd,subplot,trace,positions,x,y){var opts=convert.style(gd,trace);if(opts.marker&&(opts.marker.positions=positions),opts.line&&positions.length>1&&Lib.extendFlat(opts.line,convert.linePositions(gd,trace,positions)),opts.errorX||opts.errorY){var errors=convert.errorBarPositions(gd,trace,positions,x,y);opts.errorX&&Lib.extendFlat(opts.errorX,errors.x),opts.errorY&&Lib.extendFlat(opts.errorY,errors.y)}return opts.text&&(Lib.extendFlat(opts.text,{positions:positions},convert.textPosition(gd,trace,opts.text,opts.marker)),Lib.extendFlat(opts.textSel,{positions:positions},convert.textPosition(gd,trace,opts.text,opts.markerSel)),Lib.extendFlat(opts.textUnsel,{positions:positions},convert.textPosition(gd,trace,opts.text,opts.markerUnsel))),opts}function sceneUpdate(gd,subplot){var scene=subplot._scene,resetOpts={count:0,dirty:!0,lineOptions:[],fillOptions:[],markerOptions:[],markerSelectedOptions:[],markerUnselectedOptions:[],errorXOptions:[],errorYOptions:[],textOptions:[],textSelectedOptions:[],textUnselectedOptions:[]},initOpts={selectBatch:null,unselectBatch:null,fill2d:!1,scatter2d:!1,error2d:!1,line2d:!1,glText:!1,select2d:null};return subplot._scene||((scene=subplot._scene={}).init=function init(){Lib.extendFlat(scene,initOpts,resetOpts)},scene.init(),scene.update=function update(opt){var opts=Lib.repeat(opt,scene.count);if(scene.fill2d&&scene.fill2d.update(opts),scene.scatter2d&&scene.scatter2d.update(opts),scene.line2d&&scene.line2d.update(opts),scene.error2d&&scene.error2d.update(opts.concat(opts)),scene.select2d&&scene.select2d.update(opts),scene.glText)for(var i=0;i<scene.count;i++)scene.glText[i].update(opt);scene.draw()},scene.draw=function draw(){var i;for(i=0;i<scene.count;i++)scene.fill2d&&scene.fillOptions[i]&&scene.fill2d.draw(i);for(i=0;i<scene.count;i++)scene.line2d&&scene.lineOptions[i]&&scene.line2d.draw(i),scene.error2d&&scene.errorXOptions[i]&&scene.error2d.draw(i),scene.error2d&&scene.errorYOptions[i]&&scene.error2d.draw(i+scene.count),!scene.scatter2d||!scene.markerOptions[i]||scene.selectBatch&&scene.selectBatch[i]||scene.scatter2d.draw(i);for(scene.scatter2d&&scene.select2d&&scene.selectBatch&&(scene.select2d.draw(scene.selectBatch),scene.scatter2d.draw(scene.unselectBatch)),i=0;i<scene.count;i++)scene.glText[i]&&scene.textOptions[i]&&scene.glText[i].render();scene.dirty=!1},scene.clear=function clear(){var vp=getViewport(gd._fullLayout,subplot.xaxis,subplot.yaxis);scene.select2d&&clearViewport(scene.select2d,vp);var anyComponent=scene.scatter2d||scene.line2d||(scene.glText||[])[0]||scene.fill2d||scene.error2d;anyComponent&&clearViewport(anyComponent,vp)},scene.destroy=function destroy(){scene.fill2d&&scene.fill2d.destroy(),scene.scatter2d&&scene.scatter2d.destroy(),scene.error2d&&scene.error2d.destroy(),scene.line2d&&scene.line2d.destroy(),scene.select2d&&scene.select2d.destroy(),scene.glText&&scene.glText.forEach(function(text){text.destroy()}),scene.lineOptions=null,scene.fillOptions=null,scene.markerOptions=null,scene.markerSelectedOptions=null,scene.markerUnselectedOptions=null,scene.errorXOptions=null,scene.errorYOptions=null,scene.textOptions=null,scene.textSelectedOptions=null,scene.textUnselectedOptions=null,scene.selectBatch=null,scene.unselectBatch=null,subplot._scene=null}),scene.dirty||Lib.extendFlat(scene,resetOpts),scene}function getViewport(fullLayout,xaxis,yaxis){var gs=fullLayout._size,width=fullLayout.width,height=fullLayout.height;return[gs.l+xaxis.domain[0]*gs.w,gs.b+yaxis.domain[0]*gs.h,width-gs.r-(1-xaxis.domain[1])*gs.w,height-gs.t-(1-yaxis.domain[1])*gs.h]}function clearViewport(comp,vp){var gl=comp.regl._gl;gl.enable(gl.SCISSOR_TEST),gl.scissor(vp[0],vp[1],vp[2]-vp[0],vp[3]-vp[1]),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT)}function calcHover(pointData,x,y,trace){var xa=pointData.xa,ya=pointData.ya,minDist=pointData.distance,dxy=pointData.dxy,id=pointData.index,di={pointNumber:id,x:x[id],y:y[id]};di.tx=Array.isArray(trace.text)?trace.text[id]:trace.text,di.htx=Array.isArray(trace.hovertext)?trace.hovertext[id]:trace.hovertext,di.data=Array.isArray(trace.customdata)?trace.customdata[id]:trace.customdata,di.tp=Array.isArray(trace.textposition)?trace.textposition[id]:trace.textposition;var font=trace.textfont;font&&(di.ts=Array.isArray(font.size)?font.size[id]:font.size,di.tc=Array.isArray(font.color)?font.color[id]:font.color,di.tf=Array.isArray(font.family)?font.family[id]:font.family);var marker=trace.marker;marker&&(di.ms=Lib.isArrayOrTypedArray(marker.size)?marker.size[id]:marker.size,di.mo=Lib.isArrayOrTypedArray(marker.opacity)?marker.opacity[id]:marker.opacity,di.mx=Array.isArray(marker.symbol)?marker.symbol[id]:marker.symbol,di.mc=Lib.isArrayOrTypedArray(marker.color)?marker.color[id]:marker.color);var line=marker&&marker.line;line&&(di.mlc=Array.isArray(line.color)?line.color[id]:line.color,di.mlw=Lib.isArrayOrTypedArray(line.width)?line.width[id]:line.width);var grad=marker&&marker.gradient;grad&&"none"!==grad.type&&(di.mgt=Array.isArray(grad.type)?grad.type[id]:grad.type,di.mgc=Array.isArray(grad.color)?grad.color[id]:grad.color);var xp=xa.c2p(di.x,!0),yp=ya.c2p(di.y,!0),rad=di.mrc||1,hoverlabel=trace.hoverlabel;hoverlabel&&(di.hbg=Array.isArray(hoverlabel.bgcolor)?hoverlabel.bgcolor[id]:hoverlabel.bgcolor,di.hbc=Array.isArray(hoverlabel.bordercolor)?hoverlabel.bordercolor[id]:hoverlabel.bordercolor,di.hts=Array.isArray(hoverlabel.font.size)?hoverlabel.font.size[id]:hoverlabel.font.size,di.htc=Array.isArray(hoverlabel.font.color)?hoverlabel.font.color[id]:hoverlabel.font.color,di.htf=Array.isArray(hoverlabel.font.family)?hoverlabel.font.family[id]:hoverlabel.font.family,di.hnl=Array.isArray(hoverlabel.namelength)?hoverlabel.namelength[id]:hoverlabel.namelength);var hoverinfo=trace.hoverinfo;hoverinfo&&(di.hi=Array.isArray(hoverinfo)?hoverinfo[id]:hoverinfo);var fakeCd={};return fakeCd[pointData.index]=di,Lib.extendFlat(pointData,{color:getTraceColor(trace,di),x0:xp-rad,x1:xp+rad,xLabelVal:di.x,y0:yp-rad,y1:yp+rad,yLabelVal:di.y,cd:fakeCd,distance:minDist,spikeDistance:dxy}),di.htx?pointData.text=di.htx:di.tx?pointData.text=di.tx:trace.text&&(pointData.text=trace.text),fillHoverText(di,trace,pointData),Registry.getComponentMethod("errorbars","hoverInfo")(di,trace,pointData),pointData}function styleTextSelection(cd){var i,j,stash=cd[0].t,scene=stash._scene,index=stash.index,els=scene.selectBatch[index],unels=scene.unselectBatch[index],baseOpts=scene.textOptions[index],selOpts=scene.textSelectedOptions[index]||{},unselOpts=scene.textUnselectedOptions[index]||{},opts=Lib.extendFlat({},baseOpts);if(els&&unels){var stc=selOpts.color,utc=unselOpts.color,base=baseOpts.color,hasArrayBase=Array.isArray(base);for(opts.color=new Array(stash.count),i=0;i<els.length;i++)j=els[i],opts.color[j]=stc||(hasArrayBase?base[j]:base);for(i=0;i<unels.length;i++){j=unels[i];var basej=hasArrayBase?base[j]:base;opts.color[j]=utc||(stc?basej:Color.addOpacity(basej,DESELECTDIM))}}scene.glText[index].update(opts)}module.exports={moduleType:"trace",name:"scattergl",basePlotModule:_dereq_("../../plots/cartesian"),categories:["gl","regl","cartesian","symbols","errorBarsOK","showLegend","scatter-like"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),cleanData:_dereq_("../scatter/clean_data"),colorbar:_dereq_("../scatter/marker_colorbar"),calc:function calc(gd,trace){var i,xx,yy,fullLayout=gd._fullLayout,xa=AxisIDs.getFromId(gd,trace.xaxis),ya=AxisIDs.getFromId(gd,trace.yaxis),subplot=fullLayout._plots[trace.xaxis+trace.yaxis],count=trace._length,count2=2*count,stash={},x=xa.makeCalcdata(trace,"x"),y=ya.makeCalcdata(trace,"y"),positions=new Array(count2);for(i=0;i<count;i++)xx=x[i],yy=y[i],positions[2*i]=xx===BADNUM?NaN:xx,positions[2*i+1]=yy===BADNUM?NaN:yy;if("log"===xa.type)for(i=0;i<count2;i+=2)positions[i]=xa.c2l(positions[i]);if("log"===ya.type)for(i=1;i<count2;i+=2)positions[i]=ya.c2l(positions[i]);if("log"!==xa.type&&"log"!==ya.type)stash.tree=cluster(positions);else{var ids=stash.ids=new Array(count);for(i=0;i<count;i++)ids[i]=i}calcColorscales(trace);var ppad,opts=sceneOptions(gd,0,trace,positions,x,y),scene=sceneUpdate(gd,subplot);return setFirstScatter(fullLayout,trace),count<TOO_MANY_POINTS?ppad=calcMarkerSize(trace,count):opts.marker&&(ppad=2*(opts.marker.sizeAvg||Math.max(opts.marker.size,3))),calcAxisExpansion(gd,trace,xa,ya,x,y,ppad),opts.errorX&&expandForErrorBars(trace,xa,opts.errorX),opts.errorY&&expandForErrorBars(trace,ya,opts.errorY),opts.fill&&!scene.fill2d&&(scene.fill2d=!0),opts.marker&&!scene.scatter2d&&(scene.scatter2d=!0),opts.line&&!scene.line2d&&(scene.line2d=!0),!opts.errorX&&!opts.errorY||scene.error2d||(scene.error2d=!0),opts.text&&!scene.glText&&(scene.glText=!0),opts.marker&&count>=TOO_MANY_POINTS&&(opts.marker.cluster=stash.tree),scene.lineOptions.push(opts.line),scene.errorXOptions.push(opts.errorX),scene.errorYOptions.push(opts.errorY),scene.fillOptions.push(opts.fill),scene.markerOptions.push(opts.marker),scene.markerSelectedOptions.push(opts.markerSel),scene.markerUnselectedOptions.push(opts.markerUnsel),scene.textOptions.push(opts.text),scene.textSelectedOptions.push(opts.textSel),scene.textUnselectedOptions.push(opts.textUnsel),stash._scene=scene,stash.index=scene.count,stash.x=x,stash.y=y,stash.positions=positions,stash.count=count,scene.count++,[{x:!1,y:!1,t:stash,trace:trace}]},plot:function plot(gd,subplot,cdata){if(cdata.length){var i,j,fullLayout=gd._fullLayout,scene=subplot._scene,xaxis=subplot.xaxis,yaxis=subplot.yaxis;if(scene)if(prepareRegl(gd,["ANGLE_instanced_arrays","OES_element_index_uint"])){var regl=fullLayout._glcanvas.data()[0].regl;if(linkTraces(gd,subplot,cdata),scene.dirty){if(!0===scene.error2d&&(scene.error2d=createError(regl)),!0===scene.line2d&&(scene.line2d=createLine(regl)),!0===scene.scatter2d&&(scene.scatter2d=createScatter(regl)),!0===scene.fill2d&&(scene.fill2d=createLine(regl)),!0===scene.glText)for(scene.glText=new Array(scene.count),i=0;i<scene.count;i++)scene.glText[i]=new Text(regl);if(scene.glText)for(i=0;i<scene.count;i++)scene.glText[i].update(scene.textOptions[i]);if(scene.line2d&&scene.line2d.update(scene.lineOptions),scene.error2d){var errorBatch=(scene.errorXOptions||[]).concat(scene.errorYOptions||[]);scene.error2d.update(errorBatch)}scene.scatter2d&&scene.scatter2d.update(scene.markerOptions),scene.fill2d&&(scene.fillOptions=scene.fillOptions.map(function(fillOptions,i){var cdscatter=cdata[i];if(fillOptions&&cdscatter&&cdscatter[0]&&cdscatter[0].trace){var last,j,cd=cdscatter[0],trace=cd.trace,stash=cd.t,lineOptions=scene.lineOptions[i],pos=[],srcPos=lineOptions&&lineOptions.positions||stash.positions;if("tozeroy"===trace.fill)(pos=(pos=[srcPos[0],0]).concat(srcPos)).push(srcPos[srcPos.length-2]),pos.push(0);else if("tozerox"===trace.fill)(pos=(pos=[0,srcPos[1]]).concat(srcPos)).push(0),pos.push(srcPos[srcPos.length-1]);else if("toself"===trace.fill||"tonext"===trace.fill){for(pos=[],last=0,j=0;j<srcPos.length;j+=2)(isNaN(srcPos[j])||isNaN(srcPos[j+1]))&&((pos=pos.concat(srcPos.slice(last,j))).push(srcPos[last],srcPos[last+1]),last=j+2);pos=pos.concat(srcPos.slice(last)),last&&pos.push(srcPos[last],srcPos[last+1])}else{var nextTrace=trace._nexttrace;if(nextTrace){var nextOptions=scene.lineOptions[i+1];if(nextOptions){var nextPos=nextOptions.positions;if("tonexty"===trace.fill){for(pos=srcPos.slice(),i=Math.floor(nextPos.length/2);i--;){var xx=nextPos[2*i],yy=nextPos[2*i+1];isNaN(xx)||isNaN(yy)||(pos.push(xx),pos.push(yy))}fillOptions.fill=nextTrace.fillcolor}}}}if(trace._prevtrace&&"tonext"===trace._prevtrace.fill){var prevLinePos=scene.lineOptions[i-1].positions,offset=pos.length/2,hole=[last=offset];for(j=0;j<prevLinePos.length;j+=2)(isNaN(prevLinePos[j])||isNaN(prevLinePos[j+1]))&&(hole.push(j/2+offset+1),last=j+2);pos=pos.concat(prevLinePos),fillOptions.hole=hole}return fillOptions.opacity=trace.opacity,fillOptions.positions=pos,fillOptions}}),scene.fill2d.update(scene.fillOptions))}scene.selectBatch=null,scene.unselectBatch=null;var dragmode=fullLayout.dragmode,selectMode="lasso"===dragmode||"select"===dragmode,clickSelectEnabled=fullLayout.clickmode.indexOf("select")>-1;for(i=0;i<cdata.length;i++){var cd0=cdata[i][0],trace=cd0.trace,stash=cd0.t,index=stash.index,x=stash.x,y=stash.y;if(trace.selectedpoints||selectMode||clickSelectEnabled){if(selectMode||(selectMode=!0),scene.selectBatch||(scene.selectBatch=[],scene.unselectBatch=[]),trace.selectedpoints){var selPts=scene.selectBatch[index]=Lib.selIndices2selPoints(trace),selDict={};for(j=0;j<selPts.length;j++)selDict[selPts[j]]=1;var unselPts=[];for(j=0;j<stash.count;j++)selDict[j]||unselPts.push(j);scene.unselectBatch[index]=unselPts}var xpx=stash.xpx=new Array(stash.count),ypx=stash.ypx=new Array(stash.count);for(j=0;j<stash.count;j++)xpx[j]=xaxis.c2p(x[j]),ypx[j]=yaxis.c2p(y[j])}else stash.xpx=stash.ypx=null}selectMode?(scene.select2d||(scene.select2d=createScatter(fullLayout._glcanvas.data()[1].regl)),scene.scatter2d&&scene.selectBatch&&scene.selectBatch.length&&scene.scatter2d.update(scene.markerUnselectedOptions.map(function(opts,i){return scene.selectBatch[i]?opts:null})),scene.select2d&&(scene.select2d.update(scene.markerOptions),scene.select2d.update(scene.markerSelectedOptions)),scene.glText&&cdata.forEach(function(cdscatter){cdscatter&&cdscatter[0]&&cdscatter[0].trace&&styleTextSelection(cdscatter)})):scene.scatter2d&&scene.scatter2d.update(scene.markerOptions);var vpRange0={viewport:getViewport(fullLayout,xaxis,yaxis),range:[(xaxis._rl||xaxis.range)[0],(yaxis._rl||yaxis.range)[0],(xaxis._rl||xaxis.range)[1],(yaxis._rl||yaxis.range)[1]]},vpRange=Lib.repeat(vpRange0,scene.count);scene.fill2d&&scene.fill2d.update(vpRange),scene.line2d&&scene.line2d.update(vpRange),scene.error2d&&scene.error2d.update(vpRange.concat(vpRange)),scene.scatter2d&&scene.scatter2d.update(vpRange),scene.select2d&&scene.select2d.update(vpRange),scene.glText&&scene.glText.forEach(function(text){text.update(vpRange0)}),scene.draw()}else scene.init()}},hoverPoints:function hoverPoints(pointData,xval,yval,hovermode){var ids,id,ptx,pty,i,dx,dy,dist,dxy,cd=pointData.cd,stash=cd[0].t,trace=cd[0].trace,xa=pointData.xa,ya=pointData.ya,x=stash.x,y=stash.y,xpx=xa.c2p(xval),ypx=ya.c2p(yval),maxDistance=pointData.distance;if(stash.tree){var xl=xa.p2c(xpx-maxDistance),xr=xa.p2c(xpx+maxDistance),yl=ya.p2c(ypx-maxDistance),yr=ya.p2c(ypx+maxDistance);ids="x"===hovermode?stash.tree.range(Math.min(xl,xr),Math.min(ya._rl[0],ya._rl[1]),Math.max(xl,xr),Math.max(ya._rl[0],ya._rl[1])):stash.tree.range(Math.min(xl,xr),Math.min(yl,yr),Math.max(xl,xr),Math.max(yl,yr))}else{if(!stash.ids)return[pointData];ids=stash.ids}var minDist=maxDistance;if("x"===hovermode)for(i=0;i<ids.length;i++)ptx=x[ids[i]],(dx=Math.abs(xa.c2p(ptx)-xpx))<minDist&&(minDist=dx,dy=ya.c2p(y[ids[i]])-ypx,dxy=Math.sqrt(dx*dx+dy*dy),id=ids[i]);else for(i=0;i<ids.length;i++)ptx=x[ids[i]],pty=y[ids[i]],dx=xa.c2p(ptx)-xpx,dy=ya.c2p(pty)-ypx,(dist=Math.sqrt(dx*dx+dy*dy))<minDist&&(minDist=dxy=dist,id=ids[i]);return pointData.index=id,pointData.distance=minDist,pointData.dxy=dxy,void 0===id?[pointData]:(calcHover(pointData,x,y,trace),[pointData])},style:function style(gd,cds){if(cds){var scene=cds[0][0].t._scene;gd._fullLayout._has("splom")||scene.clear(),scene.draw()}},selectPoints:function selectPoints(searchInfo,selectionTester){var cd=searchInfo.cd,selection=[],trace=cd[0].trace,stash=cd[0].t,x=stash.x,y=stash.y,scene=stash._scene;if(!scene)return selection;var hasText=subTypes.hasText(trace),hasMarkers=subTypes.hasMarkers(trace),hasOnlyLines=!hasMarkers&&!hasText;if(!0!==trace.visible||hasOnlyLines)return selection;var i,els=null,unels=null;if(!1===selectionTester||selectionTester.degenerate)unels=arrayRange(stash.count);else for(els=[],unels=[],i=0;i<stash.count;i++)selectionTester.contains([stash.xpx[i],stash.ypx[i]],!1,i,searchInfo)?(els.push(i),selection.push({pointNumber:i,x:x[i],y:y[i]})):unels.push(i);if(scene.selectBatch||(scene.selectBatch=[],scene.unselectBatch=[]),!scene.selectBatch[stash.index]){for(i=0;i<scene.count;i++)scene.selectBatch[i]=[],scene.unselectBatch[i]=[];hasMarkers&&scene.scatter2d.update(scene.markerUnselectedOptions)}return scene.selectBatch[stash.index]=els,scene.unselectBatch[stash.index]=unels,hasText&&styleTextSelection(cd),selection},sceneOptions:sceneOptions,sceneUpdate:sceneUpdate,calcHover:calcHover,meta:{}}},{"../../components/color":567,"../../constants/interactions":669,"../../constants/numerical":670,"../../lib":693,"../../lib/prepare_regl":707,"../../plots/cartesian":753,"../../plots/cartesian/autorange":741,"../../plots/cartesian/axis_ids":745,"../../registry":825,"../scatter/calc":1033,"../scatter/clean_data":1035,"../scatter/colorscale_calc":1036,"../scatter/fill_hover_text":1040,"../scatter/get_trace_color":1042,"../scatter/link_traces":1048,"../scatter/marker_colorbar":1050,"../scatter/subtypes":1056,"./attributes":1081,"./constants":1082,"./convert":1083,"./defaults":1084,"array-range":54,"gl-text":302,"point-cluster":449,"regl-error2d":470,"regl-line2d":471,"regl-scatter2d":472}],1086:[function(_dereq_,module,exports){"use strict";var scatterGeoAttrs=_dereq_("../scattergeo/attributes"),scatterAttrs=_dereq_("../scatter/attributes"),mapboxAttrs=_dereq_("../../plots/mapbox/layout_attributes"),plotAttrs=_dereq_("../../plots/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,lineAttrs=scatterGeoAttrs.line,markerAttrs=scatterGeoAttrs.marker;module.exports=overrideAll({lon:scatterGeoAttrs.lon,lat:scatterGeoAttrs.lat,mode:extendFlat({},scatterAttrs.mode,{dflt:"markers"}),text:extendFlat({},scatterAttrs.text,{}),hovertext:extendFlat({},scatterAttrs.hovertext,{}),line:{color:lineAttrs.color,width:lineAttrs.width},connectgaps:scatterAttrs.connectgaps,marker:{symbol:{valType:"string",dflt:"circle",arrayOk:!0},opacity:markerAttrs.opacity,size:markerAttrs.size,sizeref:markerAttrs.sizeref,sizemin:markerAttrs.sizemin,sizemode:markerAttrs.sizemode,color:markerAttrs.color,colorscale:markerAttrs.colorscale,cauto:markerAttrs.cauto,cmax:markerAttrs.cmax,cmin:markerAttrs.cmin,autocolorscale:markerAttrs.autocolorscale,reversescale:markerAttrs.reversescale,showscale:markerAttrs.showscale,colorbar:colorbarAttrs},fill:scatterGeoAttrs.fill,fillcolor:scatterAttrs.fillcolor,textfont:mapboxAttrs.layers.symbol.textfont,textposition:mapboxAttrs.layers.symbol.textposition,selected:{marker:scatterAttrs.selected.marker},unselected:{marker:scatterAttrs.unselected.marker},hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["lon","lat","text","name"]})},"calc","nested")},{"../../components/colorbar/attributes":568,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739,"../../plots/mapbox/layout_attributes":801,"../scatter/attributes":1032,"../scattergeo/attributes":1072}],1087:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),Lib=_dereq_("../../lib"),BADNUM=_dereq_("../../constants/numerical").BADNUM,geoJsonUtils=_dereq_("../../lib/geojson_utils"),Colorscale=_dereq_("../../components/colorscale"),Drawing=_dereq_("../../components/drawing"),makeBubbleSizeFn=_dereq_("../scatter/make_bubble_size_func"),subTypes=_dereq_("../scatter/subtypes"),convertTextOpts=_dereq_("../../plots/mapbox/convert_text_opts");function initContainer(){return{geojson:geoJsonUtils.makeBlank(),layout:{visibility:"none"},paint:{}}}function getFillFunc(attr){return Lib.isArrayOrTypedArray(attr)?function(v){return v}:attr?function(){return attr}:blankFillFunc}function blankFillFunc(){return""}function isBADNUM(lonlat){return lonlat[0]===BADNUM}module.exports=function convert(calcTrace){var lineCoords,trace=calcTrace[0].trace,isVisible=!0===trace.visible,hasFill="none"!==trace.fill,hasLines=subTypes.hasLines(trace),hasMarkers=subTypes.hasMarkers(trace),hasText=subTypes.hasText(trace),hasCircles=hasMarkers&&"circle"===trace.marker.symbol,hasSymbols=hasMarkers&&"circle"!==trace.marker.symbol,fill=initContainer(),line=initContainer(),circle=initContainer(),symbol=initContainer(),opts={fill:fill,line:line,circle:circle,symbol:symbol};if(!isVisible)return opts;if((hasFill||hasLines)&&(lineCoords=geoJsonUtils.calcTraceToLineCoords(calcTrace)),hasFill&&(fill.geojson=geoJsonUtils.makePolygon(lineCoords),fill.layout.visibility="visible",Lib.extendFlat(fill.paint,{"fill-color":trace.fillcolor})),hasLines&&(line.geojson=geoJsonUtils.makeLine(lineCoords),line.layout.visibility="visible",Lib.extendFlat(line.paint,{"line-width":trace.line.width,"line-color":trace.line.color,"line-opacity":trace.opacity})),hasCircles){var circleOpts=function makeCircleOpts(calcTrace){var i,colorFn,sizeFn,opacityFn,trace=calcTrace[0].trace,marker=trace.marker,selectedpoints=trace.selectedpoints,arrayColor=Lib.isArrayOrTypedArray(marker.color),arraySize=Lib.isArrayOrTypedArray(marker.size),arrayOpacity=Lib.isArrayOrTypedArray(marker.opacity);function addTraceOpacity(o){return trace.opacity*o}arrayColor&&(colorFn=Colorscale.hasColorscale(trace,"marker")?Colorscale.makeColorScaleFunc(Colorscale.extractScale(marker.colorscale,marker.cmin,marker.cmax)):Lib.identity);arraySize&&(sizeFn=makeBubbleSizeFn(trace));arrayOpacity&&(opacityFn=function(mo){var mo2=isNumeric(mo)?+Lib.constrain(mo,0,1):0;return addTraceOpacity(mo2)});var fns,features=[];for(i=0;i<calcTrace.length;i++){var calcPt=calcTrace[i],lonlat=calcPt.lonlat;if(!isBADNUM(lonlat)){var props={};colorFn&&(props.mcc=calcPt.mcc=colorFn(calcPt.mc)),sizeFn&&(props.mrc=calcPt.mrc=sizeFn(calcPt.ms)),opacityFn&&(props.mo=opacityFn(calcPt.mo)),selectedpoints&&(props.selected=calcPt.selected||0),features.push({type:"Feature",geometry:{type:"Point",coordinates:lonlat},properties:props})}}if(selectedpoints)for(fns=Drawing.makeSelectedPointStyleFns(trace),i=0;i<features.length;i++){var d=features[i].properties;fns.selectedOpacityFn&&(d.mo=addTraceOpacity(fns.selectedOpacityFn(d))),fns.selectedColorFn&&(d.mcc=fns.selectedColorFn(d)),fns.selectedSizeFn&&(d.mrc=fns.selectedSizeFn(d))}return{geojson:{type:"FeatureCollection",features:features},mcc:arrayColor||fns&&fns.selectedColorFn?{type:"identity",property:"mcc"}:marker.color,mrc:arraySize||fns&&fns.selectedSizeFn?{type:"identity",property:"mrc"}:function size2radius(s){return s/2}(marker.size),mo:arrayOpacity||fns&&fns.selectedOpacityFn?{type:"identity",property:"mo"}:addTraceOpacity(marker.opacity)}}(calcTrace);circle.geojson=circleOpts.geojson,circle.layout.visibility="visible",Lib.extendFlat(circle.paint,{"circle-color":circleOpts.mcc,"circle-radius":circleOpts.mrc,"circle-opacity":circleOpts.mo})}if((hasSymbols||hasText)&&(symbol.geojson=function makeSymbolGeoJSON(calcTrace){for(var trace=calcTrace[0].trace,symbol=(trace.marker||{}).symbol,text=trace.text,fillSymbol="circle"!==symbol?getFillFunc(symbol):blankFillFunc,fillText=subTypes.hasText(trace)?getFillFunc(text):blankFillFunc,features=[],i=0;i<calcTrace.length;i++){var calcPt=calcTrace[i];isBADNUM(calcPt.lonlat)||features.push({type:"Feature",geometry:{type:"Point",coordinates:calcPt.lonlat},properties:{symbol:fillSymbol(calcPt.mx),text:fillText(calcPt.tx)}})}return{type:"FeatureCollection",features:features}}(calcTrace),Lib.extendFlat(symbol.layout,{visibility:"visible","icon-image":"{symbol}-15","text-field":"{text}"}),hasSymbols&&(Lib.extendFlat(symbol.layout,{"icon-size":trace.marker.size/10}),Lib.extendFlat(symbol.paint,{"icon-opacity":trace.opacity*trace.marker.opacity,"icon-color":trace.marker.color})),hasText)){var iconSize=(trace.marker||{}).size,textOpts=convertTextOpts(trace.textposition,iconSize);Lib.extendFlat(symbol.layout,{"text-size":trace.textfont.size,"text-anchor":textOpts.anchor,"text-offset":textOpts.offset}),Lib.extendFlat(symbol.paint,{"text-color":trace.textfont.color,"text-opacity":trace.opacity})}return opts}},{"../../components/colorscale":582,"../../components/drawing":592,"../../constants/numerical":670,"../../lib":693,"../../lib/geojson_utils":686,"../../plots/mapbox/convert_text_opts":798,"../scatter/make_bubble_size_func":1049,"../scatter/subtypes":1056,"fast-isnumeric":213}],1088:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}if(function handleLonLatDefaults(traceIn,traceOut,coerce){var lon=coerce("lon")||[],lat=coerce("lat")||[],len=Math.min(lon.length,lat.length);return traceOut._length=len,len}(0,traceOut,coerce)){if(coerce("text"),coerce("hovertext"),coerce("mode"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce,{noDash:!0}),coerce("connectgaps")),subTypes.hasMarkers(traceOut)){handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{noLine:!0});var marker=traceOut.marker;"circle"!==marker.symbol&&(Lib.isArrayOrTypedArray(marker.size)&&(marker.size=marker.size[0]),Lib.isArrayOrTypedArray(marker.color)&&(marker.color=marker.color[0]))}subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce,{noSelect:!0}),coerce("fill"),"none"!==traceOut.fill&&handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../lib":693,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1086}],1089:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt){return out.lon=pt.lon,out.lat=pt.lat,out}},{}],1090:[function(_dereq_,module,exports){"use strict";var Fx=_dereq_("../../components/fx"),Lib=_dereq_("../../lib"),getTraceColor=_dereq_("../scatter/get_trace_color"),fillHoverText=_dereq_("../scatter/fill_hover_text"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function hoverPoints(pointData,xval,yval){var cd=pointData.cd,trace=cd[0].trace,xa=pointData.xa,ya=pointData.ya,subplot=pointData.subplot,lonShift=360*(xval>=0?Math.floor((xval+180)/360):Math.ceil((xval-180)/360)),xval2=xval-lonShift;if(Fx.getClosest(cd,function distFn(d){var lonlat=d.lonlat;if(lonlat[0]===BADNUM)return 1/0;var lon=Lib.modHalf(lonlat[0],360),lat=lonlat[1],pt=subplot.project([lon,lat]),dx=pt.x-xa.c2p([xval2,lat]),dy=pt.y-ya.c2p([lon,yval]),rad=Math.max(3,d.mrc||0);return Math.max(Math.sqrt(dx*dx+dy*dy)-rad,1-3/rad)},pointData),!1!==pointData.index){var di=cd[pointData.index],lonlat=di.lonlat,lonlatShifted=[Lib.modHalf(lonlat[0],360)+lonShift,lonlat[1]],xc=xa.c2p(lonlatShifted),yc=ya.c2p(lonlatShifted),rad=di.mrc||1;return pointData.x0=xc-rad,pointData.x1=xc+rad,pointData.y0=yc-rad,pointData.y1=yc+rad,pointData.color=getTraceColor(trace,di),pointData.extraText=function getExtraText(trace,di,labels){var parts=(di.hi||trace.hoverinfo).split("+"),isAll=-1!==parts.indexOf("all"),hasLon=-1!==parts.indexOf("lon"),hasLat=-1!==parts.indexOf("lat"),lonlat=di.lonlat,text=[];function format(v){return v+""}isAll||hasLon&&hasLat?text.push("("+format(lonlat[0])+", "+format(lonlat[1])+")"):hasLon?text.push(labels.lon+format(lonlat[0])):hasLat&&text.push(labels.lat+format(lonlat[1]));(isAll||-1!==parts.indexOf("text"))&&fillHoverText(di,trace,text);return text.join("<br>")}(trace,di,cd[0].t.labels),[pointData]}}},{"../../components/fx":609,"../../constants/numerical":670,"../../lib":693,"../scatter/fill_hover_text":1040,"../scatter/get_trace_color":1042}],1091:[function(_dereq_,module,exports){"use strict";var ScatterMapbox={};ScatterMapbox.attributes=_dereq_("./attributes"),ScatterMapbox.supplyDefaults=_dereq_("./defaults"),ScatterMapbox.colorbar=_dereq_("../scatter/marker_colorbar"),ScatterMapbox.calc=_dereq_("../scattergeo/calc"),ScatterMapbox.plot=_dereq_("./plot"),ScatterMapbox.hoverPoints=_dereq_("./hover"),ScatterMapbox.eventData=_dereq_("./event_data"),ScatterMapbox.selectPoints=_dereq_("./select"),ScatterMapbox.style=function(_,cd){cd&&cd[0].trace._glTrace.update(cd)},ScatterMapbox.moduleType="trace",ScatterMapbox.name="scattermapbox",ScatterMapbox.basePlotModule=_dereq_("../../plots/mapbox"),ScatterMapbox.categories=["mapbox","gl","symbols","showLegend","scatterlike"],ScatterMapbox.meta={},module.exports=ScatterMapbox},{"../../plots/mapbox":799,"../scatter/marker_colorbar":1050,"../scattergeo/calc":1073,"./attributes":1086,"./defaults":1088,"./event_data":1089,"./hover":1090,"./plot":1092,"./select":1093}],1092:[function(_dereq_,module,exports){"use strict";var convert=_dereq_("./convert");function ScatterMapbox(subplot,uid){this.subplot=subplot,this.uid=uid,this.sourceIds={fill:uid+"-source-fill",line:uid+"-source-line",circle:uid+"-source-circle",symbol:uid+"-source-symbol"},this.layerIds={fill:uid+"-layer-fill",line:uid+"-layer-line",circle:uid+"-layer-circle",symbol:uid+"-layer-symbol"},this.order=["fill","line","circle","symbol"]}var proto=ScatterMapbox.prototype;proto.addSource=function(k,opts){this.subplot.map.addSource(this.sourceIds[k],{type:"geojson",data:opts.geojson})},proto.setSourceData=function(k,opts){this.subplot.map.getSource(this.sourceIds[k]).setData(opts.geojson)},proto.addLayer=function(k,opts){this.subplot.map.addLayer({type:k,id:this.layerIds[k],source:this.sourceIds[k],layout:opts.layout,paint:opts.paint})},proto.update=function update(calcTrace){for(var subplot=this.subplot,optsAll=convert(calcTrace),i=0;i<this.order.length;i++){var k=this.order[i],opts=optsAll[k];subplot.setOptions(this.layerIds[k],"setLayoutProperty",opts.layout),"visible"===opts.layout.visibility&&(this.setSourceData(k,opts),subplot.setOptions(this.layerIds[k],"setPaintProperty",opts.paint))}calcTrace[0].trace._glTrace=this},proto.dispose=function dispose(){for(var map=this.subplot.map,i=0;i<this.order.length;i++){var k=this.order[i];map.removeLayer(this.layerIds[k]),map.removeSource(this.sourceIds[k])}},module.exports=function createScatterMapbox(subplot,calcTrace){for(var scatterMapbox=new ScatterMapbox(subplot,calcTrace[0].trace.uid),optsAll=convert(calcTrace),i=0;i<scatterMapbox.order.length;i++){var k=scatterMapbox.order[i],opts=optsAll[k];scatterMapbox.addSource(k,opts),scatterMapbox.addLayer(k,opts)}return calcTrace[0].trace._glTrace=scatterMapbox,scatterMapbox}},{"./convert":1087}],1093:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),subtypes=_dereq_("../scatter/subtypes"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function selectPoints(searchInfo,selectionTester){var i,cd=searchInfo.cd,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[],trace=cd[0].trace;if(!subtypes.hasMarkers(trace))return[];if(!1===selectionTester)for(i=0;i<cd.length;i++)cd[i].selected=0;else for(i=0;i<cd.length;i++){var di=cd[i],lonlat=di.lonlat;if(lonlat[0]!==BADNUM){var lonlat2=[Lib.modHalf(lonlat[0],360),lonlat[1]],xy=[xa.c2p(lonlat2),ya.c2p(lonlat2)];selectionTester.contains(xy,null,i,searchInfo)?(selection.push({pointNumber:i,lon:lonlat[0],lat:lonlat[1]}),di.selected=1):di.selected=0}}return selection}},{"../../constants/numerical":670,"../../lib":693,"../scatter/subtypes":1056}],1094:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../../lib/extend").extendFlat,scatterAttrs=_dereq_("../scatter/attributes"),plotAttrs=_dereq_("../../plots/attributes"),lineAttrs=scatterAttrs.line;module.exports={mode:scatterAttrs.mode,r:{valType:"data_array",editType:"calc+clearAxisTypes"},theta:{valType:"data_array",editType:"calc+clearAxisTypes"},r0:{valType:"any",dflt:0,editType:"calc+clearAxisTypes"},dr:{valType:"number",dflt:1,editType:"calc"},theta0:{valType:"any",dflt:0,editType:"calc+clearAxisTypes"},dtheta:{valType:"number",editType:"calc"},thetaunit:{valType:"enumerated",values:["radians","degrees","gradians"],dflt:"degrees",editType:"calc+clearAxisTypes"},text:scatterAttrs.text,hovertext:scatterAttrs.hovertext,line:{color:lineAttrs.color,width:lineAttrs.width,dash:lineAttrs.dash,shape:extendFlat({},lineAttrs.shape,{values:["linear","spline"]}),smoothing:lineAttrs.smoothing,editType:"calc"},connectgaps:scatterAttrs.connectgaps,marker:scatterAttrs.marker,cliponaxis:extendFlat({},scatterAttrs.cliponaxis,{dflt:!1}),textposition:scatterAttrs.textposition,textfont:scatterAttrs.textfont,fill:extendFlat({},scatterAttrs.fill,{values:["none","toself","tonext"],dflt:"none"}),fillcolor:scatterAttrs.fillcolor,hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["r","theta","text","name"]}),hoveron:scatterAttrs.hoveron,selected:scatterAttrs.selected,unselected:scatterAttrs.unselected}},{"../../lib/extend":682,"../../plots/attributes":739,"../scatter/attributes":1032}],1095:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),BADNUM=_dereq_("../../constants/numerical").BADNUM,Axes=_dereq_("../../plots/cartesian/axes"),calcColorscale=_dereq_("../scatter/colorscale_calc"),arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection"),calcMarkerSize=_dereq_("../scatter/calc").calcMarkerSize;module.exports=function calc(gd,trace){for(var fullLayout=gd._fullLayout,subplotId=trace.subplot,radialAxis=fullLayout[subplotId].radialaxis,angularAxis=fullLayout[subplotId].angularaxis,rArray=radialAxis.makeCalcdata(trace,"r"),thetaArray=angularAxis.makeCalcdata(trace,"theta"),len=trace._length,cd=new Array(len),i=0;i<len;i++){var r=rArray[i],theta=thetaArray[i],cdi=cd[i]={};isNumeric(r)&&isNumeric(theta)?(cdi.r=r,cdi.theta=theta):cdi.r=BADNUM}var ppad=calcMarkerSize(trace,len);return trace._extremes.x=Axes.findExtremes(radialAxis,rArray,{ppad:ppad}),calcColorscale(trace),arraysToCalcdata(cd,trace),calcSelection(cd,trace),cd}},{"../../constants/numerical":670,"../../plots/cartesian/axes":742,"../scatter/arrays_to_calcdata":1031,"../scatter/calc":1033,"../scatter/calc_selection":1034,"../scatter/colorscale_calc":1036,"fast-isnumeric":213}],1096:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleLineShapeDefaults=_dereq_("../scatter/line_shape_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),PTS_LINESONLY=_dereq_("../scatter/constants").PTS_LINESONLY,attributes=_dereq_("./attributes");function handleRThetaDefaults(traceIn,traceOut,layout,coerce){var len,r=coerce("r"),theta=coerce("theta");if(r)theta?len=Math.min(r.length,theta.length):(len=r.length,coerce("theta0"),coerce("dtheta"));else{if(!theta)return 0;len=traceOut.theta.length,coerce("r0"),coerce("dr")}return traceOut._length=len,len}module.exports={handleRThetaDefaults:handleRThetaDefaults,supplyDefaults:function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var len=handleRThetaDefaults(0,traceOut,0,coerce);if(len){coerce("thetaunit"),coerce("mode",len<PTS_LINESONLY?"lines+markers":"lines"),coerce("text"),coerce("hovertext"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),handleLineShapeDefaults(traceIn,traceOut,coerce),coerce("connectgaps")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{gradient:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce);var dfltHoverOn=[];(subTypes.hasMarkers(traceOut)||subTypes.hasText(traceOut))&&(coerce("cliponaxis"),coerce("marker.maxdisplayed"),dfltHoverOn.push("points")),coerce("fill"),"none"!==traceOut.fill&&(handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),subTypes.hasLines(traceOut)||handleLineShapeDefaults(traceIn,traceOut,coerce)),"tonext"!==traceOut.fill&&"toself"!==traceOut.fill||dfltHoverOn.push("fills"),coerce("hoveron",dfltHoverOn.join("+")||"points"),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}}},{"../../lib":693,"../scatter/constants":1037,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/line_shape_defaults":1047,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1094}],1097:[function(_dereq_,module,exports){"use strict";var scatterHover=_dereq_("../scatter/hover"),Axes=_dereq_("../../plots/cartesian/axes"),Lib=_dereq_("../../lib");function makeHoverPointText(cdi,trace,subplot,pointData){var radialAxis=subplot.radialAxis,angularAxis=subplot.angularAxis,parts=(cdi.hi||trace.hoverinfo).split("+"),text=[];function textPart(ax,val){text.push(ax._hovertitle+": "+Axes.tickText(ax,val,"hover").text)}if(radialAxis._hovertitle="r",angularAxis._hovertitle="",-1!==parts.indexOf("all")&&(parts=["r","theta","text"]),-1!==parts.indexOf("r")&&textPart(radialAxis,radialAxis.c2l(cdi.r)),-1!==parts.indexOf("theta")){var theta=cdi.theta;textPart(angularAxis,"degrees"===angularAxis.thetaunit?Lib.rad2deg(theta):theta)}-1!==parts.indexOf("text")&&pointData.text&&(text.push(pointData.text),delete pointData.text),pointData.extraText=text.join("<br>")}module.exports={hoverPoints:function hoverPoints(pointData,xval,yval,hovermode){var scatterPointData=scatterHover(pointData,xval,yval,hovermode);if(scatterPointData&&!1!==scatterPointData[0].index){var newPointData=scatterPointData[0];if(void 0===newPointData.index)return scatterPointData;var subplot=pointData.subplot,cdi=newPointData.cd[newPointData.index],trace=newPointData.trace;if(subplot.isPtInside(cdi))return newPointData.xLabelVal=void 0,newPointData.yLabelVal=void 0,makeHoverPointText(cdi,trace,subplot,newPointData),scatterPointData}},makeHoverPointText:makeHoverPointText}},{"../../lib":693,"../../plots/cartesian/axes":742,"../scatter/hover":1043}],1098:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"scatterpolar",basePlotModule:_dereq_("../../plots/polar"),categories:["polar","symbols","showLegend","scatter-like"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults").supplyDefaults,colorbar:_dereq_("../scatter/marker_colorbar"),calc:_dereq_("./calc"),plot:_dereq_("./plot"),style:_dereq_("../scatter/style").style,hoverPoints:_dereq_("./hover").hoverPoints,selectPoints:_dereq_("../scatter/select"),meta:{}}},{"../../plots/polar":808,"../scatter/marker_colorbar":1050,"../scatter/select":1053,"../scatter/style":1055,"./attributes":1094,"./calc":1095,"./defaults":1096,"./hover":1097,"./plot":1099}],1099:[function(_dereq_,module,exports){"use strict";var scatterPlot=_dereq_("../scatter/plot"),BADNUM=_dereq_("../../constants/numerical").BADNUM;module.exports=function plot(gd,subplot,moduleCalcData){for(var mlayer=subplot.layers.frontplot.select("g.scatterlayer"),plotinfo={xaxis:subplot.xaxis,yaxis:subplot.yaxis,plot:subplot.framework,layerClipId:subplot._hasClipOnAxisFalse?subplot.clipIds.forTraces:null},radialAxis=subplot.radialAxis,angularAxis=subplot.angularAxis,i=0;i<moduleCalcData.length;i++)for(var cdi=moduleCalcData[i],j=0;j<cdi.length;j++){var cd=cdi[j],r=cd.r;if(r===BADNUM)cd.x=cd.y=BADNUM;else{var rg=radialAxis.c2g(r),thetag=angularAxis.c2g(cd.theta);cd.x=rg*Math.cos(thetag),cd.y=rg*Math.sin(thetag)}}scatterPlot(gd,plotinfo,moduleCalcData,mlayer)}},{"../../constants/numerical":670,"../scatter/plot":1052}],1100:[function(_dereq_,module,exports){"use strict";var scatterPolarAttrs=_dereq_("../scatterpolar/attributes"),scatterGlAttrs=_dereq_("../scattergl/attributes");module.exports={mode:scatterPolarAttrs.mode,r:scatterPolarAttrs.r,theta:scatterPolarAttrs.theta,r0:scatterPolarAttrs.r0,dr:scatterPolarAttrs.dr,theta0:scatterPolarAttrs.theta0,dtheta:scatterPolarAttrs.dtheta,thetaunit:scatterPolarAttrs.thetaunit,text:scatterPolarAttrs.text,hovertext:scatterPolarAttrs.hovertext,line:scatterGlAttrs.line,connectgaps:scatterGlAttrs.connectgaps,marker:scatterGlAttrs.marker,fill:scatterGlAttrs.fill,fillcolor:scatterGlAttrs.fillcolor,textposition:scatterGlAttrs.textposition,textfont:scatterGlAttrs.textfont,hoverinfo:scatterPolarAttrs.hoverinfo,selected:scatterPolarAttrs.selected,unselected:scatterPolarAttrs.unselected}},{"../scattergl/attributes":1081,"../scatterpolar/attributes":1094}],1101:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),subTypes=_dereq_("../scatter/subtypes"),handleRThetaDefaults=_dereq_("../scatterpolar/defaults").handleRThetaDefaults,handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),PTS_LINESONLY=_dereq_("../scatter/constants").PTS_LINESONLY,attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var len=handleRThetaDefaults(traceIn,traceOut,layout,coerce);len?(coerce("thetaunit"),coerce("mode",len<PTS_LINESONLY?"lines+markers":"lines"),coerce("text"),coerce("hovertext"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),coerce("connectgaps")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce),coerce("fill"),"none"!==traceOut.fill&&handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)):traceOut.visible=!1}},{"../../lib":693,"../scatter/constants":1037,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"../scatterpolar/defaults":1096,"./attributes":1100}],1102:[function(_dereq_,module,exports){"use strict";var cluster=_dereq_("point-cluster"),isNumeric=_dereq_("fast-isnumeric"),ScatterGl=_dereq_("../scattergl"),calcColorscales=_dereq_("../scatter/colorscale_calc"),Axes=_dereq_("../../plots/cartesian/axes"),makeHoverPointText=_dereq_("../scatterpolar/hover").makeHoverPointText,subTypes=_dereq_("../scatter/subtypes"),TOO_MANY_POINTS=_dereq_("../scattergl/constants").TOO_MANY_POINTS;module.exports={moduleType:"trace",name:"scatterpolargl",basePlotModule:_dereq_("../../plots/polar"),categories:["gl","regl","polar","symbols","showLegend","scatter-like"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),colorbar:_dereq_("../scatter/marker_colorbar"),calc:function calc(container,trace){var layout=container._fullLayout,subplotId=trace.subplot,radialAxis=layout[subplotId].radialaxis,angularAxis=layout[subplotId].angularaxis,rArray=radialAxis.makeCalcdata(trace,"r"),thetaArray=angularAxis.makeCalcdata(trace,"theta"),stash={};return trace._length<rArray.length&&(rArray=rArray.slice(0,trace._length)),trace._length<thetaArray.length&&(thetaArray=thetaArray.slice(0,trace._length)),calcColorscales(trace),stash.r=rArray,stash.theta=thetaArray,trace._extremes.x=Axes.findExtremes(radialAxis,rArray,{tozero:!0}),[{x:!1,y:!1,t:stash,trace:trace}]},plot:function plot(container,subplot,cdata){var radialAxis=subplot.radialAxis,angularAxis=subplot.angularAxis,scene=ScatterGl.sceneUpdate(container,subplot);return cdata.forEach(function(cdscatter,traceIndex){if(cdscatter&&cdscatter[0]&&cdscatter[0].trace){var i,cd=cdscatter[0],trace=cd.trace,stash=cd.t,rArray=stash.r,thetaArray=stash.theta,subRArray=rArray.slice(),subThetaArray=thetaArray.slice();for(i=0;i<rArray.length;i++)subplot.isPtInside({r:rArray[i],theta:thetaArray[i]})||(subRArray[i]=NaN,subThetaArray[i]=NaN);var count=rArray.length,positions=new Array(2*count),x=Array(count),y=Array(count);for(i=0;i<count;i++){var xx,yy,r=subRArray[i];if(isNumeric(r)){var rg=radialAxis.c2g(r),thetag=angularAxis.c2g(subThetaArray[i],trace.thetaunit);xx=rg*Math.cos(thetag),yy=rg*Math.sin(thetag)}else xx=yy=NaN;x[i]=positions[2*i]=xx,y[i]=positions[2*i+1]=yy}var options=ScatterGl.sceneOptions(container,subplot,trace,positions);options.fill&&!scene.fill2d&&(scene.fill2d=!0),options.marker&&!scene.scatter2d&&(scene.scatter2d=!0),options.line&&!scene.line2d&&(scene.line2d=!0),!options.errorX&&!options.errorY||scene.error2d||(scene.error2d=!0),options.text&&!scene.glText&&(scene.glText=!0),stash.tree=cluster(positions),options.marker&&count>=TOO_MANY_POINTS&&(options.marker.cluster=stash.tree),subTypes.hasMarkers(trace)&&(options.markerSel.positions=options.markerUnsel.positions=options.marker.positions),scene.lineOptions.push(options.line),scene.errorXOptions.push(options.errorX),scene.errorYOptions.push(options.errorY),scene.fillOptions.push(options.fill),scene.markerOptions.push(options.marker),scene.markerSelectedOptions.push(options.markerSel),scene.markerUnselectedOptions.push(options.markerUnsel),scene.textOptions.push(options.text),scene.textSelectedOptions.push(options.textSel),scene.textUnselectedOptions.push(options.textUnsel),scene.count=cdata.length,stash._scene=scene,stash.index=traceIndex,stash.x=x,stash.y=y,stash.rawx=x,stash.rawy=y,stash.r=rArray,stash.theta=thetaArray,stash.positions=positions,stash.count=count}}),ScatterGl.plot(container,subplot,cdata)},hoverPoints:function hoverPoints(pointData,xval,yval,hovermode){var stash=pointData.cd[0].t,rArray=stash.r,thetaArray=stash.theta,scatterPointData=ScatterGl.hoverPoints(pointData,xval,yval,hovermode);if(scatterPointData&&!1!==scatterPointData[0].index){var newPointData=scatterPointData[0];if(void 0===newPointData.index)return scatterPointData;var subplot=pointData.subplot,cdi=newPointData.cd[newPointData.index],trace=newPointData.trace;if(cdi.r=rArray[newPointData.index],cdi.theta=thetaArray[newPointData.index],subplot.isPtInside(cdi))return newPointData.xLabelVal=void 0,newPointData.yLabelVal=void 0,makeHoverPointText(cdi,trace,subplot,newPointData),scatterPointData}},style:ScatterGl.style,selectPoints:ScatterGl.selectPoints,meta:{}}},{"../../plots/cartesian/axes":742,"../../plots/polar":808,"../scatter/colorscale_calc":1036,"../scatter/marker_colorbar":1050,"../scatter/subtypes":1056,"../scattergl":1085,"../scattergl/constants":1082,"../scatterpolar/hover":1097,"./attributes":1100,"./defaults":1101,"fast-isnumeric":213,"point-cluster":449}],1103:[function(_dereq_,module,exports){"use strict";var scatterAttrs=_dereq_("../scatter/attributes"),plotAttrs=_dereq_("../../plots/attributes"),colorAttributes=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),dash=_dereq_("../../components/drawing/attributes").dash,extendFlat=_dereq_("../../lib/extend").extendFlat,scatterMarkerAttrs=scatterAttrs.marker,scatterLineAttrs=scatterAttrs.line,scatterMarkerLineAttrs=scatterMarkerAttrs.line;module.exports={a:{valType:"data_array",editType:"calc"},b:{valType:"data_array",editType:"calc"},c:{valType:"data_array",editType:"calc"},sum:{valType:"number",dflt:0,min:0,editType:"calc"},mode:extendFlat({},scatterAttrs.mode,{dflt:"markers"}),text:extendFlat({},scatterAttrs.text,{}),hovertext:extendFlat({},scatterAttrs.hovertext,{}),line:{color:scatterLineAttrs.color,width:scatterLineAttrs.width,dash:dash,shape:extendFlat({},scatterLineAttrs.shape,{values:["linear","spline"]}),smoothing:scatterLineAttrs.smoothing,editType:"calc"},connectgaps:scatterAttrs.connectgaps,cliponaxis:scatterAttrs.cliponaxis,fill:extendFlat({},scatterAttrs.fill,{values:["none","toself","tonext"],dflt:"none"}),fillcolor:scatterAttrs.fillcolor,marker:extendFlat({symbol:scatterMarkerAttrs.symbol,opacity:scatterMarkerAttrs.opacity,maxdisplayed:scatterMarkerAttrs.maxdisplayed,size:scatterMarkerAttrs.size,sizeref:scatterMarkerAttrs.sizeref,sizemin:scatterMarkerAttrs.sizemin,sizemode:scatterMarkerAttrs.sizemode,line:extendFlat({width:scatterMarkerLineAttrs.width,editType:"calc"},colorAttributes("marker.line")),gradient:scatterMarkerAttrs.gradient,editType:"calc"},colorAttributes("marker"),{colorbar:colorbarAttrs}),textfont:scatterAttrs.textfont,textposition:scatterAttrs.textposition,selected:scatterAttrs.selected,unselected:scatterAttrs.unselected,hoverinfo:extendFlat({},plotAttrs.hoverinfo,{flags:["a","b","c","text","name"]}),hoveron:scatterAttrs.hoveron}},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../components/drawing/attributes":591,"../../lib/extend":682,"../../plots/attributes":739,"../scatter/attributes":1032}],1104:[function(_dereq_,module,exports){"use strict";var isNumeric=_dereq_("fast-isnumeric"),calcColorscale=_dereq_("../scatter/colorscale_calc"),arraysToCalcdata=_dereq_("../scatter/arrays_to_calcdata"),calcSelection=_dereq_("../scatter/calc_selection"),calcMarkerSize=_dereq_("../scatter/calc").calcMarkerSize,dataArrays=["a","b","c"],arraysToFill={a:["b","c"],b:["a","c"],c:["a","b"]};module.exports=function calc(gd,trace){var i,j,dataArray,newArray,fillArray1,fillArray2,displaySum=gd._fullLayout[trace.subplot].sum,normSum=trace.sum||displaySum,arrays={a:trace.a,b:trace.b,c:trace.c};for(i=0;i<dataArrays.length;i++)if(!arrays[dataArray=dataArrays[i]]){for(fillArray1=arrays[arraysToFill[dataArray][0]],fillArray2=arrays[arraysToFill[dataArray][1]],newArray=new Array(fillArray1.length),j=0;j<fillArray1.length;j++)newArray[j]=normSum-fillArray1[j]-fillArray2[j];arrays[dataArray]=newArray}var a,b,c,norm,x,y,serieslen=trace._length,cd=new Array(serieslen);for(i=0;i<serieslen;i++)a=arrays.a[i],b=arrays.b[i],c=arrays.c[i],isNumeric(a)&&isNumeric(b)&&isNumeric(c)?(1!==(norm=displaySum/((a=+a)+(b=+b)+(c=+c)))&&(a*=norm,b*=norm,c*=norm),y=a,x=c-b,cd[i]={x:x,y:y,a:a,b:b,c:c}):cd[i]={x:!1,y:!1};return calcMarkerSize(trace,serieslen),calcColorscale(trace),arraysToCalcdata(cd,trace),calcSelection(cd,trace),cd}},{"../scatter/arrays_to_calcdata":1031,"../scatter/calc":1033,"../scatter/calc_selection":1034,"../scatter/colorscale_calc":1036,"fast-isnumeric":213}],1105:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),constants=_dereq_("../scatter/constants"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),handleLineDefaults=_dereq_("../scatter/line_defaults"),handleLineShapeDefaults=_dereq_("../scatter/line_shape_defaults"),handleTextDefaults=_dereq_("../scatter/text_defaults"),handleFillColorDefaults=_dereq_("../scatter/fillcolor_defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var len,a=coerce("a"),b=coerce("b"),c=coerce("c");if(a?(len=a.length,b?(len=Math.min(len,b.length),c&&(len=Math.min(len,c.length))):len=c?Math.min(len,c.length):0):b&&c&&(len=Math.min(b.length,c.length)),len){traceOut._length=len,coerce("sum"),coerce("text"),coerce("hovertext"),coerce("mode",len<constants.PTS_LINESONLY?"lines+markers":"lines"),subTypes.hasLines(traceOut)&&(handleLineDefaults(traceIn,traceOut,defaultColor,layout,coerce),handleLineShapeDefaults(traceIn,traceOut,coerce),coerce("connectgaps")),subTypes.hasMarkers(traceOut)&&handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce,{gradient:!0}),subTypes.hasText(traceOut)&&handleTextDefaults(traceIn,traceOut,layout,coerce);var dfltHoverOn=[];(subTypes.hasMarkers(traceOut)||subTypes.hasText(traceOut))&&(coerce("cliponaxis"),coerce("marker.maxdisplayed"),dfltHoverOn.push("points")),coerce("fill"),"none"!==traceOut.fill&&(handleFillColorDefaults(traceIn,traceOut,defaultColor,coerce),subTypes.hasLines(traceOut)||handleLineShapeDefaults(traceIn,traceOut,coerce)),"tonext"!==traceOut.fill&&"toself"!==traceOut.fill||dfltHoverOn.push("fills"),coerce("hoveron",dfltHoverOn.join("+")||"points"),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../lib":693,"../scatter/constants":1037,"../scatter/fillcolor_defaults":1041,"../scatter/line_defaults":1045,"../scatter/line_shape_defaults":1047,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"../scatter/text_defaults":1057,"./attributes":1103}],1106:[function(_dereq_,module,exports){"use strict";module.exports=function eventData(out,pt,trace,cd,pointNumber){if(pt.xa&&(out.xaxis=pt.xa),pt.ya&&(out.yaxis=pt.ya),cd[pointNumber]){var cdi=cd[pointNumber];out.a=cdi.a,out.b=cdi.b,out.c=cdi.c}else out.a=pt.a,out.b=pt.b,out.c=pt.c;return out}},{}],1107:[function(_dereq_,module,exports){"use strict";var scatterHover=_dereq_("../scatter/hover"),Axes=_dereq_("../../plots/cartesian/axes");module.exports=function hoverPoints(pointData,xval,yval,hovermode){var scatterPointData=scatterHover(pointData,xval,yval,hovermode);if(scatterPointData&&!1!==scatterPointData[0].index){var newPointData=scatterPointData[0];if(void 0===newPointData.index){var yFracUp=1-newPointData.y0/pointData.ya._length,xLen=pointData.xa._length,xMin=xLen*yFracUp/2,xMax=xLen-xMin;return newPointData.x0=Math.max(Math.min(newPointData.x0,xMax),xMin),newPointData.x1=Math.max(Math.min(newPointData.x1,xMax),xMin),scatterPointData}var cdi=newPointData.cd[newPointData.index];newPointData.a=cdi.a,newPointData.b=cdi.b,newPointData.c=cdi.c,newPointData.xLabelVal=void 0,newPointData.yLabelVal=void 0;var trace=newPointData.trace,ternary=newPointData.subplot,parts=(cdi.hi||trace.hoverinfo).split("+"),text=[];return-1!==parts.indexOf("all")&&(parts=["a","b","c"]),-1!==parts.indexOf("a")&&textPart(ternary.aaxis,cdi.a),-1!==parts.indexOf("b")&&textPart(ternary.baxis,cdi.b),-1!==parts.indexOf("c")&&textPart(ternary.caxis,cdi.c),newPointData.extraText=text.join("<br>"),scatterPointData}function textPart(ax,val){text.push(ax._hovertitle+": "+Axes.tickText(ax,val,"hover").text)}}},{"../../plots/cartesian/axes":742,"../scatter/hover":1043}],1108:[function(_dereq_,module,exports){"use strict";var ScatterTernary={};ScatterTernary.attributes=_dereq_("./attributes"),ScatterTernary.supplyDefaults=_dereq_("./defaults"),ScatterTernary.colorbar=_dereq_("../scatter/marker_colorbar"),ScatterTernary.calc=_dereq_("./calc"),ScatterTernary.plot=_dereq_("./plot"),ScatterTernary.style=_dereq_("../scatter/style").style,ScatterTernary.styleOnSelect=_dereq_("../scatter/style").styleOnSelect,ScatterTernary.hoverPoints=_dereq_("./hover"),ScatterTernary.selectPoints=_dereq_("../scatter/select"),ScatterTernary.eventData=_dereq_("./event_data"),ScatterTernary.moduleType="trace",ScatterTernary.name="scatterternary",ScatterTernary.basePlotModule=_dereq_("../../plots/ternary"),ScatterTernary.categories=["ternary","symbols","showLegend","scatter-like"],ScatterTernary.meta={},module.exports=ScatterTernary},{"../../plots/ternary":821,"../scatter/marker_colorbar":1050,"../scatter/select":1053,"../scatter/style":1055,"./attributes":1103,"./calc":1104,"./defaults":1105,"./event_data":1106,"./hover":1107,"./plot":1109}],1109:[function(_dereq_,module,exports){"use strict";var scatterPlot=_dereq_("../scatter/plot");module.exports=function plot(gd,ternary,moduleCalcData){var plotContainer=ternary.plotContainer;plotContainer.select(".scatterlayer").selectAll("*").remove();var plotinfo={xaxis:ternary.xaxis,yaxis:ternary.yaxis,plot:plotContainer,layerClipId:ternary._hasClipOnAxisFalse?ternary.clipIdRelative:null},scatterLayer=ternary.layers.frontplot.select("g.scatterlayer");scatterPlot(gd,plotinfo,moduleCalcData,scatterLayer)}},{"../scatter/plot":1052}],1110:[function(_dereq_,module,exports){"use strict";var scatterGlAttrs=_dereq_("../scattergl/attributes"),cartesianIdRegex=_dereq_("../../plots/cartesian/constants").idRegex,templatedArray=_dereq_("../../plot_api/plot_template").templatedArray;function makeAxesValObject(axLetter){return{valType:"info_array",freeLength:!0,editType:"calc",items:{valType:"subplotid",regex:cartesianIdRegex[axLetter],editType:"plot"}}}module.exports={dimensions:templatedArray("dimension",{visible:{valType:"boolean",dflt:!0,editType:"calc"},label:{valType:"string",editType:"calc"},values:{valType:"data_array",editType:"calc+clearAxisTypes"},axis:{type:{valType:"enumerated",values:["linear","log","date","category"],editType:"calc+clearAxisTypes"},editType:"calc+clearAxisTypes"},editType:"calc+clearAxisTypes"}),text:scatterGlAttrs.text,marker:scatterGlAttrs.marker,xaxes:makeAxesValObject("x"),yaxes:makeAxesValObject("y"),diagonal:{visible:{valType:"boolean",dflt:!0,editType:"calc"},editType:"calc"},showupperhalf:{valType:"boolean",dflt:!0,editType:"calc"},showlowerhalf:{valType:"boolean",dflt:!0,editType:"calc"},selected:{marker:scatterGlAttrs.selected.marker,editType:"calc"},unselected:{marker:scatterGlAttrs.unselected.marker,editType:"calc"},opacity:scatterGlAttrs.opacity}},{"../../plot_api/plot_template":732,"../../plots/cartesian/constants":747,"../scattergl/attributes":1081}],1111:[function(_dereq_,module,exports){"use strict";var createLine=_dereq_("regl-line2d"),Registry=_dereq_("../../registry"),prepareRegl=_dereq_("../../lib/prepare_regl"),getModuleCalcData=_dereq_("../../plots/get_data").getModuleCalcData,Cartesian=_dereq_("../../plots/cartesian"),getFromId=_dereq_("../../plots/cartesian/axis_ids").getFromId,shouldShowZeroLine=_dereq_("../../plots/cartesian/axes").shouldShowZeroLine,SPLOM="splom";function dragOne(gd,trace,stash,scene){for(var visibleLength=scene.matrixOptions.data.length,visibleDims=stash.visibleDims,ranges=new Array(visibleLength),k=0;k<visibleDims.length;k++){var i=visibleDims[k],rng=ranges[k]=new Array(4),xa=getFromId(gd,trace._diag[i][0]);xa&&(rng[0]=xa.r2l(xa.range[0]),rng[2]=xa.r2l(xa.range[1]));var ya=getFromId(gd,trace._diag[i][1]);ya&&(rng[1]=ya.r2l(ya.range[0]),rng[3]=ya.r2l(ya.range[1]))}scene.selectBatch?(scene.matrix.update({ranges:ranges},{ranges:ranges}),scene.matrix.draw(scene.unselectBatch,scene.selectBatch)):(scene.matrix.update({ranges:ranges}),scene.matrix.draw())}function drawGrid(gd){var fullLayout=gd._fullLayout,regl=fullLayout._glcanvas.data()[0].regl,splomGrid=fullLayout._splomGrid;splomGrid||(splomGrid=fullLayout._splomGrid=createLine(regl)),splomGrid.update(function makeGridData(gd){var k,fullLayout=gd._fullLayout,gs=fullLayout._size,fullView=[0,0,fullLayout.width,fullLayout.height],lookup={};function push(prefix,ax,x0,x1,y0,y1){var lcolor=ax[prefix+"color"],lwidth=ax[prefix+"width"],key=String(lcolor+lwidth);key in lookup?lookup[key].data.push(NaN,NaN,x0,x1,y0,y1):lookup[key]={data:[x0,x1,y0,y1],join:"rect",thickness:lwidth,color:lcolor,viewport:fullView,range:fullView,overlay:!1}}for(k in fullLayout._splomSubplots){var x,y,sp=fullLayout._plots[k],xa=sp.xaxis,ya=sp.yaxis,xVals=xa._vals,yVals=ya._vals,yOffset=gs.b+ya.domain[0]*gs.h,ym=-ya._m,yb=-ym*ya.r2l(ya.range[0],ya.calendar);if(xa.showgrid)for(k=0;k<xVals.length;k++)x=xa._offset+xa.l2p(xVals[k].x),push("grid",xa,x,yOffset,x,yOffset+ya._length);if(ya.showgrid)for(k=0;k<yVals.length;k++)y=yOffset+yb+ym*yVals[k].x,push("grid",ya,xa._offset,y,xa._offset+xa._length,y);shouldShowZeroLine(gd,xa,ya)&&(x=xa._offset+xa.l2p(0),push("zeroline",xa,x,yOffset,x,yOffset+ya._length)),shouldShowZeroLine(gd,ya,xa)&&(y=yOffset+yb+0,push("zeroline",ya,xa._offset,y,xa._offset+xa._length,y))}var gridBatches=[];for(k in lookup)gridBatches.push(lookup[k]);return gridBatches}(gd)),splomGrid.draw()}module.exports={name:SPLOM,attr:Cartesian.attr,attrRegex:Cartesian.attrRegex,layoutAttributes:Cartesian.layoutAttributes,supplyLayoutDefaults:Cartesian.supplyLayoutDefaults,drawFramework:Cartesian.drawFramework,plot:function plot(gd){var fullLayout=gd._fullLayout,_module=Registry.getModule(SPLOM),splomCalcData=getModuleCalcData(gd.calcdata,_module)[0];prepareRegl(gd,["ANGLE_instanced_arrays","OES_element_index_uint"])&&(fullLayout._hasOnlyLargeSploms&&drawGrid(gd),_module.plot(gd,{},splomCalcData))},drag:function drag(gd){var cd=gd.calcdata;gd._fullLayout._hasOnlyLargeSploms&&drawGrid(gd);for(var i=0;i<cd.length;i++){var cd0=cd[i][0],trace=cd0.trace,stash=cd0.t,scene=stash._scene;"splom"===trace.type&&scene&&scene.matrix&&dragOne(gd,trace,stash,scene)}},clean:function clean(newFullData,newFullLayout,oldFullData,oldFullLayout,oldCalcdata){var hadSplom,hasSplom,i,oldModules=oldFullLayout._modules||[],newModules=newFullLayout._modules||[];for(i=0;i<oldModules.length;i++)if("splom"===oldModules[i].name){hadSplom=!0;break}for(i=0;i<newModules.length;i++)if("splom"===newModules[i].name){hasSplom=!0;break}if(hadSplom&&!hasSplom)for(i=0;i<oldCalcdata.length;i++){var cd0=oldCalcdata[i][0],trace=cd0.trace,scene=cd0.t._scene;"splom"===trace.type&&scene&&scene.matrix&&scene.matrix.destroy&&(scene.matrix.destroy(),cd0.t._scene=null)}oldFullLayout._splomGrid&&!newFullLayout._hasOnlyLargeSploms&&oldFullLayout._hasOnlyLargeSploms&&(oldFullLayout._splomGrid.destroy(),oldFullLayout._splomGrid=null),Cartesian.clean(newFullData,newFullLayout,oldFullData,oldFullLayout)},updateFx:function updateFx(gd){Cartesian.updateFx(gd);var dragmode=gd._fullLayout.dragmode;if("zoom"===dragmode||"pan"===dragmode)for(var cd=gd.calcdata,i=0;i<cd.length;i++){var cd0=cd[i][0];if("splom"===cd0.trace.type){var scene=cd0.t._scene;null===scene.selectBatch&&scene.matrix.update(scene.matrixOptions,null)}}},toSVG:Cartesian.toSVG}},{"../../lib/prepare_regl":707,"../../plots/cartesian":753,"../../plots/cartesian/axes":742,"../../plots/cartesian/axis_ids":745,"../../plots/get_data":778,"../../registry":825,"regl-line2d":471}],1112:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),handleArrayContainerDefaults=_dereq_("../../plots/array_container_defaults"),attributes=_dereq_("./attributes"),subTypes=_dereq_("../scatter/subtypes"),handleMarkerDefaults=_dereq_("../scatter/marker_defaults"),mergeLength=_dereq_("../parcoords/merge_length"),OPEN_RE=/-open/;function dimensionDefaults(dimIn,dimOut){function coerce(attr,dflt){return Lib.coerce(dimIn,dimOut,attributes.dimensions,attr,dflt)}coerce("label");var values=coerce("values");values&&values.length?coerce("visible"):dimOut.visible=!1,coerce("axis.type")}function fillAxisIdArray(axLetter,len){for(var out=new Array(len),i=0;i<len;i++)out[i]=axLetter+(i?i+1:"");return out}function fillAxisStash(layout,axId,dim){if(axId){var axLetter=axId.charAt(0),stash=layout._splomAxes[axLetter];if(!(axId in stash)){var s=stash[axId]={};dim&&(s.label=dim.label||"",dim.visible&&dim.axis&&(s.type=dim.axis.type))}}}function arrayToHashObject(arr){for(var obj={},i=0;i<arr.length;i++)obj[arr[i]]=1;return obj}module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var dimensions=handleArrayContainerDefaults(traceIn,traceOut,{name:"dimensions",handleItemDefaults:dimensionDefaults}),showDiag=coerce("diagonal.visible"),showUpper=coerce("showupperhalf"),showLower=coerce("showlowerhalf");if(mergeLength(traceOut,dimensions,"values")&&(showDiag||showUpper||showLower)){coerce("text"),handleMarkerDefaults(traceIn,traceOut,defaultColor,layout,coerce);var isOpen=OPEN_RE.test(traceOut.marker.symbol),isBubble=subTypes.isBubble(traceOut);coerce("marker.line.width",isOpen||isBubble?1:0),function handleAxisDefaults(traceIn,traceOut,layout,coerce){var i,j,dimensions=traceOut.dimensions,dimLength=dimensions.length,showUpper=traceOut.showupperhalf,showLower=traceOut.showlowerhalf,showDiag=traceOut.diagonal.visible,axDfltLength=showDiag||showUpper&&showLower?dimLength:dimLength-1,xaxes=coerce("xaxes",fillAxisIdArray("x",axDfltLength)),yaxes=coerce("yaxes",fillAxisIdArray("y",axDfltLength));traceOut._xaxes=arrayToHashObject(xaxes),traceOut._yaxes=arrayToHashObject(yaxes);var axLength=Math.min(axDfltLength,xaxes.length,yaxes.length);for(i=0;i<axLength;i++)for(j=0;j<axLength;j++){var id=xaxes[i]+yaxes[j];i>j&&showUpper?layout._splomSubplots[id]=1:i<j&&showLower?layout._splomSubplots[id]=1:i!==j||!showDiag&&showLower&&showUpper||(layout._splomSubplots[id]=1)}var diag=traceOut._diag=new Array(dimLength),xShift=showDiag||showLower?0:-1,yShift=showDiag||showUpper?0:-1;for(i=0;i<dimLength;i++){var dim=dimensions[i],xaId=xaxes[i+xShift],yaId=yaxes[i+yShift];fillAxisStash(layout,xaId,dim),fillAxisStash(layout,yaId,dim),diag[i]=[xaId,yaId]}showLower||(layout._splomGridDflt.xside="bottom",layout._splomGridDflt.yside="left")}(0,traceOut,layout,coerce),Lib.coerceSelectionMarkerOpacity(traceOut,coerce)}else traceOut.visible=!1}},{"../../lib":693,"../../plots/array_container_defaults":738,"../parcoords/merge_length":1004,"../scatter/marker_defaults":1051,"../scatter/subtypes":1056,"./attributes":1110}],1113:[function(_dereq_,module,exports){"use strict";var createMatrix=_dereq_("regl-splom"),arrayRange=_dereq_("array-range"),Registry=_dereq_("../../registry"),Grid=_dereq_("../../components/grid"),Lib=_dereq_("../../lib"),AxisIDs=_dereq_("../../plots/cartesian/axis_ids"),subTypes=_dereq_("../scatter/subtypes"),calcMarkerSize=_dereq_("../scatter/calc").calcMarkerSize,calcAxisExpansion=_dereq_("../scatter/calc").calcAxisExpansion,calcColorscales=_dereq_("../scatter/colorscale_calc"),convertMarkerSelection=_dereq_("../scattergl/convert").markerSelection,convertMarkerStyle=_dereq_("../scattergl/convert").markerStyle,calcHover=_dereq_("../scattergl").calcHover,BADNUM=_dereq_("../../constants/numerical").BADNUM,TOO_MANY_POINTS=_dereq_("../scattergl/constants").TOO_MANY_POINTS;function plotOne(gd,cd0){var xa,ya,i,j,k,fullLayout=gd._fullLayout,gs=fullLayout._size,trace=cd0.trace,stash=cd0.t,scene=stash._scene,matrixOpts=scene.matrixOptions,cdata=matrixOpts.cdata,regl=fullLayout._glcanvas.data()[0].regl,dragmode=fullLayout.dragmode;if(0!==cdata.length){matrixOpts.lower=trace.showupperhalf,matrixOpts.upper=trace.showlowerhalf,matrixOpts.diagonal=trace.diagonal.visible;var visibleDims=stash.visibleDims,visibleLength=cdata.length,viewOpts={};for(viewOpts.ranges=new Array(visibleLength),viewOpts.domains=new Array(visibleLength),k=0;k<visibleDims.length;k++){i=visibleDims[k];var rng=viewOpts.ranges[k]=new Array(4),dmn=viewOpts.domains[k]=new Array(4);(xa=AxisIDs.getFromId(gd,trace._diag[i][0]))&&(rng[0]=xa._rl[0],rng[2]=xa._rl[1],dmn[0]=xa.domain[0],dmn[2]=xa.domain[1]),(ya=AxisIDs.getFromId(gd,trace._diag[i][1]))&&(rng[1]=ya._rl[0],rng[3]=ya._rl[1],dmn[1]=ya.domain[0],dmn[3]=ya.domain[1])}viewOpts.viewport=[gs.l,gs.b,gs.w+gs.l,gs.h+gs.b],!0===scene.matrix&&(scene.matrix=createMatrix(regl));var clickSelectEnabled=fullLayout.clickmode.indexOf("select")>-1,selectMode="lasso"===dragmode||"select"===dragmode||!!trace.selectedpoints||clickSelectEnabled;if(scene.selectBatch=null,scene.unselectBatch=null,selectMode){var commonLength=trace._length;if(scene.selectBatch||(scene.selectBatch=[],scene.unselectBatch=[]),trace.selectedpoints){scene.selectBatch=trace.selectedpoints;var selPts=trace.selectedpoints,selDict={};for(i=0;i<selPts.length;i++)selDict[selPts[i]]=!0;var unselPts=[];for(i=0;i<commonLength;i++)selDict[i]||unselPts.push(i);scene.unselectBatch=unselPts}var xpx=stash.xpx=new Array(visibleLength),ypx=stash.ypx=new Array(visibleLength);for(k=0;k<visibleDims.length;k++){if(i=visibleDims[k],xa=AxisIDs.getFromId(gd,trace._diag[i][0]))for(xpx[k]=new Array(commonLength),j=0;j<commonLength;j++)xpx[k][j]=xa.c2p(cdata[k][j]);if(ya=AxisIDs.getFromId(gd,trace._diag[i][1]))for(ypx[k]=new Array(commonLength),j=0;j<commonLength;j++)ypx[k][j]=ya.c2p(cdata[k][j])}scene.selectBatch?(scene.matrix.update(matrixOpts,matrixOpts),scene.matrix.update(scene.unselectedOptions,scene.selectedOptions),scene.matrix.update(viewOpts,viewOpts)):scene.matrix.update(viewOpts,null)}else scene.matrix.update(matrixOpts,null),scene.matrix.update(viewOpts,null),stash.xpx=stash.ypx=null;scene.draw()}}function getDimIndex(trace,stash,ax){for(var axId=ax._id,ind={x:0,y:1}[axId.charAt(0)],visibleDims=stash.visibleDims,k=0;k<visibleDims.length;k++){var i=visibleDims[k];if(trace._diag[i][ind]===axId)return k}return!1}module.exports={moduleType:"trace",name:"splom",basePlotModule:_dereq_("./base_plot"),categories:["gl","regl","cartesian","symbols","showLegend","scatter-like"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),colorbar:_dereq_("../scatter/marker_colorbar"),calc:function calc(gd,trace){var i,k,dim,xa,ya,dimensions=trace.dimensions,commonLength=trace._length,stash={},opts={},cdata=opts.cdata=[],ldata=opts.data=[],visibleDims=stash.visibleDims=[];function makeCalcdata(ax,dim){for(var ccol=ax.makeCalcdata({v:dim.values,vcalendar:trace.calendar},"v"),j=0;j<ccol.length;j++)ccol[j]=ccol[j]===BADNUM?NaN:ccol[j];cdata.push(ccol),ldata.push("log"===ax.type?Lib.simpleMap(ccol,ax.c2l):ccol)}for(i=0;i<dimensions.length;i++)if((dim=dimensions[i]).visible){if(xa=AxisIDs.getFromId(gd,trace._diag[i][0]),ya=AxisIDs.getFromId(gd,trace._diag[i][1]),xa&&ya&&xa.type!==ya.type){Lib.log("Skipping splom dimension "+i+" with conflicting axis types");continue}xa?(makeCalcdata(xa,dim),ya&&"category"===ya.type&&(ya._categories=xa._categories.slice())):makeCalcdata(ya,dim),visibleDims.push(i)}calcColorscales(trace),Lib.extendFlat(opts,convertMarkerStyle(trace));var hasTooManyPoints=cdata.length*commonLength>TOO_MANY_POINTS;for(k=0;k<visibleDims.length;k++){var ppad;dim=dimensions[i=visibleDims[k]],xa=AxisIDs.getFromId(gd,trace._diag[i][0])||{},ya=AxisIDs.getFromId(gd,trace._diag[i][1])||{},ppad=hasTooManyPoints?2*(opts.sizeAvg||Math.max(opts.size,3)):calcMarkerSize(trace,commonLength),calcAxisExpansion(gd,trace,xa,ya,cdata[k],cdata[k],ppad)}var scene=stash._scene=function sceneUpdate(gd,stash){var scene=stash._scene,reset={dirty:!0};return scene||((scene=stash._scene=Lib.extendFlat({},reset,{selectBatch:null,unselectBatch:null,matrix:!1,select:null})).draw=function draw(){scene.matrix&&scene.selectBatch?scene.matrix.draw(scene.unselectBatch,scene.selectBatch):scene.matrix&&scene.matrix.draw(),scene.dirty=!1},scene.destroy=function destroy(){scene.matrix&&scene.matrix.destroy(),scene.matrixOptions=null,scene.selectBatch=null,scene.unselectBatch=null,stash._scene=null}),scene.dirty||Lib.extendFlat(scene,reset),scene}(0,stash);return scene.matrix||(scene.matrix=!0),scene.matrixOptions=opts,scene.selectedOptions=convertMarkerSelection(trace,trace.selected),scene.unselectedOptions=convertMarkerSelection(trace,trace.unselected),[{x:!1,y:!1,t:stash,trace:trace}]},plot:function plot(gd,_,splomCalcData){if(splomCalcData.length)for(var i=0;i<splomCalcData.length;i++)plotOne(gd,splomCalcData[i][0])},hoverPoints:function hoverPoints(pointData,xval,yval){var cd=pointData.cd,trace=cd[0].trace,stash=cd[0].t,cdata=stash._scene.matrixOptions.cdata,xa=pointData.xa,ya=pointData.ya,xpx=xa.c2p(xval),ypx=ya.c2p(yval),maxDistance=pointData.distance,xi=getDimIndex(trace,stash,xa),yi=getDimIndex(trace,stash,ya);if(!1===xi||!1===yi)return[pointData];for(var id,dxy,x=cdata[xi],y=cdata[yi],minDist=maxDistance,i=0;i<x.length;i++){var ptx=x[i],pty=y[i],dx=xa.c2p(ptx)-xpx,dy=ya.c2p(pty)-ypx,dist=Math.sqrt(dx*dx+dy*dy);dist<minDist&&(minDist=dxy=dist,id=i)}return pointData.index=id,pointData.distance=minDist,pointData.dxy=dxy,void 0===id?[pointData]:(calcHover(pointData,x,y,trace),[pointData])},selectPoints:function selectPoints(searchInfo,selectionTester){var i,cd=searchInfo.cd,trace=cd[0].trace,stash=cd[0].t,scene=stash._scene,cdata=scene.matrixOptions.cdata,xa=searchInfo.xaxis,ya=searchInfo.yaxis,selection=[];if(!scene)return selection;var hasOnlyLines=!subTypes.hasMarkers(trace)&&!subTypes.hasText(trace);if(!0!==trace.visible||hasOnlyLines)return selection;var xi=getDimIndex(trace,stash,xa),yi=getDimIndex(trace,stash,ya);if(!1===xi||!1===yi)return selection;var xpx=stash.xpx[xi],ypx=stash.ypx[yi],x=cdata[xi],y=cdata[yi],els=null,unels=null;if(!1===selectionTester||selectionTester.degenerate)unels=arrayRange(stash.count);else for(els=[],unels=[],i=0;i<x.length;i++)selectionTester.contains([xpx[i],ypx[i]],null,i,searchInfo)?(els.push(i),selection.push({pointNumber:i,x:x[i],y:y[i]})):unels.push(i);if(scene.selectBatch||(scene.selectBatch=[],scene.unselectBatch=[]),!scene.selectBatch){for(i=0;i<scene.count;i++)scene.selectBatch=[],scene.unselectBatch=[];scene.matrix.update(scene.unselectedOptions,scene.selectedOptions)}return scene.selectBatch=els,scene.unselectBatch=unels,selection},style:function style(gd,cds){if(cds){var fullLayout=gd._fullLayout;cds[0][0].t._scene.matrix.regl.clear({color:!0,depth:!0}),fullLayout._splomGrid&&fullLayout._splomGrid.draw();for(var i=0;i<cds.length;i++)cds[i][0].t._scene.draw();if(fullLayout._has("cartesian"))for(var k in fullLayout._plots){var sp=fullLayout._plots[k];sp._scene&&sp._scene.draw()}}},meta:{}},Registry.register(Grid)},{"../../components/grid":613,"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axis_ids":745,"../../registry":825,"../scatter/calc":1033,"../scatter/colorscale_calc":1036,"../scatter/marker_colorbar":1050,"../scatter/subtypes":1056,"../scattergl":1085,"../scattergl/constants":1082,"../scattergl/convert":1083,"./attributes":1110,"./base_plot":1111,"./defaults":1112,"array-range":54,"regl-splom":474}],1114:[function(_dereq_,module,exports){"use strict";var colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),mesh3dAttrs=_dereq_("../mesh3d/attributes"),baseAttrs=_dereq_("../../plots/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,attrs={x:{valType:"data_array",editType:"calc+clearAxisTypes"},y:{valType:"data_array",editType:"calc+clearAxisTypes"},z:{valType:"data_array",editType:"calc+clearAxisTypes"},u:{valType:"data_array",editType:"calc"},v:{valType:"data_array",editType:"calc"},w:{valType:"data_array",editType:"calc"},starts:{x:{valType:"data_array",editType:"calc"},y:{valType:"data_array",editType:"calc"},z:{valType:"data_array",editType:"calc"},editType:"calc"},maxdisplayed:{valType:"integer",min:0,dflt:1e3,editType:"calc"},sizeref:{valType:"number",editType:"calc",min:0,dflt:1},text:{valType:"string",dflt:"",editType:"calc"}};extendFlat(attrs,colorscaleAttrs("",{colorAttr:"u/v/w norm",showScaleDflt:!0,editTypeOverride:"calc"}),{colorbar:colorbarAttrs});["opacity","lightposition","lighting"].forEach(function(k){attrs[k]=mesh3dAttrs[k]}),attrs.hoverinfo=extendFlat({},baseAttrs.hoverinfo,{editType:"calc",flags:["x","y","z","u","v","w","norm","divergence","text","name"],dflt:"x+y+z+norm+text+name"}),module.exports=attrs},{"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plots/attributes":739,"../mesh3d/attributes":982}],1115:[function(_dereq_,module,exports){"use strict";var colorscaleCalc=_dereq_("../../components/colorscale/calc");module.exports=function calc(gd,trace){var i,startx,starty,startz,u=trace.u,v=trace.v,w=trace.w,x=trace.x,y=trace.y,z=trace.z,len=Math.min(x.length,y.length,z.length,u.length,v.length,w.length),slen=0;trace.starts&&(startx=trace.starts.x||[],starty=trace.starts.y||[],startz=trace.starts.z||[],slen=Math.min(startx.length,starty.length,startz.length));var normMax=0,normMin=1/0;for(i=0;i<len;i++){var uu=u[i],vv=v[i],ww=w[i],norm=Math.sqrt(uu*uu+vv*vv+ww*ww);normMax=Math.max(normMax,norm),normMin=Math.min(normMin,norm)}colorscaleCalc(trace,[normMin,normMax],"","c");var xMax=-1/0,xMin=1/0,yMax=-1/0,yMin=1/0,zMax=-1/0,zMin=1/0;for(i=0;i<len;i++){var xx=x[i];xMax=Math.max(xMax,xx),xMin=Math.min(xMin,xx);var yy=y[i];yMax=Math.max(yMax,yy),yMin=Math.min(yMin,yy);var zz=z[i];zMax=Math.max(zMax,zz),zMin=Math.min(zMin,zz)}for(i=0;i<slen;i++){var sx=startx[i];xMax=Math.max(xMax,sx),xMin=Math.min(xMin,sx);var sy=starty[i];yMax=Math.max(yMax,sy),yMin=Math.min(yMin,sy);var sz=startz[i];zMax=Math.max(zMax,sz),zMin=Math.min(zMin,sz)}trace._len=len,trace._slen=slen,trace._normMax=normMax,trace._xbnds=[xMin,xMax],trace._ybnds=[yMin,yMax],trace._zbnds=[zMin,zMax]}},{"../../components/colorscale/calc":575}],1116:[function(_dereq_,module,exports){"use strict";var tube2mesh=_dereq_("gl-streamtube3d"),createTubeMesh=tube2mesh.createTubeMesh,Lib=_dereq_("../../lib"),parseColorScale=_dereq_("../../lib/gl_format_color").parseColorScale,zip3=_dereq_("../../plots/gl3d/zip3"),axisName2scaleIndex={xaxis:0,yaxis:1,zaxis:2};function Streamtube(scene,uid){this.scene=scene,this.uid=uid,this.mesh=null,this.data=null}var proto=Streamtube.prototype;function distinctVals(col){return Lib.distinctVals(col).vals}function getDfltStartingPositions(vec){var len=vec.length;return len>2?vec.slice(1,len-1):2===len?[(vec[0]+vec[1])/2]:vec}function getBoundPads(vec){var len=vec.length;return 1===len?[.5,.5]:[vec[1]-vec[0],vec[len-1]-vec[len-2]]}function convert(scene,trace){var sceneLayout=scene.fullSceneLayout,dataScale=scene.dataScale,len=trace._len,tubeOpts={};function toDataCoords(arr,axisName){var ax=sceneLayout[axisName],scale=dataScale[axisName2scaleIndex[axisName]];return Lib.simpleMap(arr,function(v){return ax.d2l(v)*scale})}tubeOpts.vectors=zip3(toDataCoords(trace.u,"xaxis"),toDataCoords(trace.v,"yaxis"),toDataCoords(trace.w,"zaxis"),len);var valsx=distinctVals(trace.x.slice(0,len)),valsy=distinctVals(trace.y.slice(0,len)),valsz=distinctVals(trace.z.slice(0,len));if(valsx.length*valsy.length*valsz.length>len)return{positions:[],cells:[]};var meshx=toDataCoords(valsx,"xaxis"),meshy=toDataCoords(valsy,"yaxis"),meshz=toDataCoords(valsz,"zaxis");if(tubeOpts.meshgrid=[meshx,meshy,meshz],trace.starts){var slen=trace._slen;tubeOpts.startingPositions=zip3(toDataCoords(trace.starts.x.slice(0,slen),"xaxis"),toDataCoords(trace.starts.y.slice(0,slen),"yaxis"),toDataCoords(trace.starts.z.slice(0,slen),"zaxis"))}else{for(var sy0=meshy[0],sx=getDfltStartingPositions(meshx),sz=getDfltStartingPositions(meshz),startingPositions=new Array(sx.length*sz.length),m=0,i=0;i<sx.length;i++)for(var k=0;k<sz.length;k++)startingPositions[m++]=[sx[i],sy0,sz[k]];tubeOpts.startingPositions=startingPositions}tubeOpts.colormap=parseColorScale(trace.colorscale),tubeOpts.tubeSize=trace.sizeref,tubeOpts.maxLength=trace.maxdisplayed;var xbnds=toDataCoords(trace._xbnds,"xaxis"),ybnds=toDataCoords(trace._ybnds,"yaxis"),zbnds=toDataCoords(trace._zbnds,"zaxis"),xpads=getBoundPads(meshx),ypads=getBoundPads(meshy),zpads=getBoundPads(meshz),bounds=[[xbnds[0]-xpads[0],ybnds[0]-ypads[0],zbnds[0]-zpads[0]],[xbnds[1]+xpads[1],ybnds[1]+ypads[1],zbnds[1]+zpads[1]]],meshData=tube2mesh(tubeOpts,bounds);meshData.vertexIntensityBounds=[trace.cmin/trace._normMax,trace.cmax/trace._normMax];var lp=trace.lightposition;return meshData.lightPosition=[lp.x,lp.y,lp.z],meshData.ambient=trace.lighting.ambient,meshData.diffuse=trace.lighting.diffuse,meshData.specular=trace.lighting.specular,meshData.roughness=trace.lighting.roughness,meshData.fresnel=trace.lighting.fresnel,meshData.opacity=trace.opacity,trace._pad=meshData.tubeScale*trace.sizeref*2,meshData}proto.handlePick=function(selection){var sceneLayout=this.scene.fullSceneLayout,dataScale=this.scene.dataScale;function fromDataScale(v,axisName){var ax=sceneLayout[axisName],scale=dataScale[axisName2scaleIndex[axisName]];return ax.l2c(v)/scale}if(selection.object===this.mesh){var pos=selection.data.position,uvx=selection.data.velocity;return selection.traceCoordinate=[fromDataScale(pos[0],"xaxis"),fromDataScale(pos[1],"yaxis"),fromDataScale(pos[2],"zaxis"),fromDataScale(uvx[0],"xaxis"),fromDataScale(uvx[1],"yaxis"),fromDataScale(uvx[2],"zaxis"),selection.data.intensity*this.data._normMax,selection.data.divergence],selection.textLabel=this.data.text,!0}},proto.update=function(data){this.data=data;var meshData=convert(this.scene,data);this.mesh.update(meshData)},proto.dispose=function(){this.scene.glplot.remove(this.mesh),this.mesh.dispose()},module.exports=function createStreamtubeTrace(scene,data){var gl=scene.glplot.gl,meshData=convert(scene,data),mesh=createTubeMesh(gl,meshData),streamtube=new Streamtube(scene,data.uid);return streamtube.mesh=mesh,streamtube.data=data,mesh._trace=streamtube,scene.glplot.add(mesh),streamtube}},{"../../lib":693,"../../lib/gl_format_color":689,"../../plots/gl3d/zip3":795,"gl-streamtube3d":299}],1117:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var u=coerce("u"),v=coerce("v"),w=coerce("w"),x=coerce("x"),y=coerce("y"),z=coerce("z");u&&u.length&&v&&v.length&&w&&w.length&&x&&x.length&&y&&y.length&&z&&z.length?(coerce("starts.x"),coerce("starts.y"),coerce("starts.z"),coerce("maxdisplayed"),coerce("sizeref"),coerce("lighting.ambient"),coerce("lighting.diffuse"),coerce("lighting.specular"),coerce("lighting.roughness"),coerce("lighting.fresnel"),coerce("lightposition.x"),coerce("lightposition.y"),coerce("lightposition.z"),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"c"}),coerce("text"),traceOut._length=null):traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"./attributes":1114}],1118:[function(_dereq_,module,exports){"use strict";module.exports={moduleType:"trace",name:"streamtube",basePlotModule:_dereq_("../../plots/gl3d"),categories:["gl3d"],attributes:_dereq_("./attributes"),supplyDefaults:_dereq_("./defaults"),colorbar:{min:"cmin",max:"cmax"},calc:_dereq_("./calc"),plot:_dereq_("./convert"),eventData:function(out,pt){return out.tubex=out.x,out.tubey=out.y,out.tubez=out.z,out.tubeu=pt.traceCoordinate[3],out.tubev=pt.traceCoordinate[4],out.tubew=pt.traceCoordinate[5],out.norm=pt.traceCoordinate[6],out.divergence=pt.traceCoordinate[7],delete out.x,delete out.y,delete out.z,out},meta:{}}},{"../../plots/gl3d":784,"./attributes":1114,"./calc":1115,"./convert":1116,"./defaults":1117}],1119:[function(_dereq_,module,exports){"use strict";var Color=_dereq_("../../components/color"),colorscaleAttrs=_dereq_("../../components/colorscale/attributes"),colorbarAttrs=_dereq_("../../components/colorbar/attributes"),baseAttrs=_dereq_("../../plots/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll;function makeContourAttr(axLetter){return{show:{valType:"boolean",dflt:!1},project:{x:{valType:"boolean",dflt:!1},y:{valType:"boolean",dflt:!1},z:{valType:"boolean",dflt:!1}},color:{valType:"color",dflt:Color.defaultLine},usecolormap:{valType:"boolean",dflt:!1},width:{valType:"number",min:1,max:16,dflt:2},highlight:{valType:"boolean",dflt:!0},highlightcolor:{valType:"color",dflt:Color.defaultLine},highlightwidth:{valType:"number",min:1,max:16,dflt:2}}}var attrs=module.exports=overrideAll(extendFlat({z:{valType:"data_array"},x:{valType:"data_array"},y:{valType:"data_array"},text:{valType:"string",dflt:"",arrayOk:!0},surfacecolor:{valType:"data_array"}},colorscaleAttrs("",{colorAttr:"z or surfacecolor",showScaleDflt:!0,autoColorDflt:!1,editTypeOverride:"calc"}),{colorbar:colorbarAttrs,contours:{x:makeContourAttr(),y:makeContourAttr(),z:makeContourAttr()},hidesurface:{valType:"boolean",dflt:!1},lightposition:{x:{valType:"number",min:-1e5,max:1e5,dflt:10},y:{valType:"number",min:-1e5,max:1e5,dflt:1e4},z:{valType:"number",min:-1e5,max:1e5,dflt:0}},lighting:{ambient:{valType:"number",min:0,max:1,dflt:.8},diffuse:{valType:"number",min:0,max:1,dflt:.8},specular:{valType:"number",min:0,max:2,dflt:.05},roughness:{valType:"number",min:0,max:1,dflt:.5},fresnel:{valType:"number",min:0,max:5,dflt:.2}},opacity:{valType:"number",min:0,max:1,dflt:1},_deprecated:{zauto:extendFlat({},colorscaleAttrs.zauto,{}),zmin:extendFlat({},colorscaleAttrs.zmin,{}),zmax:extendFlat({},colorscaleAttrs.zmax,{})},hoverinfo:extendFlat({},baseAttrs.hoverinfo)}),"calc","nested");attrs.x.editType=attrs.y.editType=attrs.z.editType="calc+clearAxisTypes"},{"../../components/color":567,"../../components/colorbar/attributes":568,"../../components/colorscale/attributes":574,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/attributes":739}],1120:[function(_dereq_,module,exports){"use strict";var colorscaleCalc=_dereq_("../../components/colorscale/calc");module.exports=function calc(gd,trace){trace.surfacecolor?colorscaleCalc(trace,trace.surfacecolor,"","c"):colorscaleCalc(trace,trace.z,"","c")}},{"../../components/colorscale/calc":575}],1121:[function(_dereq_,module,exports){"use strict";var createSurface=_dereq_("gl-surface3d"),ndarray=_dereq_("ndarray"),homography=_dereq_("ndarray-homography"),fill=_dereq_("ndarray-fill"),ops=_dereq_("ndarray-ops"),isArrayOrTypedArray=_dereq_("../../lib").isArrayOrTypedArray,parseColorScale=_dereq_("../../lib/gl_format_color").parseColorScale,str2RgbaArray=_dereq_("../../lib/str2rgbarray"),MIN_RESOLUTION=128;function SurfaceTrace(scene,surface,uid){this.scene=scene,this.uid=uid,this.surface=surface,this.data=null,this.showContour=[!1,!1,!1],this.dataScale=1}var proto=SurfaceTrace.prototype;function padField(field){var shape=field.shape,nshape=[shape[0]+2,shape[1]+2],nfield=ndarray(new Float32Array(nshape[0]*nshape[1]),nshape);return ops.assign(nfield.lo(1,1).hi(shape[0],shape[1]),field),ops.assign(nfield.lo(1).hi(shape[0],1),field.hi(shape[0],1)),ops.assign(nfield.lo(1,nshape[1]-1).hi(shape[0],1),field.lo(0,shape[1]-1).hi(shape[0],1)),ops.assign(nfield.lo(0,1).hi(1,shape[1]),field.hi(1)),ops.assign(nfield.lo(nshape[0]-1,1).hi(1,shape[1]),field.lo(shape[0]-1)),nfield.set(0,0,field.get(0,0)),nfield.set(0,nshape[1]-1,field.get(0,shape[1]-1)),nfield.set(nshape[0]-1,0,field.get(shape[0]-1,0)),nfield.set(nshape[0]-1,nshape[1]-1,field.get(shape[0]-1,shape[1]-1)),nfield}proto.handlePick=function(selection){if(selection.object===this.surface){var selectIndex=selection.index=[Math.min(0|Math.round(selection.data.index[0]/this.dataScale-1),this.data.z[0].length-1),Math.min(0|Math.round(selection.data.index[1]/this.dataScale-1),this.data.z.length-1)],traceCoordinate=[0,0,0];isArrayOrTypedArray(this.data.x)?isArrayOrTypedArray(this.data.x[0])?traceCoordinate[0]=this.data.x[selectIndex[1]][selectIndex[0]]:traceCoordinate[0]=this.data.x[selectIndex[0]]:traceCoordinate[0]=selectIndex[0],isArrayOrTypedArray(this.data.y)?isArrayOrTypedArray(this.data.y[0])?traceCoordinate[1]=this.data.y[selectIndex[1]][selectIndex[0]]:traceCoordinate[1]=this.data.y[selectIndex[1]]:traceCoordinate[1]=selectIndex[1],traceCoordinate[2]=this.data.z[selectIndex[1]][selectIndex[0]],selection.traceCoordinate=traceCoordinate;var sceneLayout=this.scene.fullSceneLayout;selection.dataCoordinate=[sceneLayout.xaxis.d2l(traceCoordinate[0],0,this.data.xcalendar)*this.scene.dataScale[0],sceneLayout.yaxis.d2l(traceCoordinate[1],0,this.data.ycalendar)*this.scene.dataScale[1],sceneLayout.zaxis.d2l(traceCoordinate[2],0,this.data.zcalendar)*this.scene.dataScale[2]];var text=this.data.text;return Array.isArray(text)&&text[selectIndex[1]]&&void 0!==text[selectIndex[1]][selectIndex[0]]?selection.textLabel=text[selectIndex[1]][selectIndex[0]]:selection.textLabel=text||"",selection.data.dataCoordinate=selection.dataCoordinate.slice(),this.surface.highlight(selection.data),this.scene.glplot.spikes.position=selection.dataCoordinate,!0}},proto.setContourLevels=function(){for(var nlevels=[[],[],[]],needsUpdate=!1,i=0;i<3;++i)this.showContour[i]&&(needsUpdate=!0,nlevels[i]=this.scene.contourLevels[i]);needsUpdate&&this.surface.update({levels:nlevels})},proto.update=function(data){var i,scene=this.scene,sceneLayout=scene.fullSceneLayout,surface=this.surface,alpha=data.opacity,colormap=parseColorScale(data.colorscale,alpha),z=data.z,x=data.x,y=data.y,xaxis=sceneLayout.xaxis,yaxis=sceneLayout.yaxis,zaxis=sceneLayout.zaxis,scaleFactor=scene.dataScale,xlen=z[0].length,ylen=data._ylength,coords=[ndarray(new Float32Array(xlen*ylen),[xlen,ylen]),ndarray(new Float32Array(xlen*ylen),[xlen,ylen]),ndarray(new Float32Array(xlen*ylen),[xlen,ylen])],xc=coords[0],yc=coords[1],contourLevels=scene.contourLevels;this.data=data;var xcalendar=data.xcalendar,ycalendar=data.ycalendar,zcalendar=data.zcalendar;fill(coords[2],function(row,col){return zaxis.d2l(z[col][row],0,zcalendar)*scaleFactor[2]}),isArrayOrTypedArray(x)?isArrayOrTypedArray(x[0])?fill(xc,function(row,col){return xaxis.d2l(x[col][row],0,xcalendar)*scaleFactor[0]}):fill(xc,function(row){return xaxis.d2l(x[row],0,xcalendar)*scaleFactor[0]}):fill(xc,function(row){return xaxis.d2l(row,0,xcalendar)*scaleFactor[0]}),isArrayOrTypedArray(x)?isArrayOrTypedArray(y[0])?fill(yc,function(row,col){return yaxis.d2l(y[col][row],0,ycalendar)*scaleFactor[1]}):fill(yc,function(row,col){return yaxis.d2l(y[col],0,ycalendar)*scaleFactor[1]}):fill(yc,function(row,col){return yaxis.d2l(col,0,xcalendar)*scaleFactor[1]});var params={colormap:colormap,levels:[[],[],[]],showContour:[!0,!0,!0],showSurface:!data.hidesurface,contourProject:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1]],contourWidth:[1,1,1],contourColor:[[1,1,1,1],[1,1,1,1],[1,1,1,1]],contourTint:[1,1,1],dynamicColor:[[1,1,1,1],[1,1,1,1],[1,1,1,1]],dynamicWidth:[1,1,1],dynamicTint:[1,1,1],opacity:data.opacity};if(params.intensityBounds=[data.cmin,data.cmax],data.surfacecolor){var intensity=ndarray(new Float32Array(xlen*ylen),[xlen,ylen]);fill(intensity,function(row,col){return data.surfacecolor[col][row]}),coords.push(intensity)}else params.intensityBounds[0]*=scaleFactor[2],params.intensityBounds[1]*=scaleFactor[2];this.dataScale=function refine(coords){var minScale=Math.max(coords[0].shape[0],coords[0].shape[1]);if(minScale<MIN_RESOLUTION){for(var scaleF=MIN_RESOLUTION/minScale,nshape=[0|Math.floor(coords[0].shape[0]*scaleF+1),0|Math.floor(coords[0].shape[1]*scaleF+1)],nsize=nshape[0]*nshape[1],i=0;i<coords.length;++i){var padImg=padField(coords[i]),scaledImg=ndarray(new Float32Array(nsize),nshape);homography(scaledImg,padImg,[scaleF,0,0,0,scaleF,0,0,0,1]),coords[i]=scaledImg}return scaleF}return 1}(coords),data.surfacecolor&&(params.intensity=coords.pop());var highlightEnable=[!0,!0,!0],axis=["x","y","z"];for(i=0;i<3;++i){var contourParams=data.contours[axis[i]];highlightEnable[i]=contourParams.highlight,params.showContour[i]=contourParams.show||contourParams.highlight,params.showContour[i]&&(params.contourProject[i]=[contourParams.project.x,contourParams.project.y,contourParams.project.z],contourParams.show?(this.showContour[i]=!0,params.levels[i]=contourLevels[i],surface.highlightColor[i]=params.contourColor[i]=str2RgbaArray(contourParams.color),contourParams.usecolormap?surface.highlightTint[i]=params.contourTint[i]=0:surface.highlightTint[i]=params.contourTint[i]=1,params.contourWidth[i]=contourParams.width):this.showContour[i]=!1,contourParams.highlight&&(params.dynamicColor[i]=str2RgbaArray(contourParams.highlightcolor),params.dynamicWidth[i]=contourParams.highlightwidth))}(function isColormapCircular(colormap){var first=colormap[0].rgb,last=colormap[colormap.length-1].rgb;return first[0]===last[0]&&first[1]===last[1]&&first[2]===last[2]&&first[3]===last[3]})(colormap)&&(params.vertexColor=!0),params.coords=coords,surface.update(params),surface.visible=data.visible,surface.enableDynamic=highlightEnable,surface.enableHighlight=highlightEnable,surface.snapToData=!0,"lighting"in data&&(surface.ambientLight=data.lighting.ambient,surface.diffuseLight=data.lighting.diffuse,surface.specularLight=data.lighting.specular,surface.roughness=data.lighting.roughness,surface.fresnel=data.lighting.fresnel),"lightposition"in data&&(surface.lightPosition=[data.lightposition.x,data.lightposition.y,data.lightposition.z]),alpha&&alpha<1&&(surface.supportsTransparency=!0)},proto.dispose=function(){this.scene.glplot.remove(this.surface),this.surface.dispose()},module.exports=function createSurfaceTrace(scene,data){var gl=scene.glplot.gl,surface=createSurface({gl:gl}),result=new SurfaceTrace(scene,surface,data.uid);return surface._trace=result,result.update(data),scene.glplot.add(surface),result}},{"../../lib":693,"../../lib/gl_format_color":689,"../../lib/str2rgbarray":717,"gl-surface3d":301,ndarray:430,"ndarray-fill":420,"ndarray-homography":422,"ndarray-ops":424}],1122:[function(_dereq_,module,exports){"use strict";var Registry=_dereq_("../../registry"),Lib=_dereq_("../../lib"),colorscaleDefaults=_dereq_("../../components/colorscale/defaults"),attributes=_dereq_("./attributes");function mapLegacy(traceIn,oldAttr,newAttr){oldAttr in traceIn&&!(newAttr in traceIn)&&(traceIn[newAttr]=traceIn[oldAttr])}module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){var i,j;function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}var z=coerce("z");if(z){var x=coerce("x");coerce("y"),traceOut._xlength=Array.isArray(x)&&Lib.isArrayOrTypedArray(x[0])?z.length:z[0].length,traceOut._ylength=z.length,Registry.getComponentMethod("calendars","handleTraceDefaults")(traceIn,traceOut,["x","y","z"],layout),coerce("text"),["lighting.ambient","lighting.diffuse","lighting.specular","lighting.roughness","lighting.fresnel","lightposition.x","lightposition.y","lightposition.z","hidesurface","opacity"].forEach(function(x){coerce(x)});var surfaceColor=coerce("surfacecolor");coerce("colorscale");var dims=["x","y","z"];for(i=0;i<3;++i){var contourDim="contours."+dims[i],show=coerce(contourDim+".show"),highlight=coerce(contourDim+".highlight");if(show||highlight)for(j=0;j<3;++j)coerce(contourDim+".project."+dims[j]);show&&(coerce(contourDim+".color"),coerce(contourDim+".width"),coerce(contourDim+".usecolormap")),highlight&&(coerce(contourDim+".highlightcolor"),coerce(contourDim+".highlightwidth"))}surfaceColor||(mapLegacy(traceIn,"zmin","cmin"),mapLegacy(traceIn,"zmax","cmax"),mapLegacy(traceIn,"zauto","cauto")),colorscaleDefaults(traceIn,traceOut,layout,coerce,{prefix:"",cLetter:"c"}),traceOut._length=null}else traceOut.visible=!1}},{"../../components/colorscale/defaults":577,"../../lib":693,"../../registry":825,"./attributes":1119}],1123:[function(_dereq_,module,exports){"use strict";var Surface={};Surface.attributes=_dereq_("./attributes"),Surface.supplyDefaults=_dereq_("./defaults"),Surface.colorbar={min:"cmin",max:"cmax"},Surface.calc=_dereq_("./calc"),Surface.plot=_dereq_("./convert"),Surface.moduleType="trace",Surface.name="surface",Surface.basePlotModule=_dereq_("../../plots/gl3d"),Surface.categories=["gl3d","2dMap","noOpacity"],Surface.meta={},module.exports=Surface},{"../../plots/gl3d":784,"./attributes":1119,"./calc":1120,"./convert":1121,"./defaults":1122}],1124:[function(_dereq_,module,exports){"use strict";var annAttrs=_dereq_("../../components/annotations/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat,overrideAll=_dereq_("../../plot_api/edit_types").overrideAll,fontAttrs=_dereq_("../../plots/font_attributes"),domainAttrs=_dereq_("../../plots/domain").attributes;module.exports=overrideAll({domain:domainAttrs({name:"table",trace:!0}),columnwidth:{valType:"number",arrayOk:!0,dflt:null},columnorder:{valType:"data_array"},header:{values:{valType:"data_array",dflt:[]},format:{valType:"data_array",dflt:[]},prefix:{valType:"string",arrayOk:!0,dflt:null},suffix:{valType:"string",arrayOk:!0,dflt:null},height:{valType:"number",dflt:28},align:extendFlat({},annAttrs.align,{arrayOk:!0}),line:{width:{valType:"number",arrayOk:!0,dflt:1},color:{valType:"color",arrayOk:!0,dflt:"grey"}},fill:{color:{valType:"color",arrayOk:!0,dflt:"white"}},font:extendFlat({},fontAttrs({arrayOk:!0}))},cells:{values:{valType:"data_array",dflt:[]},format:{valType:"data_array",dflt:[]},prefix:{valType:"string",arrayOk:!0,dflt:null},suffix:{valType:"string",arrayOk:!0,dflt:null},height:{valType:"number",dflt:20},align:extendFlat({},annAttrs.align,{arrayOk:!0}),line:{width:{valType:"number",arrayOk:!0,dflt:1},color:{valType:"color",arrayOk:!0,dflt:"grey"}},fill:{color:{valType:"color",arrayOk:!0,dflt:"white"}},font:extendFlat({},fontAttrs({arrayOk:!0}))}},"calc","from-root")},{"../../components/annotations/attributes":550,"../../lib/extend":682,"../../plot_api/edit_types":725,"../../plots/domain":767,"../../plots/font_attributes":768}],1125:[function(_dereq_,module,exports){"use strict";var getModuleCalcData=_dereq_("../../plots/get_data").getModuleCalcData,tablePlot=_dereq_("./plot");exports.name="table",exports.plot=function(gd){var calcData=getModuleCalcData(gd.calcdata,"table")[0];calcData.length&&tablePlot(gd,calcData)},exports.clean=function(newFullData,newFullLayout,oldFullData,oldFullLayout){var hadTable=oldFullLayout._has&&oldFullLayout._has("table"),hasTable=newFullLayout._has&&newFullLayout._has("table");hadTable&&!hasTable&&oldFullLayout._paperdiv.selectAll(".table").remove()}},{"../../plots/get_data":778,"./plot":1132}],1126:[function(_dereq_,module,exports){"use strict";var wrap=_dereq_("../../lib/gup").wrap;module.exports=function calc(){return wrap({})}},{"../../lib/gup":690}],1127:[function(_dereq_,module,exports){"use strict";module.exports={cellPad:8,columnExtentOffset:10,columnTitleOffset:28,emptyHeaderHeight:16,latexCheck:/^\$.*\$$/,goldenRatio:1.618,lineBreaker:"<br>",maxDimensionCount:60,overdrag:45,releaseTransitionDuration:120,releaseTransitionEase:"cubic-out",scrollbarCaptureWidth:18,scrollbarHideDelay:1e3,scrollbarHideDuration:1e3,scrollbarOffset:5,scrollbarWidth:8,transitionDuration:100,transitionEase:"cubic-out",uplift:5,wrapSpacer:" ",wrapSplitCharacter:" ",cn:{table:"table",tableControlView:"table-control-view",scrollBackground:"scroll-background",yColumn:"y-column",columnBlock:"column-block",scrollAreaClip:"scroll-area-clip",scrollAreaClipRect:"scroll-area-clip-rect",columnBoundary:"column-boundary",columnBoundaryClippath:"column-boundary-clippath",columnBoundaryRect:"column-boundary-rect",columnCells:"column-cells",columnCell:"column-cell",cellRect:"cell-rect",cellText:"cell-text",cellTextHolder:"cell-text-holder",scrollbarKit:"scrollbar-kit",scrollbar:"scrollbar",scrollbarSlider:"scrollbar-slider",scrollbarGlyph:"scrollbar-glyph",scrollbarCaptureZone:"scrollbar-capture-zone"}}},{}],1128:[function(_dereq_,module,exports){"use strict";var c=_dereq_("./constants"),extendFlat=_dereq_("../../lib/extend").extendFlat,isNumeric=_dereq_("fast-isnumeric");function arrayMax(maybeArray){if(Array.isArray(maybeArray)){for(var max=0,i=0;i<maybeArray.length;i++)max=Math.max(max,arrayMax(maybeArray[i]));return max}return maybeArray}function sum(a,b){return a+b}function squareStringMatrix(matrixIn){var i,matrix=matrixIn.slice(),minLen=1/0,maxLen=0;for(i=0;i<matrix.length;i++)Array.isArray(matrix[i])||(matrix[i]=[matrix[i]]),minLen=Math.min(minLen,matrix[i].length),maxLen=Math.max(maxLen,matrix[i].length);if(minLen!==maxLen)for(i=0;i<matrix.length;i++){var padLen=maxLen-matrix[i].length;padLen&&(matrix[i]=matrix[i].concat(emptyStrings(padLen)))}return matrix}function emptyStrings(len){for(var padArray=new Array(len),j=0;j<len;j++)padArray[j]="";return padArray}function xScale(d){return d.calcdata.columns.reduce(function(prev,next){return next.xIndex<d.xIndex?prev+next.columnWidth:prev},0)}function makeRowBlock(anchorToRowBlock,auxiliary){return Object.keys(anchorToRowBlock).map(function(k){return extendFlat({},anchorToRowBlock[k],{auxiliaryBlocks:auxiliary})})}function makeAnchorToRowBlock(rowHeights,minimumFillHeight){for(var currentRowHeight,anchorToRowBlock={},currentAnchor=0,currentBlockHeight=0,currentBlock={firstRowIndex:null,lastRowIndex:null,rows:[]},currentFirstRowIndex=0,blockCounter=0,i=0;i<rowHeights.length;i++)currentRowHeight=rowHeights[i],currentBlock.rows.push({rowIndex:i,rowHeight:currentRowHeight}),((currentBlockHeight+=currentRowHeight)>=minimumFillHeight||i===rowHeights.length-1)&&(anchorToRowBlock[currentAnchor]=currentBlock,currentBlock.key=blockCounter++,currentBlock.firstRowIndex=currentFirstRowIndex,currentBlock.lastRowIndex=i,currentBlock={firstRowIndex:null,lastRowIndex:null,rows:[]},currentAnchor+=currentBlockHeight,currentFirstRowIndex=i+1,currentBlockHeight=0);return anchorToRowBlock}module.exports=function calc(gd,trace){var cellsValues=squareStringMatrix(trace.cells.values),slicer=function(a){return a.slice(trace.header.values.length,a.length)},headerValuesIn=squareStringMatrix(trace.header.values);headerValuesIn.length&&!headerValuesIn[0].length&&(headerValuesIn[0]=[""],headerValuesIn=squareStringMatrix(headerValuesIn));var headerValues=headerValuesIn.concat(slicer(cellsValues).map(function(){return emptyStrings((headerValuesIn[0]||[""]).length)})),domain=trace.domain,groupWidth=Math.floor(gd._fullLayout._size.w*(domain.x[1]-domain.x[0])),groupHeight=Math.floor(gd._fullLayout._size.h*(domain.y[1]-domain.y[0])),headerRowHeights=trace.header.values.length?headerValues[0].map(function(){return trace.header.height}):[c.emptyHeaderHeight],rowHeights=cellsValues.length?cellsValues[0].map(function(){return trace.cells.height}):[],headerHeight=headerRowHeights.reduce(sum,0),anchorToRowBlock=makeAnchorToRowBlock(rowHeights,groupHeight-headerHeight+c.uplift),headerRowBlocks=makeRowBlock(makeAnchorToRowBlock(headerRowHeights,headerHeight),[]),rowBlocks=makeRowBlock(anchorToRowBlock,headerRowBlocks),uniqueKeys={},columnOrder=trace._fullInput.columnorder.concat(slicer(cellsValues.map(function(d,i){return i}))),columnWidths=headerValues.map(function(d,i){var value=Array.isArray(trace.columnwidth)?trace.columnwidth[Math.min(i,trace.columnwidth.length-1)]:trace.columnwidth;return isNumeric(value)?Number(value):1}),totalColumnWidths=columnWidths.reduce(sum,0);columnWidths=columnWidths.map(function(d){return d/totalColumnWidths*groupWidth});var maxLineWidth=Math.max(arrayMax(trace.header.line.width),arrayMax(trace.cells.line.width)),calcdata={key:trace.index,translateX:domain.x[0]*gd._fullLayout._size.w,translateY:gd._fullLayout._size.h*(1-domain.y[1]),size:gd._fullLayout._size,width:groupWidth,maxLineWidth:maxLineWidth,height:groupHeight,columnOrder:columnOrder,groupHeight:groupHeight,rowBlocks:rowBlocks,headerRowBlocks:headerRowBlocks,scrollY:0,cells:extendFlat({},trace.cells,{values:cellsValues}),headerCells:extendFlat({},trace.header,{values:headerValues}),gdColumns:headerValues.map(function(d){return d[0]}),gdColumnsOriginalOrder:headerValues.map(function(d){return d[0]}),prevPages:[0,0],scrollbarState:{scrollbarScrollInProgress:!1},columns:headerValues.map(function(label,i){var foundKey=uniqueKeys[label];return uniqueKeys[label]=(foundKey||0)+1,{key:label+"__"+uniqueKeys[label],label:label,specIndex:i,xIndex:columnOrder[i],xScale:xScale,x:void 0,calcdata:void 0,columnWidth:columnWidths[i]}})};return calcdata.columns.forEach(function(col){col.calcdata=calcdata,col.x=xScale(col)}),calcdata}},{"../../lib/extend":682,"./constants":1127,"fast-isnumeric":213}],1129:[function(_dereq_,module,exports){"use strict";var extendFlat=_dereq_("../../lib/extend").extendFlat;exports.splitToPanels=function(d){var prevPages=[0,0],headerPanel=extendFlat({},d,{key:"header",type:"header",page:0,prevPages:prevPages,currentRepaint:[null,null],dragHandle:!0,values:d.calcdata.headerCells.values[d.specIndex],rowBlocks:d.calcdata.headerRowBlocks,calcdata:extendFlat({},d.calcdata,{cells:d.calcdata.headerCells})});return[extendFlat({},d,{key:"cells1",type:"cells",page:0,prevPages:prevPages,currentRepaint:[null,null],dragHandle:!1,values:d.calcdata.cells.values[d.specIndex],rowBlocks:d.calcdata.rowBlocks}),extendFlat({},d,{key:"cells2",type:"cells",page:1,prevPages:prevPages,currentRepaint:[null,null],dragHandle:!1,values:d.calcdata.cells.values[d.specIndex],rowBlocks:d.calcdata.rowBlocks}),headerPanel]},exports.splitToCells=function(d){var fromTo=function rowFromTo(d){var rowBlock=d.rowBlocks[d.page],rowFrom=rowBlock?rowBlock.rows[0].rowIndex:0,rowTo=rowBlock?rowFrom+rowBlock.rows.length:0;return[rowFrom,rowTo]}(d);return(d.values||[]).slice(fromTo[0],fromTo[1]).map(function(v,i){return{keyWithinBlock:i+("string"==typeof v&&v.match(/[<$&> ]/)?"_keybuster_"+Math.random():""),key:fromTo[0]+i,column:d,calcdata:d.calcdata,page:d.page,rowBlocks:d.rowBlocks,value:v}})}},{"../../lib/extend":682}],1130:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),attributes=_dereq_("./attributes"),handleDomainDefaults=_dereq_("../../plots/domain").defaults;module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}handleDomainDefaults(traceOut,layout,coerce),coerce("columnwidth"),coerce("header.values"),coerce("header.format"),coerce("header.align"),coerce("header.prefix"),coerce("header.suffix"),coerce("header.height"),coerce("header.line.width"),coerce("header.line.color"),coerce("header.fill.color"),Lib.coerceFont(coerce,"header.font",Lib.extendFlat({},layout.font)),function defaultColumnOrder(traceOut,coerce){for(var specifiedColumnOrder=traceOut.columnorder||[],commonLength=traceOut.header.values.length,truncated=specifiedColumnOrder.slice(0,commonLength),sorted=truncated.slice().sort(function(a,b){return a-b}),oneStepped=truncated.map(function(d){return sorted.indexOf(d)}),i=oneStepped.length;i<commonLength;i++)oneStepped.push(i);coerce("columnorder",oneStepped)}(traceOut,coerce),coerce("cells.values"),coerce("cells.format"),coerce("cells.align"),coerce("cells.prefix"),coerce("cells.suffix"),coerce("cells.height"),coerce("cells.line.width"),coerce("cells.line.color"),coerce("cells.fill.color"),Lib.coerceFont(coerce,"cells.font",Lib.extendFlat({},layout.font)),traceOut._length=null}},{"../../lib":693,"../../plots/domain":767,"./attributes":1124}],1131:[function(_dereq_,module,exports){"use strict";var Table={};Table.attributes=_dereq_("./attributes"),Table.supplyDefaults=_dereq_("./defaults"),Table.calc=_dereq_("./calc"),Table.plot=_dereq_("./plot"),Table.moduleType="trace",Table.name="table",Table.basePlotModule=_dereq_("./base_plot"),Table.categories=["noOpacity"],Table.meta={},module.exports=Table},{"./attributes":1124,"./base_plot":1125,"./calc":1126,"./defaults":1130,"./plot":1132}],1132:[function(_dereq_,module,exports){"use strict";var c=_dereq_("./constants"),d3=_dereq_("d3"),gup=_dereq_("../../lib/gup"),Drawing=_dereq_("../../components/drawing"),svgUtil=_dereq_("../../lib/svg_text_utils"),raiseToTop=_dereq_("../../lib").raiseToTop,cancelEeaseColumn=_dereq_("../../lib").cancelTransition,prepareData=_dereq_("./data_preparation_helper"),splitData=_dereq_("./data_split_helpers"),Color=_dereq_("../../components/color");function roundHalfWidth(d){return Math.ceil(d.calcdata.maxLineWidth/2)}function scrollAreaBottomClipKey(gd,d){return"clip"+gd._fullLayout._uid+"_scrollAreaBottomClip_"+d.key}function columnBoundaryClipKey(gd,d){return"clip"+gd._fullLayout._uid+"_columnBoundaryClippath_"+d.calcdata.key+"_"+d.specIndex}function flatData(selection){return[].concat.apply([],selection.map(function(g){return g})).map(function(g){return g.__data__})}function renderScrollbarKit(tableControlView,gd,bypassVisibleBar){var scrollbarKit=tableControlView.selectAll("."+c.cn.scrollbarKit).data(gup.repeat,gup.keyFun);scrollbarKit.enter().append("g").classed(c.cn.scrollbarKit,!0).style("shape-rendering","geometricPrecision"),scrollbarKit.each(function(d){var s=d.scrollbarState;s.totalHeight=function calcTotalHeight(d){var blocks=d.rowBlocks;return firstRowAnchor(blocks,blocks.length-1)+(blocks.length?rowsHeight(blocks[blocks.length-1],1/0):1)}(d),s.scrollableAreaHeight=d.groupHeight-headerHeight(d),s.currentlyVisibleHeight=Math.min(s.totalHeight,s.scrollableAreaHeight),s.ratio=s.currentlyVisibleHeight/s.totalHeight,s.barLength=Math.max(s.ratio*s.currentlyVisibleHeight,c.goldenRatio*c.scrollbarWidth),s.barWiggleRoom=s.currentlyVisibleHeight-s.barLength,s.wiggleRoom=Math.max(0,s.totalHeight-s.scrollableAreaHeight),s.topY=0===s.barWiggleRoom?0:d.scrollY/s.wiggleRoom*s.barWiggleRoom,s.bottomY=s.topY+s.barLength,s.dragMultiplier=s.wiggleRoom/s.barWiggleRoom}).attr("transform",function(d){return"translate("+(d.width+c.scrollbarWidth/2+c.scrollbarOffset)+" "+headerHeight(d)+")"});var scrollbar=scrollbarKit.selectAll("."+c.cn.scrollbar).data(gup.repeat,gup.keyFun);scrollbar.enter().append("g").classed(c.cn.scrollbar,!0);var scrollbarSlider=scrollbar.selectAll("."+c.cn.scrollbarSlider).data(gup.repeat,gup.keyFun);scrollbarSlider.enter().append("g").classed(c.cn.scrollbarSlider,!0),scrollbarSlider.attr("transform",function(d){return"translate(0 "+(d.scrollbarState.topY||0)+")"});var scrollbarGlyph=scrollbarSlider.selectAll("."+c.cn.scrollbarGlyph).data(gup.repeat,gup.keyFun);scrollbarGlyph.enter().append("line").classed(c.cn.scrollbarGlyph,!0).attr("stroke","black").attr("stroke-width",c.scrollbarWidth).attr("stroke-linecap","round").attr("y1",c.scrollbarWidth/2),scrollbarGlyph.attr("y2",function(d){return d.scrollbarState.barLength-c.scrollbarWidth/2}).attr("stroke-opacity",function(d){return d.columnDragInProgress||!d.scrollbarState.barWiggleRoom||bypassVisibleBar?0:.4}),scrollbarGlyph.transition().delay(0).duration(0),scrollbarGlyph.transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration).attr("stroke-opacity",0);var scrollbarCaptureZone=scrollbar.selectAll("."+c.cn.scrollbarCaptureZone).data(gup.repeat,gup.keyFun);scrollbarCaptureZone.enter().append("line").classed(c.cn.scrollbarCaptureZone,!0).attr("stroke","white").attr("stroke-opacity",.01).attr("stroke-width",c.scrollbarCaptureWidth).attr("stroke-linecap","butt").attr("y1",0).on("mousedown",function(d){var y=d3.event.y,bbox=this.getBoundingClientRect(),s=d.scrollbarState,pixelVal=y-bbox.top,inverseScale=d3.scale.linear().domain([0,s.scrollableAreaHeight]).range([0,s.totalHeight]).clamp(!0);s.topY<=pixelVal&&pixelVal<=s.bottomY||makeDragRow(gd,tableControlView,null,inverseScale(pixelVal-s.barLength/2))(d)}).call(d3.behavior.drag().origin(function(d){return d3.event.stopPropagation(),d.scrollbarState.scrollbarScrollInProgress=!0,d}).on("drag",makeDragRow(gd,tableControlView)).on("dragend",function(){})),scrollbarCaptureZone.attr("y2",function(d){return d.scrollbarState.scrollableAreaHeight})}function renderColumnCellTree(gd,tableControlView,columnBlock,allColumnBlock){var columnCell=function renderColumnCell(columnCells){var columnCell=columnCells.selectAll("."+c.cn.columnCell).data(splitData.splitToCells,function(d){return d.keyWithinBlock});return columnCell.enter().append("g").classed(c.cn.columnCell,!0),columnCell.exit().remove(),columnCell}(function renderColumnCells(columnBlock){var columnCells=columnBlock.selectAll("."+c.cn.columnCells).data(gup.repeat,gup.keyFun);return columnCells.enter().append("g").classed(c.cn.columnCells,!0),columnCells.exit().remove(),columnCells}(columnBlock));!function supplyStylingValues(columnCell){columnCell.each(function(d,i){var spec=d.calcdata.cells.font,col=d.column.specIndex,font={size:gridPick(spec.size,col,i),color:gridPick(spec.color,col,i),family:gridPick(spec.family,col,i)};d.rowNumber=d.key,d.align=gridPick(d.calcdata.cells.align,col,i),d.cellBorderWidth=gridPick(d.calcdata.cells.line.width,col,i),d.font=font})}(columnCell),function sizeAndStyleRect(cellRect){cellRect.attr("width",function(d){return d.column.columnWidth}).attr("stroke-width",function(d){return d.cellBorderWidth}).each(function(d){var atomicSelection=d3.select(this);Color.stroke(atomicSelection,gridPick(d.calcdata.cells.line.color,d.column.specIndex,d.rowNumber)),Color.fill(atomicSelection,gridPick(d.calcdata.cells.fill.color,d.column.specIndex,d.rowNumber))})}(function renderCellRect(columnCell){var cellRect=columnCell.selectAll("."+c.cn.cellRect).data(gup.repeat,function(d){return d.keyWithinBlock});return cellRect.enter().append("rect").classed(c.cn.cellRect,!0),cellRect}(columnCell));var cellText=function renderCellText(cellTextHolder){var cellText=cellTextHolder.selectAll("."+c.cn.cellText).data(gup.repeat,function(d){return d.keyWithinBlock});return cellText.enter().append("text").classed(c.cn.cellText,!0).style("cursor",function(){return"auto"}).on("mousedown",function(){d3.event.stopPropagation()}),cellText}(function renderCellTextHolder(columnCell){var cellTextHolder=columnCell.selectAll("."+c.cn.cellTextHolder).data(gup.repeat,function(d){return d.keyWithinBlock});return cellTextHolder.enter().append("g").classed(c.cn.cellTextHolder,!0).style("shape-rendering","geometricPrecision"),cellTextHolder}(columnCell));!function setFont(cellText){cellText.each(function(d){Drawing.font(d3.select(this),d.font)})}(cellText),populateCellText(cellText,tableControlView,allColumnBlock,gd),setCellHeightAndPositionY(columnCell)}function populateCellText(cellText,tableControlView,allColumnBlock,gd){cellText.text(function(d){var col=d.column.specIndex,row=d.rowNumber,userSuppliedContent=d.value,stringSupplied="string"==typeof userSuppliedContent,hasBreaks=stringSupplied&&userSuppliedContent.match(/<br>/i),userBrokenText=!stringSupplied||hasBreaks;d.mayHaveMarkup=stringSupplied&&userSuppliedContent.match(/[<&>]/);var latex=function isLatex(content){return"string"==typeof content&&content.match(c.latexCheck)}(userSuppliedContent);d.latex=latex;var hasWrapSplitCharacter,textToRender,prefix=latex?"":gridPick(d.calcdata.cells.prefix,col,row)||"",suffix=latex?"":gridPick(d.calcdata.cells.suffix,col,row)||"",format=latex?null:gridPick(d.calcdata.cells.format,col,row)||null,prefixSuffixedText=prefix+(format?d3.format(format)(d.value):d.value)+suffix;if(d.wrappingNeeded=!d.wrapped&&!userBrokenText&&!latex&&(hasWrapSplitCharacter=hasWrapCharacter(prefixSuffixedText)),d.cellHeightMayIncrease=hasBreaks||latex||d.mayHaveMarkup||(void 0===hasWrapSplitCharacter?hasWrapCharacter(prefixSuffixedText):hasWrapSplitCharacter),d.needsConvertToTspans=d.mayHaveMarkup||d.wrappingNeeded||d.latex,d.wrappingNeeded){var fragments=(" "===c.wrapSplitCharacter?prefixSuffixedText.replace(/<a href=/gi,"<a_href="):prefixSuffixedText).split(c.wrapSplitCharacter),hrefRestoredFragments=" "===c.wrapSplitCharacter?fragments.map(function(frag){return frag.replace(/<a_href=/gi,"<a href=")}):fragments;d.fragments=hrefRestoredFragments.map(function(f){return{text:f,width:null}}),d.fragments.push({fragment:c.wrapSpacer,width:null}),textToRender=hrefRestoredFragments.join(c.lineBreaker)+c.lineBreaker+c.wrapSpacer}else delete d.fragments,textToRender=prefixSuffixedText;return textToRender}).attr("dy",function(d){return d.needsConvertToTspans?0:"0.75em"}).each(function(d){var selection=d3.select(this),renderCallback=d.wrappingNeeded?wrapTextMaker:updateYPositionMaker;d.needsConvertToTspans?svgUtil.convertToTspans(selection,gd,renderCallback(allColumnBlock,this,tableControlView,gd,d)):d3.select(this.parentNode).attr("transform",function(d){return"translate("+xPosition(d)+" "+c.cellPad+")"}).attr("text-anchor",function(d){return{left:"start",center:"middle",right:"end"}[d.align]})})}function hasWrapCharacter(text){return-1!==text.indexOf(c.wrapSplitCharacter)}function gridPick(spec,col,row){if(Array.isArray(spec)){var column=spec[Math.min(col,spec.length-1)];return Array.isArray(column)?column[Math.min(row,column.length-1)]:column}return spec}function easeColumn(selection,d,y){selection.transition().ease(c.releaseTransitionEase).duration(c.releaseTransitionDuration).attr("transform","translate("+d.x+" "+y+")")}function cellsBlock(d){return"cells"===d.type}function headerBlock(d){return"header"===d.type}function headerHeight(d){return(d.rowBlocks.length?d.rowBlocks[0].auxiliaryBlocks:[]).reduce(function(p,n){return p+rowsHeight(n,1/0)},0)}function updateBlockYPosition(gd,cellsColumnBlock,tableControlView){var d=flatData(cellsColumnBlock)[0];if(void 0!==d){var blocks=d.rowBlocks,calcdata=d.calcdata,bottom=firstRowAnchor(blocks,blocks.length),scrollHeight=d.calcdata.groupHeight-headerHeight(d),scrollY=calcdata.scrollY=Math.max(0,Math.min(bottom-scrollHeight,calcdata.scrollY)),pages=function findPagesAndCacheHeights(blocks,scrollY,scrollHeight){for(var pages=[],pTop=0,blockIndex=0;blockIndex<blocks.length;blockIndex++){for(var block=blocks[blockIndex],blockRows=block.rows,rowsHeight=0,i=0;i<blockRows.length;i++)rowsHeight+=blockRows[i].rowHeight;block.allRowsHeight=rowsHeight,scrollY<pTop+rowsHeight&&scrollY+scrollHeight>pTop&&pages.push(blockIndex),pTop+=rowsHeight}return pages}(blocks,scrollY,scrollHeight);1===pages.length&&(pages[0]===blocks.length-1?pages.unshift(pages[0]-1):pages.push(pages[0]+1)),pages[0]%2&&pages.reverse(),cellsColumnBlock.each(function(d,i){d.page=pages[i],d.scrollY=scrollY}),cellsColumnBlock.attr("transform",function(d){return"translate(0 "+(firstRowAnchor(d.rowBlocks,d.page)-d.scrollY)+")"}),gd&&(conditionalPanelRerender(gd,tableControlView,cellsColumnBlock,pages,d.prevPages,d,0),conditionalPanelRerender(gd,tableControlView,cellsColumnBlock,pages,d.prevPages,d,1),renderScrollbarKit(tableControlView,gd))}}function makeDragRow(gd,allTableControlView,optionalMultiplier,optionalPosition){return function dragRow(eventD){var d=eventD.calcdata?eventD.calcdata:eventD,tableControlView=allTableControlView.filter(function(dd){return d.key===dd.key}),multiplier=optionalMultiplier||d.scrollbarState.dragMultiplier;d.scrollY=void 0===optionalPosition?d.scrollY+multiplier*d3.event.dy:optionalPosition;var cellsColumnBlock=tableControlView.selectAll("."+c.cn.yColumn).selectAll("."+c.cn.columnBlock).filter(cellsBlock);updateBlockYPosition(gd,cellsColumnBlock,tableControlView)}}function conditionalPanelRerender(gd,tableControlView,cellsColumnBlock,pages,prevPages,d,revolverIndex){pages[revolverIndex]!==prevPages[revolverIndex]&&(clearTimeout(d.currentRepaint[revolverIndex]),d.currentRepaint[revolverIndex]=setTimeout(function(){var toRerender=cellsColumnBlock.filter(function(d,i){return i===revolverIndex&&pages[i]!==prevPages[i]});renderColumnCellTree(gd,tableControlView,toRerender,cellsColumnBlock),prevPages[revolverIndex]=pages[revolverIndex]}))}function wrapTextMaker(columnBlock,element,tableControlView){return function wrapText(){var cellTextHolder=d3.select(element.parentNode);cellTextHolder.each(function(d){var fragments=d.fragments;cellTextHolder.selectAll("tspan.line").each(function(dd,i){fragments[i].width=this.getComputedTextLength()});var currentAddition,currentAdditionLength,separatorLength=fragments[fragments.length-1].width,rest=fragments.slice(0,-1),currentRow=[],currentRowLength=0,rowLengthLimit=d.column.columnWidth-2*c.cellPad;for(d.value="";rest.length;)currentRowLength+(currentAdditionLength=(currentAddition=rest.shift()).width+separatorLength)>rowLengthLimit&&(d.value+=currentRow.join(c.wrapSpacer)+c.lineBreaker,currentRow=[],currentRowLength=0),currentRow.push(currentAddition.text),currentRowLength+=currentAdditionLength;currentRowLength&&(d.value+=currentRow.join(c.wrapSpacer)),d.wrapped=!0}),cellTextHolder.selectAll("tspan.line").remove(),populateCellText(cellTextHolder.select("."+c.cn.cellText),tableControlView,columnBlock),d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY)}}function updateYPositionMaker(columnBlock,element,tableControlView,gd,d){return function updateYPosition(){if(!d.settledY){var cellTextHolder=d3.select(element.parentNode),l=getBlock(d),rowIndex=d.key-l.firstRowIndex,declaredRowHeight=l.rows[rowIndex].rowHeight,requiredHeight=d.cellHeightMayIncrease?element.parentNode.getBoundingClientRect().height+2*c.cellPad:declaredRowHeight,finalHeight=Math.max(requiredHeight,declaredRowHeight);finalHeight-l.rows[rowIndex].rowHeight&&(l.rows[rowIndex].rowHeight=finalHeight,columnBlock.selectAll("."+c.cn.columnCell).call(setCellHeightAndPositionY),updateBlockYPosition(null,columnBlock.filter(cellsBlock),0),renderScrollbarKit(tableControlView,gd,!0)),cellTextHolder.attr("transform",function(){var box=this.parentNode.getBoundingClientRect(),rectBox=d3.select(this.parentNode).select("."+c.cn.cellRect).node().getBoundingClientRect(),currentTransform=this.transform.baseVal.consolidate(),yPosition=rectBox.top-box.top+(currentTransform?currentTransform.matrix.f:c.cellPad);return"translate("+xPosition(d,d3.select(this.parentNode).select("."+c.cn.cellTextHolder).node().getBoundingClientRect().width)+" "+yPosition+")"}),d.settledY=!0}}}function xPosition(d,optionalWidth){switch(d.align){case"left":return c.cellPad;case"right":return d.column.columnWidth-(optionalWidth||0)-c.cellPad;case"center":return(d.column.columnWidth-(optionalWidth||0))/2;default:return c.cellPad}}function setCellHeightAndPositionY(columnCell){columnCell.attr("transform",function(d){var headerHeight=d.rowBlocks[0].auxiliaryBlocks.reduce(function(p,n){return p+rowsHeight(n,1/0)},0);return"translate(0 "+(rowsHeight(getBlock(d),d.key)+headerHeight)+")"}).selectAll("."+c.cn.cellRect).attr("height",function(d){return function getRow(l,i){return l.rows[i-l.firstRowIndex]}(getBlock(d),d.key).rowHeight})}function firstRowAnchor(blocks,page){for(var total=0,i=page-1;i>=0;i--)total+=allRowsHeight(blocks[i]);return total}function rowsHeight(rowBlock,key){for(var total=0,i=0;i<rowBlock.rows.length&&rowBlock.rows[i].rowIndex<key;i++)total+=rowBlock.rows[i].rowHeight;return total}function allRowsHeight(rowBlock){var cached=rowBlock.allRowsHeight;if(void 0!==cached)return cached;for(var total=0,i=0;i<rowBlock.rows.length;i++)total+=rowBlock.rows[i].rowHeight;return rowBlock.allRowsHeight=total,total}function getBlock(d){return d.rowBlocks[d.page]}module.exports=function plot(gd,wrappedTraceHolders){var table=gd._fullLayout._paper.selectAll("."+c.cn.table).data(wrappedTraceHolders.map(function(wrappedTraceHolder){var trace=gup.unwrap(wrappedTraceHolder).trace;return prepareData(gd,trace)}),gup.keyFun);table.exit().remove(),table.enter().append("g").classed(c.cn.table,!0).attr("overflow","visible").style("box-sizing","content-box").style("position","absolute").style("left",0).style("overflow","visible").style("shape-rendering","crispEdges").style("pointer-events","all"),table.attr("width",function(d){return d.width+d.size.l+d.size.r}).attr("height",function(d){return d.height+d.size.t+d.size.b}).attr("transform",function(d){return"translate("+d.translateX+","+d.translateY+")"});var tableControlView=table.selectAll("."+c.cn.tableControlView).data(gup.repeat,gup.keyFun);tableControlView.enter().append("g").classed(c.cn.tableControlView,!0).style("box-sizing","content-box").on("mousemove",function(d){tableControlView.filter(function(dd){return d===dd}).call(renderScrollbarKit,gd)}).on("mousewheel",function(d){d.scrollbarState.wheeling||(d.scrollbarState.wheeling=!0,d3.event.stopPropagation(),d3.event.preventDefault(),makeDragRow(gd,tableControlView,null,d.scrollY+d3.event.deltaY)(d),d.scrollbarState.wheeling=!1)}).call(renderScrollbarKit,gd,!0),tableControlView.attr("transform",function(d){return"translate("+d.size.l+" "+d.size.t+")"});var scrollBackground=tableControlView.selectAll("."+c.cn.scrollBackground).data(gup.repeat,gup.keyFun);scrollBackground.enter().append("rect").classed(c.cn.scrollBackground,!0).attr("fill","none"),scrollBackground.attr("width",function(d){return d.width}).attr("height",function(d){return d.height}),tableControlView.each(function(d){Drawing.setClipUrl(d3.select(this),scrollAreaBottomClipKey(gd,d))});var yColumn=tableControlView.selectAll("."+c.cn.yColumn).data(function(vm){return vm.columns},gup.keyFun);yColumn.enter().append("g").classed(c.cn.yColumn,!0),yColumn.exit().remove(),yColumn.attr("transform",function(d){return"translate("+d.x+" 0)"}).call(d3.behavior.drag().origin(function(d){return easeColumn(d3.select(this),d,-c.uplift),raiseToTop(this),d.calcdata.columnDragInProgress=!0,renderScrollbarKit(tableControlView.filter(function(dd){return d.calcdata.key===dd.key}),gd),d}).on("drag",function(d){var movedColumn=d3.select(this),getter=function(dd){return(d===dd?d3.event.x:dd.x)+dd.columnWidth/2};d.x=Math.max(-c.overdrag,Math.min(d.calcdata.width+c.overdrag-d.columnWidth,d3.event.x)),flatData(yColumn).filter(function(dd){return dd.calcdata.key===d.calcdata.key}).sort(function(a,b){return getter(a)-getter(b)}).forEach(function(dd,i){dd.xIndex=i,dd.x=d===dd?dd.x:dd.xScale(dd)}),yColumn.filter(function(dd){return d!==dd}).transition().ease(c.transitionEase).duration(c.transitionDuration).attr("transform",function(d){return"translate("+d.x+" 0)"}),movedColumn.call(cancelEeaseColumn).attr("transform","translate("+d.x+" -"+c.uplift+" )")}).on("dragend",function(d){var movedColumn=d3.select(this),p=d.calcdata;d.x=d.xScale(d),d.calcdata.columnDragInProgress=!1,easeColumn(movedColumn,d,0),function columnMoved(gd,calcdata,indices){var o=calcdata.gdColumnsOriginalOrder;calcdata.gdColumns.sort(function(a,b){return indices[o.indexOf(a)]-indices[o.indexOf(b)]}),calcdata.columnorder=indices,gd.emit("plotly_restyle")}(gd,p,p.columns.map(function(dd){return dd.xIndex}))})),yColumn.each(function(d){Drawing.setClipUrl(d3.select(this),columnBoundaryClipKey(gd,d))});var columnBlock=yColumn.selectAll("."+c.cn.columnBlock).data(splitData.splitToPanels,gup.keyFun);columnBlock.enter().append("g").classed(c.cn.columnBlock,!0).attr("id",function(d){return d.key}),columnBlock.style("cursor",function(d){return d.dragHandle?"ew-resize":d.calcdata.scrollbarState.barWiggleRoom?"ns-resize":"default"});var headerColumnBlock=columnBlock.filter(headerBlock),cellsColumnBlock=columnBlock.filter(cellsBlock);cellsColumnBlock.call(d3.behavior.drag().origin(function(d){return d3.event.stopPropagation(),d}).on("drag",makeDragRow(gd,tableControlView,-1)).on("dragend",function(){})),renderColumnCellTree(gd,tableControlView,headerColumnBlock,columnBlock),renderColumnCellTree(gd,tableControlView,cellsColumnBlock,columnBlock);var scrollAreaClip=tableControlView.selectAll("."+c.cn.scrollAreaClip).data(gup.repeat,gup.keyFun);scrollAreaClip.enter().append("clipPath").classed(c.cn.scrollAreaClip,!0).attr("id",function(d){return scrollAreaBottomClipKey(gd,d)});var scrollAreaClipRect=scrollAreaClip.selectAll("."+c.cn.scrollAreaClipRect).data(gup.repeat,gup.keyFun);scrollAreaClipRect.enter().append("rect").classed(c.cn.scrollAreaClipRect,!0).attr("x",-c.overdrag).attr("y",-c.uplift).attr("fill","none"),scrollAreaClipRect.attr("width",function(d){return d.width+2*c.overdrag}).attr("height",function(d){return d.height+c.uplift}),yColumn.selectAll("."+c.cn.columnBoundary).data(gup.repeat,gup.keyFun).enter().append("g").classed(c.cn.columnBoundary,!0);var columnBoundaryClippath=yColumn.selectAll("."+c.cn.columnBoundaryClippath).data(gup.repeat,gup.keyFun);columnBoundaryClippath.enter().append("clipPath").classed(c.cn.columnBoundaryClippath,!0),columnBoundaryClippath.attr("id",function(d){return columnBoundaryClipKey(gd,d)});var columnBoundaryRect=columnBoundaryClippath.selectAll("."+c.cn.columnBoundaryRect).data(gup.repeat,gup.keyFun);columnBoundaryRect.enter().append("rect").classed(c.cn.columnBoundaryRect,!0).attr("fill","none"),columnBoundaryRect.attr("width",function(d){return d.columnWidth+2*roundHalfWidth(d)}).attr("height",function(d){return d.calcdata.height+2*roundHalfWidth(d)+c.uplift}).attr("x",function(d){return-roundHalfWidth(d)}).attr("y",function(d){return-roundHalfWidth(d)}),updateBlockYPosition(null,cellsColumnBlock,tableControlView)}},{"../../components/color":567,"../../components/drawing":592,"../../lib":693,"../../lib/gup":690,"../../lib/svg_text_utils":718,"./constants":1127,"./data_preparation_helper":1128,"./data_split_helpers":1129,d3:147}],1133:[function(_dereq_,module,exports){"use strict";var boxAttrs=_dereq_("../box/attributes"),extendFlat=_dereq_("../../lib/extend").extendFlat;module.exports={y:boxAttrs.y,x:boxAttrs.x,x0:boxAttrs.x0,y0:boxAttrs.y0,name:boxAttrs.name,orientation:extendFlat({},boxAttrs.orientation,{}),bandwidth:{valType:"number",min:0,editType:"calc"},scalegroup:{valType:"string",dflt:"",editType:"calc"},scalemode:{valType:"enumerated",values:["width","count"],dflt:"width",editType:"calc"},spanmode:{valType:"enumerated",values:["soft","hard","manual"],dflt:"soft",editType:"calc"},span:{valType:"info_array",items:[{valType:"any",editType:"calc"},{valType:"any",editType:"calc"}],editType:"calc"},line:{color:{valType:"color",editType:"style"},width:{valType:"number",min:0,dflt:2,editType:"style"},editType:"plot"},fillcolor:boxAttrs.fillcolor,points:extendFlat({},boxAttrs.boxpoints,{}),jitter:extendFlat({},boxAttrs.jitter,{}),pointpos:extendFlat({},boxAttrs.pointpos,{}),marker:boxAttrs.marker,text:boxAttrs.text,box:{visible:{valType:"boolean",dflt:!1,editType:"plot"},width:{valType:"number",min:0,max:1,dflt:.25,editType:"plot"},fillcolor:{valType:"color",editType:"style"},line:{color:{valType:"color",editType:"style"},width:{valType:"number",min:0,editType:"style"},editType:"style"},editType:"plot"},meanline:{visible:{valType:"boolean",dflt:!1,editType:"plot"},color:{valType:"color",editType:"style"},width:{valType:"number",min:0,editType:"style"},editType:"plot"},side:{valType:"enumerated",values:["both","positive","negative"],dflt:"both",editType:"plot"},selected:boxAttrs.selected,unselected:boxAttrs.unselected,hoveron:{valType:"flaglist",flags:["violins","points","kde"],dflt:"violins+points+kde",extras:["all"],editType:"style"}}},{"../../lib/extend":682,"../box/attributes":856}],1134:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),boxCalc=_dereq_("../box/calc"),helpers=_dereq_("./helpers"),BADNUM=_dereq_("../../constants/numerical").BADNUM;function calcBandwidth(trace,cdi,vals){var span=cdi.max-cdi.min;if(!span)return 1;if(trace.bandwidth)return Math.max(trace.bandwidth,span/1e4);var len=vals.length,ssd=Lib.stdev(vals,len-1,cdi.mean);return Math.max(function silvermanRule(len,ssd,iqr){return 1.059*Math.min(ssd,iqr/1.349)*Math.pow(len,-.2)}(len,ssd,cdi.q3-cdi.q1),span/100)}function calcSpan(trace,cdi,valAxis,bandwidth){var spanOut,spanmode=trace.spanmode,spanIn=trace.span||[],spanTight=[cdi.min,cdi.max],spanLoose=[cdi.min-2*bandwidth,cdi.max+2*bandwidth];function calcSpanItem(index){var s=spanIn[index],sc=valAxis.d2c(s,0,trace[cdi.valLetter+"calendar"]);return sc===BADNUM?spanLoose[index]:sc}var dummyAx={type:"linear",range:spanOut="soft"===spanmode?spanLoose:"hard"===spanmode?spanTight:[calcSpanItem(0),calcSpanItem(1)]};return Axes.setConvert(dummyAx),dummyAx.cleanRange(),spanOut}module.exports=function calc(gd,trace){var cd=boxCalc(gd,trace);if(cd[0].t.empty)return cd;var fullLayout=gd._fullLayout,valAxis=Axes.getFromId(gd,trace["h"===trace.orientation?"xaxis":"yaxis"]),violinScaleGroupStats=fullLayout._violinScaleGroupStats,scaleGroup=trace.scalegroup,groupStats=violinScaleGroupStats[scaleGroup];groupStats||(groupStats=violinScaleGroupStats[scaleGroup]={maxWidth:0,maxCount:0});for(var spanMin=1/0,spanMax=-1/0,i=0;i<cd.length;i++){var cdi=cd[i],vals=cdi.pts.map(helpers.extractVal),bandwidth=cdi.bandwidth=calcBandwidth(trace,cdi,vals),span=cdi.span=calcSpan(trace,cdi,valAxis,bandwidth),dist=span[1]-span[0],n=Math.ceil(dist/(bandwidth/3)),step=dist/n;if(!isFinite(step)||!isFinite(n))return Lib.error("Something went wrong with computing the violin span"),cd[0].t.empty=!0,cd;var kde=helpers.makeKDE(cdi,trace,vals);cdi.density=new Array(n);for(var k=0,t=span[0];t<span[1]+step/2;k++,t+=step){var v=kde(t);groupStats.maxWidth=Math.max(groupStats.maxWidth,v),cdi.density[k]={v:v,t:t}}groupStats.maxCount=Math.max(groupStats.maxCount,vals.length),spanMin=Math.min(spanMin,span[0]),spanMax=Math.max(spanMax,span[1])}var extremes=Axes.findExtremes(valAxis,[spanMin,spanMax],{padded:!0});return trace._extremes[valAxis._id]=extremes,cd[0].t.labels.kde=Lib._(gd,"kde:"),cd}},{"../../constants/numerical":670,"../../lib":693,"../../plots/cartesian/axes":742,"../box/calc":857,"./helpers":1137}],1135:[function(_dereq_,module,exports){"use strict";var setPositionOffset=_dereq_("../box/cross_trace_calc").setPositionOffset,orientations=["v","h"];module.exports=function crossTraceCalc(gd,plotinfo){for(var calcdata=gd.calcdata,xa=plotinfo.xaxis,ya=plotinfo.yaxis,i=0;i<orientations.length;i++){for(var orientation=orientations[i],posAxis="h"===orientation?ya:xa,violinList=[],minPad=0,maxPad=0,j=0;j<calcdata.length;j++){var cd=calcdata[j],t=cd[0].t,trace=cd[0].trace;!0!==trace.visible||"violin"!==trace.type||t.empty||trace.orientation!==orientation||trace.xaxis!==xa._id||trace.yaxis!==ya._id||(violinList.push(j),!1!==trace.points&&(minPad=Math.max(minPad,trace.jitter-trace.pointpos-1),maxPad=Math.max(maxPad,trace.jitter+trace.pointpos-1)))}setPositionOffset("violin",gd,violinList,posAxis,[minPad,maxPad])}}},{"../box/cross_trace_calc":858}],1136:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Color=_dereq_("../../components/color"),boxDefaults=_dereq_("../box/defaults"),attributes=_dereq_("./attributes");module.exports=function supplyDefaults(traceIn,traceOut,defaultColor,layout){function coerce(attr,dflt){return Lib.coerce(traceIn,traceOut,attributes,attr,dflt)}function coerce2(attr,dflt){return Lib.coerce2(traceIn,traceOut,attributes,attr,dflt)}if(boxDefaults.handleSampleDefaults(traceIn,traceOut,coerce,layout),!1!==traceOut.visible){coerce("bandwidth"),coerce("scalegroup",traceOut.name),coerce("scalemode"),coerce("side");var spanmodeDflt,span=coerce("span");Array.isArray(span)&&(spanmodeDflt="manual"),coerce("spanmode",spanmodeDflt);var lineColor=coerce("line.color",(traceIn.marker||{}).color||defaultColor),lineWidth=coerce("line.width"),fillColor=coerce("fillcolor",Color.addOpacity(traceOut.line.color,.5));boxDefaults.handlePointsDefaults(traceIn,traceOut,coerce,{prefix:""});var boxWidth=coerce2("box.width"),boxFillColor=coerce2("box.fillcolor",fillColor),boxLineColor=coerce2("box.line.color",lineColor),boxLineWidth=coerce2("box.line.width",lineWidth);coerce("box.visible",Boolean(boxWidth||boxFillColor||boxLineColor||boxLineWidth))||(traceOut.box={visible:!1});var meanLineColor=coerce2("meanline.color",lineColor),meanLineWidth=coerce2("meanline.width",lineWidth);coerce("meanline.visible",Boolean(meanLineColor||meanLineWidth))||(traceOut.meanline={visible:!1})}}},{"../../components/color":567,"../../lib":693,"../box/defaults":859,"./attributes":1133}],1137:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),kernels_gaussian=function(v){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*v*v)};exports.makeKDE=function(calcItem,trace,vals){var len=vals.length,kernel=kernels_gaussian,bandwidth=calcItem.bandwidth,factor=1/(len*bandwidth);return function(x){for(var sum=0,i=0;i<len;i++)sum+=kernel((x-vals[i])/bandwidth);return factor*sum}},exports.getPositionOnKdePath=function(calcItem,trace,valuePx){var posLetter,valLetter;"h"===trace.orientation?(posLetter="y",valLetter="x"):(posLetter="x",valLetter="y");var pointOnPath=Lib.findPointOnPath(calcItem.path,valuePx,valLetter,{pathLength:calcItem.pathLength}),posCenterPx=calcItem.posCenterPx,posOnPath0=pointOnPath[posLetter];return[posOnPath0,"both"===trace.side?2*posCenterPx-posOnPath0:posCenterPx]},exports.getKdeValue=function(calcItem,trace,valueDist){var vals=calcItem.pts.map(exports.extractVal);return exports.makeKDE(calcItem,trace,vals)(valueDist)/calcItem.posDensityScale},exports.extractVal=function(o){return o.v}},{"../../lib":693}],1138:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),Axes=_dereq_("../../plots/cartesian/axes"),boxHoverPoints=_dereq_("../box/hover"),helpers=_dereq_("./helpers");module.exports=function hoverPoints(pointData,xval,yval,hovermode,hoverLayer){var closePtData,violinLineAttrs,cd=pointData.cd,trace=cd[0].trace,hoveron=trace.hoveron,hasHoveronViolins=-1!==hoveron.indexOf("violins"),hasHoveronKDE=-1!==hoveron.indexOf("kde"),closeData=[];if(hasHoveronViolins||hasHoveronKDE){var closeBoxData=boxHoverPoints.hoverOnBoxes(pointData,xval,yval,hovermode);if(hasHoveronViolins&&(closeData=closeData.concat(closeBoxData)),hasHoveronKDE&&closeBoxData.length>0){var pLetter,vLetter,pAxis,vAxis,vVal,xa=pointData.xa,ya=pointData.ya;"h"===trace.orientation?(vVal=xval,pLetter="y",pAxis=ya,vLetter="x",vAxis=xa):(vVal=yval,pLetter="x",pAxis=xa,vLetter="y",vAxis=ya);var di=cd[pointData.index];if(vVal>=di.span[0]&&vVal<=di.span[1]){var kdePointData=Lib.extendFlat({},pointData),vValPx=vAxis.c2p(vVal,!0),kdeVal=helpers.getKdeValue(di,trace,vVal),pOnPath=helpers.getPositionOnKdePath(di,trace,vValPx),paOffset=pAxis._offset,paLength=pAxis._length;kdePointData[pLetter+"0"]=pOnPath[0],kdePointData[pLetter+"1"]=pOnPath[1],kdePointData[vLetter+"0"]=kdePointData[vLetter+"1"]=vValPx,kdePointData[vLetter+"Label"]=vLetter+": "+Axes.hoverLabelText(vAxis,vVal)+", "+cd[0].t.labels.kde+" "+kdeVal.toFixed(3),kdePointData.spikeDistance=closeBoxData[0].spikeDistance;var spikePosAttr=pLetter+"Spike";kdePointData[spikePosAttr]=closeBoxData[0][spikePosAttr],closeBoxData[0].spikeDistance=void 0,closeBoxData[0][spikePosAttr]=void 0,closeData.push(kdePointData),(violinLineAttrs={stroke:pointData.color})[pLetter+"1"]=Lib.constrain(paOffset+pOnPath[0],paOffset,paOffset+paLength),violinLineAttrs[pLetter+"2"]=Lib.constrain(paOffset+pOnPath[1],paOffset,paOffset+paLength),violinLineAttrs[vLetter+"1"]=violinLineAttrs[vLetter+"2"]=vAxis._offset+vValPx}}}-1!==hoveron.indexOf("points")&&(closePtData=boxHoverPoints.hoverOnPoints(pointData,xval,yval));var violinLine=hoverLayer.selectAll(".violinline-"+trace.uid).data(violinLineAttrs?[0]:[]);return violinLine.enter().append("line").classed("violinline-"+trace.uid,!0).attr("stroke-width",1.5),violinLine.exit().remove(),violinLine.attr(violinLineAttrs),"closest"===hovermode?closePtData?[closePtData]:closeData:closePtData?(closeData.push(closePtData),closeData):closeData}},{"../../lib":693,"../../plots/cartesian/axes":742,"../box/hover":861,"./helpers":1137}],1139:[function(_dereq_,module,exports){"use strict";module.exports={attributes:_dereq_("./attributes"),layoutAttributes:_dereq_("./layout_attributes"),supplyDefaults:_dereq_("./defaults"),supplyLayoutDefaults:_dereq_("./layout_defaults"),calc:_dereq_("./calc"),crossTraceCalc:_dereq_("./cross_trace_calc"),plot:_dereq_("./plot"),style:_dereq_("./style"),styleOnSelect:_dereq_("../scatter/style").styleOnSelect,hoverPoints:_dereq_("./hover"),selectPoints:_dereq_("../box/select"),moduleType:"trace",name:"violin",basePlotModule:_dereq_("../../plots/cartesian"),categories:["cartesian","svg","symbols","oriented","box-violin","showLegend","violinLayout","zoomScale"],meta:{}}},{"../../plots/cartesian":753,"../box/select":866,"../scatter/style":1055,"./attributes":1133,"./calc":1134,"./cross_trace_calc":1135,"./defaults":1136,"./hover":1138,"./layout_attributes":1140,"./layout_defaults":1141,"./plot":1142,"./style":1143}],1140:[function(_dereq_,module,exports){"use strict";var boxLayoutAttrs=_dereq_("../box/layout_attributes"),extendFlat=_dereq_("../../lib").extendFlat;module.exports={violinmode:extendFlat({},boxLayoutAttrs.boxmode,{}),violingap:extendFlat({},boxLayoutAttrs.boxgap,{}),violingroupgap:extendFlat({},boxLayoutAttrs.boxgroupgap,{})}},{"../../lib":693,"../box/layout_attributes":863}],1141:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../../lib"),layoutAttributes=_dereq_("./layout_attributes"),boxLayoutDefaults=_dereq_("../box/layout_defaults");module.exports=function supplyLayoutDefaults(layoutIn,layoutOut,fullData){boxLayoutDefaults._supply(layoutIn,layoutOut,fullData,function coerce(attr,dflt){return Lib.coerce(layoutIn,layoutOut,layoutAttributes,attr,dflt)},"violin")}},{"../../lib":693,"../box/layout_defaults":864,"./layout_attributes":1140}],1142:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Lib=_dereq_("../../lib"),Drawing=_dereq_("../../components/drawing"),boxPlot=_dereq_("../box/plot"),linePoints=_dereq_("../scatter/line_points"),helpers=_dereq_("./helpers");module.exports=function plot(gd,plotinfo,cdViolins,violinLayer){var fullLayout=gd._fullLayout,xa=plotinfo.xaxis,ya=plotinfo.yaxis;function makePath(pts){var segments=linePoints(pts,{xaxis:xa,yaxis:ya,connectGaps:!0,baseTolerance:.75,shape:"spline",simplify:!0});return Drawing.smoothopen(segments[0],1)}Lib.makeTraceGroups(violinLayer,cdViolins,"trace violins").each(function(cd){var plotGroup=d3.select(this),cd0=cd[0],t=cd0.t,trace=cd0.trace;plotinfo.isRangePlot||(cd0.node3=plotGroup);var numViolins=fullLayout._numViolins,group="group"===fullLayout.violinmode&&numViolins>1,groupFraction=1-fullLayout.violingap,bdPos=t.bdPos=t.dPos*groupFraction*(1-fullLayout.violingroupgap)/(group?numViolins:1),bPos=t.bPos=group?2*t.dPos*((t.num+.5)/numViolins-.5)*groupFraction:0;if(t.wHover=t.dPos*(group?groupFraction/numViolins:1),!0!==trace.visible||t.empty)plotGroup.remove();else{var valAxis=plotinfo[t.valLetter+"axis"],posAxis=plotinfo[t.posLetter+"axis"],hasBothSides="both"===trace.side,hasPositiveSide=hasBothSides||"positive"===trace.side,hasNegativeSide=hasBothSides||"negative"===trace.side,groupStats=fullLayout._violinScaleGroupStats[trace.scalegroup],violins=plotGroup.selectAll("path.violin").data(Lib.identity);violins.enter().append("path").style("vector-effect","non-scaling-stroke").attr("class","violin"),violins.exit().remove(),violins.each(function(d){var scale,pathPos,pathNeg,path,i,k,pts,pt,pathSel=d3.select(this),density=d.density,len=density.length,posCenter=d.pos+bPos,posCenterPx=posAxis.c2p(posCenter);switch(trace.scalemode){case"width":scale=groupStats.maxWidth/bdPos;break;case"count":scale=groupStats.maxWidth/bdPos*(groupStats.maxCount/d.pts.length)}if(hasPositiveSide){for(pts=new Array(len),i=0;i<len;i++)(pt=pts[i]={})[t.posLetter]=posCenter+density[i].v/scale,pt[t.valLetter]=density[i].t;pathPos=makePath(pts)}if(hasNegativeSide){for(pts=new Array(len),k=0,i=len-1;k<len;k++,i--)(pt=pts[k]={})[t.posLetter]=posCenter-density[i].v/scale,pt[t.valLetter]=density[i].t;pathNeg=makePath(pts)}if(hasBothSides)path=pathPos+"L"+pathNeg.substr(1)+"Z";else{var startPt=[posCenterPx,valAxis.c2p(density[0].t)],endPt=[posCenterPx,valAxis.c2p(density[len-1].t)];"h"===trace.orientation&&(startPt.reverse(),endPt.reverse()),path=hasPositiveSide?"M"+startPt+"L"+pathPos.substr(1)+"L"+endPt:"M"+endPt+"L"+pathNeg.substr(1)+"L"+startPt}pathSel.attr("d",path),d.posCenterPx=posCenterPx,d.posDensityScale=scale*bdPos,d.path=pathSel.node(),d.pathLength=d.path.getTotalLength()/(hasBothSides?2:1)});var bdPosScaled,bPosPxOffset,fn,boxAttrs=trace.box,boxWidth=boxAttrs.width,boxLineWidth=(boxAttrs.line||{}).width;hasBothSides?(bdPosScaled=bdPos*boxWidth,bPosPxOffset=0):hasPositiveSide?(bdPosScaled=[0,bdPos*boxWidth/2],bPosPxOffset=-boxLineWidth):(bdPosScaled=[bdPos*boxWidth/2,0],bPosPxOffset=boxLineWidth),boxPlot.plotBoxAndWhiskers(plotGroup,{pos:posAxis,val:valAxis},trace,{bPos:bPos,bdPos:bdPosScaled,bPosPxOffset:bPosPxOffset}),boxPlot.plotBoxMean(plotGroup,{pos:posAxis,val:valAxis},trace,{bPos:bPos,bdPos:bdPosScaled,bPosPxOffset:bPosPxOffset}),!trace.box.visible&&trace.meanline.visible&&(fn=Lib.identity);var meanPaths=plotGroup.selectAll("path.meanline").data(fn||[]);meanPaths.enter().append("path").attr("class","meanline").style("fill","none").style("vector-effect","non-scaling-stroke"),meanPaths.exit().remove(),meanPaths.each(function(d){var v=valAxis.c2p(d.mean,!0),p=helpers.getPositionOnKdePath(d,trace,v);d3.select(this).attr("d","h"===trace.orientation?"M"+v+","+p[0]+"V"+p[1]:"M"+p[0]+","+v+"H"+p[1])}),boxPlot.plotPoints(plotGroup,{x:xa,y:ya},trace,t)}})}},{"../../components/drawing":592,"../../lib":693,"../box/plot":865,"../scatter/line_points":1046,"./helpers":1137,d3:147}],1143:[function(_dereq_,module,exports){"use strict";var d3=_dereq_("d3"),Color=_dereq_("../../components/color"),stylePoints=_dereq_("../scatter/style").stylePoints;module.exports=function style(gd,cd){var s=cd?cd[0].node3:d3.select(gd).selectAll("g.trace.violins");s.style("opacity",function(d){return d[0].trace.opacity}),s.each(function(d){var trace=d[0].trace,sel=d3.select(this),box=trace.box||{},boxLine=box.line||{},meanline=trace.meanline||{},meanLineWidth=meanline.width;sel.selectAll("path.violin").style("stroke-width",trace.line.width+"px").call(Color.stroke,trace.line.color).call(Color.fill,trace.fillcolor),sel.selectAll("path.box").style("stroke-width",boxLine.width+"px").call(Color.stroke,boxLine.color).call(Color.fill,box.fillcolor);var meanLineStyle={"stroke-width":meanLineWidth+"px","stroke-dasharray":2*meanLineWidth+"px,"+meanLineWidth+"px"};sel.selectAll("path.mean").style(meanLineStyle).call(Color.stroke,meanline.color),sel.selectAll("path.meanline").style(meanLineStyle).call(Color.stroke,meanline.color),stylePoints(sel,trace,gd)})}},{"../../components/color":567,"../scatter/style":1055,d3:147}],1144:[function(_dereq_,module,exports){"use strict";var Axes=_dereq_("../plots/cartesian/axes"),Lib=_dereq_("../lib"),PlotSchema=_dereq_("../plot_api/plot_schema"),pointsAccessorFunction=_dereq_("./helpers").pointsAccessorFunction,BADNUM=_dereq_("../constants/numerical").BADNUM;exports.moduleType="transform",exports.name="aggregate";var attrs=exports.attributes={enabled:{valType:"boolean",dflt:!0,editType:"calc"},groups:{valType:"string",strict:!0,noBlank:!0,arrayOk:!0,dflt:"x",editType:"calc"},aggregations:{_isLinkedToArray:"aggregation",target:{valType:"string",editType:"calc"},func:{valType:"enumerated",values:["count","sum","avg","median","mode","rms","stddev","min","max","first","last","change","range"],dflt:"first",editType:"calc"},funcmode:{valType:"enumerated",values:["sample","population"],dflt:"sample",editType:"calc"},enabled:{valType:"boolean",dflt:!0,editType:"calc"},editType:"calc"},editType:"calc"},aggAttrs=attrs.aggregations;function aggregateOneArray(gd,trace,groupings,aggregation){if(aggregation.enabled){for(var attr=aggregation.target,targetNP=Lib.nestedProperty(trace,attr),arrayIn=targetNP.get(),func=function getAggregateFunction(opts,conversions){var func=opts.func,d2c=conversions.d2c,c2d=conversions.c2d;switch(func){case"count":return count;case"first":return first;case"last":return last;case"sum":return function(array,indices){for(var total=0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(total+=vi)}return c2d(total)};case"avg":return function(array,indices){for(var total=0,cnt=0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(total+=vi,cnt++)}return cnt?c2d(total/cnt):BADNUM};case"min":return function(array,indices){for(var out=1/0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(out=Math.min(out,vi))}return out===1/0?BADNUM:c2d(out)};case"max":return function(array,indices){for(var out=-1/0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(out=Math.max(out,vi))}return out===-1/0?BADNUM:c2d(out)};case"range":return function(array,indices){for(var min=1/0,max=-1/0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(min=Math.min(min,vi),max=Math.max(max,vi))}return max===-1/0||min===1/0?BADNUM:c2d(max-min)};case"change":return function(array,indices){var first=d2c(array[indices[0]]),last=d2c(array[indices[indices.length-1]]);return first===BADNUM||last===BADNUM?BADNUM:c2d(last-first)};case"median":return function(array,indices){for(var sortCalc=[],i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&sortCalc.push(vi)}if(!sortCalc.length)return BADNUM;sortCalc.sort();var mid=(sortCalc.length-1)/2;return c2d((sortCalc[Math.floor(mid)]+sortCalc[Math.ceil(mid)])/2)};case"mode":return function(array,indices){for(var counts={},maxCnt=0,out=BADNUM,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);if(vi!==BADNUM){var counti=counts[vi]=(counts[vi]||0)+1;counti>maxCnt&&(maxCnt=counti,out=vi)}}return maxCnt?c2d(out):BADNUM};case"rms":return function(array,indices){for(var total=0,cnt=0,i=0;i<indices.length;i++){var vi=d2c(array[indices[i]]);vi!==BADNUM&&(total+=vi*vi,cnt++)}return cnt?c2d(Math.sqrt(total/cnt)):BADNUM};case"stddev":return function(array,indices){var i,total=0,total2=0,cnt=1,v0=BADNUM;for(i=0;i<indices.length&&v0===BADNUM;i++)v0=d2c(array[indices[i]]);if(v0===BADNUM)return BADNUM;for(;i<indices.length;i++){var vi=d2c(array[indices[i]]);if(vi!==BADNUM){var dv=vi-v0;total+=dv,total2+=dv*dv,cnt++}}var norm="sample"===opts.funcmode?cnt-1:cnt;return norm?Math.sqrt((total2-total*total/cnt)/norm):0}}}(aggregation,Axes.getDataConversions(gd,trace,attr,arrayIn)),arrayOut=new Array(groupings.length),i=0;i<groupings.length;i++)arrayOut[i]=func(arrayIn,groupings[i]);targetNP.set(arrayOut),"count"===aggregation.func&&Lib.pushUnique(trace._arrayAttrs,attr)}}function count(array,indices){return indices.length}function first(array,indices){return array[indices[0]]}function last(array,indices){return array[indices[indices.length-1]]}exports.supplyDefaults=function(transformIn,traceOut){var i,transformOut={};function coerce(attr,dflt){return Lib.coerce(transformIn,transformOut,attrs,attr,dflt)}if(!coerce("enabled"))return transformOut;var arrayAttrArray=PlotSchema.findArrayAttributes(traceOut),arrayAttrs={};for(i=0;i<arrayAttrArray.length;i++)arrayAttrs[arrayAttrArray[i]]=1;var groups=coerce("groups");if(!Array.isArray(groups)){if(!arrayAttrs[groups])return void(transformOut.enabled=!1);arrayAttrs[groups]=0}var aggregationOut,aggregationsIn=transformIn.aggregations||[],aggregationsOut=transformOut.aggregations=new Array(aggregationsIn.length);function coercei(attr,dflt){return Lib.coerce(aggregationsIn[i],aggregationOut,aggAttrs,attr,dflt)}for(i=0;i<aggregationsIn.length;i++){aggregationOut={_index:i};var target=coercei("target"),func=coercei("func");coercei("enabled")&&target&&(arrayAttrs[target]||"count"===func&&void 0===arrayAttrs[target])?("stddev"===func&&coercei("funcmode"),arrayAttrs[target]=0,aggregationsOut[i]=aggregationOut):aggregationsOut[i]={enabled:!1,_index:i}}for(i=0;i<arrayAttrArray.length;i++)arrayAttrs[arrayAttrArray[i]]&&aggregationsOut.push({target:arrayAttrArray[i],func:aggAttrs.func.dflt,enabled:!0,_index:-1});return transformOut},exports.calcTransform=function(gd,trace,opts){if(opts.enabled){var groups=opts.groups,groupArray=Lib.getTargetArray(trace,{target:groups});if(groupArray){var i,vi,groupIndex,newGrouping,groupIndices={},indexToPoints={},groupings=[],originalPointsAccessor=pointsAccessorFunction(trace.transforms,opts),len=groupArray.length;for(trace._length&&(len=Math.min(len,trace._length)),i=0;i<len;i++)void 0===(groupIndex=groupIndices[vi=groupArray[i]])?(groupIndices[vi]=groupings.length,newGrouping=[i],groupings.push(newGrouping),indexToPoints[groupIndices[vi]]=originalPointsAccessor(i)):(groupings[groupIndex].push(i),indexToPoints[groupIndices[vi]]=(indexToPoints[groupIndices[vi]]||[]).concat(originalPointsAccessor(i)));opts._indexToPoints=indexToPoints;var aggregations=opts.aggregations;for(i=0;i<aggregations.length;i++)aggregateOneArray(gd,trace,groupings,aggregations[i]);"string"==typeof groups&&aggregateOneArray(gd,trace,groupings,{target:groups,func:"first",enabled:!0}),trace._length=groupings.length}}}},{"../constants/numerical":670,"../lib":693,"../plot_api/plot_schema":731,"../plots/cartesian/axes":742,"./helpers":1147}],1145:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),Registry=_dereq_("../registry"),Axes=_dereq_("../plots/cartesian/axes"),pointsAccessorFunction=_dereq_("./helpers").pointsAccessorFunction,filterOps=_dereq_("../constants/filter_ops"),COMPARISON_OPS=filterOps.COMPARISON_OPS,INTERVAL_OPS=filterOps.INTERVAL_OPS,SET_OPS=filterOps.SET_OPS;exports.moduleType="transform",exports.name="filter",exports.attributes={enabled:{valType:"boolean",dflt:!0,editType:"calc"},target:{valType:"string",strict:!0,noBlank:!0,arrayOk:!0,dflt:"x",editType:"calc"},operation:{valType:"enumerated",values:[].concat(COMPARISON_OPS).concat(INTERVAL_OPS).concat(SET_OPS),dflt:"=",editType:"calc"},value:{valType:"any",dflt:0,editType:"calc"},preservegaps:{valType:"boolean",dflt:!1,editType:"calc"},editType:"calc"},exports.supplyDefaults=function(transformIn){var transformOut={};function coerce(attr,dflt){return Lib.coerce(transformIn,transformOut,exports.attributes,attr,dflt)}if(coerce("enabled")){coerce("preservegaps"),coerce("operation"),coerce("value"),coerce("target");var handleCalendarDefaults=Registry.getComponentMethod("calendars","handleDefaults");handleCalendarDefaults(transformIn,transformOut,"valuecalendar",null),handleCalendarDefaults(transformIn,transformOut,"targetcalendar",null)}return transformOut},exports.calcTransform=function(gd,trace,opts){if(opts.enabled){var targetArray=Lib.getTargetArray(trace,opts);if(targetArray){var target=opts.target,len=targetArray.length;trace._length&&(len=Math.min(len,trace._length));var targetCalendar=opts.targetcalendar,arrayAttrs=trace._arrayAttrs,preservegaps=opts.preservegaps;if("string"==typeof target){var attrTargetCalendar=Lib.nestedProperty(trace,target+"calendar").get();attrTargetCalendar&&(targetCalendar=attrTargetCalendar)}var initFn,fillFn,filterFunc=function getFilterFunc(opts,d2c,targetCalendar){var operation=opts.operation,value=opts.value,hasArrayValue=Array.isArray(value);function isOperationIn(array){return-1!==array.indexOf(operation)}var coercedValue,d2cValue=function(v){return d2c(v,0,opts.valuecalendar)},d2cTarget=function(v){return d2c(v,0,targetCalendar)};isOperationIn(COMPARISON_OPS)?coercedValue=d2cValue(hasArrayValue?value[0]:value):isOperationIn(INTERVAL_OPS)?coercedValue=hasArrayValue?[d2cValue(value[0]),d2cValue(value[1])]:[d2cValue(value),d2cValue(value)]:isOperationIn(SET_OPS)&&(coercedValue=hasArrayValue?value.map(d2cValue):[d2cValue(value)]);switch(operation){case"=":return function(v){return d2cTarget(v)===coercedValue};case"!=":return function(v){return d2cTarget(v)!==coercedValue};case"<":return function(v){return d2cTarget(v)<coercedValue};case"<=":return function(v){return d2cTarget(v)<=coercedValue};case">":return function(v){return d2cTarget(v)>coercedValue};case">=":return function(v){return d2cTarget(v)>=coercedValue};case"[]":return function(v){var cv=d2cTarget(v);return cv>=coercedValue[0]&&cv<=coercedValue[1]};case"()":return function(v){var cv=d2cTarget(v);return cv>coercedValue[0]&&cv<coercedValue[1]};case"[)":return function(v){var cv=d2cTarget(v);return cv>=coercedValue[0]&&cv<coercedValue[1]};case"(]":return function(v){var cv=d2cTarget(v);return cv>coercedValue[0]&&cv<=coercedValue[1]};case"][":return function(v){var cv=d2cTarget(v);return cv<=coercedValue[0]||cv>=coercedValue[1]};case")(":return function(v){var cv=d2cTarget(v);return cv<coercedValue[0]||cv>coercedValue[1]};case"](":return function(v){var cv=d2cTarget(v);return cv<=coercedValue[0]||cv>coercedValue[1]};case")[":return function(v){var cv=d2cTarget(v);return cv<coercedValue[0]||cv>=coercedValue[1]};case"{}":return function(v){return-1!==coercedValue.indexOf(d2cTarget(v))};case"}{":return function(v){return-1===coercedValue.indexOf(d2cTarget(v))}}}(opts,Axes.getDataToCoordFunc(gd,trace,target,targetArray),targetCalendar),originalArrays={},indexToPoints={},index=0;preservegaps?(initFn=function(np){originalArrays[np.astr]=Lib.extendDeep([],np.get()),np.set(new Array(len))},fillFn=function(np,index){var val=originalArrays[np.astr][index];np.get()[index]=val}):(initFn=function(np){originalArrays[np.astr]=Lib.extendDeep([],np.get()),np.set([])},fillFn=function(np,index){var val=originalArrays[np.astr][index];np.get().push(val)}),forAllAttrs(initFn);for(var originalPointsAccessor=pointsAccessorFunction(trace.transforms,opts),i=0;i<len;i++){filterFunc(targetArray[i])?(forAllAttrs(fillFn,i),indexToPoints[index++]=originalPointsAccessor(i)):preservegaps&&index++}opts._indexToPoints=indexToPoints,trace._length=index}}function forAllAttrs(fn,index){for(var j=0;j<arrayAttrs.length;j++){fn(Lib.nestedProperty(trace,arrayAttrs[j]),index)}}}},{"../constants/filter_ops":666,"../lib":693,"../plots/cartesian/axes":742,"../registry":825,"./helpers":1147}],1146:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),PlotSchema=_dereq_("../plot_api/plot_schema"),Plots=_dereq_("../plots/plots"),pointsAccessorFunction=_dereq_("./helpers").pointsAccessorFunction;function transformOne(trace,state){var i,j,k,attr,srcArray,groupName,newTrace,transforms,arrayLookup,groupNameObj,opts=state.transform,transformIndex=state.transformIndex,groups=trace.transforms[transformIndex].groups,originalPointsAccessor=pointsAccessorFunction(trace.transforms,opts);if(!Array.isArray(groups)||0===groups.length)return[trace];var groupNames=Lib.filterUnique(groups),newData=new Array(groupNames.length),len=groups.length,arrayAttrs=PlotSchema.findArrayAttributes(trace),styles=opts.styles||[],styleLookup={};for(i=0;i<styles.length;i++)styleLookup[styles[i].target]=styles[i].value;opts.styles&&(groupNameObj=Lib.keyedContainer(opts,"styles","target","value.name"));var indexLookup={},indexCnts={};for(i=0;i<groupNames.length;i++){indexLookup[groupName=groupNames[i]]=i,indexCnts[groupName]=0,(newTrace=newData[i]=Lib.extendDeepNoArrays({},trace))._group=groupName,newTrace.updateStyle=styleUpdater(groupName,transformIndex),newTrace.transforms[transformIndex]._indexToPoints={};var suppliedName=null;for(groupNameObj&&(suppliedName=groupNameObj.get(groupName)),newTrace.name=suppliedName||""===suppliedName?suppliedName:Lib.templateString(opts.nameformat,{trace:trace.name,group:groupName}),transforms=newTrace.transforms,newTrace.transforms=[],j=0;j<transforms.length;j++)newTrace.transforms[j]=Lib.extendDeepNoArrays({},transforms[j]);for(j=0;j<arrayAttrs.length;j++)Lib.nestedProperty(newTrace,arrayAttrs[j]).set([])}for(k=0;k<arrayAttrs.length;k++){for(attr=arrayAttrs[k],j=0,arrayLookup=[];j<groupNames.length;j++)arrayLookup[j]=Lib.nestedProperty(newData[j],attr).get();for(srcArray=Lib.nestedProperty(trace,attr).get(),j=0;j<len;j++)arrayLookup[indexLookup[groups[j]]].push(srcArray[j])}for(j=0;j<len;j++){(newTrace=newData[indexLookup[groups[j]]]).transforms[transformIndex]._indexToPoints[indexCnts[groups[j]]]=originalPointsAccessor(j),indexCnts[groups[j]]++}for(i=0;i<groupNames.length;i++)groupName=groupNames[i],newTrace=newData[i],Plots.clearExpandedTraceDefaultColors(newTrace),newTrace=Lib.extendDeepNoArrays(newTrace,styleLookup[groupName]||{});return newData}function styleUpdater(groupName,transformIndex){return function(trace,attr,value){Lib.keyedContainer(trace,"transforms["+transformIndex+"].styles","target","value."+attr).set(String(groupName),value)}}exports.moduleType="transform",exports.name="groupby",exports.attributes={enabled:{valType:"boolean",dflt:!0,editType:"calc"},groups:{valType:"data_array",dflt:[],editType:"calc"},nameformat:{valType:"string",editType:"calc"},styles:{_isLinkedToArray:"style",target:{valType:"string",editType:"calc"},value:{valType:"any",dflt:{},editType:"calc",_compareAsJSON:!0},editType:"calc"},editType:"calc"},exports.supplyDefaults=function(transformIn,traceOut,layout){var i,transformOut={};function coerce(attr,dflt){return Lib.coerce(transformIn,transformOut,exports.attributes,attr,dflt)}if(!coerce("enabled"))return transformOut;coerce("groups"),coerce("nameformat",layout._dataLength>1?"%{group} (%{trace})":"%{group}");var styleIn=transformIn.styles,styleOut=transformOut.styles=[];if(styleIn)for(i=0;i<styleIn.length;i++){var thisStyle=styleOut[i]={};Lib.coerce(styleIn[i],styleOut[i],exports.attributes.styles,"target");var value=Lib.coerce(styleIn[i],styleOut[i],exports.attributes.styles,"value");Lib.isPlainObject(value)?thisStyle.value=Lib.extendDeep({},value):value&&delete thisStyle.value}return transformOut},exports.transform=function(data,state){var newTraces,i,j,newData=[];for(i=0;i<data.length;i++)for(newTraces=transformOne(data[i],state),j=0;j<newTraces.length;j++)newData.push(newTraces[j]);return newData}},{"../lib":693,"../plot_api/plot_schema":731,"../plots/plots":805,"./helpers":1147}],1147:[function(_dereq_,module,exports){"use strict";exports.pointsAccessorFunction=function(transforms,opts){for(var tr,prevIndexToPoints,i=0;i<transforms.length&&(tr=transforms[i])!==opts;i++)tr._indexToPoints&&!1!==tr.enabled&&(prevIndexToPoints=tr._indexToPoints);return prevIndexToPoints?function(i){return prevIndexToPoints[i]}:function(i){return[i]}}},{}],1148:[function(_dereq_,module,exports){"use strict";var Lib=_dereq_("../lib"),Axes=_dereq_("../plots/cartesian/axes"),pointsAccessorFunction=_dereq_("./helpers").pointsAccessorFunction;exports.moduleType="transform",exports.name="sort",exports.attributes={enabled:{valType:"boolean",dflt:!0,editType:"calc"},target:{valType:"string",strict:!0,noBlank:!0,arrayOk:!0,dflt:"x",editType:"calc"},order:{valType:"enumerated",values:["ascending","descending"],dflt:"ascending",editType:"calc"},editType:"calc"},exports.supplyDefaults=function(transformIn){var transformOut={};function coerce(attr,dflt){return Lib.coerce(transformIn,transformOut,exports.attributes,attr,dflt)}return coerce("enabled")&&(coerce("target"),coerce("order")),transformOut},exports.calcTransform=function(gd,trace,opts){if(opts.enabled){var targetArray=Lib.getTargetArray(trace,opts);if(targetArray){var target=opts.target,len=targetArray.length;trace._length&&(len=Math.min(len,trace._length));var i,j,arrayAttrs=trace._arrayAttrs,indices=function getIndices(opts,targetArray,d2c,len){var i,sortedArray=new Array(len),indices=new Array(len);for(i=0;i<len;i++)sortedArray[i]={v:targetArray[i],i:i};for(sortedArray.sort(function getSortFunc(opts,d2c){switch(opts.order){case"ascending":return function(a,b){return d2c(a.v)-d2c(b.v)};case"descending":return function(a,b){return d2c(b.v)-d2c(a.v)}}}(opts,d2c)),i=0;i<len;i++)indices[i]=sortedArray[i].i;return indices}(opts,targetArray,Axes.getDataToCoordFunc(gd,trace,target,targetArray),len),originalPointsAccessor=pointsAccessorFunction(trace.transforms,opts),indexToPoints={};for(i=0;i<arrayAttrs.length;i++){var np=Lib.nestedProperty(trace,arrayAttrs[i]),arrayOld=np.get(),arrayNew=new Array(len);for(j=0;j<len;j++)arrayNew[j]=arrayOld[indices[j]];np.set(arrayNew)}for(j=0;j<len;j++)indexToPoints[j]=originalPointsAccessor(indices[j]);opts._indexToPoints=indexToPoints,trace._length=len}}}},{"../lib":693,"../plots/cartesian/axes":742,"./helpers":1147}]},{},[22])(22)},module.exports=f()}).call(exports,__webpack_require__(11))}});